{"version":3,"file":"emuwebApp.min.js","sources":["emuwebApp.min.js"],"names":["wavParserWorker","Worker","window","this","url","getWorkerURL","worker","espsParserWorker","textGridParserWorker","spectroDrawingWorker","ssffParserWorker","ArrayBuffer","prototype","subarray","offset","length","sub","subView","Int8Array","thisView","i","angular","module","config","$locationProvider","html5Mode","service","viewState","sServObj","vals","design","curDbConfig","embeddedVals","audioGetUrl","labelGetUrl","labelType","fromUrlParams","setDesign","data","copy","setVals","$","isEmptyObject","forEach","Object","keys","key1","isArray","itm","push","key2","undefined","console","error","getSsffTrackConfig","name","res","ssffTrackDefinitions","tr","getLimsOfTrack","trackName","perspectives","curPerspectiveIdx","signalCanvases","contourLims","cL","ssffTrackName","getContourColorsOfTrack","contourColors","cC","getAssignment","signalName","assign","a","signalCanvasName","getLevelDefinition","levelName","levelDefinitions","ld","setPerspectivesOrder","curPerspective","levelCanvases","order","getStrRep","code","str","String","fromCharCode","controller","$scope","$rootScope","$log","$compile","$timeout","$q","$window","$document","$location","HistoryService","Iohandlerservice","Soundhandlerservice","ConfigProviderService","fontScaleService","Ssffdataservice","LevelService","Textgridparserservice","Espsparserservice","Binarydatamaniphelper","Wavparserservice","Ssffparserservice","Drawhelperservice","Validationservice","Appcachehandler","loadedMetaDataService","dbObjLoadSaveService","appStateService","DataService","modalService","browserDetector","cps","hists","fontImage","levServ","dataServ","vs","ssffds","shs","dhs","wps","io","ach","lmds","connectBtnLabel","tmp","dbLoaded","is2dCancasesHidden","windowWidth","outerWidth","internalVars","showAboutHint","checkForNewVersion","element","bind","deleteEditArea","setWindowWidth","$digest","e","keyCode","keyMappings","shift","alt","addCurChangeObjToUndoStack","onbeforeunload","getBundleList","main","autoConnect","$on","resetToInitState","loadDefaultConfig","searchObject","search","loadFilesForEmbeddedApp","activeButtons","openDemoDB","httpGetPath","then","showDropZone","setCurBndlName","substr","lastIndexOf","getsubmenuOpen","toggleSubmenu","animation","period","somethingInProgressTxt","resp","EMUwebAppConfig","validRes","validateJSO","catchMouseForKeyBinding","somethingInProgress","parseWavArrBuf","messWavParser","wavJSO","curViewPort","sS","eS","Data","resetSelect","data2","parseLabelFile","parseMess","annot","setData","lNames","levelDefs","levels","l","type","attributeDefinitions","setCurLevelAttrDefs","setState","errMess","open","status","message","JSON","stringify","loadSchemas","replies","setSchemas","httpGetDefaultDesign","success","httpGetDefaultConfig","handleDefaultConfigLoaded","checkIfToShowWelcomeModal","header","curVal","localStorage","getItem","isBrowser","PhantomJS","setItem","getCurBndlName","wsH","initConnect","serverUrl","handleConnectedToWSserver","setspectroSettings","spectrogramSettings","windowSizeInSecs","rangeFrom","rangeTo","dynamicRange","drawHeatMapColors","preEmphasisFilterFactor","heatMapColorAnchors","setTransitionTime","comMode","getProtocol","protocol","version","getDoUserManagement","doUsrData","innerHandleConnectedToWSserver","getDBconfigFile","bdata","setBundleList","clear","specSettings","loadBundle","toggleCollapseSession","ses","uniqSessionList","collapsed","getEnlarge","index","len","large","getenlarge","cursorInTextField","setcursorInTextField","cursorOutOfTextField","addLevelSegBtnClick","getPermission","newName","level","items","getCurAttrDef","leveldef","insertLevel","addObjToUndoStack","action","id","addLevelPointBtnClick","renameSelLevelBtnClick","getcurClickLevelName","downloadTextGridBtnClick","asyncToTextGrid","replace","getCurBndl","downloadAnnotationBtnClick","toJson","getData","spectSettingsBtnClick","connectBtnClick","openDemoDBbtnClick","nameOfDB","dropdown","setDemoDbName","err","aboutBtnClick","showHierarchyBtnClick","hierarchyShown","toggleHierarchy","showEditDBconfigBtnClick","currentConfig","currentVals","log","dbconfig","clearBtnClick","modalText","movesAwayFromLastSave","cmdZoomAll","setViewPort","cmdZoomIn","zoomViewPort","cmdZoomOut","cmdZoomLeft","shiftViewPort","cmdZoomRight","cmdZoomSel","selectS","selectE","cmdPlayView","playFromTo","animatePlayHead","cmdPlaySel","cmdPlayAll","changePerspective","persp","newIdx","setRightsubmenuOpen","getRightsubmenuOpen","getPerspectiveColor","cl","directive","$animate","templateUrl","restrict","scope","idx","link","attr","canvas","find","modal","levelCanvasContainer","levelDef","backgroundCanvas","background","color","lightGrey","$watch","newValue","oldValue","redraw","drawLevelDetails","drawLevelMarkup","getcurMouseLevelName","curMouseLevelName","session","changeCurAttrDef","attrDefName","curAttrDef","setCurAttrDef","hasClass","setEditing","addClass","removeClass","getAttrDefBtnColor","curColor","background-color","updateView","setcurMouseItem","fontSize","font","small","size","slice","isOpen","parent","css","ctx","getContext","clearRect","width","height","sDist","posS","posE","getSampleDist","scaleY","offsetHeight","drawUndistortedTextTwoLines","family","black","drawUndistortedText","curID","getcurMouseItem","getcurClickItems","mTxtImgWidth","measureText","scaleX","zeroTxtImgWidth","fillStyle","curEvt","sampleStart","sampleDur","curLabVal","labels","lab","value","getPos","fillRect","grey","labelCenter","hlY","strokeStyle","beginPath","moveTo","lineTo","stroke","toString","durtext","perc","samplePoint","Math","round","transparent","drawMovingBoundaryLine","drawCurViewPortSelected","xOffset","segMId","isFirst","getcurMouseisFirst","isLast","getcurMouseisLast","clickedSegs","levelId","cs","yellow","blue","getcurMouseLevelType","changeAttrDef","attrs","canvasLength","markupCanvas","drawVpOsciMarkup","duration","drawPlayHead","allPeakVals","calculatePeaks","osciPeaks","freshRedrawDrawOsciOnCanvas","playHeadAnimationInfos","posCur","curS","reset","drawViewPortTimes","currentBundleName","initialized","border","newVal","oldVal","drawPreview","ctxMarkup","closePath","mathHelperService","canvas0","canvas1","context","markupCtx","alpha","devicePixelRatio","primeWorker","clearAndDrawSpectMarkup","setupEvent","drawSpectro","buffer","killSpectroRenderingThread","startSpectroRenderingThread","calcSamplesPerPxl","drawSpectMarkup","drawMinMaxAndName","spectroSettings","kill","imageData","createImageData","says","event","samplesPerPxl","Uint8ClampedArray","img","set","putImageData","parseData","fftN","calcClosestPowerOf2Gt","SampleRate","leftPadding","rightPadding","windowSizeInSamples","paddedSamples","Float32Array","tell","upperFreq","lowerFreq","imgWidth","imgHeight","dynRangeInDB","pixelRatio","sampleRate","transparency","audioBuffer","audioBufferChannels","NumChannels","firefox","Firefox","getBlob","blob","Blob","dataExport","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","exportData","updateHistoryService","export","objURL","URL","webkitURL","createObjectURL","SaveToDisk","dataIn","close","fileURL","fileName","save","document","createElement","setAttribute","href","innerHTML","style","display","body","appendChild","click","target","download","createEvent","initEvent","dispatchEvent","revokeObjectURL","factory","StandardFuncsService","myWindow","BARTLETT","BARTLETTHANN","BLACKMAN","COSINE","GAUSS","HAMMING","HANN","LANCZOS","RECTANGULAR","TRIANGULAR","curLevelAttrDefs","initialize","movingS","movingE","dragBarActive","dragBarHeight","endFreezeSample","hierarchyState","selectedItemID","selectedLinkFromID","selectedLinkToID","editValue","inputFocus","collapseInfo","contextMenuID","newLinkFromID","path","rotated","playing","timelineSize","historyActionTxt","editing","saving","submenuOpen","rightSubmenuOpen","curClickItems","curMousePosSample","curMouseLevelType","curClickLevelName","curClickLevelType","lastPcm","curPreselColumnSample","curCorrectionToolNr","curClickLevelIndex","start","TransitionTime","movingBoundary","movingBoundarySample","focusInTextField","curTaskPercCompl","mouseInEmuWebApp","lastKeyCode","lastUpdate","states","noDBorFilesloaded","permittedActions","loadingSaving","labeling","modalShowing","prevState","curState","actionName","indexOf","b","nameOrObj","updatePlayHead","timestamp","isPlaying","requestAnimationFrame","samplesPassed","floor","$apply","startS","endS","select","end","getViewPort","rfrom","rto","dyn","win","hm","preEmph","hmColorAnchors","parseInt","setWindowFunction","getSelect","selectDependent","selectLevel","next","Levelserv","curLev","now","getLevelDetails","setcurClickLevel","idxOfNow","selectBoundary","getWindowFunctions","getdragBarActive","setdragBarActive","getdragBarHeight","setdragBarHeight","w","s","time","d","Date","getTime","setsubmenuOpen","setenlarge","getTransitionTime","levelID","levelType","levelIndex","setcurClickLevelName","setcurClickLevelType","getcurClickLevelType","getcurClickLevelIndex","getcurClickNeighbours","curClickNeighbours","setcurMouseLevelName","setcurMouseLevelType","item","neighbour","x","curMouseItem","curMouseX","curMouseNeighbours","curMouseisFirst","curMouseisLast","getcurMouseNeighbours","getItemsInSelection","levelData","itemsInRange","rangeStart","rangeEnd","t","sort","sortbystart","setcurClickItem","left","right","entry","setcurClickItemMultiple","prev","getselectedRange","getselected","isEditing","n","getLasPcm","setLastPcm","resetHierarchyState","isHierarchyRotated","toggleHierarchyRotation","debug","traverseAndClean","contextMenuIsOpen","closeContextMenu","getContextMenuID","setContextMenuID","getInputFocus","setInputFocus","f","getEditValue","setEditValue","getCollapsed","getCollapsePosition","collapsePosition","getNumCollapsedParents","numCollapsedParents","setCollapsed","newState","setCollapsePosition","newPosition","setNumCollapsedParents","newNum","getcursorInTextField","isSavingAllowed","setSavingAllowed","countSelected","getCurrentSample","getCurrentPercent","sample","getSamplesPerPixelVal","parseFloat","originalEvent","getViewPortStartTime","getViewPortEndTime","getSelectedStartTime","getSelectedEndTime","sSample","eSample","oldStart","oldEnd","abs","zoomIn","newStartS","newEndS","curMouseMoveItemStart","seg","isLastSeg","getItemDetails","getLastItem","d1","d2","shiftRight","curAttrDefName","newAttrDefName","ad","curAttrDefIndex","getCurAttrIndex","setlastKeyCode","getX","offsetX","layerX","clientWidth","getY","offsetY","layerY","clientHeight","getColorOfAnchor","val","anchorNr","curStyle","lastEventClick","lastEventMove","lastNeighboursMove","lastPCM","curMouseSampleNrInView","trackMouseInLevel","preventDefault","setLastMove","setLastClick","setLastRightClick","restrictions","editItemName","setLastDblClick","moveLine","samplesPerPixel","moveBy","zoomEventMove","getClosestItem","ceil","lastItem","getItemFromLevelById","nearest","mbutton","buttons","which","editItemSize","shiftKey","moveBoundary","updateCurChangeObj","movedBy","moveEvent","altKey","moveSegment","current","setlasteditArea","setlasteditAreaElem","getItemInTime","$index","openEditArea","doChange","getItemNeighboursFromLevel","HierarchyManipulationService","LinkService","AnagestService","applyKeyCodeUp","applyKeyCode","esc","createNewItemAtSelection","domElement","getlasteditArea","curAttrIndex","lvlDefs","definitions","legalLabels","hierarchyCommitEdit","elementID","getItemByID","getLevelName","attrIndex","renameLabel","hierarchyCancelEdit","hierarchyDeleteLink","hierarchyPlayback","hierarchyRotate","pos","deleteLink","fromID","toID","position","hierarchyDeleteItem","result","deleteItemWithLinks","deletedLinks","hierarchyAddItemBefore","newID","addItem","neighborID","before","hierarchyAddItemAfter","undo","redo","showHierarchy","stopPropagation","editingElement","getlastID","force","zoomAll","zoomOut","zoomSel","shiftViewPortLeft","shiftViewPortRight","playEntireFile","playback","playAllInView","playSelected","selectFirstContourCorrectionTool","correctionTool","selectSecondContourCorrectionTool","selectThirdContourCorrectionTool","selectFourthContourCorrectionTool","selectNoContourCorrectionTool","levelUp","levelDown","snapBoundaryToNearestTopBoundary","mouseSeg","neighbor","minDist","snapBoundary","snapBoundaryToNearestBottomBoundary","snapBoundaryToNearestZeroCrossing","dist","calcDistanceToNearestZeroCrossing","levelname","expandSelSegmentsRight","changeTime","labelCanvasConfig","addTimeValue","addTimeMode","expandSegment","rightSide","expandSelSegmentsLeft","shrinkSelSegmentsLeft","shrinkSelSegmentsRight","toggleSideBarLeft","openMenu","toggleSideBarRight","selectItemsInSelection","selPrevItem","idLeft","idRight","selNextItem","point","dur","selNextPrevItem","confirmContent","getlasteditAreaElem","insSeg","insertSegment","newSegmentName","ret","ids","segName","anagestConfig","insPoint","insertEvent","newEventName","alreadyExists","pointName","insertAnagestEvents","deletePreselBoundary","cseg","deleteItem","deletedSegment","deleteSegments","deleteLinkSegment","segments","clickSeg","deleteItemBoundary","deleteBoundary","deleteLinkBoundary","neighbourId","deletedPoint","deleteEvent","metaKey","ctrlKey","safeApply","fn","phase","$root","$$phase","off","delete","elem","elemHeight","deleteButton","children","saveButton","deleteSingleLevel","hide","saveSingleLevel","show","enlarge","asyncParseJSO","slideDuration","slideToggleDuration","stop","slideToggle","newIsOpenVal","oldIsOpenVal","startPCM","$http","Websockethandler","DragnDropDataService","prom","get","respType","responseType","getProm","alert","logOnUser","pwd","getBundle","saveBundle","bundleData","string","annotates","fileType","asyncParseEsps","asyncParseTextGrid","def","defer","promise","resolve","fromJson","initAudioContext","AudioContext","webkitAudioContext","audioContext","curSource","decodeAndPlay","decodeAudioData","ab","createBufferSource","connect","destination","onended","extractRelPartOfWav","endSample","bytePerSample","BitsPerSample","origArrBuf","dv","DataView","setUint32","newData","Uint8Array","byteLength","cutWavBuff","atts","ssffTrackname","assTrackName","lastDraw","$observe","handleUpdate","ass","col","getColumnOfTrack","columnName","sRaSt","getSampleRateAndStartTimeOfTrack","minMaxLims","drawValues","startTime","sR","sT","minVal","maxVal","_minVal","_maxVal","startTimeVP","endTimeVP","colStartSampleNr","colEndSampleNr","nrOfSamples","curSampleArrs","values","y","curSampleInCol","curSampleInColTime","contourVal","contourNr","minContourIdx","maxContourIdx","contColors","colors","green","leftBorder","leftVal","curArr","curArrIdx","arc","PI","rightBorder","rightVal","offsetWidth","red","reject","asyncParseSsffArr","ssffArray","cmd","ssffArr","asyncJso2ssff","jso","curMouseSample","bundleName","switchMarkupContext","mouseX","curMouseTime","curMouseSampleTime","fill","updateObj","sampleBlockIdx","sampleIdx","key","setSelectDrag","leave","drawCrossHairs","getScale","scale","getScaleWidth","str1","str2","drawFrame","max","prevPeak","h","prevH","prevX","prevY","relData","samplePerPx","numberOfChannels","peaks","minPeak","Infinity","maxPeak","min","apply","Array","call","curPxIdx","avrVal","c","sum","p","peak","hDbS","sNr","drawSampleNrs","strokeText","fillText","drawZeroLine","zeroLineY","drawTimeAndSamples","space","roundToNdigitsAfterDecPoint","mouseEvt","unit","trackname","mouseY","mouseFreq","tW","s1","s2","smallFontSize","th","sTime","eTime","applyChange","changeObj","applyOldVal","cur","setHistoryActionText","renameLevel","newname","deleteLevel","deleteBoundaryInvers","deleteSegmentsInvers","insertLinksTo","deleteLinksTo","deleteLinkBoundaryInvers","deleteLinkSegmentInvers","insertSegmentInvers","parentID","childIDs","insertLinkAt","deleteItemWithLinksInvers","addItemInvers","insertLink","pushNewItem","undoStack","redoStack","curChangeObj","dataObj","dataKey","info","obj","tmpObj","oldChangeObj","pop","getNrOfPossibleUndos","getCurrentStack","isUndo","text","front","buf","buffLength","textGrid","rand","random","new","newHash","empty","isMobile","Android","navigator","userAgent","match","BlackBerry","iOS","Opera","Windows","any","Chrome","InternetExplorer","isMobileDevice","isDesktopDevice","lastTextWidth","spaceTop","ctxOriginal","fontPxSize","fontType","restore","text2","alignLeft","esps","loginData","username","password","errorMsg","tryLogin","confirm","cancel","getFile","std","fileExtension","file","Columns","calculateSamplePosInVP","colSampleNr","sampleTime","audioSample","maxItemID","setLevelData","getLevelData","getLevelDataAt","insertLevelDataAt","newLevel","splice","deleteLevelDataAt","getLinkData","links","setLinkData","insertLinkData","newLink","deleteLinkDataAt","insertLinkDataAt","changeLinkDataAt","fromNewID","toNewID","getNewId","raiseId","amount","lowerId","getLabelIdx","labelIdx","lasteditArea","lasteditAreaElem","getLevelsByType","types","getOrderById","num","getIdByOrder","details","getNextItem","after","timeDifference","startItem","myStart","getAllLabelsOfLevel","levelDetails","map","nodeID","getLevelAndItem","getItemsFromLevelByIdAndLength","lastID","j","segment","remove","clientOffset","offsetLeft","top","offsetTop","editText","zoom","createEditAreaElement","createSelection","field","createTextRange","selRange","collapse","moveStart","moveEnd","setSelectionRange","selectionStart","selectionEnd","focus","label","labelid","textid","prepend","class","ng-model","autofocus","padding-top","insertItemDetails","labelname","newElement","attrdefs","updateSegment","updatePoint","firstid","lastid","sampleNr","maximum","spaceLower","spaceHigher","evt","lvl","originalLevel","newLabelName","oldname","insertPoint","lastNeighbours","timeRight","timeLeft","firstSegment","firstOrder","lastSegment","neighbours","deleteOrder","diff2","startOrder","diff","newLabel","startID","newStart","endID","last","toDelete","retOrder","retEvt","oldName","toTop","neighTd","absDist","sampleTarget","absMinDist","thisTd","tIdx","orig","ln","origRight","origLeft","isLinked","orderPoints","first","tempItem","allow","lastLength","distRight","distLeft","newObject","eid","levelAndItem","posNew","posOld","ii","linkIdx","linkExists","hasParents","ID","hasChildren","toIDs","insertLinksFrom","fromIDs","deleteLinksFrom","getLinksTo","linkOrder","getLinksFrom","changeLinkTo","changeLinkFrom","linksTo","linksFrom","found","deleted","neighbourID","ord","uuid","wsonopen","connected","conPromise","wsonmessage","listener","wsonerror","wsonclose","wasClean","$broadcast","sendRequest","request","callbackId","getCallbackId","callbacks","cb","callbackID","ws","send","tOutResp","serverTimeoutInterval","messageObj","hasOwnProperty","closeConnect","newUUID","WebSocket","onopen","onmessage","onerror","onclose","isConnected","userName","disconnectWarning","getDoEditDBConfig","editDBConfig","subtype","base64ToArrayBuffer","stringBase64","binaryString","atob","bytes","ascii","charCodeAt","arrayBufferToBase64","binary","btoa","appCache","applicationCache","handleUpdatereadyEvent","removeItem","swapCache","location","reload","addEventListener","update","options","selWindowInfo","errorID","upperBoundary","modalVals","_fftN","_windowSizeInSamples","calcWindowSizeInSamples","calcFftN","calcWindowSizeVals","cssError","id2","htmlError","saveSpectroSettings","checkSpectroSettings","isNaN","filter","input","regex","patt","RegExp","toLowerCase","out","test","patt1","ArrayHelperService","saveChanges","discardChanges","showMenu","showTwod","transclude","showTwoDimCans","template","panes","bottomRightResizePane","addPane","pane","setBottomRightResizePane","dragBottomRightResizePaneTopResizer","dragBottomRightResizePaneLeftResizer","dragBottomRightResizePaneCornerResizer","handler","pane1","pane2","pane3","bottomRightResizePaneTopResizer","bottomRightResizePaneLeftResizer","bottomRightResizePaneCornerResizer","pane1Min","minSize","pane2Min","dragSplitPaneResizer","drag","ev","scrollHeight","bounds","getBoundingClientRect","bottom","clientY","clientX","require","bgSplitterCtrl","typeclass","drawSsffTrackMarkup","el","dragIcon","src","generateURL","getURL","isActive","classList","add","dataTransfer","setDragImage","effectAllowed","removeAttribute","HierarchyLayoutService","vertical","selectedItem","selectedLink","newLinkSrc","vertOffsetX","vertOffsetY","scaleExtent","transition","nodes","rotation","contextMenu","zoomTimeoutPromise","historyService","render","play","selectItem","selectLink","svg","getOrientatedTransform","captionLayer","getOrientatedLevelCaptionLayerTransform","selectAll","getOrientatedLevelCaptionTransform","transform","zoomListener","translate","getOrientatedNodeTransform","getOrientatedLinkStrokeWidth","getOrientatedGhostLinkStrokeWidth","getNodeText","getOrientatedNodeCollapseText","getOrientatedTextTransform","getOrientatedTextAnchor","getOrientatedTextX","getOrientatedTextY","revArr","reverse","depthToX","getOrientatedAddItemButtonTransform","getOrientatedMousePosition","mouse","getPath","_fromX","_fromY","_toY","_toX","getPreviewPath","from","_x","_y","to","getPreviewColor","validity","checkLinkValidity","valid","reason","getLabelLegalnessColor","dom","svgOnMouseMove","d3","svgOnClick","nodeOnClick","nodeOnPlayClick","nodeOnCollapseClick","toggleCollapse","nodeOnMouseOver","renderSelectionOnly","nodeOnInput","backgroundColor","nodeOnFocusIn","nodeOnFocusOut","linkOnMouseOver","addButtonOnClick","timeInfoLevel","currentItem","timeInfoType","firstTimeItem","lastTimeItem","itemList","concat","findChildren","startSample","depth","posInLevelToY","posInLevel","behavior","on","shiftMode","checkLink","linkObj","addLink","timeArrow","white","levelCaptionSet","newLevelCaptions","enter","oldLevelCaptions","exit","addItemButtons","calculateWeightsBottomUp","levelItems","_visible","allLinks","parentElement","_depth","_posInLevel","_fromDepth","_fromPosInLevel","_toDepth","_toPosInLevel","dataSet","newNodes","oldNodes","circle","foreignObject","linkSet","newLinks","oldLinks","insert","preview","resizeHierarchy","drawEpgGrid","binValStrArr","gridWidth","gridHeight","sInterv","curFrame","curFrameVals","elIdx","split","binStr","binStrIdx","mhs","staticContoursCanvas","globalMinX","globalMaxX","globalMinY","globalMaxY","startPoint","endPoint","drawDots","setGlobalMinMaxVals","dD","twoDimCanvases","twoDimDrawingDefinitions","dots","trConf","xSsffTrack","xCol","ySsffTrack","yCol","staticDots","sD","xCoordinates","xVal","xIdx","yCoordinates","staticContours","sC","drawStaticContour","xPrev","yPrev","xsRaSt","ysRaSt","xContourNr","yContourNr","tw","curMousePosTime","degrees","rotate","allDots","connectLines","fromDot","toDot","labelX","xNameCoordinate","labelY","yNameCoordinate","DragnDropService","dropTextDefault","dropTextErrorFileType","dropTextErrorAPI","dropAllowed","dropParsingWaiting","dropParsingWAV","dropParsingWaitingAnnot","dropFirefoxWarning","dropText","dropClass","dropClassDefault","dropClassOver","dropClassError","count","handles","bundles","bundleNames","updateQueueLength","quantity","enqueueFileAddition","identifier","substring","toUpperCase","extension","bundle","startRendering","maxDroppedBundles","loadFiles","files","reader","isFile","isDirectory","getAsEntry","webkitGetAsEntry","getAsFile","File","warn","createReader","readEntries","entries","dropFiles","FileReader","FileList","dragEnterLeave","handleDragOver","acceptGrid","acceptWav","acceptJson","acceptBoth","acceptFile","handleFilesonChange","loadedFiles","fileDialog","$parent","checkIfLevelsAreDefined","levelNames","DBconfig","lnIdx","checkIfSsffTracksAreDefined","trackNames","tnIdx","td","schemasJsos","names","semCheckLoadedConfigs","keepGoing","ldIdx","ad1","ad1idx","counter","ad2","tDefRes","assTrackNames","lDefRes","tddd","dotNames","sd","verticalPosSsffTrackName","velocitySsffTrackName","autoLinkLevelName","uri","proms","all","schemaArr","tv4","addSchema","getSchema","schemaName","schema","validate","semCheckRes","paths","possible","possibleAsStr","selected","standardFuncServ","findPaths","arr","arrIdx","reverseCopy","join","getSelIdx","selIdx","rotateHierarchy","getRotation","playSelection","getPlaying","isCurrentAttrDef","attrDef","setCurrentAttrDef","attrDefIndex","getAllAttrDefs","levDef","startLevel","parents","findParentLevels","childLevel","linkDefinitions","sublevelName","superlevelName","selectedPath","findParents","findVisibility","_weight","currentLevel","li","it","_parents","rootLevelItems","isCollapsing","currentDescendant","descendants","convertToAbsValues","multiplyEachElement","interp2points","x0","y0","x1","y1","findMinMax","minOrMax","flattenArrayOfArray","arrOfArrs","merged","convertArrayToXYjsoArray","xyArray","itemInSel","vTrackName","vTr","vCol","flatColVals","flatVcolVals","gdat","NaN","vdat","ndat","cdat","startTimeSel","endTimeSel","selCol","selVCol","maxVerticalPos","maxVelBeforeMaxConstr","minVelBeforeMaxVel","interactiveFindThresholds","threshold","on20","minVelBetwMaxVel1maxConstr","minp","off20","maxVelAfterMaxConstr","minBetwMaxConstrMaxVelConstr","minVelAfterMaxVelAfterConstr","curLabel","gestureOnOffsetLabels","gdat0insPoint","gdat1insPoint","maxVelocityOnOffsetLabels","vdat0insPoint","vdat1insPoint","constrictionPlateauBeginEndLabels","ndat0insPoint","ndat1insPoint","maxConstrictionLabel","cdat0insPoint","linkLevelName","linkLevelDetails","linkLevelLabels","itemIdx","direction","description","thdat","thdir","xx","lx","xsh","loguk","higuk","vz","anavv","infos","thresholdIdx","thresholdValue","ap","convertedBundles","sessionDefault","bc","setDefaultSession","getDefaultSession","drandropBundles","bundleList","sessionName","setDragnDropData","convertDragnDropData","handleLocalFiles","wav","annotation","getDragnDropData","generateDrop","reader2","readAsArrayBuffer","onloadend","readyState","DONE","currentTarget","mediaFile","encoding","ssffFiles","readAsText","curClickSegments","setCurBndl","margin","linear","range","xAxis","axis","tickSize","tickSubdivide","yAxis","orient","lineFunc","line","interpolate","domain","x2","y2","cssDone","cssNotDone","cssActive","font-size","que","getClass","hideMe","genUniqSessionList","bndlList","fistSes","sList","bndl","genRendOptBndlList","rendOptBndlList","curBndl","demoDbName","bList","getRendOptBndlList","getDemoDbName","getSessionCollapseState","dolss","filterText","pageSize","currentPage","numberOfPages","sessionLength","uttIsDisabled","getBndlColor","isSessionDefined","messModal","arrBuff","ssffJso","formants","messParser","getAnnotationAndSaveBndl","finishedEditing","comment","getWorkerScript","js","workerInit","global","ab2str","unis","wav2jso","curBinIdx","curBuffer","curBufferView","wavRep","ChunkID","Uint32Array","ChunkSize","Format","Subchunk1ID","Subchunk1Size","Uint16Array","AudioFormat","ByteRate","BlockAlign","Subchunk2ID","Subchunk2Size","Int16Array","parserRes","postMessage","urlObj","terminate","msg","toJSO","labelJSO","headEndIdx","lines","prevLineArr","idCounter","curLineArr","toESPS","espsStr","retVal","l1","l2","localID","testForGapsInLabelJSO","findTimeOfMinSample","findTimeOfMaxSample","myFile","myName","VU_STR","$0","$1","re","tT","tN","eT","inHeader","labs","itemST","itemET","toTextGrid","tG","nl","levelNr","curLevel","evtNr","executed","TWO_PI","totalMax","N","wFunction","myFFT","pixelHeight","internalalpha","maxPsd","HzStep","paint","sin","cos","ceilingFreqFftIdx","floorFreqFftIdx","resultImgArr","toLinearLevel","dbLevel","pow","log10","arg","magnitude","real","imag","sqrt","FFT","m","applyWindowFuncAndPreemph","applyPreEmph","wFunctionBartlett","wFunctionBartlettHann","wFunctionBlackman","wFunctionCosine","wFunctionGauss","wFunctionHamming","wFunctionHann","wFunctionLanczos","wFunctionRectangular","wFunctionTriangular","a0","a1","a2","E","curSample","prevSample","fft","k","n1","n2","t1","t2","convertToHeatmap","minval","maxval","maxIndex","v","i1","i2","rgb1","rgb2","r","g","drawVerticalLineOfSpectogram","rgb","px","py","psd","psdLog","scaledVal","hmVals","calcMagnitudeSpectrum","low","renderSpectrogram","renderError","ssffData","headID","machineID","sepString","origFreq","base64encode","c1","c2","c3","base64EncodeChars","charAt","base64decode","c4","base64DecodeChars","stringToUint","charList","uintArray","Uint8Concat","second","firstLength","ssff2jso","uIntBuffView","dataView","buffStr","decoder","TextDecoder","decode","newLsep","lSpl","ssffdatatype","curLen","curMin","curMax","Float64Array","jso2ssff","headerStr","bytePerTime","failed","byteSizeOfDataBuffer","dataBuff","dataBuffView","ssffBufView","byteOffSet","curArray","curArrayIDX","curCol","setInt16","parseArr","noError","resArr","parse","curExp","getTemplateUrl","deferChange","dataOut","param1","param2","chartData","changeModal","closeAndResolve","levelDefinitionProperties","linkDefinitionProperties","spectroDefinitionProperties","signalSelect","levelSelect","twoDimSelect","addSignalSelect","addLevelSelect","addTwoDimSelect","response","tabs","title","currentTabUrl","onClickTab","tab","isActiveTab","tabUrl","font-family","setup","dbconfigFileSchema","webappFileSchema","properties","resetSelections","highlight","typeOfDefinition","bg","added","classBorderDefinition","saveDefinition","protocolParameter","protocolData","localData","allowed","showResponse","hideResponse","addDefinition","keyAttribute","deleteDefinition","subKeyAttribute","tree","expanded","node","isMDFile","superlevelIndex","linkType","consle","toElement","fromElement","sibling","firstAllowedChildIndex","lastAllowedChildIndex","superlevel","sublevel","parentOrder","childOrder","siblingRelativeIndex","o","listOfMarkdownFiles","curMdFile","setCurrentMdFile","mdFile","isCurrentMdFile","font-weight"],"mappings":"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","sourcesContent":["'use strict';\nArrayBuffer.prototype.subarray = function (offset, length) {\n  var sub = new ArrayBuffer(length);\n  var subView = new Int8Array(sub);\n  var thisView = new Int8Array(this);\n  for (var i = 0; i < length; i++) {\n    subView[i] = thisView[offset + i];\n  }\n  return sub;\n};\n'use strict';\nangular.module('emuwebApp', [\n  'ui',\n  'ui.sortable',\n  'ngAnimate',\n  'angular.filter',\n  'btford.markdown'\n]).config([\n  '$locationProvider',\n  function ($locationProvider) {\n    $locationProvider.html5Mode(true);\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ConfigProviderService', [\n  'viewState',\n  function (viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.vals = {};\n    sServObj.design = {};\n    sServObj.curDbConfig = {};\n    // embedded values -> if these are set this overrides the normal config  \n    sServObj.embeddedVals = {\n      audioGetUrl: '',\n      labelGetUrl: '',\n      labelType: '',\n      fromUrlParams: false\n    };\n    sServObj.setDesign = function (data) {\n      angular.copy(data, sServObj.design);\n    };\n    /**\n\t\t * depth of 2 = max\n\t\t */\n    sServObj.setVals = function (data) {\n      if ($.isEmptyObject(sServObj.vals)) {\n        sServObj.vals = data;\n      } else {\n        angular.forEach(Object.keys(data), function (key1) {\n          // if array... overwrite entire thing!\n          if (angular.isArray(sServObj.vals[key1])) {\n            //empty array\n            sServObj.vals[key1] = [];\n            angular.forEach(data[key1], function (itm) {\n              sServObj.vals[key1].push(itm);\n            });\n          } else {\n            angular.forEach(Object.keys(data[key1]), function (key2) {\n              if (sServObj.vals[key1][key2] !== undefined) {\n                sServObj.vals[key1][key2] = data[key1][key2];\n              } else {\n                console.error('BAD ENTRY IN CONFIG! Key1: ' + key1 + ' key2: ' + key2);\n              }\n            });\n          }\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSsffTrackConfig = function (name) {\n      var res;\n      if (sServObj.curDbConfig.ssffTrackDefinitions !== undefined) {\n        angular.forEach(sServObj.curDbConfig.ssffTrackDefinitions, function (tr) {\n          if (tr.name === name) {\n            res = tr;\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLimsOfTrack = function (trackName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourLims, function (cL) {\n        if (cL.ssffTrackName === trackName) {\n          res = cL;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getContourColorsOfTrack = function (trackName) {\n      var res;\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors, function (cC) {\n        if (cC.ssffTrackName === trackName) {\n          res = cC;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAssignment = function (signalName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign, function (a) {\n        if (a.signalCanvasName === signalName) {\n          res = a;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLevelDefinition = function (levelName) {\n      var res = {};\n      angular.forEach(sServObj.curDbConfig.levelDefinitions, function (ld) {\n        if (ld.name === levelName) {\n          res = ld;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setPerspectivesOrder = function (curPerspective, levelName) {\n      if (sServObj.vals !== undefined) {\n        if (sServObj.vals.perspectives !== undefined) {\n          if (sServObj.vals.perspectives[curPerspective] !== undefined) {\n            if (sServObj.vals.perspectives[curPerspective].levelCanvases !== undefined) {\n              sServObj.vals.perspectives[curPerspective].levelCanvases.order = levelName;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t *  replace ascii codes from config with strings\n\t\t */\n    sServObj.getStrRep = function (code) {\n      var str;\n      switch (code) {\n      case 8:\n        str = 'BACKSPACE';\n        break;\n      case 9:\n        str = 'TAB';\n        break;\n      case 13:\n        str = 'ENTER';\n        break;\n      case 16:\n        str = 'SHIFT';\n        break;\n      case 18:\n        str = 'ALT';\n        break;\n      case 32:\n        str = 'SPACE';\n        break;\n      case 37:\n        str = '\\u2190';\n        break;\n      case 39:\n        str = '\\u2192';\n        break;\n      case 38:\n        str = '\\u2191';\n        break;\n      case 40:\n        str = '\\u2193';\n        break;\n      case 42:\n        str = '+';\n        break;\n      case 43:\n        str = '+';\n        break;\n      case 45:\n        str = '-';\n        break;\n      case 95:\n        str = '-';\n        break;\n      default:\n        str = String.fromCharCode(code);\n      }\n      return str;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('MainController', [\n  '$scope',\n  '$rootScope',\n  '$log',\n  '$compile',\n  '$timeout',\n  '$q',\n  '$window',\n  '$document',\n  '$location',\n  'viewState',\n  'HistoryService',\n  'Iohandlerservice',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'fontScaleService',\n  'Ssffdataservice',\n  'LevelService',\n  'Textgridparserservice',\n  'Espsparserservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Ssffparserservice',\n  'Drawhelperservice',\n  'Validationservice',\n  'Appcachehandler',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'appStateService',\n  'DataService',\n  'modalService',\n  'browserDetector',\n  function ($scope, $rootScope, $log, $compile, $timeout, $q, $window, $document, $location, viewState, HistoryService, Iohandlerservice, Soundhandlerservice, ConfigProviderService, fontScaleService, Ssffdataservice, LevelService, Textgridparserservice, Espsparserservice, Binarydatamaniphelper, Wavparserservice, Ssffparserservice, Drawhelperservice, Validationservice, Appcachehandler, loadedMetaDataService, dbObjLoadSaveService, appStateService, DataService, modalService, browserDetector) {\n    // hook up services to use abbreviated forms\n    $scope.cps = ConfigProviderService;\n    $scope.hists = HistoryService;\n    $scope.fontImage = fontScaleService;\n    $scope.levServ = LevelService;\n    $scope.dataServ = DataService;\n    $scope.vs = viewState;\n    $scope.ssffds = Ssffdataservice;\n    $scope.shs = Soundhandlerservice;\n    $scope.dhs = Drawhelperservice;\n    $scope.wps = Wavparserservice;\n    $scope.io = Iohandlerservice;\n    $scope.ach = Appcachehandler;\n    $scope.lmds = loadedMetaDataService;\n    // init vars\n    $scope.connectBtnLabel = 'connect';\n    $scope.tmp = {};\n    $scope.dbLoaded = false;\n    $scope.is2dCancasesHidden = true;\n    $scope.windowWidth = $window.outerWidth;\n    $scope.internalVars = {};\n    $scope.internalVars.showAboutHint = false;\n    // this should probably be moved to viewState\n    // check for new version\n    $scope.ach.checkForNewVersion();\n    //////////////\n    // bindings\n    // bind window resize event\n    angular.element($window).bind('resize', function () {\n      LevelService.deleteEditArea();\n      viewState.setWindowWidth($window.outerWidth);\n      $scope.$digest();\n    });\n    // bind shift/alt keyups for history\n    angular.element($window).bind('keyup', function (e) {\n      if (e.keyCode === ConfigProviderService.vals.keyMappings.shift || e.keyCode === ConfigProviderService.vals.keyMappings.alt) {\n        HistoryService.addCurChangeObjToUndoStack();\n        $scope.$digest();\n      }\n    });\n    // Take care of preventing navigation out of app (only if something is loaded, not in embedded mode and not developing (auto connecting))\n    window.onbeforeunload = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl === '' && loadedMetaDataService.getBundleList().length > 0 && !ConfigProviderService.vals.main.autoConnect) {\n        return 'Do you really wish to leave/reload the EMU-webApp? All unsaved changes will be lost...';\n      }\n    };\n    //////////////\n    // watches\n    // watch if embedded override (if attributes are set on emuwebapp tag)\n    // $scope.$watch('cps.embeddedVals.audioGetUrl', function (val) {\n    // \tif (val !== undefined && val !== '') {\n    // \t\t// check if both are set\n    // \t\t$scope.loadFilesForEmbeddedApp();\n    // \t}\n    // }, true);\n    //\n    //////////////\n    /////////////\n    // listens\n    // listen for connectionDisrupted event -> I don't like listens but in this case it might me the way to go...\n    $scope.$on('connectionDisrupted', function (event, args) {\n      appStateService.resetToInitState();\n    });\n    // listen for resetToInitState\n    $scope.$on('resetToInitState', function () {\n      $scope.loadDefaultConfig();\n    });\n    //\n    ////////////\n    // check if URL parameters are set -> if so set embedded flags!\n    var searchObject = $location.search();\n    if (searchObject['audioGetUrl'] && searchObject['labelGetUrl'] && searchObject['labelType']) {\n      ConfigProviderService.embeddedVals.audioGetUrl = searchObject.audioGetUrl;\n      ConfigProviderService.embeddedVals.labelGetUrl = searchObject.labelGetUrl;\n      ConfigProviderService.embeddedVals.labelType = searchObject.labelType;\n      ConfigProviderService.embeddedVals.fromUrlParams = true;\n    }\n    ;\n    /**\n\t\t *\n\t\t */\n    $scope.loadFilesForEmbeddedApp = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl) {\n        ConfigProviderService.vals.activeButtons.openDemoDB = false;\n        Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.audioGetUrl, 'arraybuffer').then(function (data) {\n          viewState.showDropZone = false;\n          // set bundle name\n          var tmp = ConfigProviderService.embeddedVals.audioGetUrl;\n          loadedMetaDataService.setCurBndlName(tmp.substr(0, tmp.lastIndexOf('.')).substr(tmp.lastIndexOf('/') + 1, tmp.length));\n          //hide menu\n          if (viewState.getsubmenuOpen()) {\n            viewState.toggleSubmenu(ConfigProviderService.design.animation.period);\n          }\n          viewState.somethingInProgressTxt = 'Loading DB config...';\n          // then get the DBconfigFile\n          Iohandlerservice.httpGetPath('configFiles/embedded_emuwebappConfig.json').then(function (resp) {\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n            // validate emuwebappConfigSchema\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              // turn of keybinding only on mouseover\n              if (ConfigProviderService.embeddedVals.fromUrlParams) {\n                ConfigProviderService.vals.main.catchMouseForKeyBinding = false;\n              }\n              ConfigProviderService.curDbConfig = resp.data;\n              // validate DBconfigFileSchema!\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // set wav file\n                viewState.somethingInProgress = true;\n                viewState.somethingInProgressTxt = 'Parsing WAV file...';\n                Wavparserservice.parseWavArrBuf(data.data).then(function (messWavParser) {\n                  var wavJSO = messWavParser;\n                  viewState.curViewPort.sS = 0;\n                  viewState.curViewPort.eS = wavJSO.Data.length;\n                  viewState.resetSelect();\n                  Soundhandlerservice.wavJSO = wavJSO;\n                  // get + parse file\n                  Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.labelGetUrl, 'utf-8').then(function (data2) {\n                    viewState.somethingInProgressTxt = 'Parsing ' + ConfigProviderService.embeddedVals.labelType + ' file...';\n                    Iohandlerservice.parseLabelFile(data2.data, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTextGrid', ConfigProviderService.embeddedVals.labelType).then(function (parseMess) {\n                      var annot = parseMess;\n                      DataService.setData(annot);\n                      var lNames = [];\n                      var levelDefs = [];\n                      annot.levels.forEach(function (l) {\n                        lNames.push(l.name);\n                        levelDefs.push({\n                          'name': l.name,\n                          'type': l.type,\n                          'attributeDefinitions': {\n                            'name': l.name,\n                            'type': 'string'\n                          }\n                        });\n                      });\n                      // set level defs\n                      ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n                      viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                      ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n                      viewState.somethingInProgressTxt = 'Done!';\n                      viewState.somethingInProgress = false;\n                      viewState.setState('labeling');\n                    }, function (errMess) {\n                      modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message);\n                    });\n                  }, function (errMess) {\n                    modalService.open('views/error.html', 'Could not get label file: ' + ConfigProviderService.embeddedVals.labelGetUrl + ' ERROR ' + JSON.stringify(errMess, null, 4));\n                  });\n                }, function (errMess) {\n                  modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message);\n                });\n              } else {\n                modalService.open('views/error.html', 'Error validating / checking DBconfig: ' + JSON.stringify(validRes, null, 4));\n              }\n            } else {\n              modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Could not get embedded_config.json: ' + errMess);\n          });\n        }, function (errMess) {\n          modalService.open('views/error.html', 'Could not get audio file:' + ConfigProviderService.embeddedVals.audioGetUrl + ' ERROR: ' + JSON.stringify(errMess, null, 4));\n        });\n      }\n    };\n    /**\n\t\t * init load of config files\n\t\t */\n    $scope.loadDefaultConfig = function () {\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading schema files';\n      // load schemas first\n      Validationservice.loadSchemas().then(function (replies) {\n        Validationservice.setSchemas(replies);\n        Iohandlerservice.httpGetDefaultDesign().success(function (data) {\n          ConfigProviderService.setDesign(data);\n          Iohandlerservice.httpGetDefaultConfig().success(function (data) {\n            viewState.somethingInProgressTxt = 'Validating emuwebappConfig';\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', data);\n            if (validRes === true) {\n              ConfigProviderService.setVals(data);\n              $scope.handleDefaultConfigLoaded();\n              // loadFilesForEmbeddedApp if these are set\n              $scope.loadFilesForEmbeddedApp();\n              $scope.checkIfToShowWelcomeModal();\n              // FOR DEVELOPMENT\n              //$scope.aboutBtnClick();\n              viewState.somethingInProgress = false;\n            } else {\n              modalService.open('views/error.html', 'Error validating / checking emuwebappConfigSchema: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }).error(function (data, status, header, config) {\n            modalService.open('views/error.html', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n              appStateService.resetToInitState();\n            });\n          });\n        }).error(function (data, status, header, config) {\n          modalService.open('views/error.html', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }, function (errMess) {\n        modalService.open('views/error.html', 'Error loading schema file: ' + JSON.stringify(errMess, null, 4)).then(function () {\n          appStateService.resetToInitState();\n        });\n      });\n    };\n    // call function on init\n    $scope.loadDefaultConfig();\n    $scope.checkIfToShowWelcomeModal = function (argument) {\n      var curVal = localStorage.getItem('haveShownWelcomeModal');\n      if (!browserDetector.isBrowser.PhantomJS() && curVal === null) {\n        localStorage.setItem('haveShownWelcomeModal', 'true');\n        $scope.internalVars.showAboutHint = true;\n      }  // FOR DEVELOPMENT\n         //$scope.internalVars.showAboutHint = true;\n    };\n    $scope.getCurBndlName = function () {\n      return loadedMetaDataService.getCurBndlName();\n    };\n    /**\n\t\t * function called after default config was loaded\n\t\t */\n    $scope.handleDefaultConfigLoaded = function () {\n      if (!viewState.getsubmenuOpen()) {\n        viewState.toggleSubmenu(ConfigProviderService.design.animation.period);\n      }\n      if (ConfigProviderService.vals.main.autoConnect) {\n        Iohandlerservice.wsH.initConnect(ConfigProviderService.vals.main.serverUrl).then(function (message) {\n          if (message.type === 'error') {\n            modalService.open('views/error.html', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl);\n          } else {\n            $scope.handleConnectedToWSserver();\n          }\n        });\n      }\n      // init loading of files for testing\n      viewState.setspectroSettings(ConfigProviderService.vals.spectrogramSettings.windowSizeInSecs, ConfigProviderService.vals.spectrogramSettings.rangeFrom, ConfigProviderService.vals.spectrogramSettings.rangeTo, ConfigProviderService.vals.spectrogramSettings.dynamicRange, ConfigProviderService.vals.spectrogramSettings.window, ConfigProviderService.vals.spectrogramSettings.drawHeatMapColors, ConfigProviderService.vals.spectrogramSettings.preEmphasisFilterFactor, ConfigProviderService.vals.spectrogramSettings.heatMapColorAnchors);\n      // setting transition values\n      viewState.setTransitionTime(ConfigProviderService.design.animation.period);\n    };\n    /**\n\t\t * function is called after websocket connection\n\t\t * has been established. It executes the protocol\n\t\t * and loads the first bundle in the bundle list (= default behavior).\n\t\t */\n    $scope.handleConnectedToWSserver = function () {\n      // hide drop zone\n      viewState.showDropZone = false;\n      ConfigProviderService.vals.main.comMode = 'WS';\n      ConfigProviderService.vals.activeButtons.openDemoDB = false;\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Checking protocol...';\n      // Check if server speaks the same protocol\n      Iohandlerservice.getProtocol().then(function (res) {\n        if (res.protocol === 'EMU-webApp-websocket-protocol' && res.version === '0.0.2') {\n          viewState.somethingInProgressTxt = 'Checking user management...';\n          // then ask if server does user management\n          Iohandlerservice.getDoUserManagement().then(function (doUsrData) {\n            if (doUsrData === 'NO') {\n              $scope.innerHandleConnectedToWSserver();\n            } else {\n              // show user management error\n              modalService.open('views/loginModal.html').then(function (res) {\n                if (res) {\n                  $scope.innerHandleConnectedToWSserver();\n                } else {\n                  appStateService.resetToInitState();\n                }\n              });\n            }\n          });\n        } else {\n          // show protocol error and disconnect from server\n          modalService.open('views/error.html', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl + '. It does not speak the same protocol as this client. Its protocol answer was: \"' + res.protocol + '\" with the version: \"' + res.version + '\"').then(function () {\n            appStateService.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t * to avoid redundant code...\n\t\t */\n    $scope.innerHandleConnectedToWSserver = function () {\n      viewState.somethingInProgressTxt = 'Loading DB config...';\n      // then get the DBconfigFile\n      Iohandlerservice.httpGetDefaultDesign().success(function (data) {\n        ConfigProviderService.setDesign(data);\n        Iohandlerservice.getDBconfigFile().then(function (data) {\n          // first element of perspectives is default perspective\n          viewState.curPerspectiveIdx = 0;\n          ConfigProviderService.setVals(data.EMUwebAppConfig);\n          // FOR DEVELOPMENT\n          //$scope.showEditDBconfigBtnClick();\n          delete data.EMUwebAppConfig;\n          // delete to avoid duplicate\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n          if (validRes === true) {\n            ConfigProviderService.curDbConfig = data;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            validRes = Validationservice.validateJSO('DBconfigFileSchema', data);\n            if (validRes === true) {\n              // then get the DBconfigFile\n              viewState.somethingInProgressTxt = 'Loading bundle list...';\n              Iohandlerservice.getBundleList().then(function (bdata) {\n                validRes = loadedMetaDataService.setBundleList(bdata);\n                // show standard buttons\n                ConfigProviderService.vals.activeButtons.clear = true;\n                ConfigProviderService.vals.activeButtons.specSettings = true;\n                if (validRes === true) {\n                  // then load first bundle in list\n                  dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);\n                } else {\n                  modalService.open('views/error.html', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                }\n              });\n            } else {\n              modalService.open('views/error.html', 'Error validating / checking DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          } else {\n            modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        });\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.toggleCollapseSession = function (ses) {\n      $scope.uniqSessionList[ses].collapsed = !$scope.uniqSessionList[ses].collapsed;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getEnlarge = function (index) {\n      var len = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length;\n      var large = 50;\n      if (viewState.getenlarge() == -1) {\n        return 'auto';\n      } else {\n        if (len === 1) {\n          return 'auto';\n        }\n        if (len === 2) {\n          if (viewState.getenlarge() == index) {\n            return '70%';\n          } else {\n            return '27%';\n          }\n        } else {\n          if (viewState.getenlarge() == index) {\n            return large + '%';\n          } else {\n            return (95 - large) / (len - 1) + '%';\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setcursorInTextField(false);\n    };\n    /////////////////////////////////////////\n    // handle button clicks\n    // top menu:\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelSegBtnClick = function () {\n      if (viewState.getPermission('addLevelSegBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [],\n            name: newName,\n            type: 'SEGMENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelPointBtnClick = function () {\n      if (viewState.getPermission('addLevelPointBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [],\n            name: newName,\n            type: 'EVENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.renameSelLevelBtnClick = function () {\n      if (viewState.getPermission('renameSelLevelBtnClick')) {\n        if (viewState.getcurClickLevelName() !== undefined) {\n          modalService.open('views/renameLevel.html', viewState.getcurClickLevelName());\n        } else {\n          modalService.open('views/error.html', 'Rename Error : Please choose a Level first !');\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadTextGridBtnClick = function () {\n      if (viewState.getPermission('downloadTextGridBtnClick')) {\n        Textgridparserservice.asyncToTextGrid().then(function (parseMess) {\n          parseMess = parseMess.replace(/\\t/g, '    ');\n          // replace tab with 4 spaces\n          modalService.open('views/export.html', loadedMetaDataService.getCurBndl().name + '.TextGrid', parseMess);\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadAnnotationBtnClick = function () {\n      if (viewState.getPermission('downloadAnnotationBtnClick')) {\n        modalService.open('views/export.html', loadedMetaDataService.getCurBndl().name + '_annot.json', angular.toJson(DataService.getData(), true));\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.spectSettingsBtnClick = function () {\n      if (viewState.getPermission('spectSettingsChange')) {\n        modalService.open('views/spectSettings.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.connectBtnClick = function () {\n      if (viewState.getPermission('connectBtnClick')) {\n        modalService.open('views/connectModal.html').then(function (url) {\n          if (url) {\n            viewState.somethingInProgressTxt = 'Connecting to server...';\n            viewState.somethingInProgress = true;\n            Iohandlerservice.wsH.initConnect(url).then(function (message) {\n              if (message.type === 'error') {\n                modalService.open('views/error.html', 'Could not connect to websocket server: ' + url).then(function () {\n                  appStateService.resetToInitState();\n                });\n              } else {\n                $scope.handleConnectedToWSserver();\n              }\n            });\n          }\n        });\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openDemoDBbtnClick = function (nameOfDB) {\n      if (viewState.getPermission('openDemoBtnDBclick')) {\n        $scope.dropdown = false;\n        ConfigProviderService.vals.activeButtons.openDemoDB = false;\n        loadedMetaDataService.setDemoDbName(nameOfDB);\n        // hide drop zone\n        viewState.showDropZone = false;\n        viewState.somethingInProgress = true;\n        // alert(nameOfDB);\n        viewState.setState('loadingSaving');\n        ConfigProviderService.vals.main.comMode = 'DEMO';\n        viewState.somethingInProgressTxt = 'Loading DB config...';\n        Iohandlerservice.httpGetDefaultDesign().success(function (data) {\n          ConfigProviderService.setDesign(data);\n          Iohandlerservice.getDBconfigFile(nameOfDB).then(function (res) {\n            var data = res.data;\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(data.EMUwebAppConfig);\n            delete data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              ConfigProviderService.curDbConfig = data;\n              viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // then get the DBconfigFile\n                viewState.somethingInProgressTxt = 'Loading bundle list...';\n                Iohandlerservice.getBundleList(nameOfDB).then(function (res) {\n                  var bdata = res.data;\n                  // validRes = Validationservice.validateJSO('bundleListSchema', bdata);\n                  // if (validRes === true) {\n                  loadedMetaDataService.setBundleList(bdata);\n                  // show standard buttons\n                  ConfigProviderService.vals.activeButtons.clear = true;\n                  ConfigProviderService.vals.activeButtons.specSettings = true;\n                  // then load first bundle in list\n                  dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);\n                }, function (err) {\n                  modalService.open('views/error.html', 'Error loading bundle list of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                });\n              } else {\n                modalService.open('views/error.html', 'Error validating / checking DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                  appStateService.resetToInitState();\n                });\n              }\n            } else {\n              modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }, function (err) {\n            modalService.open('views/error.html', 'Error loading DB config of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n              appStateService.resetToInitState();\n            });\n          });\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.aboutBtnClick = function () {\n      modalService.open('views/help.html');\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showHierarchyBtnClick = function () {\n      if (!viewState.hierarchyShown) {\n        viewState.toggleHierarchy();\n        modalService.open('views/showHierarchyModal.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showEditDBconfigBtnClick = function () {\n      var currentConfig = $scope.cps.curDbConfig;\n      var currentVals = $scope.cps.vals;\n      modalService.open('views/tabbed.html').then(function (res) {\n        if (res) {\n          // todo save and transfer curDbConfig & vals\n          console.log(angular.toJson({\n            dbconfig: $scope.cps.curDbConfig,\n            vals: $scope.cps.vals\n          }));\n        } else {\n          $scope.cps.curDbConfig = currentConfig;\n          $scope.cps.vals = currentVals;\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.clearBtnClick = function () {\n      // viewState.setdragBarActive(false);\n      var modalText;\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.';\n      } else {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? You have NO unsaved changes so no changes will be lost.';\n      }\n      modalService.open('views/confirmModal.html', modalText).then(function (res) {\n        if (res) {\n          appStateService.resetToInitState();\n        }\n      });\n    };\n    // bottom menu:\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomAll = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomIn = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(true);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomOut = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(false);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomLeft = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(false);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomRight = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(true);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomSel = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayView = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlaySel = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n        viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayAll = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n        viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n      }\n    };\n    ///////////////////////////\n    // other\n    /**\n\t\t * function used to change perspective\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.changePerspective = function (persp) {\n      var newIdx;\n      for (var i = 0; i < ConfigProviderService.vals.perspectives.length; i++) {\n        if (persp.name === ConfigProviderService.vals.perspectives[i].name) {\n          newIdx = i;\n        }\n      }\n      viewState.curPerspectiveIdx = newIdx;\n      // close submenu\n      viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n    };\n    /**\n\t\t * function used by right side menu to get color of current perspecitve in ul\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.getPerspectiveColor = function (persp) {\n      var cl;\n      if (viewState.curPerspectiveIdx === -1 || persp.name === ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].name) {\n        cl = 'emuwebapp-curSelPerspLi';\n      } else {\n        cl = 'emuwebapp-perspLi';\n      }\n      return cl;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('level', [\n  '$timeout',\n  '$animate',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'HistoryService',\n  'fontScaleService',\n  'modalService',\n  'LevelService',\n  'loadedMetaDataService',\n  function ($timeout, $animate, viewState, ConfigProviderService, Drawhelperservice, HistoryService, fontScaleService, modalService, LevelService, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/level.html',\n      restrict: 'E',\n      scope: {\n        level: '=',\n        idx: '='\n      },\n      link: function postLink(scope, element, attr) {\n        // select the needed DOM items from the template\n        var canvas = element.find('canvas');\n        scope.open = attr.open;\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.modal = modalService;\n        scope.lmds = loadedMetaDataService;\n        var levelCanvasContainer = element.find('div');\n        scope.levelDef = ConfigProviderService.getLevelDefinition(scope.level.name);\n        scope.backgroundCanvas = { 'background': ConfigProviderService.design.color.lightGrey };\n        ///////////////\n        // watches\n        scope.$watch('vs.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue) {\n            scope.redraw();\n          }\n        });\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS || oldValue.windowWidth !== newValue.windowWidth) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();\n          } else {\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMouseX', function (newValue, oldValue) {\n          // only repaint if mouse over current level\n          if (scope.vs.getcurMouseLevelName() === scope.level.name) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();  //}\n          }\n        }, true);\n        //\n        scope.$watch('vs.curClickLevelName', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (scope.level.name === scope.vs.curMouseLevelName) {\n            scope.drawLevelDetails();\n          }\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('vs.movingBoundary', function () {\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('hists.movesAwayFromLastSave', function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        /////////////////\n        scope.redraw = function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.changeCurAttrDef = function (attrDefName, index) {\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if (curAttrDef !== attrDefName) {\n            // curAttrDef = attrDefName;\n            scope.vs.setCurAttrDef(scope.level.name, attrDefName, index);\n            if (!element.hasClass('emuwebapp-level-animation')) {\n              scope.vs.setEditing(false);\n              LevelService.deleteEditArea();\n              $animate.addClass(levelCanvasContainer, 'emuwebapp-level-animation').then(function () {\n                $animate.removeClass(levelCanvasContainer, 'emuwebapp-level-animation');\n                // redraw\n                scope.drawLevelDetails();\n                scope.drawLevelMarkup();\n              });\n            }\n          }\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.getAttrDefBtnColor = function (attrDefName) {\n          var curColor;\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if (attrDefName === curAttrDef) {\n            curColor = { 'background': '-webkit-radial-gradient(50% 50%, closest-corner, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 60%)' };\n          } else {\n            curColor = { 'background-color': 'white' };\n          }\n          return curColor;\n        };\n        scope.updateView = function () {\n          if ($.isEmptyObject(scope.cps)) {\n            return;\n          }\n          scope.drawLevelDetails();\n        };\n        ///////////////\n        // bindings\n        // on mouse leave reset viewState.\n        element.bind('mouseleave', function () {\n          scope.vs.setcurMouseItem(undefined, undefined, undefined);\n          scope.drawLevelMarkup();\n        });\n        /**\n\t\t\t\t * draw level details\n\t\t\t\t * @param levelDetails\n\t\t\t\t */\n        scope.drawLevelDetails = function () {\n          var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          var isOpen = element.parent().css('height') === '25px' ? false : true;\n          if ($.isEmptyObject(scope.level)) {\n            //console.log('undef levelDetails');\n            return;\n          }\n          if ($.isEmptyObject(scope.vs)) {\n            //console.log('undef viewState');\n            return;\n          }\n          if ($.isEmptyObject(scope.cps)) {\n            //console.log('undef config');\n            return;\n          }\n          var ctx = canvas[0].getContext('2d');\n          ctx.clearRect(0, 0, canvas[0].width, canvas[0].height);\n          //predef vars\n          var sDist, posS, posE, horizontalText;\n          sDist = scope.vs.getSampleDist(canvas[0].width);\n          // draw name of level and type\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          if (scope.level.name === curAttrDef) {\n            if (isOpen) {\n              fontScaleService.drawUndistortedTextTwoLines(ctx, scope.level.name, '(' + scope.level.type + ')', fontSize, ConfigProviderService.design.font.small.family, 4, ctx.canvas.height / 2 - fontSize * scaleY, ConfigProviderService.design.color.black, true);\n            } else {\n              fontSize -= 2;\n              fontScaleService.drawUndistortedText(ctx, scope.level.name, fontSize, ConfigProviderService.design.font.small.family, 4, ctx.canvas.height / 2 - fontSize * scaleY / 2, ConfigProviderService.design.color.black);\n            }\n          } else {\n            fontScaleService.drawUndistortedTextTwoLines(ctx, scope.level.name + ':' + curAttrDef, '(' + scope.level.type + ')', fontSize, ConfigProviderService.design.font.small.family, 4, ctx.canvas.height / 2 - fontSize * scaleY, ConfigProviderService.design.color.black, true);\n          }\n          var segMId = scope.vs.getcurMouseItem();\n          var segCId = scope.vs.getcurClickItems();\n          var levelId = scope.vs.getcurClickLevelName();\n          var curID = -1;\n          // calculate generic max with of single char (m char used)\n          //var mTxtImg = fontScaleService.drawUndistortedText(ctx, 'm', fontSize - 2, ConfigProviderService.design.font.small.family, ConfigProviderService.design.color.black);\n          var mTxtImgWidth = ctx.measureText('m').width * fontScaleService.scaleX;\n          // calculate generic max with of single digit (0 digit used)\n          //var zeroTxtImg = fontScaleService.drawUndistortedText(ctx, '0', fontSize - 4, ConfigProviderService.design.font.small.family, ConfigProviderService.design.color.black);\n          var zeroTxtImgWidth = ctx.measureText('0').width * fontScaleService.scaleX;\n          if (scope.level.type === 'SEGMENT') {\n            ctx.fillStyle = ConfigProviderService.design.color.black;\n            // draw segments\n            var e = scope.level.items;\n            e.forEach(function (curEvt) {\n              ++curID;\n              if (curEvt.sampleStart >= scope.vs.curViewPort.sS && curEvt.sampleStart <= scope.vs.curViewPort.eS || curEvt.sampleStart + curEvt.sampleDur > scope.vs.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur < scope.vs.curViewPort.eS || curEvt.sampleStart < scope.vs.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur > scope.vs.curViewPort.eS) {\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                // draw segment start\n                posS = scope.vs.getPos(canvas[0].width, curEvt.sampleStart);\n                posE = scope.vs.getPos(canvas[0].width, curEvt.sampleStart + curEvt.sampleDur + 1);\n                ctx.fillStyle = ConfigProviderService.design.color.black;\n                ctx.fillRect(posS, 0, 2, canvas[0].height / 2);\n                //draw segment end\n                ctx.fillStyle = ConfigProviderService.design.color.grey;\n                ctx.fillRect(posE, canvas[0].height / 2, 2, canvas[0].height);\n                ctx.font = fontSize - 2 + 'px' + ' ' + ConfigProviderService.design.font.small.family;\n                //check for enough space to stroke text\n                if (curLabVal !== undefined && posE - posS > mTxtImgWidth * curLabVal.length) {\n                  if (isOpen) {\n                    fontScaleService.drawUndistortedText(ctx, curLabVal, fontSize - 2, ConfigProviderService.design.font.small.family, posS + (posE - posS) / 2 - ctx.measureText(curLabVal).width / 2, canvas[0].height / 2 - (fontSize - 2), ConfigProviderService.design.color.black);\n                  } else {\n                    fontScaleService.drawUndistortedText(ctx, curLabVal, fontSize - 2, ConfigProviderService.design.font.small.family, posS + (posE - posS) / 2 - ctx.measureText(curLabVal).width / 2, canvas[0].height / 2 - fontSize, ConfigProviderService.design.color.black);\n                  }\n                }\n                //draw helper lines\n                if (scope.open && curLabVal !== undefined && curLabVal.length !== 0) {\n                  // only draw if label is not empty\n                  var labelCenter = posS + (posE - posS) / 2;\n                  var hlY = canvas[0].height / 4;\n                  // start helper line\n                  ctx.strokeStyle = ConfigProviderService.design.color.black;\n                  ctx.beginPath();\n                  ctx.moveTo(posS, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY + 5);\n                  ctx.stroke();\n                  hlY = canvas[0].height / 4 * 3;\n                  // end helper line\n                  ctx.strokeStyle = ConfigProviderService.design.color.grey;\n                  ctx.beginPath();\n                  ctx.moveTo(posE, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY - 5);\n                  ctx.stroke();\n                }\n                // draw sampleStart numbers\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * curEvt.sampleStart.toString().length && isOpen) {\n                  fontScaleService.drawUndistortedText(ctx, curEvt.sampleStart, fontSize - 2, ConfigProviderService.design.font.small.family, posS + 3, 0, ConfigProviderService.design.color.grey);\n                }\n                // draw sampleDur numbers.\n                var durtext = 'dur: ' + curEvt.sampleDur + ' ';\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * durtext.length && isOpen) {\n                  fontScaleService.drawUndistortedText(ctx, durtext, fontSize - 2, ConfigProviderService.design.font.small.family, posE - ctx.measureText(durtext).width * fontScaleService.scaleX, canvas[0].height / 4 * 3, ConfigProviderService.design.color.grey);\n                }\n              }\n            });\n          } else if (scope.level.type === 'EVENT') {\n            ctx.fillStyle = ConfigProviderService.design.color.black;\n            // predef. vars\n            var perc;\n            scope.level.items.forEach(function (curEvt) {\n              if (curEvt.samplePoint > scope.vs.curViewPort.sS && curEvt.samplePoint < scope.vs.curViewPort.eS) {\n                perc = Math.round(scope.vs.getPos(canvas[0].width, curEvt.samplePoint) + sDist / 2);\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                ctx.fillStyle = ConfigProviderService.design.color.black;\n                ctx.fillRect(perc, 0, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                ctx.fillRect(perc, canvas[0].height / 2 + canvas[0].height / 10, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                fontScaleService.drawUndistortedText(ctx, curLabVal, fontSize - 2, ConfigProviderService.design.font.small.family, perc - 5, canvas[0].height / 3, ConfigProviderService.design.color.black);\n                if (isOpen) {\n                  fontScaleService.drawUndistortedText(ctx, curEvt.samplePoint, fontSize - 2, ConfigProviderService.design.font.small.family, perc + 5, 0, ConfigProviderService.design.color.grey);\n                }\n              }\n            });\n          }  // draw cursor/selected area\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawLevelMarkup = function () {\n          var ctx = canvas[1].getContext('2d');\n          ctx.clearRect(0, 0, canvas[1].width, canvas[1].height);\n          if (scope.level.name === scope.vs.getcurClickLevelName()) {\n            ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n            ctx.fillRect(0, 0, canvas[0].width, canvas[0].height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx);\n          var posS, posE, sDist, xOffset, curEvt;\n          posS = scope.vs.getPos(canvas[1].width, scope.vs.curViewPort.selectS);\n          posE = scope.vs.getPos(canvas[1].width, scope.vs.curViewPort.selectE);\n          sDist = scope.vs.getSampleDist(canvas[1].width);\n          var segMId = scope.vs.getcurMouseItem();\n          var isFirst = scope.vs.getcurMouseisFirst();\n          var isLast = scope.vs.getcurMouseisLast();\n          var clickedSegs = scope.vs.getcurClickItems();\n          var levelId = scope.vs.getcurClickLevelName();\n          if (clickedSegs !== undefined) {\n            // draw clicked on selected areas\n            if (scope.level.name === levelId && clickedSegs.length > 0) {\n              clickedSegs.forEach(function (cs) {\n                if (cs !== undefined) {\n                  // check if segment or event level\n                  if (cs.sampleStart !== undefined) {\n                    posS = Math.round(scope.vs.getPos(canvas[0].width, cs.sampleStart));\n                    posE = Math.round(scope.vs.getPos(canvas[0].width, cs.sampleStart + cs.sampleDur + 1));\n                  } else {\n                    posS = Math.round(scope.vs.getPos(canvas[0].width, cs.samplePoint) + sDist / 2);\n                    posS = posS - 5;\n                    posE = posS + 10;\n                  }\n                  ctx.fillStyle = ConfigProviderService.design.color.transparent.yellow;\n                  ctx.fillRect(posS, 0, posE - posS, canvas[0].height);\n                  ctx.fillStyle = ConfigProviderService.design.color.black;\n                }\n              });\n            }\n          }\n          // draw preselected boundary\n          curEvt = scope.vs.getcurMouseItem();\n          if (scope.level.items.length > 0 && curEvt !== undefined && segMId !== undefined && scope.level.name === scope.vs.getcurMouseLevelName()) {\n            ctx.fillStyle = ConfigProviderService.design.color.blue;\n            if (isFirst === true) {\n              // before first segment\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = scope.level.items[0];\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else if (isLast === true) {\n              // after last segment\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = scope.level.items[scope.level.items.length - 1];\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart + curEvt.sampleDur + 1));\n                // +1 because boundaries are drawn on sampleStart\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else {\n              // in the middle\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              } else {\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.samplePoint));\n                xOffset = sDist / 2;\n                ctx.fillRect(posS + xOffset, 0, 3, canvas[1].height);\n              }\n            }\n            ctx.fillStyle = ConfigProviderService.design.color.black;\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('osci', [\n  '$timeout',\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'loadedMetaDataService',\n  function ($timeout, viewState, Soundhandlerservice, ConfigProviderService, Drawhelperservice, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/osci.html',\n      replace: true,\n      restrict: 'E',\n      scope: {},\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.changeAttrDef = function () {\n          };\n        }\n      ],\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // assign attributes to scope\n        scope.order = attrs.order;\n        scope.trackName = attrs.trackName;\n        scope.cps = ConfigProviderService;\n        scope.viewState = viewState;\n        scope.lmds = loadedMetaDataService;\n        ///////////////\n        // watches\n        //\n        scope.$watch('viewState.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue) {\n            scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n          }\n        });\n        //\n        scope.$watch('viewState.timelineSize', function () {\n          $timeout(scope.redraw, ConfigProviderService.design.animation.duration);\n        });\n        //\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n        }, true);\n        //\n        scope.$watch('viewState.playHeadAnimationInfos', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawPlayHead(scope, ConfigProviderService);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundarySample', function (newValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundary', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n                Drawhelperservice.osciPeaks = allPeakVals;\n                Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n              }\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n          }\n        }, true);\n        //\n        /////////////////////////\n        scope.redraw = function () {\n          scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPlayHead = function (scope, config) {\n          var ctx = markupCanvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          var posS = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.sS);\n          var posCur = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.curS);\n          ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n          ctx.fillRect(posS, 0, posCur - posS, canvas.height);\n          scope.drawVpOsciMarkup(scope, config, false);\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (scope, config, reset) {\n          var ctx = markupCanvas.getContext('2d');\n          if (reset) {\n            ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          Drawhelperservice.drawViewPortTimes(ctx, true);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx, true);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('preview', [\n  'viewState',\n  'Soundhandlerservice',\n  'Drawhelperservice',\n  'ConfigProviderService',\n  function (viewState, Soundhandlerservice, Drawhelperservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/preview.html',\n      restrict: 'E',\n      scope: { currentBundleName: '@' },\n      link: function postLink(scope, element) {\n        // select the needed DOM elements from the template and init vals\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[1];\n        var initialized = false;\n        // hook up scope vars for watches\n        scope.vs = viewState;\n        scope.shs = Soundhandlerservice;\n        scope.backgroundCanvas = {\n          'background': '#eee',\n          'border': '1px solid gray',\n          'width': '100%',\n          'height': '100%'\n        };\n        /////////////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newVal, oldVal) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            if (oldVal.sS !== newVal.sS || oldVal.eS !== newVal.eS) {\n              scope.drawPreview();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('currentBundleName', function () {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            initialized = false;\n            scope.backgroundCanvas = {\n              'background': ConfigProviderService.design.color.lightGrey,\n              'border': '1px solid gray',\n              'width': '100%',\n              'height': '100%'\n            };\n            scope.drawPreview();\n          }\n          //clear on empty bundle name\n          if (scope.currentBundleName === '') {\n            var ctx = canvas.getContext('2d');\n            var ctxMarkup = markupCanvas.getContext('2d');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctxMarkup.clearRect(0, 0, canvas.width, canvas.height);\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPreview = function () {\n          if (!initialized) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n            initialized = true;\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          } else {\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          }\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (vs, canvas, config) {\n          var ctx = markupCanvas.getContext('2d');\n          var posS = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.sS;\n          var posE = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.eS;\n          ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n          ctx.fillRect(posS, 0, posE - posS, markupCanvas.height);\n          ctx.strokeStyle = ConfigProviderService.design.color.transparent.black;\n          ctx.beginPath();\n          ctx.moveTo(posS, 0);\n          ctx.lineTo(posS, markupCanvas.height);\n          ctx.moveTo(posE, 0);\n          ctx.lineTo(posE, markupCanvas.height);\n          ctx.closePath();\n          ctx.stroke();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('bundleListSideBar', function () {\n  return {\n    templateUrl: 'views/bundleListSideBar.html',\n    restrict: 'E',\n    replace: true,\n    scope: {},\n    link: function postLink(scope, element, attr) {\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('spectro', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  'mathHelperService',\n  'loadedMetaDataService',\n  function ($timeout, viewState, ConfigProviderService, Drawhelperservice, fontScaleService, Soundhandlerservice, mathHelperService, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/spectro.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.shs = Soundhandlerservice;\n        scope.order = attrs.order;\n        scope.vs = viewState;\n        scope.cps = ConfigProviderService;\n        scope.dhs = Drawhelperservice;\n        scope.lmds = loadedMetaDataService;\n        scope.trackName = attrs.trackName;\n        // select the needed DOM elements from the template\n        scope.canvas0 = element.find('canvas')[0];\n        scope.canvas1 = element.find('canvas')[element.find('canvas').length - 1];\n        scope.context = scope.canvas0.getContext('2d');\n        scope.markupCtx = scope.canvas1.getContext('2d');\n        // FFT default vars\n        // default alpha for Window Function\n        scope.alpha = 0.16;\n        scope.devicePixelRatio = window.devicePixelRatio || 1;\n        // Spectro Worker\n        scope.primeWorker = new spectroDrawingWorker();\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.timelineSize', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.clearAndDrawSpectMarkup, ConfigProviderService.design.animation.duration);\n            }\n          }\n        });\n        //\n        scope.$watch('viewState.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue && !$.isEmptyObject(scope.shs) && !$.isEmptyObject(scope.shs.wavJSO)) {\n            scope.clearAndDrawSpectMarkup();\n          }\n        });\n        scope.$watch('vs.submenuOpen', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.clearAndDrawSpectMarkup, ConfigProviderService.design.animation.duration);\n            }\n          }\n        });\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                scope.redraw();\n              }\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // scope.redraw();\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.spectroSettings', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.setupEvent();\n              scope.redraw();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n                scope.redraw();\n              }\n            }\n          }\n        }, true);\n        ///////////////\n        // bindings\n        scope.redraw = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectro(scope.shs.wavJSO.Data);\n        };\n        scope.drawSpectro = function (buffer) {\n          scope.killSpectroRenderingThread();\n          scope.startSpectroRenderingThread(buffer);\n        };\n        scope.calcSamplesPerPxl = function () {\n          return (scope.vs.curViewPort.eS + 1 - scope.vs.curViewPort.sS) / scope.canvas0.width;\n        };\n        scope.clearAndDrawSpectMarkup = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectMarkup();\n        };\n        scope.drawSpectMarkup = function () {\n          // draw moving boundary line if moving\n          scope.dhs.drawMovingBoundaryLine(scope.markupCtx);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          // draw min max vals and name of track\n          scope.dhs.drawMinMaxAndName(scope.markupCtx, '', scope.vs.spectroSettings.rangeFrom, scope.vs.spectroSettings.rangeTo, 2);\n        };\n        scope.killSpectroRenderingThread = function () {\n          scope.context.fillStyle = ConfigProviderService.design.color.lightGrey;\n          scope.context.fillRect(0, 0, scope.canvas0.width, scope.canvas0.height);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          fontScaleService.drawUndistortedText(scope.context, 'rendering...', ConfigProviderService.design.font.small.size.slice(0, -2) * 0.75, ConfigProviderService.design.font.small.family, 10, 50, ConfigProviderService.design.color.black, true);\n          if (scope.primeWorker !== null) {\n            scope.primeWorker.kill();\n            scope.primeWorker = null;\n          }\n        };\n        scope.setupEvent = function () {\n          var imageData = scope.context.createImageData(scope.canvas0.width, scope.canvas0.height);\n          scope.primeWorker.says(function (event) {\n            if (event.status === undefined) {\n              if (scope.calcSamplesPerPxl() === event.samplesPerPxl) {\n                var tmp = new Uint8ClampedArray(event.img);\n                imageData.data.set(tmp);\n                scope.context.putImageData(imageData, 0, 0);\n                scope.drawSpectMarkup();\n              }\n            } else {\n              console.error('Error rendering spectrogram:', event.status.message);\n            }\n          });\n        };\n        scope.startSpectroRenderingThread = function (buffer) {\n          if (buffer.length > 0) {\n            scope.primeWorker = new spectroDrawingWorker();\n            var parseData = [];\n            var fftN = mathHelperService.calcClosestPowerOf2Gt(scope.shs.wavJSO.SampleRate * scope.vs.spectroSettings.windowSizeInSecs);\n            // fftN must be greater than 512 (leads to better resolution of spectrogram)\n            if (fftN < 512) {\n              fftN = 512;\n            }\n            // extract relavant data\n            parseData = buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS);\n            var leftPadding = [];\n            var rightPadding = [];\n            // check if any zero padding at LEFT edge is necessary\n            var windowSizeInSamples = scope.shs.wavJSO.SampleRate * scope.vs.spectroSettings.windowSizeInSecs;\n            if (scope.vs.curViewPort.sS < windowSizeInSamples / 2) {\n            } else {\n              leftPadding = buffer.subarray(scope.vs.curViewPort.sS - windowSizeInSamples / 2, scope.vs.curViewPort.sS);\n            }\n            // check if zero padding at RIGHT edge is necessary\n            if (scope.vs.curViewPort.eS + fftN / 2 - 1 >= scope.shs.wavJSO.Data.length) {\n            } else {\n              rightPadding = buffer.subarray(scope.vs.curViewPort.eS, scope.vs.curViewPort.eS + fftN / 2 - 1);\n            }\n            // add padding\n            var paddedSamples = new Float32Array(leftPadding.length + parseData.length + rightPadding.length);\n            paddedSamples.set(leftPadding);\n            paddedSamples.set(parseData, leftPadding.length);\n            paddedSamples.set(rightPadding, leftPadding.length + parseData.length);\n            if (scope.vs.curViewPort.sS >= fftN / 2) {\n              // pass in half a window extra at the front and a full window extra at the back so everything can be drawn/calculated this also fixes alignment issue\n              parseData = buffer.subarray(scope.vs.curViewPort.sS - fftN / 2, scope.vs.curViewPort.eS + fftN);\n            } else {\n              // tolerate window/2 alignment issue if at beginning of file\n              parseData = buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS + fftN);\n            }\n            scope.setupEvent();\n            scope.primeWorker.tell({\n              'windowSizeInSecs': scope.vs.spectroSettings.windowSizeInSecs,\n              'fftN': fftN,\n              'alpha': scope.alpha,\n              'upperFreq': scope.vs.spectroSettings.rangeTo,\n              'lowerFreq': scope.vs.spectroSettings.rangeFrom,\n              'samplesPerPxl': scope.calcSamplesPerPxl(),\n              'window': scope.vs.spectroSettings.window,\n              'imgWidth': scope.canvas0.width,\n              'imgHeight': scope.canvas0.height,\n              'dynRangeInDB': scope.vs.spectroSettings.dynamicRange,\n              'pixelRatio': scope.devicePixelRatio,\n              'sampleRate': scope.shs.wavJSO.SampleRate,\n              'transparency': scope.cps.vals.spectrogramSettings.transparency,\n              'audioBuffer': paddedSamples,\n              'audioBufferChannels': scope.shs.wavJSO.NumChannels,\n              'drawHeatMapColors': scope.vs.spectroSettings.drawHeatMapColors,\n              'preEmphasisFilterFactor': scope.vs.spectroSettings.preEmphasisFilterFactor,\n              'heatMapColorAnchors': scope.vs.spectroSettings.heatMapColorAnchors\n            }, [paddedSamples.buffer]);\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ExportCtrl', [\n  '$scope',\n  'modalService',\n  'browserDetector',\n  'viewState',\n  'HistoryService',\n  function ($scope, modalService, browserDetector, viewState, HistoryService) {\n    $scope.firefox = browserDetector.isBrowser.Firefox();\n    /**\n\t\t *\n\t\t */\n    $scope.getBlob = function () {\n      var blob;\n      try {\n        blob = new Blob([modalService.dataExport], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append($scope.exportData);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.updateHistoryService = function () {\n      HistoryService.movesAwayFromLastSave = 0;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.export = function () {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL($scope.getBlob());\n      } else {\n        objURL = URL.createObjectURL($scope.getBlob());\n      }\n      $scope.SaveToDisk(objURL, modalService.dataIn);\n      modalService.close();\n    };\n    /**\n\t\t *  Save file to disk // Non-IE ONLY !!\n\t\t */\n    $scope.SaveToDisk = function (fileURL, fileName) {\n      var save = document.createElement('a');\n      if ($scope.firefox) {\n        save.setAttribute('download', fileName);\n        save.href = fileURL;\n        save.innerHTML = '';\n        save.style.display = 'none';\n        document.body.appendChild(save);\n        save.click();\n      } else {\n        save.href = fileURL;\n        save.target = '_blank';\n        save.download = fileName || 'unknown';\n        var event = document.createEvent('Event');\n        event.initEvent('click', true, true);\n        save.dispatchEvent(event);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n      }\n      $scope.updateHistoryService();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('viewState', [\n  '$rootScope',\n  '$timeout',\n  '$window',\n  'Soundhandlerservice',\n  'DataService',\n  'StandardFuncsService',\n  function ($rootScope, $timeout, $window, Soundhandlerservice, DataService, StandardFuncsService) {\n    //shared service object to be returned\n    var sServObj = {};\n    // window functions enum for spectro\n    var myWindow = {\n        BARTLETT: 1,\n        BARTLETTHANN: 2,\n        BLACKMAN: 3,\n        COSINE: 4,\n        GAUSS: 5,\n        HAMMING: 6,\n        HANN: 7,\n        LANCZOS: 8,\n        RECTANGULAR: 9,\n        TRIANGULAR: 10\n      };\n    // hold the current attribute definitions that are in view\n    sServObj.curLevelAttrDefs = [];\n    /**\n     * initialize all needed vars in viewState\n     */\n    sServObj.initialize = function () {\n      sServObj.curViewPort = {\n        sS: 0,\n        eS: 0,\n        selectS: -1,\n        selectE: -1,\n        movingS: -1,\n        movingE: -1,\n        dragBarActive: false,\n        dragBarHeight: -1,\n        windowWidth: undefined\n      };\n      sServObj.spectroSettings = {\n        windowSizeInSecs: -1,\n        rangeFrom: -1,\n        rangeTo: -1,\n        dynamicRange: -1,\n        window: -1,\n        drawHeatMapColors: -1,\n        preEmphasisFilterFactor: -1\n      };\n      sServObj.playHeadAnimationInfos = {\n        sS: -1,\n        eS: -1,\n        curS: null,\n        endFreezeSample: -1\n      };\n      //\n      sServObj.hierarchyState = {\n        selectedItemID: undefined,\n        selectedLinkFromID: undefined,\n        selectedLinkToID: undefined,\n        editValue: undefined,\n        inputFocus: false,\n        collapseInfo: {},\n        contextMenuID: undefined,\n        newLinkFromID: undefined,\n        path: [],\n        rotated: false,\n        playing: 0\n      };\n      sServObj.timelineSize = -1;\n      sServObj.somethingInProgress = false;\n      sServObj.somethingInProgressTxt = '';\n      sServObj.historyActionTxt = '';\n      sServObj.editing = false;\n      sServObj.cursorInTextField = false;\n      sServObj.saving = true;\n      sServObj.hierarchyShown = false;\n      sServObj.submenuOpen = false;\n      sServObj.rightSubmenuOpen = false;\n      sServObj.curClickItems = [];\n      sServObj.curMousePosSample = 0;\n      sServObj.curMouseLevelName = undefined;\n      sServObj.curMouseLevelType = undefined;\n      sServObj.curClickLevelName = undefined;\n      sServObj.curClickLevelType = undefined;\n      sServObj.lastPcm = undefined;\n      sServObj.curPreselColumnSample = 2;\n      sServObj.curCorrectionToolNr = undefined;\n      sServObj.curClickLevelIndex = undefined;\n      sServObj.start = null;\n      sServObj.TransitionTime = undefined;\n      sServObj.showDropZone = true;\n      sServObj.movingBoundary = false;\n      sServObj.movingBoundarySample = undefined;\n      sServObj.focusInTextField = false;\n      sServObj.curTaskPercCompl = 0;\n      sServObj.curPerspectiveIdx = -1;\n      sServObj.mouseInEmuWebApp = false;\n      sServObj.lastKeyCode = undefined;\n      sServObj.lastUpdate = undefined;\n      // possible general states of state machine\n      sServObj.states = [];\n      sServObj.states.noDBorFilesloaded = {\n        'permittedActions': [\n          'connectBtnClick',\n          'openDemoBtnDBclick'\n        ]\n      };\n      sServObj.states.loadingSaving = { 'permittedActions': [] };\n      sServObj.states.labeling = {\n        'permittedActions': [\n          'zoom',\n          'playaudio',\n          'spectSettingsChange',\n          'addLevelSegBtnClick',\n          'addLevelPointBtnClick',\n          'renameSelLevelBtnClick',\n          'downloadTextGridBtnClick',\n          'downloadAnnotationBtnClick',\n          'spectSettingsChange',\n          'clearBtnClick',\n          'labelAction',\n          'toggleSideBars',\n          'saveBndlBtnClick',\n          'showHierarchyBtnClick',\n          'editDBconfigBtnClick'\n        ]\n      };\n      sServObj.states.modalShowing = sServObj.states.loadingSaving;\n      sServObj.prevState = sServObj.states.noDBorFilesloaded;\n      sServObj.curState = sServObj.states.noDBorFilesloaded;\n      sServObj.curLevelAttrDefs = [];\n    };\n    // initialize on init\n    sServObj.initialize();\n    /**\n     * function to ask permission in current labeler state\n     */\n    sServObj.getPermission = function (actionName) {\n      return sServObj.curState.permittedActions.indexOf(actionName) > -1;\n    };\n    /**\n     *\n     */\n    sServObj.setWindowWidth = function (b) {\n      this.curViewPort.windowWidth = b;\n    };\n    /**\n     * set state\n     */\n    sServObj.setState = function (nameOrObj) {\n      sServObj.prevState = sServObj.curState;\n      if (typeof nameOrObj === 'string') {\n        sServObj.curState = sServObj.states[nameOrObj];\n      } else {\n        sServObj.curState = nameOrObj;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.updatePlayHead = function (timestamp) {\n      // at first push animation !!!\n      if (Soundhandlerservice.isPlaying) {\n        $window.requestAnimationFrame(sServObj.updatePlayHead);\n      }\n      // do work in this animation round now\n      if (sServObj.start === null) {\n        sServObj.start = timestamp;\n      }\n      var samplesPassed = Math.floor(timestamp - sServObj.start) / 1000 * Soundhandlerservice.wavJSO.SampleRate;\n      sServObj.playHeadAnimationInfos.curS = Math.floor(sServObj.playHeadAnimationInfos.sS + samplesPassed);\n      if (Soundhandlerservice.isPlaying && sServObj.playHeadAnimationInfos.curS <= sServObj.playHeadAnimationInfos.eS) {\n        if (sServObj.playHeadAnimationInfos.curS !== -1) {\n          sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.curS;\n        }\n        $rootScope.$apply();\n      } else {\n        sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.endFreezeSample;\n        sServObj.playHeadAnimationInfos.sS = -1;\n        sServObj.playHeadAnimationInfos.eS = -1;\n        sServObj.playHeadAnimationInfos.curS = 0;\n        sServObj.start = null;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.animatePlayHead = function (startS, endS) {\n      sServObj.playHeadAnimationInfos.sS = startS;\n      sServObj.playHeadAnimationInfos.eS = endS;\n      sServObj.playHeadAnimationInfos.endFreezeSample = endS;\n      sServObj.playHeadAnimationInfos.curS = startS;\n      $window.requestAnimationFrame(sServObj.updatePlayHead);\n    };\n    /**\n     * set selected Area\n     * @param start of selected Area\n     * @param end of selected Area\n     */\n    sServObj.select = function (start, end) {\n      sServObj.curViewPort.selectS = start;\n      sServObj.curViewPort.selectE = end;  //$rootScope.$digest();\n    };\n    /**\n     * reset selected Area to default\n     * @param length of current pcm stream\n     */\n    sServObj.resetSelect = function () {\n      sServObj.curViewPort.selectS = -1;\n      sServObj.curViewPort.selectE = -1;\n    };\n    /**\n     * gets the current Viewport\n     */\n    sServObj.getViewPort = function () {\n      return sServObj.curViewPort;\n    };\n    /**\n     * setspectroSettings\n     */\n    sServObj.setspectroSettings = function (len, rfrom, rto, dyn, win, hm, preEmph, hmColorAnchors) {\n      sServObj.spectroSettings.windowSizeInSecs = len;\n      sServObj.spectroSettings.rangeFrom = parseInt(rfrom, 10);\n      sServObj.spectroSettings.rangeTo = parseInt(rto, 10);\n      sServObj.spectroSettings.dynamicRange = parseInt(dyn, 10);\n      sServObj.setWindowFunction(win);\n      sServObj.spectroSettings.drawHeatMapColors = hm;\n      sServObj.spectroSettings.preEmphasisFilterFactor = preEmph;\n      sServObj.spectroSettings.heatMapColorAnchors = hmColorAnchors;\n    };\n    /**\n     * returns current selection as array\n     */\n    sServObj.getSelect = function () {\n      return [\n        sServObj.curViewPort.selectS,\n        sServObj.curViewPort.selectE\n      ];\n    };\n    /**\n     * set selected Area if new\n     * start value is smaler than actual and\n     * end value is greater than actual\n     * @param start of selected Area\n     * @param end of seleected Area\n     */\n    sServObj.selectDependent = function (start, end) {\n      if (start < this.curViewPort.selectS) {\n        this.curViewPort.selectS = start;\n      }\n      if (end > this.curViewPort.selectE) {\n        this.curViewPort.selectE = end;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.selectLevel = function (next, order, Levelserv) {\n      var curLev;\n      var now = sServObj.getcurClickLevelName();\n      if (now === undefined) {\n        if (!next) {\n          // select first if none prev. defined (up)\n          // viewState.setcurClickLevel(levelID, levelType, scope.$index, scope.this.level.items.length);\n          curLev = Levelserv.getLevelDetails(order[0]);\n          sServObj.setcurClickLevel(curLev.name, curLev.type, 0);\n          return;\n        } else {\n          // select last if none prev. defined (down)\n          curLev = Levelserv.getLevelDetails(order[order.length - 1]);\n          sServObj.setcurClickLevel(curLev.name, curLev.type, order.length - 1);\n          return;\n        }\n      }\n      var idxOfNow;\n      order.forEach(function (name, idx) {\n        if (name === now) {\n          idxOfNow = idx;\n        }\n      });\n      if (idxOfNow === undefined) {\n        curLev = Levelserv.getLevelDetails(order[0]);\n        sServObj.setcurClickLevel(curLev.name, curLev.type, 0);\n        sServObj.curClickItems = [];\n        sServObj.selectBoundary();\n      } else {\n        if (next) {\n          if (idxOfNow + 1 < order.length) {\n            curLev = Levelserv.getLevelDetails(order[idxOfNow + 1]);\n            // sServObj.setcurClickLevelName(order[idxOfNow + 1]);\n            sServObj.setcurClickLevel(curLev.name, curLev.type, order.idxOfNow + 1);\n            sServObj.curClickItems = [];\n            sServObj.selectBoundary();  //sServObj.resetSelect();\n          }\n        } else {\n          if (idxOfNow - 1 >= 0) {\n            curLev = Levelserv.getLevelDetails(order[idxOfNow - 1]);\n            // sServObj.setcurClickLevelName(order[idxOfNow - 1]);\n            sServObj.setcurClickLevel(curLev.name, curLev.type, order.idxOfNow - 1);\n            sServObj.curClickItems = [];\n            sServObj.selectBoundary();  //sServObj.resetSelect();\n          }\n        }\n      }\n    };\n    /**\n     * set the window Function for the Spectrogram\n     * @param name of Window Function\n     */\n    sServObj.setWindowFunction = function (name) {\n      switch (name) {\n      case 'BARTLETT':\n        sServObj.spectroSettings.window = myWindow.BARTLETT;\n        break;\n      case 'BARTLETTHANN':\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      case 'BLACKMAN':\n        sServObj.spectroSettings.window = myWindow.BLACKMAN;\n        break;\n      case 'COSINE':\n        sServObj.spectroSettings.window = myWindow.COSINE;\n        break;\n      case 'GAUSS':\n        sServObj.spectroSettings.window = myWindow.GAUSS;\n        break;\n      case 'HAMMING':\n        sServObj.spectroSettings.window = myWindow.HAMMING;\n        break;\n      case 'HANN':\n        sServObj.spectroSettings.window = myWindow.HANN;\n        break;\n      case 'LANCZOS':\n        sServObj.spectroSettings.window = myWindow.LANCZOS;\n        break;\n      case 'RECTANGULAR':\n        sServObj.spectroSettings.window = myWindow.RECTANGULAR;\n        break;\n      case 'TRIANGULAR':\n        sServObj.spectroSettings.window = myWindow.TRIANGULAR;\n        break;\n      default:\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      }\n    };\n    /**\n     * @returns myWindow object\n     */\n    sServObj.getWindowFunctions = function () {\n      return myWindow;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarActive = function () {\n      return this.curViewPort.dragBarActive;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarActive = function (b) {\n      this.curViewPort.dragBarActive = b;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarHeight = function () {\n      return this.curViewPort.dragBarHeight;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarHeight = function (b) {\n      this.curViewPort.dragBarHeight = b;\n    };\n    /**\n     * get pixel position in current viewport given the canvas width\n     * @param w is width of canvas\n     * @param s is current sample to convert to pixel value\n     */\n    sServObj.getPos = function (w, s) {\n      return w * (s - this.curViewPort.sS) / (this.curViewPort.eS - this.curViewPort.sS + 1);  // + 1 because of view (displays all samples in view)\n    };\n    /**\n     * calculate the pixel distance between two samples\n     * @param w is width of canvas\n     */\n    sServObj.getSampleDist = function (w) {\n      return this.getPos(w, this.curViewPort.sS + 1) - this.getPos(w, this.curViewPort.sS);\n    };\n    /**\n     * toggle boolean if left submenu is open\n     */\n    sServObj.toggleSubmenu = function (time) {\n      this.submenuOpen = !this.submenuOpen;\n      $timeout(function () {\n        var d = new Date();\n        sServObj.lastUpdate = d.getTime();\n      }, time);\n    };\n    /**\n     * get boolean if left submenu is open\n     */\n    sServObj.getsubmenuOpen = function () {\n      return this.submenuOpen;\n    };\n    /**\n     * set boolean if left submenu is open\n     */\n    sServObj.setsubmenuOpen = function (s) {\n      this.submenuOpen = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setenlarge = function (s) {\n      this.timelineSize = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getenlarge = function () {\n      return this.timelineSize;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getTransitionTime = function () {\n      return this.TransitionTime;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setTransitionTime = function (s) {\n      this.TransitionTime = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getRightsubmenuOpen = function () {\n      return this.rightSubmenuOpen;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setRightsubmenuOpen = function (s) {\n      this.rightSubmenuOpen = s;\n    };\n    /**\n     *\n     */\n    sServObj.setcurClickLevel = function (levelID, levelType, levelIndex) {\n      sServObj.setcurClickLevelName(levelID, levelIndex);\n      sServObj.setcurClickLevelType(levelType);\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelType = function (name) {\n      this.curClickLevelType = name;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelType = function () {\n      return this.curClickLevelType;\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelName = function (name, index) {\n      this.curClickLevelName = name;\n      this.curClickLevelIndex = index;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelName = function () {\n      return this.curClickLevelName;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelIndex = function () {\n      return this.curClickLevelIndex;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickNeighbours = function () {\n      return this.curClickNeighbours;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelName = function (name) {\n      this.curMouseLevelName = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelName = function () {\n      return this.curMouseLevelName;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelType = function (name) {\n      this.curMouseLevelType = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelType = function () {\n      return this.curMouseLevelType;\n    };\n    /**\n     * sets the current (mousemove) Item\n     * @param item Object representing the current mouse item\n     * @param neighbour Objects of left and right neighbours of the current mouse item\n     * @param x current horizontal mouse pointer position\n     * @param isFirst true if item is the first item on current level\n     * @param isLast true if item is last item on current level\n     */\n    sServObj.setcurMouseItem = function (item, neighbour, x, isFirst, isLast) {\n      this.curMouseItem = item;\n      this.curMouseX = x;\n      this.curMouseNeighbours = neighbour;\n      this.curMouseisFirst = isFirst;\n      this.curMouseisLast = isLast;\n    };\n    /**\n     * Getter for current Mouse Item\n     * @return Object representing the current mouse item\n     */\n    sServObj.getcurMouseItem = function () {\n      return this.curMouseItem;\n    };\n    /**\n     * Getter for isFirst\n     * @return true if item is first item on level\n     */\n    sServObj.getcurMouseisFirst = function () {\n      return this.curMouseisFirst;\n    };\n    /**\n     * Getter for isLast\n     * @return true if item is last item on level\n     */\n    sServObj.getcurMouseisLast = function () {\n      return this.curMouseisLast;\n    };\n    /**\n     * Getter for current Mouse Item Neighbours (left and right)\n     * @return Object representing the current mouse item neighbours\n     */\n    sServObj.getcurMouseNeighbours = function () {\n      return this.curMouseNeighbours;\n    };\n    /**\n     * get all items of current level which are inside the selected viewport\n     */\n    sServObj.getItemsInSelection = function (levelData) {\n      var itemsInRange = [];\n      var rangeStart = sServObj.curViewPort.selectS;\n      var rangeEnd = sServObj.curViewPort.selectE;\n      angular.forEach(levelData, function (t) {\n        if (t.name === sServObj.getcurClickLevelName()) {\n          angular.forEach(t.items, function (item) {\n            if (item.sampleStart >= rangeStart && item.sampleStart + item.sampleDur <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n            if (item.samplePoint >= rangeStart && item.samplePoint <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n          });\n        }\n      });\n      return itemsInRange.sort(sServObj.sortbystart);\n    };\n    /**\n     * Setter for the current (click) Item\n     * @param item Object representing the currently clicked item\n     */\n    sServObj.setcurClickItem = function (item) {\n      if (item !== null && item !== undefined) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n        sServObj.selectBoundary();\n      } else {\n        sServObj.curClickItems = [];\n      }\n    };\n    /**\n     * Selects the current Boundary\n     */\n    sServObj.selectBoundary = function () {\n      if (sServObj.curClickItems.length > 0) {\n        var left = sServObj.curClickItems[0].sampleStart || sServObj.curClickItems[0].samplePoint;\n        var right = sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleStart + sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleDur || sServObj.curClickItems[0].samplePoint;\n        sServObj.curClickItems.forEach(function (entry) {\n          if (entry.sampleStart <= left) {\n            left = entry.sampleStart;\n          }\n          if (entry.sampleStart + entry.sampleDur >= right) {\n            right = entry.sampleStart + entry.sampleDur;\n          }\n        });\n        sServObj.select(left, right + 1);\n      }\n    };\n    /**\n     * adds an item to the currently selected items if the left or right one of current selected items\n     * @param item representing the Object to be added to selection\n     * @param next Object next to the Object to be added to selection\n     * @param prev Object previous of the Object to be added to selection\n     */\n    sServObj.setcurClickItemMultiple = function (item, next, prev) {\n      if (sServObj.curClickItems.length == 0 || sServObj.curClickItems === undefined || sServObj.curClickItems === null) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n      } else {\n        if (sServObj.curClickItems.indexOf(item) === -1) {\n          if (sServObj.curClickItems.indexOf(next) >= 0 || sServObj.curClickItems.indexOf(prev) >= 0) {\n            sServObj.curClickItems.push(item);\n            sServObj.curClickItems.sort(sServObj.sortbystart);\n          } else {\n            sServObj.curClickItems = [];\n            sServObj.curClickItems.push(item);\n          }\n        } else {\n          sServObj.curClickItems = [];\n          sServObj.curClickItems.push(item);\n        }\n      }\n    };\n    /**\n     *\n     */\n    sServObj.sortbystart = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.sampleStart > b.sampleStart || a.samplePoint > b.samplePoint) {\n        return 1;\n      }\n      if (a.sampleStart < b.sampleStart || a.samplePoint < b.samplePoint) {\n        return -1;\n      }\n      return 0;\n    };\n    /**\n     * Getter for the current selected range in samples\n     * if nothing is selected returns -1\n     * @return Object with Start and End values in samples\n     */\n    sServObj.getselectedRange = function () {\n      if (this.curClickItems.length > 1) {\n        return {\n          start: this.curClickItems[0].sampleStart,\n          end: this.curClickItems[this.curClickItems.length - 1].sampleStart + this.curClickItems[this.curClickItems.length - 1].sampleDur\n        };\n      } else if (this.curClickItems.length === 1) {\n        if (this.curClickItems[0].sampleStart !== undefined) {\n          return {\n            start: this.curClickItems[0].sampleStart,\n            end: this.curClickItems[0].sampleStart + this.curClickItems[0].sampleDur\n          };\n        } else {\n          return {\n            start: this.curClickItems[0].samplePoint,\n            end: this.curClickItems[0].samplePoint\n          };\n        }\n      } else {\n        return {\n          start: -1,\n          end: -1\n        };\n      }\n    };\n    /**\n     * Getter for the currently (clicked) items\n     */\n    sServObj.getcurClickItems = function () {\n      return this.curClickItems;\n    };\n    /**\n     *\n     */\n    sServObj.getselected = function () {\n      return this.curClickItems;\n    };\n    /**\n     *\n     */\n    sServObj.isEditing = function () {\n      return this.editing;\n    };\n    /**\n     *\n     */\n    sServObj.setEditing = function (n) {\n      this.editing = n;\n    };\n    /**\n     *\n     */\n    sServObj.getLasPcm = function () {\n      return this.lastPcm;\n    };\n    /**\n     *\n     */\n    sServObj.setLastPcm = function (n) {\n      this.lastPcm = n;\n    };\n    sServObj.resetHierarchyState = function () {\n      sServObj.hierarchyState.selectedItemID = undefined;\n      sServObj.hierarchyState.selectedLinkFromID = undefined;\n      sServObj.hierarchyState.selectedLinkToID = undefined;\n      sServObj.hierarchyState.editValue = undefined;\n      sServObj.hierarchyState.inputFocus = false;\n      sServObj.hierarchyState.collapseInfo = {};\n      sServObj.hierarchyState.contextMenuID = undefined;\n      sServObj.hierarchyState.newLinkFromID = undefined;\n    };\n    /**\n     *\n     */\n    sServObj.isHierarchyRotated = function () {\n      return sServObj.hierarchyState.rotated;\n    };\n    /**\n     *\n     */\n    sServObj.toggleHierarchyRotation = function () {\n      sServObj.hierarchyState.rotated = !sServObj.hierarchyState.rotated;\n    };\n    /**\n     *\n     */\n    sServObj.toggleHierarchy = function () {\n      sServObj.hierarchyShown = !sServObj.hierarchyShown;\n      if (sServObj.hierarchyShown === false) {\n        // Make sure no private attributes (such as do start with an underscore\n        // are left in the data when the hierarchy modal is closed\n        console.debug('Hierarchy modal was closed, cleaning up underscore attributes');\n        StandardFuncsService.traverseAndClean(DataService.getData());\n      }\n    };\n    sServObj.hierarchyState.contextMenuIsOpen = function () {\n      return sServObj.hierarchyState.contextMenuID !== undefined;\n    };\n    sServObj.hierarchyState.closeContextMenu = function () {\n      sServObj.hierarchyState.contextMenuID = undefined;\n    };\n    sServObj.hierarchyState.getContextMenuID = function () {\n      return sServObj.hierarchyState.contextMenuID;\n    };\n    sServObj.hierarchyState.setContextMenuID = function (id) {\n      sServObj.hierarchyState.contextMenuID = id;\n    };\n    sServObj.hierarchyState.getInputFocus = function () {\n      return sServObj.hierarchyState.inputFocus;\n    };\n    sServObj.hierarchyState.setInputFocus = function (f) {\n      sServObj.hierarchyState.inputFocus = f;\n    };\n    sServObj.hierarchyState.getEditValue = function () {\n      return sServObj.hierarchyState.editValue;\n    };\n    sServObj.hierarchyState.setEditValue = function (e) {\n      sServObj.hierarchyState.editValue = e;\n    };\n    /**\n     *\n     */\n    sServObj.getCollapsed = function (id) {\n      if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n        return false;\n      } else {\n        if (typeof sServObj.hierarchyState.collapseInfo[id].collapsed === 'boolean') {\n          return sServObj.hierarchyState.collapseInfo[id].collapsed;\n        } else {\n          return false;\n        }\n      }\n    };\n    /**\n     *\n     */\n    sServObj.getCollapsePosition = function (id) {\n      if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n        return undefined;\n      } else {\n        if (typeof sServObj.hierarchyState.collapseInfo[id].collapsePosition === 'object') {\n          return sServObj.hierarchyState.collapseInfo[id].collapsePosition;\n        } else {\n          return undefined;\n        }\n      }\n    };\n    /**\n     *\n     */\n    sServObj.getNumCollapsedParents = function (id) {\n      if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n        return 0;\n      } else {\n        if (typeof sServObj.hierarchyState.collapseInfo[id].numCollapsedParents === 'number') {\n          return sServObj.hierarchyState.collapseInfo[id].numCollapsedParents;\n        } else {\n          return 0;\n        }\n      }\n    };\n    /**\n     *\n     */\n    sServObj.setCollapsed = function (id, newState) {\n      if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n        sServObj.hierarchyState.collapseInfo[id] = {};\n      }\n      sServObj.hierarchyState.collapseInfo[id].collapsed = newState;\n    };\n    /**\n     *\n     */\n    sServObj.setCollapsePosition = function (id, newPosition) {\n      if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n        sServObj.hierarchyState.collapseInfo[id] = {};\n      }\n      sServObj.hierarchyState.collapseInfo[id].collapsePosition = newPosition;\n    };\n    /**\n     *\n     */\n    sServObj.setNumCollapsedParents = function (id, newNum) {\n      if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n        sServObj.hierarchyState.collapseInfo[id] = {};\n      }\n      sServObj.hierarchyState.collapseInfo[id].numCollapsedParents = newNum;\n    };\n    /**\n     *\n     */\n    sServObj.getcursorInTextField = function () {\n      return this.cursorInTextField;\n    };\n    /**\n     *\n     */\n    sServObj.setcursorInTextField = function (n) {\n      this.cursorInTextField = n;\n    };\n    /**\n     *\n     */\n    sServObj.isSavingAllowed = function () {\n      return this.saving;\n    };\n    /**\n     *\n     */\n    sServObj.setSavingAllowed = function (n) {\n      this.saving = n;\n    };\n    /**\n     *\n     */\n    sServObj.countSelected = function () {\n      return this.curClickItems.length;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentSample = function (perc) {\n      return this.curViewPort.sS + (this.curViewPort.eS - this.curViewPort.sS) * perc;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentPercent = function (sample) {\n      return sample * (100 / (this.curViewPort.eS - this.curViewPort.sS) / 100);\n    };\n    /**\n     *\n     */\n    sServObj.getSamplesPerPixelVal = function (event) {\n      var start = parseFloat(this.curViewPort.sS);\n      var end = parseFloat(this.curViewPort.eS);\n      return (end - start) / event.originalEvent.target.width;\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getViewPortStartTime = function () {\n      return this.curViewPort.sS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getViewPortEndTime = function () {\n      return this.curViewPort.eS * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getSelectedStartTime = function () {\n      return this.curViewPort.selectS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getSelectedEndTime = function () {\n      return this.curViewPort.selectE * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param sSample start sample of view\n     * @param sSample end sample of view\n     */\n    sServObj.setViewPort = function (sSample, eSample) {\n      var oldStart = this.curViewPort.sS;\n      var oldEnd = this.curViewPort.eS;\n      if (sSample !== undefined) {\n        this.curViewPort.sS = Math.round(sSample);\n      }\n      if (eSample !== undefined) {\n        this.curViewPort.eS = Math.round(eSample);\n      }\n      // check if moving left or right is not out of bounds -> prevent zooming on edge when moving left/right\n      if (oldStart > this.curViewPort.sS && oldEnd > this.curViewPort.eS) {\n        //moved left\n        if (this.curViewPort.sS < 0) {\n          this.curViewPort.sS = 0;\n          this.curViewPort.eS = oldEnd + Math.abs(this.curViewPort.sS);\n        }\n      }\n      if (oldStart < this.curViewPort.sS && oldEnd < this.curViewPort.eS) {\n        //moved right\n        if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n          this.curViewPort.sS = oldStart;\n          this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n        }\n      }\n      // check if in range\n      if (this.curViewPort.sS < 0) {\n        this.curViewPort.sS = 0;\n      }\n      if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n        this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n      }\n      // check if at least 4 samples are showing (fixed max zoom size)\n      if (this.curViewPort.eS - this.curViewPort.sS < 4) {\n        this.curViewPort.sS = oldStart;\n        this.curViewPort.eS = oldEnd;\n      }\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param zoomIn bool to specify zooming direction\n     * if set to true -> zoom in\n     * if set to false -> zoom out\n     */\n    sServObj.zoomViewPort = function (zoomIn, LevelService) {\n      var newStartS, newEndS, curMouseMoveItemStart;\n      var seg = this.getcurMouseItem();\n      var d = this.curViewPort.eS - this.curViewPort.sS;\n      var isLastSeg = false;\n      if (seg !== undefined) {\n        if (this.getcurMouseisFirst()) {\n          // before first element\n          seg = LevelService.getItemDetails(sServObj.getcurMouseLevelName(), 0);\n        } else if (this.getcurMouseisLast()) {\n          seg = LevelService.getLastItem(sServObj.getcurMouseLevelName());\n          isLastSeg = true;\n        }\n        if (this.getcurMouseLevelType() === 'SEGMENT') {\n          if (isLastSeg) {\n            curMouseMoveItemStart = seg.sampleStart + seg.sampleDur;\n          } else {\n            curMouseMoveItemStart = seg.sampleStart;\n          }\n        } else {\n          curMouseMoveItemStart = seg.samplePoint;\n        }\n        var d1 = curMouseMoveItemStart - this.curViewPort.sS;\n        var d2 = this.curViewPort.eS - curMouseMoveItemStart;\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + d1 * 0.5;\n          newEndS = this.curViewPort.eS - d2 * 0.5;\n        } else {\n          newStartS = this.curViewPort.sS - d1 * 0.5;\n          newEndS = this.curViewPort.eS + d2 * 0.5;\n        }\n      } else {\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + ~~(d / 4);\n          newEndS = this.curViewPort.eS - ~~(d / 4);\n        } else {\n          newStartS = this.curViewPort.sS - ~~(d / 4);\n          newEndS = this.curViewPort.eS + ~~(d / 4);\n        }\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * moves view port to the right or to the left\n     * without changing the zoom\n     *\n     * @param shiftRight bool to specify direction\n     * if set to true -> shift right\n     * if set to false -> shift left\n     */\n    sServObj.shiftViewPort = function (shiftRight) {\n      // my.removeLabelDoubleClick();\n      var newStartS, newEndS;\n      if (shiftRight) {\n        newStartS = this.curViewPort.sS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      } else {\n        newStartS = this.curViewPort.sS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * sets all the curLevelAttrDefs array\n     * to hold the default attr. definitions\n     * which are the same as the level names\n     *\n     * @param levelDefs level definitions from the DBconfig\n     */\n    sServObj.setCurLevelAttrDefs = function (levelDefs) {\n      angular.forEach(levelDefs, function (ld) {\n        sServObj.curLevelAttrDefs.push({\n          'levelName': ld.name,\n          'curAttrDefName': ld.name\n        });\n      });\n    };\n    /**\n     * set the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @param newAttrDefName\n     */\n    sServObj.setCurAttrDef = function (levelName, newAttrDefName, index) {\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          ad.curAttrDefName = newAttrDefName;\n          ad.curAttrDefIndex = index;\n        }\n      });\n    };\n    /**\n     * get the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrDef = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          curAttrDef = ad.curAttrDefName;\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n     * get the current attribute definition index of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrIndex = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          if (ad.curAttrDefIndex === undefined) {\n            curAttrDef = 0;\n          } else {\n            curAttrDef = ad.curAttrDefIndex;\n          }\n        }\n      });\n      return curAttrDef;\n    };\n    sServObj.setlastKeyCode = function (e) {\n      this.lastKeyCode = e;\n    };\n    /**\n\t*\n\t*/\n    sServObj.getX = function (e) {\n      return (e.offsetX || e.originalEvent.layerX) * (e.originalEvent.target.width / e.originalEvent.target.clientWidth);\n    };\n    /**\n\t*\n\t*/\n    sServObj.getY = function (e) {\n      return (e.offsetY || e.originalEvent.layerY) * (e.originalEvent.target.height / e.originalEvent.target.clientHeight);\n    };\n    /**\n     *\n     */\n    sServObj.resetToInitState = function () {\n      sServObj.initialize();\n    };\n    /**\n     *\n     */\n    sServObj.getColorOfAnchor = function (val, anchorNr) {\n      var curStyle = {\n          'background-color': 'rgb(' + val[anchorNr][0] + ',' + val[anchorNr][1] + ',' + val[anchorNr][2] + ')',\n          'width': '10px',\n          'height': '10px'\n        };\n      return curStyle;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('trackMouseInLevel', [\n  '$document',\n  'viewState',\n  'LevelService',\n  'ConfigProviderService',\n  'HistoryService',\n  'Soundhandlerservice',\n  function ($document, viewState, LevelService, ConfigProviderService, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      replace: true,\n      scope: {\n        levelName: '=',\n        levelType: '='\n      },\n      link: function (scope, element, attr) {\n        scope.lastEventClick = undefined;\n        scope.lastEventMove = undefined;\n        scope.lastNeighboursMove = undefined;\n        scope.lastPCM = undefined;\n        scope.curMouseSampleNrInView = undefined;\n        scope.order = attr.trackMouseInLevel;\n        /////////////////////////////\n        // Bindings\n        //\n        element.bind('click', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastClick(event);\n        });\n        //\n        element.bind('contextmenu', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastRightClick(event);\n        });\n        //\n        element.bind('dblclick', function (event) {\n          scope.setLastMove(event, true);\n          if (ConfigProviderService.vals.restrictions.editItemName) {\n            scope.setLastDblClick(event);\n          } else {\n            scope.setLastClick(event);\n          }\n        });\n        //\n        element.bind('mousemove', function (event) {\n          if (!viewState.getdragBarActive()) {\n            var moveLine = true;\n            var samplesPerPixel = viewState.getSamplesPerPixelVal(event);\n            scope.curMouseSampleNrInView = viewState.getX(event) * samplesPerPixel;\n            var moveBy = scope.curMouseSampleNrInView - scope.lastPCM;\n            if (samplesPerPixel <= 1) {\n              var zoomEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n              // absolute movement in pcm below 1 pcm per pixel\n              if (scope.levelType === 'SEGMENT') {\n                if (zoomEventMove.isFirst === true && zoomEventMove.isLast === false) {\n                  // before first elem\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemDetails(scope.levelName, 0).sampleStart);\n                } else if (zoomEventMove.isFirst === false && zoomEventMove.isLast === true) {\n                  // after last elem\n                  var lastItem = LevelService.getLastItem(scope.levelName);\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - lastItem.sampleStart - lastItem.sampleDur);\n                } else {\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).sampleStart);\n                }\n              } else {\n                moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).samplePoint - 0.5);  // 0.5 to break between samples not on\n              }\n            } else {\n              // relative movement in pcm above 1 pcm per pixel\n              moveBy = Math.round(scope.curMouseSampleNrInView - scope.lastPCM);\n            }\n          }\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            //console.log('Left mouse button pressed');\n            break;\n          case 2:\n            //console.log('Middle mouse button pressed');\n            break;\n          case 3:\n            //console.log('Right mouse button pressed');\n            break;\n          default:\n            if (!viewState.getdragBarActive()) {\n              var curMouseItem = viewState.getcurMouseItem();\n              if (ConfigProviderService.vals.restrictions.editItemSize && event.shiftKey) {\n                LevelService.deleteEditArea();\n                if (curMouseItem !== undefined) {\n                  viewState.movingBoundary = true;\n                  if (scope.levelType === 'SEGMENT') {\n                    if (viewState.getcurMouseisFirst() || viewState.getcurMouseisLast()) {\n                      var seg, leftMost, rightB;\n                      // before first segment\n                      if (viewState.getcurMouseisFirst()) {\n                        seg = LevelService.getItemDetails(scope.levelName, 0);\n                        viewState.movingBoundarySample = seg.sampleStart + moveBy;\n                      } else if (viewState.getcurMouseisLast()) {\n                        seg = LevelService.getLastItem(scope.levelName);\n                        viewState.movingBoundarySample = seg.sampleStart + seg.sampleDur + moveBy;\n                      }\n                    } else {\n                      viewState.movingBoundarySample = curMouseItem.sampleStart + moveBy;\n                      seg = curMouseItem;\n                    }\n                    LevelService.moveBoundary(scope.levelName, seg.id, moveBy, viewState.getcurMouseisFirst(), viewState.getcurMouseisLast());\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEBOUNDARY',\n                      'name': scope.levelName,\n                      'id': seg.id,\n                      'movedBy': moveBy,\n                      'isFirst': viewState.getcurMouseisFirst(),\n                      'isLast': viewState.getcurMouseisLast()\n                    });\n                  } else {\n                    seg = curMouseItem;\n                    viewState.movingBoundarySample = curMouseItem.samplePoint + moveBy;\n                    LevelService.moveEvent(scope.levelName, seg.id, moveBy);\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEEVENT',\n                      'name': scope.levelName,\n                      'id': seg.id,\n                      'movedBy': moveBy\n                    });\n                  }\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                  moveLine = false;\n                }\n              } else if (ConfigProviderService.vals.restrictions.editItemSize && event.altKey) {\n                LevelService.deleteEditArea();\n                if (scope.levelType == 'SEGMENT') {\n                  seg = viewState.getcurClickItems();\n                  if (seg[0] !== undefined) {\n                    LevelService.moveSegment(scope.levelName, seg[0].id, seg.length, moveBy);\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVESEGMENT',\n                      'name': scope.levelName,\n                      'id': seg[0].id,\n                      'length': seg.length,\n                      'movedBy': moveBy\n                    });\n                  }\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                } else if (scope.levelType == 'EVENT') {\n                  seg = viewState.getcurClickItems();\n                  if (seg[0] !== undefined) {\n                    angular.forEach(seg, function (s) {\n                      LevelService.moveEvent(scope.levelName, s.id, moveBy);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEEVENT',\n                        'name': scope.levelName,\n                        'id': s.id,\n                        'movedBy': moveBy\n                      });\n                    });\n                  }\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                }\n              } else {\n                viewState.movingBoundary = false;\n              }\n            }\n            break;\n          }\n          if (!viewState.getdragBarActive()) {\n            scope.setLastMove(event, moveLine);\n          }\n        });\n        //\n        element.bind('mousedown', function (event) {\n          viewState.movingBoundary = true;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseup', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseout', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        /////////////////////////\n        /**\n         *\n         */\n        scope.setLastClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.order);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n            LevelService.setlasteditAreaElem(element.parent());\n            viewState.setcurClickItem(scope.lastEventClick.current);\n            viewState.selectBoundary();\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastRightClick = function (x) {\n          if (viewState.getcurClickLevelName() !== scope.levelName) {\n            scope.setLastClick(x);\n          }\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            var next = LevelService.getItemInTime(viewState.getcurClickLevelName(), scope.lastEventClick.current.id, true);\n            var prev = LevelService.getItemInTime(viewState.getcurClickLevelName(), scope.lastEventClick.current.id, false);\n            viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n            viewState.setcurClickItemMultiple(scope.lastEventClick.current, next, prev);\n            viewState.selectBoundary();\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastDblClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          var isOpen = element.parent().css('height') === '25px' ? false : true;\n          // expand to full size on dbl click if level is in small size\n          if (!isOpen) {\n            element.parent().parent().find('div')[3].click();\n          }\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined && viewState.getPermission('labelAction')) {\n            if (scope.levelType === 'SEGMENT') {\n              if (scope.lastEventClick.current.sampleStart >= viewState.curViewPort.sS) {\n                if (scope.lastEventClick.current.sampleStart + scope.lastEventClick.current.sampleDur <= viewState.curViewPort.eS) {\n                  viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n                  viewState.setcurClickItem(scope.lastEventClick.current);\n                  LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n                  LevelService.setlasteditAreaElem(element.parent());\n                  viewState.setEditing(true);\n                  LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n                } else {\n                }\n              } else {\n              }\n            } else {\n              viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n              viewState.setcurClickItem(scope.lastEventClick.current);\n              LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n              LevelService.setlasteditAreaElem(element.parent());\n              viewState.setEditing(true);\n              LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n              viewState.setEditing(true);\n            }\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastMove = function (x, doChange) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (doChange) {\n            if (scope.lastEventMove.current !== undefined && scope.lastEventMove.nearest !== undefined) {\n              scope.lastNeighboursMove = LevelService.getItemNeighboursFromLevel(scope.levelName, scope.lastEventMove.nearest.id, scope.lastEventMove.nearest.id);\n              viewState.setcurMouseItem(scope.lastEventMove.nearest, scope.lastNeighboursMove, scope.lastPCM, scope.lastEventMove.isFirst, scope.lastEventMove.isLast);\n            }\n          }\n          viewState.setcurMouseLevelName(scope.levelName);\n          viewState.setcurMouseLevelType(scope.levelType);\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('handleglobalkeystrokes', [\n  '$timeout',\n  'viewState',\n  'modalService',\n  'HierarchyManipulationService',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'HistoryService',\n  'LevelService',\n  'DataService',\n  'LinkService',\n  'AnagestService',\n  function ($timeout, viewState, modalService, HierarchyManipulationService, Soundhandlerservice, ConfigProviderService, HistoryService, LevelService, DataService, LinkService, AnagestService) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element) {\n        $(document).bind('keyup', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          if (viewState.isEditing() && !viewState.getcursorInTextField()) {\n            scope.applyKeyCodeUp(code, e);\n          }\n        });\n        $(document).bind('keydown', function (e) {\n          if (!scope.firefox) {\n            var code = e.keyCode ? e.keyCode : e.which;\n            if (code == 8 || code == 9 || code == 27 || code == 37 || code == 38 || code == 39 || code == 40 || code == 32) {\n              scope.applyKeyCode(code, e);\n            }\n          }\n        });\n        $(document).bind('keypress', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          scope.applyKeyCode(code, e);\n        });\n        scope.applyKeyCodeUp = function (code, e) {\n          scope.$apply(function () {\n            if (code !== ConfigProviderService.vals.keyMappings.esc && code !== ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              var str = domElement.val();\n              viewState.setSavingAllowed(true);\n              var curAttrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n              var lvlDefs = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n              var definitions = {};\n              if (lvlDefs.attributeDefinitions !== undefined && lvlDefs.attributeDefinitions.length > 0) {\n                definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[curAttrIndex];\n              }\n              // if it is defined then check if characters are ok\n              if (definitions.legalLabels !== undefined && str.length > 0) {\n                if (definitions.legalLabels.indexOf(str) < 0) {\n                  viewState.setSavingAllowed(false);\n                }\n              }\n              if (viewState.isSavingAllowed()) {\n                domElement.css({ 'background-color': 'rgba(255,255,0,1)' });\n              } else {\n                domElement.css({ 'background-color': 'rgba(255,0,0,1)' });\n              }\n            }\n          });\n        };\n        scope.applyKeyCode = function (code, e) {\n          scope.$apply(function () {\n            // check if mouse has to be in labeler for key mappings\n            if (ConfigProviderService.vals.main.catchMouseForKeyBinding) {\n              if (!viewState.mouseInEmuWebApp) {\n                return;\n              }\n            }\n            viewState.setlastKeyCode(code);\n            // Handle key strokes for the hierarchy modal\n            if (viewState.hierarchyShown && viewState.hierarchyState !== undefined) {\n              if (viewState.hierarchyState.getInputFocus()) {\n                // Commit label change\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyCommitEdit) {\n                  var elementID = viewState.hierarchyState.getContextMenuID();\n                  var element = LevelService.getItemByID(elementID);\n                  var levelName = LevelService.getLevelName(elementID);\n                  var attrIndex = viewState.getCurAttrIndex(levelName);\n                  var legalLabels = ConfigProviderService.getLevelDefinition(levelName).attributeDefinitions[attrIndex].legalLabels;\n                  var newValue = viewState.hierarchyState.getEditValue();\n                  var oldValue;\n                  if (element.labels[attrIndex] !== undefined) {\n                    oldValue = element.labels[attrIndex].value;\n                  } else {\n                    oldValue = '';\n                  }\n                  // Check if new value is legal\n                  if (legalLabels === undefined || newValue.length > 0 && legalLabels.indexOf(newValue) >= 0) {\n                    LevelService.renameLabel(levelName, elementID, attrIndex, newValue);\n                    HistoryService.addObjToUndoStack({\n                      'type': 'ANNOT',\n                      'action': 'RENAMELABEL',\n                      'name': levelName,\n                      'id': elementID,\n                      'attrIndex': attrIndex,\n                      'oldValue': oldValue,\n                      'newValue': newValue\n                    });\n                    viewState.hierarchyState.closeContextMenu();\n                  }\n                }\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyCancelEdit) {\n                  viewState.hierarchyState.closeContextMenu();\n                }\n              } else {\n                //if (!e.metaKey && !e.ctrlKey) {\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyDeleteLink) {\n                  e.preventDefault();\n                }\n                // Play selected item\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyPlayback) {\n                  viewState.hierarchyState.playing += 1;\n                }\n                // rotateHierarchy\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyRotate) {\n                  viewState.toggleHierarchyRotation();\n                }\n                // Delete link\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyDeleteLink) {\n                  /*\n\t\t\t\t\t This block is currently obsoleted because e.preventDefault() is called above\n\t\t\t\t\t at the beginning of the hierarchy block\n\t\t\t\t\t// This should only be called when certain keys are pressed that are known to trigger some browser behaviour.\n\t\t\t\t\t// But what if the key code is reconfigured (possibly by the user)?\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t*/\n                  var pos = LinkService.deleteLink(viewState.hierarchyState.selectedLinkFromID, viewState.hierarchyState.selectedLinkToID);\n                  if (pos !== -1) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'DELETELINK',\n                      fromID: viewState.hierarchyState.selectedLinkFromID,\n                      toID: viewState.hierarchyState.selectedLinkToID,\n                      position: pos\n                    });\n                  }\n                }\n                // Delete item\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyDeleteItem) {\n                  var result = LevelService.deleteItemWithLinks(viewState.hierarchyState.selectedItemID);\n                  if (result.item !== undefined) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'DELETEITEM',\n                      item: result.item,\n                      levelName: result.levelName,\n                      position: result.position,\n                      deletedLinks: result.deletedLinks\n                    });\n                  }\n                }\n                // Add item ...\n                // ... before the currently selected one\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyAddItemBefore) {\n                  var newID = LevelService.addItem(viewState.hierarchyState.selectedItemID, true);\n                  if (newID !== -1) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'ADDITEM',\n                      newID: newID,\n                      neighborID: viewState.hierarchyState.selectedItemID,\n                      before: true\n                    });\n                  }\n                }\n                // ... after the currently selected one\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyAddItemAfter) {\n                  var newID = LevelService.addItem(viewState.hierarchyState.selectedItemID, false);\n                  if (newID !== -1) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'ADDITEM',\n                      newID: newID,\n                      neighborID: viewState.hierarchyState.selectedItemID,\n                      before: false\n                    });\n                  }\n                }\n                /* Add link\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyAddLink) {\n                  if (viewState.hierarchyState.newLinkFromID === undefined) {\n                    viewState.hierarchyState.newLinkFromID = viewState.hierarchyState.selectedItemID;\n                  } else {\n                    var linkObj = HierarchyManipulationService.addLink(viewState.hierarchyState.path, viewState.hierarchyState.newLinkFromID, viewState.hierarchyState.selectedItemID);\n                    viewState.hierarchyState.newLinkFromID = undefined;\n                    if (linkObj !== null) {\n                      HistoryService.addObjToUndoStack({\n                        type: 'HIERARCHY',\n                        action: 'ADDLINK',\n                        link: linkObj\n                      });\n                    }\n                  }\n                }*/\n                // undo\n                if (code === ConfigProviderService.vals.keyMappings.undo) {\n                  HistoryService.undo();\n                }\n                // redo\n                if (code === ConfigProviderService.vals.keyMappings.redo) {\n                  HistoryService.redo();\n                }\n                // close modal\n                if (code === ConfigProviderService.vals.keyMappings.esc || code === ConfigProviderService.vals.keyMappings.showHierarchy) {\n                  modalService.close();\n                }\n              }\n            } else if (viewState.isEditing()) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              // preventing new line if saving not allowed\n              if (!viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())].legalLabels;\n                e.preventDefault();\n                e.stopPropagation();\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                modalService.open('views/error.html', 'Editing Error: Sorry, characters allowed on this Level are \"' + JSON.stringify(definitions) + '\"');\n              }\n              // save text on enter if saving is allowed\n              if (viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var editingElement = LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID());\n                var attrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n                var oldValue = '';\n                if (editingElement.labels[attrIndex] !== undefined) {\n                  oldValue = editingElement.labels[attrIndex].value;\n                }\n                LevelService.renameLabel(viewState.getcurClickLevelName(), LevelService.getlastID(), viewState.getCurAttrIndex(viewState.getcurClickLevelName()), domElement.val());\n                HistoryService.addObjToUndoStack({\n                  'type': 'ANNOT',\n                  'action': 'RENAMELABEL',\n                  'name': viewState.getcurClickLevelName(),\n                  'id': LevelService.getlastID(),\n                  'attrIndex': attrIndex,\n                  'oldValue': oldValue,\n                  'newValue': domElement.val()\n                });\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                viewState.setcurClickItem(LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID()));\n              }\n              // escape from text if esc\n              if (code === ConfigProviderService.vals.keyMappings.esc) {\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n              }\n            } else if (viewState.getcursorInTextField() === false) {\n              LevelService.deleteEditArea();\n              // escape from open modal dialog\n              //\n              if (viewState.curState.permittedActions.length === 0 && code === ConfigProviderService.vals.keyMappings.esc && modalService.force === false) {\n                modalService.close();\n              }\n              // delegate keyboard keyMappings according to keyMappings of scope\n              // showHierarchy\n              if (code === ConfigProviderService.vals.keyMappings.showHierarchy && ConfigProviderService.vals.activeButtons.showHierarchy) {\n                if (viewState.curState !== viewState.states.noDBorFilesloaded) {\n                  if (viewState.hierarchyShown) {\n                    modalService.close();\n                  } else {\n                    viewState.toggleHierarchy();\n                    modalService.open('views/showHierarchyModal.html');\n                  }\n                }\n              }\n              // zoomAll\n              if (code === ConfigProviderService.vals.keyMappings.zoomAll) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n                } else {\n                }\n              }\n              // zoomIn\n              if (code === ConfigProviderService.vals.keyMappings.zoomIn) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(true, LevelService);\n                } else {\n                }\n              }\n              // zoomOut\n              if (code === ConfigProviderService.vals.keyMappings.zoomOut) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(false, LevelService);\n                } else {\n                }\n              }\n              // zoomSel\n              if (code === ConfigProviderService.vals.keyMappings.zoomSel) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                } else {\n                }\n              }\n              // shiftViewPortLeft\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortLeft) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(false);\n                } else {\n                }\n              }\n              // shiftViewPortRight\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortRight) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(true);\n                } else {\n                }\n              }\n              // playEntireFile\n              if (code === ConfigProviderService.vals.keyMappings.playEntireFile) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n                    viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n                  }\n                } else {\n                }\n              }\n              // playAllInView\n              if (code === ConfigProviderService.vals.keyMappings.playAllInView) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                    viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                  }\n                } else {\n                }\n              }\n              // playSelected\n              if (code === ConfigProviderService.vals.keyMappings.playSelected) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                    viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                  }\n                } else {\n                }\n              }\n              // selectFirstContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFirstContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 1;\n                  }\n                }\n              }\n              // selectSecondContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectSecondContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 2;\n                  }\n                }\n              }\n              // selectThirdContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectThirdContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 3;\n                  }\n                }\n              }\n              // selectFourthContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFourthContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 4;\n                  }\n                }\n              }\n              // selectNOContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectNoContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = undefined;\n                  }\n                }\n              }\n              // levelUp\n              if (code === ConfigProviderService.vals.keyMappings.levelUp) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n                }\n              }\n              // levelDown\n              if (code === ConfigProviderService.vals.keyMappings.levelDown) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(true, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass LevelService to prevent circular deps\n                }\n              }\n              // preselected boundary snap to top\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestTopBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(true, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist === false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary snap to bottom\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestBottomBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(false, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist == false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary to nearest zero crossing\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestZeroCrossing) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var dist;\n                    if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().sampleStart);\n                    } else {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().samplePoint);\n                    }\n                    if (dist !== 0) {\n                      var seg = viewState.getcurMouseItem();\n                      var neigh = viewState.getcurMouseNeighbours();\n                      var levelname = viewState.getcurMouseLevelName();\n                      LevelService.moveBoundary(levelname, seg.id, dist, 0);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEBOUNDARY',\n                        'name': levelname,\n                        'id': seg.id,\n                        'movedBy': dist,\n                        'position': 0\n                      });\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // expand Segments\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // expand Segment left\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Left\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Right\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarLeft) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.toggleSubmenu(ConfigProviderService.design.animation.period);\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarRight) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n                  }\n                }\n              }\n              // select Segments in viewport selection\n              if (code === ConfigProviderService.vals.keyMappings.selectItemsInSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickLevelName() === undefined) {\n                    modalService.open('views/error.html', 'Selection Error : Please select a Level first');\n                  } else {\n                    viewState.curClickItems = [];\n                    angular.forEach(viewState.getItemsInSelection(DataService.data.levels), function (item) {\n                      var next = LevelService.getItemInTime(viewState.getcurClickLevelName(), item.id, true);\n                      var prev = LevelService.getItemInTime(viewState.getcurClickLevelName(), item.id, false);\n                      viewState.setcurClickItemMultiple(item, next, prev);\n                    });\n                    viewState.selectBoundary();\n                  }\n                }\n              }\n              // selPrevItem (arrow key left)\n              if (code === ConfigProviderService.vals.keyMappings.selPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.left !== undefined) {\n                      if (lastNeighboursMove.left.sampleStart !== undefined) {\n                        // check if in view\n                        if (lastNeighboursMove.left.sampleStart > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      } else {\n                        // check if in view\n                        if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // selNextItem (arrow key right)\n              if (code === ConfigProviderService.vals.keyMappings.selNextItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.right !== undefined) {\n                      var point = 0;\n                      var dur = 0;\n                      if (lastNeighboursMove.right.sampleStart !== undefined) {\n                        point = lastNeighboursMove.right.sampleStart;\n                        dur = lastNeighboursMove.right.sampleDur;\n                      }\n                      if (lastNeighboursMove.right.samplePoint !== undefined) {\n                        point = lastNeighboursMove.right.samplePoint;\n                        dur = 0;\n                      }\n                      if (point !== 0) {\n                        // check if in view\n                        if (point + dur < viewState.curViewPort.eS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        }\n                      }\n                    } else {\n                    }\n                  }\n                }\n              }\n              // selNextPrevItem (tab key and tab+shift key)\n              if (code === ConfigProviderService.vals.keyMappings.selNextPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (e.shiftKey) {\n                      if (lastNeighboursMove.left !== undefined) {\n                        if (lastNeighboursMove.left.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.left.sampleStart > viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    } else {\n                      if (lastNeighboursMove.right !== undefined) {\n                        if (lastNeighboursMove.right.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.right.sampleStart + lastNeighboursMove.right.sampleDur <= viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.right.samplePoint < viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // createNewItemAtSelection\n              if (code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                // auto action in model when open and user presses 'enter'\n                if (modalService.isOpen) {\n                  modalService.confirmContent();\n                } else {\n                  if (viewState.getPermission('labelAction')) {\n                    if (ConfigProviderService.vals.restrictions.addItem) {\n                      if (viewState.getselectedRange().start === viewState.curViewPort.selectS && viewState.getselectedRange().end === viewState.curViewPort.selectE) {\n                        if (viewState.getcurClickItems().length === 1) {\n                          // check if in view\n                          if (viewState.getselectedRange().start >= viewState.curViewPort.sS && viewState.getselectedRange().end <= viewState.curViewPort.eS) {\n                            viewState.setEditing(true);\n                            LevelService.openEditArea(viewState.getcurClickItems()[0], LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                            scope.cursorInTextField();\n                          }\n                        } else {\n                          modalService.open('views/error.html', 'Modify Error: Please select a single Segment.');\n                        }\n                      } else {\n                        if (viewState.curViewPort.selectE == -1 && viewState.curViewPort.selectS == -1) {\n                          modalService.open('views/error.html', 'Error : Please select a Segment or Point to modify it\\'s name. Or select a level plus a range in the viewport in order to insert a new Segment.');\n                        } else {\n                          var seg = LevelService.getClosestItem(viewState.curViewPort.selectS, viewState.getcurClickLevelName(), Soundhandlerservice.wavJSO.Data.length).current;\n                          if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                            if (seg === undefined) {\n                              var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                              if (!insSeg.ret) {\n                                modalService.open('views/error.html', 'Error : You are not allowed to insert a Segment here.');\n                              } else {\n                                HistoryService.addObjToUndoStack({\n                                  'type': 'ANNOT',\n                                  'action': 'INSERTSEGMENTS',\n                                  'name': viewState.getcurClickLevelName(),\n                                  'start': viewState.curViewPort.selectS,\n                                  'end': viewState.curViewPort.selectE,\n                                  'ids': insSeg.ids,\n                                  'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                                });\n                              }\n                            } else {\n                              if (seg.sampleStart === viewState.curViewPort.selectS && seg.sampleStart + seg.sampleDur + 1 === viewState.curViewPort.selectE) {\n                                viewState.setcurClickLevel(viewState.getcurClickLevelName(), viewState.getcurClickLevelType(), scope.$index);\n                                viewState.setcurClickItem(seg.current);\n                                LevelService.setlasteditArea('_' + seg.id);\n                                LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                                viewState.setEditing(true);\n                              } else {\n                                var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                                if (!insSeg.ret) {\n                                  modalService.open('views/error.html', 'Error : You are not allowed to insert a Segment here.');\n                                } else {\n                                  HistoryService.addObjToUndoStack({\n                                    'type': 'ANNOT',\n                                    'action': 'INSERTSEGMENTS',\n                                    'name': viewState.getcurClickLevelName(),\n                                    'start': viewState.curViewPort.selectS,\n                                    'end': viewState.curViewPort.selectE,\n                                    'ids': insSeg.ids,\n                                    'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                                  });\n                                }\n                              }\n                            }\n                          } else {\n                            var levelDef = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n                            if (typeof levelDef.anagestConfig === 'undefined') {\n                              var insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, ConfigProviderService.vals.labelCanvasConfig.newEventName);\n                              if (insPoint.alreadyExists) {\n                                viewState.setcurClickLevel(viewState.getcurClickLevelName(), viewState.getcurClickLevelType(), scope.$index);\n                                viewState.setcurClickItem(seg.current);\n                                LevelService.setlasteditArea('_' + seg.id);\n                                LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                                viewState.setEditing(true);\n                              } else {\n                                HistoryService.addObjToUndoStack({\n                                  'type': 'ANNOT',\n                                  'action': 'INSERTEVENT',\n                                  'name': viewState.getcurClickLevelName(),\n                                  'start': viewState.curViewPort.selectS,\n                                  'id': insPoint.id,\n                                  'pointName': ConfigProviderService.vals.labelCanvasConfig.newEventName\n                                });\n                              }\n                            } else {\n                              AnagestService.insertAnagestEvents();\n                            }\n                          }\n                        }\n                      }\n                    } else {\n                    }\n                  }\n                }\n              }\n              // undo\n              if (code === ConfigProviderService.vals.keyMappings.undo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.undo();\n                }\n              }\n              // redo\n              if (code === ConfigProviderService.vals.keyMappings.redo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.redo();\n                }\n              }\n              // deletePreselBoundary\n              if (code === ConfigProviderService.vals.keyMappings.deletePreselBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  e.preventDefault();\n                  var seg = viewState.getcurMouseItem();\n                  var cseg = viewState.getcurClickItems();\n                  var isFirst = viewState.getcurMouseisFirst();\n                  var isLast = viewState.getcurMouseisLast();\n                  var levelname = viewState.getcurMouseLevelName();\n                  var type = viewState.getcurMouseLevelType();\n                  if (!e.shiftKey) {\n                    if (ConfigProviderService.vals.restrictions.deleteItemBoundary) {\n                      if (seg !== undefined) {\n                        var neighbour = LevelService.getItemNeighboursFromLevel(levelname, seg.id, seg.id);\n                        if (type === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteBoundary(levelname, seg.id, isFirst, isLast);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETEBOUNDARY',\n                            'name': levelname,\n                            'id': seg.id,\n                            'isFirst': isFirst,\n                            'isLast': isLast,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks;\n                          if (neighbour.left !== undefined) {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, neighbour.left.id);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': neighbour.left.id,\n                              'deletedLinks': deletedLinks\n                            });\n                          } else {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, -1);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': -1,\n                              'deletedLinks': deletedLinks\n                            });\n                          }\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          var deletedPoint = LevelService.deleteEvent(levelname, seg.id);\n                          if (deletedPoint !== false) {\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETEEVENT',\n                              'name': levelname,\n                              'start': deletedPoint.samplePoint,\n                              'id': deletedPoint.id,\n                              'pointName': deletedPoint.labels[0].value\n                            });\n                            HistoryService.addCurChangeObjToUndoStack();\n                            var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                            if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                              var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                              viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                            }\n                          } else {\n                            viewState.setcurMouseItem(undefined, undefined, undefined, undefined, undefined);\n                          }\n                        }\n                      }\n                    }\n                  } else {\n                    if (ConfigProviderService.vals.restrictions.deleteItem) {\n                      if (cseg !== undefined && cseg.length > 0) {\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteSegments(levelname, cseg[0].id, cseg.length);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETESEGMENTS',\n                            'name': levelname,\n                            'id': cseg[0].id,\n                            'length': cseg.length,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks = LinkService.deleteLinkSegment(cseg);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETELINKSEGMENT',\n                            'name': levelname,\n                            'segments': cseg,\n                            'deletedLinks': deletedLinks\n                          });\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          modalService.open('views/error.html', 'Delete Error: You can not delete Segments on Point Levels.');\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              if (!e.metaKey && !e.ctrlKey) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }\n          });\n        };\n        scope.safeApply = function (fn) {\n          var phase = this.$root.$$phase;\n          if (phase == '$apply' || phase == '$digest') {\n            if (fn && typeof fn === 'function') {\n              fn();\n            }\n          } else {\n            this.$apply(fn);\n          }\n        };\n        //remove binding on destroy\n        scope.$on('$destroy', function () {\n          $(window).off('keydown');\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('delete', [\n  'modalService',\n  function (modalService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(scope.level.name, attr.delete);\n          scope.vs.setcurClickLevel(scope.level.name, scope.level.type, scope.order);\n          modalService.open('views/deleteLevel.html', scope.level.name);\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('resize', [\n  'LevelService',\n  'viewState',\n  function (LevelService, viewState) {\n    return {\n      restrict: 'A',\n      link: function (scope, element) {\n        var elem = element.parent().parent();\n        var elemHeight = 0;\n        var deleteButton = elem.find(element.parent().children()[0]);\n        var resizeButton = elem.find(element.parent().children()[1]);\n        var saveButton = elem.find(element.parent().children()[2]);\n        element.bind('click', function () {\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          if (scope.open) {\n            scope.open = false;\n            elemHeight = elem.css('height');\n            elem.css({ 'height': '25px' });\n            if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n              deleteButton.hide();\n            }\n            if (scope.cps.vals.activeButtons.saveSingleLevel) {\n              saveButton.hide();\n            }\n          } else {\n            scope.open = true;\n            elem.css({ 'height': elemHeight });\n            if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n              deleteButton.show();\n            }\n            if (scope.cps.vals.activeButtons.saveSingleLevel) {\n              saveButton.show();\n            }\n          }\n          scope.updateView();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('enlarge', [\n  '$rootScope',\n  'viewState',\n  'ConfigProviderService',\n  function ($rootScope, viewState, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attrs) {\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          if (!$.isEmptyObject(ConfigProviderService.vals.perspectives)) {\n            if (!$.isEmptyObject(viewState.curPerspectiveIdx)) {\n              if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length === 1) {\n                element.hide();\n              } else {\n                element.show();\n              }\n            }\n          }\n        }, true);\n        var open = false;\n        element.bind('click', function () {\n          if (open) {\n            open = false;\n            viewState.setenlarge(-1);\n          } else {\n            open = true;\n            viewState.setenlarge(attrs.enlarge);\n          }\n          $rootScope.$apply();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('save', [\n  'modalService',\n  'Espsparserservice',\n  function (modalService, Espsparserservice) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(scope.level.name, attr.save);\n          Espsparserservice.asyncParseJSO(scope.level.name).then(function (result) {\n            modalService.open('views/export.html', name + '_esps.txt', result);\n          });\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('slideToggle', function () {\n  return {\n    restrict: 'A',\n    scope: { isOpen: '=slideToggle' },\n    link: function (scope, element, attr) {\n      var slideDuration = parseInt(attr.slideToggleDuration, 10) || 200;\n      // trigger a slideToggle at initialization\n      if (scope.isOpen) {\n      } else {\n        element.stop().slideToggle(0);\n      }\n      // Watch for when the value bound to isOpen changes\n      // When it changes trigger a slideToggle\n      scope.$watch('isOpen', function (newIsOpenVal, oldIsOpenVal) {\n        if (newIsOpenVal !== oldIsOpenVal) {\n          element.stop().slideToggle(slideDuration);\n        }\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('previewtrack', [\n  'viewState',\n  'Soundhandlerservice',\n  function (viewState, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element) {\n        var startPCM = -1;\n        ///////////////\n        // bindings\n        element.bind('click', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n            if (startPCM - width / 2 < 0) {\n              startPCM = Math.ceil(width / 2);\n            } else if (startPCM + width / 2 > Soundhandlerservice.wavJSO.Data.length) {\n              startPCM = Math.floor(Soundhandlerservice.wavJSO.Data.length - width / 2);\n            }\n            if (!viewState.isEditing()) {\n              scope.$apply(function () {\n                viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n              });\n            }\n          }\n        });\n        //\n        element.bind('mousedown', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n          }\n        });\n        //\n        element.bind('mousemove', function (x) {\n          var mbutton = 0;\n          if (x.buttons === undefined) {\n            mbutton = x.which;\n          } else {\n            mbutton = x.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            if (startPCM !== -1) {\n              var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n              startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n              if (!viewState.isEditing()) {\n                scope.$apply(function () {\n                  viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n                });\n              }\n            }\n            break;\n          }\n        });\n        //\n        element.bind('mouseup', function () {\n          startPCM = -1;\n        });\n        //\n        element.bind('mouseout', function () {\n          startPCM = -1;\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Iohandlerservice', [\n  '$rootScope',\n  '$http',\n  '$location',\n  '$q',\n  'HistoryService',\n  'viewState',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Espsparserservice',\n  'Ssffdataservice',\n  'Websockethandler',\n  'DragnDropDataService',\n  function Iohandlerservice($rootScope, $http, $location, $q, HistoryService, viewState, Soundhandlerservice, Ssffparserservice, Wavparserservice, Textgridparserservice, ConfigProviderService, Espsparserservice, Ssffdataservice, Websockethandler, DragnDropDataService) {\n    // shared service object\n    var sServObj = {};\n    // $http.defaults.useXDomain = true;\n    sServObj.wsH = Websockethandler;\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultConfig = function () {\n      var prom = $http.get('configFiles/default_emuwebappConfig.json');\n      return prom;\n    };\n    /**\n\t\t * default design is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultDesign = function () {\n      var prom = $http.get('configFiles/default_emuwebappDesign.json');\n      return prom;\n    };\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetPath = function (path, respType) {\n      var prom = $http.get(path, { responseType: respType });\n      return prom;\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    /**\n\t\t *\n\t\t */\n    sServObj.getProtocol = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getProtocol not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getProtocol();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDoUserManagement = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDoUserManagement not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDoUserManagement();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.logOnUser = function (name, pwd) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of logOnUser not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.logOnUser(name, pwd);\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDBconfigFile = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDBconfigFile not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDBconfigFile();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_DBconfig.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundleList = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundleList not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundleList();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_bundleList.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundle = function (name, session, nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'embedded') {\n        getProm = DragnDropDataService.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + name + '_bndl.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.saveBundle = function (bundleData) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of saveBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.saveBundle(bundleData);\n      }\n      // else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n      // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n      // \tgetProm = $http.get('testData/testAeBundle.json'); // SIC SIC SIC HARDCODED -> name is ignored\n      // }\n      return getProm;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    /**\n\t\t * pass through to according parser\n\t\t */\n    sServObj.parseLabelFile = function (string, annotates, name, fileType) {\n      var prom;\n      if (fileType === 'ESPS') {\n        prom = Espsparserservice.asyncParseEsps(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedESPS');\n      } else if (fileType === 'TEXTGRID') {\n        prom = Textgridparserservice.asyncParseTextGrid(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTEXTGRID');\n      } else if (fileType === 'annotJSON') {\n        var def = $q.defer();\n        prom = def.promise;\n        def.resolve(angular.fromJson(string));\n      }\n      return prom;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Soundhandlerservice', [\n  '$document',\n  function Soundhandlerservice($document) {\n    // private vars\n    var audioContext;\n    var curSource;\n    // shared service object\n    var sServObj = {};\n    // public vars\n    sServObj.wavJSO = {};\n    sServObj.isPlaying = false;\n    ///////////////////////////////////////////\n    // private API\n    /**\n\t\t * safely initialize audio context\n\t\t * */\n    function initAudioContext() {\n      try {\n        window.AudioContext = window.AudioContext || window.webkitAudioContext;\n        audioContext = new AudioContext();\n      } catch (e) {\n        alert('Error loading the AudioContext (could mean your browser doesn\\'t support the HTML5 webaudio API):' + e);\n      }\n    }\n    ///////////////////////////////////////////\n    // public API\n    /**\n\t\t * decode and play a passed in buffer\n\t\t *\n\t\t * @param buffer arraybuffer containing audio file (as returned by XHR for example)\n\t\t * */\n    sServObj.decodeAndPlay = function (buffer) {\n      if (typeof audioContext == 'undefined') {\n        initAudioContext();\n      }\n      audioContext.decodeAudioData(buffer, function (ab) {\n        curSource = audioContext.createBufferSource();\n        curSource.buffer = ab;\n        curSource.connect(audioContext.destination);\n        curSource.start(0);\n        curSource.onended = function () {\n          sServObj.isPlaying = false;\n        };\n      }, function (e) {\n        alert(e);\n      });\n    };\n    /**\n\t\t * Creates new ArrayBuffer containing wav file that goes\n\t\t * from sampleStart to endSample\n\t\t *\n\t\t * @param sampleStart number that represents start sample\n\t\t * @paramn endSample number that represents end sample\n\t\t * @returns ArrayBuffer containing wav file\n\t\t * */\n    sServObj.extractRelPartOfWav = function (sampleStart, endSample) {\n      var bytePerSample = sServObj.wavJSO.BitsPerSample / 8;\n      var header = sServObj.wavJSO.origArrBuf.subarray(0, 44);\n      var data = sServObj.wavJSO.origArrBuf.subarray(44, sServObj.wavJSO.Data.length * bytePerSample);\n      var dv = new DataView(header);\n      dv.setUint32(40, (endSample - sampleStart) * bytePerSample, true);\n      // var Subchunk2Size = dv.getUint32(40, true);\n      // console.log(Subchunk2Size);\n      var newData = data.subarray(sampleStart * bytePerSample, (endSample - sampleStart) * bytePerSample);\n      var tmp = new Uint8Array(header.byteLength + newData.byteLength);\n      tmp.set(new Uint8Array(header), 0);\n      tmp.set(new Uint8Array(newData), header.byteLength);\n      return tmp.buffer;\n    };\n    /**\n\t\t * play audio from to specified in samples\n\t\t *\n\t\t * @param sampleStart number that represents start sample\n\t\t * @param endSample number that represents end sample\n\t\t * */\n    sServObj.playFromTo = function (sampleStart, endSample) {\n      var cutWavBuff = this.extractRelPartOfWav(sampleStart, endSample);\n      if (sServObj.isPlaying) {\n        sServObj.isPlaying = false;\n        curSource.stop(0);\n      } else {\n        sServObj.isPlaying = true;\n        if (cutWavBuff.byteLength > 44) {\n          // if wav file is bigger than just the header (a.k.a. data block is empty)\n          sServObj.decodeAndPlay(cutWavBuff);\n        }\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('drawssff', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'HistoryService',\n  'fontScaleService',\n  'loadedMetaDataService',\n  function ($timeout, viewState, ConfigProviderService, Ssffdataservice, HistoryService, fontScaleService, loadedMetaDataService) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function postLink(scope, element, atts) {\n        scope.trackName = atts.ssffTrackname;\n        scope.assTrackName = '';\n        scope.lastDraw = Date.now();\n        // add watch vars to scope\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.ssffds = Ssffdataservice;\n        scope.cps = ConfigProviderService;\n        scope.lmds = loadedMetaDataService;\n        ////////////////////\n        // observes\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          scope.trackName = val;\n        });\n        ////////////////////\n        // watches\n        //watch viewPort change\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n            scope.handleUpdate();\n          }\n          if (oldValue.windowWidth !== newValue.windowWidth) {\n            scope.handleUpdate();\n          }\n          if (oldValue.dragBarHeight !== newValue.dragBarHeight) {\n            scope.handleUpdate();\n          }\n        }, true);\n        //watch perspective change\n        scope.$watch('vs.curPerspectiveIdx', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch vs.curCorrectionToolNr change\n        scope.$watch('vs.curCorrectionToolNr', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch hists.\n        scope.$watch('hists.movesAwayFromLastSave', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch ssffds.data change\n        scope.$watch('ssffds.data.length', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch vs.spectroSettings change\n        scope.$watch('vs.spectroSettings', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //\n        scope.$watch('vs.submenuOpen', function (oldValue, newValue) {\n          if (oldValue !== newValue) {\n            $timeout(scope.handleUpdate, ConfigProviderService.design.animation.duration);\n          }\n        });\n        //\n        scope.$watch('vs.timelineSize', function (oldValue, newValue) {\n          if (oldValue !== newValue) {\n            $timeout(scope.handleUpdate, ConfigProviderService.design.animation.duration / 10);\n          }\n        });\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n            scope.handleUpdate();\n          }\n        }, true);\n        //\n        //////////////////////\n        /**\n         *\n         */\n        scope.handleUpdate = function () {\n          var ctx = element[0].getContext('2d');\n          ctx.clearRect(0, 0, element[0].width, element[0].height);\n          if (!$.isEmptyObject(Ssffdataservice.data)) {\n            if (Ssffdataservice.data.length !== 0) {\n              scope.assTrackName = '';\n              // check assignments (= overlays)\n              ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign.forEach(function (ass, i) {\n                if (ass.signalCanvasName === scope.trackName) {\n                  scope.assTrackName = ass.ssffTrackName;\n                  var tr = ConfigProviderService.getSsffTrackConfig(ass.ssffTrackName);\n                  var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                  var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                  // draw values\n                  scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n                }\n              });\n              scope.assTrackName = '';\n              // draw ssffTrack onto own canvas\n              if (scope.trackName !== 'OSCI' && scope.trackName !== 'SPEC') {\n                var tr = ConfigProviderService.getSsffTrackConfig(scope.trackName);\n                var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                // draw values\n                scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n              }\n            }\n          } else {\n            ctx.clearRect(0, 0, element[0].width, element[0].height);\n          }\n        };\n        /**\n         * draw values onto canvas\n         */\n        scope.drawValues = function (viewState, canvas, config, col, sR, sT, minMaxLims) {\n          var ctx = canvas.getContext('2d');\n          var minVal, maxVal;\n          if (scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n            minVal = viewState.spectroSettings.rangeFrom;\n            maxVal = viewState.spectroSettings.rangeTo;\n          } else {\n            minVal = col._minVal;\n            maxVal = col._maxVal;\n          }\n          var startTimeVP = viewState.getViewPortStartTime();\n          var endTimeVP = viewState.getViewPortEndTime();\n          var colStartSampleNr = Math.round(startTimeVP * sR + sT);\n          var colEndSampleNr = Math.round(endTimeVP * sR + sT);\n          var nrOfSamples = colEndSampleNr - colStartSampleNr;\n          var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n          if (nrOfSamples < canvas.width && nrOfSamples >= 2) {\n            var x, y, prevX, prevY, prevVal, curSampleInCol, curSampleInColTime;\n            ////////////////////////////////\n            // NEW VERSION\n            ////////////////////////////////\n            angular.forEach(curSampleArrs[0], function (contourVal, contourNr) {\n              // console.log(contourNr);\n              if ($.isEmptyObject(minMaxLims) || contourNr >= minMaxLims.minContourIdx && contourNr <= minMaxLims.maxContourIdx) {\n                // set color\n                if ($.isEmptyObject(minMaxLims)) {\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                } else {\n                  var l = minMaxLims.maxContourIdx - minMaxLims.minContourIdx + 1;\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                }\n                // overwrite color settings if they are preconfigured\n                var contColors = ConfigProviderService.getContourColorsOfTrack(scope.assTrackName);\n                if (contColors !== undefined) {\n                  if (contColors.colors[contourNr] !== undefined) {\n                    ctx.strokeStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                    ctx.fillStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                  }\n                }\n                // mark selected\n                // console.log(viewState.curCorrectionToolNr);\n                if (viewState.curCorrectionToolNr - 1 === contourNr && scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n                  ctx.strokeStyle = ConfigProviderService.design.color.green;\n                  ctx.fillStyle = ConfigProviderService.design.color.green;\n                }\n                ctx.beginPath();\n                // first line from sample not in view (left)\n                if (colStartSampleNr >= 1) {\n                  var leftBorder = col.values[colStartSampleNr - 1];\n                  var leftVal = leftBorder[contourNr];\n                  curSampleInCol = colStartSampleNr - 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (leftVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.moveTo(x, y);\n                }\n                angular.forEach(curSampleArrs, function (curArr, curArrIdx) {\n                  // console.log(curArr[contourNr]);\n                  curSampleInCol = colStartSampleNr + curArrIdx;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (curArr[contourNr] - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                  ctx.lineTo(x, y);\n                });\n                // last line from sample not in view (right)\n                if (colEndSampleNr < col.values.length - 1) {\n                  var rightBorder = col.values[colEndSampleNr + 1];\n                  var rightVal = rightBorder[contourNr];\n                  curSampleInCol = colEndSampleNr + 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (rightVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.lineTo(x, y);\n                }\n                ctx.stroke();  // ctx.fill();\n              }\n            });\n          } else {\n            ctx.strokeStyle = 'red';\n            if (nrOfSamples <= 2) {\n              fontScaleService.drawUndistortedTextTwoLines(ctx, 'Zoom out to', 'see contour(s)', ConfigProviderService.design.font.small.size.slice(0, -2) / 1.05, ConfigProviderService.design.font.small.family, canvas.width / 2 - ctx.measureText('see contour(s)').width * ctx.canvas.width / ctx.canvas.offsetWidth / 2, 25, ConfigProviderService.design.color.transparent.red);\n            } else {\n              fontScaleService.drawUndistortedTextTwoLines(ctx, 'Zoom in to', 'see contour(s)', ConfigProviderService.design.font.small.size.slice(0, -2) / 1.05, ConfigProviderService.design.font.small.family, canvas.width / 2 - ctx.measureText('see contour(s)').width * ctx.canvas.width / ctx.canvas.offsetWidth / 2, 25, ConfigProviderService.design.color.transparent.red);\n            }\n          }\n        }  //function\n;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffparserservice', [\n  '$q',\n  function Ssffparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new ssffParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e);\n      } else {\n        defer.reject(e);\n      }\n    }, false);\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseSsffArr = function (ssffArray) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseArr',\n        'ssffArr': ssffArray\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * convert jso to ssff binary file using webworker\n\t\t * @param java script object of ssff file (internal rep)\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncJso2ssff = function (jso) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'jso2ssff',\n        'jso': JSON.stringify(jso)\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('mouseTrackAndCorrectionTool', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'Drawhelperservice',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, Drawhelperservice, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element, atts) {\n        var curMouseSample;\n        var canvas = element[0];\n        var ctx = canvas.getContext('2d');\n        var tr, col, sRaSt;\n        var trackName;\n        var bundleName;\n        /////////////////////////////\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        // bundleName needed to reset tr, col, sRaSt on bundle change\n        atts.$observe('bundleName', function (val) {\n          if (val) {\n            bundleName = val;\n            if (!$.isEmptyObject(Ssffdataservice.data)) {\n              if (Ssffdataservice.data.length !== 0) {\n                tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                if (tr !== undefined) {\n                  col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                }\n              }\n            }\n          }\n        });\n        /////////////////////////////\n        // Bindings\n        element.bind('mousedown', function (event) {\n          viewState.curViewPort.movingS = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          viewState.curViewPort.movingE = viewState.curViewPort.movingS;\n          viewState.select(viewState.curViewPort.movingS, viewState.curViewPort.movingE);\n          scope.switchMarkupContext(event);\n          scope.$apply();\n        });\n        element.bind('mousemove', function (event) {\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          // perform mouse tracking\n          var mouseX = viewState.getX(event);\n          viewState.curMousePosSample = Math.round(viewState.curViewPort.sS + mouseX / element[0].width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n          switch (mbutton) {\n          case 0:\n            if (viewState.getPermission('labelAction')) {\n              scope.switchMarkupContext(event);\n              if (!$.isEmptyObject(Ssffdataservice.data)) {\n                if (Ssffdataservice.data.length !== 0) {\n                  if (!viewState.getdragBarActive()) {\n                    if (viewState.curCorrectionToolNr !== undefined && !viewState.getdragBarActive() && !$.isEmptyObject(ConfigProviderService.getAssignment(trackName))) {\n                      // var col = Ssffdataservice.data[0].Columns[0];\n                      if (tr === undefined) {\n                        tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                      }\n                      col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                      sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                      var startTimeVP = viewState.getViewPortStartTime();\n                      var endTimeVP = viewState.getViewPortEndTime();\n                      var colStartSampleNr = Math.round(startTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var colEndSampleNr = Math.round(endTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n                      var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n                      var curMouseTime = startTimeVP + viewState.getX(event) / event.originalEvent.target.width * (endTimeVP - startTimeVP);\n                      var curMouseSample = Math.round((curMouseTime + sRaSt.startTime) * sRaSt.sampleRate) - 1;\n                      //-1 for in view correction\n                      var curMouseSampleTime = 1 / sRaSt.sampleRate * curMouseSample + sRaSt.startTime;\n                      if (curMouseSample - colStartSampleNr < 0 || curMouseSample - colStartSampleNr >= curSampleArrs.length) {\n                        //console.log('early return');\n                        return;\n                      }\n                      viewState.curPreselColumnSample = curMouseSample - colStartSampleNr;\n                      var x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                      var y = canvas.height - curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                      // draw sample\n                      ctx.strokeStyle = 'black';\n                      ctx.fillStyle = 'black';\n                      ctx.beginPath();\n                      ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                      ctx.closePath();\n                      ctx.stroke();\n                      ctx.fill();\n                      if (event.shiftKey) {\n                        var oldValue = angular.copy(curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1]);\n                        var newValue = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        // SIC only using rangeTo\n                        curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        var updateObj = HistoryService.updateCurChangeObj({\n                            'type': 'SSFF',\n                            'trackName': tr.name,\n                            'sampleBlockIdx': colStartSampleNr + viewState.curPreselColumnSample,\n                            'sampleIdx': viewState.curCorrectionToolNr - 1,\n                            'oldValue': oldValue,\n                            'newValue': newValue\n                          });\n                        //draw updateObj as overlay\n                        for (var key in updateObj) {\n                          curMouseSampleTime = 1 / sRaSt.sampleRate * updateObj[key].sampleBlockIdx + sRaSt.startTime;\n                          x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                          y = canvas.height - updateObj[key].newValue / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                          // draw sample\n                          ctx.strokeStyle = 'red';\n                          ctx.fillStyle = 'red';\n                          // ctx.lineWidth = 4;\n                          ctx.beginPath();\n                          ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                          ctx.closePath();\n                          ctx.stroke();\n                          ctx.fill();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            break;\n          case 1:\n            if (!viewState.getdragBarActive()) {\n              scope.setSelectDrag(event);\n            }\n            break;\n          }\n          scope.$apply();\n        });\n        /*\n\t\t\t\telement.bind('mouseup', function (event) {\n\t\t\t\t\tif (!viewState.getdragBarActive()) {\n\t\t\t\t\t\tscope.setSelectDrag(event);\n\t\t\t\t\t\tscope.switchMarkupContext(event, false);\n\t\t\t\t\t}\n\t\t\t\t});\n*/\n        // on mouse leave clear markup canvas\n        element.bind('mouseleave', function (event) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              if (!viewState.getdragBarActive()) {\n                if (viewState.getPermission('labelAction')) {\n                  scope.switchMarkupContext(event, false);\n                }\n              }\n            }\n          }\n        });\n        //\n        ////////////////////\n        // Functions\n        scope.switchMarkupContext = function (event, leave) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          // draw current viewport selected\n          if (atts.ssffTrackname == 'OSCI') {\n            Drawhelperservice.drawViewPortTimes(ctx, true);\n            Drawhelperservice.drawCurViewPortSelected(ctx, true);\n          } else if (atts.ssffTrackname == 'SPEC') {\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, '', viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 2);\n          } else {\n            var tr = ConfigProviderService.getSsffTrackConfig(atts.ssffTrackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, atts.ssffTrackname, col._minVal, col._maxVal, 2);\n          }\n          // draw crossHairs\n          if (leave !== false && ConfigProviderService.vals.restrictions.drawCrossHairs) {\n            Drawhelperservice.drawCrossHairs(ctx, event, viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 'Hz', atts.ssffTrackname);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n        };\n        scope.setSelectDrag = function (event) {\n          curMouseSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          if (curMouseSample > viewState.curViewPort.movingS) {\n            viewState.curViewPort.movingE = curMouseSample;\n          } else {\n            viewState.curViewPort.movingS = curMouseSample;\n          }\n          viewState.select(viewState.curViewPort.movingS, viewState.curViewPort.movingE);\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Drawhelperservice', [\n  'viewState',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'fontScaleService',\n  'Ssffdataservice',\n  'mathHelperService',\n  function Drawhelperservice(viewState, ConfigProviderService, Soundhandlerservice, fontScaleService, Ssffdataservice, mathHelperService) {\n    //shared service object to be returned\n    var sServObj = {};\n    function getScale(ctx, str, scale) {\n      return ctx.measureText(str).width * scale;\n    }\n    function getScaleWidth(ctx, str1, str2, scaleX) {\n      if (str1.toString().length > str2.toString().length) {\n        return getScale(ctx, str1, scaleX);\n      } else {\n        return getScale(ctx, str2, scaleX);\n      }\n    }\n    /**\n\t\t * drawing method to draw single line between two\n\t\t * envelope points. Is used by drawOsciOnCanvas if\n\t\t * envelope drawing is done\n\t\t * @param index\n\t\t * @param value\n\t\t * @param max\n\t\t * @param prevPeak\n\t\t * @param canvas\n\t\t */\n    function drawFrame(viewState, index, value, max, prevPeak, canvas, config) {\n      var ctx = canvas.getContext('2d');\n      //cur\n      var w = 1;\n      var h = Math.round(value * (canvas.height / max));\n      //rel to max\n      var x = index * w;\n      var y = Math.round((canvas.height - h) / 2);\n      //prev\n      // var prevW = 1;\n      var prevH = Math.round(prevPeak * (canvas.height / max));\n      var prevX = (index - 1) * w;\n      var prevY = Math.round((canvas.height - prevH) / 2);\n      ctx.strokeStyle = ConfigProviderService.design.color.black;\n      ctx.moveTo(prevX, prevY);\n      ctx.lineTo(x, y);\n    }\n    sServObj.osciPeaks = [];\n    /**\n\t\t * get current peaks to be drawn\n\t\t * if drawing over sample exact -> samples\n\t\t * if multiple samples per pixel -> calculate envelope points\n\t\t */\n    sServObj.calculatePeaks = function (viewState, canvas, data) {\n      var samplePerPx = (viewState.curViewPort.eS + 1 - viewState.curViewPort.sS) / canvas.width;\n      // PCM Samples per new pixel + one to correct for subtraction\n      var numberOfChannels = 1;\n      // hardcode for now...\n      var peaks = [];\n      var minPeak = Infinity;\n      var maxPeak = -Infinity;\n      var relData;\n      if (samplePerPx <= 1) {\n        // check if view at start\n        if (viewState.curViewPort.sS === 0) {\n          relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        } else {\n          relData = data.subarray(viewState.curViewPort.sS - 1, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        }\n        minPeak = Math.min.apply(Math, relData);\n        maxPeak = Math.max.apply(Math, relData);\n        peaks = Array.prototype.slice.call(relData);\n      } else {\n        relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        for (var curPxIdx = 0; curPxIdx < canvas.width; curPxIdx++) {\n          var avrVal = 0;\n          for (var c = 0; c < numberOfChannels; c++) {\n            var vals = relData.subarray(curPxIdx * samplePerPx, (curPxIdx + 1) * samplePerPx);\n            // var peak = -Infinity;\n            var sum = 0;\n            for (var p = 0, l = vals.length; p < l; p++) {\n              // if (vals[p] > peak) {\n              // \tpeak = vals[p];\n              // }\n              sum += vals[p];\n            }\n            avrVal += sum / vals.length;\n          }\n          peaks[curPxIdx] = avrVal;\n          if (avrVal > maxPeak) {\n            maxPeak = avrVal;\n          }\n        }\n      }\n      //else\n      return {\n        'peaks': peaks,\n        'minPeak': minPeak,\n        'maxPeak': maxPeak,\n        'samplePerPx': samplePerPx\n      };\n    };\n    /**\n\t\t * @param cps color provider service\n\t\t */\n    sServObj.freshRedrawDrawOsciOnCanvas = function (viewState, canvas, allPeakVals, buffer, config) {\n      var ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      //set font\n      // ctx.font = (this.params.fontPxSize + \"px\" + \" \" + this.params.fontType);\n      if (allPeakVals.peaks && allPeakVals.samplePerPx >= 1) {\n        ctx.beginPath();\n        allPeakVals.peaks.forEach(function (peak, index) {\n          if (index !== 0) {\n            drawFrame(viewState, index, peak, allPeakVals.maxPeak, allPeakVals.peaks[index - 1], canvas, config);\n          }\n        });\n        ctx.stroke();\n      } else if (allPeakVals.samplePerPx < 1) {\n        // console.log(\"at 0 over sample exact\")\n        var hDbS = 1 / allPeakVals.samplePerPx / 2;\n        // half distance between samples\n        var sNr = viewState.curViewPort.sS;\n        // over sample exact\n        ctx.strokeStyle = ConfigProviderService.design.color.black;\n        ctx.fillStyle = ConfigProviderService.design.color.black;\n        // ctx.beginPath();\n        var i;\n        if (viewState.curViewPort.sS === 0) {\n          ctx.moveTo(hDbS, (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.strokeText(sNr, i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        } else {\n          //draw lines\n          ctx.beginPath();\n          ctx.moveTo(-hDbS, canvas.height - (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx - hDbS, canvas.height - ((allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height + 3));\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.fillText(sNr, i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        }\n      }\n      if (config.vals.restrictions.drawZeroLine) {\n        // draw zero line\n        ctx.strokeStyle = ConfigProviderService.design.color.blue;\n        ctx.fillStyle = ConfigProviderService.design.color.blue;\n        // see if Chrome ->dashed line\n        //if (navigator.vendor === 'Google Inc.') {\n        //\tctx.setLineDash([2]);\n        //}\n        if (allPeakVals.samplePerPx >= 1) {\n          ctx.beginPath();\n          ctx.moveTo(0, canvas.height / 2);\n          ctx.lineTo(canvas.width, canvas.height / 2);\n          ctx.stroke();\n          ctx.fillText('0', 5, canvas.height / 2 - 5, canvas.width);\n        } else {\n          var zeroLineY = canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height;\n          ctx.beginPath();\n          ctx.moveTo(0, zeroLineY);\n          ctx.lineTo(canvas.width, zeroLineY);\n          ctx.stroke();\n          ctx.fill();\n          ctx.fillText('0', 5, canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 5, canvas.width);\n        }  // see if Chrome ->dashed line\n           //if (navigator.vendor === 'Google Inc.') {\n           //\tctx.setLineDash([0]);\n           //}\n      }\n    };\n    /**\n\t\t * drawing method to drawMovingBoundaryLine\n\t\t */\n    sServObj.drawMovingBoundaryLine = function (ctx) {\n      var xOffset, sDist;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      if (viewState.movingBoundary) {\n        ctx.fillStyle = ConfigProviderService.design.color.blue;\n        var p = Math.round(viewState.getPos(ctx.canvas.width, viewState.movingBoundarySample));\n        if (viewState.getcurMouseisLast()) {\n          ctx.fillRect(p + sDist, 0, 1, ctx.canvas.height);\n        } else {\n          ctx.fillRect(p + xOffset, 0, 1, ctx.canvas.height);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCurViewPortSelected\n\t\t */\n    sServObj.drawCurViewPortSelected = function (ctx, drawTimeAndSamples) {\n      var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n      var xOffset, sDist, space, horizontalText, scaleX;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'seg') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      var posS = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectS);\n      var posE = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectE);\n      if (posS === posE) {\n        ctx.fillStyle = ConfigProviderService.design.color.transparent.black;\n        ctx.fillRect(posS + xOffset, 0, 2, ctx.canvas.height);\n        if (drawTimeAndSamples) {\n          if (viewState.curViewPort.sS !== viewState.curViewPort.selectS && viewState.curViewPort.selectS !== -1) {\n            scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n            space = getScaleWidth(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n            fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), fontSize, ConfigProviderService.design.font.small.family, posE + 5, 0, ConfigProviderService.design.color.black, true);\n          }\n        }\n      } else {\n        ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n        ctx.fillRect(posS, 0, posE - posS, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.design.color.transparent.black;\n        ctx.beginPath();\n        ctx.moveTo(posS, 0);\n        ctx.lineTo(posS, ctx.canvas.height);\n        ctx.moveTo(posE, 0);\n        ctx.lineTo(posE, ctx.canvas.height);\n        ctx.closePath();\n        ctx.stroke();\n        if (drawTimeAndSamples) {\n          // start values\n          scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          space = getScaleWidth(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), fontSize, ConfigProviderService.design.font.small.family, posS - space - 5, 0, ConfigProviderService.design.color.black, false);\n          // end values\n          fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.selectE, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectE / Soundhandlerservice.wavJSO.SampleRate, 6), fontSize, ConfigProviderService.design.font.small.family, posE + 5, 0, ConfigProviderService.design.color.black, true);\n          // dur values\n          // check if space\n          space = getScale(ctx, mathHelperService.roundToNdigitsAfterDecPoint((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          if (posE - posS > space) {\n            var str1 = viewState.curViewPort.selectE - viewState.curViewPort.selectS - 1;\n            var str2 = mathHelperService.roundToNdigitsAfterDecPoint((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6);\n            space = getScaleWidth(ctx, str1, str2, scaleX);\n            fontScaleService.drawUndistortedTextTwoLines(ctx, str1, str2, fontSize, ConfigProviderService.design.font.small.family, posS + (posE - posS) / 2 - space / 2, 0, ConfigProviderService.design.color.black, false);\n          }\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCrossHairs\n\t\t */\n    sServObj.drawCrossHairs = function (ctx, mouseEvt, min, max, unit, trackname) {\n      // console.log(mathHelperService.roundToNdigitsAfterDecPoint(min, round))\n      if (ConfigProviderService.vals.restrictions.drawCrossHairs) {\n        var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n        // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.design.color.transparent.red;\n        ctx.fillStyle = ConfigProviderService.design.color.transparent.red;\n        // see if Chrome -> dashed line\n        //if (navigator.vendor === 'Google Inc.') {\n        //\tctx.setLineDash([2]);\n        //}\n        // draw lines\n        var mouseX = viewState.getX(mouseEvt);\n        var mouseY = viewState.getY(mouseEvt);\n        //if (navigator.vendor === 'Google Inc.') {\n        //\tctx.setLineDash([0]);\n        //}\n        // draw frequency / sample / time\n        ctx.font = ConfigProviderService.design.font.small.size + 'px ' + ConfigProviderService.design.font.small.family;\n        var mouseFreq = mathHelperService.roundToNdigitsAfterDecPoint(max - mouseY / ctx.canvas.height * max, 2);\n        // SIC only uses max\n        var tW = ctx.measureText(mouseFreq + unit).width * fontScaleService.scaleX;\n        var s1 = Math.round(viewState.curViewPort.sS + mouseX / ctx.canvas.width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n        var s2 = mathHelperService.roundToNdigitsAfterDecPoint(viewState.getViewPortStartTime() + mouseX / ctx.canvas.width * (viewState.getViewPortEndTime() - viewState.getViewPortStartTime()), 6);\n        if (max !== undefined || min !== undefined) {\n          if (trackname == 'OSCI') {\n            // no horizontal values\n            ctx.beginPath();\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(5, mouseY + 5);\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(ctx.canvas.width, mouseY);\n            //ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else if (trackname == 'SPEC') {\n            fontScaleService.drawUndistortedText(ctx, mouseFreq + unit, fontSize, ConfigProviderService.design.font.small.family, 5, mouseY, ConfigProviderService.design.color.transparent.red, true);\n            fontScaleService.drawUndistortedText(ctx, mouseFreq + unit, fontSize, ConfigProviderService.design.font.small.family, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, ConfigProviderService.design.color.transparent.red, true);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else {\n            // draw min max an name of track\n            var tr = ConfigProviderService.getSsffTrackConfig(trackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            mouseFreq = col._maxVal - mouseY / ctx.canvas.height * (col._maxVal - col._minVal);\n            mouseFreq = mathHelperService.roundToNdigitsAfterDecPoint(mouseFreq, 2);\n            // crop\n            fontScaleService.drawUndistortedText(ctx, mouseFreq, fontSize, ConfigProviderService.design.font.small.family, 5, mouseY, ConfigProviderService.design.color.transparent.red, true);\n            fontScaleService.drawUndistortedText(ctx, mouseFreq, fontSize, ConfigProviderService.design.font.small.family, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, ConfigProviderService.design.color.transparent.red, true);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          }\n        }\n        fontScaleService.drawUndistortedTextTwoLines(ctx, s1, s2, fontSize, ConfigProviderService.design.font.small.family, mouseX + 5, 0, ConfigProviderService.design.color.transparent.red, true);\n      }\n    };\n    /**\n\t\t * drawing method to drawMinMaxAndName\n\t\t * @param ctx is context to be drawn on\n\t\t * @param trackName name of track to be drawn in the center of the canvas (left aligned)\n\t\t * @param min value to be drawn at the bottom of the canvas (left aligned)\n\t\t * @param max value to be drawn at the top of the canvas (left aligned)\n\t\t * @param round value to round to for min/max values (== digits after comma)\n\t\t */\n    sServObj.drawMinMaxAndName = function (ctx, trackName, min, max, round) {\n      // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      ctx.strokeStyle = ConfigProviderService.design.color.black;\n      ctx.fillStyle = ConfigProviderService.design.color.black;\n      var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n      // var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var smallFontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 3 / 4;\n      var th = smallFontSize * scaleY;\n      // draw corner pointers\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(0, ctx.canvas.height);\n      ctx.lineTo(5, ctx.canvas.height - 5);\n      ctx.stroke();\n      ctx.closePath();\n      // draw trackName\n      if (trackName !== '') {\n        fontScaleService.drawUndistortedText(ctx, trackName, fontSize, ConfigProviderService.design.font.small.family, 0, ctx.canvas.height / 2 - fontSize * scaleY / 2, ConfigProviderService.design.color.black);\n      }\n      // draw min/max vals\n      if (max !== undefined) {\n        fontScaleService.drawUndistortedText(ctx, 'max: ' + mathHelperService.roundToNdigitsAfterDecPoint(max, round), smallFontSize, ConfigProviderService.design.font.small.family, 5, 5, ConfigProviderService.design.color.grey);\n      }\n      // draw min/max vals\n      if (min !== undefined) {\n        fontScaleService.drawUndistortedText(ctx, 'min: ' + mathHelperService.roundToNdigitsAfterDecPoint(min, round), smallFontSize, ConfigProviderService.design.font.small.family, 5, ctx.canvas.height - th - 5, ConfigProviderService.design.color.grey);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.drawViewPortTimes = function (ctx) {\n      ctx.strokeStyle = ConfigProviderService.design.color.black;\n      ctx.fillStyle = ConfigProviderService.design.color.black;\n      ctx.font = ConfigProviderService.design.font.small.size + ' ' + ConfigProviderService.design.font.small.family;\n      var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n      // lines to corners\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(ctx.canvas.width, 0);\n      ctx.lineTo(ctx.canvas.width - 5, 5);\n      ctx.closePath();\n      ctx.stroke();\n      var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var sTime;\n      var eTime;\n      var horizontalText;\n      var space;\n      if (viewState.curViewPort) {\n        //draw time and sample nr\n        sTime = mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.sS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        eTime = mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.eS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.sS, sTime, fontSize, ConfigProviderService.design.font.small.family, 5, 5, ConfigProviderService.design.color.black, true);\n        space = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n        fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.eS, eTime, fontSize, ConfigProviderService.design.font.small.family, ctx.canvas.width - space - 5, 0, ConfigProviderService.design.color.black, false);\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HistoryService', [\n  '$log',\n  '$compile',\n  'Ssffdataservice',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'viewState',\n  'Soundhandlerservice',\n  function HistoryService($log, $compile, Ssffdataservice, LevelService, LinkService, ConfigProviderService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    sServObj.movesAwayFromLastSave = 0;\n    //////////////////////////////////////////\n    // new dual stack implementation\n    // private\n    var undoStack = [];\n    var redoStack = [];\n    var curChangeObj = {};\n    // applyChanges should be called by undo redo functions\n    function applyChange(changeObj, applyOldVal) {\n      Object.keys(changeObj).forEach(function (key) {\n        var cur = changeObj[key];\n        if (cur.type === 'SSFF') {\n          if (applyOldVal) {\n            sServObj.setHistoryActionText(true, 'SSFF manipulation');\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.oldValue;\n          } else {\n            sServObj.setHistoryActionText(false, 'SSFF manipulation');\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.newValue;\n          }\n        } else if (cur.type === 'ANNOT') {\n          var action = false;\n          switch (cur.action) {\n          case 'MOVEBOUNDARY':\n            if (applyOldVal) {\n              action = true;\n              LevelService.moveBoundary(cur.name, cur.id, -cur.movedBy, cur.isFirst, cur.isLast);\n            } else {\n              LevelService.moveBoundary(cur.name, cur.id, cur.movedBy, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'MOVESEGMENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.moveSegment(cur.name, cur.id, cur.length, -cur.movedBy);\n            } else {\n              LevelService.moveSegment(cur.name, cur.id, cur.length, cur.movedBy);\n            }\n            break;\n          case 'MOVEEVENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.moveEvent(cur.name, cur.id, -cur.movedBy);\n            } else {\n              LevelService.moveEvent(cur.name, cur.id, cur.movedBy);\n            }\n            break;\n          case 'RENAMELABEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.oldValue);\n            } else {\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.newValue);\n            }\n            break;\n          case 'RENAMELEVEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.renameLevel(cur.newname, cur.name, cur.curPerspectiveIdx);\n            } else {\n              LevelService.renameLevel(cur.name, cur.newname, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETELEVEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            } else {\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETEBOUNDARY':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteBoundaryInvers(cur.name, cur.id, cur.isFirst, cur.isLast, cur.deletedSegment);\n            } else {\n              LevelService.deleteBoundary(cur.name, cur.id, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'DELETESEGMENTS':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteSegmentsInvers(cur.name, cur.id, cur.length, cur.deletedSegment);\n            } else {\n              LevelService.deleteSegments(cur.name, cur.id, cur.length);\n            }\n            break;\n          case 'DELETEEVENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            } else {\n              LevelService.deleteEvent(cur.name, cur.id);\n            }\n            break;\n          case 'DELETELINKSTO':\n            if (applyOldVal) {\n              action = true;\n              LinkService.insertLinksTo(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinksTo(cur.id);\n            }\n            break;\n          case 'DELETELINKBOUNDARY':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLinkBoundaryInvers(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinkBoundary(cur.id, cur.neighbourId);\n            }\n            break;\n          case 'DELETELINKSEGMENT':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLinkSegmentInvers(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinkSegment(cur.segments);\n            }\n            break;\n          case 'INSERTLEVEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            } else {\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'INSERTSEGMENTS':\n            if (applyOldVal) {\n              action = true;\n              LevelService.insertSegmentInvers(cur.name, cur.start, cur.end, cur.segName);\n            } else {\n              LevelService.insertSegment(cur.name, cur.start, cur.end, cur.segName, cur.ids);\n            }\n            break;\n          case 'INSERTEVENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteEvent(cur.name, cur.id);\n            } else {\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            }\n            break;\n          case 'INSERTLINKSTO':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLinksTo(cur.parentID, cur.childIDs);\n            } else {\n              LinkService.insertLinksTo(cur.parentID, cur.childIDs);\n            }\n            break;\n          case 'EXPANDSEGMENTS':\n            if (applyOldVal) {\n              action = true;\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, -cur.changeTime);\n            } else {\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, cur.changeTime);\n            }\n            break;\n          }\n          sServObj.setHistoryActionText(action, cur.action);\n        } else if (cur.type === 'HIERARCHY') {\n          var action = false;\n          switch (cur.action) {\n          case 'DELETELINK':\n            // The order of links is not preserved on undo\n            if (applyOldVal) {\n              action = true;\n              LinkService.insertLinkAt(cur.fromID, cur.toID, cur.position);\n            } else {\n              LinkService.deleteLink(cur.fromID, cur.toID);\n            }\n            break;\n          case 'DELETEITEM':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteItemWithLinksInvers(cur.item, cur.levelName, cur.position, cur.deletedLinks);\n            } else {\n              LevelService.deleteItemWithLinks(cur.item.id);\n            }\n            break;\n          case 'ADDITEM':\n            if (applyOldVal) {\n              action = true;\n              LevelService.addItemInvers(cur.newID);\n            } else {\n              LevelService.addItem(cur.neighborID, cur.before, cur.newID);\n            }\n            break;\n          case 'ADDLINK':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLink(cur.link.fromID, cur.link.toID);\n            } else {\n              LinkService.insertLink(cur.link.fromID, cur.link.toID);\n            }\n            break;\n          case 'PUSHITEM':\n            if (applyOldVal) {\n              action = true;\n              LevelService.addItemInvers(cur.newID);\n            } else {\n              LevelService.pushNewItem(cur.level, cur.newID);\n            }\n            break;\n          }\n          sServObj.setHistoryActionText(action, cur.action);\n        }\n      });\n    }\n    /////////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.updateCurChangeObj = function (dataObj) {\n      // console.log(dataObj);\n      var dataKey;\n      if (dataObj.type === 'SSFF') {\n        dataKey = String(dataObj.type + '#' + dataObj.trackName) + '#' + String(dataObj.sampleBlockIdx) + '#' + String(dataObj.sampleIdx);\n        // update curChangeObj\n        if (!curChangeObj[dataKey]) {\n          curChangeObj[dataKey] = dataObj;\n        } else {\n          dataObj.oldValue = curChangeObj[dataKey].oldValue;\n          curChangeObj[dataKey] = dataObj;\n        }\n      } else if (dataObj.type === 'ANNOT') {\n        switch (dataObj.action) {\n        case 'MOVEBOUNDARY':\n        case 'MOVEEVENT':\n        case 'MOVESEGMENT':\n        case 'INSERTEVENT':\n        case 'DELETEEVENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name + '#' + dataObj.id);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.movedBy += curChangeObj[dataKey].movedBy;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        case 'INSERTLINKSTO':\n        case 'DELETELINKSTO':\n        case 'DELETELINKBOUNDARY':\n        case 'DELETELINKSEGMENT':\n        case 'DELETEBOUNDARY':\n        case 'DELETESEGMENTS':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.oldValue = curChangeObj[dataKey].oldValue;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        }\n      }\n      return curChangeObj;\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addCurChangeObjToUndoStack = function () {\n      // empty redo stack\n      redoStack = [];\n      // add to undoStack\n      if (!$.isEmptyObject(curChangeObj)) {\n        undoStack.push(curChangeObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      $log.info(curChangeObj);\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addObjToUndoStack = function (obj) {\n      // empty redo stack\n      redoStack = [];\n      var tmpObj = {};\n      var dataKey = String(obj.type + '#' + obj.action + '#' + obj.name + '#' + obj.id);\n      tmpObj[dataKey] = angular.copy(obj);\n      // add to undoStack\n      if (!$.isEmptyObject(tmpObj)) {\n        undoStack.push(tmpObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // undo\n    sServObj.undo = function () {\n      if (undoStack.length > 0) {\n        // add to redo stack\n        var oldChangeObj = angular.copy(undoStack[undoStack.length - 1]);\n        redoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, true);\n        // remove old\n        undoStack.pop();\n        sServObj.movesAwayFromLastSave -= 1;\n      }\n    };\n    // redo\n    sServObj.redo = function () {\n      if (redoStack.length > 0) {\n        var oldChangeObj = angular.copy(redoStack[redoStack.length - 1]);\n        undoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, false);\n        redoStack.pop();\n        sServObj.movesAwayFromLastSave += 1;\n      }\n    };\n    // getNrOfPossibleUndos\n    sServObj.getNrOfPossibleUndos = function () {\n      return undoStack.length;\n    };\n    // return current History Stack\n    sServObj.getCurrentStack = function () {\n      return {\n        'undo': undoStack,\n        'redo': redoStack\n      };\n    };\n    // set the displayed text of the historyActionPopup\n    sServObj.setHistoryActionText = function (isUndo, text) {\n      var front = '<i>UNDO</i> &#8594; ';\n      if (!isUndo) {\n        front = '<i>REDO</i> &#8592; ';\n      }\n      viewState.historyActionTxt = front + text;\n    };\n    // resetToInitState\n    sServObj.resetToInitState = function () {\n      undoStack = [];\n      redoStack = [];\n      curChangeObj = {};\n      sServObj.movesAwayFromLastSave = 0;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Wavparserservice', [\n  '$q',\n  function Wavparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new wavParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e);\n      }\n    });\n    /**\n\t\t * parse buffer containing wav file using webworker\n\t\t * @param buf\n\t\t * @returns promise\n\t\t */\n    sServObj.parseWavArrBuf = function (buf) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseBuf',\n        'buffer': buf\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Textgridparserservice', [\n  '$q',\n  'DataService',\n  'viewState',\n  'Soundhandlerservice',\n  function Textgridparserservice($q, DataService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new textGridParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse level data to Textgrid File\n\t\t * @param level data\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncToTextGrid = function () {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'toTextGrid',\n        'levels': DataService.getData().levels,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'buffLength': Soundhandlerservice.wavJSO.Data.length\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseTextGrid = function (textGrid, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseTG',\n        'textGrid': textGrid,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('uuid', function () {\n  // shared service object\n  var sServObj = {};\n  function rand(s) {\n    var p = (Math.random().toString(16) + '000000000').substr(2, 8);\n    return s ? '-' + p.substr(0, 4) + '-' + p.substr(4, 4) : p;\n  }\n  //\n  sServObj.new = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  sServObj.newHash = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  //\n  sServObj.empty = function () {\n    return '00000000-0000-0000-0000-000000000000';\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').factory('browserDetector', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  sServObj.isMobile = {\n    Android: function () {\n      return navigator.userAgent.match(/Android/i);\n    },\n    BlackBerry: function () {\n      return navigator.userAgent.match(/BlackBerry/i);\n    },\n    iOS: function () {\n      return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera Mini/i);\n    },\n    Windows: function () {\n      return navigator.userAgent.match(/IEMobile/i);\n    },\n    any: function () {\n      return sServObj.isMobile.Android() || sServObj.isMobile.BlackBerry() || sServObj.isMobile.iOS() || sServObj.isMobile.Opera() || sServObj.isMobile.Windows();\n    }\n  };\n  sServObj.isBrowser = {\n    Firefox: function () {\n      return navigator.userAgent.match(/Firefox/i);\n    },\n    Chrome: function () {\n      return navigator.userAgent.match(/Chrome/i);\n    },\n    InternetExplorer: function () {\n      return navigator.userAgent.match(/MSIE/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera/i);\n    },\n    PhantomJS: function () {\n      return navigator.userAgent.match(/PhantomJS/i);\n    },\n    any: function () {\n      return sServObj.isBrowser.Firefox() || sServObj.isBrowser.Chrome() || sServObj.isBrowser.InternetExplorer() || sServObj.isBrowser.Opera() || sServObj.isBrowser.PhantomJS();\n    }\n  };\n  sServObj.isMobileDevice = function () {\n    var data = sServObj.isMobile.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  sServObj.isDesktopDevice = function () {\n    var data = sServObj.isBrowser.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('fontScaleService', function fontScaleService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.lastTextWidth = null;\n  sServObj.spaceTop = 0;\n  sServObj.scaleY = 0;\n  sServObj.scaleX = 0;\n  /**\n\t\t *\n\t\t */\n  sServObj.drawUndistortedText = function (ctxOriginal, text, fontPxSize, fontType, x, y, color) {\n    sServObj.scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    sServObj.scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    ctxOriginal.save();\n    ctxOriginal.font = fontPxSize + 'px' + ' ' + fontType;\n    ctxOriginal.scale(sServObj.scaleX, sServObj.scaleY);\n    ctxOriginal.fillStyle = color;\n    ctxOriginal.fillText(text, x / sServObj.scaleX, (y + fontPxSize + sServObj.spaceTop) / sServObj.scaleY);\n    ctxOriginal.scale(1, 1);\n    ctxOriginal.restore();\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.drawUndistortedTextTwoLines = function (ctxOriginal, text, text2, fontPxSize, fontType, x, y, color, alignLeft) {\n    sServObj.scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    sServObj.scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    ctxOriginal.save();\n    ctxOriginal.font = fontPxSize + 'px' + ' ' + fontType;\n    ctxOriginal.fillStyle = color;\n    ctxOriginal.scale(sServObj.scaleX, sServObj.scaleY);\n    if (alignLeft) {\n      ctxOriginal.fillText(text, x / sServObj.scaleX, y + fontPxSize + sServObj.spaceTop);\n      ctxOriginal.fillText(text2, x / sServObj.scaleX, y + 2 * fontPxSize + sServObj.spaceTop);\n    } else {\n      var a = ctxOriginal.measureText(text).width;\n      var b = ctxOriginal.measureText(text2).width;\n      // var c;\n      if (a > b) {\n        ctxOriginal.fillText(text, x / sServObj.scaleX, y + fontPxSize + sServObj.spaceTop);\n        ctxOriginal.fillText(text2, (x + (a - b)) / sServObj.scaleX, y + 2 * fontPxSize + sServObj.spaceTop);\n      } else {\n        ctxOriginal.fillText(text, (x + (b - a)) / sServObj.scaleX, y + fontPxSize + sServObj.spaceTop);\n        ctxOriginal.fillText(text2, x / sServObj.scaleX, y + 2 * fontPxSize + sServObj.spaceTop);\n      }\n    }\n    ctxOriginal.restore();\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Espsparserservice', [\n  '$q',\n  'LevelService',\n  'Soundhandlerservice',\n  function Espsparserservice($q, LevelService, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new espsParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse ESPS file using webworker\n\t\t * @param esps\n\t\t * @param annotates\n\t\t * @param name\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseEsps = function (esps, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseESPS',\n        'esps': esps,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse JSO data to ESPS file using webworker\n\t\t * @param name\n\t\t * @param sampleRate\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseJSO = function (name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseJSO',\n        'level': LevelService.getLevelDetails(name),\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('LoginCtrl', [\n  '$scope',\n  '$rootScope',\n  '$http',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'modalService',\n  function ($scope, $rootScope, $http, ConfigProviderService, Iohandlerservice, viewState, modalService) {\n    $scope.loginData = {\n      'username': '',\n      'password': '',\n      'errorMsg': ''\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.tryLogin = function () {\n      Iohandlerservice.logOnUser($scope.loginData.username, $scope.loginData.password).then(function (res) {\n        if (res === 'LOGGEDON') {\n          modalService.confirm();\n        } else {\n          $scope.loginData.errorMsg = 'ERROR: ' + res;\n        }\n      });\n    };\n    // FOR DEVELOPMENT\n    // $scope.tryLogin(); // for autologin uncomment and set username + password\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      modalService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffdataservice', [\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  function Ssffdataservice(viewState, Soundhandlerservice, ConfigProviderService) {\n    // shared service object\n    var sServObj = {};\n    // stores files referred to by ssffTrackDefinitions\n    sServObj.data = [];\n    /////////////////////\n    // public API\n    /**\n\t\t * Search through ssffTrackDefinitions to find correct\n\t\t * file. Then search thought data and return file.\n\t\t * @param trackName name of track to get file for\n\t\t */\n    sServObj.getFile = function (trackName) {\n      var res;\n      if (ConfigProviderService.curDbConfig.ssffTrackDefinitions !== undefined) {\n        ConfigProviderService.curDbConfig.ssffTrackDefinitions.forEach(function (std) {\n          if (std.name === trackName) {\n            sServObj.data.forEach(function (f) {\n              if (f.fileExtension === std.fileExtension) {\n                res = f;\n              }\n            });\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getColumnOfTrack = function (trackName, columnName) {\n      var res;\n      var file = sServObj.getFile(trackName);\n      if (file !== undefined) {\n        file.Columns.forEach(function (col) {\n          if (col.name === columnName) {\n            res = col;\n          }\n        });\n        return res;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSampleRateAndStartTimeOfTrack = function (trackName) {\n      var res = {};\n      var file = sServObj.getFile(trackName);\n      if (file !== undefined) {\n        res.sampleRate = file.sampleRate;\n        res.startTime = file.startTime;\n        return res;\n      }\n    };\n    /**\n\t\t * calculates the closest audio sample of\n\t\t * the passed in column sample nr\n\t\t */\n    sServObj.calculateSamplePosInVP = function (colSampleNr, sampleRate, startTime) {\n      var sampleTime = colSampleNr / sampleRate + startTime;\n      var audioSample = Math.round(sampleTime * Soundhandlerservice.wavJSO.SampleRate);\n      return audioSample;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DataService', function DataService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.data = {};\n  sServObj.maxItemID = 0;\n  ///////////////////////////////\n  // public api\n  /**\n\t\t * returns all the data\n\t\t * @return the data\n\t\t */\n  sServObj.getData = function () {\n    return sServObj.data;\n  };\n  /**\n\t\t * sets all the level data\n\t\t * @param data containing all level data\n\t\t */\n  sServObj.setLevelData = function (data) {\n    sServObj.data.levels = data;\n  };\n  /**\n\t\t * returns all the level data\n\t\t * @return data containing all level data\n\t\t */\n  sServObj.getLevelData = function () {\n    return sServObj.data.levels;\n  };\n  /**\n\t\t * returns a specific level at given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.getLevelDataAt = function (position) {\n    return sServObj.data.levels[position];\n  };\n  /**\n\t\t * inserts a single level into level data at a given position\n\t\t * @param position of the level in the level array\n\t\t * @param newLevel the new level to insert\n\t\t */\n  sServObj.insertLevelDataAt = function (position, newLevel) {\n    sServObj.data.levels.splice(position, 0, newLevel);\n  };\n  /**\n\t\t * deletes a single level from level data at a given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.deleteLevelDataAt = function (position) {\n    sServObj.data.levels.splice(position, 1);\n  };\n  /**\n\t\t * returns all the link data\n\t\t * @return the data\n\t\t */\n  sServObj.getLinkData = function () {\n    return sServObj.data.links;\n  };\n  /**\n\t\t * sets all the link data\n\t\t * @param data containing all link data\n\t\t */\n  sServObj.setLinkData = function (data) {\n    sServObj.data.links = data;\n  };\n  /**\n\t\t * inserts a single link into link data by pushing it\n\t\t * on to the array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkData = function (newLink) {\n    sServObj.data.links.push(newLink);\n  };\n  /**\n\t\t * deletes a single link from link data at a given position\n\t\t * @param position of the link in the link array\n\t\t */\n  sServObj.deleteLinkDataAt = function (position) {\n    sServObj.data.links.splice(position, 1);\n  };\n  /**\n\t\t * inserts a single link into link data at a given position\n\t\t * @param position of the link in the link array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkDataAt = function (position, newLink) {\n    sServObj.data.links.splice(position, 0, newLink);\n  };\n  /**\n\t\t * changes a single link at a given position with new data\n\t\t * @param position of the link in the link array\n\t\t * @param fromNewID the new fromID of the link\n\t\t * @param toNewID the new toID of the link\n\t\t */\n  sServObj.changeLinkDataAt = function (position, fromNewID, toNewID) {\n    sServObj.data.links[position].fromID = fromNewID;\n    sServObj.data.links[position].toID = toNewID;\n  };\n  /**\n\t\t * sets annotation data and sets maxItemID\n\t\t * by parsing id in elements\n\t\t * should be used to fill links and levels\n\t\t * @param the data\n\t\t */\n  sServObj.setData = function (data) {\n    angular.copy(data, sServObj.data);\n    angular.forEach(sServObj.data.levels, function (level) {\n      level.items.forEach(function (item) {\n        if (item.id > sServObj.maxItemID) {\n          sServObj.maxItemID = item.id;\n        }\n      });\n    });\n  };\n  /**\n\t\t * called externally by functions\n\t\t */\n  sServObj.getNewId = function () {\n    sServObj.maxItemID += 1;\n    return sServObj.maxItemID;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.raiseId = function (amount) {\n    sServObj.maxItemID += amount;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.lowerId = function (amount) {\n    sServObj.maxItemID -= amount;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('LevelService', [\n  '$q',\n  'DataService',\n  'LinkService',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'viewState',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  function LevelService($q, DataService, LinkService, ConfigProviderService, Soundhandlerservice, viewState, Ssffdataservice, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.lasteditArea = null;\n    // holding current edit area\n    sServObj.lasteditAreaElem = null;\n    // holding current edit area element\n    /**\n\t\t * search for the according label field in labels\n\t\t * and return its position\n\t\t *    @param attrDefName\n\t\t *    @param labels\n\t\t */\n    function getLabelIdx(attrDefName, labels) {\n      var labelIdx;\n      angular.forEach(labels, function (l, idx) {\n        if (l.name === attrDefName) {\n          labelIdx = idx;\n        }\n      });\n      return labelIdx;\n    }\n    /**\n\t\t * returns level details by passing in level name\n\t\t * if the corresponding level exists\n\t\t * otherwise returns 'null'\n\t\t *    @param name\n\t\t */\n    sServObj.getLevelDetails = function (name) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          ret = level;\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all levels with details for a specific type\n\t\t *    @param types\n\t\t */\n    sServObj.getLevelsByType = function (types) {\n      var levels = [];\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (types.indexOf(level.type) >= 0) {\n          levels.push(level);\n        }\n      });\n      return levels;\n    };\n    /**\n\t\t * gets element position inside a level with 'name'\n\t\t * by passing in the element id\n\t\t *    @param name\n\t\t *    @param id\n\t\t */\n    sServObj.getOrderById = function (name, id) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (e, num) {\n            if (e.id === id) {\n              ret = num;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets element id inside a level with 'name' by\n\t\t * passing in the element position/order\n\t\t *    @param name\n\t\t *    @param order\n\t\t */\n    sServObj.getIdByOrder = function (name, order) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num === order) {\n              ret = element.id;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets item details by passing in 'name' of level\n\t\t * and item position/order\n\t\t *    @param name\n\t\t *    @param order\n\t\t */\n    sServObj.getItemDetails = function (name, order) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          ret = level.items[order];\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns the last element inside a level with 'name'\n\t\t *    @param name\n\t\t */\n    sServObj.getLastItem = function (name) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          details = level.items[level.items.length - 1];\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * get next element of element with id in order/position\n\t\t * inside a level with 'name'\n\t\t *    @param name\n\t\t *    @param id\n\t\t */\n    sServObj.getNextItem = function (name, id) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (element.id === id) {\n              ret = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * get next or prev Element in time inside level with 'name'\n\t\t * after or bevore (boolean) an element with 'id'\n\t\t *    @param name\n\t\t *    @param id\n\t\t *    @param after\n\t\t */\n    sServObj.getItemInTime = function (name, id, after) {\n      var ret = null;\n      var timeDifference = Infinity;\n      var startItem = sServObj.getItemFromLevelById(name, id);\n      if (startItem !== null) {\n        var myStart = startItem.sampleStart || startItem.samplePoint;\n        angular.forEach(DataService.getLevelData(), function (level) {\n          if (level.name === name) {\n            level.items.forEach(function (element) {\n              var start = element.sampleStart || element.samplePoint;\n              if (after) {\n                if (start > myStart && start - myStart <= timeDifference) {\n                  timeDifference = start - myStart;\n                  ret = element;\n                }\n              } else {\n                if (start < myStart && myStart - start <= timeDifference) {\n                  timeDifference = myStart - start;\n                  ret = element;\n                }\n              }\n            });\n          }\n        });\n      }\n      return ret;\n    };\n    /**\n\t\t * returns item from a level with 'name' by passing in the item 'id'\n\t\t *    @param name\n\t\t *    @param id\n\t\t */\n    sServObj.getItemFromLevelById = function (name, id) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              ret = element;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * get all labels (curAttr def applies) of a level and\n\t\t * return them as a flat array\n\t\t * @param levelDetails containing labels\n\t\t * @return array containing all labels (form==['x','y','z'])\n\t\t */\n    sServObj.getAllLabelsOfLevel = function (levelDetails) {\n      var curAttrDef = viewState.getCurAttrDef(levelDetails.name);\n      var labels = [];\n      angular.forEach(levelDetails.items, function (item) {\n        var pos = item.labels.map(function (e) {\n            return e.name;\n          }).indexOf(curAttrDef);\n        if (pos >= 0) {\n          labels.push(item.labels[pos].value);\n        }\n      });\n      return labels;\n    };\n    /**\n\t\t * returns level name of a given node id\n\t\t * @param nodeID id of the node\n\t\t * @return name of the containing level\n\t\t */\n    sServObj.getLevelName = function (nodeID) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        var pos = level.items.map(function (e) {\n            return e.id;\n          }).indexOf(nodeID);\n        if (pos >= 0) {\n          ret = level.name;\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * Returns a level object and an item object according to a given item id\n\t\t * @param nodeID id of the node\n\t\t * @return object with level and item\n\t\t */\n    sServObj.getLevelAndItem = function (nodeID) {\n      var name = sServObj.getLevelName(nodeID);\n      if (name !== null) {\n        return {\n          level: sServObj.getLevelDetails(name),\n          item: sServObj.getItemByID(nodeID)\n        };\n      } else {\n        return null;\n      }\n    };\n    /**\n\t\t * Returns an item with a given id\n\t\t * @param nodeID id of the node\n\t\t * @return item with id\n\t\t */\n    sServObj.getItemByID = function (nodeID) {\n      var ret = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        var pos = level.items.map(function (e) {\n            return e.id;\n          }).indexOf(nodeID);\n        if (pos >= 0) {\n          ret = level.items[pos];\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns multiple item(s) from a level with 'name' by passing in\n\t\t * the start item 'id' and the length (how many objects to return)\n\t\t *    @param name\n\t\t *    @param id\n\t\t *    @param length\n\t\t */\n    sServObj.getItemsFromLevelByIdAndLength = function (name, id, length) {\n      var ret = [];\n      var lastID = id;\n      for (var j = 0; j < length; j++) {\n        var segment = sServObj.getItemFromLevelById(name, lastID);\n        lastID = sServObj.getNextItem(name, segment.id);\n        ret.push(segment);\n      }\n      return ret;\n    };\n    /**\n\t\t * Getter for last edit Area Element\n\t\t *   @return lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.getlasteditAreaElem = function () {\n      return sServObj.lasteditAreaElem;\n    };\n    /**\n\t\t * Setter for last edit Area Element\n\t\t *   @param lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.setlasteditAreaElem = function (e) {\n      sServObj.lasteditAreaElem = e;\n    };\n    /**\n\t\t * Setter for last edit Area\n\t\t *   @param lasteditAreaElem last edit Area\n\t\t */\n    sServObj.setlasteditArea = function (name) {\n      sServObj.lasteditArea = name;\n    };\n    /**\n\t\t * Getter for last edit Area\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlasteditArea = function () {\n      return sServObj.lasteditArea;\n    };\n    /**\n\t\t * Getter for id of last edited Element\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlastID = function () {\n      return sServObj.lasteditArea.substr(1);\n    };\n    /**\n\t\t * Remove currently open html textarea (if there is a textarea open)\n\t\t * and set viewState.editing to false.\n\t\t */\n    sServObj.deleteEditArea = function () {\n      if (null !== sServObj.getlasteditArea()) {\n        $('.' + sServObj.getlasteditArea()).remove();\n      }\n      viewState.editing = false;\n    };\n    /**\n\t\t * Calculate values (x,y,width,height) for textarea to open\n\t\t * depending on the current Level type, the current canvas\n\t\t * and the current clicked Element\n\t\t *   @param lastEventClick the current clicked Level Element\n\t\t *   @param element the current html Element to get canvas from\n\t\t *   @param type the current Level type\n\t\t */\n    sServObj.openEditArea = function (lastEventClick, element, type) {\n      var levelName = viewState.getcurClickLevelName();\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      // find labelIdx\n      var labelIdx = getLabelIdx(attrDefName, lastEventClick.labels);\n      var elem = element.find('canvas').context.getContext('2d');\n      var clientWidth = elem.canvas.clientWidth;\n      var clientOffset = elem.canvas.offsetLeft;\n      var top = elem.canvas.offsetTop;\n      var height = elem.canvas.clientHeight - 1;\n      var len = 10;\n      if (labelIdx !== undefined) {\n        if (lastEventClick.labels[labelIdx].value.length > 0) {\n          len = lastEventClick.labels[labelIdx].value.length * 7;\n        }\n      }\n      var editText = '';\n      if (lastEventClick.labels.length > 0) {\n        if (lastEventClick.labels[labelIdx] !== undefined) {\n          editText = lastEventClick.labels[labelIdx].value;\n        } else {\n          editText = '';\n        }\n      }\n      if (type === 'SEGMENT') {\n        var start = Math.floor(viewState.getPos(clientWidth, lastEventClick.sampleStart) + clientOffset);\n        var end = Math.ceil(viewState.getPos(clientWidth, lastEventClick.sampleStart + lastEventClick.sampleDur + 1) + clientOffset);\n        var width = end - start;\n        if (width < 2 * len) {\n          var zoom = viewState.curViewPort.eS - viewState.curViewPort.sS;\n          if (zoom <= 10) {\n            // if already zoomed in but text is still too long\n            sServObj.createEditAreaElement(element, start, top, end - start, height, lastEventClick.labels[labelIdx].value, lastEventClick.id);\n          } else {\n            viewState.zoomViewPort(true, this);\n            sServObj.openEditArea(lastEventClick, element, type);\n            return;\n          }\n        }\n        sServObj.createEditAreaElement(element, start, top, end - start, height, editText, lastEventClick.id);\n      } else {\n        var start = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset - len / 2;\n        var end = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset + len / 2;\n        var width = end - start;\n        if (width < 2 * len) {\n          width = 2 * len;\n        }\n        sServObj.createEditAreaElement(element, start, top, width, height, editText, lastEventClick.id);\n      }\n      sServObj.createSelection(element.find('textarea')[0], 0, editText.length);\n    };\n    /**\n\t\t * Create a Text Selection in a html Textarea\n\t\t *   @param field the textarea element\n\t\t *   @param start the starting character position as int\n\t\t *   @param end the ending character position as int\n\t\t */\n    sServObj.createSelection = function (field, start, end) {\n      if (field.createTextRange) {\n        var selRange = field.createTextRange();\n        selRange.collapse(true);\n        selRange.moveStart('character', start);\n        selRange.moveEnd('character', end);\n        selRange.select();\n      } else if (field.setSelectionRange) {\n        field.setSelectionRange(start, end);\n      } else if (field.selectionStart) {\n        field.selectionStart = start;\n        field.selectionEnd = end;\n      }\n      field.focus();\n    };\n    /**\n\t\t * create a html textarea element at given\n\t\t *   @param x the x Position\n\t\t *   @param y the y Position\n\t\t *   @param width the Width\n\t\t *   @param height the Height\n\t\t *   @param label the Text Content of the Textarea\n\t\t *   @param labelid the id of the element\n\t\t */\n    sServObj.createEditAreaElement = function (element, x, y, width, height, label, labelid) {\n      var textid = '_' + labelid;\n      element.prepend($('<textarea>').attr({\n        id: textid,\n        'class': textid + ' emuwebapp-label-edit',\n        'ng-model': 'message',\n        'autofocus': 'true'\n      }).css({\n        'left': Math.round(x + 2) + 'px',\n        'top': Math.round(y + 1) + 'px',\n        'width': Math.round(width) - 2 + 'px',\n        'height': Math.round(height) - 20 + 'px',\n        'padding-top': Math.round(height / 3 + 1) + 'px'\n      }).text(label));\n    };\n    /**\n\t\t * insert a new Item with id labelname start and duration at position on level\n\t\t */\n    sServObj.insertItemDetails = function (id, levelname, position, labelname, start, duration) {\n      var attrdefs = ConfigProviderService.getLevelDefinition(levelname).attributeDefinitions;\n      var curAttrDef = viewState.getCurAttrDef(levelname);\n      var newElement;\n      if (attrdefs === undefined) {\n        // ugly hack if attrdefs undefined\n        attrdefs = [];\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          if (level.type == 'SEGMENT') {\n            newElement = {\n              id: id,\n              sampleStart: start,\n              sampleDur: duration,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          } else if (level.type == 'EVENT') {\n            if (start !== undefined) {\n              newElement = {\n                id: id,\n                samplePoint: start,\n                labels: []\n              };\n            } else {\n              newElement = {\n                id: id,\n                labels: []\n              };\n            }\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          }\n          level.items.splice(position, 0, newElement);\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updateSegment = function (levelname, id, labelname, labelIdx, start, duration) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              if (start !== undefined) {\n                element.sampleStart = start;\n              }\n              if (duration !== undefined) {\n                element.sampleDur = duration;\n              }\n              if (labelname !== undefined) {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updatePoint = function (levelname, id, labelname, labelIdx, start) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              element.samplePoint = start;\n              if (labelIdx === undefined) {\n                element.labels[0].value = labelname;\n              } else {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * gets item details by passing in levelName and item id's\n\t\t */\n    sServObj.getItemNeighboursFromLevel = function (levelName, firstid, lastid) {\n      var left = undefined;\n      var right = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (itm, num) {\n            if (itm.id == firstid) {\n              left = level.items[num - 1];\n            }\n            if (itm.id == lastid) {\n              right = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return {\n        left: left,\n        right: right\n      };\n    };\n    /**\n\t\t * get item details by passing in level, sampleNr and maximum pcm\n\t\t *\n\t\t * @param level\n\t\t * @param sampleNr\n\t\t * @param maximum\n\t\t * @returns object of the form {current: item, nearest: item, isFirst: boolean, isLast: boolean} where\n\t\t * - current is the actual item where the mouse is\n\t\t * - nearest is the item next to the current one depending on where the mouse is (ie if over 50% right element, under 50% left element)\n\t\t * - isFirst is true if the mouse is before the first item\n\t\t * - isLast is true if the mouse is after the last item\n\t\t *\n\t\t */\n    sServObj.getClosestItem = function (sampleNr, levelname, maximum) {\n      var level = sServObj.getLevelDetails(levelname);\n      var current = undefined;\n      var nearest = undefined;\n      var isFirst = undefined;\n      var isLast = undefined;\n      if (level !== undefined && level !== null && level.items.length > 0) {\n        current = nearest = level.items[0];\n        isFirst = true;\n        isLast = false;\n        if (level.type === 'SEGMENT') {\n          angular.forEach(level.items, function (itm, index) {\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              // 0.5 sample correction\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                if (sampleNr - itm.sampleStart >= itm.sampleDur / 2) {\n                  if (level.items[index + 1] !== undefined) {\n                    current = level.items[index];\n                    nearest = level.items[index + 1];\n                    isLast = false;\n                  } else {\n                    isLast = true;\n                    current = nearest = level.items[level.items.length - 1];\n                  }\n                } else {\n                  isLast = false;\n                  current = nearest = level.items[index];\n                }\n              }\n              isFirst = false;\n            }\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                current = itm;\n              } else {\n                isLast = true;\n                current = nearest = level.items[level.items.length - 1];\n              }\n            }\n          });\n        } else {\n          var spaceLower = 0;\n          var spaceHigher = 0;\n          isFirst = false;\n          isLast = false;\n          angular.forEach(level.items, function (evt, index) {\n            if (index < level.items.length - 1) {\n              spaceHigher = evt.samplePoint + (level.items[index + 1].samplePoint - level.items[index].samplePoint) / 2;\n            } else {\n              spaceHigher = maximum;\n            }\n            if (index > 0) {\n              spaceLower = evt.samplePoint - (level.items[index].samplePoint - level.items[index - 1].samplePoint) / 2;\n            } else {\n              spaceLower = 0;\n            }\n            if (sampleNr <= spaceHigher && sampleNr >= spaceLower) {\n              current = nearest = evt;\n            }\n          });\n        }\n      }\n      return {\n        current: current,\n        nearest: nearest,\n        isFirst: isFirst,\n        isLast: isLast\n      };\n    };\n    /**\n\t\t * deletes a level by its index\n\t\t */\n    sServObj.deleteLevel = function (levelIndex, curPerspectiveIdx) {\n      var lvl = DataService.getLevelDataAt(levelIndex);\n      DataService.deleteLevelDataAt(levelIndex);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 1);\n      return lvl;\n    };\n    /**\n\t\t * adds a level by its name\n\t\t */\n    sServObj.insertLevel = function (originalLevel, levelIndex, curPerspectiveIdx) {\n      if (DataService.getLevelData() === undefined) {\n        DataService.setLevelData([]);\n      }\n      DataService.insertLevelDataAt(levelIndex, originalLevel);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 0, originalLevel.name);\n    };\n    /**\n\t\t * rename the label of an element by passing in level name and id\n\t\t */\n    sServObj.renameLabel = function (levelName, id, attrIndex, newLabelName) {\n      sServObj.updateSegment(levelName, id, newLabelName, attrIndex);\n    };\n    /**\n\t\t * rename a level by passing in old and new level name and perspective id\n\t\t */\n    sServObj.renameLevel = function (oldname, newname, curPerspectiveIdx) {\n      //rename level name\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === oldname) {\n          level.name = newname;\n          angular.forEach(viewState.curLevelAttrDefs, function (def, i) {\n            if (def.curAttrDefName === oldname && def.levelName === oldname) {\n              viewState.curLevelAttrDefs.slice(i, 1);\n            }\n          });\n          viewState.curLevelAttrDefs.push({\n            curAttrDefName: newname,\n            levelName: newname\n          });\n          // rename all first label names to match new\n          angular.forEach(level.items, function (item) {\n            item.labels[0].name = newname;\n          });\n        }\n      });\n      // update order name as well\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order[ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.indexOf(oldname)] = newname;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegmentsInvers = function (name, id, length, deletedSegment) {\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx;\n      var x, insertPoint;\n      insertPoint = 0;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          insertPoint = deletedSegment.order;\n          for (x in deletedSegment.segments) {\n            level.items.splice(insertPoint++, 0, deletedSegment.segments[x]);\n          }\n        }\n      });\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, deletedSegment.segments[0].id, deletedSegment.segments[deletedSegment.segments.length - 1].id);\n      if (lastNeighbours.left !== undefined && lastNeighbours.right === undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegment(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeRight);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.right.labels);\n        sServObj.updateSegment(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeLeft, lastNeighbours.right.sampleDur - deletedSegment.timeLeft);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right === undefined) {\n      } else {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegment(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeLeft);\n        sServObj.updateSegment(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeRight, lastNeighbours.right.sampleDur - deletedSegment.timeRight);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegments = function (name, id, length) {\n      var firstSegment = sServObj.getItemFromLevelById(name, id);\n      var firstOrder = sServObj.getOrderById(name, id);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var timeLeft = 0;\n      var timeRight = 0;\n      var deleteOrder = null;\n      var deletedSegment = null;\n      var clickSeg = null;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      for (var i = firstOrder; i < firstOrder + length; i++) {\n        timeLeft += sServObj.getItemDetails(name, i).sampleDur + 1;\n      }\n      if (timeLeft % 2 == 0) {\n        timeLeft = timeLeft / 2;\n        timeRight = timeLeft;\n      } else {\n        timeLeft = Math.ceil(timeLeft / 2);\n        timeRight = timeLeft - 1;\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          angular.forEach(level.items, function (evt, order) {\n            if (evt.id == id) {\n              deleteOrder = order;\n              deletedSegment = level.items.splice(deleteOrder, length);\n            }\n          });\n        }\n      });\n      if (neighbours.left !== undefined && neighbours.right === undefined) {\n        sServObj.updateSegment(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      } else if (neighbours.left === undefined && neighbours.right !== undefined) {\n        sServObj.updateSegment(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeLeft, neighbours.right.sampleDur + timeLeft);\n        clickSeg = neighbours.right;\n      } else if (neighbours.left === undefined && neighbours.right === undefined) {\n        // nothing left to do level empty now\n        viewState.setcurMouseItem(undefined, undefined, undefined);\n      } else {\n        sServObj.updateSegment(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeLeft);\n        sServObj.updateSegment(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeRight, neighbours.right.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      }\n      return {\n        order: deleteOrder,\n        segments: deletedSegment,\n        timeLeft: timeLeft,\n        timeRight: timeRight,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegmentInvers = function (name, start, end, newLabel) {\n      var ret = true;\n      var diff, diff2;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name) {\n          if (start == end) {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              var diff = 0;\n              if (t.items[startOrder] !== undefined) {\n                diff = t.items[startOrder].sampleDur + 1;\n              }\n              if (t.items[startOrder - 1] !== undefined) {\n                // if not leftmost item\n                t.items[startOrder - 1].sampleDur += diff;\n              }\n              t.items.splice(startOrder, 1);\n            }\n          } else {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              if (t.items[startOrder + 1] === undefined) {\n                // if rightmost item\n                t.items.splice(startOrder - 1, 2);\n              } else if (t.items[startOrder - 1] === undefined) {\n                // if leftmost item\n                t.items.splice(startOrder, 2);\n              } else {\n                // in the middle\n                diff = t.items[startOrder].sampleDur + 1;\n                diff2 = t.items[startOrder + 1].sampleDur + 1;\n                t.items[startOrder - 1].sampleDur += diff + diff2;\n                t.items.splice(startOrder, 2);\n              }\n            }\n          }\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegment = function (name, start, end, newLabel, ids) {\n      var ret = true;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          if (start == end) {\n            if (level.items.length == 0) {\n              // if on an empty level\n              return {\n                ret: false,\n                ids: ids\n              };\n            } else {\n              // if not on an empty level\n              if (ids === undefined) {\n                ids = [];\n                ids[0] = DataService.getNewId();\n              }\n              var startID = -1;\n              if (start < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - start;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, diff - 1);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var newStart = level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur + 1;\n                sServObj.insertItemDetails(ids[0], name, level.items.length, newLabel, newStart, start - newStart);\n              } else {\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (evt.sampleStart == start) {\n                    ret = false;\n                  }\n                  if (evt.sampleStart + evt.sampleDur + 1 == start) {\n                    ret = false;\n                  }\n                });\n                if (ret) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, level.items[startID].sampleDur - diff - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          } else {\n            if (ids === undefined) {\n              ids = [];\n              ids[0] = DataService.getNewId();\n              ids[1] = DataService.getNewId();\n            }\n            if (level.items.length == 0) {\n              // if on an empty level\n              sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, end - start - 1);\n            } else {\n              // if not on an empty level\n              if (end < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - end - 1;\n                var diff2 = end - start - 1;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, end, diff);\n                sServObj.insertItemDetails(ids[1], name, 0, newLabel, start, diff2);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var diff = start - (level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) - 1;\n                var diff2 = end - start - 1;\n                var len = level.items.length;\n                sServObj.insertItemDetails(ids[0], name, len, newLabel, level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur, diff);\n                sServObj.insertItemDetails(ids[1], name, len + 1, newLabel, start, diff2);\n              } else {\n                // in the middle\n                var startID = -1;\n                var endID = -1;\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (end >= evt.sampleStart && end <= evt.sampleStart + evt.sampleDur) {\n                    endID = id;\n                  }\n                });\n                ret = startID === endID;\n                if (ret && startID !== -1) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  var diff2 = end - start - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, diff2);\n                  sServObj.insertItemDetails(ids[1], name, startID + 2, newLabel, end, level.items[startID].sampleDur - diff - 1 - diff2 - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          }\n        }\n      });\n      return {\n        ret: ret,\n        ids: ids\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertEvent = function (name, start, pointName, id) {\n      var ret = false;\n      var alreadyExists = false;\n      var pos = undefined;\n      var last = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name && level.type === 'EVENT') {\n          if (level.items.length > 0) {\n            last = level.items[0].samplePoint;\n          } else {\n            last = 0;\n          }\n          angular.forEach(level.items, function (evt, order) {\n            if (Math.floor(start) === Math.floor(evt.samplePoint)) {\n              alreadyExists = true;\n            }\n            if (start > evt.samplePoint) {\n              pos = order + 1;\n            }\n          });\n        }\n      });\n      if (!alreadyExists) {\n        if (id === undefined) {\n          id = DataService.getNewId();\n        }\n        sServObj.insertItemDetails(id, name, pos, pointName, start);\n      }\n      return {\n        alreadyExists: alreadyExists,\n        id: id\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteEvent = function (name, id) {\n      var ret = false;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name && t.type == 'EVENT') {\n          var last = 0;\n          angular.forEach(t.items, function (evt, order) {\n            if (!ret) {\n              if (id == evt.id) {\n                ret = evt;\n                t.items.splice(order, 1);\n              }\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *   delete a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundary = function (name, id, isFirst, isLast) {\n      var toDelete = sServObj.getItemFromLevelById(name, id);\n      var last = null;\n      var retOrder = null;\n      var retEvt = null;\n      var clickSeg = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          last = level.items[0];\n          angular.forEach(level.items, function (evt, order) {\n            if (level.type === 'SEGMENT') {\n              if (toDelete.sampleStart == evt.sampleStart && toDelete.sampleDur == evt.sampleDur) {\n                if (order === 0 && isFirst) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[0];\n                } else if (order === level.items.length - 1 && isLast) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[level.items.length - 1];\n                } else {\n                  for (var i = 0; i < last.labels.length; i++) {\n                    last.labels[i].value += evt.labels[i].value;\n                  }\n                  last.sampleDur += evt.sampleDur + 1;\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = last;\n                }\n              }\n            }\n            last = evt;\n          });\n          if (clickSeg == null) {\n            clickSeg = level.items[0];\n          }\n        }\n      });\n      return {\n        order: retOrder,\n        event: retEvt,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *   restore a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundaryInvers = function (name, id, isFirst, isLast, deletedSegment) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.splice(deletedSegment.order, 0, deletedSegment.event);\n          var oldName = deletedSegment.event.labels[0].value;\n          if (!isFirst && !isLast) {\n            oldName = level.items[deletedSegment.order - 1].labels[0].value.slice(0, level.items[deletedSegment.order - 1].labels[0].value.length - deletedSegment.event.labels[0].value.length);\n            level.items[deletedSegment.order - 1].labels[0].value = oldName;\n            level.items[deletedSegment.order - 1].sampleDur -= deletedSegment.event.sampleDur + 1;\n          }\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.snapBoundary = function (toTop, levelName, segment, neighbor, type) {\n      var neighTd;\n      var neighTdIdx;\n      var absMinDist = Infinity;\n      var absDist;\n      var minDist = undefined;\n      var sample;\n      var sampleTarget;\n      if (type == 'SEGMENT') {\n        sample = segment.sampleStart;\n      } else if (type == 'EVENT') {\n        sample = segment.samplePoint;\n      }\n      angular.forEach(DataService.getLevelData(), function (thisTd, tIdx) {\n        if (thisTd.name === levelName) {\n          if (toTop) {\n            if (tIdx >= 1) {\n              neighTd = DataService.getLevelData()[tIdx - 1];\n            } else {\n              return false;\n            }\n          } else {\n            if (tIdx < DataService.getLevelData().length - 1) {\n              neighTd = DataService.getLevelData()[tIdx + 1];\n            } else {\n              return false;\n            }\n          }\n          neighTd.items.forEach(function (itm, order) {\n            if (neighTd.type == 'SEGMENT') {\n              sampleTarget = itm.sampleStart;\n            } else if (neighTd.type == 'EVENT') {\n              sampleTarget = itm.samplePoint;\n            }\n            absDist = Math.abs(sample - sampleTarget);\n            if (absDist < absMinDist) {\n              absMinDist = absDist;\n              minDist = sampleTarget - sample;\n            }\n          });\n        }\n      });\n      if (minDist !== undefined) {\n        if (type == 'SEGMENT') {\n          this.moveBoundary(levelName, segment.id, minDist, 0);\n        } else if (type == 'EVENT') {\n          this.moveEvent(levelName, segment.id, minDist);\n        }\n        return minDist;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t *  moves a boundary of a given segment\n\t\t *\n\t\t *  @param {string} name The name of the level in which the segment lies.\n\t\t *  @param {number} id The id of the segment.\n\t\t *  @param {number} changeTime The time to add or substract.\n\t\t *  @param {isFirst} if item is first\n\t\t *  @param {isLast} if item is last\n\t\t *\n\t\t */\n    sServObj.moveBoundary = function (levelName, id, changeTime, isFirst, isLast) {\n      var orig = sServObj.getItemFromLevelById(levelName, id);\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      var ln = sServObj.getItemNeighboursFromLevel(levelName, id, id);\n      if (isFirst) {\n        // before first item\n        var origRight = ln.right;\n        if (origRight !== undefined) {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n            sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        } else {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      } else if (isLast) {\n        // after last item\n        if (orig.sampleDur + changeTime >= 0 && orig.sampleDur + orig.sampleStart + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart, orig.sampleDur + changeTime);\n        }\n      } else {\n        if (ln.left === undefined) {\n          var origRight = ln.right;\n          if (origRight !== undefined) {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n              sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          } else {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          }\n        } else {\n          var origLeft = ln.left;\n          if (origLeft.sampleDur + changeTime >= 0 && orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0) {\n            sServObj.updateSegment(levelName, ln.left.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveEvent = function (name, id, changeTime) {\n      var orig = sServObj.getItemFromLevelById(name, id);\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      if (LinkService.isLinked(id)) {\n        var neighbour = sServObj.getItemNeighboursFromLevel(name, id, id);\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          // if within audio\n          if (neighbour.left !== undefined && neighbour.right !== undefined) {\n            // if between two events\n            // console.log('between two events')\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint && orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n              sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n            }\n          } else if (neighbour.left === undefined && neighbour.right === undefined) {\n            // if only event\n            // console.log('only element')\n            sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n          } else if (neighbour.left === undefined && neighbour.right !== undefined) {\n            // if first event\n            // console.log('first event')\n            if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n              sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n            }\n          } else if (neighbour.left !== undefined && neighbour.right === undefined) {\n            // if last event\n            // console.log('last event')\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n            }\n          }\n        }\n      } else {\n        // console.log('unlinked event')\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n        }\n        //resort Points after moving\n        angular.forEach(DataService.getLevelData(), function (t) {\n          if (t.name === name) {\n            t.items.sort(viewState.sortbystart);\n          }\n        });\n      }\n    };\n    /**\n\t\t * reorder points on Event level after moving them. This is needed when Points are moved before or after each other\n\t\t *\n\t\t */\n    sServObj.orderPoints = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.samplePoint > b.samplePoint)\n        return 1;\n      if (a.samplePoint < b.samplePoint)\n        return -1;\n      return 0;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveSegment = function (name, id, length, changeTime) {\n      var firstOrder = sServObj.getOrderById(name, id);\n      var firstSegment = sServObj.getItemDetails(name, firstOrder);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      if (firstSegment !== null && lastSegment !== null) {\n        var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n        var attrDefName = viewState.getCurAttrDef(name);\n        var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n        if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n          var right = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n          if (firstSegment.sampleStart + changeTime > 0 && lastNeighbours.right.sampleDur - changeTime >= 0) {\n            sServObj.updateSegment(name, right.id, undefined, labelIdx, right.sampleStart + changeTime, right.sampleDur - changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        } else if (lastNeighbours.right === undefined && lastNeighbours.left !== undefined) {\n          var left = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n          if (lastNeighbours.left.sampleDur + changeTime >= 0) {\n            if (lastSegment.sampleStart + lastSegment.sampleDur + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegment(name, left.id, undefined, labelIdx, left.sampleStart, left.sampleDur + changeTime);\n              for (var i = firstOrder; i < firstOrder + length; i++) {\n                var orig = sServObj.getItemDetails(name, i);\n                sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n              }\n            }\n          }\n        } else if (lastNeighbours.right !== undefined && lastNeighbours.left !== undefined) {\n          var origLeft = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n          var origRight = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n          if (origLeft.sampleDur + changeTime >= 0 && origRight.sampleDur - changeTime >= 0) {\n            sServObj.updateSegment(name, origLeft.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegment(name, origRight.id, undefined, labelIdx, origRight.sampleStart + changeTime, origRight.sampleDur - changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        } else if (lastNeighbours.right === undefined && lastNeighbours.left === undefined) {\n          var first = sServObj.getItemDetails(name, firstOrder);\n          var last = sServObj.getItemDetails(name, firstOrder + length - 1);\n          if (first.sampleStart + changeTime > 0 && last.sampleDur + last.sampleStart + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.expandSegment = function (rightSide, segments, name, changeTime) {\n      var startTime = 0;\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, segments[0].id, segments[segments.length - 1].id);\n      var segTime = changeTime * segments.length;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, segments[0].labels);\n      var tempItem;\n      var allow = true;\n      if (rightSide) {\n        // if expand or shrink on RIGHT side\n        if (neighbours.right === undefined) {\n          // last element\n          var lastLength = segments[segments.length - 1].sampleStart + segments[segments.length - 1].sampleDur + changeTime * segments.length;\n          if (lastLength <= Soundhandlerservice.wavJSO.Data.length) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegment(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.right.sampleDur - changeTime * segments.length > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegment(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n            sServObj.updateSegment(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart + startTime, neighbours.right.sampleDur - startTime);\n          }\n        }\n      } else {\n        // if expand or shrink on LEFT side\n        if (neighbours.left === undefined) {\n          // first element\n          var first = sServObj.getItemDetails(name, 0);\n          if (first.sampleStart + changeTime * (segments.length + 1) > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegment(name, tempItem.id, undefined, tempItem.sampleStart - changeTime, labelIdx, tempItem.sampleDur + changeTime);\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.left.sampleDur - changeTime * segments.length > 0) {\n            startTime = 0;\n            angular.forEach(segments, function (seg, i) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              startTime = -(segments.length - i) * changeTime;\n              sServObj.updateSegment(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n            });\n            sServObj.updateSegment(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur - segments.length * changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.calcDistanceToNearestZeroCrossing = function (sample) {\n      // walk right\n      var distRight = Infinity;\n      var distLeft = Infinity;\n      for (var i = sample; i < Soundhandlerservice.wavJSO.Data.length - 1; i++) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i + 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i + 1] >= 0) {\n          distRight = i - sample;\n          break;\n        }\n      }\n      // walk left\n      for (var i = sample; i > 1; i--) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i - 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i - 1] >= 0) {\n          distLeft = i - sample;\n          break;\n        }\n      }\n      var res;\n      if (Math.abs(distLeft) < Math.abs(distRight)) {\n        res = distLeft;\n      } else {\n        res = distRight + 1;\n      }\n      return res;\n    };\n    /**\n\t\t * Add an item to the end of the specified level\n\t\t *\n\t\t * @param level Name of the level onto which to push the new item\n\t\t * @param id (optional) if given, this id is used instead of a new one\n\t\t *\n\t\t * @returns id of the new item or -1 if no item has been added\n\t\t */\n    sServObj.pushNewItem = function (levelName, id) {\n      var level = sServObj.getLevelDetails(levelName);\n      console.debug(levelName, level, id);\n      // Check whether the level has time information\n      // and only proceed if this is not the case\n      if (level.type === 'ITEM') {\n        // Create new item object\n        if (typeof id === 'number') {\n          var newObject = {\n              id: id,\n              labels: []\n            };\n        } else {\n          var newObject = {\n              id: DataService.getNewId(),\n              labels: []\n            };\n        }\n        // Add all necessary labels\n        var attrdefs = ConfigProviderService.getLevelDefinition(level.name).attributeDefinitions;\n        for (var i = 0; i < attrdefs.length; ++i) {\n          if (attrdefs[i].type === 'STRING') {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: ''\n            });\n          } else {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: null\n            });\n          }\n        }\n        // Insert item into level\n        level.items.push(newObject);\n        return newObject.id;\n      } else {\n        return -1;\n      }\n    };\n    /**\n\t\t * Add an item next to the item with id === eid.\n\t\t * Do nothing if eid is not of type ITEM (ie, if it is on a level with time information)\n\t\t *\n\t\t * @param eid The ID of the element that will get a new sibling\n\t\t * @param before boolean to define whether the new sibling will be inserted before or after eid\n\t\t * @param newID optional, only used for redoing from within the history service. if given, no new id is requested from the DataService.\n\t\t *\n\t\t * @return the id of the newly added item (if an item has been added)\n\t\t * @return -1 (if no item has been added)\n\t\t */\n    sServObj.addItem = function (eid, before, newID) {\n      // Check parameters\n      if (eid === undefined) {\n        return -1;\n      }\n      if (typeof before !== 'boolean') {\n        return -1;\n      }\n      // Find the level and item objects corresponding to the given id\n      var levelAndItem = sServObj.getLevelAndItem(eid);\n      if (levelAndItem === null) {\n        console.debug('Could not find item with id:', eid);\n        return -1;\n      }\n      var level = levelAndItem.level;\n      var item = levelAndItem.item;\n      // Check whether the level has time information\n      // and only proceed if this is not the case\n      if (level.type === 'ITEM') {\n        // Find position of the given element and\n        // define position of the new one\n        var posOld = level.items.indexOf(item);\n        var posNew;\n        if (before === true) {\n          posNew = posOld;\n        } else {\n          posNew = posOld + 1;\n        }\n        // Create new item object\n        if (newID === undefined) {\n          var newObject = {\n              id: DataService.getNewId(),\n              labels: []\n            };\n        } else {\n          var newObject = {\n              id: newID,\n              labels: []\n            };\n        }\n        // Add all necessary labels\n        var attrdefs = ConfigProviderService.getLevelDefinition(level.name).attributeDefinitions;\n        for (var i = 0; i < attrdefs.length; ++i) {\n          if (attrdefs[i].type === 'STRING') {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: ''\n            });\n          } else {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: null\n            });\n          }\n        }\n        // Insert item into level\n        level.items.splice(posNew, 0, newObject);\n        return newObject.id;\n      }\n      return -1;\n    };\n    /**\n\t\t * This is only used as an undo function for the above addItem() and pushNewItem()\n\t\t *\n\t\t * Deletes an item but doesn't check whether there are links to or from it\n\t\t */\n    sServObj.addItemInvers = function (id) {\n      var levels = DataService.getLevelData();\n      for (var i = 0; i < levels.length; ++i) {\n        for (var ii = 0; ii < levels[i].items.length; ++ii) {\n          if (levels[i].items[ii].id === id) {\n            levels[i].items.splice(ii, 1);\n            return;\n          }\n        }\n      }\n    };\n    /**\n\t\t * Delete an item (of type ITEM, not of type SEGMENT or EVENT)\n\t\t * and all links that lead from or to it\n\t\t *\n\t\t * @param id The ID of the item to be deleted\n\t\t * @return an object like {item: object/undefined, ...} (an undefined value of item means that nothing has been done)\n\t\t */\n    sServObj.deleteItemWithLinks = function (id) {\n      var result = {\n          item: undefined,\n          levelName: undefined,\n          position: undefined,\n          deletedLinks: []\n        };\n      var levelAndItem = sServObj.getLevelAndItem(id);\n      if (levelAndItem === null) {\n        // item with the specified id does not exist\n        return result;\n      }\n      var level = levelAndItem.level;\n      var item = levelAndItem.item;\n      if (level.type !== 'ITEM') {\n        // Never touch non-ITEMs\n        return result;\n      }\n      // Delete the item itself\n      console.log('Deleting item:', item, 'From level:', level);\n      result.item = item;\n      result.levelName = level.name;\n      result.position = level.items.indexOf(item);\n      level.items.splice(level.items.indexOf(item), 1);\n      // Delete all links that lead from or to the item\n      // Iterate over the links array backwards so we can manipulate the array from within the loop\n      var links = DataService.getLinkData();\n      for (var i = links.length - 1; i >= 0; --i) {\n        if (links[i].fromID === id || links[i].toID === id) {\n          console.log('Deleting link', i);\n          result.deletedLinks.push(links[i]);\n          links.splice(i, 1);\n        }\n      }\n      return result;\n    };\n    /**\n\t\t * undo the deletion of an item with its links\n\t\t */\n    sServObj.deleteItemWithLinksInvers = function (item, levelName, position, deletedLinks) {\n      // Re-add item\n      sServObj.getLevelDetails(levelName).items.splice(position, 0, item);\n      // Re-add deleted links\n      for (var i = 0; i < deletedLinks.length; ++i) {\n        DataService.insertLinkData(deletedLinks[i]);\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('LinkService', [\n  'DataService',\n  function LinkService(DataService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * adds single links by pairing all childIds \n\t\t * with the parent id (form=={'fromID':fromID, 'toID':toID})\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t */\n    sServObj.insertLink = function (fromID, toID) {\n      DataService.insertLinkData({\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * adds single links to DataService\n\t\t * by pairing all childIds with the parent \n\t\t * at a given position\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t * @param order position of the node pair\n\t\t */\n    sServObj.insertLinkAt = function (fromID, toID, order) {\n      DataService.insertLinkDataAt(order, {\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * removes single link from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLink = function (fromID, toID) {\n      var ret = -1;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.deleteLinkDataAt(linkIdx);\n          ret = linkIdx;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given link exists \n\t\t * that matches the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.linkExists = function (fromID, toID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasParents = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.toID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasChildren = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents or children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.isLinked = function (ID) {\n      return sServObj.hasChildren(ID) || sServObj.hasParents(ID);\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all childIds with the parent \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksTo = function (fromID, toIDs) {\n      angular.forEach(toIDs, function (toID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to children from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksTo = function (fromID, toIDs) {\n      var ret = [];\n      angular.forEach(toIDs, function (toID) {\n        sServObj.deleteLink(fromID, toID);\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n      });\n      return ret;\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all parentIds with the child \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksFrom = function (fromIDs, toID) {\n      angular.forEach(fromIDs, function (fromID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to parents from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksFrom = function (fromIDs, toID) {\n      var ret = [];\n      angular.forEach(fromIDs, function (fromID) {\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n        sServObj.deleteLink(fromID, toID);\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksTo = function (toID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.toID === toID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksFrom = function (fromID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID}) \n\t\t * to (to=={'fromID':fromID, 'toID':toNewID}) \n\t\t */\n    sServObj.changeLinkTo = function (fromID, toID, toNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromID, toNewID);\n        }\n      });\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID}) \n\t\t * to (to=={'fromID':fromID, 'toID':toNewID}) \n\t\t */\n    sServObj.changeLinkFrom = function (fromID, toID, fromNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromNewID, toID);\n        }\n      });\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkSegment = function (segments) {\n      var linksTo = [];\n      var linksFrom = [];\n      angular.forEach(segments, function (segment) {\n        angular.forEach(sServObj.getLinksTo(segment.id), function (found) {\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n        angular.forEach(sServObj.getLinksFrom(segment.id), function (found) {\n          linksFrom.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n      });\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkSegmentInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n    };\n    /**\n\t\t * reorganizes multiple links from and to ID \n\t\t * if a boundary between two items is deleted \n\t\t */\n    sServObj.deleteLinkBoundary = function (ID, neighbourID) {\n      var linksTo = [];\n      var linksFrom = [];\n      var ord = 0;\n      if (neighbourID > 0) {\n        // if not first item\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          if (sServObj.linkExists(found.link.fromID, neighbourID)) {\n            ord = sServObj.deleteLink(found.link.fromID, ID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkTo(found.link.fromID, ID, neighbourID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          if (sServObj.linkExists(neighbourID, found.link.toID)) {\n            ord = sServObj.deleteLink(ID, found.link.toID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkFrom(ID, found.link.toID, neighbourID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n      } else {\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          ord = sServObj.deleteLink(found.link.fromID, ID);\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: ID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          ord = sServObj.deleteLink(ID, found.link.toID);\n          linksFrom.push({\n            fromID: ID,\n            toID: found.link.toID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n      }\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkBoundaryInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkTo(found.fromID, found.neighbourID, found.toID);\n        }\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkFrom(found.neighbourID, found.toID, found.fromID);\n        }\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Websockethandler', [\n  '$q',\n  '$rootScope',\n  '$location',\n  '$timeout',\n  'HistoryService',\n  'Ssffparserservice',\n  'ConfigProviderService',\n  'viewState',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Espsparserservice',\n  'uuid',\n  'Binarydatamaniphelper',\n  'Ssffdataservice',\n  'modalService',\n  function Websockethandler($q, $rootScope, $location, $timeout, HistoryService, Ssffparserservice, ConfigProviderService, viewState, Wavparserservice, Soundhandlerservice, Espsparserservice, uuid, Binarydatamaniphelper, Ssffdataservice, modalService) {\n    // shared service object\n    var sServObj = {};\n    // Keep all pending requests here until they get responses\n    var callbacks = {};\n    // Create our websocket object with the address to the websocket\n    sServObj.ws = {};\n    // empty promise object to be resolved when connection is up\n    var conPromise = {};\n    var connected = false;\n    ////////////////////////////\n    // ws function\n    // broadcast on open\n    function wsonopen(message) {\n      connected = true;\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonmessage(message) {\n      listener(angular.fromJson(message.data));\n    }\n    function wsonerror(message) {\n      console.error('WEBSOCKET ERROR!!!!!');\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonclose(message) {\n      if (!message.wasClean && connected) {\n        modalService.open('views/error.html', 'A non clean disconnect to the server occurred! This probably means that the server is down. Please check the server and reconnect!').then(function () {\n          $rootScope.$broadcast('connectionDisrupted');\n        });\n      }\n      connected = false;\n      console.log('WEBSOCKET closed!!!!!');\n    }\n    function sendRequest(request) {\n      var defer = $q.defer();\n      var callbackId = getCallbackId();\n      callbacks[callbackId] = {\n        time: new Date(),\n        cb: defer\n      };\n      request.callbackID = callbackId;\n      sServObj.ws.send(angular.toJson(request));\n      // timeout request if not answered\n      $timeout(function () {\n        var tOutResp = {\n            'callbackID': callbackId,\n            'status': {\n              'type': 'ERROR:TIMEOUT',\n              'message': 'Sent request of type: ' + request.type + ' timed out after ' + ConfigProviderService.vals.main.serverTimeoutInterval + 'ms!  Please check the server...'\n            }\n          };\n        listener(tOutResp);\n      }, ConfigProviderService.vals.main.serverTimeoutInterval);\n      return defer.promise;\n    }\n    function listener(data) {\n      var messageObj = data;\n      // console.log(\"Received data from websocket: \", messageObj);\n      // If an object exists with callbackID in our callbacks object, resolve it\n      if (callbacks.hasOwnProperty(messageObj.callbackID)) {\n        // console.log(callbacks[messageObj.callbackID]);\n        // console.log('resolving callback: ' + messageObj.type + ' Nr.: ' + messageObj.callbackID);\n        switch (messageObj.type) {\n        case 'getESPSfile':\n          alert('espsfile');\n          //handleReceivedESPS(messageObj.fileName, messageObj.data);\n          break;\n        case 'getSSFFfile':\n          alert('ssfffile');\n          //handleReceivedSSFF(messageObj.fileName, messageObj.data);\n          break;\n        }\n        // resolve promise with data only\n        if (messageObj.status.type === 'SUCCESS') {\n          $rootScope.$apply(callbacks[messageObj.callbackID].cb.resolve(messageObj.data));\n        } else {\n          // show protocol error and disconnect from server\n          sServObj.closeConnect();\n          $rootScope.$broadcast('resetToInitState');\n          $rootScope.$apply(modalService.open('views/error.html', 'Communication error with server! Error message is: ' + messageObj.status.message));\n        }\n        delete callbacks[messageObj.callbackID];\n      } else {\n        if (messageObj.status.type === 'ERROR:TIMEOUT') {\n        } else {\n          modalService.open('views/error.html', 'What just happened? You should not be here...');\n        }\n      }\n    }\n    // This creates a new callback ID for a request\n    function getCallbackId() {\n      var newUUID = uuid.new();\n      return newUUID;\n    }\n    ///////////////////////////////////////////\n    // public api\n    sServObj.initConnect = function (url) {\n      var defer = $q.defer();\n      sServObj.ws = new WebSocket(url);\n      sServObj.ws.onopen = wsonopen;\n      sServObj.ws.onmessage = wsonmessage;\n      sServObj.ws.onerror = wsonerror;\n      sServObj.ws.onclose = wsonclose;\n      conPromise = defer;\n      return defer.promise;\n    };\n    //\n    sServObj.isConnected = function () {\n      return connected;\n    };\n    // close connection with ws\n    sServObj.closeConnect = function () {\n      if (sServObj.isConnected()) {\n        sServObj.ws.onclose = function () {\n        };\n        sServObj.ws.close();\n      } else {\n        console.log('WEBSOCKET ERROR: was not connected!');\n      }\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    // ws getProtocol\n    sServObj.getProtocol = function () {\n      var request = { type: 'GETPROTOCOL' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getProtocol\n    sServObj.getDoUserManagement = function () {\n      var request = { type: 'GETDOUSERMANAGEMENT' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws logOnUser\n    sServObj.logOnUser = function (name, pwd) {\n      var request = {\n          type: 'LOGONUSER',\n          userName: name,\n          pwd: pwd\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getConfigFile\n    sServObj.getDBconfigFile = function () {\n      var request = { type: 'GETGLOBALDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getBundleList\n    sServObj.getBundleList = function () {\n      var request = { type: 'GETBUNDLELIST' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  getBundle\n    sServObj.getBundle = function (name, session) {\n      var request = {\n          type: 'GETBUNDLE',\n          name: name,\n          session: session\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  saveBundle\n    sServObj.saveBundle = function (bundleData) {\n      var request = {\n          type: 'SAVEBUNDLE',\n          data: bundleData\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  disconnecting\n    sServObj.disconnectWarning = function () {\n      var request = { type: 'DISCONNECTWARNING' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  GetDoEditDBConfig\n    sServObj.getDoEditDBConfig = function () {\n      var request = { type: 'GETDOEDITDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  editDBConfig with subtype and data\n    sServObj.editDBConfig = function (subtype, data) {\n      var request = {\n          type: 'EDITDBCONFIG',\n          subtype: subtype,\n          data: data\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Binarydatamaniphelper', function Binarydatamaniphelper() {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t *\n\t\t */\n  sServObj.base64ToArrayBuffer = function (stringBase64) {\n    var binaryString = window.atob(stringBase64);\n    var len = binaryString.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n      var ascii = binaryString.charCodeAt(i);\n      bytes[i] = ascii;\n    }\n    return bytes.buffer;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.arrayBufferToBase64 = function (buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  };\n  /**\n\t\t *\n\t\tsServObj.stringToArrayBuffer = function (str) {\n\t\t\tvar ab = new ArrayBuffer(str.length);\n\t\t\tvar view = new Uint8Array(ab);\n\t\t\tfor (var i = 0; i < str.length; ++i) {\n\t\t\t\tview[i] = str.charCodeAt(i);\n\t\t\t}\n\t\t\treturn ab;\n\t\t};\n\t\t */\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Appcachehandler', [\n  '$http',\n  'modalService',\n  function Appcachehandler($http, modalService) {\n    // shared service object\n    var sServObj = {};\n    var appCache = window.applicationCache;\n    // var cacheProperties = {\n    // \tfilesDownloaded: 0,\n    // \ttotalFiles: 0\n    // };\n    // function getTotalFiles() {\n    // \t// First, reset the total file count and download count.\n    // \tcacheProperties.filesDownloaded = 0;\n    // \tcacheProperties.totalFiles = 0;\n    // \t$http.get('manifest.appcache').success(function (content) {\n    // \t\t// console.log(content);\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp(\n    // \t\t\t\t'(NETWORK|FALLBACK):' +\n    // \t\t\t\t'((?!(NETWORK|FALLBACK|CACHE):)[\\\\w\\\\W]*)',\n    // \t\t\t\t'gi'\n    // \t\t\t),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out all comments.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('#[^\\\\r\\\\n]*(\\\\r\\\\n?|\\\\n)', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out the cache manifest header and\n    // \t\t// trailing slashes.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('CACHE MANIFEST\\\\s*|\\\\s*$', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out extra line breaks and replace with\n    // \t\t// a hash sign that we can break on.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('[\\\\r\\\\n]+', 'g'),\n    // \t\t\t'#'\n    // \t\t);\n    // \t\t// Get the total number of files.\n    // \t\tvar totalFiles = content.split('#').length;\n    // \t\t// Store the total number of files. Here, we are\n    // \t\t// adding one for *THIS* file, which is cached\n    // \t\t// implicitly as it points to the manifest.\n    // \t\tcacheProperties.totalFiles = (totalFiles + 1);\n    // \t\t// console.log('##########################');\n    // \t\t// alert('INFO: appcache update of: ' + cacheProperties.totalFiles + ' files');\n    // \t});\n    // }\n    // function handleCheckingEvent(e) {\n    // \tconsole.log('###### handleCheckingEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleNoupdateEvent(e) {\n    // \tconsole.log('###### handleNoupdateEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleDownloadingEvent(e) {\n    // \tconsole.log('######## handleDownloadingEvent ##########');\n    // \tconsole.log(e);\n    // \tgetTotalFiles();\n    // }\n    // function handleProgressEvent(e) {\n    // \tconsole.log('###### handleProgressEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    // function handleCachedEvent(e) {\n    // \tconsole.log('###### handleCachedEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    sServObj.handleUpdatereadyEvent = function () {\n      modalService.open('views/confirmModal.html', 'A new version of the EMU-WebApp is available and has already been downloaded and cached in your browser. Would you like to use it? CAUTION: A reload will delete all current changes... TIP: the next time you use the EMU-webApp you will automatically use the updated version)').then(function (res) {\n        if (res) {\n          localStorage.removeItem('haveShownWelcomeModal');\n          appCache.swapCache();\n          window.location.reload();\n        } else {\n          localStorage.removeItem('haveShownWelcomeModal');\n        }\n      });\n    };\n    // function handleObsoleteEvent(e) {\n    // \tconsole.log('###### handleObsoleteEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleErrorEvent(e) {\n    // \tconsole.log('###### handleErrorEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // // bind evts\n    // // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('checking', handleCheckingEvent, false);\n    // appCache.addEventListener('noupdate', handleNoupdateEvent, false);\n    // appCache.addEventListener('downloading', handleDownloadingEvent, false);\n    // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('cached', handleCachedEvent, false);\n    appCache.addEventListener('updateready', sServObj.handleUpdatereadyEvent, false);\n    // appCache.addEventListener('obsolete', handleObsoleteEvent, false);\n    // appCache.addEventListener('error', handleErrorEvent, false);\n    // /////////////////////////////////////////////////\n    // // public api\n    sServObj.checkForNewVersion = function () {\n      // console.log('check for new version');\n      if (appCache.status !== 0 && appCache.status !== 3) {\n        // uncached == 0 & downloading == 3\n        console.log('INFO: appCache.status: ' + appCache.status);\n        appCache.update();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('spectSettingsCtrl', [\n  '$scope',\n  'modalService',\n  'viewState',\n  'DataService',\n  'mathHelperService',\n  'Soundhandlerservice',\n  function ($scope, modalService, viewState, DataService, mathHelperService, Soundhandlerservice) {\n    $scope.vs = viewState;\n    $scope.options = Object.keys($scope.vs.getWindowFunctions());\n    $scope.selWindowInfo = {};\n    $scope.selWindowInfo.name = Object.keys($scope.vs.getWindowFunctions())[$scope.vs.spectroSettings.window - 1];\n    $scope.errorID = [];\n    $scope.upperBoundary = '';\n    $scope.modalVals = {\n      'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n      'rangeTo': $scope.vs.spectroSettings.rangeTo,\n      'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n      'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n      'window': $scope.vs.spectroSettings.window,\n      'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n      'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n      'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n      '_fftN': 512,\n      '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    //////////////////////////\n    // window size functions\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeInSamples = function () {\n      $scope.modalVals._windowSizeInSamples = Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcFftN = function () {\n      var fftN = mathHelperService.calcClosestPowerOf2Gt($scope.modalVals._windowSizeInSamples);\n      // fftN must be greater than 512 (leads to better resolution of spectrogram)\n      if (fftN < 512) {\n        fftN = 512;\n      }\n      $scope.modalVals._fftN = fftN;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeVals = function () {\n      $scope.calcWindowSizeInSamples();\n      $scope.calcFftN();\n    };\n    //\n    ////////////////////\n    /**\n\t\t *\n\t\t */\n    $scope.reset = function () {\n      $scope.errorID = [];\n      $scope.modalVals = {\n        'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n        'rangeTo': $scope.vs.spectroSettings.rangeTo,\n        'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n        'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n        'window': $scope.vs.spectroSettings.window,\n        'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n        'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n        'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n        '_fftN': 512,\n        '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n      };\n      modalService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cssError = function (id, id2) {\n      if ($scope.errorID[id]) {\n        return { 'background': '#f00' };\n      }\n      if (id2 !== undefined) {\n        if ($scope.errorID[id2]) {\n          return { 'background': '#f00' };\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.htmlError = function (id) {\n      return $scope.errorID[id];\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveSpectroSettings = function () {\n      var error = false;\n      $scope.errorID.forEach(function (entry) {\n        if (entry === true) {\n          error = true;\n        }\n      });\n      if (!error) {\n        viewState.setspectroSettings($scope.modalVals.windowSizeInSecs, $scope.modalVals.rangeFrom, $scope.modalVals.rangeTo, $scope.modalVals.dynamicRange, $scope.selWindowInfo.name, $scope.modalVals.drawHeatMapColors, $scope.modalVals.preEmphasisFilterFactor, $scope.modalVals.heatMapColorAnchors);\n        $scope.reset();\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.checkSpectroSettings = function () {\n      if ($scope.modalVals.heatMapColorAnchors[0][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[0][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[0][2] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][2] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][2] % 1 !== 0) {\n        $scope.errorID[8] = true;\n      } else {\n        $scope.errorID[8] = false;\n      }\n      if (isNaN($scope.modalVals.preEmphasisFilterFactor * Soundhandlerservice.wavJSO.SampleRate)) {\n        $scope.errorID[7] = true;\n      } else {\n        $scope.errorID[7] = false;\n      }\n      if (isNaN(Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs)) {\n        $scope.errorID[6] = true;\n      } else {\n        $scope.errorID[6] = false;\n      }\n      if ($scope.modalVals.dynamicRange % 1 !== 0) {\n        $scope.errorID[5] = true;\n      } else {\n        $scope.errorID[5] = false;\n      }\n      if ($scope.modalVals.rangeFrom % 1 !== 0) {\n        $scope.errorID[4] = true;\n      } else {\n        $scope.errorID[4] = false;\n      }\n      if ($scope.modalVals.rangeTo % 1 !== 0) {\n        $scope.errorID[3] = true;\n      } else {\n        $scope.errorID[3] = false;\n      }\n      if ($scope.modalVals.rangeFrom < 0) {\n        $scope.errorID[2] = true;\n      } else {\n        $scope.errorID[2] = false;\n      }\n      $scope.upperBoundary = DataService.data.sampleRate / 2;\n      if ($scope.modalVals.rangeTo > $scope.upperBoundary) {\n        $scope.errorID[1] = true;\n      } else {\n        $scope.errorID[1] = false;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').filter('regex', function () {\n  return function (input, regex) {\n    var patt = new RegExp(regex.toLowerCase());\n    var out = [];\n    for (var i = 0; i < input.length; i++) {\n      if (patt.test(input[i].name.toLowerCase())) {\n        out.push(input[i]);\n      }\n    }\n    return out;\n  };\n});\n'use strict';\nangular.module('emuwebApp').filter('levelsFilter', [\n  'ConfigProviderService',\n  'viewState',\n  function (ConfigProviderService, viewState) {\n    return function (input) {\n      if (input) {\n        var patt1 = new RegExp('SEGMENT|EVENT');\n        var out = [];\n        var idx;\n        for (var i = 0; i < input.length; i++) {\n          if (patt1.test(input[i].type)) {\n            if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases !== undefined) {\n              idx = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order.indexOf(input[i].name);\n              if (idx !== -1) {\n                out.push(input[i]);\n              }\n            }\n          }\n        }\n        return out;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ModalCtrl', [\n  '$scope',\n  'ArrayHelperService',\n  'modalService',\n  'viewState',\n  'LevelService',\n  'HistoryService',\n  'ConfigProviderService',\n  function ($scope, ArrayHelperService, modalService, viewState, LevelService, HistoryService, ConfigProviderService) {\n    $scope.cps = ConfigProviderService;\n    $scope.data = undefined;\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.saveChanges = function (name) {\n      modalService.close();\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.discardChanges = function (name) {\n      modalService.close();\n    };\n    /**\n\t\t *  Rename a level\n\t\t */\n    $scope.renameLevel = function () {\n      LevelService.renameLevel(modalService.dataIn, $scope.data, viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'RENAMELEVEL',\n        'newname': $scope.data,\n        'name': modalService.dataIn,\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      modalService.close();\n    };\n    /**\n\t\t *  Delete a complete level from LevelService\n\t\t */\n    $scope.deleteLevel = function (name) {\n      var lvl = LevelService.getLevelDetails(viewState.getcurClickLevelName());\n      LevelService.deleteLevel(viewState.getcurClickLevelIndex(), viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'DELETELEVEL',\n        'level': lvl,\n        'id': viewState.getcurClickLevelIndex(),\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      modalService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showMenu', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showMenu, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.removeClass(element, 'emuwebapp-shrinkWidthTo0px');\n          } else {\n            $animate.removeClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showTwod', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showTwod, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, '.slideIn2dCanvases');\n          } else {\n            $animate.removeClass(element, '.slideIn2dCanvases');\n          }\n        });\n      }\n    };\n  }\n]);\n// simple animation to add slideLeft class\nangular.module('emuwebApp').animation('.slideIn2dCanvases', function () {\n  return {\n    addClass: function (element, className) {\n      element.addClass('slide2dCanvases');\n    },\n    removeClass: function (element, className) {\n      element.removeClass('slide2dCanvases');\n    }\n  };\n});\nangular.module('emuwebApp').directive('bgSplitter', [\n  '$rootScope',\n  'viewState',\n  function ($rootScope, viewState) {\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      scope: { showTwoDimCans: '@' },\n      template: '<div class=\"emuwebapp-split-panes vertical\" ng-transclude></div>',\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.panes = [];\n          $scope.bottomRightResizePane;\n          this.addPane = function (pane) {\n            if ($scope.panes.length > 1)\n              throw 'splitters can only have two panes';\n            $scope.panes.push(pane);\n            return $scope.panes.length;\n          };\n          this.setBottomRightResizePane = function (pane) {\n            $scope.bottomRightResizePane = pane;\n          };\n        }\n      ],\n      link: function (scope, element, attrs) {\n        var dragBottomRightResizePaneTopResizer = false;\n        var dragBottomRightResizePaneLeftResizer = false;\n        var dragBottomRightResizePaneCornerResizer = false;\n        // create split pane view\n        var handler = angular.element('<div id=\"emuwebapp-split-handler\" class=\"emuwebapp-split-handler\"><span></span></div>');\n        var pane1 = scope.panes[0];\n        var pane2 = scope.panes[1];\n        var pane3 = scope.bottomRightResizePane;\n        var bottomRightResizePaneTopResizer = angular.element('<div class=\"topBorder\"></div>');\n        var bottomRightResizePaneLeftResizer = angular.element('<div class=\"leftBorder\"></div>');\n        var bottomRightResizePaneCornerResizer = angular.element('<div class=\"corner\"></div>');\n        pane3.elem.prepend(bottomRightResizePaneLeftResizer);\n        pane3.elem.prepend(bottomRightResizePaneTopResizer);\n        pane3.elem.prepend(bottomRightResizePaneCornerResizer);\n        var pane1Min = pane1.minSize || 0;\n        var pane2Min = pane2.minSize || 0;\n        var dragSplitPaneResizer = false;\n        var drag = false;\n        pane1.elem.after(handler);\n        attrs.$observe('showTwoDimCans', function (val) {\n          if (val === 'false') {\n            scope.bottomRightResizePane.elem.hide();\n          } else {\n            scope.bottomRightResizePane.elem.show();\n          }\n        });\n        ////////////////////\n        // bindings\n        element.bind('mousemove', function (ev) {\n          if (!drag)\n            return;\n          // check if scrollbar exists -> set scrollbar on pane1 to ensure equal indentation due to scrollbar width\n          if (pane2.elem[0].scrollHeight > pane2.elem[0].clientHeight + 1) {\n            pane1.elem.css('overflow-y', 'scroll');\n          } else {\n            pane1.elem.css('overflow-y', 'hidden');\n          }\n          var bounds = element[0].getBoundingClientRect();\n          var pos = 0;\n          if (dragSplitPaneResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            // perc = pos/height * 100;\n            // console.log(perc);\n            if (pos < pane1Min)\n              return;\n            if (height - pos < pane2Min)\n              return;\n            handler.css('top', pos + 'px');\n            pane1.elem.css('height', pos + 'px');\n            pane2.elem.css('top', pos + 'px');\n            viewState.setdragBarHeight(pos);\n            $rootScope.$digest();\n          }\n          if (dragBottomRightResizePaneTopResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneLeftResizer) {\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            //pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneCornerResizer) {\n            // do height and top\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n            // do width and left\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            //pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n        });\n        handler.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragSplitPaneResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneTopResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneTopResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneLeftResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneLeftResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneCornerResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneCornerResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        angular.element(document).bind('mouseup', function (ev) {\n          drag = false;\n          dragSplitPaneResizer = false;\n          dragBottomRightResizePaneTopResizer = false;\n          dragBottomRightResizePaneLeftResizer = false;\n          dragBottomRightResizePaneCornerResizer = false;\n          viewState.setdragBarActive(false);\n          $rootScope.$digest();\n        });\n      }\n    };\n  }\n]).directive('bgPane', function () {\n  return {\n    restrict: 'E',\n    require: '^bgSplitter',\n    replace: true,\n    transclude: true,\n    scope: {\n      minSize: '=',\n      type: '@',\n      showTwoDimCans: '@'\n    },\n    template: '<div class=\"{{typeclass}}\" ng-transclude></div>',\n    link: function (scope, element, attrs, bgSplitterCtrl) {\n      var newElement;\n      if (scope.type !== 'emuwebapp-2d-map') {\n        scope.elem = element;\n        scope.index = bgSplitterCtrl.addPane(scope);\n        scope.typeclass = 'split-pane' + scope.index;\n      } else {\n        scope.elem = element;\n        scope.index = 3;\n        scope.typeclass = 'emuwebapp-2d-map';\n        bgSplitterCtrl.setBottomRightResizePane(scope);\n      }\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('ssffTrack', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'loadedMetaDataService',\n  function ($timeout, viewState, ConfigProviderService, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/ssffTrack.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var ssffCanvas = element.find('canvas')[1];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // var context = canvas0.getContext('2d');\n        var markupCtx = markupCanvas.getContext('2d');\n        var trackName;\n        scope.lmds = loadedMetaDataService;\n        attrs.$observe('trackName', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        scope.order = attrs.order;\n        /////////////////////\n        // watches\n        //\n        //\n        scope.$watch('vs.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue) {\n            scope.drawSsffTrackMarkup();\n          }\n        });\n        //\n        scope.$watch('vs.timelineSize', function () {\n          $timeout(scope.drawSsffTrackMarkup, ConfigProviderService.design.animation.duration);\n        });\n        scope.$watch('vs.curViewPort', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n                scope.drawSsffTrackMarkup();\n              }\n            }\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n         *\n         */\n        scope.drawSsffTrackMarkup = function () {\n          if (!$.isEmptyObject(scope.ssffds.data)) {\n            if (scope.ssffds.data.length !== 0) {\n              markupCtx.clearRect(0, 0, markupCtx.canvas.width, markupCtx.canvas.height);\n              // draw moving boundary line if moving\n              scope.dhs.drawMovingBoundaryLine(markupCtx);\n              // draw current viewport selected\n              scope.dhs.drawCurViewPortSelected(markupCtx, false);\n              // draw min max an name of track\n              var tr = scope.cps.getSsffTrackConfig(trackName);\n              var col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n              scope.dhs.drawMinMaxAndName(markupCtx, trackName, col._minVal, col._maxVal, 2);\n            }\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('progressThing', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-progressThing\">{{vs.somethingInProgressTxt}}</div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the progressThing directive');\n        attrs.$observe('showThing', function (newVal) {\n          if (newVal === 'true') {\n            // $animate.removeClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.removeClass(element, 'emuwebapp-animationStopped');\n            $animate.addClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.addClass(element, 'emuwebapp-animationRunning');\n          } else {\n            // $animate.addClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.removeClass(element, 'emuwebapp-animationRunning');\n            $animate.addClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.addClass(element, 'emuwebapp-animationStopped');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('historyActionPopup', [\n  '$animate',\n  '$timeout',\n  'ConfigProviderService',\n  function ($animate, $timeout, ConfigProviderService) {\n    return {\n      template: '<div class=\"emuwebapp-history\"><div ng-bind-html=\"vs.historyActionTxt\"></div></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        ////////////////\n        //watches\n        scope.cps = ConfigProviderService;\n        scope.$watch('vs.historyActionTxt', function () {\n          if (scope.vs.historyActionTxt !== '') {\n            $animate.addClass(element, 'emuwebapp-history-fade').then(function () {\n              scope.$apply();\n              $timeout(function () {\n                $animate.removeClass(element, 'emuwebapp-history-fade').then(function () {\n                  $timeout(function () {\n                    scope.vs.historyActionTxt = '';\n                  }, scope.cps.design.animation.period);\n                  scope.$apply();\n                });\n              }, scope.cps.design.animation.period);\n            });\n          }\n        }, true);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dragout', [\n  'DataService',\n  'loadedMetaDataService',\n  'browserDetector',\n  'ConfigProviderService',\n  function (DataService, loadedMetaDataService, browserDetector, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      replace: true,\n      scope: { name: '@' },\n      link: function (scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        var el = element[0];\n        var dragIcon = document.createElement('img');\n        dragIcon.src = 'img/saveBtn.svg';\n        var dataString = '';\n        scope.generateURL = function () {\n          return scope.getURL(angular.toJson(DataService.getData(), true));\n        };\n        scope.isActive = function () {\n          return attrs.name === loadedMetaDataService.getCurBndl().name && scope.cps.vals.main.comMode === 'embedded';\n        };\n        scope.getURL = function (data) {\n          var objURL;\n          if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n            objURL = webkitURL.createObjectURL(scope.getBlob(data));\n          } else {\n            objURL = URL.createObjectURL(scope.getBlob(data));\n          }\n          return objURL;\n        };\n        scope.getBlob = function (data) {\n          var blob;\n          try {\n            blob = new Blob([data], { type: 'text/plain' });\n          } catch (e) {\n            // Backwards-compatibility\n            window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n            blob = new BlobBuilder();\n            blob.append(data);\n            blob = blob.getBlob();\n          }\n          return blob;\n        };\n        el.addEventListener('dragstart', function (e) {\n          if (scope.isActive()) {\n            this.classList.add('drag');\n            var url = scope.generateURL();\n            if (browserDetector.isBrowser.Firefox() || browserDetector.isBrowser.Chrome()) {\n              e.dataTransfer.setDragImage(dragIcon, -10, -10);\n              e.dataTransfer.effectAllowed = 'move';\n              e.dataTransfer.setData('DownloadURL', 'application/json:' + attrs.name + '_annot.json:' + url);\n            }\n          } else {\n            console.log('dropping inactive bundles is not allowed');\n          }\n          return false;\n        }, false);\n        el.addEventListener('dragend', function (e) {\n          if (scope.isActive()) {\n            this.classList.remove('drag');\n          }\n          return false;\n        }, false);\n        el.addEventListener('mousedown', function (e) {\n          if (scope.isActive()) {\n            el.setAttribute('draggable', true);\n          } else {\n            el.setAttribute('draggable', false);\n            el.removeAttribute('dragable');\n          }\n        }, false);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuhierarchy', [\n  'viewState',\n  'HistoryService',\n  'DataService',\n  'LevelService',\n  'HierarchyManipulationService',\n  'HierarchyLayoutService',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  '$timeout',\n  function (viewState, HistoryService, DataService, LevelService, HierarchyManipulationService, HierarchyLayoutService, Soundhandlerservice, ConfigProviderService, $timeout) {\n    return {\n      template: '<div class=\"emuwebapp-hierarchy-container\" ng-mousemove=\"checkLink($event)\"></div>',\n      restrict: 'E',\n      scope: {\n        vertical: '=',\n        playing: '='\n      },\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        //////////////////////\n        // private variables\n        // FIXME move these to viewState\n        scope.selectedItem;\n        scope.selectedLink;\n        scope.newLinkSrc;\n        // END FIXME\n        // Graphical offset from the SVG's border to the first nodes\n        // Note that level captions are drawn within that offset\n        scope.offsetX = 25;\n        scope.offsetY = 30;\n        // The same when in rotated mode\n        scope.vertOffsetX = 150;\n        scope.vertOffsetY = 25;\n        // Possible zoom range\n        scope.scaleExtent = [\n          0.5,\n          10\n        ];\n        // Settings for CSS transitions\n        scope.transition = {\n          duration: 750,\n          links: false,\n          nodes: false,\n          rotation: false,\n          contextMenu: false\n        };\n        // A promise that can be cancelled from within scope.zoom()\n        scope.zoomTimeoutPromise = null;\n        //\n        //////////////////////\n        //////////////////////\n        // watches\n        scope.viewState = viewState;\n        scope.hierarchyState = viewState.hierarchyState;\n        scope.historyService = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.$watch('hierarchyState.path', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Rendering due to path change: ', newValue);\n            scope.hierarchyState.newLinkFromID = undefined;\n            scope.render();\n          }\n        }, false);\n        scope.$watch('vertical', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Rendering due to rotation: ', newValue);\n            scope.render();\n          }\n        }, false);\n        scope.$watch('viewState.curLevelAttrDefs', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Rendering due to attribute change: ', newValue);\n            scope.render();\n          }\n        }, true);\n        scope.$watch('playing', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Play() triggered', newValue, scope.selectedItem);\n            if (typeof scope.selectedItem !== 'undefined' && newValue !== 0) {\n              scope.play(scope.selectedItem);\n            }\n          }\n        }, true);\n        scope.$watch('hierarchyState.playing', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Play() triggered by viewState', newValue);\n            if (typeof scope.selectedItem !== 'undefined' && newValue !== 0) {\n              scope.play(scope.selectedItem);\n            }\n          }\n        }, false);\n        scope.$watch('historyService.movesAwayFromLastSave', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('history service is active, rendering');\n            scope.render();\n          }\n        }, false);\n        scope.$watch('hierarchyState.newLinkFromID', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            scope.newLinkSrc = LevelService.getItemByID(newValue);\n            scope.render();\n          }\n        }, false);\n        scope.$watch('viewState.hierarchyShown', function (newValue) {\n          if (newValue === true) {\n            console.debug('Hierarchy modal activated, rendering');\n            scope.render();\n          }\n        }, false);\n        scope.$watch('hierarchyState.contextMenuID', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            scope.render();\n          }\n        }, false);\n        //\n        //////////////////////\n        //////////////////////\n        // helper functions\n        /**\n\t *\n\t */\n        scope.selectItem = function (item) {\n          scope.selectedItem = item;\n          viewState.hierarchyState.selectedItemID = item.id;\n        };\n        scope.selectLink = function (link) {\n          scope.selectedLink = link;\n          viewState.hierarchyState.selectedLinkFromID = link.fromID;\n          viewState.hierarchyState.selectedLinkToID = link.toID;\n        };\n        /**\n\t * Function to center node when clicked/dropped so node doesn't get lost when\n\t * collapsing/moving with large amount of children.\n\t *\n\tscope.centerNode = function (node) {\n\t\tvar x = -node._x + scope.width/2;\n\t\tvar y = -node._y  + scope.height/2;\n\t\tscope.svg.transition()\n\t\t\t.duration(scope.transition.duration)\n\t\t\t.attr('transform', scope.getOrientatedTransform()+'translate(' + x + ',' + y + ')');\n\t\tscope.zoomListener.translate([x, y]);\n\t};\n\t*/\n        /**\n\t * The zoom function is called by the zoom listener, which listens for d3 zoom events and must be appended to the svg element\n\t */\n        scope.zoom = function () {\n          scope.svg.attr('transform', scope.getOrientatedTransform());\n          scope.captionLayer.attr('transform', scope.getOrientatedLevelCaptionLayerTransform);\n          scope.captionLayer.selectAll('g.emuhierarchy-levelcaption').attr('transform', scope.getOrientatedLevelCaptionTransform);\n          // Call scope.render(), but make sure it's only called once a rush of zoom events has finished\n          if (scope.zoomTimeoutPromise !== null) {\n            $timeout.cancel(scope.zoomTimeoutPromise);\n            scope.zoomTimeoutPromise = null;\n          }\n          scope.zoomTimeoutPromise = $timeout(scope.render, 200);\n        };\n        /**\n\t * This transform is applied to the all-encompassing SVG area\n\t *\n\t * It applies the current scale factor to the dimension that represents\n\t * time.\n\t */\n        scope.getOrientatedTransform = function () {\n          var transform = '';\n          if (scope.vertical) {\n            transform += 'translate(' + scope.zoomListener.translate()[0] + ',0)';\n            transform += 'scale(' + scope.zoomListener.scale() + ',1)';\n            transform += 'scale(-1,1),rotate(90)';\n          } else {\n            transform += 'translate(0,' + scope.zoomListener.translate()[1] + ')';\n            transform += 'scale(1,' + scope.zoomListener.scale() + ')';\n            transform += 'rotate(0)';\n          }\n          return transform;\n        };\n        /**\n\t * This transform is applied to each individual node, which includes\n\t * both the circle and the label.\n\t *\n\t * It reverses the zoom factor applied to the complete graphics so that\n\t * the text doesn't consume more space than needed.\n\t */\n        scope.getOrientatedNodeTransform = function (d) {\n          // Parameter d is never used because this is independent from the node's position\n          if (scope.vertical) {\n            return 'scale(1,' + 1 / scope.zoomListener.scale() + ')scale(-1,1)rotate(90)';\n          } else {\n            return 'scale(1,' + 1 / scope.zoomListener.scale() + ')rotate(0)';\n          }\n        };\n        //\n        // This returns the stroke width for links\n        // It does not really depend on the orientation but rather on the zoom\n        // scale. It is named getORIENTATEDLinkStrokeWidth anyway because all\n        // functions are named like that, althoug they depend on both zoom\n        // scale and orientation.\n        scope.getOrientatedLinkStrokeWidth = function (d) {\n          return 1.5 / scope.zoomListener.scale() + 'px';\n        };\n        scope.getOrientatedGhostLinkStrokeWidth = function (d) {\n          return 15 / scope.zoomListener.scale() + 'px';\n        };\n        scope.getNodeText = function (d) {\n          var level = viewState.getCurAttrDef(LevelService.getLevelName(d.id));\n          for (var i = 0; i < d.labels.length; ++i) {\n            if (d.labels[i].name === level) {\n              return d.labels[i].value;\n            }\n          }\n          console.debug('Likely a bug: Did not find the label selected for display', 'Selected level:', level, 'Node: ', d);\n          return 'NO VALUE';\n        };\n        scope.getOrientatedNodeCollapseText = function (d) {\n          if (scope.vertical) {\n            if (viewState.getCollapsed(d.id)) {\n              return '\\u2193';\n            } else {\n              return '\\u2191';\n            }\n          } else {\n            if (viewState.getCollapsed(d.id)) {\n              return '\\u2192';\n            } else {\n              return '\\u2190';\n            }\n          }\n        };\n        /**\n\t * This transform is applied to all nodes' text labels\n\t */\n        scope.getOrientatedTextTransform = function (d) {\n        };\n        scope.getOrientatedTextAnchor = function (d) {\n          if (scope.vertical) {\n            return 'middle';\n          } else {\n            return 'begin';\n          }\n        };\n        scope.getOrientatedTextX = function (d) {\n          if (scope.vertical) {\n            return 0;\n          } else {\n            return 10;\n          }\n        };\n        scope.getOrientatedTextY = function (d) {\n          if (scope.vertical) {\n            return '1.45em';\n          } else {\n            return '0.35em';\n          }\n        };\n        scope.getOrientatedLevelCaptionLayerTransform = function (d) {\n        };\n        scope.getOrientatedLevelCaptionTransform = function (d) {\n          var revArr = angular.copy(viewState.hierarchyState.path).reverse();\n          if (scope.vertical) {\n            return 'translate(25, ' + scope.depthToX(revArr.indexOf(d)) + ')';\n          } else {\n            return 'translate(' + scope.depthToX(revArr.indexOf(d)) + ', 20)';\n          }\n        };\n        scope.getOrientatedAddItemButtonTransform = function (d) {\n          if (scope.vertical) {\n            return 'translate(-12, -5)';\n          } else {\n            return 'translate(-12, -5)';\n          }\n        };\n        scope.getOrientatedMousePosition = function (mouse) {\n          if (scope.vertical) {\n            return [\n              mouse[1],\n              (mouse[0] - scope.zoomListener.translate()[0]) / scope.zoomListener.scale()\n            ];\n          } else {\n            return [\n              mouse[0],\n              (mouse[1] - scope.zoomListener.translate()[1]) / scope.zoomListener.scale()\n            ];\n          }\n        };\n        scope.getPath = function (d) {\n          // It would be better if this function was independent of the scaling factor.\n          // But it turns out to be the easiest solution to counter the stretching\n          // effect of \"one-dimensional scaling\" on links.\n          var scale = scope.zoomListener.scale();\n          if (scope.vertical) {\n            return 'M' + d._fromX + ' ' + d._fromY / scale + 'Q' + d._fromX + ' ' + d._toY / scale + ' ' + d._toX + ' ' + d._toY / scale;\n          } else {\n            return 'M' + d._fromX / scale + ' ' + d._fromY + 'Q' + d._fromX / scale + ' ' + d._toY + ' ' + d._toX / scale + ' ' + d._toY;\n          }\n        };\n        /**\n\t * Calculate the path for the dashed preview link that is shown when\n\t * trying to add a new link.\n\t */\n        scope.getPreviewPath = function () {\n          var from = {\n              x: scope.newLinkSrc._x,\n              y: scope.newLinkSrc._y\n            };\n          var to = {\n              x: scope.selectedItem._x,\n              y: scope.selectedItem._y\n            };\n          var scale = scope.zoomListener.scale();\n          if (scope.vertical) {\n            return 'M' + from.x + ' ' + from.y / scale + 'Q' + from.x + ' ' + to.y / scale + ' ' + to.x + ' ' + to.y / scale;\n          } else {\n            return 'M' + from.x / scale + ' ' + from.y + 'Q' + from.x / scale + ' ' + to.y + ' ' + to.x / scale + ' ' + to.y;\n          }\n        };\n        /**\n\t * Return a color depending on the validity of the link the user is\n\t * trying to create.\n\t *\n\t * If the link is invalid, this function will try reversing the link.\n\t */\n        scope.getPreviewColor = function () {\n          var validity = HierarchyManipulationService.checkLinkValidity(viewState.hierarchyState.path, scope.newLinkSrc.id, scope.selectedItem.id);\n          if (validity.valid) {\n            return 'green';\n          } else {\n            if (validity.reason === 3) {\n              validity = HierarchyManipulationService.checkLinkValidity(viewState.hierarchyState.path, scope.selectedItem.id, scope.newLinkSrc.id);\n              if (validity.valid) {\n                return 'green';\n              }\n            }\n            return 'red';\n          }\n        };\n        scope.getLabelLegalnessColor = function (d) {\n          var dom = scope.svg.select('.emuhierarchy-contextmenu input')[0][0];\n          var levelName = LevelService.getLevelName(d.id);\n          var attrIndex = viewState.getCurAttrIndex(levelName);\n          var legalLabels = scope.cps.getLevelDefinition(levelName).attributeDefinitions[attrIndex].legalLabels;\n          if (legalLabels === undefined || dom.value.length > 0 && legalLabels.indexOf(dom.value) >= 0) {\n            return 'lightgreen';\n          } else {\n            return 'red';\n          }\n        };\n        scope.svgOnMouseMove = function (d) {\n          if (scope.newLinkSrc !== undefined) {\n            var mouse = scope.getOrientatedMousePosition(d3.mouse(this));\n            var x = mouse[0];\n            var y = mouse[1];\n            scope.svg.select('path.emuhierarchy-newlink').attr('d', 'M' + scope.newLinkSrc._x + ',' + scope.newLinkSrc._y + ' L' + x + ',' + y);\n            ;\n          }\n        };\n        scope.svgOnClick = function (d) {\n          if (viewState.hierarchyState.contextMenuID !== undefined) {\n            scope.$apply(function () {\n              viewState.hierarchyState.contextMenuID = undefined;\n            });\n          }\n        };\n        scope.nodeOnClick = function (d) {\n          console.debug('Clicked node', d);\n          if (viewState.hierarchyState.contextMenuID === undefined) {\n            d3.event.stopPropagation();\n            viewState.hierarchyState.contextMenuID = d.id;\n            scope.$apply(function () {\n              scope.render();\n            });\n          }\n          if (viewState.hierarchyState.contextMenuID === d.id) {\n            d3.event.stopPropagation();\n          }\n        };\n        scope.nodeOnPlayClick = function (d) {\n          scope.play(d);\n        };\n        scope.nodeOnCollapseClick = function (d) {\n          console.debug('collapsing', d);\n          // (De-)Collapse sub-tree\n          HierarchyLayoutService.toggleCollapse(d, viewState.hierarchyState.path);\n          scope.render();\n        };\n        scope.nodeOnMouseOver = function (d) {\n          scope.selectItem(d);\n          scope.renderSelectionOnly();\n        };\n        scope.nodeOnInput = function (d) {\n          // select() returns a single-element selection, which is always\n          // a multi-dimensional array with [0][0] being the DOM node I'm\n          // looking for\n          var dom = scope.svg.select('.emuhierarchy-contextmenu input')[0][0];\n          viewState.hierarchyState.setEditValue(dom.value);\n          // Give feedback on legalness\n          dom.style.backgroundColor = scope.getLabelLegalnessColor(d);\n        };\n        scope.nodeOnFocusIn = function (d) {\n          viewState.hierarchyState.inputFocus = true;\n        };\n        scope.nodeOnFocusOut = function (d) {\n          viewState.hierarchyState.inputFocus = false;\n        };\n        scope.linkOnMouseOver = function (d) {\n          scope.selectLink(d);\n          scope.renderSelectionOnly();\n        };\n        scope.addButtonOnClick = function (d) {\n          var id = LevelService.pushNewItem(d);\n          if (id !== -1) {\n            scope.historyService.addObjToUndoStack({\n              type: 'HIERARCHY',\n              action: 'PUSHITEM',\n              newID: id,\n              level: d\n            });\n          }\n          scope.$apply();\n        };\n        scope.play = function (d) {\n          var timeInfoLevel = viewState.hierarchyState.path[0];\n          if (typeof timeInfoLevel === 'undefined') {\n            console.debug('Likely a bug: There is no path selection. Not executing play():', d);\n            return;\n          }\n          var timeInfoType = LevelService.getLevelDetails(timeInfoLevel).type;\n          var firstTimeItem = null;\n          var lastTimeItem = null;\n          var itemList = [d];\n          var currentItem;\n          while (itemList.length > 0) {\n            currentItem = itemList.pop();\n            if (currentItem.labels[0].name === timeInfoLevel) {\n              if (lastTimeItem === null) {\n                lastTimeItem = currentItem;\n              }\n              firstTimeItem = currentItem;\n            }\n            itemList = itemList.concat(HierarchyLayoutService.findChildren(currentItem, viewState.hierarchyState.path));\n          }\n          console.debug('Node info for playback: ', timeInfoType, d, firstTimeItem, lastTimeItem);\n          if (firstTimeItem === null) {\n            console.debug('No time information found for node, aborting playback', d);\n            return;\n          }\n          var startSample = 0;\n          var endSample = 0;\n          if (timeInfoType === 'EVENT') {\n            startSample = firstTimeItem.samplePoint;\n            endSample = lastTimeItem.samplePoint;\n          } else if (timeInfoType === 'SEGMENT') {\n            startSample = firstTimeItem.sampleStart;\n            endSample = lastTimeItem.sampleStart + lastTimeItem.sampleDur;\n          }\n          console.debug('Sample information for playback:', startSample, endSample);\n          Soundhandlerservice.playFromTo(startSample, endSample);\n        };\n        scope.depthToX = function (depth) {\n          var size = scope.vertical ? scope.height : scope.width;\n          var offset = scope.vertical ? scope.vertOffsetY : scope.offsetX;\n          return offset + depth / viewState.hierarchyState.path.length * size;\n        };\n        scope.posInLevelToY = function (posInLevel) {\n          var size = scope.vertical ? scope.width : scope.height;\n          var offset = scope.vertical ? scope.vertOffsetX : scope.offsetY;\n          size -= offset;\n          return offset + posInLevel * size;\n        };\n        //\n        /////////////////////////////\n        /////////////////////////////\n        // inital d3.js setup stuff\n        scope.element = element;\n        scope.width = 0;\n        scope.height = 0;\n        // lazy loading\n        scope.background = '';\n        // set background according to config only if config is loaded\n        if (scope.cps.design.color !== undefined) {\n          scope.background = scope.cps.design.color.lightGrey;\n        }\n        // scaleExtent limits the amount of zooming possible\n        scope.zoomListener = d3.behavior.zoom().scaleExtent(scope.scaleExtent).on('zoom', scope.zoom);\n        // Create the d3 element and position it based on margins\n        scope.svg = d3.select(element[0]).append('svg').attr('width', '100%').attr('height', '100%').style('background-color', scope.background).call(scope.zoomListener).on('dblclick.zoom', null).on('mousemove', scope.svgOnMouseMove).on('click', scope.svgOnClick).append('g');\n        ;\n        scope.shiftMode = false;\n        scope.checkLink = function (event) {\n          if (event.shiftKey && !scope.shiftMode) {\n            if (viewState.hierarchyState.newLinkFromID === undefined) {\n              viewState.hierarchyState.newLinkFromID = viewState.hierarchyState.selectedItemID;\n              scope.shiftMode = true;\n            }\n          }\n          if (!event.shiftKey && scope.shiftMode) {\n            scope.shiftMode = false;\n            var linkObj = HierarchyManipulationService.addLink(viewState.hierarchyState.path, viewState.hierarchyState.newLinkFromID, viewState.hierarchyState.selectedItemID);\n            viewState.hierarchyState.newLinkFromID = undefined;\n            if (linkObj !== null) {\n              HistoryService.addObjToUndoStack({\n                type: 'HIERARCHY',\n                action: 'ADDLINK',\n                link: linkObj\n              });\n            }\n          }\n        };\n        // Append a group which holds all overlay captions and which do not react to zooming\n        scope.captionLayer = scope.svg.append('g').style('z-index', 5);\n        scope.timeArrow = scope.svg.append('g').append('text').text('time \\u2192');\n        // Append a group which holds all nodes and which the zoom Listener can act upon.\n        scope.svg = scope.svg.append('g').style('z-index', 1);\n        //\n        /////////////////////////////\n        ////////////\n        // Here come the two main functions of the directive\n        //\n        // scope.render() and scope.renderSelectionOnly() do the bulk of the\n        // work\n        /**\n\t * Adjust the colors of all nodes and links to reflect the user's\n\t * selection.\n\t *\n\t * @param nothing\n\t * @returns nothing\n\t */\n        scope.renderSelectionOnly = function () {\n          // Change the circle fill of all nodes depending on whether they are selected\n          scope.svg.selectAll('circle.emuhierarchy-nodeCircle').style('fill', function (d) {\n            var color = ConfigProviderService.design.color.white;\n            if (typeof scope.selectedItem !== 'undefined' && d.id === scope.selectedItem.id) {\n              color = ConfigProviderService.design.color.blue;\n            }\n            return color;\n          });\n          ;\n          scope.svg.selectAll('path.emuhierarchy-link').style('stroke', function (d) {\n            if (scope.selectedLink === d) {\n              return ConfigProviderService.design.color.yellow;\n            } else {\n              return ConfigProviderService.design.color.grey;\n            }\n          });\n          ;\n          scope.svg.select('.emuhierarchy-newlinkpreview').attr('d', scope.getPreviewPath).style('stroke', scope.getPreviewColor);\n          ;\n        };\n        /**\n         * (Re-)Render the complete hierarchical structure\n\t *\n\t * Calls HierarchyLayoutService to calculate the relative positions of\n\t * all nodes and links within the graph and then uses the above helper\n\t * functions to calculate the absolute positons within the SVG.\n\t *\n\t * Makes use of D3JS data joins at various positions. For an\n\t * introduction to the concept, see: http://bost.ocks.org/mike/join/\n\t *\n\t * It basically works by associating a data set with an SVG selection.\n\t * D3 then divides this data set in three sections: enter, update and\n\t * exit.\n\t *\n         */\n        scope.render = function () {\n          // This is an undesired fix for #110\n          // We clean the SVG element on every re-render, thereby destroying the\n          // possibility of eye-candy transitions\n          scope.svg.selectAll('*').remove();\n          var i;\n          // Get current width and height of SVG\n          scope.width = parseInt(d3.select(scope.element[0]).style('width'), 10);\n          scope.height = parseInt(d3.select(scope.element[0]).style('height'), 10);\n          // Set orientation\n          if (scope.transition.rotation) {\n            scope.svg.transition().duration(scope.transition.duration).attr('transform', scope.getOrientatedTransform());\n            ;\n          } else {\n            scope.svg.attr('transform', scope.getOrientatedTransform());\n          }\n          /////////\n          // Draw time arrow\n          if (scope.vertical) {\n            scope.timeArrow.attr('transform', 'translate(' + scope.width / 2 + ',' + (scope.height - 10) + ')');\n          } else {\n            scope.timeArrow.attr('transform', 'translate(' + (scope.width - 20) + ',' + scope.height / 2 + ')rotate(90)');\n          }\n          /////////\n          // Draw level captions and 'add item buttons' (which append\n          // nodes to the respective levels\n          scope.captionLayer.attr('transform', scope.getOrientatedLevelCaptionLayerTransform);\n          // for reference on the .data() call, compare the comment on\n          // scope.render() above\n          var levelCaptionSet = scope.captionLayer.selectAll('g.emuhierarchy-levelcaption').data(viewState.hierarchyState.path, function (d) {\n              return d;\n            });\n          var newLevelCaptions = levelCaptionSet.enter();\n          var oldLevelCaptions = levelCaptionSet.exit();\n          newLevelCaptions = newLevelCaptions.append('g').attr('class', 'emuhierarchy-levelcaption');\n          ;\n          newLevelCaptions.append('text').text(function (d) {\n            return d;\n          });\n          ;\n          var addItemButtons = newLevelCaptions.filter(function (d) {\n              var levelType = LevelService.getLevelDetails(d).type;\n              return levelType === 'ITEM';\n            }).append('g').attr('class', 'emuhierarchy-addbutton').attr('transform', scope.getOrientatedAddItemButtonTransform).on('click', scope.addButtonOnClick);\n          ;\n          addItemButtons.append('circle').style('fill', scope.cps.design.color.blue).attr('r', 8);\n          ;\n          addItemButtons.append('path').style('stroke', scope.cps.design.color.white).attr('d', 'M0,-6 V6 M-6,0 H6');\n          ;\n          levelCaptionSet.attr('transform', scope.getOrientatedLevelCaptionTransform);\n          ;\n          if (scope.transition.rotation) {\n            oldLevelCaptions = oldLevelCaptions.transition().duration(scope.transition.duration).remove();\n            ;\n          } else {\n            oldLevelCaptions.remove();\n          }\n          oldLevelCaptions.select('text').style('fill-opacity', 0);\n          ;\n          //\n          /////////\n          /////////\n          // Compute the new tree layout (first nodes and then links)\n          //\n          var nodes = [];\n          HierarchyLayoutService.calculateWeightsBottomUp(viewState.hierarchyState.path);\n          for (var i = 0; i < viewState.hierarchyState.path.length; ++i) {\n            // Add all nodes that are not collapsed\n            var levelItems = LevelService.getLevelDetails(viewState.hierarchyState.path[i]).items;\n            for (var ii = 0; ii < levelItems.length; ++ii) {\n              if (levelItems[ii]._visible) {\n                nodes.push(levelItems[ii]);\n              }\n            }\n          }\n          ////////\n          // Now layout links\n          //\n          // We must only draw links that are part of the currently selected path.\n          // We must therefore filter the links.\n          //\n          // We must also filter out links that are collapsed\n          //\n          // What follows below is a probably very low-performance approach to filtering\n          //\n          var links = [];\n          var allLinks = DataService.getData().links;\n          for (var l = 0; l < allLinks.length; ++l) {\n            for (var i = 0; i < viewState.hierarchyState.path.length - 1; ++i) {\n              var element = LevelService.getItemFromLevelById(viewState.hierarchyState.path[i], allLinks[l].toID);\n              var parentElement = LevelService.getItemFromLevelById(viewState.hierarchyState.path[i + 1], allLinks[l].fromID);\n              if (element === null) {\n                continue;\n              }\n              if (parentElement === null) {\n                continue;\n              }\n              if (!element._visible) {\n                continue;\n              }\n              if (viewState.getCollapsed(parentElement.id) || !parentElement._visible) {\n                continue;\n              }\n              links.push(allLinks[l]);\n            }\n          }\n          // Transform relative coordinates (_posInLevel and _depth) to actual coordinates (_x and _y)\n          nodes.forEach(function (d) {\n            d._x = scope.depthToX(d._depth);\n            d._y = scope.posInLevelToY(d._posInLevel);\n          });\n          links.forEach(function (d) {\n            d._fromX = scope.depthToX(d._fromDepth);\n            d._fromY = scope.posInLevelToY(d._fromPosInLevel);\n            d._toX = scope.depthToX(d._toDepth);\n            d._toY = scope.posInLevelToY(d._toPosInLevel);\n          });\n          //////\n          // Now that all actual coordinates have been calculated, we\n          // update our SVG using d3js data joins\n          //\n          // for reference on the .data() call, compare the comment on\n          // scope.render() above\n          //\n          // Define the data set to be visualised\n          var dataSet = scope.svg.selectAll('g.emuhierarchy-node').data(nodes, function (d) {\n              return d.id;\n            });\n          var newNodes = dataSet.enter();\n          var oldNodes = dataSet.exit();\n          //\n          // Add nodes that were previously not part of the svg.\n          //\n          // Any node will consist of an svg group (\"g\"), a circle, a\n          // text and a second, invisible circle for mouseover handling.\n          //\n          // Note that properties that can be changed after the node is\n          // added will be set further below\n          newNodes = newNodes.append('g').attr('class', 'emuhierarchy-node').attr('pointer-events', 'mouseover').on('click', scope.nodeOnClick).on('mouseover', scope.nodeOnMouseOver);\n          ;\n          var circle = newNodes.append('circle').attr('class', 'emuhierarchy-nodeCircle').style('stroke', scope.cps.design.color.grey);\n          ;\n          if (scope.transition.nodes) {\n            circle.attr('r', 0).transition().duration(scope.transition.duration).attr('r', 4.5);\n            ;\n          } else {\n            circle.attr('r', 4.5);\n          }\n          newNodes.append('text').attr('class', 'emuhierarchy-nodeText');\n          ;\n          // Make sure that nodes that appear due to their ancestry being uncollapsed do not fly in from the origin\n          // (as do all other nodes)\n          newNodes.attr('transform', function (d) {\n            var position = viewState.getCollapsePosition(d.id);\n            if (typeof position !== 'undefined') {\n              var x = position[0];\n              var y = position[1];\n              viewState.setCollapsePosition(d.id, undefined);\n              return 'translate(' + x + ',' + y + ')' + scope.getOrientatedNodeTransform();\n            }\n          });\n          //\n          // Remove nodes that shall no longer be part of the svg\n          // Transition exiting nodes to the origin\n          // FIXME put that anyonymous transform function on scope\n          if (scope.transition.nodes) {\n            oldNodes = oldNodes.transition().duration(scope.transition.duration).attr('transform', function (d) {\n              var collapsePosition = viewState.getCollapsePosition(d.id);\n              if (typeof collapsePosition !== 'undefined') {\n                var x = collapsePosition[0];\n                var y = collapsePosition[1];\n                viewState.setCollapsePosition(d.id, undefined);\n                return 'translate(' + x + ',' + y + ')';\n              } else {\n                return 'translate(' + 0 + ',' + 0 + ')';\n              }\n            }).remove();\n          } else {\n            oldNodes = oldNodes.attr('transform', function (d) {\n              var collapsePosition = viewState.getCollapsePosition(d.id);\n              if (typeof collapsePosition !== 'undefined') {\n                var x = collapsePosition[0];\n                var y = collapsePosition[1];\n                viewState.setCollapsePosition(d.id, undefined);\n                return 'translate(' + x + ',' + y + ')';\n              } else {\n                return 'translate(' + 0 + ',' + 0 + ')';\n              }\n            }).remove();\n          }\n          oldNodes.select('text').style('fill-opacity', 0);\n          //\n          // Set or update properties that are subject to change after\n          // the node is added.\n          dataSet.select('text').attr('x', scope.getOrientatedTextX).attr('y', scope.getOrientatedTextY).attr('text-anchor', scope.getOrientatedTextAnchor).attr('transform', scope.getOrientatedTextTransform).text(scope.getNodeText);\n          ;\n          // Change the circle fill depending on whether it is collapsed and/or selected\n          dataSet.select('circle.emuhierarchy-nodeCircle').style('fill', function (d) {\n            var color = scope.cps.design.color.white;\n            if (typeof scope.selectedItem !== 'undefined' && d.id === scope.selectedItem.id) {\n              color = scope.cps.design.color.blue;\n            }\n            return color;\n          }).style('stroke', function (d) {\n            if (viewState.getCollapsed(d.id)) {\n              return scope.cps.design.color.red;\n            } else {\n              return scope.cps.design.color.grey;\n            }\n          });\n          ;\n          // Transition nodes to their new position\n          if (scope.transition.nodes) {\n            dataSet.transition().duration(scope.transition.duration).attr('transform', function (d) {\n              return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n            });\n          } else {\n            dataSet.attr('transform', function (d) {\n              return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n            });\n          }\n          /////\n          // Create context menu\n          // If the context menu has been closed, remove the elements\n          if (viewState.hierarchyState.contextMenuID === undefined) {\n            scope.svg.selectAll('.emuhierarchy-contextmenu').remove();\n            ;\n          }\n          // If the context menu does not yet exist, create it\n          var contextMenu = scope.svg.select('.emuhierarchy-contextmenu');\n          if (contextMenu[0][0] === null) {\n            contextMenu = dataSet.filter(function (d) {\n              return d.id === viewState.hierarchyState.contextMenuID;\n            }).append('g').attr('class', 'emuhierarchy-contextmenu');\n            ;\n            contextMenu.append('circle').style('fill', 'darkgrey').attr('r', 50).style('cursor', 'default');\n            ;\n            if (scope.transition.contextMenu) {\n              contextMenu.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 0.5);\n              ;\n            }\n            contextMenu.append('text').text(scope.getOrientatedNodeCollapseText).attr('x', -25).attr('y', -25).attr('text-anchor', 'middle').on('click', scope.nodeOnCollapseClick);\n            ;\n            if (scope.transition.contextMenu) {\n              contextMenu.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 1);\n              ;\n            }\n            contextMenu.append('text').text('play').attr('x', -25).attr('y', +25).attr('text-anchor', 'middle').on('click', scope.nodeOnPlayClick);\n            ;\n            if (scope.transition.contextMenu) {\n              contextMenu.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 1);\n              ;\n            }\n            var foreignObject = contextMenu.append('foreignObject').attr('height', 30).attr('x', 10).attr('y', -15).attr('width', 0);\n            ;\n            if (scope.transition.contextMenu) {\n              foreignObject.transition().duration(scope.transition.duration).attr('width', 100);\n              ;\n            } else {\n              foreignObject.attr('width', 100);\n            }\n            foreignObject.append('xhtml:body').append('input').attr('value', scope.getNodeText).style('width', '100%').style('height', '100%').style('outline', 'none').style('border', '0').style('background-color', scope.getLabelLegalnessColor).on('input', scope.nodeOnInput).on('focusin', scope.nodeOnFocusIn).on('focusout', scope.nodeOnFocusOut);\n            ;\n            if (foreignObject[0].length !== 0) {\n              foreignObject.select('input')[0][0].focus();\n              foreignObject.select('input')[0][0].select();\n            }\n          } else {\n            scope.svg.select('.emuhierarchy-contextmenu text').text(scope.getOrientatedNodeCollapseText);\n          }\n          // Make sure the node containing the context menu is the last\n          // one in the SVG, otherwise the succeeding elements are drawn\n          // visually on top of the context menu.\n          scope.svg.selectAll('.emuhierarchy-node').sort(function (a, b) {\n            if (a.id === viewState.hierarchyState.contextMenuID) {\n              return 1;\n            }\n            if (b.id === viewState.hierarchyState.contextMenuID) {\n              return -1;\n            }\n            return 0;\n          });\n          //\n          //\n          // Now we turn to visualising links\n          //\n          // for reference on the .data() call, compare the comment on\n          // scope.render() above\n          var linkSet = scope.svg.selectAll('.emuhierarchy-linkgroup').data(links, function (d) {\n              // Form unique link ID\n              return 's' + d.fromID + 't' + d.toID;\n            });\n          var newLinks = linkSet.enter();\n          var oldLinks = linkSet.exit();\n          // The new link's paths are inserted within the svg element\n          // that linkSet was generated from.\n          // They must be inserted at the beginning (before the nodes,\n          // which have already been appended), because there is no CSS\n          // z-index for SVG.\n          // So the order of insertion is the only way to make sure that\n          // the lines are painted under the nodes.\n          newLinks = newLinks.insert('g', ':first-child').attr('class', 'emuhierarchy-linkgroup');\n          ;\n          // Append thicker ghost lines for better mouseover\n          newLinks.append('path').attr('class', 'emuhierarchy-ghostlink').style('stroke-width', scope.getOrientatedGhostLinkStrokeWidth).on('mouseover', scope.linkOnMouseOver);\n          ;\n          newLinks.append('path').attr('class', 'emuhierarchy-link').style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n          ;\n          if (scope.vertical) {\n            newLinks.attr('transform', 'scale(1, ' + scope.zoomListener.scale() + ')');\n          } else {\n            newLinks.attr('transform', 'scale(' + scope.zoomListener.scale() + ', 1)');\n          }\n          if (scope.transition.links) {\n            newLinks.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 1);\n            ;\n          }\n          // Remove old links\n          if (scope.transition.links) {\n            oldLinks.transition().duration(scope.transition.duration).style('opacity', 0).remove();\n            ;\n          } else {\n            oldLinks.remove();\n          }\n          // Set color depending on whether the link is selected\n          linkSet.selectAll('.emuhierarchy-link').style('stroke', function (d) {\n            if (scope.selectedLink === d) {\n              return scope.cps.design.color.yellow;\n            } else {\n              return scope.cps.design.color.grey;\n            }\n          });\n          ;\n          // Transition links to their new position.\n          if (scope.transition.rotation) {\n            linkSet.selectAll('.emuhierarchy-link').transition().duration(scope.transition.duration).attr('d', scope.getPath).style('stroke-width', scope.getOrientatedLinkStrokeWidth).style('opacity', 1);\n            ;\n          } else {\n            linkSet.selectAll('.emuhierarchy-link').attr('d', scope.getPath).style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n            ;\n          }\n          linkSet.selectAll('.emuhierarchy-ghostlink').attr('d', scope.getPath);\n          ;\n          // If the user is trying to add a new link,\n          // visualise what he's doing\n          scope.svg.selectAll('.emuhierarchy-newlink').remove();\n          scope.svg.selectAll('.emuhierarchy-newlinkpreview').remove();\n          if (scope.newLinkSrc !== undefined) {\n            scope.svg.append('path').attr('class', 'emuhierarchy-newlink').style('stroke', 'black').style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n            ;\n            var preview = scope.svg.append('path').attr('class', 'emuhierarchy-newlinkpreview').attr('d', scope.getPreviewPath).style('stroke', scope.getPreviewColor).style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n            ;\n            if (scope.vertical) {\n              preview.attr('transform', 'scale(1, ' + scope.zoomListener.scale() + ')');\n            } else {\n              preview.attr('transform', 'scale(' + scope.zoomListener.scale() + ', 1)');\n            }\n          }\n        };\n        /**\n         * SIC... not being called\n         */\n        scope.resizeHierarchy = function () {\n          console.log('###############');\n          console.log(scope.width);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('epg', [\n  'viewState',\n  function (viewState) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the epg directive');\n        var canvas = element.find('canvas')[0];\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawEpgGrid(scope);\n                }\n              }\n            }\n          }\n        }, true);\n        scope.$watch('vs.curMousePosSample', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawEpgGrid(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        ////////////////////\n        /**\n\t\t\t\t * drawing method to drawEpgGrid\n\t\t\t\t */\n        scope.drawEpgGrid = function (scope) {\n          var ctx = canvas.getContext('2d');\n          tr = scope.cps.getSsffTrackConfig('EPG');\n          // SIC SIC SIC hardcoded for now although it might stay that way because it only is allowed to draw epg data anyway\n          col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n          sRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(tr.name);\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.fillStyle = 'green';\n          ctx.strokeStyle = scope.cps.design.color.black;\n          ctx.font = scope.cps.design.font.input.size.slice(0, -2) + 'px' + ' ' + scope.cps.design.font.input.family;\n          var gridWidth = canvas.width / 8;\n          var gridHeight = canvas.height / 8;\n          var sInterv = 1 / sRaSt.sampleRate - sRaSt.startTime;\n          var curFrame = Math.round(scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate / sInterv);\n          var binValStrArr;\n          var curFrameVals = angular.copy(col.values[curFrame]);\n          curFrameVals.reverse();\n          angular.forEach(curFrameVals, function (el, elIdx) {\n            binValStrArr = el.toString(2).split('').reverse();\n            // pad with zeros\n            while (binValStrArr.length < 8) {\n              binValStrArr.push('0');\n            }\n            binValStrArr.forEach(function (binStr, binStrIdx) {\n              if (binStr === '1') {\n                ctx.fillStyle = 'grey';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              } else {\n                ctx.fillStyle = 'white';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              }\n            });\n          });\n          // draw labels\n          scope.fontImage.drawUndistortedTextTwoLines(ctx, 'EPG', 'Frame:' + curFrame, scope.cps.design.font.input.size.slice(0, -2) * 3 / 4, scope.cps.design.font.input.family, 5, 0, scope.cps.design.color.black, true);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dots', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  'loadedMetaDataService',\n  'mathHelperService',\n  function (viewState, ConfigProviderService, Ssffdataservice, fontScaleService, Soundhandlerservice, loadedMetaDataService, mathHelperService) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas class=\"emuwebapp-twoDimCanvasStatic\" width=\"512\" height=\"512\"></canvas><canvas class=\"emuwebapp-twoDimCanvasDots\" width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        scope.ssffds = Ssffdataservice;\n        scope.vs = viewState;\n        scope.fontImage = fontScaleService;\n        scope.shs = Soundhandlerservice;\n        scope.lmds = loadedMetaDataService;\n        scope.mhs = mathHelperService;\n        var staticContoursCanvas = element.find('canvas')[0];\n        var canvas = element.find('canvas')[1];\n        var globalMinX = Infinity;\n        var globalMaxX = -Infinity;\n        var globalMinY = Infinity;\n        var globalMaxY = -Infinity;\n        var tr, col, sRaSt;\n        var startPoint = Math.PI / 180 * 0;\n        var endPoint = Math.PI / 180 * 360;\n        ////////////////////\n        // watches\n        //\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawDots();\n                }\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMousePosSample', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curPerspectiveIdx', function () {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newVal) {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        //////////////////\n        scope.setGlobalMinMaxVals = function () {\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          }\n          // also check staticDots\n          dD.staticDots.forEach(function (sD) {\n            sD.xCoordinates.forEach(function (xVal, xIdx) {\n              // check x\n              if (xVal < globalMinX) {\n                globalMinX = xVal;\n              }\n              if (xVal > globalMaxX) {\n                globalMaxX = xVal;\n              }\n              // check y\n              if (sD.yCoordinates[xIdx] < globalMinY) {\n                globalMinY = sD.yCoordinates[xIdx];\n              }\n              if (sD.yCoordinates[xIdx] > globalMaxY) {\n                globalMaxY = sD.yCoordinates[xIdx];\n              }\n            });\n          });\n          // and staticContours\n          angular.forEach(dD.staticContours, function (sC) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(sC.xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(sC.ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          });\n        };\n        /**\n\t\t\t\t * drawing to draw overlay1 i.e. static\n\t\t\t\t */\n        scope.drawStaticContour = function () {\n          var ctx = staticContoursCanvas.getContext('2d');\n          ctx.clearRect(0, 0, staticContoursCanvas.width, staticContoursCanvas.height);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          for (var i = 0; i < dD.staticContours.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.staticContours[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.staticContours[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            var xPrev = undefined;\n            var yPrev = undefined;\n            for (var j = 0; j < xCol.values.length; j++) {\n              var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.staticContours[i].xSsffTrack);\n              var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.staticContours[i].ySsffTrack);\n              //check if sampleRate and startTime is the same\n              if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n                alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n                // SIC should never get here!\n                return;\n              }\n              var x = (xCol.values[j][dD.staticContours[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * staticContoursCanvas.width;\n              var y = staticContoursCanvas.height - (yCol.values[j][dD.staticContours[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * staticContoursCanvas.height;\n              ctx.strokeStyle = dD.staticContours[i].color;\n              ctx.fillStyle = dD.staticContours[i].color;\n              ctx.beginPath();\n              ctx.arc(x, y, 2, startPoint, endPoint, true);\n              ctx.fill();\n              //ctx.closePath();\n              // draw lines\n              if (j >= 1 && dD.staticContours[i].connect) {\n                ctx.beginPath();\n                ctx.moveTo(xPrev, yPrev);\n                ctx.lineTo(x, y);\n                ctx.stroke();\n              }\n              xPrev = x;\n              yPrev = y;\n            }\n          }\n        };\n        /**\n\t\t\t\t * drawing method to drawDots\n\t\t\t\t */\n        scope.drawDots = function () {\n          if (globalMinX === Infinity) {\n            scope.setGlobalMinMaxVals();\n            if (scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0].staticContours !== undefined) {\n              scope.drawStaticContour();\n            }\n          }\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          //////////////////////////////\n          // markup to improve visualization\n          var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          // draw corner pointers\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.lineTo(5, 5);\n          ctx.moveTo(0, canvas.height);\n          ctx.lineTo(5, canvas.height - 5);\n          ctx.moveTo(canvas.width, canvas.height);\n          ctx.lineTo(canvas.width - 5, canvas.height - 5);\n          ctx.stroke();\n          ctx.closePath();\n          var smallFontSize = scope.cps.design.font.input.size.slice(0, -2) * 3 / 4;\n          // ymax\n          scope.fontImage.drawUndistortedText(ctx, 'yMax: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMaxY, 2), smallFontSize, scope.cps.design.font.input.family, 5, 5, scope.cps.design.color.black);\n          // xmin + y min\n          scope.fontImage.drawUndistortedTextTwoLines(ctx, 'yMin: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMinY, 2), 'xMin: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMinX, 2), smallFontSize, scope.cps.design.font.input.family, 5, canvas.height - smallFontSize * scaleY * 2 - 5, scope.cps.design.color.black, true);\n          // xmax\n          var tw = ctx.measureText('xMax: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMaxX, 5)).width * scaleX;\n          // SIC why 5???\n          scope.fontImage.drawUndistortedText(ctx, 'xMax: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMaxX, 2), smallFontSize, scope.cps.design.font.input.family, canvas.width - tw - 5, canvas.height - smallFontSize * scaleY - 5, scope.cps.design.color.black);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          // frame nr\n          var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].xSsffTrack);\n          // use first track for sample numbers\n          var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].ySsffTrack);\n          var sInterv = 1 / xsRaSt.sampleRate;\n          var curMousePosTime = scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate;\n          var curFrame;\n          if (xsRaSt.startTime === 1 / xsRaSt.sampleRate / 2) {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate);\n          } else {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate + (xsRaSt.startTime - 1 / xsRaSt.sampleRate / 2) * xsRaSt.sampleRate);\n          }\n          // check if due to math.round curFrame > col.length\n          var trConf = scope.cps.getSsffTrackConfig(dD.dots[0].xSsffTrack);\n          var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n          if (curFrame > xCol.values.length - 1) {\n            curFrame = xCol.values.length - 1;\n          }\n          tw = ctx.measureText('frame: ' + curFrame).width * scaleX;\n          var degrees = 90;\n          ctx.save();\n          ctx.rotate(degrees * Math.PI / 180);\n          scope.fontImage.drawUndistortedText(ctx, 'frame: ' + curFrame, scope.cps.design.font.input.size.slice(0, -2) - 4, scope.cps.design.font.input.family, canvas.width / 2 - tw / 2, -canvas.height, scope.cps.design.color.black);\n          ctx.restore();\n          //////////////////////////////\n          // draw dots\n          var startPoint = Math.PI / 180 * 0;\n          // really don't get why the globals and visable here???\n          var endPoint = Math.PI / 180 * 360;\n          var allDots = [];\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // check if x and why have the same amount of cols\n            if (xCol.values.length !== yCol.values.length) {\n              alert('columns do not have same length or length of one not 1');\n              return;\n            }\n            var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].xSsffTrack);\n            var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].ySsffTrack);\n            // check if sampleRate and startTime is the same\n            if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n              alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n              return;\n            }\n            var x = (xCol.values[curFrame][dD.dots[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var y = canvas.height - (yCol.values[curFrame][dD.dots[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            ctx.strokeStyle = dD.dots[i].color;\n            ctx.beginPath();\n            ctx.arc(x, y, 20, startPoint, endPoint, true);\n            ctx.stroke();\n            ctx.closePath();\n            ctx.beginPath();\n            ctx.arc(x, y, 2, startPoint, endPoint, true);\n            ctx.fill();\n            ctx.closePath();\n            // draw labels\n            scope.fontImage.drawUndistortedText(ctx, dD.dots[i].name, scope.cps.design.font.input.size.slice(0, -2) - 4, scope.cps.design.font.input.family, x, y - 5, scope.cps.design.color.black);\n            // append to all dots\n            allDots.push({\n              'name': dD.dots[i].name,\n              'x': x,\n              'y': y\n            });\n          }\n          //////////////////////////\n          // draw connect lines\n          var f, t;\n          dD.connectLines.forEach(function (c) {\n            allDots.forEach(function (d) {\n              if (d.name === c.fromDot) {\n                f = d;\n              }\n              if (d.name === c.toDot) {\n                t = d;\n              }\n            });\n            // draw line\n            ctx.strokeStyle = c.color;\n            ctx.beginPath();\n            ctx.moveTo(f.x, f.y);\n            ctx.lineTo(t.x, t.y);\n            ctx.stroke();\n            ctx.closePath();\n          });\n          //////////////////////////\n          // draw static dots\n          var startPoint = Math.PI / 180 * 0;\n          var endPoint = Math.PI / 180 * 360;\n          dD.staticDots.forEach(function (sD) {\n            ctx.strokeStyle = sD.color;\n            ctx.fillStyle = sD.color;\n            // draw name\n            var labelX = (sD.xNameCoordinate - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var labelY = canvas.height - (sD.yNameCoordinate - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            var labelTxtImg = scope.fontImage.drawUndistortedText(ctx, sD.name, scope.cps.design.font.input.size.slice(0, -2) - 4, scope.cps.design.font.input.family, labelX, labelY, sD.color);\n            sD.xCoordinates.forEach(function (xVal, xIdx) {\n              var x = (xVal - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n              var y = canvas.height - (sD.yCoordinates[xIdx] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n              // draw dot\n              ctx.beginPath();\n              ctx.arc(x, y, 2, startPoint, endPoint, true);\n              ctx.fill();\n              ctx.closePath();\n              // draw connection\n              if (sD.connect && xIdx >= 1) {\n                var prevX = (sD.xCoordinates[xIdx - 1] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n                var prevY = canvas.height - (sD.yCoordinates[xIdx - 1] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n                ctx.beginPath();\n                ctx.moveTo(prevX, prevY);\n                ctx.lineTo(x, y);\n                ctx.stroke();\n                ctx.closePath();\n              }\n            });\n          });\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZone', [\n  '$animate',\n  '$compile',\n  'DragnDropService',\n  'browserDetector',\n  'appStateService',\n  'modalService',\n  function ($animate, $compile, DragnDropService, browserDetector, appStateService, modalService) {\n    return {\n      templateUrl: 'views/myDropZone.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        /* --------- Messages -------- */\n        scope.dropTextDefault = 'Drop your files here (.wav files; .wav & annotJSON file pairs; .wav & TextGrid file pairs) or click here to do the same with a file dialog';\n        scope.dropTextErrorFileType = 'Error: Could not parse file. The following file types are supported: .WAV .TEXTGRID _annot.json';\n        scope.dropTextErrorAPI = 'Sorry ! The File APIs are not supported in your browser.';\n        scope.dropAllowed = 'Drop file(s) to start loading !';\n        scope.dropParsingWaiting = '.TextGrid loaded! Please load .WAV file in order to start!';\n        scope.dropParsingWAV = '.WAV loaded! Proceeding without annotation data.';\n        scope.dropParsingWaitingAnnot = 'Annotation file loaded! Please load .WAV file in order to start!';\n        scope.dropFirefoxWarning = 'Sorry ! Firefox does not support dropping folders ! please drop single or multiple files !';\n        scope.dropText = scope.dropTextDefault;\n        scope.dropClass = '';\n        scope.dropClassDefault = '';\n        scope.dropClassOver = 'over';\n        scope.dropClassError = 'error';\n        scope.count = 0;\n        scope.handles = [];\n        scope.bundles = [];\n        scope.bundleNames = [];\n        scope.updateQueueLength = function (quantity) {\n          scope.count += quantity;\n        };\n        scope.enqueueFileAddition = function (file) {\n          var identifier = file.name.substring(file.name.lastIndexOf('_') + 1, file.name.lastIndexOf('.')).toUpperCase();\n          var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n          var bundle = '';\n          if (identifier === 'ANNOT') {\n            bundle = file.name.substr(0, file.name.lastIndexOf('_'));\n          } else {\n            bundle = file.name.substr(0, file.name.lastIndexOf('.'));\n          }\n          var j = scope.bundleNames.indexOf(bundle);\n          if (j === -1) {\n            scope.bundleNames.push(bundle);\n            j = scope.bundleNames.indexOf(bundle);\n            scope.bundles[j] = [];\n            scope.bundles[j][0] = bundle;\n          }\n          if (extension === 'WAV') {\n            scope.bundles[j][1] = file;\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWAV;\n          } else if (extension === 'TEXTGRID') {\n            scope.bundles[j][2] = {};\n            scope.bundles[j][2].file = file;\n            scope.bundles[j][2].type = 'textgrid';\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWaiting;\n          } else if (extension === 'JSON' && identifier === 'ANNOT') {\n            scope.bundles[j][2] = {};\n            scope.bundles[j][2].file = file;\n            scope.bundles[j][2].type = 'annotation';\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWaitingAnnot;\n          } else {\n            if (browserDetector.isBrowser.Firefox()) {\n              if (file.size === 0) {\n                scope.dropClass = scope.dropClassError;\n                scope.dropText = scope.dropFirefoxWarning;\n              } else {\n                scope.dropClass = scope.dropClassError;\n                scope.dropText = scope.dropTextErrorFileType;\n              }\n            } else {\n              scope.dropClass = scope.dropClassError;\n              scope.dropText = scope.dropTextErrorFileType;\n            }\n            scope.handles = [];\n            scope.bundles = [];\n            scope.bundleNames = [];\n            scope.count = 0;\n          }\n          if (!browserDetector.isBrowser.Firefox()) {\n            scope.$digest();\n          }\n          if (scope.bundles[j] !== undefined) {\n            scope.startRendering();\n          }\n        };\n        scope.startRendering = function () {\n          // If all the files we expect have shown up, then flush the queue.\n          if (scope.count === scope.handles.length) {\n            if (DragnDropService.setData(scope.bundles) === false) {\n              modalService.open('views/error.html', 'Sorry you dropped too many bundles (' + scope.handles.length + '). The maximum currently allowed is: ' + DragnDropService.maxDroppedBundles).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n            scope.handles = [];\n            scope.bundles = [];\n            scope.bundleNames = [];\n            scope.count = 0;\n            scope.dropText = scope.dropTextDefault;\n            scope.dropClass = scope.dropClassDefault;\n          }\n        };\n        scope.loadFiles = function (files) {\n          scope.updateQueueLength(files.length);\n          for (var i = 0; i < files.length; i++) {\n            var file = files[i];\n            if (file.name === '.DS_Store') {\n              scope.updateQueueLength(-1);\n            } else {\n              var entry, reader;\n              if (file.isFile || file.isDirectory) {\n                entry = file;\n              } else if (file.getAsEntry) {\n                entry = file.getAsEntry();\n              } else if (file.webkitGetAsEntry) {\n                entry = file.webkitGetAsEntry();\n              } else if (typeof file.getAsFile === 'function') {\n                scope.enqueueFileAddition(file.getAsFile());\n                continue;\n              } else if (File && file instanceof File) {\n                scope.enqueueFileAddition(file);\n                continue;\n              } else {\n                scope.updateQueueLength(-1);\n                continue;\n              }\n              if (!entry) {\n                updateQueueLength(-1);\n              } else if (entry.isFile) {\n                entry.file(function (file) {\n                  scope.enqueueFileAddition(file);\n                }, function (err) {\n                  console.warn(err);\n                });\n              } else if (entry.isDirectory) {\n                reader = entry.createReader();\n                reader.readEntries(function (entries) {\n                  scope.loadFiles(entries);\n                  scope.updateQueueLength(-1);\n                }, function (err) {\n                  console.warn(err);\n                });\n              }\n            }\n          }\n        };\n        scope.dropFiles = function (evt) {\n          evt.stopPropagation();\n          evt.preventDefault();\n          scope.$apply(function () {\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\n              if (evt.originalEvent !== undefined) {\n                if (browserDetector.isBrowser.Firefox()) {\n                  var items = evt.originalEvent.dataTransfer.files;\n                } else {\n                  var items = evt.originalEvent.dataTransfer.items;\n                }\n                scope.loadFiles(items);\n              }\n            } else {\n              // no browser support for FileAPI\n              modalService.open('views/error.html', scope.dropTextErrorAPI).then(function (res) {\n                scope.dropText = scope.dropTextDefault;\n                scope.dropClass = scope.dropClassDefault;\n                appStateService.resetToInitState();\n              });\n            }\n          });\n        };\n        scope.dragEnterLeave = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropTextDefault;\n            scope.dropClass = scope.dropClassDefault;\n          });\n        };\n        scope.handleDragOver = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropAllowed;\n            scope.dropClass = scope.dropClassOver;\n          });\n        };\n        element.bind('drop', function (event) {\n          scope.dropFiles(event);\n        });\n        element.bind('dragover', function (event) {\n          scope.handleDragOver(event);\n        });\n        element.bind('dragenter', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('dragleave', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('click', function (event) {\n          element.context.children[1].children[0].click();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZoneInput', [\n  '$animate',\n  'browserDetector',\n  'appStateService',\n  function ($animate, browserDetector, appStateService) {\n    return {\n      templateUrl: 'views/myDropZoneInput.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        scope.acceptGrid = '.TextGrid';\n        scope.acceptWav = 'audio/wav';\n        scope.acceptJson = 'application/json';\n        scope.acceptBoth = scope.acceptWav + ',' + scope.acceptGrid + ',' + scope.acceptJson;\n        scope.acceptFile = scope.acceptBoth;\n        scope.handleFilesonChange = function () {\n          var loadedFiles = element.context.children.fileDialog;\n          scope.$parent.loadFiles(loadedFiles.files);\n        };\n        element.bind('change', function (event) {\n          scope.handleFilesonChange(event);\n        });\n        element.bind('click', function (event) {\n          var elem = angular.element('input');\n          if (elem[1] !== undefined) {\n            elem[1].click();\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuwebapp', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/emuwebapp.html',\n      restrict: 'E',\n      scope: {\n        audioGetUrl: '@',\n        labelGetUrl: '@',\n        labelType: '@'\n      },\n      link: function postLink(scope, element, attrs) {\n        ////////////////////////\n        // Bindings\n        element.bind('mouseenter', function (event) {\n          viewState.mouseInEmuWebApp = true;\n        });\n        element.bind('mouseleave', function (event) {\n          viewState.mouseInEmuWebApp = false;\n        });\n        ///////////////////////\n        // observe attrs\n        attrs.$observe('audioGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.audioGetUrl = val;\n          }\n        });\n        attrs.$observe('labelGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelGetUrl = val;\n          }\n        });\n        attrs.$observe('labelType', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelType = val;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Validationservice', [\n  '$http',\n  '$q',\n  'ConfigProviderService',\n  function Validationservice($http, $q, ConfigProviderService) {\n    //shared service object to be returned\n    var sServObj = {};\n    var schemasJsos = [];\n    var names = [\n        'annotationFileSchema',\n        'emuwebappConfigSchema',\n        'DBconfigFileSchema',\n        'bundleListSchema',\n        'bundleSchema',\n        'designSchema'\n      ];\n    /**\n\t\t *\n\t\t */\n    function checkIfLevelsAreDefined(levelNames, DBconfig) {\n      var res = true;\n      // check levels are defined\n      DBconfig.levelDefinitions.forEach(function (ld) {\n        var lnIdx = levelNames.indexOf(ld.name);\n        while (lnIdx !== -1) {\n          levelNames.splice(lnIdx, 1);\n          lnIdx = levelNames.indexOf(ld.name);\n        }\n      });\n      if (levelNames.length !== 0) {\n        res = 'Following levels are not defined: ' + levelNames;\n      }\n      return res;\n    }\n    /**\n\t\t *\n\t\t */\n    function checkIfSsffTracksAreDefined(trackNames, DBconfig) {\n      var res = true;\n      // remove OSCI and SPEC\n      var tnIdx = trackNames.indexOf('OSCI');\n      if (tnIdx !== -1) {\n        trackNames.splice(tnIdx, 1);\n      }\n      tnIdx = trackNames.indexOf('SPEC');\n      if (tnIdx !== -1) {\n        trackNames.splice(tnIdx, 1);\n      }\n      // check levels are defined\n      DBconfig.ssffTrackDefinitions.forEach(function (td) {\n        var tnIdx = trackNames.indexOf(td.name);\n        while (tnIdx !== -1) {\n          trackNames.splice(tnIdx, 1);\n          tnIdx = trackNames.indexOf(td.name);\n        }\n      });\n      if (trackNames.length !== 0) {\n        res = 'Following ssffTracks are not defined: ' + trackNames;\n      }\n      return res;\n    }\n    //////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.semCheckLoadedConfigs = function (EMUwebAppConfig, DBconfig) {\n      var res = true;\n      var keepGoing = true;\n      /////////////////////////////////////////////////////////////////////\n      // check DBconfig levelDefinitions\n      DBconfig.levelDefinitions.forEach(function (ld, ldIdx) {\n        // check for duplicate attributeDefinition names\n        ld.attributeDefinitions.forEach(function (ad1, ad1idx) {\n          var counter = 0;\n          ld.attributeDefinitions.forEach(function (ad2) {\n            if (ad1.name === ad2.name) {\n              counter = counter + 1;\n            }\n          });\n          if (counter > 1) {\n            res = 'Error in DBconfig /levelDefinitions[' + ldIdx + ']/attributeDefinitions[' + ad1idx + '] duplicate attribute definitions found for this entry!';\n            keepGoing = false;\n          }\n        });\n      });\n      // TODO check for unique perspective names\n      ////////////////////////////////////////////////////////////////////\n      // check perspectives\n      EMUwebAppConfig.perspectives.forEach(function (p) {\n        if (keepGoing) {\n          /////////////////////////\n          // check signalCanvases\n          // check only defined signalCanvases are displayed\n          var tDefRes = checkIfSsffTracksAreDefined(angular.copy(p.signalCanvases.order), DBconfig);\n          if (tDefRes !== true) {\n            res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/order! References to undefined ssffTracks are present. ' + tDefRes;\n            keepGoing = false;\n          }\n          var assTrackNames = [];\n          // check only defined and displayed (in order array) assignments are present\n          p.signalCanvases.assign.forEach(function (ass) {\n            if (keepGoing) {\n              assTrackNames.push(ass.ssffTrackName);\n              // self assignments are not allowed\n              if (ass.signalCanvasName === ass.ssffTrackName) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! Assignment to self is not possible! signalCanvasesName: ' + ass.signalCanvasName;\n                keepGoing = false;\n              }\n              // OSCI and SPEC can not be assigned \n              if (ass.ssffTrackName === 'OSCI' || ass.ssffTrackName === 'SPEC') {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! Assignment of OSCI or SPEC is not possible!';\n                keepGoing = false;\n              }\n              // are defined\n              tDefRes = checkIfSsffTracksAreDefined([\n                ass.signalCanvasName,\n                ass.ssffTrackName\n              ], DBconfig);\n              if (tDefRes !== true) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! References to undefined ssffTracks are present. ' + tDefRes;\n                keepGoing = false;\n              }\n              // are displayed\n              var tnIdx = p.signalCanvases.order.indexOf(ass.signalCanvasName);\n              if (tnIdx === -1) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! References to ssffTracks that are not displayed (not in order array of that perspective) are: ' + ass.signalCanvasName;\n                keepGoing = false;\n              }\n            }\n          });\n          // check only defined and displayed contourLims are present\n          p.signalCanvases.contourLims.forEach(function (cl) {\n            if (keepGoing) {\n              // are defined\n              tDefRes = checkIfSsffTracksAreDefined([cl.ssffTrackName], DBconfig);\n              if (tDefRes !== true) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/contourLims! References to undefined ssffTracks are present. ' + tDefRes;\n                keepGoing = false;\n              }\n              // are displayed (concat to find assigned ssffTracks as well)\n              var tnIdx = p.signalCanvases.order.concat(assTrackNames).indexOf(cl.ssffTrackName);\n              if (tnIdx === -1) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/contourLims! References to ssffTracks that are not displayed (not in order array of that perspective) are: ' + cl.ssffTrackName;\n                keepGoing = false;\n              }\n            }\n          });\n          /////////////////////////\n          // check levelCanvases\n          // check only defined levels are displayed\n          var lDefRes = checkIfLevelsAreDefined(angular.copy(p.levelCanvases.order), DBconfig);\n          if (lDefRes !== true) {\n            res = 'Error in EMUwebAppConfig/perspectives/levelCanvases/order! References to undefined levels are present. ' + lDefRes;\n            keepGoing = false;\n          }\n          // check only SEGMENT or EVENT levels are displayed\n          p.levelCanvases.order.forEach(function (ln) {\n            if (keepGoing) {\n              var ld = ConfigProviderService.getLevelDefinition(ln);\n              if (ld.type !== 'SEGMENT' && ld.type !== 'EVENT') {\n                res = 'Error in EMUwebAppConfig/perspectives/levelCanvases/order! Configured to display levels of type ITEM as levels containing time information (ITEM level in order array). LevelName: ' + ln;\n                keepGoing = false;\n              }\n            }\n          });\n          /////////////////////////\n          // check twoDimCanvases\n          if (p.twoDimCanvases !== undefined) {\n            if (p.twoDimCanvases.twoDimDrawingDefinitions !== undefined) {\n              p.twoDimCanvases.twoDimDrawingDefinitions.forEach(function (tddd) {\n                if (keepGoing) {\n                  var dotNames = [];\n                  // check dots\n                  tddd.dots.forEach(function (d) {\n                    if (keepGoing) {\n                      dotNames.push(d.name);\n                      // are defined\n                      tDefRes = checkIfSsffTracksAreDefined([\n                        d.xSsffTrack,\n                        d.ySsffTrack\n                      ], DBconfig);\n                      if (tDefRes !== true) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/dots! References to undefined ssffTracks are present. ' + tDefRes;\n                        keepGoing = false;\n                      }\n                    }\n                  });\n                  // check connectLines\n                  tddd.connectLines.forEach(function (cl) {\n                    if (keepGoing) {\n                      // fromDot is defined\n                      var tnIdx = dotNames.indexOf(cl.fromDot);\n                      if (tnIdx === -1) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/connectLines! References dots in fromDot that are not defined. dots.name: ' + cl.fromDot;\n                        keepGoing = false;\n                      }\n                      // toDot is defined\n                      tnIdx = dotNames.indexOf(cl.toDot);\n                      if (tnIdx === -1) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/connectLines! References dots in toDot that are not defined. dots.name: ' + cl.toDot;\n                        keepGoing = false;\n                      }\n                    }\n                  });\n                  // check staticDots\n                  tddd.staticDots.forEach(function (sd) {\n                    if (keepGoing) {\n                      // check array is of the same length\n                      if (sd.xCoordinates.length !== sd.yCoordinates.length) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/staticDots! xCoordinates and yCoordinates are not of the same length!';\n                        keepGoing = false;\n                      }\n                    }\n                  });\n                }\n              });\n            }\n          }\n        }\n      });\n      ////////////////////////////////////////////////////////////////////\n      // check for anagestConfig and if the according tracks/levels are defined\n      // get tack and level names of anagestConfigs\n      var trackNames = [];\n      var levelNames = [];\n      DBconfig.levelDefinitions.forEach(function (ld) {\n        if (ld.anagestConfig !== undefined) {\n          trackNames.push(ld.anagestConfig.verticalPosSsffTrackName);\n          trackNames.push(ld.anagestConfig.velocitySsffTrackName);\n          levelNames.push(ld.anagestConfig.autoLinkLevelName);\n        }\n      });\n      // check levels\n      var lDefRes = checkIfLevelsAreDefined(levelNames, DBconfig);\n      if (lDefRes !== true) {\n        res = 'Error in DBconfig/levelDefinitions/anagestConfig/autoLinkLevelName! References to undefined levels are present. ' + lDefRes;\n      }\n      // check ssffTrackDefs\n      var tDefRes = checkIfSsffTracksAreDefined(trackNames, DBconfig);\n      if (tDefRes !== true) {\n        res = 'Error in DBconfig/levelDefinitions/anagestConfig/verticalPosSsffTrackName || velocitySsffTrackName! References to undefined ssffTracks are present. ' + tDefRes;\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.loadSchemas = function () {\n      var proms = [];\n      var uri;\n      angular.forEach(names, function (n) {\n        uri = 'schemaFiles/' + n + '.json';\n        proms.push($http.get(uri));\n      });\n      return $q.all(proms);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setSchemas = function (schemaArr) {\n      angular.forEach(schemaArr, function (s) {\n        schemasJsos.push({\n          name: s.config.url,\n          data: s.data\n        });\n        // add annotationFileSchema to tv4 for de-referencing $ref\n        if (s.config.url === 'schemaFiles/annotationFileSchema.json') {\n          tv4.addSchema(s.config.url, s.data);\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSchema = function (schemaName) {\n      var schema = undefined;\n      angular.forEach(schemasJsos, function (s) {\n        if (s.name === 'schemaFiles/' + schemaName + '.json') {\n          schema = s;\n        }\n      });\n      return schema;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.validateJSO = function (schemaName, jso) {\n      var schema = sServObj.getSchema(schemaName);\n      var res;\n      if (schema !== undefined && tv4.validate(jso, schema.data)) {\n        if (schemaName === 'DBconfigFileSchema') {\n          var semCheckRes = sServObj.semCheckLoadedConfigs(ConfigProviderService.vals, ConfigProviderService.curDbConfig);\n          if (semCheckRes === true) {\n            res = true;\n          } else {\n            res = semCheckRes;\n          }\n        } else {\n          res = true;\n        }\n      } else {\n        if (schema === undefined) {\n          res = 'Schema: ' + schemaName + ' is currently undefined! This is probably due to a misnamed schema file on the server...';\n        } else {\n          res = tv4.error;\n        }\n      }\n      return res;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ShowhierarchyCtrl', [\n  '$scope',\n  'viewState',\n  'modalService',\n  'ConfigProviderService',\n  'LevelService',\n  'HierarchyLayoutService',\n  'StandardFuncsService',\n  function ($scope, viewState, modalService, ConfigProviderService, LevelService, HierarchyLayoutService, StandardFuncsService) {\n    // Scope data\n    var playing = 0;\n    $scope.paths = {\n      possible: [],\n      possibleAsStr: [],\n      selected: ''\n    };\n    $scope.vs = viewState;\n    $scope.standardFuncServ = StandardFuncsService;\n    // Find non-ITEM levels to start calculating possible paths through the hierarchy of levels\n    angular.forEach(ConfigProviderService.curDbConfig.levelDefinitions, function (l) {\n      if (l.type !== 'ITEM') {\n        $scope.paths.possible = $scope.paths.possible.concat(HierarchyLayoutService.findPaths(l.name));\n      }\n    });\n    // convert array paths to strings\n    angular.forEach($scope.paths.possible, function (arr, arrIdx) {\n      var revArr = StandardFuncsService.reverseCopy(arr);\n      if (arrIdx === 0) {\n        // select first possible path on load\n        $scope.paths.selected = revArr.join(' \\u2192 ');\n      }\n      $scope.paths.possibleAsStr.push(revArr.join(' \\u2192 '));\n    });\n    //////////////\n    // watches\n    $scope.$watch('paths.selected', function (newValue) {\n      viewState.hierarchyState.path = $scope.paths.possible[$scope.getSelIdx()];\n    }, false);\n    //\n    //////////////\n    /**\n\t\t * Returns index of the currently selected path (within the $scope.paths.possible array)\n\t\t */\n    $scope.getSelIdx = function () {\n      var selIdx = $scope.paths.possibleAsStr.indexOf($scope.paths.selected);\n      return selIdx;\n    };\n    $scope.rotateHierarchy = function () {\n      viewState.toggleHierarchyRotation();\n    };\n    $scope.getRotation = function () {\n      return viewState.isHierarchyRotated();\n    };\n    $scope.playSelection = function () {\n      ++playing;\n    };\n    $scope.getPlaying = function () {\n      return playing;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.isCurrentAttrDef = function (levelName, attrDef) {\n      if (viewState.getCurAttrDef(levelName) === attrDef) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t * set current attribute definition\n\t\t * just delegates same fuction call to viewState\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @param attrDef name of attribute definition\n\t\t */\n    $scope.setCurrentAttrDef = function (levelName, attrDefName, attrDefIndex) {\n      viewState.setCurAttrDef(levelName, attrDefName, attrDefIndex);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getAllAttrDefs = function (levelName) {\n      var levDef = ConfigProviderService.getLevelDefinition(levelName);\n      return levDef.attributeDefinitions;\n    };\n    /**\n\t\t * cancel dialog i.e. close\n\t\t */\n    $scope.cancel = function () {\n      modalService.close();\n    };\n  }\n]);\n'use strict';\n/**\n * This service aims to provide functions for laying out the hierarchy of a\n * bundle (ie, calculating the positions of the nodes). The actual drawing is\n * done in a directive, the manipulation of the hierarchy is done in another\n * service.\n *\n * While the DBConfig allows for a complex network of levels, the visualisation\n * is always limited to one straight path of levels. This path has to be passed\n * in to the individual functions that expect a selectedPath parameter.\n *\n * A selection menu shall be offered comprising all possible paths through the\n * hierarchy. Therefore, this service offers the function findPaths() to return\n * all possible paths.\n */\nangular.module('emuwebApp').service('HierarchyLayoutService', [\n  'viewState',\n  'ConfigProviderService',\n  'LevelService',\n  'DataService',\n  function (viewState, ConfigProviderService, LevelService, DataService) {\n    // shared service object\n    var sServObj = {};\n    /////////////////////\n    // public API\n    /**\n\t\t * Recursively find all paths through the hierarchy of levels.\n\t\t * This is done bottom-up because there is no explicit root element in the levelDefinitions.\n\t\t *\n\t\t * @param startLevel The name of the level from which to start\n\t\t * @param path An array of levels' names that form a path to startLevel (optional; shouldn't be an empty array)\n\t\t */\n    sServObj.findPaths = function (startLevel, path) {\n      if (typeof path === 'undefined') {\n        var path = [startLevel];\n      } else {\n        path = path.concat([startLevel]);\n      }\n      // Find all parents of startLevel\n      var parents = this.findParentLevels(startLevel);\n      // If we have no more parents, we're at the end of the\n      // path and thus returning it\n      if (parents.length === 0) {\n        return [path];\n      }\n      // If, on the other hand, there are parents, we start\n      // recursion to find all paths\n      var paths = [];\n      for (var i = 0; i < parents.length; ++i) {\n        paths = paths.concat(sServObj.findPaths(parents[i], path));\n      }\n      return paths;\n    };\n    /**\n\t\t * Find all parent levels of a given level by iterating through the\n\t\t * current database's linkDefinitions.\n\t\t *\n\t\t * @param childLevel The name of the level whose parents to find\n\t\t * @returns An array of names of childLevel's parent levels\n\t\t */\n    sServObj.findParentLevels = function (childLevel) {\n      var parents = [];\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === childLevel) {\n          parents.push(ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName);\n        }\n      }\n      return parents;\n    };\n    /**\n\t\t * Calculate the weights (size within their level) of all\n\t\t * nodes bottom-up.\n\t\t *\n\t\t * This is most likely rather slow and -definitely needs- could\n\t\t * use some tweaking\n\t\t */\n    sServObj.calculateWeightsBottomUp = function (selectedPath) {\n      var i, ii, iii;\n      /////\n      // Make sure all items have proper _parents and\n      // _visibile attributes\n      sServObj.findParents(selectedPath);\n      sServObj.findVisibility(selectedPath);\n      /////\n      // Iterate through levels bottom-up\n      for (i = 0; i < selectedPath.length; ++i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]);\n        // This will be the total of the weights of all\n        // items on this level\n        level._weight = 0;\n        //////\n        // Iterate through items to calculate their\n        // _weight and the level's _weight\n        for (ii = 0; ii < level.items.length; ++ii) {\n          if (level.items[ii]._visible === false) {\n            level.items[ii]._weight = 0.35;\n          } else {\n            level.items[ii]._weight = 1;\n          }\n          // Calculate weight of the level\n          level._weight += level.items[ii]._weight;\n        }\n        /////\n        // Iterate through items again to calculate\n        // their _posInLevel and _depth.\n        // This is done in a new for loop because it\n        // depends on the correctness of level._weight\n        var posInLevel = 0;\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._posInLevel = (posInLevel + level.items[ii]._weight / 2) / level._weight;\n          posInLevel += level.items[ii]._weight;\n          level.items[ii]._depth = selectedPath.length - i - 1;\n          //////\n          // Additionally, calculate link positions\n          var links = DataService.getData().links;\n          for (var l = 0; l < links.length; ++l) {\n            if (links[l].toID === level.items[ii].id) {\n              links[l]._toPosInLevel = level.items[ii]._posInLevel;\n              links[l]._toDepth = level.items[ii]._depth;\n            }\n            if (links[l].fromID === level.items[ii].id) {\n              links[l]._fromPosInLevel = level.items[ii]._posInLevel;\n              links[l]._fromDepth = level.items[ii]._depth;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t * Find all children of a node d that are part of the currently selected\n\t\t * path through the hierarchy\n\t\t *\n\t\t * @return an array of children nodes\n\t\t * @return empty array if there are no children (previously would return null due to a d3 dependency that no longer exists)\n\t\t */\n    sServObj.findChildren = function (d, selectedPath) {\n      var children = [];\n      // Find the level that d is a part of\n      // Return empty array if that fails (which shouldn't happen at all)\n      var currentLevel = LevelService.getLevelName(d.id);\n      if (currentLevel === null) {\n        console.log('Likely a bug: failed to find a node\\'s level', d);\n        return [];\n      }\n      // Find the child level\n      var childLevel = null;\n      for (var i = 0; i < selectedPath.length - 1; ++i) {\n        if (selectedPath[i + 1] === currentLevel) {\n          childLevel = selectedPath[i];\n          break;\n        }\n      }\n      if (childLevel === null) {\n        return [];\n      }\n      // Iterate over links to find children\n      for (var li = 0; li < DataService.getData().links.length; ++li) {\n        if (DataService.getData().links[li].fromID === d.id) {\n          // Iterate over levels to find the object corresponding to d.id\n          for (var l = 0; l < DataService.getData().levels.length; ++l) {\n            if (DataService.getData().levels[l].name !== childLevel) {\n              continue;\n            }\n            for (var it = 0; it < DataService.getData().levels[l].items.length; ++it) {\n              if (DataService.getData().levels[l].items[it].id === DataService.getData().links[li].toID) {\n                children.push(DataService.getData().levels[l].items[it]);\n              }\n            }\n          }\n        }\n      }\n      return children;\n    };\n    /**\n\t\t * This function aims to find and store the parents of every\n\t\t * node (along the selected path).\n\t\t *\n\t\t * First clears the _parents attribute from all item and then\n\t\t * re-calculates them.\n\t\t *\n\t\t * All items on the currently selected path will then have a\n\t\t * _parents property that is either an empty array (if it has\n\t\t * no parents) or an array containing its parents.\n\t\t */\n    sServObj.findParents = function (selectedPath) {\n      var i, ii, c;\n      //////\n      // Clear _parents from all items\n      var level;\n      for (i = 0; i < selectedPath.length; ++i) {\n        level = LevelService.getLevelDetails(selectedPath[i]);\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._parents = [];\n        }\n      }\n      /////\n      // Iterate through levels\n      for (i = 0; i < selectedPath.length; ++i) {\n        level = LevelService.getLevelDetails(selectedPath[i]);\n        // Iterate through the current level's items\n        // And save them as _parents in their children\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var children = sServObj.findChildren(level.items[ii], selectedPath);\n          for (c = 0; c < children.length; ++c) {\n            children[c]._parents.push(level.items[ii]);\n          }\n        }\n      }\n    };\n    /**\n\t\t * Find out, which paths ought to be drawn because they are not\n\t\t * collapsed.\n\t\t *\n\t\t * Will add a boolean attribute _visible to all items on the\n\t\t * currently selected path.\n\t\t */\n    sServObj.findVisibility = function (selectedPath) {\n      // Root nodes are all nodes that have no parents and\n      // thus form a sub-graph.\n      //\n      // Note that some descendants of a given root node\n      // might also be the descendant of another root node.\n      // thus \"connecting\" the different sub-graphs. If this\n      // were a real connection, the different sub-graphs\n      // would actually be one graph. But it is not a real\n      // connection since the whole graph is directed and the\n      // connections can never be along the direction of an\n      // edge.\n      if (selectedPath !== undefined && selectedPath.length > 0) {\n        var rootLevelItems = [];\n        var level;\n        for (var i = 0; i < selectedPath.length; ++i) {\n          level = LevelService.getLevelDetails(selectedPath[i]);\n          for (var ii = 0; ii < level.items.length; ++ii) {\n            if (level.items[ii]._parents.length === 0) {\n              rootLevelItems.push(level.items[ii]);\n            }\n          }\n        }\n        // First, set all nodes invisible. Later we will search\n        // all paths and if we find one uncollasped path to a\n        // node, that node will be set visible.\n        var currentItem;\n        var items = [];\n        items = items.concat(rootLevelItems);\n        while (items.length > 0) {\n          currentItem = items.pop();\n          items = items.concat(sServObj.findChildren(currentItem, selectedPath));\n          currentItem._visible = false;\n        }\n        // Now all nodes on the selectedPath have been set\n        // invisible. Try and find those that must be visible,\n        // i.e. either they are a root node or there is an\n        // uncollapsed path to them from a root node.\n        items = [];\n        items = items.concat(rootLevelItems);\n        while (items.length > 0) {\n          currentItem = items.pop();\n          if (!viewState.getCollapsed(currentItem.id)) {\n            items = items.concat(sServObj.findChildren(currentItem, selectedPath));\n          }\n          currentItem._visible = true;\n        }\n      }\n    };\n    /**\n\t\t * Toggle the state of a single item with its subtree\n\t\t */\n    sServObj.toggleCollapse = function (d, selectedPath) {\n      // Find out whether we're collapsing or decollapsing\n      var isCollapsing = !viewState.getCollapsed(d.id);\n      viewState.setCollapsed(d.id, isCollapsing);\n      // Traverse sub-tree and change each item's number of collapsend parents\n      //\n      // Set each item's collapsePosition as well\n      // collapsePosition is the coordinate where they fade out to or fade in from\n      var currentDescendant;\n      var descendants = sServObj.findChildren(d, selectedPath);\n      while (descendants.length > 0) {\n        currentDescendant = descendants.pop();\n        descendants = descendants.concat(sServObj.findChildren(currentDescendant, selectedPath));\n        var num = viewState.getNumCollapsedParents(currentDescendant.id);\n        if (isCollapsing) {\n          viewState.setNumCollapsedParents(currentDescendant.id, num + 1);\n        } else {\n          viewState.setNumCollapsedParents(currentDescendant.id, num - 1);\n        }\n        viewState.setCollapsePosition(currentDescendant.id, [\n          d._x,\n          d._y\n        ]);\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ArrayHelperService', [\n  '$q',\n  function ArrayHelperService($q) {\n    // shared service object\n    var sServObj = {};\n    var defer;\n    // defer promise obj\n    /**\n\t\t * convert values of array to max values\n\t\t *\n\t\t * @param arr array to convert\n\t\t * @returns array containing Math.abs() values\n\t\t */\n    sServObj.convertToAbsValues = function (arr) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = Math.abs(arr[i]);\n      }\n      return arr;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.multiplyEachElement = function (arr, val) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = arr[i] * val;\n      }\n      return arr;\n    };\n    /**\n\t\t * find value between two points\n\t\t * by linearly interpolating them\n\t\t */\n    sServObj.interp2points = function (x0, y0, x1, y1, x) {\n      return y0 + (y1 - y0) * ((x - x0) / (x1 - x0));\n    };\n    /**\n\t\t * find min or maximum value in array\n\t\t *\n\t\t * @param arr array to search in\n\t\t * @param minOrMax string value either 'min' or 'max'\n\t\t * @returns object with attributes val and idx\n\t\t */\n    sServObj.findMinMax = function (arr, minOrMax) {\n      var val, idx;\n      if (minOrMax === 'min') {\n        val = Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] < val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      } else if (minOrMax === 'max') {\n        val = -Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] > val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      }\n      return {\n        'val': val,\n        'idx': idx\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.flattenArrayOfArray = function (arrOfArrs) {\n      var merged = [];\n      merged = merged.concat.apply(merged, arrOfArrs);\n      return merged;\n    };\n    /**\n\t\t * convert array to an array that contains\n\t\t * objects of the form {x: i, y:y[i]}\n\t\t */\n    sServObj.convertArrayToXYjsoArray = function (y) {\n      var xyArray = [];\n      for (var i = 0; i < y.length; i++) {\n        xyArray.push({\n          x: i,\n          y: y[i]\n        });\n      }\n      return xyArray;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('AnagestService', [\n  '$q',\n  '$log',\n  'viewState',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  'modalService',\n  'HistoryService',\n  'DataService',\n  function AnagestService($q, $log, viewState, LevelService, LinkService, ConfigProviderService, Ssffdataservice, ArrayHelperService, modalService, HistoryService, DataService) {\n    // shared service object\n    var sServObj = {};\n    // defer object \n    var defer;\n    /**\n\t\t *\n\t\t */\n    sServObj.insertAnagestEvents = function () {\n      var defer = $q.defer();\n      // precheck if there are items in selection\n      var itemInSel = viewState.getItemsInSelection(DataService.data.levels);\n      if (itemInSel.length !== 0) {\n        modalService.open('views/error.html', 'There are already events in the selected area! This is not permitted...').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // vertical position signal\n      var trackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.verticalPosSsffTrackName;\n      var tr = ConfigProviderService.getSsffTrackConfig(trackName);\n      var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n      var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n      // velocity signal\n      var vTrackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.velocitySsffTrackName;\n      var vTr = ConfigProviderService.getSsffTrackConfig(vTrackName);\n      var vCol = Ssffdataservice.getColumnOfTrack(vTr.name, vTr.columnName);\n      var vSRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(vTr.name);\n      if (col.length !== 1 || vCol.length !== 1) {\n        modalService.open('views/error.html', 'UPS... the column length of of one of the tracks is != 1 this means something is badly configured in the DB!!!').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // flatten columns\n      var flatColVals = ArrayHelperService.flattenArrayOfArray(col.values);\n      var flatVcolVals = ArrayHelperService.flattenArrayOfArray(vCol.values);\n      /////////////////////////////////////////\n      var gdat = [\n          NaN,\n          NaN\n        ];\n      var vdat = [\n          NaN,\n          NaN\n        ];\n      var ndat = [\n          NaN,\n          NaN\n        ];\n      var cdat = [\n          NaN,\n          NaN\n        ];\n      // easiest way to handle non-tangential signals (and has no effect on tangential signals)\n      flatVcolVals = ArrayHelperService.convertToAbsValues(flatVcolVals);\n      // selected column samples\n      var startTimeSel = viewState.getSelectedStartTime();\n      var endTimeSel = viewState.getSelectedEndTime();\n      var colStartSampleNr = Math.round(startTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var colEndSampleNr = Math.round(endTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n      var selCol = flatColVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      var selVCol = flatVcolVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      // maxConstr\n      var maxVerticalPos = ArrayHelperService.findMinMax(selCol, 'max');\n      cdat[0] = maxVerticalPos.idx;\n      // max vel before max constriction\n      var maxVelBeforeMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(0, cdat[0] + 1), 'max');\n      vdat[0] = maxVelBeforeMaxConstr.idx;\n      // min vel before max vel\n      var minVelBeforeMaxVel = ArrayHelperService.findMinMax(selVCol.slice(0, vdat[0] + 1), 'min');\n      // gesture onset\n      $log.info('Looking for gesture onset');\n      sServObj.interactiveFindThresholds(selVCol.slice(0, vdat[0] + 1), minVelBeforeMaxVel.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for gesture onset').then(function (resp) {\n        // keyboard;\n        var on20 = resp;\n        gdat[0] = on20;\n        // min vel between max vel 1 and max constriction\n        var minVelBetwMaxVel1maxConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[0], cdat[0] + 1), 'min');\n        var minp = minVelBetwMaxVel1maxConstr.idx + vdat[0];\n        // nucleus onset\n        $log.info('Looking for nucleus onset');\n        sServObj.interactiveFindThresholds(selVCol.slice(vdat[0], minp + 1), minVelBetwMaxVel1maxConstr.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for nucleus onset').then(function (resp) {\n          var off20 = resp;\n          ndat[0] = off20 + vdat[0];\n          // max vel after max constriction\n          var maxVelAfterMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0]), 'max');\n          // max vel before max constriction\n          vdat[1] = maxVelAfterMaxConstr.idx + cdat[0];\n          // minimum between max constriction and max vel after constriction\n          var minBetwMaxConstrMaxVelConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0], vdat[1] + 1), 'min');\n          minp = minBetwMaxConstrMaxVelConstr.idx + cdat[0];\n          // nucleus offset\n          $log.info('Looking for nucleus offset');\n          sServObj.interactiveFindThresholds(selVCol.slice(minp, vdat[1] + 1), minBetwMaxConstrMaxVelConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for nucleus offset').then(function (resp) {\n            var on20 = resp;\n            ndat[1] = on20 + minp;\n            // minimum velocity after max vel after constriction\n            var minVelAfterMaxVelAfterConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[1]), 'min');\n            minp = minVelAfterMaxVelAfterConstr.idx + vdat[1];\n            // gesture offset\n            $log.info('Looking for gesture offset');\n            sServObj.interactiveFindThresholds(selVCol.slice(vdat[1], minp + 1), minVelAfterMaxVelAfterConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for gesture offset').then(function (resp) {\n              var off20 = resp;\n              gdat[1] = off20 + vdat[1];\n              // insert points\n              // var insPoint;\n              var curLabel;\n              // console.log(gdat)\n              gdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              gdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[0];\n              var gdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[0],\n                'id': gdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[1];\n              var gdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[1],\n                'id': gdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(vdat);\n              vdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              vdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[0];\n              var vdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[0],\n                'id': vdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[1];\n              var vdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[1],\n                'id': vdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(ndat);\n              ndat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[0], sRaSt.sampleRate, sRaSt.startTime);\n              ndat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[0];\n              var ndat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[0],\n                'id': ndat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[1];\n              var ndat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[1],\n                'id': ndat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(cdat);\n              cdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + cdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxConstrictionLabel;\n              var cdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), cdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': cdat[0],\n                'id': cdat0insPoint.id,\n                'pointName': curLabel\n              });\n              var linkLevelName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.autoLinkLevelName;\n              var linkLevelDetails = LevelService.getLevelDetails(linkLevelName);\n              var linkLevelLabels = LevelService.getAllLabelsOfLevel(linkLevelDetails);\n              modalService.open('views/SelectLabelModal.html', linkLevelLabels, undefined, true).then(function (itemIdx) {\n                if (itemIdx !== false) {\n                  var childIDs = [\n                      gdat0insPoint.id,\n                      gdat1insPoint.id,\n                      vdat0insPoint.id,\n                      vdat1insPoint.id,\n                      ndat0insPoint.id,\n                      ndat1insPoint.id,\n                      cdat0insPoint.id\n                    ];\n                  LinkService.insertLinksTo(linkLevelDetails.level.items[itemIdx].id, childIDs);\n                  HistoryService.updateCurChangeObj({\n                    'type': 'ANNOT',\n                    'action': 'INSERTLINKSTO',\n                    'name': linkLevelDetails.level.name,\n                    'parentID': linkLevelDetails.level.items[itemIdx].id,\n                    'childIDs': childIDs\n                  });\n                  HistoryService.addCurChangeObjToUndoStack();\n                }\n              });\n              defer.resolve();\n            });\n          });\n        });\n      }, function () {\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * find threshold in array (an adapted reimplementation of findth.m by\n\t\t * Phil Hoole Version 17.6.2006)\n\t\t *\n\t\t * @param x\n\t\t * @param minVal\n\t\t * @param maxVal\n\t\t * @param threshold\n\t\t * @param direction\n\t\t * @param descriptions describes the task\n\t\t * @returns promise that resolves to threshold value\n\t\t */\n    sServObj.interactiveFindThresholds = function (x, minVal, maxVal, threshold, direction, description) {\n      // console.log('interactiveFindThresholds');\n      var thdat = minVal + (maxVal - minVal) * threshold;\n      var thdir = direction;\n      thdat = thdat * thdir;\n      var xx = ArrayHelperService.multiplyEachElement(x, thdir);\n      // handle positive/neg.\n      var lx = xx.length;\n      var xsh = xx.slice(1, lx);\n      var loguk = 0;\n      var higuk = lx - 1;\n      // vz=find((xsh>=thdat)&(xx(1:(lx-1))<thdat));\n      var vz = [];\n      for (var i = 0; i < xx.length; i++) {\n        if (xsh[i] >= thdat && xx[i] < thdat) {\n          vz.push(i);\n        }\n      }\n      // anavv=find(vz>=loguk & vz<=higuk);\n      var anavv = [];\n      for (var i = 0; i < vz.length; i++) {\n        if (vz[i] >= loguk && vz[i] <= higuk) {\n          anavv.push(i);\n        }\n      }\n      if (anavv.length > 1) {\n        defer = $q.defer();\n        var infos = {};\n        infos.description = description;\n        infos.options = [];\n        infos.y = xx;\n        infos.minVal = minVal;\n        infos.maxVal = maxVal;\n        infos.threshold = threshold;\n        for (var i = 0; i < vz.length; i++) {\n          infos.options.push({\n            'thresholdIdx': vz[i],\n            'thresholdValue': xx[i]\n          });\n        }\n        modalService.open('views/SelectThresholdModal.html', infos, undefined, true).then(function (resp) {\n          console.log(resp);\n          var ap = vz[anavv[resp]];\n          ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n          defer.resolve(ap);\n        });\n        return defer.promise;\n      } else if (anavv.length === 0) {\n        defer = $q.defer();\n        modalService.open('views/error.html', 'Could not find any values that step over the threshold!!').then(function () {\n          defer.reject('Could not find any values that step over the threshold!!');\n        });\n        return defer.promise;\n      } else {\n        defer = $q.defer();\n        var ap = vz[anavv[0]];\n        ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n        defer.resolve(ap);\n        return defer.promise;\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DragnDropDataService', [\n  '$q',\n  'ConfigProviderService',\n  'modalService',\n  function DragnDropDataService($q, ConfigProviderService, modalService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.convertedBundles = [];\n    sServObj.sessionDefault = '';\n    ///////////////////////////////\n    // public api\n    sServObj.getBundle = function (name, session) {\n      var defer = $q.defer();\n      var ret = {};\n      angular.forEach(sServObj.convertedBundles, function (bundle, i) {\n        if (bundle.name === name) {\n          var bc = angular.copy(bundle);\n          delete bc.name;\n          defer.resolve({\n            status: 200,\n            data: bc\n          });\n        }\n      });\n      return defer.promise;\n    };\n    sServObj.resetToInitState = function () {\n      sServObj.convertedBundles = [];\n      sServObj.sessionDefault = '';\n    };\n    sServObj.setDefaultSession = function (name) {\n      sServObj.sessionDefault = name;\n    };\n    sServObj.getDefaultSession = function () {\n      return sServObj.sessionDefault;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DragnDropService', [\n  '$q',\n  '$rootScope',\n  'modalService',\n  'DataService',\n  'Validationservice',\n  'ConfigProviderService',\n  'DragnDropDataService',\n  'Iohandlerservice',\n  'viewState',\n  'Soundhandlerservice',\n  'Binarydatamaniphelper',\n  'browserDetector',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'loadedMetaDataService',\n  function DragnDropService($q, $rootScope, modalService, DataService, Validationservice, ConfigProviderService, DragnDropDataService, Iohandlerservice, viewState, Soundhandlerservice, Binarydatamaniphelper, browserDetector, Wavparserservice, Textgridparserservice, loadedMetaDataService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.drandropBundles = [];\n    sServObj.bundleList = [];\n    sServObj.sessionName = 'File(s)';\n    sServObj.maxDroppedBundles = 10;\n    ///////////////////////////////\n    // public api\n    ///////////////////\n    // drag n drop data\n    sServObj.setData = function (bundles) {\n      var count = 0;\n      angular.forEach(bundles, function (bundle, i) {\n        sServObj.setDragnDropData(bundle[0], i, 'wav', bundle[1]);\n        if (bundle[2] !== undefined) {\n          sServObj.setDragnDropData(bundle[0], i, 'annotation', bundle[2]);\n        }\n        count = i;\n      });\n      if (count <= sServObj.maxDroppedBundles) {\n        sServObj.convertDragnDropData(sServObj.drandropBundles, 0).then(function () {\n          loadedMetaDataService.setBundleList(sServObj.bundleList);\n          loadedMetaDataService.setCurBndlName(sServObj.bundleList[DragnDropDataService.sessionDefault]);\n          loadedMetaDataService.setDemoDbName(sServObj.bundleList[DragnDropDataService.sessionDefault]);\n          sServObj.handleLocalFiles();\n          return true;\n        });\n      } else {\n        return false;\n      }\n    };\n    sServObj.resetToInitState = function () {\n      delete sServObj.drandropBundles;\n      sServObj.drandropBundles = [];\n      delete sServObj.bundleList;\n      sServObj.bundleList = [];\n      sServObj.sessionName = 'File(s)';\n      sServObj.maxDroppedBundles = 10;\n      DragnDropDataService.resetToInitState();\n      loadedMetaDataService.resetToInitState();\n      console.log('reset');\n    };\n    /**\n\t\t * setter sServObj.drandropBundles\n\t\t */\n    sServObj.setDragnDropData = function (bundle, i, type, data) {\n      DragnDropDataService.setDefaultSession(i);\n      if (sServObj.drandropBundles[i] === undefined) {\n        sServObj.drandropBundles[i] = {};\n        DragnDropDataService.convertedBundles[i] = {};\n        DragnDropDataService.convertedBundles[i].name = bundle;\n        sServObj.bundleList.push({\n          name: bundle,\n          session: sServObj.sessionName\n        });\n      }\n      if (type === 'wav') {\n        sServObj.drandropBundles[i].wav = data;\n      } else if (type === 'annotation') {\n        sServObj.drandropBundles[i].annotation = data;\n      }\n    };\n    /**\n\t\t * getter sServObj.drandropBundles\n\t\t */\n    sServObj.getDragnDropData = function (bundle, type) {\n      if (type === 'wav') {\n        return sServObj.drandropBundles[bundle].wav;\n      } else if (type === 'annotation') {\n        return sServObj.drandropBundles[bundle].annotation;\n      } else {\n        return false;\n      }\n    };\n    sServObj.generateDrop = function (data) {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL(sServObj.getBlob(data));\n      } else {\n        objURL = URL.createObjectURL(sServObj.getBlob(data));\n      }\n      return objURL;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBlob = function (data) {\n      var blob;\n      try {\n        blob = new Blob([data], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append(data);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    sServObj.convertDragnDropData = function (bundles, i) {\n      var defer = $q.defer();\n      var data = sServObj.drandropBundles[i];\n      var reader = new FileReader();\n      var reader2 = new FileReader();\n      var res;\n      if (bundles.length > i) {\n        if (data.wav !== undefined) {\n          reader.readAsArrayBuffer(data.wav);\n          reader.onloadend = function (evt) {\n            if (evt.target.readyState == FileReader.DONE) {\n              if (browserDetector.isBrowser.Firefox()) {\n                res = evt.target.result;\n              } else {\n                res = evt.currentTarget.result;\n              }\n              Wavparserservice.parseWavArrBuf(res).then(function (wavJSO) {\n                if (DragnDropDataService.convertedBundles[i] === undefined) {\n                  DragnDropDataService.convertedBundles[i] = {};\n                }\n                DragnDropDataService.convertedBundles[i].mediaFile = {};\n                Soundhandlerservice.wavJSO = wavJSO;\n                DragnDropDataService.convertedBundles[i].mediaFile.data = Binarydatamaniphelper.arrayBufferToBase64(wavJSO.origArrBuf);\n                DragnDropDataService.convertedBundles[i].mediaFile.encoding = 'BASE64';\n                DragnDropDataService.convertedBundles[i].ssffFiles = [];\n                var bundle = data.wav.name.substr(0, data.wav.name.lastIndexOf('.'));\n                if (data.annotation === undefined) {\n                  DragnDropDataService.convertedBundles[i].annotation = {\n                    levels: [],\n                    links: [],\n                    sampleRate: wavJSO.SampleRate,\n                    annotates: bundle,\n                    name: bundle\n                  };\n                  sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                    delete sServObj.drandropBundles;\n                    sServObj.drandropBundles = [];\n                    defer.resolve();\n                  });\n                } else {\n                  if (data.annotation.type === 'textgrid') {\n                    reader2.readAsText(data.annotation.file);\n                    reader2.onloadend = function (evt) {\n                      if (evt.target.readyState == FileReader.DONE) {\n                        Textgridparserservice.asyncParseTextGrid(evt.currentTarget.result, data.wav.name, bundle).then(function (parseMess) {\n                          DragnDropDataService.convertedBundles[i].annotation = parseMess;\n                          sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                            defer.resolve();\n                          });\n                        });\n                      }\n                    };\n                  } else if (data.annotation.type === 'annotation') {\n                    ConfigProviderService.vals.activeButtons.showHierarchy = true;\n                    reader2.readAsText(data.annotation.file);\n                    reader2.onloadend = function (evt) {\n                      if (evt.target.readyState == FileReader.DONE) {\n                        DragnDropDataService.convertedBundles[i].annotation = angular.fromJson(evt.currentTarget.result);\n                        sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                          defer.resolve();\n                        });\n                      }\n                    };\n                  }\n                }\n              });\n            }\n          };\n        }\n      } else {\n        defer.resolve();\n        return defer.promise;\n      }\n      return defer.promise;\n    };\n    /**\n\t\t * handling local file drops after loading them\n\t\t */\n    sServObj.handleLocalFiles = function () {\n      var validRes;\n      var wav = DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].mediaFile.data;\n      var ab = Binarydatamaniphelper.base64ToArrayBuffer(wav);\n      var annotation;\n      if (DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].annotation !== undefined) {\n        annotation = DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].annotation;\n      } else {\n        annotation = {\n          levels: [],\n          links: []\n        };\n      }\n      viewState.showDropZone = false;\n      viewState.setState('loadingSaving');\n      // reset history\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading local File: ' + wav.name;\n      Iohandlerservice.httpGetPath('configFiles/standalone_emuwebappConfig.json').then(function (resp) {\n        // first element of perspectives is default perspective\n        viewState.curPerspectiveIdx = 0;\n        ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n        delete resp.data.EMUwebAppConfig;\n        // delete to avoid duplicate\n        validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n        if (validRes === true) {\n          ConfigProviderService.curDbConfig = resp.data;\n          viewState.somethingInProgressTxt = 'Parsing WAV file...';\n          Wavparserservice.parseWavArrBuf(ab).then(function (messWavParser) {\n            var wavJSO = messWavParser;\n            viewState.curViewPort.sS = 0;\n            viewState.curViewPort.eS = wavJSO.Data.length;\n            viewState.curViewPort.selectS = -1;\n            viewState.curViewPort.selectE = -1;\n            viewState.curClickSegments = [];\n            viewState.curClickLevelName = undefined;\n            viewState.curClickLevelType = undefined;\n            loadedMetaDataService.setCurBndl(DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault]);\n            viewState.resetSelect();\n            viewState.curPerspectiveIdx = 0;\n            DataService.setLevelData(annotation.levels);\n            var lNames = [];\n            var levelDefs = [];\n            annotation.levels.forEach(function (l) {\n              if (l.type === 'SEGMENT' || l.type === 'EVENT') {\n                lNames.push(l.name);\n                levelDefs.push({\n                  'name': l.name,\n                  'type': l.type,\n                  'attributeDefinitions': {\n                    'name': l.name,\n                    'type': 'string'\n                  }\n                });\n              }\n            });\n            // set level defs\n            ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            ConfigProviderService.setPerspectivesOrder(viewState.curPerspectiveIdx, lNames);\n            //ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n            Soundhandlerservice.wavJSO = wavJSO;\n            // set all ssff files\n            viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n            var validRes = Validationservice.validateJSO('annotationFileSchema', annotation);\n            if (validRes === true) {\n              DataService.setLinkData(annotation.links);\n              viewState.setState('labeling');\n              viewState.somethingInProgress = false;\n              viewState.somethingInProgressTxt = 'Done!';\n            } else {\n              modalService.open('views/error.html', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                //appStateService.resetToInitState();\n                sServObj.resetToInitState();\n              });\n            }\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Error parsing wav file: ' + errMess).then(function () {\n              //appStateService.resetToInitState();\n              sServObj.resetToInitState();\n            });\n          });\n        }\n      });\n      viewState.somethingInProgress = false;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc directive\n * @name emuWebApp.directive:lineChart\n * @description\n * # lineChart\n */\nangular.module('emuwebApp').directive('lineChart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      threshold: '='\n    },\n    link: function postLink(scope, element, attrs) {\n      //////////////////////\n      // watches \n      scope.$watch('data', function () {\n        scope.render(scope.data);\n      }, true);\n      //////////////////////\n      //Set margins, width, and height\n      var margin = {\n          top: 20,\n          right: 20,\n          bottom: 20,\n          left: 40\n        }, width = 400 - margin.left - margin.right, height = 200 - margin.top - margin.bottom;\n      //Create the d3 element and position it based on margins\n      var svg = d3.select(element[0]).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      //Create the scales we need for the graph\n      var x = d3.scale.linear().range([\n          0,\n          width\n        ]);\n      var y = d3.scale.linear().range([\n          height,\n          0\n        ]);\n      //Create the axes we need for the graph\n      var xAxis = d3.svg.axis().scale(x).tickSize(5).tickSubdivide(true);\n      var yAxis = d3.svg.axis().scale(y).orient('left');\n      // line drawing function\n      var lineFunc = d3.svg.line().x(function (d) {\n          return x(d.x);\n        }).y(function (d) {\n          return y(d.y);\n        }).interpolate('linear');\n      /**\n\t\t\t\t *\n\t\t\t\t */\n      scope.render = function (data) {\n        //Set our scale's domains\n        // x.domain(data.map(function (d) {\n        // \treturn d.name;\n        // }));\n        // y.domain([0, d3.max(data, function (d) {\n        // \treturn d.count;\n        // })]);\n        x.domain([\n          d3.min(data, function (d) {\n            return d.x;\n          }),\n          d3.max(data, function (d) {\n            return d.x;\n          })\n        ]);\n        y.domain([\n          d3.min(data, function (d) {\n            return d.y;\n          }),\n          d3.max(data, function (d) {\n            return d.y;\n          })\n        ]);\n        //Remove the axes so we can draw updated ones\n        svg.selectAll('g.axis').remove();\n        //Render X axis\n        svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);\n        //Render Y axis\n        svg.append('g').attr('class', 'y axis').call(yAxis);\n        // Render path\n        var lines = svg.append('svg:path').attr('d', lineFunc(data)).attr('stroke', 'red').attr('stroke-width', 1).attr('fill', 'none');\n        // draw threshold SIC SIC SIC... not working yet!\n        svg.append('svg:line').attr('x1', 5).attr('y1', 5).attr('x2', 200).attr('y2', 200).attr('class', 'label-line');\n        var verticalLine = svg.append('line').attr({\n            'x1': x(scope.threshold),\n            'y1': 0,\n            'x2': x(scope.threshold),\n            'y2': height\n          }).attr('stroke', 'steelblue').attr('class', 'verticalLine');  //Create or update the bar data\n                                                                         // var bars = svg.selectAll('.bar').data(data);\n                                                                         // bars.enter()\n                                                                         // \t.append('rect')\n                                                                         // \t.attr('class', 'bar')\n                                                                         // \t.attr('x', function (d) {\n                                                                         // \t\treturn x(d.name);\n                                                                         // \t})\n                                                                         // \t.attr('width', x.rangeBand());\n                                                                         //Animate bars\n                                                                         // bars\n                                                                         // \t.transition()\n                                                                         // \t.duration(1000)\n                                                                         // \t.attr('height', function (d) {\n                                                                         // \t\treturn height - y(d.count);\n                                                                         // \t})\n                                                                         // \t.attr('y', function (d) {\n                                                                         // \t\treturn y(d.count);\n                                                                         // \t})\n      };\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('tutorial', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/tutorial.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.counter = 0;\n        scope.css = [];\n        scope.vs = viewState;\n        scope.cps = ConfigProviderService;\n        scope.cssDone = { color: '#222' };\n        scope.cssNotDone = { color: '#ddd' };\n        scope.cssActive = {\n          color: 'red',\n          'font-size': '18px'\n        };\n        scope.que = [];\n        scope.$watch('vs.lastKeyCode', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            if (newValue === scope.que[scope.counter]) {\n              ++scope.counter;\n            }\n          }\n          console.log(newValue);\n        });\n        scope.getClass = function (i) {\n          if (i == scope.counter) {\n            return scope.cssActive;\n          } else if (i < scope.counter) {\n            return scope.cssDone;\n          } else {\n            return scope.cssNotDone;\n          }\n        };\n        scope.getStrRep = function (id, code) {\n          scope.que[id] = code;\n          return ConfigProviderService.getStrRep(code);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('hint', function () {\n  return {\n    templateUrl: 'views/hint.html',\n    replace: true,\n    restrict: 'E',\n    link: function postLink(scope, element, attrs) {\n      scope.hideMe = function () {\n        scope.internalVars.showAboutHint = !scope.internalVars.showAboutHint;\n        scope.aboutBtnClick();\n      };\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('perspectives', function () {\n  return {\n    templateUrl: 'views/perspectives.html',\n    replace: true,\n    restrict: 'E',\n    link: function postLink(scope, element, attrs) {\n    }\n  };\n});\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.loadedMetaDataService\n * @description\n * # loadedMetaDataService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('loadedMetaDataService', [\n  'Validationservice',\n  function loadedMetaDataService(Validationservice) {\n    // shared service object\n    var sServObj = {};\n    //////////////////////\n    // private vars\n    var uniqSessionList = [];\n    var bundleList = [];\n    var curBndl = {};\n    var demoDbName = '';\n    var drandropBundles = [];\n    var rendOptBndlList = {};\n    // render optimized bundle list\n    //////////////////////\n    // private functions\n    function genUniqSessionList(bndlList) {\n      var sList = [];\n      var fistSes;\n      bndlList.forEach(function (bndl, idx) {\n        sList[bndl.session] = { 'collapsed': true };\n        if (idx === 0) {\n          fistSes = bndl.session;\n        }\n      });\n      // open fist session up \n      sList[fistSes].collapsed = false;\n      return sList;\n    }\n    function genRendOptBndlList(bndlList) {\n      bndlList.forEach(function (bndl, idx) {\n        if (rendOptBndlList[bndl.session] === undefined) {\n          rendOptBndlList[bndl.session] = [];\n        }\n        rendOptBndlList[bndl.session].push(bndl);\n      });\n      return rendOptBndlList;\n    }\n    //////////////////////\n    //////////////////////\n    // public API\n    ///////////////\n    // bundleList\n    /**\n\t\t * setter for bundleList\n\t\t * @returns validation result for bundle list\n\t\t */\n    sServObj.setBundleList = function (bList) {\n      // validate\n      var validRes = Validationservice.validateJSO('bundleListSchema', bList);\n      if (validRes === true) {\n        // set\n        bundleList = bList;\n        // generate uniqSessionList\n        uniqSessionList = genUniqSessionList(bundleList);\n        // generate render optimized bundlList\n        rendOptBndlList = genRendOptBndlList(bundleList);\n      }\n      return validRes;\n    };\n    /**\n\t\t * getter for bundleList\n\t\t */\n    sServObj.getBundleList = function () {\n      return bundleList;\n    };\n    /**\n\t\t * getter for rendOptBndlList\n\t\t */\n    sServObj.getRendOptBndlList = function () {\n      return rendOptBndlList;\n    };\n    ///////////\n    // curBndl \n    /**\n\t\t * getter curBndl\n\t\t */\n    sServObj.getCurBndl = function () {\n      return curBndl;\n    };\n    /**\n\t\t * setter curBndl\n\t\t */\n    sServObj.setCurBndl = function (bndl) {\n      curBndl = bndl;\n    };\n    /**\n\t\t * getter curBndl name\n\t\t */\n    sServObj.getCurBndlName = function () {\n      return curBndl.name;\n    };\n    /**\n\t\t * setter curBndl name\n\t\t */\n    sServObj.setCurBndlName = function (name) {\n      curBndl.name = name;\n    };\n    //////////////\n    // demoDbName\n    /**\n\t\t * setter demoDbName\n\t\t */\n    sServObj.setDemoDbName = function (name) {\n      demoDbName = name;\n    };\n    /**\n\t\t * getter demoDbName\n\t\t */\n    sServObj.getDemoDbName = function () {\n      return demoDbName;\n    };\n    ///////////////////\n    // uniqSessionList\n    /**\n\t\t *\n\t\t */\n    sServObj.toggleCollapseSession = function (session) {\n      uniqSessionList[session].collapsed = !uniqSessionList[session].collapsed;\n      // close all other sessions\n      Object.keys(uniqSessionList).forEach(function (key) {\n        if (key !== session) {\n          uniqSessionList[key].collapsed = true;\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    // sServObj.updateCollapseSessionState = function (text) {\n    // \tangular.forEach(sServObj.getBundleList(), function (bundle) {\n    // \t\tif (bundle.name.indexOf(text)) {\n    // \t\t\tuniqSessionList[bundle.session].collapsed = false;\n    // \t\t} else {\n    // \t\t\tuniqSessionList[bundle.session].collapsed = true;\n    // \t\t}\n    // \t});\n    // };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSessionCollapseState = function (session) {\n      return uniqSessionList[session].collapsed;\n    };\n    ///////////////////\n    // other functions\n    /**\n\t\t * reset all private vals to init state\n\t\t */\n    sServObj.resetToInitState = function () {\n      uniqSessionList = [];\n      bundleList = [];\n      curBndl = {};\n      rendOptBndlList = {};\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc function\n * @name emuwebApp.controller:BundlelistsidebarctrlCtrl\n * @description\n * # bundleListSideBarCtrl\n * Controller of the bundleListSideBar\n */\nangular.module('emuwebApp').controller('bundleListSideBarCtrl', [\n  '$scope',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'ConfigProviderService',\n  function ($scope, viewState, HistoryService, loadedMetaDataService, dbObjLoadSaveService, ConfigProviderService) {\n    $scope.vs = viewState;\n    $scope.lmds = loadedMetaDataService;\n    $scope.dolss = dbObjLoadSaveService;\n    $scope.cps = ConfigProviderService;\n    $scope.filterText = '';\n    $scope.pageSize = 500;\n    $scope.currentPage = 0;\n    $scope.numberOfPages = function (sessionLength) {\n      return Math.ceil(sessionLength / $scope.pageSize);\n    };\n    /**\n\t\t * returns false if bndl is current bndl\n\t\t */\n    $scope.uttIsDisabled = function (bndl) {\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return false;\n      } else {\n        return true;\n      }\n    };\n    /**\n\t\t * returns jso with css defining color dependent\n\t\t * on if changes have been made that have not been saved\n\t\t * @param bndl object containing name attribute of bundle item\n\t\t * requesting color\n\t\t * @returns color as jso object used by ng-style\n\t\t */\n    $scope.getBndlColor = function (bndl) {\n      var curColor;\n      if (HistoryService.movesAwayFromLastSave !== 0) {\n        curColor = {\n          'background-color': '#f00',\n          'color': 'white'\n        };\n      } else {\n        curColor = {\n          'background-color': '#999',\n          'color': 'black'\n        };\n      }\n      // console.log(bndl.name)\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return curColor;\n      }\n    };\n    /**\n\t\t * checks if name is undefined\n\t\t * @return bool\n\t\t */\n    $scope.isSessionDefined = function (ses) {\n      if (ses === 'undefined') {\n        return false;\n      } else {\n        return true;\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.dbObjLoadSaveService\n * @description\n * # dbObjLoadSaveService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('dbObjLoadSaveService', [\n  '$log',\n  '$q',\n  'DataService',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'Ssffdataservice',\n  'Iohandlerservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Validationservice',\n  'LevelService',\n  'modalService',\n  'ConfigProviderService',\n  'appStateService',\n  'StandardFuncsService',\n  function dbObjLoadSaveService($log, $q, DataService, viewState, HistoryService, loadedMetaDataService, Ssffdataservice, Iohandlerservice, Binarydatamaniphelper, Wavparserservice, Soundhandlerservice, Ssffparserservice, Validationservice, LevelService, modalService, ConfigProviderService, appStateService, StandardFuncsService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * general loadBundle method.\n\t\t * @param bndl object containing name attribute of currently loaded bundle\n\t\t */\n    sServObj.loadBundle = function (bndl) {\n      // check if bndl has to be saved\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        var curBndl = loadedMetaDataService.getCurBndl();\n        if (bndl !== curBndl) {\n          // $scope.lastclickedutt = bndl;\n          modalService.open('views/saveChanges.html', curBndl.session + ':' + curBndl.name).then(function (messModal) {\n            if (messModal === 'saveChanges') {\n              // save current bundle\n              sServObj.saveBundle().then(function () {\n                // load new bundle\n                sServObj.loadBundle(bndl);\n              });\n            } else if (messModal === 'discardChanges') {\n              // reset history\n              HistoryService.resetToInitState();\n              // load new bundle\n              sServObj.loadBundle(bndl);\n            }\n          });\n        }\n      } else {\n        if (bndl !== loadedMetaDataService.getCurBndl()) {\n          // reset history\n          HistoryService.resetToInitState();\n          // reset hierarchy\n          viewState.resetHierarchyState();\n          // set state\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          viewState.setState('loadingSaving');\n          viewState.somethingInProgress = true;\n          viewState.somethingInProgressTxt = 'Loading bundle: ' + bndl.name;\n          // empty ssff files\n          Ssffdataservice.data = [];\n          Iohandlerservice.getBundle(bndl.name, bndl.session, loadedMetaDataService.getDemoDbName()).then(function (bundleData) {\n            // check if response from http request\n            if (bundleData.status === 200) {\n              bundleData = bundleData.data;\n            }\n            // validate bundle\n            var validRes = Validationservice.validateJSO('bundleSchema', bundleData);\n            if (validRes === true) {\n              var arrBuff;\n              // set wav file\n              arrBuff = Binarydatamaniphelper.base64ToArrayBuffer(bundleData.mediaFile.data);\n              viewState.somethingInProgressTxt = 'Parsing WAV file...';\n              Wavparserservice.parseWavArrBuf(arrBuff).then(function (messWavParser) {\n                var wavJSO = messWavParser;\n                viewState.curViewPort.sS = 0;\n                viewState.curViewPort.eS = wavJSO.Data.length;\n                viewState.curViewPort.selectS = -1;\n                viewState.curViewPort.selectE = -1;\n                viewState.curClickSegments = [];\n                viewState.curClickLevelName = undefined;\n                viewState.curClickLevelType = undefined;\n                viewState.resetSelect();\n                Soundhandlerservice.wavJSO = wavJSO;\n                // set all ssff files\n                viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n                Ssffparserservice.asyncParseSsffArr(bundleData.ssffFiles).then(function (ssffJso) {\n                  Ssffdataservice.data = ssffJso.data;\n                  // set annotation\n                  DataService.setData(bundleData.annotation);\n                  loadedMetaDataService.setCurBndl(bndl);\n                  viewState.setState('labeling');\n                  viewState.somethingInProgress = false;\n                  viewState.somethingInProgressTxt = 'Done!';  // FOR DEVELOPMENT:\n                                                               // sServObj.saveBundle(); // for testing save function\n                                                               // $scope.menuBundleSaveBtnClick(); // for testing save button\n                                                               // $scope.showHierarchyBtnClick(); // for devel of showHierarchy modal\n                                                               // $scope.spectSettingsBtnClick(); // for testing spect settings dial\n                }, function (errMess) {\n                  modalService.open('views/error.html', 'Error parsing SSFF file: ' + errMess.status.message).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                });\n              }, function (errMess) {\n                modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message).then(function () {\n                  appStateService.resetToInitState();\n                });\n              });\n            } else {\n              modalService.open('views/error.html', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }, function (errMess) {\n            // check for http vs websocket response\n            if (errMess.data) {\n              modalService.open('views/error.html', 'Error loading bundle: ' + errMess.data).then(function () {\n                appStateService.resetToInitState();\n              });\n            } else {\n              modalService.open('views/error.html', 'Error loading bundle: ' + errMess.status.message).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          });\n        }\n      }\n    };\n    /**\n\t\t * general purpose save bundle function.\n\t\t * @return promise that is resolved after completion (rejected on error)\n\t\t */\n    sServObj.saveBundle = function () {\n      // check if something has changed\n      // if (HistoryService.movesAwayFromLastSave !== 0) {\n      if (viewState.getPermission('saveBndlBtnClick')) {\n        var defer = $q.defer();\n        viewState.somethingInProgress = true;\n        viewState.setState('loadingSaving');\n        //create bundle json\n        var bundleData = {};\n        viewState.somethingInProgressTxt = 'Creating bundle json...';\n        bundleData.ssffFiles = [];\n        var formants = {};\n        // ssffFiles (only FORMANTS are allowed to be manipulated so only this track is sent back to server)\n        var formants = Ssffdataservice.getFile('FORMANTS');\n        if (formants !== undefined) {\n          Ssffparserservice.asyncJso2ssff(formants).then(function (messParser) {\n            bundleData.ssffFiles.push({\n              'fileExtension': formants.fileExtension,\n              'encoding': 'BASE64',\n              'data': Binarydatamaniphelper.arrayBufferToBase64(messParser.data)\n            });\n            sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Error converting javascript object to SSFF file: ' + errMess.status.message);\n            defer.reject();\n          });\n        } else {\n          sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n        }\n        return defer.promise;  // }\n      } else {\n        $log.info('Action: menuBundleSaveBtnClick not allowed!');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAnnotationAndSaveBndl = function (bundleData, defer) {\n      /** Markus Jochim \n\t\t\t * Is this the way to go to validate date before saving?\n\t\t\t *\n\t\t\t// validate bundle\n\t\t\tvar validRes = Validationservice.validateJSO('bundleSchema', bundleData);\n\t\t\tif (validRes !== true) {\n\t\t\t\tconsole.log ('PROBLEM: trying to save bundle but bundle is invalid. traverseAndClean() will be called.');\n\t\t\t}\n\t\t\t*/\n      // clean to be safe...\n      StandardFuncsService.traverseAndClean(DataService.getData());\n      /** Markus Jochim\n\t\t\t * Validating again would probably be overkill\n\t\t\t *\n\t\t\t// validate bundle\n\t\t\tvar validRes = Validationservice.validateJSO('bundleSchema', bundleData);\n\t\t\tif (validRes !== true) {\n\t\t\t\tconsole.log ('GRAVE PROBLEM: trying to save bundle but bundle is invalid. traverseAndClean() HAS ALREADY BEEN CALLED.');\n\t\t\t}\n\t\t\t*/\n      // annotation\n      bundleData.annotation = DataService.getData();\n      var curBndl = loadedMetaDataService.getCurBndl();\n      // add session if available\n      if (typeof curBndl.session !== 'undefined') {\n        bundleData.session = curBndl.session;\n      }\n      // add finishedEditing if available\n      if (typeof curBndl.finishedEditing !== 'undefined') {\n        bundleData.finishedEditing = curBndl.finishedEditing;\n      }\n      // add comment if available\n      if (typeof curBndl.comment !== 'undefined') {\n        bundleData.comment = curBndl.comment;\n      }\n      viewState.somethingInProgressTxt = 'Saving bundle...';\n      Iohandlerservice.saveBundle(bundleData).then(function () {\n        viewState.somethingInProgressTxt = 'Done!';\n        viewState.somethingInProgress = false;\n        HistoryService.movesAwayFromLastSave = 0;\n        defer.resolve();\n        viewState.setState('labeling');\n      }, function (errMess) {\n        // console.log(mess);\n        modalService.open('views/error.html', 'Error saving bundle: ' + errMess.status.message).then(function () {\n          appStateService.resetToInitState();\n        });\n        defer.reject();\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.appStateService\n * @description\n * # appStateService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('appStateService', [\n  '$log',\n  '$rootScope',\n  'DragnDropService',\n  'DragnDropDataService',\n  'viewState',\n  'Iohandlerservice',\n  'loadedMetaDataService',\n  'Soundhandlerservice',\n  'DataService',\n  'Ssffdataservice',\n  'HistoryService',\n  function appStateService($log, $rootScope, DragnDropService, DragnDropDataService, viewState, Iohandlerservice, loadedMetaDataService, Soundhandlerservice, DataService, Ssffdataservice, HistoryService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t *\n\t\t */\n    sServObj.resetToInitState = function () {\n      if (Iohandlerservice.wsH.isConnected()) {\n        Iohandlerservice.wsH.disconnectWarning().then(function (resp) {\n          $log.info('Closing websocket connection to server');\n          Iohandlerservice.wsH.closeConnect();\n        });\n      }\n      // $scope.curBndl = {};\n      loadedMetaDataService.resetToInitState();\n      Soundhandlerservice.wavJSO = {};\n      DataService.setData({});\n      DragnDropDataService.resetToInitState();\n      DragnDropService.resetToInitState();\n      Ssffdataservice.data = [];\n      HistoryService.resetToInitState();\n      viewState.setState('noDBorFilesloaded');\n      viewState.somethingInProgress = false;\n      viewState.resetToInitState();\n      HistoryService.resetToInitState();\n      viewState.showDropZone = true;\n      $rootScope.$broadcast('resetToInitState');  //$scope.loadDefaultConfig();\n    };\n    return sServObj;\n  }\n]);\n/**\n * A simple class that creates another thread\n * which does the wavParserWorker work\n * @class wavParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction wavParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nwavParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.ab2str = function (ab) {\n      var unis = [];\n      for (var i = 0; i < ab.length; i++) {\n        unis.push(ab[i]);\n      }\n      return String.fromCharCode.apply(null, unis);\n    };\n    global.wav2jso = function (buf) {\n      var wavRep = {};\n      // var uIntBuffView = new Uint8Array(buf);\n      var curBinIdx, curBuffer, curBufferView;\n      // var dv = new DataView(buf);\n      // var ChunkSize = dv.getUint32(4)\n      // console.log(ChunkSize)\n      // ChunkId == RIFF CHECK\n      curBinIdx = 0;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.ChunkID = global.ab2str(curBufferView);\n      if (wavRep.ChunkID !== 'RIFF') {\n        // console.error('Wav read error: ChunkID not RIFF. Got ' + wavRep.ChunkID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: ChunkID not RIFF but ' + wavRep.ChunkID\n          }\n        };\n      }\n      // ChunkSize\n      curBinIdx = 4;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ChunkSize = curBufferView[0];\n      // console.log(chunkSize)\n      // Format == WAVE CHECK\n      curBinIdx = 8;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Format = global.ab2str(curBufferView);\n      if (wavRep.Format !== 'WAVE') {\n        // console.error('Wav read error: Format not WAVE. Got ' + wavRep.Format);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Format not WAVE but ' + wavRep.Format\n          }\n        };\n      }\n      // Subchunk1ID == \"fmt \" CHECK\n      curBinIdx = 12;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk1ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk1ID !== 'fmt ') {\n        // console.error('Wav read error: Subchunk1ID not fmt. Got ' + wavRep.Subchunk1ID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1ID not fmt  but ' + wavRep.Subchunk1ID\n          }\n        };\n      }\n      // Subchunk1Size == 16 CHECK\n      curBinIdx = 16;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk1Size = curBufferView[0];\n      if (wavRep.Subchunk1Size !== 16) {\n        // console.error('Wav read error: Subchunk1Size not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1Size not 16 but ' + wavRep.Subchunk1Size\n          }\n        };\n      }\n      // AudioFormat == 1  CHECK\n      curBinIdx = 20;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.AudioFormat = curBufferView[0];\n      if (wavRep.AudioFormat !== 1) {\n        // console.error('Wav read error: AudioFormat not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: AudioFormat not 1 but ' + wavRep.AudioFormat\n          }\n        };\n      }\n      // NumChannels == 1  CHECK\n      curBinIdx = 22;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.NumChannels = curBufferView[0];\n      // console.error('Wav read error: NumChannels not 1');\n      if (wavRep.NumChannels !== 1) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: NumChannels not 1 but ' + wavRep.NumChannels\n          }\n        };\n      }\n      // SampleRate \n      curBinIdx = 24;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.SampleRate = curBufferView[0];\n      // ByteRate\n      curBinIdx = 28;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ByteRate = curBufferView[0];\n      // BlockAlign\n      curBinIdx = 32;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BlockAlign = curBufferView[0];\n      // console.error(blockAlign);\n      // BitsPerSample\n      curBinIdx = 34;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BitsPerSample = curBufferView[0];\n      if (wavRep.BitsPerSample !== 16) {\n        // console.error('Wav read error: NumChannels not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: BitsPerSample not 16 but ' + wavRep.BitsPerSample\n          }\n        };\n      }\n      // Subchunk2ID\n      curBinIdx = 36;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk2ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk2ID !== 'data') {\n        // console.error('Wav read error: BitsPerSample not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk2ID not data but ' + wavRep.Subchunk2ID\n          }\n        };\n      }\n      // Subchunk2Size\n      curBinIdx = 40;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk2Size = curBufferView[0];\n      // Data\n      curBinIdx = 44;\n      curBuffer = buf.subarray(curBinIdx, wavRep.Subchunk2Size);\n      curBufferView = new Int16Array(curBuffer);\n      wavRep.Data = new Float32Array(curBufferView);\n      // console.log(wavRep);\n      // finally append original array buffer\n      wavRep.origArrBuf = buf;\n      return wavRep;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseBuf':\n          var parserRes = global.wav2jso(e.data.buffer);\n          if (parserRes.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': parserRes\n            });\n          } else {\n            global.postMessage(parserRes);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to wavParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to wavParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the espsParserWorker work\n * @class espsParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction espsParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nespsParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.toJSO = function (string, annotates, name, sampleRate) {\n      var labelJSO = {};\n      labelJSO.name = name;\n      labelJSO.annotates = annotates;\n      labelJSO.sampleRate = sampleRate;\n      labelJSO.levels = [];\n      // var ext = '_' + filePath.split('.')[filePath.split('.').length - 1];\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace all blanks with single whitespace\n      string = string.replace(/[ \\t]+/g, ' ');\n      var lines = string.split('\\n');\n      // find header end\n      var headEndIdx;\n      for (var i = 0; i < lines.length; i++) {\n        if (lines[i] === '#') {\n          headEndIdx = i;\n          break;\n        }\n      }\n      //init empty labelJSO\n      labelJSO.levels[0] = {};\n      labelJSO.levels[0].name = name;\n      labelJSO.levels[0].items = [];\n      var idCounter = 1;\n      // set level type\n      var prevLineArr;\n      var curLineArr = lines[headEndIdx + 1].split(/\\s+/);\n      if (curLineArr[curLineArr.length - 1] !== 'H#') {\n        labelJSO.levels[0].type = 'EVENT';\n      } else {\n        labelJSO.levels[0].type = 'SEGMENT';\n      }\n      if (labelJSO.levels[0].type === 'EVENT') {\n        for (i = headEndIdx + 1; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            samplePoint: Math.floor(curLineArr[1] * sampleRate)\n          });\n          idCounter += 1;\n        }\n      } else {\n        // take care of H# by not doing anything :-)\n        idCounter += 1;\n        for (i = headEndIdx + 2; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          prevLineArr = lines[i - 1].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            sampleStart: Math.floor(prevLineArr[1] * sampleRate),\n            sampleDur: Math.floor(curLineArr[1] * sampleRate) - Math.floor(prevLineArr[1] * sampleRate) - 1\n          });\n          idCounter += 1;\n        }\n      }\n      return labelJSO;\n    };\n    /**\n\t * SIC! This function probably has to be fixed...\n\t */\n    global.toESPS = function (data, name, sampleRate) {\n      var espsStr = '';\n      // construct header\n      espsStr += 'signal ' + name + '\\n';\n      espsStr += 'nfields 1\\n';\n      espsStr += '#\\n';\n      var curLabel;\n      for (var j = 0; j < data.length; j++) {\n        //angular.forEach(data, function (i, idx) {\n        if (data[j].labels[0].value === '' && j === 0) {\n          curLabel = 'H#';\n        } else {\n          curLabel = data[j].labels[0].value;\n        }\n        espsStr += '\\t' + String((data[j].sampleStart + data[j].sampleDur) / sampleRate) + '\\t125\\t' + curLabel + '\\n';\n      }\n      //});\n      // console.log(espsStr);\n      return espsStr;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseESPS':\n          retVal = global.toJSO(e.data.esps, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'parseJSO':\n          retVal = global.toESPS(e.data.level.items, e.data.level.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to espsParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to espsParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the textGridParserWorker work\n * @class textGridParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction textGridParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\ntextGridParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.l1 = 'File type = \"ooTextFile\"';\n    global.l2 = 'Object class = \"TextGrid\"';\n    global.localID = 0;\n    /**\n\t * test to see if all the segments in seg levels\n\t * are \"snapped\" -> sampleStart+dur+1 = sampleStart of next Segment\n\t */\n    global.testForGapsInLabelJSO = function (labelJSO) {\n      var counter = 0;\n      for (var i = 0; i < labelJSO.levels.length; i++) {\n        if (labelJSO.levels[i].type === 'SEGMENT') {\n          for (var j = 0; j < labelJSO.levels[i].items.length - 1; j++) {\n            if (labelJSO.levels[i].items[j].sampleStart + labelJSO.levels[i].items[j].sampleDur + 1 !== labelJSO.levels[i].items[j + 1].sampleStart) {\n              counter = counter + 1;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t *\n\t */\n    global.findTimeOfMinSample = function () {\n      return 0;  // maybe needed at some point...\n    };\n    /**\n\t *\n\t */\n    global.findTimeOfMaxSample = function (buffLength, sampleRate) {\n      return buffLength / sampleRate;\n    };\n    /**\n\t * parse a textgrid string to the specified json format\n\t *\n\t * @param string TextGrid file string to be parsed\n\t * @returns a label java script object\n\t */\n    global.toJSO = function (string, myFile, myName, sampleRate) {\n      var VU_STR = '123abcABCCBAcba321';\n      // very unlikly string\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace blanks in quates with VU_STR to preserve blanks in labels\n      string = string.replace(/(\"[^\\n]*\")/g, function ($0, $1) {\n        var res = $1.replace(/\\s+/g, VU_STR);\n        return res;\n      });\n      // remove remaining blanks\n      string = string.replace(/[\\t ]+/g, '');\n      // convert VU_STR back to blanks\n      var re = new RegExp(VU_STR, 'g');\n      string = string.replace(re, ' ');\n      var lines = string.split('\\n');\n      var tT, tN, eT, lab;\n      var inHeader = true;\n      var labs = [];\n      //meta info for labelJSO\n      var labelJSO = {\n          name: myName,\n          annotates: myFile,\n          sampleRate: sampleRate,\n          levels: [],\n          links: []\n        };\n      if (lines[0].replace(/\\s+/g, '') === global.l1.replace(/\\s+/g, '') && lines[1].replace(/\\s+/g, '') === global.l2.replace(/\\s+/g, '')) {\n        for (var i = 2; i < lines.length; i++) {\n          var cL = lines[i];\n          if (cL === 'item[]:') {\n            inHeader = false;\n            continue;\n          }\n          if (inHeader) {\n            continue;\n          }\n          if (cL.indexOf('item[') === 0) {\n            // get level name\n            tN = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            // get level type\n            if (lines[i + 1].split(/=/)[1] === '\"IntervalTier\"') {\n              tT = 'SEGMENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else if (lines[i + 1].split(/=/)[1] === '\"TextTier\"') {\n              tT = 'EVENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else {\n            }\n          }\n          if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'SEGMENT' && cL.indexOf('intervals') === 0 && cL.indexOf('intervals:') !== 0) {\n            // parse seg levels event\n            var itemST = Math.floor(lines[i + 1].split(/=/)[1] * sampleRate);\n            var itemET = Math.floor(lines[i + 2].split(/=/)[1] * sampleRate);\n            lab = lines[i + 3].split(/=/)[1].replace(/\"/g, '');\n            var labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              sampleStart: itemST,\n              sampleDur: itemET - itemST - 1,\n              labels: labs\n            });\n            ++global.localID;\n          } else if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'EVENT' && cL.indexOf('points') === 0 && cL.indexOf('points:') !== 0) {\n            // parse point level event\n            eT = lines[i + 1].split(/=/)[1] * sampleRate;\n            lab = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              samplePoint: Math.round(eT),\n              labels: labs\n            });\n            ++global.localID;\n          }\n        }\n        // console.log(JSON.stringify(labelJSO, undefined, 2));\n        global.testForGapsInLabelJSO(labelJSO);\n        return labelJSO;\n      } else {\n        // alert('bad header in TextGrid file!!! The header has to be: ', global.l1, '\\n', global.l2);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'bad header in TextGrid file!!! The header has to be: ' + global.l1 + '\\n' + global.l2\n          }\n        };\n      }\n    };\n    /**\n\t * converts the internal levels format returned from levelHandler.getLevels\n\t * to a string containing a TextGrid file\n\t */\n    global.toTextGrid = function (levelData, buffLength, sampleRate) {\n      var tG = '';\n      var nl = '\\n';\n      var t = '\\t';\n      // writing header infos\n      tG = tG + global.l1 + nl + global.l2 + nl + nl;\n      tG = tG + 'xmin = ' + global.findTimeOfMinSample() + nl;\n      tG = tG + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n      tG = tG + 'levels? <exists>' + nl;\n      tG = tG + 'size = ' + levelData.length + nl;\n      tG = tG + 'item []:' + nl;\n      //var levelNr = 0;\n      for (var levelNr = 0; levelNr < levelData.length; levelNr++) {\n        //angular.forEach(levelData, function (curLevel) {\n        //write level items\n        //levelNr = levelNr + 1;\n        var curLevel = levelData[levelNr];\n        tG = tG + t + 'item [' + levelNr + ']:' + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'class = \"IntervalTier\"' + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'class = \"TextTier\"' + nl;\n        }\n        tG = tG + t + t + 'name = \"' + curLevel.name + '\"' + nl;\n        tG = tG + t + t + 'xmin = ' + global.findTimeOfMinSample() + nl;\n        tG = tG + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'intervals: size = ' + curLevel.items.length + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'points: size = ' + curLevel.items.length + nl;\n        }\n        var curVal;\n        for (var j = 0; j < curLevel.items.length; j++) {\n          var evtNr = j + 1;\n          if (curLevel.type === 'SEGMENT') {\n            tG = tG + t + t + t + 'intervals [' + evtNr + ']:' + nl;\n            if (curLevel.items[j].sampleStart !== 0) {\n              curVal = curLevel.items[j].sampleStart / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmin = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmin = ' + 0 + nl;\n            }\n            if (j < curLevel.items.length - 1) {\n              curVal = (curLevel.items[j].sampleStart + curLevel.items[j].sampleDur) / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmax = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n            }\n            tG = tG + t + t + t + t + 'text = \"' + curLevel.items[j].labels[0].value + '\"' + nl;\n          } else if (curLevel.type === 'EVENT') {\n            tG = tG + t + t + t + 'points[' + evtNr + ']:' + nl;\n            tG = tG + t + t + t + t + 'time = ' + curLevel.items[j].samplePoint / sampleRate + nl;\n            tG = tG + t + t + t + t + 'mark = \"' + curLevel.items[j].labels[0].value + '\"' + nl;\n          }\n        }\n      }\n      return tG;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseTG':\n          retVal = global.toJSO(e.data.textGrid, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'toTextGrid':\n          retVal = global.toTextGrid(e.data.levels, e.data.buffLength, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to textGridParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to textGridParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n//'use strict';\n/**\n * A simple class that creates another thread\n * which does the spectroDrawingWorker work\n * @class spectroDrawingWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction spectroDrawingWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nspectroDrawingWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    /**\n\t\t * A handy web worker to draw a spectrom (and calculate a fft)\n\t\t *\n\t\t * @version 1.2\n\t\t * @author Georg Raess <georg.raess@campus.lmu.de>\n\t\t * @link http://www.phonetik.uni-muenchen.de/\n\t\t *\n\t\t */\n    ///////////////////////////////////\n    // start: global vars\n    global.executed = false;\n    global.PI = 3.141592653589793;\n    // value : Math.PI\n    global.TWO_PI = 6.283185307179586;\n    // value : 2 * Math.PI\n    global.totalMax = 0;\n    global.dynRangeInDB = 50;\n    global.myWindow = {\n      BARTLETT: 1,\n      BARTLETTHANN: 2,\n      BLACKMAN: 3,\n      COSINE: 4,\n      GAUSS: 5,\n      HAMMING: 6,\n      HANN: 7,\n      LANCZOS: 8,\n      RECTANGULAR: 9,\n      TRIANGULAR: 10\n    };\n    global.imgWidth = 0;\n    global.imgHeight = 0;\n    global.upperFreq = 0;\n    global.lowerFreq = 0;\n    global.pixelRatio = 1;\n    global.heatMapColorAnchors = [\n      [\n        255,\n        0,\n        0\n      ],\n      [\n        0,\n        255,\n        0\n      ],\n      [\n        0,\n        0,\n        0\n      ]\n    ];\n    global.samplesPerPxl = 0;\n    global.sampleRate = 0;\n    global.preEmphasisFilterFactor = 0.97;\n    global.transparency = 0;\n    global.drawHeatMapColors = false;\n    global.N = 0;\n    global.windowSizeInSecs = 0.01;\n    global.audioBuffer = undefined;\n    global.audioBufferChannels = 0;\n    global.wFunction = 0;\n    global.myFFT = undefined;\n    global.pixelHeight = 1;\n    global.internalalpha = 1;\n    global.maxPsd = 0;\n    global.HzStep = 0;\n    global.paint = [];\n    global.sin = undefined;\n    global.cos = undefined;\n    global.ceilingFreqFftIdx = 0;\n    global.floorFreqFftIdx = 0;\n    global.resultImgArr = undefined;\n    // end: global vars\n    //////////////////////////////////\n    /////////////////////////////////\n    // start: math helper functions\n    // used by FFT\n    global.toLinearLevel = function (dbLevel) {\n      return Math.pow(10, dbLevel / 10);\n    };\n    // calculate decadic logarithm\n    global.log10 = function (arg) {\n      return Math.log(arg) / 2.302585092994046;  // Math.log(x) / Math.LN10\n    };\n    // calculate magintude\n    global.magnitude = function (real, imag) {\n      return Math.sqrt(real * real + imag * imag);\n    };\n    // end: math helper functions\n    ////////////////////////////////\n    ///////////////////////////////////////////////////\n    // start: FFT class (incl. fft() function itself)\n    global.FFT = function () {\n      var m, i, x;\n      var n = global.N;\n      m = parseInt(Math.log(n) / 0.6931471805599453, 10);\n      if (n !== 1 << m) {\n        // Make sure n is a power of 2\n        console.log('ERROR : FFT length must be power of 2');\n      }\n      if (global.cos === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes\n        global.cos = new Float32Array(n / 2);\n        // precompute cos table\n        for (x = 0; x < n / 2; x++) {\n          global.cos[x] = Math.cos(-2 * global.PI * x / n);\n        }\n      }\n      if (global.sin === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes \n        global.sin = new Float32Array(n / 2);\n        // precompute sin table\n        for (x = 0; x < n / 2; x++) {\n          global.sin[x] = Math.sin(-2 * global.PI * x / n);\n        }\n      }\n      /**\n\t\t\t * apply window function and pre-emphasis from idx 0 to length\n\t\t\t * in buffer given\n\t\t\t *\n\t\t\t * @param type is the chosen window Function as enum\n\t\t\t * @param alpha is the alpha value for Window Functions (default 0.16)\n\t\t\t * @param buffer is the zero padded magnitude spectrum\n\t\t\t * @param length is the length to in the buffer (starting at idx 0)\n\t\t\t * to which to apply the window to. If the buffer is [x0, x1, x2, x4] and\n\t\t\t * length is 2 the window will be applied to [x0, x1, x2] this is needed\n\t\t\t * to only apply function to non-zero-padded values of magnitude spectrum.\n\t\t\t * @return the windowed/pre-emphasised buffer\n\t\t\t */\n      this.applyWindowFuncAndPreemph = function (type, alpha, buffer, length) {\n        // var length = buffer.length;\n        this.alpha = alpha;\n        switch (type) {\n        case global.myWindow.BARTLETT:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlett(length, i);\n          }\n          break;\n        case global.myWindow.BARTLETTHANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlettHann(length, i);\n          }\n          break;\n        case global.myWindow.BLACKMAN:\n          this.alpha = this.alpha || 0.16;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBlackman(length, i, alpha);\n          }\n          break;\n        case global.myWindow.COSINE:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionCosine(length, i);\n          }\n          break;\n        case global.myWindow.GAUSS:\n          this.alpha = this.alpha || 0.25;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionGauss(length, i, alpha);\n          }\n          break;\n        case global.myWindow.HAMMING:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHamming(length, i);\n          }\n          break;\n        case global.myWindow.HANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHann(length, i);\n          }\n          break;\n        case global.myWindow.LANCZOS:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionLanczos(length, i);\n          }\n          break;\n        case global.myWindow.RECTANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionRectangular(length, i);\n          }\n          break;\n        case global.myWindow.TRIANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionTriangular(length, i);\n          }\n          break;\n        }\n        return buffer;\n      };\n      ////////////////////////////////////\n      // start: the windowing functions\n      this.wFunctionBartlett = function (length, index) {\n        return 2 / (length - 1) * ((length - 1) / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      this.wFunctionBartlettHann = function (length, index) {\n        return 0.62 - 0.48 * Math.abs(index / (length - 1) - 0.5) - 0.38 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionBlackman = function (length, index, alpha) {\n        var a0 = (1 - alpha) / 2;\n        var a1 = 0.5;\n        var a2 = alpha / 2;\n        return a0 - a1 * Math.cos(global.TWO_PI * index / (length - 1)) + a2 * Math.cos(4 * global.PI * index / (length - 1));\n      };\n      this.wFunctionCosine = function (length, index) {\n        return Math.cos(global.PI * index / (length - 1) - global.PI / 2);\n      };\n      this.wFunctionGauss = function (length, index, alpha) {\n        return Math.pow(Math.E, -0.5 * Math.pow((index - (length - 1) / 2) / (alpha * (length - 1) / 2), 2));\n      };\n      this.wFunctionHamming = function (length, index) {\n        return 0.54 - 0.46 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionHann = function (length, index) {\n        return 0.5 * (1 - Math.cos(global.TWO_PI * index / (length - 1)));\n      };\n      this.wFunctionLanczos = function (length, index) {\n        var x = 2 * index / (length - 1) - 1;\n        return Math.sin(global.PI * x) / (global.PI * x);\n      };\n      this.wFunctionRectangular = function () {\n        return 1;\n      };\n      this.wFunctionTriangular = function (length, index) {\n        return 2 / length * (length / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      // end: the windowing functions\n      ///////////////////////////////////\n      /**\n\t\t\t * calculate and apply according pre-emphasis on sample\n\t\t\t */\n      this.applyPreEmph = function (curSample, prevSample) {\n        return curSample - global.preEmphasisFilterFactor * prevSample;\n      };\n      // the FFT calculation\n      this.fft = function (x, y) {\n        // Bit-reverse\n        var i, j, k, n1, n2, a, c, s, t1, t2;\n        // Bit-reverse\n        j = 0;\n        n2 = n / 2;\n        for (i = 1; i < n - 1; i++) {\n          n1 = n2;\n          while (j >= n1) {\n            j = j - n1;\n            n1 = n1 / 2;\n          }\n          j = j + n1;\n          if (i < j) {\n            t1 = x[i];\n            x[i] = x[j];\n            x[j] = t1;\n            t1 = y[i];\n            y[i] = y[j];\n            y[j] = t1;\n          }\n        }\n        // FFT\n        n1 = 0;\n        n2 = 1;\n        for (i = 0; i < m; i++) {\n          n1 = n2;\n          n2 = n2 + n2;\n          a = 0;\n          for (j = 0; j < n1; j++) {\n            c = global.cos[a];\n            s = global.sin[a];\n            a += 1 << m - i - 1;\n            for (k = j; k < n; k = k + n2) {\n              t1 = c * x[k + n1] - s * y[k + n1];\n              t2 = s * x[k + n1] + c * y[k + n1];\n              x[k + n1] = x[k] - t1;\n              y[k + n1] = y[k] - t2;\n              x[k] = x[k] + t1;\n              y[k] = y[k] + t2;\n            }\n          }\n        }\n      };\n    };\n    // end: FFT class \n    ///////////////////\n    /////////////////////////////////\n    // start: rendering function \n    /**\n\t\t * interpolates a 3D color space and calculate accoring\n\t\t * value on that plane\n\t\t *\n\t\t * @param minval is the minimum value to map to (number)\n\t\t * @param maxval is the maximum value to map to (number)\n\t\t * @param val is the value itself (number)\n\t\t * @param colors is an array of arrays containing the colors\n\t\t * to interpol. against (of the form: [[255, 0, 0],[0, 255, 0],[0, 0, 255]])\n\t\t */\n    global.convertToHeatmap = function (minval, maxval, val, colors) {\n      var maxIndex = colors.length - 1;\n      var v = (val - minval) / (maxval - minval) * maxIndex;\n      var i1 = Math.floor(v);\n      var i2 = Math.min.apply(null, [\n          Math.floor(v) + 1,\n          maxIndex\n        ]);\n      var rgb1 = colors[i1];\n      var rgb2 = colors[i2];\n      var f = v - i1;\n      return {\n        'r': Math.floor(rgb1[0] + f * (rgb2[0] - rgb1[0])),\n        'g': Math.floor(rgb1[1] + f * (rgb2[1] - rgb1[1])),\n        'b': Math.floor(rgb1[2] + f * (rgb2[2] - rgb1[2]))\n      };\n    };\n    /**\n\t\t * draws a single line of the spectrogram into the imageResult array.\n\t\t * by calculating the RGB value of the current pixel with:\n\t\t * 255-(255*scaled)\n\t\t * @param xIdx in the global.paint array\n\t\t */\n    global.drawVerticalLineOfSpectogram = function (xIdx) {\n      // set upper boundary for linear interpolation\n      var x1 = global.pixelHeight;\n      var rgb, index, px, py;\n      // value for first interpolation at lower boundry (height=0)\n      // calculate the one sided power spectral density PSD (f, t) in Pa2/Hz\n      // PSD(f) proportional to 2|X(f)|2 / (t2 - t1)\n      var psd = 2 * Math.pow(global.paint[xIdx][1], 2) / global.N;\n      var psdLog = 10 * global.log10(psd / global.maxPsd);\n      var scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n      if (scaledVal > 1) {\n        scaledVal = 1;\n      } else if (scaledVal < 0) {\n        scaledVal = 0;\n      }\n      for (var i = 0; i < global.paint[xIdx].length; i++) {\n        var y0 = scaledVal;\n        // !!!! set y0 to previous scaled value\n        // for each value in paint[] calculate pixelHeight interpolation points\n        // x0=0\n        // x1=pixelHeight\n        // if(paint[i-1]<0) paint[i-1] = 1\n        // y0=paint[i-1]    \n        // y1=paint[i]\n        // !!!! calculate next scaledValue [0...1] \n        psd = 2 * Math.pow(global.paint[xIdx][i], 2) / global.N;\n        psdLog = 10 * global.log10(psd / global.maxPsd);\n        scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n        if (scaledVal > 1) {\n          scaledVal = 1;\n        }\n        if (scaledVal < 0) {\n          scaledVal = 0;\n        }\n        // !!!! set y1 to this scaled value\n        var y1 = scaledVal;\n        if (global.pixelHeight >= 1) {\n          // do interpolation between y0 (previous scaledValue) and y1 (scaledValue now)\n          for (var b = 0; b < global.pixelHeight; b++) {\n            var y2 = y0 + (y1 - y0) / x1 * b;\n            // calculate corresponding color value for interpolation point [0...255]\n            rgb = 255 - Math.round(255 * y2);\n            // set internal image buffer to calculated & interpolated value\n            px = Math.floor(xIdx);\n            py = Math.floor(global.imgHeight - (global.pixelHeight * (i - 2) + b));\n            index = (px + py * global.imgWidth) * 4;\n            if (global.drawHeatMapColors) {\n              if (!isNaN(rgb)) {\n                var hmVals = global.convertToHeatmap(0, 255, rgb, global.heatMapColorAnchors);\n                global.resultImgArr[index + 0] = hmVals.r;\n                global.resultImgArr[index + 1] = hmVals.g;\n                global.resultImgArr[index + 2] = hmVals.b;\n                global.resultImgArr[index + 3] = global.transparency;\n              } else {\n                global.resultImgArr[index + 0] = rgb;\n                global.resultImgArr[index + 1] = rgb;\n                global.resultImgArr[index + 2] = rgb;\n                global.resultImgArr[index + 3] = global.transparency;\n              }\n            } else {\n              global.resultImgArr[index + 0] = rgb;\n              global.resultImgArr[index + 1] = rgb;\n              global.resultImgArr[index + 2] = rgb;\n              global.resultImgArr[index + 3] = global.transparency;\n            }\n          }\n        } else {\n          rgb = 255 - Math.round(255 * y1);\n          // set internal image buffer to calculated & interpolated value\n          px = Math.floor(xIdx);\n          py = Math.floor(global.imgHeight - global.pixelHeight * (i - 2));\n          index = (px + py * global.imgWidth) * 4;\n          global.resultImgArr[index + 0] = rgb;\n          global.resultImgArr[index + 1] = rgb;\n          global.resultImgArr[index + 2] = rgb;\n          global.resultImgArr[index + 3] = global.transparency;\n        }\n      }\n    };\n    /**\n\t\t * calculates Magnitude by\n\t\t * - reading the current (defined with offset) data from localSoundBuffer\n\t\t * - applying the current Window Function to the selected data\n\t\t * - calculating the actual FFT\n\t\t * - (and saving the biggest value in totalMax)\n\t\t *\n\t\t * @param offset calculated offset in PCM Stream\n\t\t * @param windowSizeInSamples size of window in samples (actual samples -> not FFT length; rest zero-padded)\n\t\t * @return magnitude spectrum as Float32Array\n\t\t */\n    global.calcMagnitudeSpectrum = function (offset, windowSizeInSamples) {\n      // imaginary array of length N\n      var imag = new Float32Array(global.N);\n      // real array of length N\n      var real = new Float32Array(global.N);\n      // result array of length c - d\n      var result = new Float32Array(global.ceilingFreqFftIdx - global.floorFreqFftIdx);\n      // set real values by reading local sound buffer (this auto zeropads everything > windowSizeInSamples)\n      for (var j = 0; j < windowSizeInSamples; j++) {\n        real[j] = global.audioBuffer[offset + j];\n      }\n      // apply window function and pre-emphasis to non zero padded real \n      global.myFFT.applyWindowFuncAndPreemph(global.wFunction, global.internalalpha, real, windowSizeInSamples);\n      // calculate FFT over real and save to result\n      global.myFFT.fft(real, imag);\n      // calculate magnitude for each spectral component \n      for (var low = 0; low <= global.ceilingFreqFftIdx - global.floorFreqFftIdx; low++) {\n        result[low] = global.magnitude(real[low + global.floorFreqFftIdx], imag[low + global.floorFreqFftIdx]);\n        if (global.totalMax < result[low]) {\n          global.totalMax = result[low];\n        }\n      }\n      return result;\n    };\n    /**\n\t\t * initial function call for calculating and drawing Spectrogram\n\t\t * input sample data comes from the buffer global.audioBuffer\n\t\t * - first loop calculates magnitude spectra to draw (calcMagnitudeSpectrum())\n\t\t * - second loop draws these values into the global.resultImgArr (drawVerticalLineOfSpectogram())\n\t\t */\n    global.renderSpectrogram = function () {\n      if (!global.executed) {\n        // start execution once\n        global.executed = true;\n        var windowSizeInSamples = global.sampleRate * global.windowSizeInSecs;\n        // instance of FFT with windowSize N\n        global.myFFT = new global.FFT();\n        // array holding FFT results paint[canvas width][canvas height]\n        global.paint = new Array(global.imgWidth);\n        // Hz per pixel height\n        global.HzStep = global.sampleRate / 2 / (global.N / 2);\n        // upper Hz boundary to display\n        global.ceilingFreqFftIdx = Math.ceil(global.upperFreq / global.HzStep);\n        // lower Hz boundary to display\n        global.floorFreqFftIdx = Math.floor(global.lowerFreq / global.HzStep);\n        // -1 for value below display when lower>0\n        // height between two interpolation points\n        global.pixelHeight = global.imgHeight / (global.ceilingFreqFftIdx - global.floorFreqFftIdx - 2);\n        // ugly hack in order to support PhantomJS < 2.0 testing\n        if (typeof Uint8ClampedArray === 'undefined') {\n          Uint8ClampedArray = Uint8Array;\n        }\n        // create new picture\n        global.resultImgArr = new Uint8ClampedArray(Math.ceil(global.imgWidth * global.imgHeight * 4));\n        // calculate i FFT runs, save result into paint and set maxPsd while doing so\n        for (var i = 0; i < global.imgWidth; i++) {\n          global.paint[i] = global.calcMagnitudeSpectrum(Math.round(i * global.samplesPerPxl), windowSizeInSamples);\n          global.maxPsd = 2 * Math.pow(global.totalMax, 2) / global.N;\n        }\n        // draw spectrogram on png image with canvas width\n        // one column is drawn per drawVerticalLineOfSpectogram\n        for (var j = 0; j < global.imgWidth; j++) {\n          global.drawVerticalLineOfSpectogram(j);\n        }\n        // post generated image block with settings back\n        global.postMessage({\n          'window': global.wFunction,\n          'samplesPerPxl': global.samplesPerPxl,\n          'pixelHeight': global.pixelHeight,\n          'pixelRatio': global.pixelRatio,\n          'width': global.imgWidth,\n          'height': global.imgHeight,\n          'img': global.resultImgArr.buffer\n        }, [global.resultImgArr.buffer]);\n        // free vars\n        global.myFFT = null;\n        // stop execution\n        global.executed = false;\n      }\n    };\n    // end: rendering function \n    //////////////////////////////\n    //////////////////////////\n    // communication functions\n    /**\n\t\t * function to handle messages events if used ad web worker\n\t\t * @param e message event\n\t\t */\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var render = true;\n        var renderError = '';\n        var data = e.data;\n        if (data.windowSizeInSecs !== undefined) {\n          global.windowSizeInSecs = data.windowSizeInSecs;\n        } else {\n          renderError = 'windowSizeInSecs';\n          render = false;\n        }\n        if (data.fftN !== undefined) {\n          global.N = data.fftN;\n        } else {\n          renderError = 'fftN';\n          render = false;\n        }\n        if (data.alpha !== undefined) {\n          global.internalalpha = data.alpha;\n        } else {\n          renderError = 'alpha';\n          render = false;\n        }\n        if (data.upperFreq !== undefined) {\n          global.upperFreq = data.upperFreq;\n        } else {\n          renderError = 'upperFreq';\n          render = false;\n        }\n        if (data.lowerFreq !== undefined) {\n          global.lowerFreq = data.lowerFreq;\n        } else {\n          renderError = 'lowerFreq';\n          render = false;\n        }\n        if (data.samplesPerPxl !== undefined) {\n          global.samplesPerPxl = data.samplesPerPxl;\n        } else {\n          renderError = 'samplesPerPxl';\n          render = false;\n        }\n        if (data.window !== undefined) {\n          switch (data.window) {\n          case 1:\n            global.wFunction = global.myWindow.BARTLETT;\n            break;\n          case 2:\n            global.wFunction = global.myWindow.BARTLETTHANN;\n            break;\n          case 3:\n            global.wFunction = global.myWindow.BLACKMAN;\n            break;\n          case 4:\n            global.wFunction = global.myWindow.COSINE;\n            break;\n          case 5:\n            global.wFunction = global.myWindow.GAUSS;\n            break;\n          case 6:\n            global.wFunction = global.myWindow.HAMMING;\n            break;\n          case 7:\n            global.wFunction = global.myWindow.HANN;\n            break;\n          case 8:\n            global.wFunction = global.myWindow.LANCZOS;\n            break;\n          case 9:\n            global.wFunction = global.myWindow.RECTANGULAR;\n            break;\n          case 10:\n            global.wFunction = global.myWindow.TRIANGULAR;\n            break;\n          }\n        } else {\n          renderError = 'window';\n          render = false;\n        }\n        if (data.imgWidth !== undefined) {\n          global.imgWidth = data.imgWidth;\n        } else {\n          renderError = 'imgWidth';\n          render = false;\n        }\n        if (data.imgHeight !== undefined) {\n          global.imgHeight = data.imgHeight;\n        } else {\n          renderError = 'imgHeight';\n          render = false;\n        }\n        if (data.dynRangeInDB !== undefined) {\n          global.dynRangeInDB = data.dynRangeInDB;\n        } else {\n          renderError = 'dynRangeInDB';\n          render = false;\n        }\n        if (data.pixelRatio !== undefined) {\n          global.pixelRatio = data.pixelRatio;\n        } else {\n          renderError = 'pixelRatio';\n          render = false;\n        }\n        if (data.sampleRate !== undefined) {\n          global.sampleRate = data.sampleRate;\n        } else {\n          renderError = 'sampleRate';\n          render = false;\n        }\n        if (data.audioBufferChannels !== undefined) {\n          global.audioBufferChannels = data.audioBufferChannels;\n        } else {\n          renderError = 'audioBufferChannels';\n          render = false;\n        }\n        if (data.transparency !== undefined) {\n          global.transparency = data.transparency;\n        } else {\n          renderError = 'transparency';\n          render = false;\n        }\n        if (data.audioBuffer !== undefined) {\n          global.audioBuffer = data.audioBuffer;\n        } else {\n          renderError = 'audioBuffer';\n          render = false;\n        }\n        if (data.drawHeatMapColors !== undefined) {\n          global.drawHeatMapColors = data.drawHeatMapColors;\n        } else {\n          renderError = 'drawHeatMapColors';\n          render = false;\n        }\n        if (data.preEmphasisFilterFactor !== undefined) {\n          global.preEmphasisFilterFactor = data.preEmphasisFilterFactor;\n        } else {\n          renderError = 'preEmphasisFilterFactor';\n          render = false;\n        }\n        if (data.heatMapColorAnchors !== undefined) {\n          global.heatMapColorAnchors = data.heatMapColorAnchors;\n        } else {\n          renderError = 'heatMapColorAnchors';\n          render = false;\n        }\n        if (render) {\n          global.renderSpectrogram();\n        } else {\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': renderError + ' is undefined'\n            }\n          });\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to spectroDrawingWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(spectroDrawingWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }  //\n     /////////////////////\n};\n/**\n * A simple class that creates another thread\n * which does the ssffParserWorker work\n * @class ssffParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction ssffParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nssffParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    var ssffData = {};\n    var headID = 'SSFF -- (c) SHLRC\\n';\n    var machineID = 'Machine IBM-PC\\n';\n    var sepString = '-----------------\\n';\n    ssffData.fileExtension = '';\n    ssffData.sampleRate = -1;\n    ssffData.startTime = -1;\n    ssffData.origFreq = -1;\n    ssffData.Columns = [];\n    /**\n\t\t * Mock for atob btoa for web kit based browsers that don't support these in webworkers\n\t\t */\n    (function () {\n      var base64EncodeChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n      var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);\n      function base64encode(str) {\n        var out, i, len;\n        var c1, c2, c3;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          c1 = str.charCodeAt(i++) & 255;\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4);\n            out += '==';\n            break;\n          }\n          c2 = str.charCodeAt(i++);\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n            out += base64EncodeChars.charAt((c2 & 15) << 2);\n            out += '=';\n            break;\n          }\n          c3 = str.charCodeAt(i++);\n          out += base64EncodeChars.charAt(c1 >> 2);\n          out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n          out += base64EncodeChars.charAt((c2 & 15) << 2 | (c3 & 192) >> 6);\n          out += base64EncodeChars.charAt(c3 & 63);\n        }\n        return out;\n      }\n      function base64decode(str) {\n        var c1, c2, c3, c4;\n        var i, len, out;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          do {\n            c1 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c1 === -1);\n          if (c1 === -1) {\n            break;\n          }\n          do {\n            c2 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c2 === -1);\n          if (c2 === -1) {\n            break;\n          }\n          out += String.fromCharCode(c1 << 2 | (c2 & 48) >> 4);\n          do {\n            c3 = str.charCodeAt(i++) & 255;\n            if (c3 === 61) {\n              return out;\n            }\n            c3 = base64DecodeChars[c3];\n          } while (i < len && c3 === -1);\n          if (c3 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c2 & 15) << 4 | (c3 & 60) >> 2);\n          do {\n            c4 = str.charCodeAt(i++) & 255;\n            if (c4 === 61) {\n              return out;\n            }\n            c4 = base64DecodeChars[c4];\n          } while (i < len && c4 === -1);\n          if (c4 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c3 & 3) << 6 | c4);\n        }\n        return out;\n      }\n      //var scope = (typeof window !== 'undefined') ? window : global;\n      if (!global.btoa) {\n        global.btoa = base64encode;\n      }\n      if (!global.atob) {\n        global.atob = base64decode;\n      }\n    }());\n    /**\n\t\t *\n\t\t */\n    global.base64ToArrayBuffer = function (stringBase64) {\n      var binaryString = global.atob(stringBase64);\n      var len = binaryString.length;\n      var bytes = new Uint8Array(len);\n      for (var i = 0; i < len; i++) {\n        var ascii = binaryString.charCodeAt(i);\n        bytes[i] = ascii;\n      }\n      return bytes.buffer;\n    };\n    /**\n\t\t * round to n decimal digits after the comma\n\t\t * used to help display numbers with a given\n\t\t * precision\n\t\t */\n    global.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        return false;\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return k.substring(0, k.indexOf('.') + n + 1);\n    };\n    /**\n\t\t * helper function to convert string to Uint8Array\n\t\t * @param string\n\t\t */\n    global.stringToUint = function (string) {\n      var charList = string.split('');\n      var uintArray = [];\n      for (var i = 0; i < charList.length; i++) {\n        uintArray.push(charList[i].charCodeAt(0));\n      }\n      return new Uint8Array(uintArray);\n    };\n    /**\n\t\t *\n\t\t */\n    global.Uint8Concat = function (first, second) {\n      var firstLength = first.length;\n      var result = new Uint8Array(firstLength + second.length);\n      result.set(first);\n      result.set(second, firstLength);\n      return result;\n    };\n    /**\n\t\t * convert arraybuffer containing a ssff file\n\t\t * to a javascript object\n\t\t * @param buf arraybuffer containing ssff file\n\t\t * @param name is fileExtension\n\t\t * @returns ssff javascript object\n\t\t */\n    global.ssff2jso = function (buf, name) {\n      ssffData.fileExtension = name;\n      ssffData.Columns = [];\n      // console.log('SSFF loaded');\n      var uIntBuffView = new Uint8Array(buf);\n      var dataView = new DataView(buf);\n      // Causes \"RangeError: Maximum call stack size exceeded\"\n      // with some browsers (?)(Chrome/Chromium on Ubuntu)\n      //var buffStr = String.fromCharCode.apply(null, uIntBuffView);\n      var buffStr = '';\n      if ('TextDecoder' in this) {\n        var decoder = new TextDecoder('ASCII');\n        buffStr = decoder.decode(dataView);  //var headerStr = buffStr.split(sepString)[0];\n                                             //var dataStr = buffStr.split(sepString)[1];\n                                             //console.log(dataStr);\n      } else {\n        for (var j = 0; j < uIntBuffView.length; j++) {\n          buffStr = buffStr + String.fromCharCode(uIntBuffView[j]);\n        }\n      }\n      var newLsep = buffStr.split(/^/m);\n      //check if header has headID and machineID\n      if (newLsep[0] !== headID) {\n        // alert('SSFF parse error: first line != SSFF -- (c) SHLRC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: first line != SSFF -- (c) SHLRC in file with fileExtension ' + name\n          }\n        };\n      }\n      if (newLsep[1] !== machineID) {\n        // alert('SSFF parse error: machineID != Machine IBM-PC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: machineID != Machine IBM-PC in file with fileExtension ' + name\n          }\n        };\n      }\n      // search header for Record_Freq and Start_Time\n      ssffData.sampleRate = undefined;\n      ssffData.startTime = undefined;\n      var counter = 0;\n      while (newLsep[counter] !== sepString) {\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Record_Freq') {\n          // console.log(\"FOUND Record_Freq\")\n          ssffData.sampleRate = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Start_Time') {\n          // console.log(\"FOUND Start_Time\")\n          ssffData.startTime = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        counter += 1;\n      }\n      // check if found Record_Freq and Start_Time\n      if (ssffData.sampleRate === undefined || ssffData.startTime === undefined) {\n        // alert('SSFF parse error: Required fields Record_Freq or Start_Time not set!');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: Required fields Record_Freq or Start_Time not set in file with fileExtension ' + name\n          }\n        };\n      }\n      for (var i = 4; i < newLsep.length; i++) {\n        if (newLsep[i].split(/[ ,]+/)[0] === 'Original_Freq') {\n          ssffData.origFreq = parseFloat(newLsep[i].split(/[ ,]+/)[2].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[i] === sepString) {\n          break;\n        }\n        var lSpl = newLsep[i].split(/[ ]+/);\n        if (lSpl[0] === 'Column') {\n          ssffData.Columns.push({\n            'name': lSpl[1],\n            'ssffdatatype': lSpl[2],\n            'length': parseInt(lSpl[3].replace(/(\\r\\n|\\n|\\r)/gm, ''), 10),\n            'values': [],\n            '_minVal': Infinity,\n            '_maxVal': -Infinity\n          });\n        }\n      }\n      var curBinIdx = newLsep.slice(0, i + 1).join('').length;\n      var curBufferView, curBuffer, curLen, curMin, curMax;\n      while (curBinIdx < uIntBuffView.length) {\n        for (i = 0; i < ssffData.Columns.length; i++) {\n          //console.log(ssffData.Columns[i].length);\n          if (ssffData.Columns[i].ssffdatatype === 'DOUBLE') {\n            curLen = 8 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            // ugly hack in order to support PhantomJS < 2.0 testing\n            if (typeof Float64Array == 'undefined') {\n              Float64Array = Float32Array;\n            }\n            curBufferView = new Float64Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'FLOAT') {\n            curLen = 4 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Float32Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'SHORT') {\n            curLen = 2 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint16Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'BYTE') {\n            curLen = 1 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint8Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n          } else {\n            // alert('Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported');\n            return {\n              'status': {\n                'type': 'ERROR',\n                'message': 'Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported in file with fileExtension ' + name\n              }\n            };\n          }\n        }  //for\n      }\n      //while\n      return ssffData;\n    };\n    /**\n\t\t * convert javascript object of label file to\n\t\t * array buffer containing\n\t\t * @param ssff javascipt object\n\t\t * @returns ssff arraybuffer\n\t\t */\n    global.jso2ssff = function (jso) {\n      // create header\n      var headerStr = headID + machineID;\n      headerStr += 'Record_Freq ' + global.round(jso.sampleRate, 1) + '\\n';\n      headerStr += 'Start_Time ' + jso.startTime + '\\n';\n      jso.Columns.forEach(function (col) {\n        // console.log(col.name)\n        headerStr += 'Column ' + col.name + ' ' + col.ssffdatatype + ' ' + col.length + '\\n';\n      });\n      headerStr += 'Original_Freq DOUBLE ' + global.round(jso.origFreq, 1) + '\\n';\n      headerStr += sepString;\n      // preallocate data buffer\n      var bytePerTime = 0;\n      var failed = false;\n      jso.Columns.forEach(function (col) {\n        if (col.ssffdatatype === 'SHORT') {\n          bytePerTime += 2 * col.length;\n        } else {\n          failed = true;\n        }\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      var byteSizeOfDataBuffer = bytePerTime * jso.Columns[0].values.length;\n      var dataBuff = new ArrayBuffer(byteSizeOfDataBuffer);\n      var dataBuffView = new DataView(dataBuff);\n      // convert buffer to header\n      var ssffBufView = new Uint8Array(global.stringToUint(headerStr));\n      // loop through vals and append array of each column to ssffBufView\n      var byteOffSet = 0;\n      jso.Columns[0].values.forEach(function (curArray, curArrayIDX) {\n        jso.Columns.forEach(function (curCol) {\n          if (curCol.ssffdatatype === 'SHORT') {\n            curCol.values[curArrayIDX].forEach(function (val) {\n              dataBuffView.setInt16(byteOffSet, val, true);\n              byteOffSet += 2;\n            });\n          } else {\n            failed = true;\n          }\n        });\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      // concatenate header with data\n      var tmp = new Uint8Array(dataBuffView.buffer);\n      ssffBufView = new global.Uint8Concat(ssffBufView, tmp);\n      return {\n        'status': {\n          'type': 'SUCCESS',\n          'message': ''\n        },\n        'data': ssffBufView.buffer\n      };\n    };\n    /**\n\t\t * loop over ssff files in ssffArr and create a ssffJsoArr\n\t\t */\n    global.parseArr = function (ssffArr) {\n      var noError = true;\n      var resArr = [];\n      var ssffJso;\n      for (var i = 0; i < ssffArr.length; i++) {\n        ssffJso = {};\n        var arrBuff;\n        arrBuff = global.base64ToArrayBuffer(ssffArr[i].data);\n        ssffJso = global.ssff2jso(arrBuff, ssffArr[i].fileExtension);\n        if (ssffJso.status === undefined) {\n          resArr.push(JSON.parse(JSON.stringify(ssffJso)));  // YUCK... don't know if SIC but YUCK!!!\n        } else {\n          noError = false;\n          return ssffJso;\n        }\n      }\n      if (noError) {\n        return {\n          'status': {\n            'type': 'SUCCESS',\n            'message': ''\n          },\n          'data': resArr\n        };\n      } else {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Error in parseArr() with: ' + JSON.stringify(ssffArr)\n          }\n        };\n      }\n    };\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseArr':\n          global.postMessage(global.parseArr(e.data.ssffArr));\n          break;\n        case 'jso2ssff':\n          global.postMessage(global.jso2ssff(JSON.parse(e.data.jso)));\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to ssffParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to ssffParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = undefined;\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n      this.url = undefined;\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.mathHelperService\n * @description\n * # mathHelperService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('mathHelperService', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  //////////////////////\n  //////////////////////\n  // public API\n  /**\n\t\t * calculate the closest power of two that is\n\t\t * greater than the passed in number\n\t\t * @param num\n\t\t * @returns power of two value\n\t\t */\n  sServObj.calcClosestPowerOf2Gt = function (num) {\n    var curExp = 0;\n    while (Math.pow(2, curExp) < num) {\n      curExp = curExp + 1;\n    }\n    return Math.pow(2, curExp);\n  };\n  /**\n\t\t * round to n digits after decimal point\n\t\t * used to help display numbers with a given\n\t\t * precision\n\t\t * @param x number \n\t\t * @param n digits after decimal point\n\t\t * @returns rounded number\n\t\t */\n  sServObj.roundToNdigitsAfterDecPoint = function (x, n) {\n    if (n < 1 || n > 14) {\n      console.error('error in call of round function!!');\n    }\n    var e = Math.pow(10, n);\n    var k = (Math.round(x * e) / e).toString();\n    if (k.indexOf('.') === -1) {\n      k += '.';\n    }\n    k += e.toString().substring(1);\n    return parseFloat(k.substring(0, k.indexOf('.') + n + 1));\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').directive('modal', [\n  '$animate',\n  'modalService',\n  function ($animate, modalService) {\n    return {\n      restrict: 'E',\n      templateUrl: 'views/modal.html',\n      replace: true,\n      scope: {},\n      link: function (scope, element, attr) {\n        scope.templateUrl = '';\n        scope.modal = modalService;\n        scope.isOpen = false;\n        scope.force = false;\n        scope.dataIn = '';\n        scope.$watch('modal.isOpen', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.templateUrl = modalService.getTemplateUrl();\n            scope.dataIn = modalService.dataIn;\n            scope.force = modalService.force;\n            if (newValue) {\n              element[0].classList.add('emuwebapp-modal-open');\n            } else {\n              element[0].classList.remove('emuwebapp-modal-open');\n            }\n          }\n        });\n        scope.$watch('modal.templateUrl', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.templateUrl = newValue;\n            scope.dataIn = modalService.dataIn;\n            scope.force = modalService.force;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.modalService\n * @description\n * # modalService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('modalService', [\n  '$q',\n  'ArrayHelperService',\n  'viewState',\n  function modalService($q, ArrayHelperService, viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.isOpen = false;\n    sServObj.templateUrl = '';\n    sServObj.defer = undefined;\n    sServObj.deferChange = undefined;\n    sServObj.force = false;\n    sServObj.dataOut = undefined;\n    sServObj.dataIn = undefined;\n    sServObj.dataExport = undefined;\n    /**\n\t\t * open modal normally\n\t\t */\n    sServObj.open = function (template, param1, param2, force) {\n      if (param1 !== undefined) {\n        sServObj.dataIn = param1;\n        if (param1.y !== undefined) {\n          sServObj.dataIn.chartData = ArrayHelperService.convertArrayToXYjsoArray(param1.y);\n        }\n      }\n      if (param2 !== undefined) {\n        sServObj.dataExport = param2;\n      }\n      if (force !== undefined) {\n        // force user to do sth\n        sServObj.force = force;\n      }\n      sServObj.defer = $q.defer();\n      sServObj.templateUrl = template;\n      viewState.setState('modalShowing');\n      sServObj.isOpen = true;\n      return sServObj.defer.promise;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.changeModal = function (template, param1, param2, force) {\n      if (param1 !== undefined) {\n        sServObj.dataIn = param1;\n      }\n      if (param2 !== undefined) {\n        sServObj.dataExport = param2;\n      }\n      if (force !== undefined) {\n        // force user to do sth\n        sServObj.force = force;\n      }\n      sServObj.deferChange = $q.defer();\n      sServObj.templateUrl = template;\n      return sServObj.deferChange.promise;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.error = function (msg) {\n      sServObj.dataIn = msg;\n      sServObj.templateUrl = 'views/error.html';\n      viewState.setState('modalShowing');\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.close = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      if (viewState.hierarchyShown) {\n        viewState.toggleHierarchy();\n      }\n      sServObj.defer.resolve(false);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.closeAndResolve = function (status) {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(status);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.confirm = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(true);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.select = function (idx) {\n      sServObj.closeAndResolve(idx);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.confirmContent = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(sServObj.dataOut);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getTemplateUrl = function () {\n      return sServObj.templateUrl;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('TabbedCtrl', [\n  '$scope',\n  'Websockethandler',\n  'viewState',\n  'ConfigProviderService',\n  'Validationservice',\n  'uuid',\n  'LevelService',\n  function ($scope, Websockethandler, viewState, ConfigProviderService, Validationservice, uuid, LevelService) {\n    // service shortcuts\n    $scope.cps = ConfigProviderService;\n    $scope.vs = viewState;\n    $scope.valid = Validationservice;\n    $scope.lvl = LevelService;\n    // definition shortcuts\n    $scope.levelDefinitionProperties = {};\n    $scope.linkDefinitionProperties = {};\n    $scope.spectroDefinitionProperties = {};\n    // selection properties for \"add signal canvases order\"\n    $scope.signalSelect = [];\n    // selection properties for \"add level canvases order\"\n    $scope.levelSelect = [];\n    // selection properties for \"add signal canvases order\"\n    $scope.twoDimSelect = [];\n    // default selection for \"add signal canvases order\"\n    $scope.addSignalSelect = '';\n    // default selection for \"add level canvases order\"\n    $scope.addLevelSelect = '';\n    // default selection for \"add two dim canvases order\"\n    $scope.addTwoDimSelect = '';\n    // user feedback after saving data\n    $scope.response = [];\n    // all available tabs\n    $scope.tabs = [\n      {\n        title: 'level definitions',\n        url: 'views/tabbed/levelDefinition.html'\n      },\n      {\n        title: 'link definitions',\n        url: 'views/tabbed/linkDefinition.html'\n      },\n      {\n        title: 'ssff track definitions',\n        url: 'views/tabbed/ssffDefinition.html'\n      },\n      {\n        title: '2D definitions',\n        url: 'views/tabbed/twoDimDefinition.html'\n      },\n      {\n        title: 'EMU-webApp',\n        url: 'views/tabbed/emuDefinition.html'\n      },\n      {\n        title: 'global DB',\n        url: 'views/tabbed/globalDefinition.html'\n      }\n    ];\n    $scope.cps = ConfigProviderService;\n    // current open tab\n    $scope.currentTabUrl = $scope.tabs[0].url;\n    $scope.onClickTab = function (tab) {\n      $scope.currentTabUrl = tab.url;\n    };\n    $scope.isActiveTab = function (tabUrl) {\n      if (tabUrl === $scope.currentTabUrl) {\n        return {\n          'background-color': ConfigProviderService.design.color.white,\n          'color': ConfigProviderService.design.color.black,\n          'font-family': ConfigProviderService.design.font.large.family,\n          'font-size': ConfigProviderService.design.font.large.size\n        };\n      }\n      return {\n        'background-color': ConfigProviderService.design.color.blue,\n        'color': ConfigProviderService.design.color.white,\n        'font-family': ConfigProviderService.design.font.large.family,\n        'font-size': ConfigProviderService.design.font.large.size\n      };\n    };\n    $scope.setup = function () {\n      // read db config file for enum types\n      var dbconfigFileSchema = $scope.valid.getSchema('DBconfigFileSchema');\n      var webappFileSchema = $scope.valid.getSchema('emuwebappConfigSchema');\n      $scope.levelDefinitionProperties = dbconfigFileSchema.data.properties.levelDefinitions.items.properties;\n      $scope.linkDefinitionProperties = dbconfigFileSchema.data.properties.linkDefinitions.items.properties;\n      $scope.spectroDefinitionProperties = webappFileSchema.data.properties.spectrogramSettings.properties;\n      $scope.resetSelections();\n    };\n    $scope.resetSelections = function () {\n      $scope.signalSelect = [\n        'OSCI',\n        'SPEC'\n      ];\n      $scope.levelSelect = [];\n      $scope.twoDimSelect = [];\n      angular.forEach($scope.cps.curDbConfig.ssffTrackDefinitions, function (td) {\n        $scope.signalSelect.push(td.name);\n      });\n      angular.forEach($scope.cps.curDbConfig.levelDefinitions, function (td) {\n        $scope.levelSelect.push(td.name);\n      });\n      // the following will be rewritten : !\n      $scope.twoDimSelect.push('under development');\n      ////////////////////////////////\n      $scope.addSignalSelect = $scope.signalSelect[0];\n      $scope.addLevelSelect = $scope.levelSelect[0];\n      $scope.addTwoDimSelect = $scope.twoDimSelect[0];\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.highlight = function (typeOfDefinition, key) {\n      var bg = { 'background-color': $scope.cps.design.color.lightGrey };\n      switch (typeOfDefinition) {\n      case 'level':\n        if ($scope.cps.curDbConfig.levelDefinitions[key].added === true) {\n          return bg;\n        }\n        break;\n      case 'ssff':\n        if ($scope.cps.curDbConfig.ssffTrackDefinitions[key].added === true) {\n          return bg;\n        }\n        break;\n      case 'link':\n        if ($scope.cps.curDbConfig.linkDefinitions[key].added === true) {\n          return bg;\n        }\n        break;\n      default:\n        return {};\n        break;\n      }\n      return {};\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.classBorderDefinition = function (typeOfDefinition, key) {\n      var style = 'emuwebapp-tabbed-border';\n      switch (typeOfDefinition) {\n      case 'level':\n        if ($scope.cps.curDbConfig.levelDefinitions[key].added === true) {\n          style = 'emuwebapp-tabbed-border highlight';\n        }\n        break;\n      case 'ssff':\n        if ($scope.cps.curDbConfig.ssffTrackDefinitions[key].added === true) {\n          style = 'emuwebapp-tabbed-border highlight';\n        }\n        break;\n      case 'link':\n        if ($scope.cps.curDbConfig.linkDefinitions[key].added === true) {\n          style = 'emuwebapp-tabbed-border highlight';\n        }\n        break;\n      }\n      return style;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveDefinition = function (typeOfDefinition, key, protocolParameter, data) {\n      var protocolData = angular.toJson(data, false);\n      var localData = data;\n      Websockethandler.getDoEditDBConfig().then(function (response) {\n        if (response === 'YES') {\n          var allowed = false;\n          switch (typeOfDefinition) {\n          case 'level':\n            if (localData.added === true) {\n              if (localData.name.length > 0) {\n                if ($scope.lvl.getLevelDetails(localData.name) === null) {\n                  if (localData.type !== '') {\n                    allowed = true;\n                  } else {\n                    $scope.showResponse(key, 'The level type is not set.');\n                  }\n                } else {\n                  $scope.showResponse(key, 'The level name \"' + localData.name + '\" already exists.');\n                }\n              } else {\n                $scope.showResponse(key, 'The level name \"' + localData.name + '\" is not valid.');\n              }\n            }\n            break;\n          case 'link':\n            if (localData.added === true) {\n              if (localData.superlevelName.length > 0) {\n                if (localData.sublevelName.length > 0) {\n                  if (localData.type !== '') {\n                    allowed = true;\n                  } else {\n                    $scope.showResponse(key, 'The level type is not set.');\n                  }\n                } else {\n                  $scope.showResponse(key, 'The sublevelName name \"' + localData.sublevelName + '\" is not valid.');\n                }\n              } else {\n                $scope.showResponse(key, 'The superlevelName name \"' + localData.superlevelName + '\" is not valid.');\n              }\n            }\n            break;\n          case 'ssff':\n            if (localData.added === true) {\n              if (localData.name.length > 0) {\n                if (localData.columnName.length > 0) {\n                  if (localData.fileExtension.length > 0) {\n                    allowed = true;\n                  } else {\n                    $scope.showResponse(key, 'The fileExtension \"' + localData.fileExtension + '\" already exists.');\n                  }\n                } else {\n                  $scope.showResponse(key, 'The columnName \"' + localData.columnName + '\" already exists.');\n                }\n              } else {\n                $scope.showResponse(key, 'The name \"' + localData.name + '\" is not valid.');\n              }\n            }\n            break;\n          }\n          if (allowed) {\n            Websockethandler.editDBConfig(protocolParameter, protocolData).then(function (response) {\n              if (response === 'YES') {\n                localData.added = undefined;\n                delete localData.added;\n                $scope.hideResponse(key);\n              } else {\n                $scope.showResponse(key, 'Error while communicating with server (' + protocolParameter + ').');\n              }\n            });\n          }\n        } else {\n          $scope.showResponse(key, 'Editing of Config is not allowed.');\n        }\n      });\n    };\n    $scope.showResponse = function (key, text) {\n      $scope.response[key] = {};\n      $scope.response[key].show = true;\n      $scope.response[key].text = text;\n    };\n    $scope.hideResponse = function (key) {\n      if ($scope.response[key] !== undefined) {\n        if ($scope.response[key].show === true) {\n          $scope.response[key].show = false;\n        }\n      }\n    };\n    $scope.addDefinition = function (typeOfDefinition, key, keyAttribute) {\n      switch (typeOfDefinition) {\n      case 'level':\n        $scope.cps.curDbConfig.levelDefinitions.push({\n          name: '',\n          type: '',\n          attributeDefinitions: [{\n              name: '',\n              type: 'STRING'\n            }],\n          added: true\n        });\n        break;\n      case 'levelattribute':\n        $scope.cps.curDbConfig.levelDefinitions[key].attributeDefinitions.push({\n          name: '',\n          type: 'STRING',\n          legalLabels: []\n        });\n        break;\n      case 'link':\n        $scope.cps.curDbConfig.linkDefinitions.push({\n          type: '',\n          superlevelName: '',\n          sublevelName: '',\n          added: true\n        });\n        break;\n      case 'ssff':\n        $scope.cps.curDbConfig.ssffTrackDefinitions.push({\n          name: '',\n          columnName: '',\n          fileExtension: '',\n          added: true\n        });\n        break;\n      case 'perspective':\n        $scope.cps.vals.perspectives.push({\n          name: '',\n          signalCanvases: {\n            order: [],\n            assign: [],\n            contourLims: [],\n            contourColors: []\n          },\n          levelCanvases: { order: [] },\n          twoDimCanvases: { order: [] }\n        });\n        break;\n      case 'perspectiveAssign':\n        $scope.cps.vals.perspectives[key].signalCanvases.assign.push({\n          signalCanvasName: '',\n          ssffTrackName: ''\n        });\n        break;\n      case 'perspectiveContourColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors.push({\n          colors: ['rgba(0,0,0,1)'],\n          ssffTrackName: ''\n        });\n        break;\n      case 'perspectiveContourColorColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors[keyAttribute].colors.push('rgba(0,0,0,1)');\n        break;\n      case 'perspectiveContourLims':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourLims.push({\n          ssffTrackName: '',\n          minContourIdx: 0,\n          maxContourIdx: 1\n        });\n        break;\n      case 'perspectiveOrderSignal':\n        $scope.cps.vals.perspectives[key].signalCanvases.order.push(keyAttribute);\n        break;\n      case 'perspectiveOrderLevel':\n        $scope.cps.vals.perspectives[key].levelCanvases.order.push(keyAttribute);\n        break;\n      case 'perspectiveOrderTwoDim':\n        $scope.cps.vals.perspectives[key].twoDimCanvases.order.push(keyAttribute);\n        break;\n      }\n    };\n    $scope.deleteDefinition = function (typeOfDefinition, key, keyAttribute, subKeyAttribute) {\n      switch (typeOfDefinition) {\n      case 'level':\n        $scope.cps.curDbConfig.levelDefinitions.splice(key, 1);\n        break;\n      case 'levelattribute':\n        $scope.cps.curDbConfig.levelDefinitions[key].attributeDefinitions.splice(keyAttribute, 1);\n        break;\n      case 'link':\n        $scope.cps.curDbConfig.linkDefinitions.splice(key, 1);\n        break;\n      case 'ssff':\n        $scope.cps.curDbConfig.ssffTrackDefinitions.splice(key, 1);\n        break;\n      case 'perspective':\n        $scope.cps.vals.perspectives.splice(key, 1);\n        break;\n      case 'perspectiveAssign':\n        $scope.cps.vals.perspectives[key].signalCanvases.assign.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveContourColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveContourColorColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors[keyAttribute].colors.splice(subKeyAttribute, 1);\n        break;\n      case 'perspectiveContourLims':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourLims.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveOrderSignal':\n        $scope.cps.vals.perspectives[key].signalCanvases.order.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveOrderLevel':\n        $scope.cps.vals.perspectives[key].levelCanvases.order.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveOrderTwoDim':\n        $scope.cps.vals.perspectives[key].twoDimCanvases.order.splice(keyAttribute, 1);\n        break;\n      }\n    };\n    $scope.setup();\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('TabbedHelpCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  function ($scope, ConfigProviderService, Iohandlerservice) {\n    $scope.cps = ConfigProviderService;\n    $scope.tree = [];\n    Iohandlerservice.httpGetPath('manual/index.json').then(function (resp) {\n      $scope.tree = resp.data;\n      console.log($scope.tree);\n      // load root element\n      $scope.onClickTab($scope.tree[0]);\n      // expand root element\n      $scope.tree[0].expanded = true;\n    });\n    $scope.onClickTab = function (node) {\n      node.expanded = !node.expanded;\n      if (node.url !== false) {\n        if (node.url.substr(node.url.lastIndexOf('.') + 1).toLowerCase() === 'md') {\n          $scope.isMDFile = true;\n          $scope.currentTabUrl = node.url;\n        } else {\n          $scope.isMDFile = false;\n          $scope.currentTabUrl = node.url;\n        }\n      }\n    };\n    $scope.hasChildren = function (node) {\n      if (node.nodes !== undefined) {\n        if (node.nodes.length > 0) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HierarchyManipulationService', [\n  '$q',\n  'HierarchyLayoutService',\n  'DataService',\n  'LevelService',\n  'ConfigProviderService',\n  'ArrayHelperService',\n  function HierarchyManipulationService($q, HierarchyLayoutService, DataService, LevelService, ConfigProviderService, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * Add a new link if it is valid and goes along the specfied path\n\t\t *\n\t\t * If the specified link is invalid but its reverse is valid,\n\t\t * the reverse is added.\n\t\t *\n\t\t * @param path The current path through the hierarchy\n\t\t * @param from ID of the source item\n\t\t * @param to ID of the target item\n\t\t *\n\t\t * @return the link object that was added ({fromID: x, toID: y})\n\t\t * @return null if no link was added\n\t\t */\n    sServObj.addLink = function (path, from, to) {\n      var validity = sServObj.checkLinkValidity(path, from, to);\n      if (validity.valid) {\n        var obj = {\n            fromID: from,\n            toID: to\n          };\n        DataService.insertLinkData(obj);\n        return obj;\n      } else {\n        console.debug('Not adding invalid link:', from, '->', to, ' (Error code:', validity.reason, ')');\n        if (validity.reason === 3) {\n          validity = sServObj.checkLinkValidity(path, to, from);\n          if (validity.valid) {\n            console.debug('Adding reverse link instead');\n            var obj = {\n                fromID: to,\n                toID: from\n              };\n            DataService.insertLinkData(obj);\n            return obj;\n          } else {\n            return null;\n          }\n        } else {\n          return null;\n        }\n      }\n    };\n    /**\n\t\t * Test whether a link to be added would be valid\n\t\t *\n\t\t * Requirements for validity:\n\t\t * - No cross-over links\n\t\t * - Meet limitations defined by DBconfig.linkDefinitions\n\t\t * -- Only along the hierarchy's direction\n\t\t * - Only within the currently selected (and visualised) path\n\t\t * - No multiply defined links\n\t\t *\n\t\t * @param path Currently selected path (form: [..., 'level2name', 'level1name'])\n\t\t * @param from ID of the source item\n\t\t * @param to ID of the target item\n\t\t *\n\t\t * @return object with state and reason properties\n\t\t * reason may be one of:\n\t\t * 0: no error\n\t\t * 1: from and to are the same\n\t\t * 2: link already exists\n\t\t * 3: link does not meet the requirements of DBconfig.linkDefinitions (no link between its levels)\n\t\t * 4: link does not meet the requirements of DBconfig.linkDefinitions (link type not satisified)\n\t\t * 5: link would cross another link\n\t\t **/\n    sServObj.checkLinkValidity = function (path, from, to) {\n      var result = {\n          valid: true,\n          reason: 0\n        };\n      var links = DataService.getLinkData();\n      // This case (from === to)  would also be caught below\n      // during linkDefinitions check. I treat it separately\n      // anyway because the current GUI implementation kindly\n      // facilitates this kind of error and I can therefore\n      // offer a 0.0000001 % increase in speed here :-)\n      if (from === to) {\n        result.valid = false;\n        result.reason = 1;\n        return result;\n      }\n      // Check whether link already exists\n      for (var i = 0; i < links.length; ++i) {\n        if (links[i].fromID === from && links[i].toID === to) {\n          result.valid = false;\n          result.reason = 2;\n          return result;\n        }\n      }\n      // Check whether link is within the currently selected\n      // path (which implies that the DBconfig.linkDefinitions\n      // are met, apart from the link type that is specified\n      // there\n      var superlevelName = LevelService.getLevelName(from);\n      var sublevelName = LevelService.getLevelName(to);\n      var superlevelIndex = path.indexOf(superlevelName);\n      if (path[superlevelIndex - 1] !== sublevelName) {\n        result.valid = false;\n        result.reason = 3;\n        return result;\n      }\n      // Check link type\n      var linkType;\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === sublevelName && ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName === superlevelName) {\n          linkType = ConfigProviderService.curDbConfig.linkDefinitions[i].type;\n        }\n      }\n      if (linkType === undefined) {\n        consle.debug('LIKELY A BUG: link to be added (', from, '->', to, ') has been found to be a part of the currently selected path but the link between the respective levels could not be found.');\n        result.valid = false;\n        result.reason = 3;\n        return result;\n      }\n      // Type can be one of 'MANY_TO_MANY', 'ONE_TO_MANY', 'ONE_TO_ONE'\n      // this is defined in schemaFiles/DBconfigFileSchema.json\n      //\n      // In case it is MANY_TO_MANY, the link is always valid\n      //\n      if (linkType === 'ONE_TO_MANY' || linkType === 'ONE_TO_ONE') {\n        var toElement = LevelService.getItemByID(to);\n        if (toElement._parents.length > 0) {\n          result.valid = false;\n          result.reason = 4;\n          return result;\n        }\n      }\n      if (linkType === 'ONE_TO_ONE') {\n        var fromElement = LevelService.getItemByID(from);\n        var children = HierarchyLayoutService.findChildren(fromElement, path);\n        if (children.length > 0) {\n          result.valid = false;\n          result.reason = 4;\n          return result;\n        }\n      }\n      //////\n      // Check for crossover links\n      //\n      // We'll try to find the first and last position in the sublevel\n      // where the supposed link's parent can have children.\n      //\n      // First, we'll check the preceding sibling of that parent node.\n      // Its last child node is the first one that can be a child of the\n      // supposed parent node.\n      // Note that if the sibling has no children, we have to skip it and\n      // check the next sibling.\n      //\n      // Next, we'll chek the siblings that come after the supposed\n      // parent node. Their first child is the last one that can be a\n      // child of the supposed parent.\n      //\n      var firstAllowedChildIndex = undefined;\n      var lastAllowedChildIndex = undefined;\n      var superlevel = LevelService.getLevelAndItem(from).level;\n      var sublevel = LevelService.getLevelAndItem(to).level;\n      var parentOrder = LevelService.getOrderById(superlevelName, from);\n      var childOrder = LevelService.getOrderById(sublevelName, to);\n      var siblingRelativeIndex = 0;\n      var sibling;\n      while (firstAllowedChildIndex === undefined) {\n        siblingRelativeIndex -= 1;\n        sibling = superlevel.items[parentOrder + siblingRelativeIndex];\n        if (sibling === undefined) {\n          firstAllowedChildIndex = 0;\n          break;\n        }\n        console.debug('found preceding sibling', sibling.id, sibling.labels[0]);\n        var children = HierarchyLayoutService.findChildren(sibling, path);\n        for (var i = 0; i < children.length; ++i) {\n          var index = LevelService.getOrderById(sublevelName, children[i].id);\n          if (firstAllowedChildIndex === undefined || index > firstAllowedChildIndex) {\n            firstAllowedChildIndex = index;\n          }\n        }\n      }\n      siblingRelativeIndex = 0;\n      while (lastAllowedChildIndex === undefined) {\n        siblingRelativeIndex += 1;\n        sibling = superlevel.items[parentOrder + siblingRelativeIndex];\n        if (sibling === undefined) {\n          lastAllowedChildIndex = sublevel.items.length - 1;\n          break;\n        }\n        console.debug('found successive sibling', sibling.id, sibling.labels[0]);\n        var children = HierarchyLayoutService.findChildren(sibling, path);\n        if (children.length === 0) {\n          continue;\n        }\n        for (var i = 0; i < children.length; ++i) {\n          var index = LevelService.getOrderById(sublevelName, children[i].id);\n          if (lastAllowedChildIndex === undefined || index < lastAllowedChildIndex) {\n            lastAllowedChildIndex = index;\n          }\n        }\n      }\n      console.debug('child must be within', firstAllowedChildIndex, lastAllowedChildIndex);\n      if (childOrder < firstAllowedChildIndex || childOrder > lastAllowedChildIndex) {\n        result.valid = false;\n        result.reason = 5;\n        return result;\n      }\n      // No error found - returning success object\n      return result;\n    };\n    return sServObj;\n  }\n]);\n/**\n * This service holds general helper functions that do not depend on any of the\n * EMU components.\n */\n'use strict';\nangular.module('emuwebApp').service('StandardFuncsService', function () {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t * Recursively looks at all properties of a given object and\n\t\t * removes any whose name starts with an underscore\n\t\t *\n\t\t * @param o The object to traverse\n\t\t * @returns nothing\n\t\t */\n  sServObj.traverseAndClean = function (o) {\n    for (var i in o) {\n      if (i.substr(0, 1) === '_') {\n        delete o[i];\n      }\n      if (o[i] !== null && typeof o[i] === 'object') {\n        // Go one step down in the object tree\n        sServObj.traverseAndClean(o[i]);\n      }\n    }\n  };\n  /**\n\t\t * Return a reversed copy of an array\n\t\t */\n  sServObj.reverseCopy = function (a) {\n    var r = angular.copy(a);\n    r.reverse();\n    return r;\n  };\n  return sServObj;\n});\n'use strict';\n/**\n * @ngdoc filter\n * @name emuwebApp.filter:startFromFilter\n * @function\n * @description\n * # startFromFilter\n * Filter in the emuwebApp.\n */\nangular.module('emuwebApp').filter('startFrom', function () {\n  return function (input, start) {\n    start = +start;\n    //parse to int\n    return input.slice(start);\n  };\n});\n'use strict';\n/**\n * @ngdoc function\n * @name emuwebApp.controller:ManualctrlCtrl\n * @description\n * # ManualctrlCtrl\n * Controller of the emuwebApp\n */\nangular.module('emuwebApp').controller('ManualCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  function ($scope, ConfigProviderService) {\n    $scope.listOfMarkdownFiles = [\n      {\n        title: 'Introduction',\n        url: 'manual/Introduction.md'\n      },\n      {\n        title: 'EMU-webApp-websocket-protocol',\n        url: 'manual/EMU-webApp-websocket-protocol.md'\n      },\n      {\n        title: 'Labeling articulatory data',\n        url: 'manual/Labeling-articulatory-data.md'\n      }\n    ];\n    $scope.curMdFile = $scope.listOfMarkdownFiles[0];\n    $scope.setCurrentMdFile = function (mdFile) {\n      $scope.curMdFile = mdFile;\n    };\n    $scope.isCurrentMdFile = function (tabUrl) {\n      console.log(tabUrl);\n      console.log($scope.curMdFile.url);\n      if (tabUrl === $scope.curMdFile.url) {\n        return {\n          'background-color': ConfigProviderService.design.color.white,\n          'color': ConfigProviderService.design.color.black,\n          'font-weight': '500'\n        };\n      }\n      return {\n        'background-color': ConfigProviderService.design.color.blue,\n        'color': ConfigProviderService.design.color.white,\n        'font-weight': '400'\n      };\n    };\n  }\n]);"]}