{"version":3,"file":"emuwebApp.min.js","sources":["emuwebApp.min.js"],"names":["wavParserWorker","Worker","window","this","url","getWorkerURL","worker","espsParserWorker","textGridParserWorker","spectroDrawingWorker","ssffParserWorker","ArrayBuffer","prototype","subarray","offset","length","sub","subView","Int8Array","thisView","i","angular","module","config","$locationProvider","html5Mode","service","$q","viewState","sServObj","vals","design","curDbConfig","initDbConfig","embeddedVals","audioGetUrl","labelGetUrl","labelType","fromUrlParams","setDesign","data","copy","setVals","$","isEmptyObject","forEach","Object","keys","key1","isArray","itm","push","key2","undefined","console","error","getDelta","current","defer","ret","getDeltas","resolve","promise","start","value","key","equals","Array","getSsffTrackConfig","name","res","ssffTrackDefinitions","tr","getLimsOfTrack","trackName","perspectives","curPerspectiveIdx","signalCanvases","contourLims","cL","ssffTrackName","getContourColorsOfTrack","contourColors","cC","getAssignment","signalName","assign","a","signalCanvasName","getLevelDefinition","levelName","levelDefinitions","ld","setPerspectivesOrder","curPerspective","levelCanvases","order","getStrRep","code","str","String","fromCharCode","controller","$scope","$rootScope","$log","$compile","$timeout","$window","$document","$location","HistoryService","Iohandlerservice","Soundhandlerservice","ConfigProviderService","fontScaleService","Ssffdataservice","LevelService","Textgridparserservice","Espsparserservice","Binarydatamaniphelper","Wavparserservice","Ssffparserservice","Drawhelperservice","Validationservice","Appcachehandler","loadedMetaDataService","dbObjLoadSaveService","appStateService","DataService","modalService","browserDetector","cps","hists","fontImage","levServ","dataServ","vs","ssffds","shs","dhs","wps","io","ach","lmds","connectBtnLabel","tmp","dbLoaded","is2dCancasesHidden","windowWidth","outerWidth","internalVars","showAboutHint","checkForNewVersion","element","bind","deleteEditArea","setWindowWidth","hierarchyState","isShown","resize","$digest","e","keyCode","keyMappings","shift","alt","addCurChangeObjToUndoStack","focusOnEmuWebApp","onbeforeunload","getBundleList","main","autoConnect","$on","event","args","resetToInitState","loadDefaultConfig","somethingInProgressTxt","somethingInProgress","wsH","initConnect","then","message","type","open","handleConnectedToWSserver","errMess","JSON","stringify","searchObject","search","loadFilesForEmbeddedApp","activeButtons","openDemoDB","httpGetPath","showDropZone","setCurBndlName","substr","lastIndexOf","getsubmenuOpen","toggleSubmenu","animation","period","DBconfigGetUrl","resp","EMUwebAppConfig","validRes","validateJSO","catchMouseForKeyBinding","parseWavArrBuf","messWavParser","wavJSO","curViewPort","sS","eS","Data","resetSelect","data2","parseLabelFile","parseMess","annot","setData","lNames","levelDefs","levels","l","attributeDefinitions","setCurLevelAttrDefs","setState","status","loadSchemas","replies","setSchemas","httpGetDefaultDesign","success","httpGetDefaultConfig","handleDefaultConfigLoaded","checkIfToShowWelcomeModal","header","argument","curVal","localStorage","getItem","isBrowser","PhantomJS","setItem","getCurBndlName","serverUrl","session","reload","setspectroSettings","spectrogramSettings","windowSizeInSecs","rangeFrom","rangeTo","dynamicRange","drawHeatMapColors","preEmphasisFilterFactor","heatMapColorAnchors","setTransitionTime","comMode","getProtocol","protocol","version","getDoUserManagement","doUsrData","innerHandleConnectedToWSserver","getDBconfigFile","bdata","setBundleList","clear","specSettings","loadBundle","openCollapseSession","toggleCollapseSession","ses","uniqSessionList","collapsed","getEnlarge","index","len","large","getenlarge","cursorInTextField","setcursorInTextField","cursorOutOfTextField","addLevelSegBtnClick","getPermission","newName","level","items","getCurAttrDef","leveldef","insertLevel","addObjToUndoStack","action","id","selectLevel","addLevelPointBtnClick","renameSelLevelBtnClick","getcurClickLevelName","downloadTextGridBtnClick","asyncToTextGrid","replace","getCurBndl","downloadAnnotationBtnClick","getData","toJson","spectSettingsBtnClick","connectBtnClick","openDemoDBbtnClick","nameOfDB","dropdown","setDemoDbName","err","aboutBtnClick","showHierarchyBtnClick","toggleHierarchy","showEditDBconfigBtnClick","delta","saveConfiguration","movesAwayFromLastSave","reloadToInitState","clearBtnClick","modalText","cmdZoomAll","setViewPort","cmdZoomIn","zoomViewPort","cmdZoomOut","cmdZoomLeft","shiftViewPort","cmdZoomRight","cmdZoomSel","selectS","selectE","cmdPlayView","playFromTo","animatePlayHead","cmdPlaySel","cmdPlayAll","changePerspective","persp","newIdx","setRightsubmenuOpen","getRightsubmenuOpen","getPerspectiveColor","cl","directive","$animate","templateUrl","restrict","scope","idx","link","attr","canvas","find","modal","levelCanvasContainer","levelDef","backgroundCanvas","background","color","lightGrey","$watch","newValue","oldValue","redraw","drawLevelDetails","drawLevelMarkup","getcurMouseLevelName","curMouseLevelName","changeCurAttrDef","attrDefName","curAttrDef","setCurAttrDef","hasClass","setEditing","addClass","removeClass","getAttrDefBtnColor","curColor","background-color","updateView","setcurMouseItem","fontSize","font","small","size","slice","isOpen","parent","css","ctx","getContext","clearRect","width","height","sDist","posS","posE","getSampleDist","scaleY","offsetHeight","drawUndistortedTextTwoLines","family","black","drawUndistortedText","curID","getcurMouseItem","getcurClickItems","mTxtImgWidth","measureText","scaleX","zeroTxtImgWidth","fillStyle","curEvt","sampleStart","sampleDur","curLabVal","labels","lab","getPos","fillRect","grey","labelCenter","hlY","strokeStyle","beginPath","moveTo","lineTo","stroke","toString","durtext","perc","samplePoint","Math","round","transparent","drawMovingBoundaryLine","drawCurViewPortSelected","xOffset","segMId","isFirst","getcurMouseisFirst","isLast","getcurMouseisLast","clickedSegs","levelId","cs","yellow","blue","getcurMouseLevelType","changeAttrDef","attrs","canvasLength","markupCanvas","drawVpOsciMarkup","duration","drawPlayHead","allPeakVals","calculatePeaks","osciPeaks","freshRedrawDrawOsciOnCanvas","playHeadAnimationInfos","posCur","curS","reset","drawViewPortTimes","currentBundleName","initialized","border","newVal","oldVal","drawPreview","ctxMarkup","closePath","comment","finishedEditing","finished","updateHistory","bundle","updateCurChangeObj","initial","endHistory","startHistory","mathHelperService","canvas0","canvas1","context","markupCtx","alpha","devicePixelRatio","primeWorker","clearAndDrawSpectMarkup","setupEvent","drawSpectro","buffer","killSpectroRenderingThread","startSpectroRenderingThread","calcSamplesPerPxl","drawSpectMarkup","drawMinMaxAndName","spectroSettings","kill","imageData","createImageData","says","samplesPerPxl","Uint8ClampedArray","img","set","putImageData","parseData","fftN","calcClosestPowerOf2Gt","SampleRate","leftPadding","rightPadding","windowSizeInSamples","paddedSamples","Float32Array","tell","upperFreq","lowerFreq","imgWidth","imgHeight","dynRangeInDB","pixelRatio","sampleRate","transparency","audioBuffer","audioBufferChannels","NumChannels","firefox","Firefox","getBlob","blob","Blob","dataExport","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","exportData","updateHistoryService","objURL","URL","webkitURL","createObjectURL","SaveToDisk","dataIn","close","fileURL","fileName","save","document","createElement","setAttribute","href","innerHTML","style","display","body","appendChild","click","target","download","createEvent","initEvent","dispatchEvent","revokeObjectURL","factory","StandardFuncsService","myWindow","BARTLETT","BARTLETTHANN","BLACKMAN","COSINE","GAUSS","HAMMING","HANN","LANCZOS","RECTANGULAR","TRIANGULAR","myMode","DEMO","WS","EMBEDDED","myTimeMode","absolute","relative","mySignalType","OSCI","SPEC","myTwoDimType","DOTS","EPG","curLevelAttrDefs","initialize","movingS","movingE","dragBarActive","dragBarHeight","endFreezeSample","hierarchyShown","selectedItemID","selectedLinkFromID","selectedLinkToID","editValue","inputFocus","collapseInfo","scaleFactor","translate","contextMenuID","newLinkFromID","path","rotated","playing","contextMenuIsOpen","closeContextMenu","getContextMenuID","setContextMenuID","getInputFocus","setInputFocus","f","getEditValue","setEditValue","isRotated","toggleRotation","traverseAndClean","getCollapsed","getCollapsePosition","collapsePosition","getNumCollapsedParents","numCollapsedParents","setCollapsed","newState","setCollapsePosition","newPosition","setNumCollapsedParents","newNum","timelineSize","historyActionTxt","editing","saving","submenuOpen","rightSubmenuOpen","curClickItems","curMousePosSample","curMouseLevelType","curClickLevelName","curClickLevelType","lastPcm","curPreselColumnSample","curCorrectionToolNr","curClickLevelIndex","TransitionTime","movingBoundary","movingBoundarySample","focusInTextField","curTaskPercCompl","mouseInEmuWebApp","lastKeyCode","lastUpdate","pageSize","currentPage","states","noDBorFilesloaded","permittedActions","loadingSaving","labeling","modalShowing","prevState","curState","actionName","indexOf","b","nameOrObj","updatePlayHead","timestamp","isPlaying","requestAnimationFrame","samplesPassed","floor","$apply","startS","endS","select","end","getViewPort","rfrom","rto","dyn","win","hm","preEmph","hmColorAnchors","parseInt","setWindowFunction","getSelect","selectDependent","next","Levelserv","curLev","now","getLevelDetails","setcurClickLevel","idxOfNow","selectBoundary","getWindowFunctions","getCommunicationModes","getTimeModes","getSignalTypes","getTwoDimTypes","getdragBarActive","setdragBarActive","getdragBarHeight","setdragBarHeight","w","s","time","d","Date","getTime","setsubmenuOpen","setenlarge","getTransitionTime","levelID","levelType","levelIndex","setcurClickLevelName","setcurClickLevelType","getcurClickLevelType","getcurClickLevelIndex","getcurClickNeighbours","curClickNeighbours","setcurMouseLevelName","setcurMouseLevelType","item","neighbour","x","curMouseItem","curMouseX","curMouseNeighbours","curMouseisFirst","curMouseisLast","getcurMouseNeighbours","getItemsInSelection","levelData","itemsInRange","rangeStart","rangeEnd","t","sort","sortbystart","setcurClickItem","left","right","entry","setcurClickItemMultiple","getselectedRange","getselected","isEditing","n","getLasPcm","setLastPcm","getcursorInTextField","isSavingAllowed","setSavingAllowed","countSelected","getCurrentSample","getCurrentPercent","sample","getSamplesPerPixelVal","parseFloat","originalEvent","getViewPortStartTime","getViewPortEndTime","getSelectedStartTime","getSelectedEndTime","sSample","eSample","oldStart","oldEnd","abs","zoomIn","newStartS","newEndS","curMouseMoveItemStart","seg","isLastSeg","getItemDetails","getLastItem","d1","d2","shiftRight","curAttrDefName","newAttrDefName","ad","curAttrDefIndex","getCurAttrIndex","setlastKeyCode","getX","offsetX","layerX","clientWidth","getY","offsetY","layerY","clientHeight","getColorOfAnchor","val","anchorNr","curStyle","numberOfPages","sessionLength","ceil","lastEventClick","lastEventMove","lastNeighboursMove","lastPCM","curMouseSampleNrInView","trackMouseInLevel","preventDefault","setLastMove","setLastClick","setLastRightClick","restrictions","editItemName","setLastDblClick","moveLine","samplesPerPixel","moveBy","zoomEventMove","getClosestItem","lastItem","getItemFromLevelById","nearest","mbutton","buttons","which","editItemSize","shiftKey","moveBoundary","movedBy","moveEvent","altKey","moveSegment","setlasteditArea","setlasteditAreaElem","getItemInTime","prev","$index","openEditArea","doChange","getItemNeighboursFromLevel","HierarchyManipulationService","LinkService","AnagestService","applyKeyCodeUp","applyKeyCode","esc","createNewItemAtSelection","domElement","getlasteditArea","curAttrIndex","lvlDefs","definitions","legalLabels","hierarchyCommitEdit","elementID","getItemByID","getLevelName","attrIndex","renameLabel","hierarchyCancelEdit","hierarchyDeleteLink","hierarchyPlayback","log","hierarchyRotate","pos","deleteLink","fromID","toID","position","hierarchyDeleteItem","result","deleteItemWithLinks","deletedLinks","hierarchyAddItemBefore","newID","addItem","neighborID","before","hierarchyAddItemAfter","undo","redo","showHierarchy","stopPropagation","editingElement","getlastID","force","zoomAll","zoomOut","zoomSel","shiftViewPortLeft","shiftViewPortRight","playEntireFile","playback","playAllInView","playSelected","selectFirstContourCorrectionTool","correctionTool","selectSecondContourCorrectionTool","selectThirdContourCorrectionTool","selectFourthContourCorrectionTool","selectNoContourCorrectionTool","levelUp","levelDown","snapBoundaryToNearestTopBoundary","mouseSeg","neighbor","minDist","snapBoundary","snapBoundaryToNearestBottomBoundary","snapBoundaryToNearestZeroCrossing","dist","calcDistanceToNearestZeroCrossing","levelname","expandSelSegmentsRight","changeTime","labelCanvasConfig","addTimeValue","addTimeMode","expandSegment","rightSide","expandSelSegmentsLeft","shrinkSelSegmentsLeft","shrinkSelSegmentsRight","toggleSideBarLeft","openMenu","toggleSideBarRight","selectItemsInSelection","selPrevItem","neighbours","selNextItem","selNextPrevItem","idLeft","idRight","confirmContent","getlasteditAreaElem","insSeg","insertSegment","newSegmentName","ids","segName","anagestConfig","insPoint","insertEvent","newEventName","alreadyExists","pointName","insertAnagestEvents","deletePreselBoundary","cseg","deleteItem","deletedSegment","deleteSegments","deleteLinkSegment","segments","clickSeg","deleteItemBoundary","deleteBoundary","deleteLinkBoundary","neighbourId","deletedPoint","deleteEvent","metaKey","ctrlKey","safeApply","fn","phase","$root","$$phase","off","elem","elemHeight","deleteButton","children","saveButton","deleteSingleLevel","hide","saveSingleLevel","show","enlarge","asyncParseJSO","slideDuration","slideToggleDuration","stop","slideToggle","newIsOpenVal","oldIsOpenVal","startPCM","$http","Websockethandler","DragnDropDataService","prom","get","respType","responseType","getProm","alert","logOnUser","pwd","getBundle","saveBundle","bundleData","configData","string","annotates","fileType","asyncParseEsps","asyncParseTextGrid","def","fromJson","initAudioContext","AudioContext","webkitAudioContext","audioContext","curSource","decodeAndPlay","decodeAudioData","ab","createBufferSource","connect","destination","onended","extractRelPartOfWav","endSample","bytePerSample","BitsPerSample","headerSize","Subchunk1Size","origArrBuf","dv","DataView","Subchunk2SizePos","setUint32","newData","Uint8Array","byteLength","cutWavBuff","atts","ssffTrackname","assTrackName","lastDraw","$observe","handleUpdate","ass","col","getColumnOfTrack","columnName","sRaSt","getSampleRateAndStartTimeOfTrack","minMaxLims","drawValues","startTime","sR","sT","minVal","maxVal","_minVal","_maxVal","startTimeVP","endTimeVP","colStartSampleNr","colEndSampleNr","nrOfSamples","curSampleArrs","values","y","curSampleInCol","curSampleInColTime","contourVal","contourNr","minContourIdx","maxContourIdx","contColors","colors","green","leftBorder","leftVal","curArr","curArrIdx","arc","PI","rightBorder","rightVal","offsetWidth","red","reject","asyncParseSsffArr","ssffArray","cmd","ssffArr","asyncJso2ssff","jso","curMouseSample","bundleName","switchMarkupContext","mouseX","curMouseTime","curMouseSampleTime","fill","updateObj","sampleBlockIdx","sampleIdx","setSelectDrag","leave","drawCrossHairs","getScale","scale","getScaleWidth","str1","str2","drawFrame","min","max","prevPeak","prevX","prevY","relData","samplePerPx","numberOfChannels","peaks","minPeak","Infinity","maxPeak","apply","call","curPxIdx","avrVal","c","sum","p","peak","hDbS","sNr","drawSampleNrs","strokeText","fillText","drawZeroLine","zeroLineY","drawTimeAndSamples","space","roundToNdigitsAfterDecPoint","mouseEvt","unit","trackname","mouseY","mouseFreq","tW","s1","s2","smallFontSize","th","sTime","eTime","applyChange","changeObj","applyOldVal","cur","setHistoryActionText","setBndlComment","setBndlFinished","renameLevel","newname","deleteLevel","deleteBoundaryInvers","deleteSegmentsInvers","insertLinksTo","deleteLinksTo","deleteLinkBoundaryInvers","deleteLinkSegmentInvers","insertSegmentInvers","parentID","childIDs","insertLinkAt","deleteItemWithLinksInvers","addItemInvers","insertLink","pushNewItem","undoStack","redoStack","curChangeObj","dataObj","dataKey","info","obj","tmpObj","oldChangeObj","pop","getNrOfPossibleUndos","getCurrentStack","isUndo","text","front","buf","buffLength","textGrid","rand","random","newHash","empty","isMobile","Android","navigator","userAgent","match","BlackBerry","iOS","Opera","Windows","any","Chrome","InternetExplorer","Safari","HTMLElement","isMobileDevice","isDesktopDevice","lastTextWidth","spaceTop","ctxOriginal","fontPxSize","fontType","restore","text2","alignLeft","esps","loginData","username","password","errorMsg","tryLogin","confirm","cancel","getFile","std","fileExtension","file","Columns","calculateSamplePosInVP","colSampleNr","sampleTime","audioSample","maxItemID","setLevelData","getLevelData","getLevelOrder","getLevelDataAt","insertLevelDataAt","newLevel","splice","deleteLevelDataAt","getLinkData","links","setLinkData","insertLinkData","newLink","deleteLinkDataAt","insertLinkDataAt","changeLinkDataAt","fromNewID","toNewID","getNewId","raiseId","amount","lowerId","ArrayHelperService","getLabelIdx","labelIdx","lasteditArea","lasteditAreaElem","getLevelsByType","types","getOrderById","num","getIdByOrder","details","getNextItem","after","timeDifference","startItem","myStart","getAllLabelsOfLevel","levelDetails","map","nodeID","getLevelAndItem","getItemsFromLevelByIdAndLength","lastID","j","segment","remove","clientOffset","offsetLeft","top","offsetTop","editText","createEditAreaElement","createSelection","field","createTextRange","selRange","collapse","moveStart","moveEnd","setSelectionRange","selectionStart","selectionEnd","focus","label","labelid","textid","prepend","class","ng-model","autofocus","padding-top","insertItemDetails","labelname","newElement","attrdefs","updateSegment","updatePoint","firstid","lastid","sampleNr","maximum","spaceLower","spaceHigher","evt","lvl","originalLevel","newLabelName","oldname","insertPoint","lastNeighbours","timeRight","timeLeft","firstSegment","firstOrder","lastSegment","deleteOrder","newLabel","diff2","startOrder","diff","startID","newStart","endID","last","toDelete","retOrder","retEvt","oldName","toTop","neighTd","absDist","sampleTarget","absMinDist","thisTd","tIdx","orig","ln","origRight","origLeft","isLinked","orderPoints","first","tempItem","allow","lastLength","distRight","distLeft","debug","newObject","eid","levelAndItem","posNew","posOld","ii","linkIdx","linkExists","hasParents","ID","hasChildren","toIDs","insertLinksFrom","fromIDs","deleteLinksFrom","getLinksTo","linkOrder","getLinksFrom","changeLinkTo","changeLinkFrom","linksTo","linksFrom","found","deleted","neighbourID","ord","uuid","wsonopen","connected","conPromise","wsonmessage","jsonMessage","listener","closeConnect","$broadcast","wsonerror","wsonclose","wasClean","sendRequest","request","callbackId","getCallbackId","callbacks","cb","callbackID","ws","send","tOutResp","serverTimeoutInterval","messageObj","hasOwnProperty","newUUID","WebSocket","onopen","onmessage","onerror","onclose","isConnected","userName","disconnectWarning","getDoEditDBConfig","editDBConfig","subtype","base64ToArrayBuffer","stringBase64","binaryString","atob","bytes","ascii","charCodeAt","arrayBufferToBase64","binary","btoa","appCache","applicationCache","handleUpdatereadyEvent","removeItem","swapCache","location","addEventListener","update","options","selWindowInfo","errorID","upperBoundary","modalVals","_fftN","_windowSizeInSamples","calcWindowSizeInSamples","calcFftN","calcWindowSizeVals","cssError","id2","htmlError","saveSpectroSettings","checkSpectroSettings","isNaN","filter","input","regex","patt","RegExp","toLowerCase","out","test","patt1","mySelect","saveChanges","discardChanges","saveURL","currentURLS","getURLs","dataOut","myUrls","urlData","parse","setCurrentURL","deleteURL","showMenu","showTwod","className","transclude","showTwoDimCans","template","panes","bottomRightResizePane","addPane","pane","setBottomRightResizePane","dragBottomRightResizePaneTopResizer","dragBottomRightResizePaneLeftResizer","dragBottomRightResizePaneCornerResizer","handler","pane1","pane2","pane3","bottomRightResizePaneTopResizer","bottomRightResizePaneLeftResizer","bottomRightResizePaneCornerResizer","pane1Min","minSize","pane2Min","dragSplitPaneResizer","drag","ev","scrollHeight","bounds","getBoundingClientRect","bottom","clientY","clientX","require","bgSplitterCtrl","typeclass","drawSsffTrackMarkup","el","dragIcon","src","generateURL","getURL","isActive","classList","add","div","querySelector","dataTransfer","setDragImage","effectAllowed","HierarchyLayoutService","vertical","selectedItem","selectedLink","newLinkSrc","vertOffsetX","vertOffsetY","transition","nodes","rotation","contextMenu","scaleExtent","panningLimit","allowCrossAxisZoom","allowCrossAxisPan","timeAxisStartPosition","timeAxisEndPosition","crossAxisStartPosition","crossAxisEndPosition","northernBoundary","southernBoundary","westernBoundary","easternBoundary","zoomTimeoutPromise","lastScaleFactor","historyService","render","rotate","play","selectItem","selectLink","zoom","limitPanning","zoomListener","svg","getOrientatedTransform","captionLayer","getOrientatedLevelCaptionLayerTransform","selectAll","getOrientatedLevelCaptionTransform","percentageAwayTimeAxis","percentageAwayCrossAxis","zoomInProgress","transform","factor","getOrientatedNodeTransform","getOrientatedLinkStrokeWidth","getOrientatedGhostLinkStrokeWidth","getNodeText","getLevelCaptionText","attributeDefinition","getOrientatedNodeCollapseText","getOrientatedTextTransform","getOrientatedTextAnchor","getOrientatedTextX","getOrientatedTextY","revArr","reverse","depthToX","getOrientatedAddItemButtonTransform","getOrientatedTimeLevelBackgroundTransform","getOrientatedTimeLevelBackgroundWidth","getOrientatedTimeLevelBackgroundHeight","getOrientatedMousePosition","mouse","getPath","_fromX","_fromY","_toY","_toX","getPreviewPath","from","_x","_y","to","getPreviewColor","validity","checkLinkValidity","valid","reason","getLabelLegalnessColor","dom","svgOnMouseMove","d3","svgOnClick","nodeOnClick","nodeOnPlayClick","nodeOnCollapseClick","toggleCollapse","nodeOnMouseOver","renderSelectionOnly","nodeOnInput","backgroundColor","nodeOnFocusIn","nodeOnFocusOut","linkOnMouseOver","addButtonOnClick","timeInfoLevel","currentItem","timeInfoType","startSample","itemList","concat","findChildren","depth","crossAxisSize","posInLevelToY","posInLevel","timeAxisSize","behavior","on","shiftMode","checkLink","linkObj","addLink","timeArrow","scaleFactorDisplay","white","levelCaptionSet","newLevelCaptions","enter","oldLevelCaptions","exit","addItemButtons","calculateWeightsBottomUp","levelItems","_visible","contextMenuItem","selectedLinkFromItem","selectedLinkToItem","allLinks","parentElement","_depth","_posInLevel","_fromDepth","_fromPosInLevel","_toDepth","_toPosInLevel","dataSet","newNodes","oldNodes","circle","foreignObject","linkSet","newLinks","oldLinks","insert","node","getBBox","drawEpgGrid","binValStrArr","gridWidth","gridHeight","sInterv","curFrame","curFrameVals","elIdx","split","binStr","binStrIdx","mhs","staticContoursCanvas","globalMinX","globalMaxX","globalMinY","globalMaxY","startPoint","endPoint","drawDots","setGlobalMinMaxVals","dD","twoDimCanvases","twoDimDrawingDefinitions","dots","trConf","xSsffTrack","xCol","ySsffTrack","yCol","staticDots","sD","xCoordinates","xVal","xIdx","yCoordinates","staticContours","sC","drawStaticContour","xPrev","yPrev","xsRaSt","ysRaSt","xContourNr","yContourNr","tw","curMousePosTime","degrees","allDots","connectLines","fromDot","toDot","labelX","xNameCoordinate","labelY","yNameCoordinate","DragnDropService","dropTextDefault","dropTextErrorFileType","dropTextErrorAPI","dropAllowed","dropParsingWaiting","dropParsingWAV","dropParsingWaitingAnnot","dropFirefoxWarning","dropText","dropClass","dropClassDefault","dropClassOver","dropClassError","count","handles","bundles","bundleNames","updateQueueLength","quantity","enqueueFileAddition","identifier","substring","toUpperCase","extension","startRendering","maxDroppedBundles","loadFiles","files","reader","isFile","isDirectory","getAsEntry","webkitGetAsEntry","getAsFile","File","warn","createReader","readEntries","entries","dropFiles","FileReader","FileList","dragEnterLeave","handleDragOver","acceptGrid","acceptWav","acceptJson","acceptBoth","acceptFile","handleFilesonChange","loadedFiles","fileDialog","$parent","checkIfLevelsAreDefined","levelNames","DBconfig","lnIdx","checkIfSsffTracksAreDefined","trackNames","tnIdx","td","schemasJsos","names","semCheckLoadedConfigs","keepGoing","ldIdx","ad1","ad1idx","counter","ad2","tDefRes","assTrackNames","lDefRes","tddd","dotNames","sd","verticalPosSsffTrackName","velocitySsffTrackName","autoLinkLevelName","uri","proms","all","schemaArr","tv4","addSchema","getSchema","schemaName","schema","validate","semCheckRes","paths","possible","possibleAsStr","selected","standardFuncServ","findPaths","arr","arrIdx","reverseCopy","join","getSelIdx","selIdx","rotateHierarchy","getRotation","playSelection","getPlaying","isCurrentAttrDef","attrDef","setCurrentAttrDef","attrDefIndex","getAllAttrDefs","levDef","startLevel","parents","findParentLevels","childLevel","linkDefinitions","sublevelName","superlevelName","selectedPath","findParents","findVisibility","_weight","currentLevel","li","it","_parents","rootLevelItems","isCollapsing","currentDescendant","descendants","convertToAbsValues","multiplyEachElement","interp2points","x0","y0","x1","y1","findMinMax","minOrMax","flattenArrayOfArray","arrOfArrs","merged","convertArrayToXYjsoArray","xyArray","itemInSel","vTrackName","vTr","vCol","flatColVals","flatVcolVals","gdat","NaN","vdat","ndat","cdat","startTimeSel","endTimeSel","selCol","selVCol","maxVerticalPos","maxVelBeforeMaxConstr","minVelBeforeMaxVel","interactiveFindThresholds","threshold","on20","minVelBetwMaxVel1maxConstr","minp","off20","maxVelAfterMaxConstr","minBetwMaxConstrMaxVelConstr","minVelAfterMaxVelAfterConstr","curLabel","gestureOnOffsetLabels","gdat0insPoint","gdat1insPoint","maxVelocityOnOffsetLabels","vdat0insPoint","vdat1insPoint","constrictionPlateauBeginEndLabels","ndat0insPoint","ndat1insPoint","maxConstrictionLabel","cdat0insPoint","linkLevelName","linkLevelDetails","linkLevelLabels","itemIdx","direction","description","thdat","thdir","xx","lx","xsh","loguk","higuk","vz","anavv","infos","thresholdIdx","thresholdValue","ap","convertedBundles","sessionDefault","bc","setDefaultSession","getDefaultSession","drandropBundles","bundleList","sessionName","setDragnDropData","convertDragnDropData","handleLocalFiles","wav","annotation","getDragnDropData","generateDrop","reader2","readAsArrayBuffer","onloadend","readyState","DONE","currentTarget","mediaFile","encoding","ssffFiles","readAsText","curClickSegments","setCurBndl","margin","linear","range","xAxis","axis","tickSize","tickSubdivide","yAxis","orient","lineFunc","line","interpolate","domain","x2","y2","hideMe","genUniqSessionList","bndlList","fistSes","sList","bndl","genRendOptBndlList","rendOptBndlList","curBndl","demoDbName","bList","getRendOptBndlList","getDemoDbName","getSessionCollapseState","dolss","filterText","turn","uttIsDisabled","getBndlColor","isSessionDefined","messModal","arrBuff","ssffJso","formants","messParser","getAnnotationAndSaveBndl","getWorkerScript","js","workerInit","global","ab2str","unis","wav2jso","curBinIdx","curBuffer","curBufferView","wavRep","ChunkID","Uint32Array","ChunkSize","Format","Subchunk1ID","Uint16Array","AudioFormat","ByteRate","BlockAlign","riffChunkSize","Subchunk1IDandSizeSize","Subchunk2start","Subchunk2ID","Subchunk2Size","Int16Array","parserRes","postMessage","urlObj","terminate","msg","toJSO","labelJSO","headEndIdx","lines","prevLineArr","idCounter","curLineArr","toESPS","espsStr","retVal","l1","l2","localID","testForGapsInLabelJSO","findTimeOfMinSample","findTimeOfMaxSample","myFile","myName","VU_STR","$0","$1","re","tT","tN","eT","inHeader","labs","itemST","itemET","toTextGrid","tG","nl","levelNr","curLevel","evtNr","executed","TWO_PI","totalMax","N","wFunction","myFFT","pixelHeight","internalalpha","maxPsd","HzStep","paint","sin","cos","ceilingFreqFftIdx","floorFreqFftIdx","resultImgArr","toLinearLevel","dbLevel","pow","log10","arg","magnitude","real","imag","sqrt","FFT","m","applyWindowFuncAndPreemph","applyPreEmph","wFunctionBartlett","wFunctionBartlettHann","wFunctionBlackman","wFunctionCosine","wFunctionGauss","wFunctionHamming","wFunctionHann","wFunctionLanczos","wFunctionRectangular","wFunctionTriangular","a0","a1","a2","E","curSample","prevSample","fft","k","n1","n2","t1","t2","convertToHeatmap","minval","maxval","maxIndex","v","i1","i2","rgb1","rgb2","r","g","drawVerticalLineOfSpectogram","rgb","px","py","psd","psdLog","scaledVal","hmVals","calcMagnitudeSpectrum","low","renderSpectrogram","renderError","ssffData","headID","machineID","sepString","origFreq","base64encode","c1","c2","c3","base64EncodeChars","charAt","base64decode","c4","base64DecodeChars","stringToUint","charList","uintArray","Uint8Concat","second","firstLength","ssff2jso","uIntBuffView","dataView","buffStr","decoder","TextDecoder","decode","newLsep","lSpl","ssffdatatype","curLen","curMin","curMax","Float64Array","jso2ssff","headerStr","bytePerTime","failed","byteSizeOfDataBuffer","dataBuff","dataBuffView","ssffBufView","byteOffSet","curArray","curArrayIDX","curCol","setInt16","parseArr","noError","resArr","curExp","getTemplateUrl","deferChange","param1","param2","chartData","changeModal","closeAndResolve","tree","title","properties","warning","init","timeMode","signalTypes","levelTypes","currentSignal","onClickTab","currentTabUrl","getType","section","schemaValue","schemaKey","configKey","up","sequence","down","del","dependency","depWarn","showWarning","warningSignal","perspDelete","signalAdd","signal","levelAdd","perspAdd","expanded","isMDFile","superlevelIndex","linkType","consle","toElement","fromElement","sibling","firstAllowedChildIndex","lastAllowedChildIndex","superlevel","sublevel","parentOrder","childOrder","siblingRelativeIndex","o","listOfMarkdownFiles","curMdFile","setCurrentMdFile","mdFile","isCurrentMdFile","tabUrl","font-weight"],"mappings":"AAAA,YA2vbA,SAASA,iBAAgBC,GACvBA,EAASA,GAAUC,OAAOD,OAC1BE,KAAKC,IAAMD,KAAKE,eAChBF,KAAKG,OAAS,GAAIL,GAAOE,KAAKC,KAmRhC,QAASG,kBAAiBN,GACxBA,EAASA,GAAUC,OAAOD,OAC1BE,KAAKC,IAAMD,KAAKE,eAChBF,KAAKG,OAAS,GAAIL,GAAOE,KAAKC,KAmMhC,QAASI,sBAAqBP,GAC5BA,EAASA,GAAUC,OAAOD,OAC1BE,KAAKC,IAAMD,KAAKE,eAChBF,KAAKG,OAAS,GAAIL,GAAOE,KAAKC,KAyThC,QAASK,sBAAqBR,GAC5BA,EAASA,GAAUC,OAAOD,OAC1BE,KAAKC,IAAMD,KAAKE,eAChBF,KAAKG,OAAS,GAAIL,GAAOE,KAAKC,KA+uBhC,QAASM,kBAAiBT,GACxBA,EAASA,GAAUC,OAAOD,OAC1BE,KAAKC,IAAMD,KAAKE,eAChBF,KAAKG,OAAS,GAAIL,GAAOE,KAAKC,KAvwehCO,YAAYC,UAAUC,SAAW,SAAUC,EAAQC,GAIjD,IAAK,GAHDC,GAAM,GAAIL,aAAYI,GACtBE,EAAU,GAAIC,WAAUF,GACxBG,EAAW,GAAID,WAAUf,MACpBiB,EAAI,EAAOL,EAAJK,EAAYA,IAC1BH,EAAQG,GAAKD,EAASL,EAASM,EAEjC,OAAOJ,IAGTK,QAAQC,OAAO,aACb,KACA,YACA,iBACA,oBACCC,QACD,oBACA,SAAUC,GACRA,EAAkBC,WAAU,MAIhCJ,QAAQC,OAAO,aAAaI,QAAQ,yBAClC,KACA,YACA,SAAUC,EAAIC,GAEZ,GAAIC,KAoMJ,OAnMAA,GAASC,QACTD,EAASE,UACTF,EAASG,eACTH,EAASI,gBAETJ,EAASK,cACPC,YAAa,GACbC,YAAa,GACbC,UAAW,GACXC,eAAe,GAEjBT,EAASU,UAAY,SAAUC,GAC7BnB,QAAQoB,KAAKD,EAAMX,EAASE,SAK9BF,EAASa,QAAU,SAAUF,GACvBG,EAAEC,cAAcf,EAASC,MAC3BD,EAASC,KAAOU,EAEhBnB,QAAQwB,QAAQC,OAAOC,KAAKP,GAAO,SAAUQ,GAEvC3B,QAAQ4B,QAAQpB,EAASC,KAAKkB,KAEhCnB,EAASC,KAAKkB,MACd3B,QAAQwB,QAAQL,EAAKQ,GAAO,SAAUE,GACpCrB,EAASC,KAAKkB,GAAMG,KAAKD,MAG3B7B,QAAQwB,QAAQC,OAAOC,KAAKP,EAAKQ,IAAQ,SAAUI,GACfC,SAA9BxB,EAASC,KAAKkB,GAAMI,GACtBvB,EAASC,KAAKkB,GAAMI,GAAQZ,EAAKQ,GAAMI,GAEvCE,QAAQC,MAAM,8BAAgCP,EAAO,UAAYI,QAO7EvB,EAAS2B,SAAW,SAAUC,GAC5B,GAAIC,GAAQ/B,EAAG+B,QACXC,EAAM9B,EAAS+B,UAAUH,EAAS5B,EAASI,aAE/C,OADAyB,GAAMG,QAAQF,GACPD,EAAMI,SAEfjC,EAAS+B,UAAY,SAAUH,EAASM,GACtC,GAAIJ,KAgBJ,OAfAtC,SAAQwB,QAAQY,EAAS,SAAUO,EAAOC,GACnC5C,QAAQ6C,OAAOF,EAAOD,EAAME,MAC3BE,MAAMlB,QAAQe,IAChBL,EAAIM,MACJ5C,QAAQoB,KAAKuB,EAAOL,EAAIM,KACC,gBAATD,IAChBL,EAAIM,MACJN,EAAIM,GAAOpC,EAAS+B,UAAUI,EAAOD,EAAME,KAE/B,UAARA,GAA2B,eAARA,GAAgC,iBAARA,IAC7CN,EAAIM,GAAOD,MAKZL,GAKT9B,EAASuC,mBAAqB,SAAUC,GACtC,GAAIC,EAQJ,OAPkDjB,UAA9CxB,EAASG,YAAYuC,sBACvBlD,QAAQwB,QAAQhB,EAASG,YAAYuC,qBAAsB,SAAUC,GAC/DA,EAAGH,OAASA,IACdC,EAAME,KAILF,GAKTzC,EAAS4C,eAAiB,SAAUC,GAClC,GAAIJ,KAMJ,OALAjD,SAAQwB,QAAQhB,EAASC,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAeC,YAAa,SAAUC,GACxGA,EAAGC,gBAAkBN,IACvBJ,EAAMS,KAGHT,GAKTzC,EAASoD,wBAA0B,SAAUP,GAC3C,GAAIJ,EAMJ,OALAjD,SAAQwB,QAAQhB,EAASC,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAeK,cAAe,SAAUC,GAC1GA,EAAGH,gBAAkBN,IACvBJ,EAAMa,KAGHb,GAKTzC,EAASuD,cAAgB,SAAUC,GACjC,GAAIf,KAMJ,OALAjD,SAAQwB,QAAQhB,EAASC,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAeS,OAAQ,SAAUC,GACnGA,EAAEC,mBAAqBH,IACzBf,EAAMiB,KAGHjB,GAKTzC,EAAS4D,mBAAqB,SAAUC,GACtC,GAAIpB,KAMJ,OALAjD,SAAQwB,QAAQhB,EAASG,YAAY2D,iBAAkB,SAAUC,GAC3DA,EAAGvB,OAASqB,IACdpB,EAAMsB,KAGHtB,GAKTzC,EAASgE,qBAAuB,SAAUC,EAAgBJ,GAClCrC,SAAlBxB,EAASC,MACwBuB,SAA/BxB,EAASC,KAAK6C,cACmCtB,SAA/CxB,EAASC,KAAK6C,aAAamB,IACoCzC,SAA7DxB,EAASC,KAAK6C,aAAamB,GAAgBC,gBAC7ClE,EAASC,KAAK6C,aAAamB,GAAgBC,cAAcC,MAAQN,IAS3E7D,EAASoE,UAAY,SAAUC,GAC7B,GAAIC,EACJ,QAAQD,GACR,IAAK,GACHC,EAAM,WACN,MACF,KAAK,GACHA,EAAM,KACN,MACF,KAAK,IACHA,EAAM,OACN,MACF,KAAK,IACHA,EAAM,OACN,MACF,KAAK,IACHA,EAAM,KACN,MACF,KAAK,IACHA,EAAM,OACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,KAAK,IACHA,EAAM,GACN,MACF,SACEA,EAAMC,OAAOC,aAAaH,GAE5B,MAAOC,IAEFtE,KAIXR,QAAQC,OAAO,aAAagF,WAAW,kBACrC,SACA,aACA,OACA,WACA,WACA,KACA,UACA,YACA,YACA,YACA,iBACA,mBACA,sBACA,wBACA,mBACA,kBACA,eACA,wBACA,oBACA,wBACA,mBACA,oBACA,oBACA,oBACA,kBACA,wBACA,uBACA,kBACA,cACA,eACA,kBACA,SAAUC,EAAQC,EAAYC,EAAMC,EAAUC,EAAUhF,EAAIiF,EAASC,EAAWC,EAAWlF,EAAWmF,EAAgBC,EAAkBC,EAAqBC,EAAuBC,EAAkBC,EAAiBC,EAAcC,EAAuBC,EAAmBC,EAAuBC,EAAkBC,EAAmBC,EAAmBC,EAAmBC,EAAiBC,EAAuBC,EAAsBC,EAAiBC,EAAaC,EAAcC,GAEzd5B,EAAO6B,IAAMlB,EACbX,EAAO8B,MAAQtB,EACfR,EAAO+B,UAAYnB,EACnBZ,EAAOgC,QAAUlB,EACjBd,EAAOiC,SAAWP,EAClB1B,EAAOkC,GAAK7G,EACZ2E,EAAOmC,OAAStB,EAChBb,EAAOoC,IAAM1B,EACbV,EAAOqC,IAAMjB,EACbpB,EAAOsC,IAAMpB,EACblB,EAAOuC,GAAK9B,EACZT,EAAOwC,IAAMlB,EACbtB,EAAOyC,KAAOlB,EAEdvB,EAAO0C,gBAAkB,UACzB1C,EAAO2C,OACP3C,EAAO4C,UAAW,EAClB5C,EAAO6C,oBAAqB,EAC5B7C,EAAO8C,YAAczC,EAAQ0C,WAC7B/C,EAAOgD,gBACPhD,EAAOgD,aAAaC,eAAgB,EAGpCjD,EAAOwC,IAAIU,qBAIXpI,QAAQqI,QAAQ9C,GAAS+C,KAAK,SAAU,WACtCtC,EAAauC,iBACbhI,EAAUiI,eAAejD,EAAQ0C,YAC7B1H,EAAUkI,eAAeC,aACzBnI,EAAUkI,eAAeE,OAE7BzD,EAAO0D,YAGT5I,QAAQqI,QAAQ9C,GAAS+C,KAAK,QAAS,SAAUO,IAC3CA,EAAEC,UAAYjD,EAAsBpF,KAAKsI,YAAYC,OAASH,EAAEC,UAAYjD,EAAsBpF,KAAKsI,YAAYE,OACrHvD,EAAewD,6BACfhE,EAAO0D,aAIX5I,QAAQqI,QAAQ9C,GAAS+C,KAAK,OAAQ,SAAUO,GAC9CtI,EAAU4I,kBAAmB,IAG/BnJ,QAAQqI,QAAQ7C,GAAW8C,KAAK,OAAQ,SAAUO,GAChDtI,EAAU4I,kBAAmB,IAG/BnJ,QAAQqI,QAAQ9C,GAAS+C,KAAK,QAAS,SAAUO,GAC/CtI,EAAU4I,kBAAmB,IAG/BnJ,QAAQqI,QAAQ7C,GAAW8C,KAAK,QAAS,SAAUO,GACjDtI,EAAU4I,kBAAmB,IAG/BtK,OAAOuK,eAAiB,WACtB,MAAuD,KAAnDvD,EAAsBhF,aAAaC,aAAsB2F,EAAsB4C,gBAAgB3J,OAAS,IAAMmG,EAAsBpF,KAAK6I,KAAKC,YACzI,yFADT,QAkBFrE,EAAOsE,IAAI,sBAAuB,SAAUC,EAAOC,GACjD/C,EAAgBgD,qBAGlBzE,EAAOsE,IAAI,mBAAoB,WAC7BtE,EAAO0E,sBAET1E,EAAOsE,IAAI,oBAAqB,SAAUC,EAAOtI,GAC/C+D,EAAO0E,oBACPrJ,EAAUxB,IAAMoC,EAAKpC,IACrBwB,EAAUsJ,uBAAyB,0BACnCtJ,EAAUuJ,qBAAsB,EAChCnE,EAAiBoE,IAAIC,YAAY7I,EAAKpC,KAAKkL,KAAK,SAAUC,GACnC,UAAjBA,EAAQC,KACVtD,EAAauD,KAAK,mBAAoB,0CAA4CjJ,EAAKpC,KAAKkL,KAAK,WAC/FtD,EAAgBgD,qBAGlBzE,EAAOmF,0BAA0BlJ,IAElC,SAAUmJ,GACXzD,EAAauD,KAAK,mBAAoB,0CAA4CG,KAAKC,UAAUF,EAAS,KAAM,IAAIL,KAAK,WACvHtD,EAAgBgD,wBAOtB,IAAIc,GAAehF,EAAUiF,QACzBD,GAA0B,aAAKA,EAA0B,aAAKA,EAAwB,YACxF5E,EAAsBhF,aAAaC,YAAc2J,EAAa3J,YAC9D+E,EAAsBhF,aAAaE,YAAc0J,EAAa1J,YAC9D8E,EAAsBhF,aAAaG,UAAYyJ,EAAazJ,UAC5D6E,EAAsBhF,aAAaI,eAAgB,GAMrDiE,EAAOyF,wBAA0B,WAC3B9E,EAAsBhF,aAAaC,cACrC+E,EAAsBpF,KAAKmK,cAAcC,YAAa,EACtDlF,EAAiBmF,YAAYjF,EAAsBhF,aAAaC,YAAa,eAAemJ,KAAK,SAAU9I,GACzGZ,EAAUwK,cAAe,CAEzB,IAAIlD,GAAMhC,EAAsBhF,aAAaC,WAC7C2F,GAAsBuE,eAAenD,EAAIoD,OAAO,EAAGpD,EAAIqD,YAAY,MAAMD,OAAOpD,EAAIqD,YAAY,KAAO,EAAGrD,EAAInI,SAE1Ga,EAAU4K,kBACZ5K,EAAU6K,cAAcvF,EAAsBnF,OAAO2K,UAAUC,QAEjE/K,EAAUsJ,uBAAyB,sBAEnC,IACI0B,GADAd,EAAehF,EAAUiF,QAG3Ba,GADEd,EAA6B,eACdA,EAAac,eAEb,4CAGnB5F,EAAiBmF,YAAYS,GAAgBtB,KAAK,SAAUuB,GAE1DjL,EAAUgD,kBAAoB,EAC9BsC,EAAsBxE,QAAQmK,EAAKrK,KAAKsK,uBAEjCD,GAAKrK,KAAKsK,eAEjB,IAAIC,GAAWnF,EAAkBoF,YAAY,wBAAyB9F,EAAsBpF,KACxFiL,MAAa,GAEX7F,EAAsBhF,aAAaI,gBACrC4E,EAAsBpF,KAAK6I,KAAKsC,yBAA0B,GAE5D/F,EAAsBlF,YAAc6K,EAAKrK,KAEzCuK,EAAWnF,EAAkBoF,YAAY,qBAAsB9F,EAAsBlF,aACjF+K,KAAa,GAEfnL,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,sBACnCzD,EAAiByF,eAAe1K,EAAKA,MAAM8I,KAAK,SAAU6B,GACxD,GAAIC,GAASD,CACbvL,GAAUyL,YAAYC,GAAK,EAC3B1L,EAAUyL,YAAYE,GAAKH,EAAOI,KAAKzM,OACvCa,EAAU6L,cACVxG,EAAoBmG,OAASA,EAE7BpG,EAAiBmF,YAAYjF,EAAsBhF,aAAaE,YAAa,SAASkJ,KAAK,SAAUoC,GACnG9L,EAAUsJ,uBAAyB,WAAahE,EAAsBhF,aAAaG,UAAY,WAC/F2E,EAAiB2G,eAAeD,EAAMlL,KAAM0E,EAAsBhF,aAAaE,YAAa,mBAAoB8E,EAAsBhF,aAAaG,WAAWiJ,KAAK,SAAUsC,GAC3K,GAAIC,GAAQD,CACZ3F,GAAY6F,QAAQD,EACpB,IAAIE,MACAC,IACJH,GAAMI,OAAOpL,QAAQ,SAAUqL,GAC7BH,EAAO5K,KAAK+K,EAAE7J,MACd2J,EAAU7K,MACRkB,KAAQ6J,EAAE7J,KACVmH,KAAQ0C,EAAE1C,KACV2C,sBACE9J,KAAQ6J,EAAE7J,KACVmH,KAAQ,cAKdtE,EAAsBlF,YAAY2D,iBAAmBqI,EACrDpM,EAAUwM,oBAAoBlH,EAAsBlF,YAAY2D,kBAChEuB,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAQ+H,EAC3FnM,EAAUsJ,uBAAyB,QACnCtJ,EAAUuJ,qBAAsB,EAChCvJ,EAAUyM,SAAS,aAClB,SAAU1C,GACXzD,EAAauD,KAAK,mBAAoB,2BAA6BE,EAAQ2C,OAAO/C,YAEnF,SAAUI,GACXzD,EAAauD,KAAK,mBAAoB,6BAA+BvE,EAAsBhF,aAAaE,YAAc,UAAYwJ,KAAKC,UAAUF,EAAS,KAAM,OAEjK,SAAUA,GACXzD,EAAauD,KAAK,mBAAoB,2BAA6BE,EAAQ2C,OAAO/C,YAGpFrD,EAAauD,KAAK,mBAAoB,yCAA2CG,KAAKC,UAAUkB,EAAU,KAAM,KAGlH7E,EAAauD,KAAK,mBAAoB,yJAA2JG,KAAKC,UAAUkB,EAAU,KAAM,KAEjO,SAAUpB,GACXzD,EAAauD,KAAK,mBAAoB,uCAAyCE,MAEhF,SAAUA,GACXzD,EAAauD,KAAK,mBAAoB,4BAA8BvE,EAAsBhF,aAAaC,YAAc,WAAayJ,KAAKC,UAAUF,EAAS,KAAM,QAOtKpF,EAAO0E,kBAAoB,WACzBrJ,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,uBAEnCtD,EAAkB2G,cAAcjD,KAAK,SAAUkD,GAC7C5G,EAAkB6G,WAAWD,GAC7BxH,EAAiB0H,uBAAuBC,QAAQ,SAAUnM,GACxD0E,EAAsB3E,UAAUC,GAChCwE,EAAiB4H,uBAAuBD,QAAQ,SAAUnM,GACxDZ,EAAUsJ,uBAAyB,4BACnC,IAAI6B,GAAWnF,EAAkBoF,YAAY,wBAAyBxK,EAClEuK,MAAa,GACf7F,EAAsBxE,QAAQF,GAC9BnB,QAAQoB,KAAK8D,EAAO6B,IAAItG,KAAMyE,EAAO6B,IAAInG,cACzCsE,EAAOsI,4BAEPtI,EAAOyF,0BACPzF,EAAOuI,4BAGPlN,EAAUuJ,qBAAsB,GAEhCjD,EAAauD,KAAK,mBAAoB,sDAAwDG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACpItD,EAAgBgD,uBAGnBzH,MAAM,SAAUf,EAAM8L,EAAQS,EAAQxN,GACvC2G,EAAauD,KAAK,mBAAoB,wDAA+D6C,EAAS,YAAcS,EAAS,WAAaxN,GAAQ+J,KAAK,WAC7JtD,EAAgBgD,yBAGnBzH,MAAM,SAAUf,EAAM8L,EAAQS,EAAQxN,GACvC2G,EAAauD,KAAK,mBAAoB,wDAA+D6C,EAAS,YAAcS,EAAS,WAAaxN,GAAQ+J,KAAK,WAC7JtD,EAAgBgD,wBAGnB,SAAUW,GACXzD,EAAauD,KAAK,mBAAoB,8BAAgCG,KAAKC,UAAUF,EAAS,KAAM,IAAIL,KAAK,WAC3GtD,EAAgBgD,wBAKtBzE,EAAO0E,oBACP1E,EAAOuI,0BAA4B,SAAUE,GAC3C,GAAIC,GAASC,aAAaC,QAAQ,wBAC7BhH,GAAgBiH,UAAUC,aAA0B,OAAXJ,IAC5CC,aAAaI,QAAQ,wBAAyB,QAC9C/I,EAAOgD,aAAaC,eAAgB,IAIxCjD,EAAOgJ,eAAiB,WACtB,MAAOzH,GAAsByH,kBAK/BhJ,EAAOsI,0BAA4B,WAC5BjN,EAAU4K,kBACb5K,EAAU6K,cAAcvF,EAAsBnF,OAAO2K,UAAUC,OAGjE,IAAIb,GAAehF,EAAUiF,UACzB7E,EAAsBpF,KAAK6I,KAAKC,aAA+C,SAAhCkB,EAA0B,eAClC,mBAA9BA,GAAwB,YAEjC5E,EAAsBpF,KAAK6I,KAAK6E,UAAY1D,EAAwB,WAEtE9E,EAAiBoE,IAAIC,YAAYnE,EAAsBpF,KAAK6I,KAAK6E,WAAWlE,KAAK,SAAUC,GACpE,UAAjBA,EAAQC,KACVtD,EAAauD,KAAK,mBAAoB,0CAA4CvE,EAAsBpF,KAAK6I,KAAK6E,WAAWlE,KAAK,WAChItD,EAAgBgD,qBAGlBzE,EAAOmF,2BACL+D,QAAS,KACTC,OAAQ,QAGX,SAAU/D,GACXzD,EAAauD,KAAK,mBAAoB,0CAA4CG,KAAKC,UAAUF,EAAS,KAAM,IAAIL,KAAK,WACvHtD,EAAgBgD,wBAKtBpJ,EAAU+N,mBAAmBzI,EAAsBpF,KAAK8N,oBAAoBC,iBAAkB3I,EAAsBpF,KAAK8N,oBAAoBE,UAAW5I,EAAsBpF,KAAK8N,oBAAoBG,QAAS7I,EAAsBpF,KAAK8N,oBAAoBI,aAAc9I,EAAsBpF,KAAK8N,oBAAoB1P,OAAQgH,EAAsBpF,KAAK8N,oBAAoBK,kBAAmB/I,EAAsBpF,KAAK8N,oBAAoBM,wBAAyBhJ,EAAsBpF,KAAK8N,oBAAoBO,qBAE7fvO,EAAUwO,kBAAkBlJ,EAAsBnF,OAAO2K,UAAUC,SAOrEpG,EAAOmF,0BAA4B,SAAUlJ,GAE3C,GAAIiN,GAAUjN,EAAKiN,QACfC,EAASlN,EAAKkN,MAClB9N,GAAUwK,cAAe,EACzBlF,EAAsBpF,KAAK6I,KAAK0F,QAAU,KAC1CnJ,EAAsBpF,KAAKmK,cAAcC,YAAa,EACtDtK,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,uBAEnClE,EAAiBsJ,cAAchF,KAAK,SAAUhH,GACvB,kCAAjBA,EAAIiM,UAAgE,UAAhBjM,EAAIkM,SAC1D5O,EAAUsJ,uBAAyB,8BAEnClE,EAAiByJ,sBAAsBnF,KAAK,SAAUoF,GAClC,OAAdA,EACFnK,EAAOoK,gCACLlB,QAASA,EACTC,OAAQA,IAIVxH,EAAauD,KAAK,yBAAyBH,KAAK,SAAUhH,GACpDA,EACFiC,EAAOoK,gCACLlB,QAASA,EACTC,OAAQA,IAGV1H,EAAgBgD,wBAOxB9C,EAAauD,KAAK,mBAAoB,0CAA4CvE,EAAsBpF,KAAK6I,KAAK6E,UAAY,mFAAqFlL,EAAIiM,SAAW,wBAA0BjM,EAAIkM,QAAU,KAAKlF,KAAK,WAClRtD,EAAgBgD,wBAQxBzE,EAAOoK,+BAAiC,SAAUnO,GAChD,GAAIiN,GAAUjN,EAAKiN,QACfC,EAASlN,EAAKkN,MAClB9N,GAAUsJ,uBAAyB,uBAEnClE,EAAiB0H,uBAAuBC,QAAQ,SAAUnM,GACxD0E,EAAsB3E,UAAUC,GAChCwE,EAAiB4J,kBAAkBtF,KAAK,SAAU9I,GAEhDZ,EAAUgD,kBAAoB,EAC9BsC,EAAsBxE,QAAQF,EAAKsK,uBAG5BtK,GAAKsK,eAEZ,IAAIC,GAAWnF,EAAkBoF,YAAY,wBAAyB9F,EAAsBpF,KACxFiL,MAAa,GACf7F,EAAsBlF,YAAcQ,EACpCZ,EAAUwM,oBAAoBlH,EAAsBlF,YAAY2D,kBAChEoH,EAAWnF,EAAkBoF,YAAY,qBAAsBxK,GAC3DuK,KAAa,GAEfnL,EAAUsJ,uBAAyB,yBACnClE,EAAiB0D,gBAAgBY,KAAK,SAAUuF,GAC9C9D,EAAWjF,EAAsBgJ,cAAcD,GAE/C3J,EAAsBpF,KAAKmK,cAAc8E,OAAQ,EACjD7J,EAAsBpF,KAAKmK,cAAc+E,cAAe,EACpDjE,KAAa,GAEC,OAAZ0C,IACFA,EAAU3H,EAAsB4C,gBAAgB,IAElD3C,EAAqBkJ,WAAWxB,GAE5BC,GACF5H,EAAsBoJ,oBAAoBzB,EAAQA,UAGpDvH,EAAauD,KAAK,mBAAoB,gCAAkCG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WAC9GtD,EAAgBgD,wBAKtB9C,EAAauD,KAAK,mBAAoB,yCAA2CG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACvHtD,EAAgBgD,sBAIpB9C,EAAauD,KAAK,mBAAoB,yJAA2JG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACvOtD,EAAgBgD,0BAS1BzE,EAAO4K,sBAAwB,SAAUC,GACvC7K,EAAO8K,gBAAgBD,GAAKE,WAAa/K,EAAO8K,gBAAgBD,GAAKE,WAKvE/K,EAAOgL,WAAa,SAAUC,GAC5B,GAAIC,GAAMvK,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAemB,MAAMjF,OAChG2Q,EAAQ,EACZ,OAA8B,IAA1B9P,EAAU+P,aACL,OAEK,IAARF,EACK,OAEG,IAARA,EACE7P,EAAU+P,cAAgBH,EACrB,MAEA,MAGL5P,EAAU+P,cAAgBH,EACrBE,EAAQ,KAEP,GAAKA,IAAUD,EAAM,GAAK,KAQ1ClL,EAAOqL,kBAAoB,WACzBhQ,EAAUiQ,sBAAqB,IAKjCtL,EAAOuL,qBAAuB,WAC5BlQ,EAAUiQ,sBAAqB,IAQjCtL,EAAOwL,oBAAsB,WAC3B,GAAInQ,EAAUoQ,cAAc,uBAAwB,CAClD,GAAIjR,GAAS,CACmBsC,UAA5B4E,EAAYzF,KAAKyL,SACnBlN,EAASkH,EAAYzF,KAAKyL,OAAOlN,OAEnC,IAAIkR,GAAU,UAAYlR,EACtBmR,GACAC,SACA9N,KAAM4N,EACNzG,KAAM,UAEV,IAAyCnI,SAArCzB,EAAUwQ,cAAcH,GAAwB,CAClD,GAAII,IACAhO,KAAM4N,EACNzG,KAAM,QACN2C,sBACE9J,KAAM4N,EACNzG,KAAM,UAGZ5J,GAAUwM,oBAAoBiE,GAEhChL,EAAaiL,YAAYJ,EAAOnR,EAAQa,EAAUgD,mBAElDmC,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVN,MAASA,EACTO,GAAM1R,EACN6D,kBAAqBhD,EAAUgD,oBAEjChD,EAAU8Q,aAAY,EAAOxL,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAOqB,KAM3Hd,EAAOoM,sBAAwB,WAC7B,GAAI/Q,EAAUoQ,cAAc,yBAA0B,CACpD,GAAIjR,GAAS,CACmBsC,UAA5B4E,EAAYzF,KAAKyL,SACnBlN,EAASkH,EAAYzF,KAAKyL,OAAOlN,OAEnC,IAAIkR,GAAU,UAAYlR,EACtBmR,GACAC,SACA9N,KAAM4N,EACNzG,KAAM,QAEV,IAAyCnI,SAArCzB,EAAUwQ,cAAcH,GAAwB,CAClD,GAAII,IACAhO,KAAM4N,EACNzG,KAAM,QACN2C,sBACE9J,KAAM4N,EACNzG,KAAM,UAGZ5J,GAAUwM,oBAAoBiE,GAEhChL,EAAaiL,YAAYJ,EAAOnR,EAAQa,EAAUgD,mBAElDmC,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVN,MAASA,EACTO,GAAM1R,EACN6D,kBAAqBhD,EAAUgD,oBAEjChD,EAAU8Q,aAAY,EAAOxL,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAOqB,KAM3Hd,EAAOqM,uBAAyB,WAC1BhR,EAAUoQ,cAAc,4BACe3O,SAArCzB,EAAUiR,uBACZ3K,EAAauD,KAAK,yBAA0B7J,EAAUiR,wBAEtD3K,EAAauD,KAAK,mBAAoB,kDAO5ClF,EAAOuM,yBAA2B,WAC5BlR,EAAUoQ,cAAc,6BAC1B1K,EAAsByL,kBAAkBzH,KAAK,SAAUsC,GACrDA,EAAYA,EAAUoF,QAAQ,MAAO,QAErC9K,EAAauD,KAAK,oBAAqB3D,EAAsBmL,aAAa5O,KAAO,YAAauJ,MAOpGrH,EAAO2M,2BAA6B,WAC9BtR,EAAUoQ,cAAc,+BACtBpK,EAAkBoF,YAAY,wBAAyB/E,EAAYkL,YACrEjL,EAAauD,KAAK,oBAAqB3D,EAAsBmL,aAAa5O,KAAO,cAAehD,QAAQ+R,OAAOnL,EAAYkL,WAAW,KAO5I5M,EAAO8M,sBAAwB,WACzBzR,EAAUoQ,cAAc,wBAC1B9J,EAAauD,KAAK,6BAMtBlF,EAAO+M,gBAAkB,WACnB1R,EAAUoQ,cAAc,oBAC1B9J,EAAauD,KAAK,2BAA2BH,KAAK,SAAUlL,GACtDA,IACFwB,EAAUsJ,uBAAyB,0BACnCtJ,EAAUuJ,qBAAsB,EAChCvJ,EAAUxB,IAAMA,EAChB4G,EAAiBoE,IAAIC,YAAYjL,GAAKkL,KAAK,SAAUC,GAC9B,UAAjBA,EAAQC,KACVtD,EAAauD,KAAK,mBAAoB,0CAA4CrL,GAAKkL,KAAK,WAC1FtD,EAAgBgD,qBAGlBzE,EAAOmF,2BACL+D,QAAS,KACTC,OAAQ,QAGX,SAAU/D,GACXzD,EAAauD,KAAK,mBAAoB,0CAA4CG,KAAKC,UAAUF,EAAS,KAAM,IAAIL,KAAK,WACvHtD,EAAgBgD,2BAW5BzE,EAAOgN,mBAAqB,SAAUC,GAChC5R,EAAUoQ,cAAc,wBAC1BzL,EAAOkN,UAAW,EAClBvM,EAAsBpF,KAAKmK,cAAcC,YAAa,EACtDpE,EAAsB4L,cAAcF,GAEpC5R,EAAUwK,cAAe,EACzBxK,EAAUuJ,qBAAsB,EAEhCvJ,EAAUyM,SAAS,iBACnBnH,EAAsBpF,KAAK6I,KAAK0F,QAAU,OAC1CzO,EAAUsJ,uBAAyB,uBACnClE,EAAiB0H,uBAAuBC,QAAQ,SAAUnM,GACxD0E,EAAsB3E,UAAUC,GAChCwE,EAAiB4J,gBAAgB4C,GAAUlI,KAAK,SAAUhH,GACxD,GAAI9B,GAAO8B,EAAI9B,IAEfZ,GAAUgD,kBAAoB,EAC9BsC,EAAsBxE,QAAQF,EAAKsK,uBAC5BtK,GAAKsK,eAEZ,IAAIC,GAAWnF,EAAkBoF,YAAY,wBAAyB9F,EAAsBpF,KACxFiL,MAAa,GACf7F,EAAsBlF,YAAcQ,EACpCZ,EAAUwM,oBAAoBlH,EAAsBlF,YAAY2D,kBAChEoH,EAAWnF,EAAkBoF,YAAY,qBAAsB9F,EAAsBlF,aACjF+K,KAAa,GAEfnL,EAAUsJ,uBAAyB,yBACnClE,EAAiB0D,cAAc8I,GAAUlI,KAAK,SAAUhH,GACtD,GAAIuM,GAAQvM,EAAI9B,IAGhBsF,GAAsBgJ,cAAcD,GAEpC3J,EAAsBpF,KAAKmK,cAAc8E,OAAQ,EACjD7J,EAAsBpF,KAAKmK,cAAc+E,cAAe,EAExDjJ,EAAqBkJ,WAAWnJ,EAAsB4C,gBAAgB,KACrE,SAAUiJ,GACXzL,EAAauD,KAAK,mBAAoB,gCAAkC+H,EAAW,KAAOG,EAAInR,KAAO,YAAcmR,EAAIrF,QAAQhD,KAAK,WAClItD,EAAgBgD,wBAIpB9C,EAAauD,KAAK,mBAAoB,yCAA2CG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACvHtD,EAAgBgD,sBAIpB9C,EAAauD,KAAK,mBAAoB,yJAA2JG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACvOtD,EAAgBgD,sBAGnB,SAAU2I,GACXzL,EAAauD,KAAK,mBAAoB,8BAAgC+H,EAAW,KAAOG,EAAInR,KAAO,YAAcmR,EAAIrF,QAAQhD,KAAK,WAChItD,EAAgBgD,2BAS1BzE,EAAOqN,cAAgB,WACjBhS,EAAUoQ,cAAc,kBAC1B9J,EAAauD,KAAK,oBAMtBlF,EAAOsN,sBAAwB,WACxBjS,EAAUkI,eAAeC,YAC5BnI,EAAUkI,eAAegK,kBACzB5L,EAAauD,KAAK,mCAMtBlF,EAAOwN,yBAA2B,WAChC7L,EAAauD,KAAK,qBAAqBH,KAAK,SAAUhH,GAChDA,KAAQ,IAENsD,EAAkBoF,YAAY,wBAAyB1I,GACzDiC,EAAO6B,IAAI5E,SAASc,GAAKgH,KAAK,SAAU0I,GACtChN,EAAiBiN,kBAAkB5S,QAAQ+R,OAAOY,GAAO,IAAO1I,KAAK,SAAU3H,GAChC,IAAzCoD,EAAemN,uBAA2E,SAA5ChN,EAAsBpF,KAAK6I,KAAK0F,QAChFnI,EAAauD,KAAK,0BAA2B,2JAA2JH,KAAK,SAAUhH,GACjNA,GACF0D,EAAgBmM,sBAIpBnM,EAAgBmM,kBAAkB5N,EAAOyC,KAAKiK,kBAKpD/K,EAAauD,KAAK,mBAAoB,uDAQ9ClF,EAAO6N,cAAgB,WAErB,GAAIC,EAEFA,GAD2C,IAAzCtN,EAAemN,uBAA2E,SAA5ChN,EAAsBpF,KAAK6I,KAAK0F,QACpE,0JAEA,4IAEdnI,EAAauD,KAAK,0BAA2B4I,GAAW/I,KAAK,SAAUhH,GACjEA,GACF0D,EAAgBgD,sBAQtBzE,EAAO+N,WAAa,WACd1S,EAAUoQ,cAAc,UAC1B3K,EAAauC,iBACbhI,EAAU2S,YAAY,EAAGtN,EAAoBmG,OAAOI,KAAKzM,UAO7DwF,EAAOiO,UAAY,WACb5S,EAAUoQ,cAAc,UAC1B3K,EAAauC,iBACbhI,EAAU6S,cAAa,KAO3BlO,EAAOmO,WAAa,WACd9S,EAAUoQ,cAAc,UAC1B3K,EAAauC,iBACbhI,EAAU6S,cAAa,KAO3BlO,EAAOoO,YAAc,WACf/S,EAAUoQ,cAAc,UAC1B3K,EAAauC,iBACbhI,EAAUgT,eAAc,KAO5BrO,EAAOsO,aAAe,WAChBjT,EAAUoQ,cAAc,UAC1B3K,EAAauC,iBACbhI,EAAUgT,eAAc,KAO5BrO,EAAOuO,WAAa,WACdlT,EAAUoQ,cAAc,UAC1B3K,EAAauC,iBACbhI,EAAU2S,YAAY3S,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,WAO/EzO,EAAO0O,YAAc,WACfrT,EAAUoQ,cAAc,eAC1B/K,EAAoBiO,WAAWtT,EAAUyL,YAAYC,GAAI1L,EAAUyL,YAAYE,IAC/E3L,EAAUuT,gBAAgBvT,EAAUyL,YAAYC,GAAI1L,EAAUyL,YAAYE,MAO9EhH,EAAO6O,WAAa,WACdxT,EAAUoQ,cAAc,eAC1B/K,EAAoBiO,WAAWtT,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,SACpFpT,EAAUuT,gBAAgBvT,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,WAOnFzO,EAAO8O,WAAa,WACdzT,EAAUoQ,cAAc,eAC1B/K,EAAoBiO,WAAW,EAAGjO,EAAoBmG,OAAOI,KAAKzM,QAClEa,EAAUuT,gBAAgB,EAAGlO,EAAoBmG,OAAOI,KAAKzM,UAUjEwF,EAAO+O,kBAAoB,SAAUC,GAEnC,IAAK,GADDC,GACKpU,EAAI,EAAGA,EAAI8F,EAAsBpF,KAAK6C,aAAa5D,OAAQK,IAC9DmU,EAAMlR,OAAS6C,EAAsBpF,KAAK6C,aAAavD,GAAGiD,OAC5DmR,EAASpU,EAGbQ,GAAUgD,kBAAoB4Q,EAE9B5T,EAAU6T,qBAAqB7T,EAAU8T,wBAM3CnP,EAAOoP,oBAAsB,SAAUJ,GACrC,GAAIK,EAMJ,OAJEA,GADkC,KAAhChU,EAAUgD,mBAA4B2Q,EAAMlR,OAAS6C,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBP,KACvH,0BAEA,wBAObhD,QAAQC,OAAO,aAAauU,UAAU,SACpC,WACA,WACA,YACA,wBACA,oBACA,iBACA,mBACA,eACA,eACA,wBACA,SAAUlP,EAAUmP,EAAUlU,EAAWsF,EAAuBS,EAAmBZ,EAAgBI,EAAkBe,EAAcb,EAAcS,GAC/I,OACEiO,YAAa,mBACbC,SAAU,IACVC,OACE/D,MAAO,IACPgE,IAAK,KAEPC,KAAM,SAAkBF,EAAOvM,EAAS0M,GAEtC,GAAIC,GAAS3M,EAAQ4M,KAAK,SAC1BL,GAAMxK,KAAO2K,EAAK3K,KAClBwK,EAAMxN,GAAK7G,EACXqU,EAAM5N,MAAQtB,EACdkP,EAAM7N,IAAMlB,EACZ+O,EAAMM,MAAQrO,EACd+N,EAAMjN,KAAOlB,CACb,IAAI0O,GAAuB9M,EAAQ4M,KAAK,MACxCL,GAAMQ,SAAWvP,EAAsBzB,mBAAmBwQ,EAAM/D,MAAM7N,MACtE4R,EAAMS,kBAAqBC,WAAczP,EAAsBnF,OAAO6U,MAAMC,WAG5EZ,EAAMa,OAAO,gBAAiB,SAAUC,EAAUC,GAC5CD,GAAYC,GACdf,EAAMgB,WAIVhB,EAAMa,OAAO,iBAAkB,SAAUC,EAAUC,GAC7CA,EAAS1J,KAAOyJ,EAASzJ,IAAM0J,EAASzJ,KAAOwJ,EAASxJ,IAAMyJ,EAAS3N,cAAgB0N,EAAS1N,aAClG4M,EAAMiB,mBACNjB,EAAMkB,mBAENlB,EAAMkB,oBAEP,GAEHlB,EAAMa,OAAO,eAAgB,SAAUC,EAAUC,GAE3Cf,EAAMxN,GAAG2O,yBAA2BnB,EAAM/D,MAAM7N,OAClD4R,EAAMiB,mBACNjB,EAAMkB,qBAEP,GAEHlB,EAAMa,OAAO,uBAAwB,SAAUC,EAAUC,GACtC3T,SAAb0T,GACFd,EAAMkB,oBAEP,GAEHlB,EAAMa,OAAO,0BAA2B,WAClCb,EAAM/D,MAAM7N,OAAS4R,EAAMxN,GAAG4O,mBAChCpB,EAAMiB,mBAERjB,EAAMkB,oBACL,GAEHlB,EAAMa,OAAO,oBAAqB,WAChCb,EAAMkB,oBACL,GAEHlB,EAAMa,OAAO,8BAA+B,WAC1Cb,EAAMiB,mBACNjB,EAAMkB,oBACL,GAEHlB,EAAMa,OAAO,oBAAqB,SAAUC,EAAUC,IAChDD,EAAS1S,OAAS2S,EAAS3S,MAAQ0S,EAAStH,UAAYuH,EAASvH,WACnEwG,EAAMiB,mBACNjB,EAAMkB,qBAEP,GAGHlB,EAAMgB,OAAS,WACbhB,EAAMiB,mBACNjB,EAAMkB,mBAKRlB,EAAMqB,iBAAmB,SAAUC,EAAa/F,GAC9C,GAAIgG,GAAavB,EAAMxN,GAAG2J,cAAc6D,EAAM/D,MAAM7N,KAChDmT,KAAeD,IAEjBtB,EAAMxN,GAAGgP,cAAcxB,EAAM/D,MAAM7N,KAAMkT,EAAa/F,GACjD9H,EAAQgO,SAAS,+BACpBzB,EAAMxN,GAAGkP,YAAW,GACpBtQ,EAAauC,iBACbkM,EAAS8B,SAASpB,EAAsB,6BAA6BlL,KAAK,WACxEwK,EAAS+B,YAAYrB,EAAsB,6BAE3CP,EAAMiB,mBACNjB,EAAMkB,uBAQdlB,EAAM6B,mBAAqB,SAAUP,GACnC,GAAIQ,GACAP,EAAavB,EAAMxN,GAAG2J,cAAc6D,EAAM/D,MAAM7N,KAMpD,OAJE0T,GADER,IAAgBC,GACLb,WAAc,6FAEdqB,mBAAoB,UAIrC/B,EAAMgC,WAAa,WACbtV,EAAEC,cAAcqT,EAAM7N,MAG1B6N,EAAMiB,oBAKRxN,EAAQC,KAAK,aAAc,WACzBsM,EAAMxN,GAAGyP,gBAAgB7U,OAAWA,OAAWA,QAC/C4S,EAAMkB,oBAMRlB,EAAMiB,iBAAmB,WACvB,GAAIiB,GAAuE,EAA5DjR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,IACjEf,EAAavB,EAAMxN,GAAG2J,cAAc6D,EAAM/D,MAAM7N,MAChDmU,EAA4C,SAAnC9O,EAAQ+O,SAASC,IAAI,WAAuB,GAAQ,CACjE,KAAI/V,EAAEC,cAAcqT,EAAM/D,SAItBvP,EAAEC,cAAcqT,EAAMxN,MAItB9F,EAAEC,cAAcqT,EAAM7N,KAA1B,CAIA,GAAIuQ,GAAMtC,EAAO,GAAGuC,WAAW,KAC/BD,GAAIE,UAAU,EAAG,EAAGxC,EAAO,GAAGyC,MAAOzC,EAAO,GAAG0C,OAE/C,IAAIC,GAAOC,EAAMC,CACjBF,GAAQ/C,EAAMxN,GAAG0Q,cAAc9C,EAAO,GAAGyC,MAEzC,IAAIM,GAAST,EAAItC,OAAO0C,OAASJ,EAAItC,OAAOgD,YACxCpD,GAAM/D,MAAM7N,OAASmT,EACnBgB,EACFrR,EAAiBmS,4BAA4BX,EAAK1C,EAAM/D,MAAM7N,KAAM,IAAM4R,EAAM/D,MAAM1G,KAAO,IAAK2M,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGZ,EAAItC,OAAO0C,OAAS,EAAIZ,EAAWiB,EAAQlS,EAAsBnF,OAAO6U,MAAM4C,OAAO,IAEpPrB,GAAY,EACZhR,EAAiBsS,oBAAoBd,EAAK1C,EAAM/D,MAAM7N,KAAM8T,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGZ,EAAItC,OAAO0C,OAAS,EAAIZ,EAAWiB,EAAS,EAAGlS,EAAsBnF,OAAO6U,MAAM4C,QAG7MrS,EAAiBmS,4BAA4BX,EAAK1C,EAAM/D,MAAM7N,KAAO,IAAMmT,EAAY,IAAMvB,EAAM/D,MAAM1G,KAAO,IAAK2M,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGZ,EAAItC,OAAO0C,OAAS,EAAIZ,EAAWiB,EAAQlS,EAAsBnF,OAAO6U,MAAM4C,OAAO,EAEzQ,IAGIE,IAHSzD,EAAMxN,GAAGkR,kBACT1D,EAAMxN,GAAGmR,mBACR3D,EAAMxN,GAAGoK,uBACX,IAGRgH,EAAelB,EAAImB,YAAY,KAAKhB,MAAQ3R,EAAiB4S,OAG7DC,EAAkBrB,EAAImB,YAAY,KAAKhB,MAAQ3R,EAAiB4S,MACpE,IAAyB,YAArB9D,EAAM/D,MAAM1G,KAAoB,CAClCmN,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,KAEnD,IAAItP,GAAI+L,EAAM/D,MAAMC,KACpBjI,GAAErH,QAAQ,SAAUqX,GAElB,KADER,EACEQ,EAAOC,aAAelE,EAAMxN,GAAG4E,YAAYC,IAAM4M,EAAOC,aAAelE,EAAMxN,GAAG4E,YAAYE,IAAM2M,EAAOC,YAAcD,EAAOE,UAAYnE,EAAMxN,GAAG4E,YAAYC,IAAM4M,EAAOC,YAAcD,EAAOE,UAAYnE,EAAMxN,GAAG4E,YAAYE,IAAM2M,EAAOC,YAAclE,EAAMxN,GAAG4E,YAAYC,IAAM4M,EAAOC,YAAcD,EAAOE,UAAYnE,EAAMxN,GAAG4E,YAAYE,GAAI,CAE3V,GAAI8M,EAwBJ,IAvBAH,EAAOI,OAAOzX,QAAQ,SAAU0X,GAC1BA,EAAIlW,OAASmT,IACf6C,EAAYE,EAAIvW,SAIpBiV,EAAOhD,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOC,aAC/CjB,EAAOjD,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOC,YAAcD,EAAOE,UAAY,GAChFzB,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,MACnDb,EAAI8B,SAASxB,EAAM,EAAG,EAAG5C,EAAO,GAAG0C,OAAS,GAE5CJ,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM8D,KACnD/B,EAAI8B,SAASvB,EAAM7C,EAAO,GAAG0C,OAAS,EAAG,EAAG1C,EAAO,GAAG0C,QACtDJ,EAAIP,KAAOD,EAAW,EAAI,MAAajR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAE7DlW,SAAdgX,GAA2BnB,EAAOD,EAAOY,EAAeQ,EAAUtZ,SAChEyX,EACFrR,EAAiBsS,oBAAoBd,EAAK0B,EAAWlC,EAAW,EAAGjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQN,GAAQC,EAAOD,GAAQ,EAAIN,EAAImB,YAAYO,GAAWvB,MAAQ,EAAI,EAAGzC,EAAO,GAAG0C,OAAS,GAAKZ,EAAW,GAAK,EAAGjR,EAAsBnF,OAAO6U,MAAM4C,OAEtQrS,EAAiBsS,oBAAoBd,EAAK0B,EAAWlC,EAAW,EAAGjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQN,GAAQC,EAAOD,GAAQ,EAAIN,EAAImB,YAAYO,GAAWvB,MAAQ,EAAI,EAAGzC,EAAO,GAAG0C,OAAS,EAAIZ,EAAW,EAAGjR,EAAsBnF,OAAO6U,MAAM4C,QAIhQvD,EAAMxK,MAAsBpI,SAAdgX,GAAgD,IAArBA,EAAUtZ,OAAc,CAEnE,GAAI4Z,GAAc1B,GAAQC,EAAOD,GAAQ,EACrC2B,EAAMvE,EAAO,GAAG0C,OAAS,CAE7BJ,GAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4C,MACrDb,EAAImC,YACJnC,EAAIoC,OAAO9B,EAAM2B,GACjBjC,EAAIqC,OAAOL,EAAaC,GACxBjC,EAAIqC,OAAOL,EAAaC,EAAM,GAC9BjC,EAAIsC,SACJL,EAAMvE,EAAO,GAAG0C,OAAS,EAAI,EAE7BJ,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM8D,KACrD/B,EAAImC,YACJnC,EAAIoC,OAAO7B,EAAM0B,GACjBjC,EAAIqC,OAAOL,EAAaC,GACxBjC,EAAIqC,OAAOL,EAAaC,EAAM,GAC9BjC,EAAIsC,SAIF/B,EAAOD,EAAOe,EAAkBE,EAAOC,YAAYe,WAAWna,QAAUyX,GAC1ErR,EAAiBsS,oBAAoBd,EAAKuB,EAAOC,YAAahC,EAAW,EAAGjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQN,EAAO,EAAG,EAAG/R,EAAsBnF,OAAO6U,MAAM8D,KAG9K,IAAIS,GAAU,QAAUjB,EAAOE,UAAY,GAEvClB,GAAOD,EAAOe,EAAkBmB,EAAQpa,QAAUyX,GACpDrR,EAAiBsS,oBAAoBd,EAAKwC,EAAShD,EAAW,EAAGjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQL,EAAOP,EAAImB,YAAYqB,GAASrC,MAAQ3R,EAAiB4S,OAAQ1D,EAAO,GAAG0C,OAAS,EAAI,EAAG7R,EAAsBnF,OAAO6U,MAAM8D,aAIhP,IAAyB,UAArBzE,EAAM/D,MAAM1G,KAAkB,CACvCmN,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,KAEnD,IAAI4B,EACJnF,GAAM/D,MAAMC,MAAMtP,QAAQ,SAAUqX,GAClC,GAAIA,EAAOmB,YAAcpF,EAAMxN,GAAG4E,YAAYC,IAAM4M,EAAOmB,YAAcpF,EAAMxN,GAAG4E,YAAYE,GAAI,CAChG6N,EAAOE,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOmB,aAAerC,EAAQ,EAEjF,IAAIqB,EACJH,GAAOI,OAAOzX,QAAQ,SAAU0X,GAC1BA,EAAIlW,OAASmT,IACf6C,EAAYE,EAAIvW,SAGpB2U,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,MACnDb,EAAI8B,SAASW,EAAM,EAAG,EAAG/E,EAAO,GAAG0C,OAAS,EAAI1C,EAAO,GAAG0C,OAAS,IACnEJ,EAAI8B,SAASW,EAAM/E,EAAO,GAAG0C,OAAS,EAAI1C,EAAO,GAAG0C,OAAS,GAAI,EAAG1C,EAAO,GAAG0C,OAAS,EAAI1C,EAAO,GAAG0C,OAAS,IAC9G5R,EAAiBsS,oBAAoBd,EAAK0B,EAAWlC,EAAW,EAAGjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ6B,EAAO,EAAG/E,EAAO,GAAG0C,OAAS,EAAG7R,EAAsBnF,OAAO6U,MAAM4C,OAClLhB,GACFrR,EAAiBsS,oBAAoBd,EAAKuB,EAAOmB,YAAalD,EAAW,EAAGjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ6B,EAAO,EAAG,EAAGlU,EAAsBnF,OAAO6U,MAAM8D,YAStLzE,EAAMkB,gBAAkB,WACtB,GAAIwB,GAAMtC,EAAO,GAAGuC,WAAW,KAC/BD,GAAIE,UAAU,EAAG,EAAGxC,EAAO,GAAGyC,MAAOzC,EAAO,GAAG0C,QAC3C9C,EAAM/D,MAAM7N,OAAS4R,EAAMxN,GAAGoK,yBAChC8F,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYd,KAC/D/B,EAAI8B,SAAS,EAAG,EAAGpE,EAAO,GAAGyC,MAAOzC,EAAO,GAAG0C,SAGhDpR,EAAkB8T,uBAAuB9C,GAEzChR,EAAkB+T,wBAAwB/C,EAC1C,IAAIM,GAAMC,EAAMF,EAAO2C,EAASzB,CAChCjB,GAAOhD,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAO7C,EAAMxN,GAAG4E,YAAY0H,SAC7DmE,EAAOjD,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAO7C,EAAMxN,GAAG4E,YAAY2H,SAC7DgE,EAAQ/C,EAAMxN,GAAG0Q,cAAc9C,EAAO,GAAGyC,MACzC,IAAI8C,GAAS3F,EAAMxN,GAAGkR,kBAClBkC,EAAU5F,EAAMxN,GAAGqT,qBACnBC,EAAS9F,EAAMxN,GAAGuT,oBAClBC,EAAchG,EAAMxN,GAAGmR,mBACvBsC,EAAUjG,EAAMxN,GAAGoK,sBACHxP,UAAhB4Y,GAEEhG,EAAM/D,MAAM7N,OAAS6X,GAAWD,EAAYlb,OAAS,GACvDkb,EAAYpZ,QAAQ,SAAUsZ,GACjB9Y,SAAP8Y,IAEqB9Y,SAAnB8Y,EAAGhC,aACLlB,EAAOqC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOqD,EAAGhC,cACtDjB,EAAOoC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOqD,EAAGhC,YAAcgC,EAAG/B,UAAY,MAEnFnB,EAAOqC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOqD,EAAGd,aAAerC,EAAQ,GAC7EC,GAAc,EACdC,EAAOD,EAAO,IAEhBN,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYY,OAC/DzD,EAAI8B,SAASxB,EAAM,EAAGC,EAAOD,EAAM5C,EAAO,GAAG0C,QAC7CJ,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,SAM3DU,EAASjE,EAAMxN,GAAGkR,kBACd1D,EAAM/D,MAAMC,MAAMpR,OAAS,GAAgBsC,SAAX6W,GAAmC7W,SAAXuY,GAAwB3F,EAAM/D,MAAM7N,OAAS4R,EAAMxN,GAAG2O,yBAChHuB,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAMyF,KAC/CR,KAAY,EAE0B,YAApC5F,EAAMxN,GAAG6T,yBACXpC,EAASjE,EAAM/D,MAAMC,MAAM,GAC3B8G,EAAOqC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOC,cAC1DxB,EAAI8B,SAASxB,EAAM,EAAG,EAAG5C,EAAO,GAAG0C,SAE5BgD,KAAW,EAEoB,YAApC9F,EAAMxN,GAAG6T,yBACXpC,EAASjE,EAAM/D,MAAMC,MAAM8D,EAAM/D,MAAMC,MAAMpR,OAAS,GACtDkY,EAAOqC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOC,YAAcD,EAAOE,UAAY,IAE3FzB,EAAI8B,SAASxB,EAAM,EAAG,EAAG5C,EAAO,GAAG0C,SAIG,YAApC9C,EAAMxN,GAAG6T,wBACXrD,EAAOqC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOC,cAC1DxB,EAAI8B,SAASxB,EAAM,EAAG,EAAG5C,EAAO,GAAG0C,UAEnCE,EAAOqC,KAAKC,MAAMtF,EAAMxN,GAAG+R,OAAOnE,EAAO,GAAGyC,MAAOoB,EAAOmB,cAC1DM,EAAU3C,EAAQ,EAClBL,EAAI8B,SAASxB,EAAO0C,EAAS,EAAG,EAAGtF,EAAO,GAAG0C,SAGjDJ,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,aAQ/DnY,QAAQC,OAAO,aAAauU,UAAU,QACpC,WACA,YACA,sBACA,wBACA,oBACA,wBACA,SAAUlP,EAAU/E,EAAWqF,EAAqBC,EAAuBS,EAAmBG,GAC5F,OACEiO,YAAa,kBACb/C,SAAS,EACTgD,SAAU,IACVC,SACA3P,YACE,SACA,SAAUC,GACRA,EAAOgW,cAAgB,eAI3BpG,KAAM,SAAkBF,EAAOvM,EAAS8S,GAEtC,GAAIC,GAAe/S,EAAQ4M,KAAK,UAAUvV,OACtCsV,EAAS3M,EAAQ4M,KAAK,UAAU,GAChCoG,EAAehT,EAAQ4M,KAAK,UAAUmG,EAAe,EAEzDxG,GAAMjQ,MAAQwW,EAAMxW,MACpBiQ,EAAMvR,UAAY8X,EAAM9X,UACxBuR,EAAM7N,IAAMlB,EACZ+O,EAAMrU,UAAYA,EAClBqU,EAAMjN,KAAOlB,EAIbmO,EAAMa,OAAO,uBAAwB,SAAUC,EAAUC,GACnDD,GAAYC,GACdf,EAAM0G,iBAAiB1G,EAAO/O,GAAuB,KAIzD+O,EAAMa,OAAO,yBAA0B,WACrCnQ,EAASsP,EAAMgB,OAAQ/P,EAAsBnF,OAAO2K,UAAUkQ,YAGhE3G,EAAMa,OAAO,8BAA+B,WAC1Cb,EAAM0G,iBAAiB1G,EAAO/O,GAAuB,KACpD,GAEH+O,EAAMa,OAAO,mCAAoC,WAC1CnU,EAAEC,cAAcqE,IACdtE,EAAEC,cAAcqE,EAAoBmG,SACvC6I,EAAM4G,aAAa5G,EAAO/O,KAG7B,GAEH+O,EAAMa,OAAO,iCAAkC,SAAUC,GAClDpU,EAAEC,cAAcqE,IACdtE,EAAEC,cAAcqE,EAAoBmG,SACvC6I,EAAM0G,iBAAiB1G,EAAO/O,GAAuB,KAGxD,GAEH+O,EAAMa,OAAO,2BAA4B,WAClCnU,EAAEC,cAAcqE,IACdtE,EAAEC,cAAcqE,EAAoBmG,SACvC6I,EAAM0G,iBAAiB1G,EAAO/O,GAAuB,KAGxD,GAEH+O,EAAMa,OAAO,wBAAyB,SAAUC,EAAUC,GACxD,IAAKrU,EAAEC,cAAcqE,KACdtE,EAAEC,cAAcqE,EAAoBmG,QAAS,CAEhD,GAAI4J,EAAS1J,KAAOyJ,EAASzJ,IAAM0J,EAASzJ,KAAOwJ,EAASxJ,GAAI,CAC9D,GAAIuP,GAAcnV,EAAkBoV,eAAenb,EAAWyU,EAAQpP,EAAoBmG,OAAOI,KACjG7F,GAAkBqV,UAAYF,EAC9BnV,EAAkBsV,4BAA4Brb,EAAWyU,EAAQ1O,EAAkBqV,UAAW/V,EAAoBmG,OAAOI,KAAMtG,GAEjI+O,EAAM0G,iBAAiB1G,EAAO/O,GAAuB,MAGxD,GAEH+O,EAAMa,OAAO,oBAAqB,SAAUC,EAAUC,GACpD,GAAID,EAAS1S,OAAS2S,EAAS3S,MAAQ0S,EAAStH,UAAYuH,EAASvH,QAAS,CAC5E,GAAIqN,GAAcnV,EAAkBoV,eAAenb,EAAWyU,EAAQpP,EAAoBmG,OAAOI,KACjG7F,GAAkBqV,UAAYF,EAC9BnV,EAAkBsV,4BAA4Brb,EAAWyU,EAAQ1O,EAAkBqV,UAAW/V,EAAoBmG,OAAOI,KAAMtG,MAEhI,GAGH+O,EAAMgB,OAAS,WACbhB,EAAM0G,iBAAiB1G,EAAO/O,GAAuB,IAKvD+O,EAAM4G,aAAe,SAAU5G,EAAO1U,GACpC,GAAIoX,GAAM+D,EAAa9D,WAAW,KAClCD,GAAIE,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,OACzC,IAAIE,GAAOrX,EAAU4Y,OAAOkC,EAAa5D,MAAOlX,EAAUsb,uBAAuB5P,IAC7E6P,EAASvb,EAAU4Y,OAAOkC,EAAa5D,MAAOlX,EAAUsb,uBAAuBE,KACnFzE,GAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYd,KAC/D/B,EAAI8B,SAASxB,EAAM,EAAGkE,EAASlE,EAAM5C,EAAO0C,QAC5C9C,EAAM0G,iBAAiB1G,EAAO1U,GAAQ,IAOxC0U,EAAM0G,iBAAmB,SAAU1G,EAAO1U,EAAQ8b,GAChD,GAAI1E,GAAM+D,EAAa9D,WAAW,KAC9ByE,IACF1E,EAAIE,UAAU,EAAG,EAAG6D,EAAa5D,MAAO4D,EAAa3D,QAGvDpR,EAAkB8T,uBAAuB9C,GACzChR,EAAkB2V,kBAAkB3E,GAAK,GAEzChR,EAAkB+T,wBAAwB/C,GAAK,SAOzDtX,QAAQC,OAAO,aAAauU,UAAU,WACpC,YACA,sBACA,oBACA,wBACA,SAAUjU,EAAWqF,EAAqBU,EAAmBT,GAC3D,OACE6O,YAAa,qBACbC,SAAU,IACVC,OAASsH,kBAAmB,KAC5BpH,KAAM,SAAkBF,EAAOvM,GAE7B,GAAI2M,GAAS3M,EAAQ4M,KAAK,UAAU,GAChCoG,EAAehT,EAAQ4M,KAAK,UAAU,GACtCkH,GAAc,CAElBvH,GAAMxN,GAAK7G,EACXqU,EAAMtN,IAAM1B,EACZgP,EAAMS,kBACJC,WAAc,OACd8G,OAAU,iBACV3E,MAAS,OACTC,OAAU,QAKZ9C,EAAMa,OAAO,iBAAkB,SAAU4G,EAAQC,GAC1Chb,EAAEC,cAAcqE,EAAoBmG,UACnCuQ,EAAOrQ,KAAOoQ,EAAOpQ,IAAMqQ,EAAOpQ,KAAOmQ,EAAOnQ,KAClD0I,EAAM2H,gBAGT,GAEH3H,EAAMa,OAAO,oBAAqB,WAYhC,GAXKnU,EAAEC,cAAcqE,EAAoBmG,UACvCoQ,GAAc,EACdvH,EAAMS,kBACJC,WAAczP,EAAsBnF,OAAO6U,MAAMC,UACjD4G,OAAU,iBACV3E,MAAS,OACTC,OAAU,QAEZ9C,EAAM2H,eAGwB,KAA5B3H,EAAMsH,kBAA0B,CAClC,GAAI5E,GAAMtC,EAAOuC,WAAW,MACxBiF,EAAYnB,EAAa9D,WAAW,KACxCD,GAAIE,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,QACzC8E,EAAUhF,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,WAEhD,GAMH9C,EAAM2H,YAAc,WAClB,GAAKJ,EAOHvH,EAAM0G,iBAAiB/a,EAAWyU,EAAQnP,OAP1B,CAChB,GAAI4V,GAAcnV,EAAkBoV,eAAenb,EAAWyU,EAAQpP,EAAoBmG,OAAOI,KACjG7F,GAAkBqV,UAAYF,EAC9BnV,EAAkBsV,4BAA4Brb,EAAWyU,EAAQ1O,EAAkBqV,UAAW/V,EAAoBmG,OAAOI,KAAMtG,GAC/HsW,GAAc,EACdvH,EAAM0G,iBAAiB/a,EAAWyU,EAAQnP,KAU9C+O,EAAM0G,iBAAmB,SAAUlU,EAAI4N,EAAQ9U,GAC7C,GAAIoX,GAAM+D,EAAa9D,WAAW,MAC9BK,EAAOyD,EAAa5D,MAAQ7R,EAAoBmG,OAAOI,KAAKzM,OAAS0H,EAAG4E,YAAYC,GACpF4L,EAAOwD,EAAa5D,MAAQ7R,EAAoBmG,OAAOI,KAAKzM,OAAS0H,EAAG4E,YAAYE,EACxFoL,GAAIE,UAAU,EAAG,EAAG6D,EAAa5D,MAAO4D,EAAa3D,QACrDJ,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYd,KAC/D/B,EAAI8B,SAASxB,EAAM,EAAGC,EAAOD,EAAMyD,EAAa3D,QAChDJ,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4E,YAAYhC,MACjEb,EAAImC,YACJnC,EAAIoC,OAAO9B,EAAM,GACjBN,EAAIqC,OAAO/B,EAAMyD,EAAa3D,QAC9BJ,EAAIoC,OAAO7B,EAAM,GACjBP,EAAIqC,OAAO9B,EAAMwD,EAAa3D,QAC9BJ,EAAImF,YACJnF,EAAIsC,eAOd5Z,QAAQC,OAAO,aAAauU,UAAU,qBACpC,iBACA,SAAU9O,GACR,OACEgP,YAAa,+BACbC,SAAU,IACVhD,SAAS,EACTiD,SACAE,KAAM,SAAkBF,EAAOvM,EAAS0M,GACtCH,EAAM8H,QAAU,GAChB9H,EAAM+H,gBAAkB,SAAUC,EAAUha,EAAKuN,GAC/CzK,EAAewL,mBACb/G,KAAM,SACNgH,OAAQ,WACRyL,SAAUA,EACVha,IAAKA,EACLuN,MAAOA,KAGXyE,EAAMiI,cAAgB,SAAUC,EAAQla,EAAKuN,GAC3CzK,EAAeqX,oBACb5S,KAAM,SACNgH,OAAQ,UACR6L,QAASpI,EAAM8H,QACfA,QAASI,EAAOJ,QAChB9Z,IAAKA,EACLuN,MAAOA,KAGXyE,EAAMqI,WAAa,WACjBvX,EAAewD,8BAEjB0L,EAAMsI,aAAe,SAAUJ,GAC7BlI,EAAM8H,QAAUI,EAAOJ,cAOjC1c,QAAQC,OAAO,aAAauU,UAAU,WACpC,WACA,YACA,wBACA,oBACA,mBACA,sBACA,oBACA,wBACA,SAAUlP,EAAU/E,EAAWsF,EAAuBS,EAAmBR,EAAkBF,EAAqBuX,EAAmB1W,GACjI,OACEiO,YAAa,qBACbC,SAAU,IACVhD,SAAS,EACTiD,SACAE,KAAM,SAAkBF,EAAOvM,EAAS8S;AACtCvG,EAAMtN,IAAM1B,EACZgP,EAAMjQ,MAAQwW,EAAMxW,MACpBiQ,EAAMxN,GAAK7G,EACXqU,EAAM7N,IAAMlB,EACZ+O,EAAMrN,IAAMjB,EACZsO,EAAMjN,KAAOlB,EACbmO,EAAMvR,UAAY8X,EAAM9X,UAExBuR,EAAMwI,QAAU/U,EAAQ4M,KAAK,UAAU,GACvCL,EAAMyI,QAAUhV,EAAQ4M,KAAK,UAAU5M,EAAQ4M,KAAK,UAAUvV,OAAS,GACvEkV,EAAM0I,QAAU1I,EAAMwI,QAAQ7F,WAAW,MACzC3C,EAAM2I,UAAY3I,EAAMyI,QAAQ9F,WAAW,MAG3C3C,EAAM4I,MAAQ,IACd5I,EAAM6I,iBAAmB5e,OAAO4e,kBAAoB,EAEpD7I,EAAM8I,YAAc,GAAIte,sBAIxBwV,EAAMa,OAAO,kBAAmB,WACzBnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7BzG,EAASsP,EAAM+I,wBAAyB9X,EAAsBnF,OAAO2K,UAAUkQ,YAKrF3G,EAAMa,OAAO,uBAAwB,SAAUC,EAAUC,GACnDD,GAAYC,GAAarU,EAAEC,cAAcqT,EAAMtN,MAAShG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SACpF6I,EAAM+I,4BAGV/I,EAAMa,OAAO,iBAAkB,WACxBnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7BzG,EAASsP,EAAM+I,wBAAyB9X,EAAsBnF,OAAO2K,UAAUkQ,YAIrF3G,EAAMa,OAAO,iBAAkB,SAAUC,EAAUC,GAC5CrU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,WAEzB4J,EAAS1J,KAAOyJ,EAASzJ,IAAM0J,EAASzJ,KAAOwJ,EAASxJ,KAC1D0I,EAAMgB,SAERhB,EAAM+I,6BAGT,GACH/I,EAAMa,OAAO,0BAA2B,WACjCnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7B6I,EAAM+I,4BAGT,GACH/I,EAAMa,OAAO,oBAAqB,WAC3BnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAE7B6I,EAAM+I,4BAGT,GACH/I,EAAMa,OAAO,qBAAsB,WAC5BnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,UAC7B6I,EAAMgJ,aACNhJ,EAAMgB,YAGT,GAEHhB,EAAMa,OAAO,oBAAqB,SAAUC,EAAUC,GAC/CrU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,UACzB2J,EAAS1S,OAAS2S,EAAS3S,MAAQ0S,EAAStH,UAAYuH,EAASvH,UACnEwG,EAAMgB,WAIX,GAGHhB,EAAMgB,OAAS,WACbhB,EAAM2I,UAAU/F,UAAU,EAAG,EAAG5C,EAAMyI,QAAQ5F,MAAO7C,EAAMyI,QAAQ3F,QACnE9C,EAAMiJ,YAAYjJ,EAAMtN,IAAIyE,OAAOI,OAErCyI,EAAMiJ,YAAc,SAAUC,GAC5BlJ,EAAMmJ,6BACNnJ,EAAMoJ,4BAA4BF,IAEpClJ,EAAMqJ,kBAAoB,WACxB,OAAQrJ,EAAMxN,GAAG4E,YAAYE,GAAK,EAAI0I,EAAMxN,GAAG4E,YAAYC,IAAM2I,EAAMwI,QAAQ3F,OAEjF7C,EAAM+I,wBAA0B,WAC9B/I,EAAM2I,UAAU/F,UAAU,EAAG,EAAG5C,EAAMyI,QAAQ5F,MAAO7C,EAAMyI,QAAQ3F,QACnE9C,EAAMsJ,mBAERtJ,EAAMsJ,gBAAkB,WAEtBtJ,EAAMrN,IAAI6S,uBAAuBxF,EAAM2I,WAEvC3I,EAAMrN,IAAI8S,wBAAwBzF,EAAM2I,WAAW,GAEnD3I,EAAMrN,IAAI4W,kBAAkBvJ,EAAM2I,UAAW,GAAI3I,EAAMxN,GAAGgX,gBAAgB3P,UAAWmG,EAAMxN,GAAGgX,gBAAgB1P,QAAS,IAEzHkG,EAAMmJ,2BAA6B,WACjCnJ,EAAM0I,QAAQ1E,UAAY/S,EAAsBnF,OAAO6U,MAAMC,UAC7DZ,EAAM0I,QAAQlE,SAAS,EAAG,EAAGxE,EAAMwI,QAAQ3F,MAAO7C,EAAMwI,QAAQ1F,QAEhE9C,EAAMrN,IAAI8S,wBAAwBzF,EAAM2I,WAAW,GACnDzX,EAAiBsS,oBAAoBxD,EAAM0I,QAAS,eAA4E,IAA5DzX,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,IAAYrR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,GAAI,GAAIrS,EAAsBnF,OAAO6U,MAAM4C,OAAO,GAC9M,OAAtBvD,EAAM8I,cACR9I,EAAM8I,YAAYW,OAClBzJ,EAAM8I,YAAc,OAGxB9I,EAAMgJ,WAAa,WACjB,GAAIU,GAAY1J,EAAM0I,QAAQiB,gBAAgB3J,EAAMwI,QAAQ3F,MAAO7C,EAAMwI,QAAQ1F,OACjF9C,GAAM8I,YAAYc,KAAK,SAAU/U,GAC/B,GAAqBzH,SAAjByH,EAAMwD,QACR,GAAI2H,EAAMqJ,sBAAwBxU,EAAMgV,cAAe,CACrD,GAAI5W,GAAM,GAAI6W,mBAAkBjV,EAAMkV,IACtCL,GAAUnd,KAAKyd,IAAI/W,GACnB+M,EAAM0I,QAAQuB,aAAaP,EAAW,EAAG,GACzC1J,EAAMsJ,uBAGRjc,SAAQC,MAAM,+BAAgCuH,EAAMwD,OAAO/C,YAIjE0K,EAAMoJ,4BAA8B,SAAUF,GAC5C,GAAIA,EAAOpe,OAAS,EAAG,CACrBkV,EAAM8I,YAAc,GAAIte,qBACxB,IAAI0f,MACAC,EAAO5B,EAAkB6B,sBAAsBpK,EAAMtN,IAAIyE,OAAOkT,WAAarK,EAAMxN,GAAGgX,gBAAgB5P,iBAE/F,KAAPuQ,IACFA,EAAO,KAGTD,EAAYhB,EAAOte,SAASoV,EAAMxN,GAAG4E,YAAYC,GAAI2I,EAAMxN,GAAG4E,YAAYE,GAC1E,IAAIgT,MACAC,KAEAC,EAAsBxK,EAAMtN,IAAIyE,OAAOkT,WAAarK,EAAMxN,GAAGgX,gBAAgB5P,gBAC7EoG,GAAMxN,GAAG4E,YAAYC,GAAKmT,EAAsB,IAElDF,EAAcpB,EAAOte,SAASoV,EAAMxN,GAAG4E,YAAYC,GAAKmT,EAAsB,EAAGxK,EAAMxN,GAAG4E,YAAYC,KAGpG2I,EAAMxN,GAAG4E,YAAYE,GAAK6S,EAAO,EAAI,GAAKnK,EAAMtN,IAAIyE,OAAOI,KAAKzM,SAElEyf,EAAerB,EAAOte,SAASoV,EAAMxN,GAAG4E,YAAYE,GAAI0I,EAAMxN,GAAG4E,YAAYE,GAAK6S,EAAO,EAAI,GAG/F,IAAIM,GAAgB,GAAIC,cAAaJ,EAAYxf,OAASof,EAAUpf,OAASyf,EAAazf,OAC1F2f,GAAcT,IAAIM,GAClBG,EAAcT,IAAIE,EAAWI,EAAYxf,QACzC2f,EAAcT,IAAIO,EAAcD,EAAYxf,OAASof,EAAUpf,QAG7Dof,EAFElK,EAAMxN,GAAG4E,YAAYC,IAAM8S,EAAO,EAExBjB,EAAOte,SAASoV,EAAMxN,GAAG4E,YAAYC,GAAK8S,EAAO,EAAGnK,EAAMxN,GAAG4E,YAAYE,GAAK6S,GAG9EjB,EAAOte,SAASoV,EAAMxN,GAAG4E,YAAYC,GAAI2I,EAAMxN,GAAG4E,YAAYE,GAAK6S,GAEjFnK,EAAMgJ,aACNhJ,EAAM8I,YAAY6B,MAChB/Q,iBAAoBoG,EAAMxN,GAAGgX,gBAAgB5P,iBAC7CuQ,KAAQA,EACRvB,MAAS5I,EAAM4I,MACfgC,UAAa5K,EAAMxN,GAAGgX,gBAAgB1P,QACtC+Q,UAAa7K,EAAMxN,GAAGgX,gBAAgB3P,UACtCgQ,cAAiB7J,EAAMqJ,oBACvBpf,OAAU+V,EAAMxN,GAAGgX,gBAAgBvf,OACnC6gB,SAAY9K,EAAMwI,QAAQ3F,MAC1BkI,UAAa/K,EAAMwI,QAAQ1F,OAC3BkI,aAAgBhL,EAAMxN,GAAGgX,gBAAgBzP,aACzCkR,WAAcjL,EAAM6I,iBACpBqC,WAAclL,EAAMtN,IAAIyE,OAAOkT,WAC/Bc,aAAgBnL,EAAM7N,IAAItG,KAAK8N,oBAAoBwR,aACnDC,YAAeX,EACfY,oBAAuBrL,EAAMtN,IAAIyE,OAAOmU,YACxCtR,kBAAqBgG,EAAMxN,GAAGgX,gBAAgBxP,kBAC9CC,wBAA2B+F,EAAMxN,GAAGgX,gBAAgBvP,wBACpDC,oBAAuB8F,EAAMxN,GAAGgX,gBAAgBtP,sBAC9CuQ,EAAcvB,gBAQ9B9d,QAAQC,OAAO,aAAagF,WAAW,cACrC,SACA,eACA,kBACA,YACA,iBACA,SAAUC,EAAQ2B,EAAcC,EAAiBvG,EAAWmF,GAC1DR,EAAOib,QAAUrZ,EAAgBiH,UAAUqS,UAI3Clb,EAAOmb,QAAU,WACf,GAAIC,EACJ,KACEA,EAAO,GAAIC,OAAM1Z,EAAa2Z,aAAerW,KAAM,eACnD,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAO1b,EAAO2b,YACnBP,EAAOA,EAAKD,UAEd,MAAOC,IAKTpb,EAAO4b,qBAAuB,WAC5Bpb,EAAemN,sBAAwB,GAKzC3N,EAAOqL,kBAAoB,WACzBhQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOuL,qBAAuB,WAC5BlQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAAA,UAAgB,WACd,GAAI6b,EAEFA,GADiB,gBAARC,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBhc,EAAOmb,WAEjCW,IAAIE,gBAAgBhc,EAAOmb,WAEtCnb,EAAOic,WAAWJ,EAAQla,EAAaua,QACvCva,EAAawa,SAKfnc,EAAOic,WAAa,SAAUG,EAASC,GACrC,GAAIC,GAAOC,SAASC,cAAc,IAClC,IAAIxc,EAAOib,QACTqB,EAAKG,aAAa,WAAYJ,GAC9BC,EAAKI,KAAON,EACZE,EAAKK,UAAY,GACjBL,EAAKM,MAAMC,QAAU,OACrBN,SAASO,KAAKC,YAAYT,GAC1BA,EAAKU,YACA,CACLV,EAAKI,KAAON,EACZE,EAAKW,OAAS,SACdX,EAAKY,SAAWb,GAAY,SAC5B,IAAI9X,GAAQgY,SAASY,YAAY,QACjC5Y,GAAM6Y,UAAU,SAAS,GAAM,GAC/Bd,EAAKe,cAAc9Y,IAClB5K,OAAOmiB,KAAOniB,OAAOoiB,WAAWuB,gBAAgBhB,EAAKI,MAExD1c,EAAO4b,2BAKb9gB,QAAQC,OAAO,aAAawiB,QAAQ,aAClC,aACA,WACA,UACA,sBACA,cACA,uBACA,SAAUtd,EAAYG,EAAUC,EAASK,EAAqBgB,EAAa8b,GAEzE,GAAIliB,MAEAmiB,GACAC,SAAU,EACVC,aAAc,EACdC,SAAU,EACVC,OAAQ,EACRC,MAAO,EACPC,QAAS,EACTC,KAAM,EACNC,QAAS,EACTC,YAAa,EACbC,WAAY,IAGZC,GACAC,KAAM,EACNC,GAAI,EACJC,SAAU,GAGVC,GACAC,SAAU,EACVC,SAAU,GAGVC,GACAC,KAAM,EACNC,KAAM,GAGNC,GACAC,KAAM,EACNC,IAAK,EAwnCT,OArnCA1jB,GAAS2jB,oBAIT3jB,EAAS4jB,WAAa,WACpB5jB,EAASwL,aACPC,GAAI,EACJC,GAAI,EACJwH,QAAS,GACTC,QAAS,GACT0Q,QAAS,GACTC,QAAS,GACTC,eAAe,EACfC,cAAe,GACfxc,YAAahG,QAEfxB,EAAS4d,iBACP5P,iBAAkB,GAClBC,UAAW,GACXC,QAAS,GACTC,aAAc,GACd9P,OAAQ,GACR+P,kBAAmB,GACnBC,wBAAyB,IAE3BrO,EAASqb,wBACP5P,GAAI,GACJC,GAAI,GACJ6P,KAAM,KACN0I,gBAAiB,IAGnBjkB,EAASiI,gBACPic,gBAAgB,EAChBC,eAAgB3iB,OAChB4iB,mBAAoB5iB,OACpB6iB,iBAAkB7iB,OAClB8iB,UAAW9iB,OACX+iB,YAAY,EACZC,gBACAC,YAAa,EACbC,WACE,EACA,GAEFC,cAAenjB,OACfojB,cAAepjB,OACfqjB,QACAC,SAAS,EACTC,QAAS,EACT5c,OAAQ,EACR6c,kBAAmB,WACjB,MAAiDxjB,UAA1CxB,EAASiI,eAAe0c,eAEjCM,iBAAkB,WAChBjlB,EAASiI,eAAe0c,cAAgBnjB,QAE1C0jB,iBAAkB,WAChB,MAAOllB,GAASiI,eAAe0c,eAEjCQ,iBAAkB,SAAUvU,GAC1B5Q,EAASiI,eAAe0c,cAAgB/T,GAE1CwU,cAAe,WACb,MAAOplB,GAASiI,eAAesc,YAEjCc,cAAe,SAAUC,GACvBtlB,EAASiI,eAAesc,WAAae,GAEvCC,aAAc,WACZ,MAAOvlB,GAASiI,eAAeqc,WAEjCkB,aAAc,SAAUnd,GACtBrI,EAASiI,eAAeqc,UAAYjc,GAEtCmT,MAAO,WACLxb,EAASiI,eAAekc,eAAiB3iB,OACzCxB,EAASiI,eAAemc,mBAAqB5iB,OAC7CxB,EAASiI,eAAeoc,iBAAmB7iB,OAC3CxB,EAASiI,eAAeqc,UAAY9iB,OACpCxB,EAASiI,eAAesc,YAAa,EACrCvkB,EAASiI,eAAeuc,gBACxBxkB,EAASiI,eAAewc,YAAc,EACtCzkB,EAASiI,eAAeyc,WACtB,EACA,GAEF1kB,EAASiI,eAAe0c,cAAgBnjB,OACxCxB,EAASiI,eAAe2c,cAAgBpjB,QAE1CikB,UAAW,WACT,MAAOzlB,GAASiI,eAAe6c,SAEjCY,eAAgB,WACd1lB,EAASiI,eAAe6c,SAAW9kB,EAASiI,eAAe6c,SAE7D7S,gBAAiB,WACfjS,EAASiI,eAAeic,gBAAkBlkB,EAASiI,eAAeic,eAC9DlkB,EAASiI,eAAeic,kBAAmB,GAG7ChC,EAAqByD,iBAAiBvf,EAAYkL,YAGtDpJ,QAAS,WACP,MAAOlI,GAASiI,eAAeic,gBAEjC0B,aAAc,SAAUhV,GACtB,MAAwD,mBAA7C5Q,GAASiI,eAAeuc,aAAa5T,IACvC,EAE2D,iBAAvD5Q,GAASiI,eAAeuc,aAAa5T,GAAInB,UAC3CzP,EAASiI,eAAeuc,aAAa5T,GAAInB,WAEzC,GAIboW,oBAAqB,SAAUjV,GAC7B,MAAwD,mBAA7C5Q,GAASiI,eAAeuc,aAAa5T,GACvCpP,OAEkE,gBAA9DxB,GAASiI,eAAeuc,aAAa5T,GAAIkV,iBAC3C9lB,EAASiI,eAAeuc,aAAa5T,GAAIkV,iBAEzCtkB,QAIbukB,uBAAwB,SAAUnV,GAChC,MAAwD,mBAA7C5Q,GAASiI,eAAeuc,aAAa5T,GACvC,EAEqE,gBAAjE5Q,GAASiI,eAAeuc,aAAa5T,GAAIoV,oBAC3ChmB,EAASiI,eAAeuc,aAAa5T,GAAIoV,oBAEzC,GAIbC,aAAc,SAAUrV,EAAIsV,GAC8B,mBAA7ClmB,GAASiI,eAAeuc,aAAa5T,KAC9C5Q,EAASiI,eAAeuc,aAAa5T,OAEvC5Q,EAASiI,eAAeuc,aAAa5T,GAAInB,UAAYyW,GAEvDC,oBAAqB,SAAUvV,EAAIwV,GACuB,mBAA7CpmB,GAASiI,eAAeuc,aAAa5T,KAC9C5Q,EAASiI,eAAeuc,aAAa5T,OAEvC5Q,EAASiI,eAAeuc,aAAa5T,GAAIkV,iBAAmBM,GAE9DC,uBAAwB,SAAUzV,EAAI0V,GACoB,mBAA7CtmB,GAASiI,eAAeuc,aAAa5T,KAC9C5Q,EAASiI,eAAeuc,aAAa5T,OAEvC5Q,EAASiI,eAAeuc,aAAa5T,GAAIoV,oBAAsBM,IAGnEtmB,EAASumB,aAAe,GACxBvmB,EAASsJ,qBAAsB,EAC/BtJ,EAASqJ,uBAAyB,GAClCrJ,EAASwmB,iBAAmB,GAC5BxmB,EAASymB,SAAU,EACnBzmB,EAAS+P,mBAAoB,EAC7B/P,EAAS0mB,QAAS,EAClB1mB,EAAS2mB,aAAc,EACvB3mB,EAAS4mB,kBAAmB,EAC5B5mB,EAAS6mB,iBACT7mB,EAAS8mB,kBAAoB,EAC7B9mB,EAASwV,kBAAoBhU,OAC7BxB,EAAS+mB,kBAAoBvlB,OAC7BxB,EAASgnB,kBAAoBxlB,OAC7BxB,EAASinB,kBAAoBzlB,OAC7BxB,EAASknB,QAAU1lB,OACnBxB,EAASmnB,sBAAwB,EACjCnnB,EAASonB,oBAAsB5lB,OAC/BxB,EAASqnB,mBAAqB7lB,OAC9BxB,EAASkC,MAAQ,KACjBlC,EAASsnB,eAAiB9lB,OAC1BxB,EAASuK,cAAe,EACxBvK,EAASunB,gBAAiB,EAC1BvnB,EAASwnB,qBAAuBhmB,OAChCxB,EAASynB,kBAAmB,EAC5BznB,EAAS0nB,iBAAmB,EAC5B1nB,EAAS+C,kBAAoB,GAC7B/C,EAAS2nB,kBAAmB,EAC5B3nB,EAAS2I,kBAAmB,EAC5B3I,EAAS4nB,YAAcpmB,OACvBxB,EAAS6nB,WAAarmB,OACtBxB,EAASzB,IAAMiD,OACfxB,EAAS8nB,SAAW,IACpB9nB,EAAS+nB,YAAcvmB,OAEvBxB,EAASgoB,UACThoB,EAASgoB,OAAOC,mBACdC,kBACE,kBACA,qBACA,kBAGJloB,EAASgoB,OAAOG,eAAkBD,qBAClCloB,EAASgoB,OAAOI,UACdF,kBACE,OACA,YACA,sBACA,sBACA,wBACA,yBACA,2BACA,6BACA,sBACA,gBACA,cACA,iBACA,mBACA,wBACA,uBACA,kBAGJloB,EAASgoB,OAAOK,aAAeroB,EAASgoB,OAAOG,cAC/CnoB,EAASsoB,UAAYtoB,EAASgoB,OAAOC,kBACrCjoB,EAASuoB,SAAWvoB,EAASgoB,OAAOC,kBACpCjoB,EAAS2jB,qBAGX3jB,EAAS4jB,aAIT5jB,EAASmQ,cAAgB,SAAUqY,GACjC,MAAOxoB,GAASuoB,SAASL,iBAAiBO,QAAQD,GAAc,IAKlExoB,EAASgI,eAAiB,SAAU0gB,GAClCpqB,KAAKkN,YAAYhE,YAAckhB,GAKjC1oB,EAASwM,SAAW,SAAUmc,GAC5B3oB,EAASsoB,UAAYtoB,EAASuoB,SACL,gBAAdI,GACT3oB,EAASuoB,SAAWvoB,EAASgoB,OAAOW,GAEpC3oB,EAASuoB,SAAWI,GAMxB3oB,EAAS4oB,eAAiB,SAAUC,GAE9BzjB,EAAoB0jB,WACtB/jB,EAAQgkB,sBAAsB/oB,EAAS4oB,gBAGlB,OAAnB5oB,EAASkC,QACXlC,EAASkC,MAAQ2mB,EAEnB,IAAIG,GAAgBvP,KAAKwP,MAAMJ,EAAY7oB,EAASkC,OAAS,IAAOkD,EAAoBmG,OAAOkT,UAC/Fze,GAASqb,uBAAuBE,KAAO9B,KAAKwP,MAAMjpB,EAASqb,uBAAuB5P,GAAKud,GACnF5jB,EAAoB0jB,WAAa9oB,EAASqb,uBAAuBE,MAAQvb,EAASqb,uBAAuB3P,IAC9D,KAAzC1L,EAASqb,uBAAuBE,OAClCvb,EAAS8mB,kBAAoB9mB,EAASqb,uBAAuBE,MAE/D5W,EAAWukB,WAEXlpB,EAAS8mB,kBAAoB9mB,EAASqb,uBAAuB4I,gBAC7DjkB,EAASqb,uBAAuB5P,GAAK,GACrCzL,EAASqb,uBAAuB3P,GAAK,GACrC1L,EAASqb,uBAAuBE,KAAO,EACvCvb,EAASkC,MAAQ,OAMrBlC,EAASsT,gBAAkB,SAAU6V,EAAQC,GAC3CppB,EAASqb,uBAAuB5P,GAAK0d,EACrCnpB,EAASqb,uBAAuB3P,GAAK0d,EACrCppB,EAASqb,uBAAuB4I,gBAAkBmF,EAClDppB,EAASqb,uBAAuBE,KAAO4N,EACvCpkB,EAAQgkB,sBAAsB/oB,EAAS4oB,iBAOzC5oB,EAASqpB,OAAS,SAAUnnB,EAAOonB,GACjCtpB,EAASwL,YAAY0H,QAAUhR,EAC/BlC,EAASwL,YAAY2H,QAAUmW,GAMjCtpB,EAAS4L,YAAc,WACrB5L,EAASwL,YAAY0H,QAAU,GAC/BlT,EAASwL,YAAY2H,QAAU,IAKjCnT,EAASupB,YAAc,WACrB,MAAOvpB,GAASwL,aAKlBxL,EAAS8N,mBAAqB,SAAU8B,EAAK4Z,EAAOC,EAAKC,EAAKC,EAAKC,EAAIC,EAASC,GAC9E9pB,EAAS4d,gBAAgB5P,iBAAmB4B,EAC5C5P,EAAS4d,gBAAgB3P,UAAY8b,SAASP,EAAO,IACrDxpB,EAAS4d,gBAAgB1P,QAAU6b,SAASN,EAAK,IACjDzpB,EAAS4d,gBAAgBzP,aAAe4b,SAASL,EAAK,IACtD1pB,EAASgqB,kBAAkBL,GAC3B3pB,EAAS4d,gBAAgBxP,kBAAoBwb,EAC7C5pB,EAAS4d,gBAAgBvP,wBAA0Bwb,EACnD7pB,EAAS4d,gBAAgBtP,oBAAsBwb,GAKjD9pB,EAASiqB,UAAY,WACnB,OACEjqB,EAASwL,YAAY0H,QACrBlT,EAASwL,YAAY2H,UAUzBnT,EAASkqB,gBAAkB,SAAUhoB,EAAOonB,GACtCpnB,EAAQ5D,KAAKkN,YAAY0H,UAC3B5U,KAAKkN,YAAY0H,QAAUhR,GAEzBonB,EAAMhrB,KAAKkN,YAAY2H,UACzB7U,KAAKkN,YAAY2H,QAAUmW,IAM/BtpB,EAAS6Q,YAAc,SAAUsZ,EAAMhmB,EAAOimB,GAC5C,GAAIC,GACAC,EAAMtqB,EAASgR,sBACnB,IAAYxP,SAAR8oB,EACF,MAAKH,IAUHE,EAASD,EAAUG,gBAAgBpmB,EAAMA,EAAMjF,OAAS,QACxDc,GAASwqB,iBAAiBH,EAAO7nB,KAAM6nB,EAAO1gB,KAAMxF,EAAMjF,OAAS,KARnEmrB,EAASD,EAAUG,gBAAgBpmB,EAAM,SAC1B,OAAXkmB,GACFrqB,EAASwqB,iBAAiBH,EAAO7nB,KAAM6nB,EAAO1gB,KAAM,IAU1D,IAAI8gB,EACJtmB,GAAMnD,QAAQ,SAAUwB,EAAM6R,GACxB7R,IAAS8nB,IACXG,EAAWpW,KAGE7S,SAAbipB,GACFJ,EAASD,EAAUG,gBAAgBpmB,EAAM,IACzCnE,EAASwqB,iBAAiBH,EAAO7nB,KAAM6nB,EAAO1gB,KAAM,GACpD3J,EAAS6mB,iBACT7mB,EAAS0qB,kBAELP,EACEM,EAAW,EAAItmB,EAAMjF,SACvBmrB,EAASD,EAAUG,gBAAgBpmB,EAAMsmB,EAAW,IAEpDzqB,EAASwqB,iBAAiBH,EAAO7nB,KAAM6nB,EAAO1gB,KAAMxF,EAAMsmB,SAAW,GACrEzqB,EAAS6mB,iBACT7mB,EAAS0qB,kBAGPD,EAAW,GAAK,IAClBJ,EAASD,EAAUG,gBAAgBpmB,EAAMsmB,EAAW,IAEpDzqB,EAASwqB,iBAAiBH,EAAO7nB,KAAM6nB,EAAO1gB,KAAMxF,EAAMsmB,SAAW,GACrEzqB,EAAS6mB,iBACT7mB,EAAS0qB,mBASjB1qB,EAASgqB,kBAAoB,SAAUxnB,GACrC,OAAQA,GACR,IAAK,WACHxC,EAAS4d,gBAAgBvf,OAAS8jB,EAASC,QAC3C,MACF,KAAK,eACHpiB,EAAS4d,gBAAgBvf,OAAS8jB,EAASE,YAC3C,MACF,KAAK,WACHriB,EAAS4d,gBAAgBvf,OAAS8jB,EAASG,QAC3C,MACF,KAAK,SACHtiB,EAAS4d,gBAAgBvf,OAAS8jB,EAASI,MAC3C,MACF,KAAK,QACHviB,EAAS4d,gBAAgBvf,OAAS8jB,EAASK,KAC3C,MACF,KAAK,UACHxiB,EAAS4d,gBAAgBvf,OAAS8jB,EAASM,OAC3C,MACF,KAAK,OACHziB,EAAS4d,gBAAgBvf,OAAS8jB,EAASO,IAC3C,MACF,KAAK,UACH1iB,EAAS4d,gBAAgBvf,OAAS8jB,EAASQ,OAC3C,MACF,KAAK,cACH3iB,EAAS4d,gBAAgBvf,OAAS8jB,EAASS,WAC3C,MACF,KAAK,aACH5iB,EAAS4d,gBAAgBvf,OAAS8jB,EAASU,UAC3C,MACF,SACE7iB,EAAS4d,gBAAgBvf,OAAS8jB,EAASE,eAO/CriB,EAAS2qB,mBAAqB,WAC5B,MAAOxI,IAKTniB,EAAS4qB,sBAAwB,WAC/B,MAAO9H,IAKT9iB,EAAS6qB,aAAe,WACtB,MAAO3H,IAKTljB,EAAS8qB,eAAiB,WACxB,MAAOzH,IAKTrjB,EAAS+qB,eAAiB,WACxB,MAAOvH,IAKTxjB,EAASgrB,iBAAmB,WAC1B,MAAO1sB,MAAKkN,YAAYuY,eAK1B/jB,EAASirB,iBAAmB,SAAUvC,GACpCpqB,KAAKkN,YAAYuY,cAAgB2E,GAKnC1oB,EAASkrB,iBAAmB,WAC1B,MAAO5sB,MAAKkN,YAAYwY,eAK1BhkB,EAASmrB,iBAAmB,SAAUzC,GACpCpqB,KAAKkN,YAAYwY,cAAgB0E,GAOnC1oB,EAAS2Y,OAAS,SAAUyS,EAAGC,GAC7B,MAAOD,IAAKC,EAAI/sB,KAAKkN,YAAYC,KAAOnN,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,GAAK,IAMtFzL,EAASsX,cAAgB,SAAU8T,GACjC,MAAO9sB,MAAKqa,OAAOyS,EAAG9sB,KAAKkN,YAAYC,GAAK,GAAKnN,KAAKqa,OAAOyS,EAAG9sB,KAAKkN,YAAYC,KAKnFzL,EAAS4K,cAAgB,SAAU0gB,GACjChtB,KAAKqoB,aAAeroB,KAAKqoB,YACzB7hB,EAAS,WACP,GAAIymB,GAAI,GAAIC,KACZxrB,GAAS6nB,WAAa0D,EAAEE,WACvBH,IAKLtrB,EAAS2K,eAAiB,WACxB,MAAOrM,MAAKqoB,aAKd3mB,EAAS0rB,eAAiB,SAAUL,GAClC/sB,KAAKqoB,YAAc0E,GAKrBrrB,EAAS2rB,WAAa,SAAUN,GAC9B/sB,KAAKioB,aAAe8E,GAKtBrrB,EAAS8P,WAAa,WACpB,MAAOxR,MAAKioB,cAKdvmB,EAAS4rB,kBAAoB,WAC3B,MAAOttB,MAAKgpB,gBAKdtnB,EAASuO,kBAAoB,SAAU8c,GACrC/sB,KAAKgpB,eAAiB+D,GAKxBrrB,EAAS6T,oBAAsB,WAC7B,MAAOvV,MAAKsoB,kBAKd5mB,EAAS4T,oBAAsB,SAAUyX,GACvC/sB,KAAKsoB,iBAAmByE,GAK1BrrB,EAASwqB,iBAAmB,SAAUqB,EAASC,EAAWC,GACxD/rB,EAASgsB,qBAAqBH,EAASE,GACvC/rB,EAASisB,qBAAqBH,IAMhC9rB,EAASisB,qBAAuB,SAAUzpB,GACxClE,KAAK2oB,kBAAoBzkB,GAK3BxC,EAASksB,qBAAuB,WAC9B,MAAO5tB,MAAK2oB,mBAMdjnB,EAASgsB,qBAAuB,SAAUxpB,EAAMmN,GAC9CrR,KAAK0oB,kBAAoBxkB,EACzBlE,KAAK+oB,mBAAqB1X,GAK5B3P,EAASgR,qBAAuB,WAC9B,MAAO1S,MAAK0oB,mBAKdhnB,EAASmsB,sBAAwB,WAC/B,MAAO7tB,MAAK+oB,oBAKdrnB,EAASosB,sBAAwB,WAC/B,MAAO9tB,MAAK+tB,oBAMdrsB,EAASssB,qBAAuB,SAAU9pB,GACxClE,KAAKkX,kBAAoBhT,GAK3BxC,EAASuV,qBAAuB,WAC9B,MAAOjX,MAAKkX,mBAMdxV,EAASusB,qBAAuB,SAAU/pB,GACxClE,KAAKyoB,kBAAoBvkB,GAK3BxC,EAASya,qBAAuB,WAC9B,MAAOnc,MAAKyoB,mBAUd/mB,EAASqW,gBAAkB,SAAUmW,EAAMC,EAAWC,EAAG1S,EAASE,GAChE5b,KAAKquB,aAAeH,EACpBluB,KAAKsuB,UAAYF,EACjBpuB,KAAKuuB,mBAAqBJ,EAC1BnuB,KAAKwuB,gBAAkB9S,EACvB1b,KAAKyuB,eAAiB7S,GAMxBla,EAAS8X,gBAAkB,WACzB,MAAOxZ,MAAKquB,cAMd3sB,EAASia,mBAAqB,WAC5B,MAAO3b,MAAKwuB,iBAMd9sB,EAASma,kBAAoB,WAC3B,MAAO7b,MAAKyuB,gBAMd/sB,EAASgtB,sBAAwB,WAC/B,MAAO1uB,MAAKuuB,oBAKd7sB,EAASitB,oBAAsB,SAAUC,GACvC,GAAIC,MACAC,EAAaptB,EAASwL,YAAY0H,QAClCma,EAAWrtB,EAASwL,YAAY2H,OAapC,OAZA3T,SAAQwB,QAAQksB,EAAW,SAAUI,GAC/BA,EAAE9qB,OAASxC,EAASgR,wBACtBxR,QAAQwB,QAAQssB,EAAEhd,MAAO,SAAUkc,GAC7BA,EAAKlU,aAAe8U,GAAcZ,EAAKlU,YAAckU,EAAKjU,WAAa8U,GACzEF,EAAa7rB,KAAKkrB,GAEhBA,EAAKhT,aAAe4T,GAAcZ,EAAKhT,aAAe6T,GACxDF,EAAa7rB,KAAKkrB,OAKnBW,EAAaI,KAAKvtB,EAASwtB,cAMpCxtB,EAASytB,gBAAkB,SAAUjB,GACtB,OAATA,GAA0BhrB,SAATgrB,GACnBxsB,EAAS6mB,iBACT7mB,EAAS6mB,cAAcvlB,KAAKkrB,GAC5BxsB,EAAS0qB,kBAET1qB,EAAS6mB,kBAMb7mB,EAAS0qB,eAAiB,WACxB,GAAI1qB,EAAS6mB,cAAc3nB,OAAS,EAAG,CACrC,GAAqD,mBAA1Cc,GAAS6mB,cAAc,GAAGrN,YACnC,GAAIkU,GAAO1tB,EAAS6mB,cAAc,GAAGvO,gBAErC,IAAIoV,GAAO1tB,EAAS6mB,cAAc,GAAGrN,WAEvC,IAAqD,mBAA1CxZ,GAAS6mB,cAAc,GAAGrN,YACnC,GAAImU,GAAQ3tB,EAAS6mB,cAAc7mB,EAAS6mB,cAAc3nB,OAAS,GAAGoZ,YAActY,EAAS6mB,cAAc7mB,EAAS6mB,cAAc3nB,OAAS,GAAGqZ,cAE9I,IAAIoV,GAAQ3tB,EAAS6mB,cAAc,GAAGrN,WAExCxZ,GAAS6mB,cAAc7lB,QAAQ,SAAU4sB,GACnCA,EAAMtV,aAAeoV,IACvBA,EAAOE,EAAMtV,aAEXsV,EAAMtV,YAAcsV,EAAMrV,WAAaoV,IACzCA,EAAQC,EAAMtV,YAAcsV,EAAMrV,aAGtCvY,EAASqpB,OAAOqE,EAAMC,EAAQ,KASlC3tB,EAAS6tB,wBAA0B,SAAUrB,EAAMC,GAEZ,GAAjCzsB,EAAS6mB,cAAc3nB,QAA0CsC,SAA3BxB,EAAS6mB,eAA0D,OAA3B7mB,EAAS6mB,eACzF7mB,EAAS6mB,iBACT7mB,EAAS6mB,cAAcvlB,KAAKkrB,IAIiB,KAAzCxsB,EAAS6mB,cAAc4B,QAAQ+D,IAC7BxsB,EAAS6mB,cAAc4B,QAAQgE,GAAa,IAC9CzsB,EAAS6mB,kBAEX7mB,EAAS6mB,cAAcvlB,KAAKkrB,GAC5BxsB,EAAS6mB,cAAc0G,KAAKvtB,EAASwtB,eAGrCxtB,EAAS6mB,iBACT7mB,EAAS6mB,cAAcvlB,KAAKkrB,KAOlCxsB,EAASwtB,YAAc,SAAU9pB,EAAGglB,GAElC,MAAIhlB,GAAE4U,YAAcoQ,EAAEpQ,aAAe5U,EAAE8V,YAAckP,EAAElP,YAC9C,EAEL9V,EAAE4U,YAAcoQ,EAAEpQ,aAAe5U,EAAE8V,YAAckP,EAAElP,YAC9C,GAEF,GAOTxZ,EAAS8tB,iBAAmB,WAC1B,MAAIxvB,MAAKuoB,cAAc3nB,OAAS,GAE5BgD,MAAO5D,KAAKuoB,cAAc,GAAGvO,YAC7BgR,IAAKhrB,KAAKuoB,cAAcvoB,KAAKuoB,cAAc3nB,OAAS,GAAGoZ,YAAcha,KAAKuoB,cAAcvoB,KAAKuoB,cAAc3nB,OAAS,GAAGqZ,WAElF,IAA9Bja,KAAKuoB,cAAc3nB,OACcsC,SAAtClD,KAAKuoB,cAAc,GAAGvO,aAEtBpW,MAAO5D,KAAKuoB,cAAc,GAAGvO,YAC7BgR,IAAKhrB,KAAKuoB,cAAc,GAAGvO,YAAcha,KAAKuoB,cAAc,GAAGtO,YAI/DrW,MAAO5D,KAAKuoB,cAAc,GAAGrN,YAC7B8P,IAAKhrB,KAAKuoB,cAAc,GAAGrN,cAK7BtX,MAAO,GACPonB,IAAK,KAOXtpB,EAAS+X,iBAAmB,WAC1B,MAAOzZ,MAAKuoB,eAKd7mB,EAAS+tB,YAAc,WACrB,MAAOzvB,MAAKuoB,eAKd7mB,EAASguB,UAAY,WACnB,MAAO1vB,MAAKmoB,SAKdzmB,EAAS8V,WAAa,SAAUmY,GAC9B3vB,KAAKmoB,QAAUwH,GAKjBjuB,EAASkuB,UAAY,WACnB,MAAO5vB,MAAK4oB,SAKdlnB,EAASmuB,WAAa,SAAUF,GAC9B3vB,KAAK4oB,QAAU+G,GAKjBjuB,EAASouB,qBAAuB,WAC9B,MAAO9vB,MAAKyR,mBAKd/P,EAASgQ,qBAAuB,SAAUie,GACxC3vB,KAAKyR,kBAAoBke,GAK3BjuB,EAASquB,gBAAkB,WACzB,MAAO/vB,MAAKooB,QAKd1mB,EAASsuB,iBAAmB,SAAUL,GACpC3vB,KAAKooB,OAASuH,GAKhBjuB,EAASuuB,cAAgB,WACvB,MAAOjwB,MAAKuoB,cAAc3nB,QAK5Bc,EAASwuB,iBAAmB,SAAUjV,GACpC,MAAOjb,MAAKkN,YAAYC,IAAMnN,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,IAAM8N,GAK7EvZ,EAASyuB,kBAAoB,SAAUC,GACrC,MAAOA,IAAU,KAAOpwB,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,IAAM,MAKvEzL,EAAS2uB,sBAAwB,SAAU1lB,GACzC,GAAI/G,GAAQ0sB,WAAWtwB,KAAKkN,YAAYC,IACpC6d,EAAMsF,WAAWtwB,KAAKkN,YAAYE,GACtC,QAAQ4d,EAAMpnB,GAAS+G,EAAM4lB,cAAclN,OAAO1K,OAKpDjX,EAAS8uB,qBAAuB,WAC9B,MAA6B,GAAtBxwB,KAAKkN,YAAYC,GAASrG,EAAoBmG,OAAOkT,WAAa,GAAMrZ,EAAoBmG,OAAOkT,YAK5Gze,EAAS+uB,mBAAqB,WAC5B,MAA6B,GAAtBzwB,KAAKkN,YAAYE,GAAStG,EAAoBmG,OAAOkT,WAAa,GAAMrZ,EAAoBmG,OAAOkT,YAK5Gze,EAASgvB,qBAAuB,WAC9B,MAAkC,GAA3B1wB,KAAKkN,YAAY0H,QAAc9N,EAAoBmG,OAAOkT,WAAa,GAAMrZ,EAAoBmG,OAAOkT,YAKjHze,EAASivB,mBAAqB,WAC5B,MAAkC,GAA3B3wB,KAAKkN,YAAY2H,QAAc/N,EAAoBmG,OAAOkT,WAAa,GAAMrZ,EAAoBmG,OAAOkT,YASjHze,EAAS0S,YAAc,SAAUwc,EAASC,GACxC,GAAIC,GAAW9wB,KAAKkN,YAAYC,GAC5B4jB,EAAS/wB,KAAKkN,YAAYE,EACdlK,UAAZ0tB,IACF5wB,KAAKkN,YAAYC,GAAKgO,KAAKC,MAAMwV,IAEnB1tB,SAAZ2tB,IACF7wB,KAAKkN,YAAYE,GAAK+N,KAAKC,MAAMyV,IAG/BC,EAAW9wB,KAAKkN,YAAYC,IAAM4jB,EAAS/wB,KAAKkN,YAAYE,IAE1DpN,KAAKkN,YAAYC,GAAK,IACxBnN,KAAKkN,YAAYC,GAAK,EACtBnN,KAAKkN,YAAYE,GAAK2jB,EAAS5V,KAAK6V,IAAIhxB,KAAKkN,YAAYC,KAGzD2jB,EAAW9wB,KAAKkN,YAAYC,IAAM4jB,EAAS/wB,KAAKkN,YAAYE,IAE1DpN,KAAKkN,YAAYE,GAAKtG,EAAoBmG,OAAOI,KAAKzM,SACxDZ,KAAKkN,YAAYC,GAAK2jB,EACtB9wB,KAAKkN,YAAYE,GAAKtG,EAAoBmG,OAAOI,KAAKzM,QAItDZ,KAAKkN,YAAYC,GAAK,IACxBnN,KAAKkN,YAAYC,GAAK,GAEpBnN,KAAKkN,YAAYE,GAAKtG,EAAoBmG,OAAOI,KAAKzM,SACxDZ,KAAKkN,YAAYE,GAAKtG,EAAoBmG,OAAOI,KAAKzM,QAGpDZ,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,GAAK,IAC9CnN,KAAKkN,YAAYC,GAAK2jB,EACtB9wB,KAAKkN,YAAYE,GAAK2jB,IAW1BrvB,EAAS4S,aAAe,SAAU2c,EAAQ/pB,GACxC,GAAIgqB,GAAWC,EAASC,EACpBC,EAAMrxB,KAAKwZ,kBACXyT,EAAIjtB,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,GAC3CmkB,GAAY,CAChB,IAAYpuB,SAARmuB,EAAmB,CACjBrxB,KAAK2b,qBAEP0V,EAAMnqB,EAAaqqB,eAAe7vB,EAASuV,uBAAwB,GAC1DjX,KAAK6b,sBACdwV,EAAMnqB,EAAasqB,YAAY9vB,EAASuV,wBACxCqa,GAAY,GAIVF,EAFgC,YAAhCpxB,KAAKmc,uBACHmV,EACsBD,EAAIrX,YAAcqX,EAAIpX,UAEtBoX,EAAIrX,YAGNqX,EAAInW,WAE9B,IAAIuW,GAAKL,EAAwBpxB,KAAKkN,YAAYC,GAC9CukB,EAAK1xB,KAAKkN,YAAYE,GAAKgkB,CAC3BH,IACFC,EAAYlxB,KAAKkN,YAAYC,GAAU,GAALskB,EAClCN,EAAUnxB,KAAKkN,YAAYE,GAAU,GAALskB,IAEhCR,EAAYlxB,KAAKkN,YAAYC,GAAU,GAALskB,EAClCN,EAAUnxB,KAAKkN,YAAYE,GAAU,GAALskB,OAG9BT,IACFC,EAAYlxB,KAAKkN,YAAYC,MAAQ8f,EAAI,GACzCkE,EAAUnxB,KAAKkN,YAAYE,MAAQ6f,EAAI,KAEvCiE,EAAYlxB,KAAKkN,YAAYC,MAAQ8f,EAAI,GACzCkE,EAAUnxB,KAAKkN,YAAYE,MAAQ6f,EAAI,GAG3CjtB,MAAKoU,YAAY8c,EAAWC,IAU9BzvB,EAAS+S,cAAgB,SAAUkd,GAEjC,GAAIT,GAAWC,CACXQ,IACFT,EAAYlxB,KAAKkN,YAAYC,OAASnN,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,IAAM,GACnFgkB,EAAUnxB,KAAKkN,YAAYE,OAASpN,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,IAAM,KAEjF+jB,EAAYlxB,KAAKkN,YAAYC,OAASnN,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,IAAM,GACnFgkB,EAAUnxB,KAAKkN,YAAYE,OAASpN,KAAKkN,YAAYE,GAAKpN,KAAKkN,YAAYC,IAAM,IAEnFnN,KAAKoU,YAAY8c,EAAWC,IAS9BzvB,EAASuM,oBAAsB,SAAUJ,GACvC3M,QAAQwB,QAAQmL,EAAW,SAAUpI,GACnC/D,EAAS2jB,iBAAiBriB,MACxBuC,UAAaE,EAAGvB,KAChB0tB,eAAkBnsB,EAAGvB,UAW3BxC,EAAS4V,cAAgB,SAAU/R,EAAWssB,EAAgBxgB,GAC5DnQ,QAAQwB,QAAQhB,EAAS2jB,iBAAkB,SAAUyM,GAC/CA,EAAGvsB,YAAcA,IACnBusB,EAAGF,eAAiBC,EACpBC,EAAGC,gBAAkB1gB,MAW3B3P,EAASuQ,cAAgB,SAAU1M,GACjC,GAAI8R,EAMJ,OALAnW,SAAQwB,QAAQhB,EAAS2jB,iBAAkB,SAAUyM,GAC/CA,EAAGvsB,YAAcA,IACnB8R,EAAaya,EAAGF,kBAGbva,GAST3V,EAASswB,gBAAkB,SAAUzsB,GACnC,GAAI8R,EAUJ,OATAnW,SAAQwB,QAAQhB,EAAS2jB,iBAAkB,SAAUyM,GAC/CA,EAAGvsB,YAAcA,IAEjB8R,EADyBnU,SAAvB4uB,EAAGC,gBACQ,EAEAD,EAAGC,mBAIf1a,GAET3V,EAASuwB,eAAiB,SAAUloB,GAClC/J,KAAKspB,YAAcvf,GAKrBrI,EAASwwB,KAAO,SAAUnoB,GACxB,OAAQA,EAAEooB,SAAWpoB,EAAEwmB,cAAc6B,SAAWroB,EAAEwmB,cAAclN,OAAO1K,MAAQ5O,EAAEwmB,cAAclN,OAAOgP,cAKxG3wB,EAAS4wB,KAAO,SAAUvoB,GACxB,OAAQA,EAAEwoB,SAAWxoB,EAAEwmB,cAAciC,SAAWzoB,EAAEwmB,cAAclN,OAAOzK,OAAS7O,EAAEwmB,cAAclN,OAAOoP,eAKzG/wB,EAASmJ,iBAAmB,WAC1BnJ,EAAS4jB,cAKX5jB,EAASgxB,iBAAmB,SAAUC,EAAKC,GACzC,GAAIC,IACAhb,mBAAoB,OAAS8a,EAAIC,GAAU,GAAK,IAAMD,EAAIC,GAAU,GAAK,IAAMD,EAAIC,GAAU,GAAK,IAClGja,MAAS,OACTC,OAAU,OAEd,OAAOia,IAETnxB,EAASoxB,cAAgB,SAAUC,GACjC,MAAO5X,MAAK6X,KAAKD,EAAgBrxB,EAAS8nB,WAErC9nB,KAIXR,QAAQC,OAAO,aAAauU,UAAU,qBACpC,YACA,YACA,eACA,wBACA,iBACA,sBACA,SAAUhP,EAAWjF,EAAWyF,EAAcH,EAAuBH,EAAgBE,GACnF,OACE+O,SAAU,IACVhD,SAAS,EACTiD,OACEvQ,UAAW,IACXioB,UAAW,KAEbxX,KAAM,SAAUF,EAAOvM,EAAS0M,GAC9BH,EAAMmd,eAAiB/vB,OACvB4S,EAAMod,cAAgBhwB,OACtB4S,EAAMqd,mBAAqBjwB,OAC3B4S,EAAMsd,QAAUlwB,OAChB4S,EAAMud,uBAAyBnwB,OAC/B4S,EAAMjQ,MAAQoQ,EAAKqd,kBAInB/pB,EAAQC,KAAK,QAAS,SAAUmB,GAC9BA,EAAM4oB,iBACNzd,EAAM0d,YAAY7oB,GAAO,GACzBmL,EAAM2d,aAAa9oB,KAGrBpB,EAAQC,KAAK,cAAe,SAAUmB,GACpCA,EAAM4oB,iBACNzd,EAAM0d,YAAY7oB,GAAO,GACzBmL,EAAM4d,kBAAkB/oB,KAG1BpB,EAAQC,KAAK,WAAY,SAAUmB,GACjCmL,EAAM0d,YAAY7oB,GAAO,GACrB5D,EAAsBpF,KAAKgyB,aAAaC,aAC1C9d,EAAM+d,gBAAgBlpB,GAEtBmL,EAAM2d,aAAa9oB,KAIvBpB,EAAQC,KAAK,YAAa,SAAUmB,GAClC,GAAIlJ,EAAU4I,iBAAkB,CAC9B,IAAK5I,EAAUirB,mBAAoB,CACjC,GAAIoH,IAAW,EACXC,EAAkBtyB,EAAU4uB,sBAAsB1lB,EACtDmL,GAAMud,uBAAyB5xB,EAAUywB,KAAKvnB,GAASopB,CACvD,IAAIC,GAASle,EAAMud,uBAAyBvd,EAAMsd,OAClD,IAAuB,GAAnBW,EAAsB,CACxB,GAAIE,GAAgB/sB,EAAagtB,eAAepe,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAI2I,EAAMvQ,UAAWuB,EAAoBmG,OAAOI,KAAKzM,OAE1J,IAAwB,YAApBkV,EAAM0X,UACR,GAAIyG,EAAcvY,WAAY,GAAQuY,EAAcrY,UAAW,EAE7DoY,EAAS7Y,KAAK6X,KAAKld,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAKjG,EAAaqqB,eAAezb,EAAMvQ,UAAW,GAAGyU,iBACxH,IAAIia,EAAcvY,WAAY,GAASuY,EAAcrY,UAAW,EAAM,CAE3E,GAAIuY,GAAWjtB,EAAasqB,YAAY1b,EAAMvQ,UAC9CyuB,GAAS7Y,KAAK6X,KAAKld,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAKgnB,EAASna,YAAcma,EAASla,eAE7G+Z,GAAS7Y,KAAK6X,KAAKld,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAKjG,EAAaktB,qBAAqBte,EAAMvQ,UAAW0uB,EAAcI,QAAQ/hB,IAAI0H,iBAG5Jga,GAAS7Y,KAAK6X,KAAKld,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAKjG,EAAaktB,qBAAqBte,EAAMvQ,UAAW0uB,EAAcI,QAAQ/hB,IAAI4I,YAAc,QAI1K8Y,GAAS7Y,KAAKC,MAAMtF,EAAMud,uBAAyBvd,EAAMsd,SAG7D,GAAIkB,GAAU,CAMd,QAJEA,EADoBpxB,SAAlByH,EAAM4pB,QACE5pB,EAAM6pB,MAEN7pB,EAAM4pB,SAGlB,IAAK,GAEH,KACF,KAAK,GAEH,KACF,KAAK,GAEH,KACF,SACE,IAAK9yB,EAAUirB,mBAAoB,CACjC,GAAI2B,GAAe5sB,EAAU+X,iBAC7B,IAAIzS,EAAsBpF,KAAKgyB,aAAac,cAAgB9pB,EAAM+pB,UAEhE,GADAxtB,EAAauC,iBACQvG,SAAjBmrB,EAA4B,CAE9B,GADA5sB,EAAUwnB,gBAAiB,EACH,YAApBnT,EAAM0X,UAAyB,CACjC,GAAI/rB,EAAUka,sBAAwBla,EAAUoa,oBAAqB,CACnE,GAAIwV,EAEA5vB,GAAUka,sBACZ0V,EAAMnqB,EAAaqqB,eAAezb,EAAMvQ,UAAW,GACnD9D,EAAUynB,qBAAuBmI,EAAIrX,YAAcga,GAC1CvyB,EAAUoa,sBACnBwV,EAAMnqB,EAAasqB,YAAY1b,EAAMvQ,WACrC9D,EAAUynB,qBAAuBmI,EAAIrX,YAAcqX,EAAIpX,UAAY+Z,OAGrEvyB,GAAUynB,qBAAuBmF,EAAarU,YAAcga,EAC5D3C,EAAMhD,CAERnnB,GAAaytB,aAAa7e,EAAMvQ,UAAW8rB,EAAI/e,GAAI0hB,EAAQvyB,EAAUka,qBAAsBla,EAAUoa,qBACrGjV,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,eACVnO,KAAQ4R,EAAMvQ,UACd+M,GAAM+e,EAAI/e,GACVsiB,QAAWZ,EACXtY,QAAWja,EAAUka,qBACrBC,OAAUna,EAAUoa,0BAGtBwV,GAAMhD,EACN5sB,EAAUynB,qBAAuBmF,EAAanT,YAAc8Y,EAC5D9sB,EAAa2tB,UAAU/e,EAAMvQ,UAAW8rB,EAAI/e,GAAI0hB,GAChDptB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,YACVnO,KAAQ4R,EAAMvQ,UACd+M,GAAM+e,EAAI/e,GACVsiB,QAAWZ,GAGfle,GAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3B3xB,EAAU2qB,iBACV0H,GAAW,OAEJ/sB,GAAsBpF,KAAKgyB,aAAac,cAAgB9pB,EAAMmqB,QACvE5tB,EAAauC,iBACU,WAAnBqM,EAAM0X,WACR6D,EAAM5vB,EAAUgY,mBACDvW,SAAXmuB,EAAI,KACNnqB,EAAa6tB,YAAYjf,EAAMvQ,UAAW8rB,EAAI,GAAG/e,GAAI+e,EAAIzwB,OAAQozB,GACjEptB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQ4R,EAAMvQ,UACd+M,GAAM+e,EAAI,GAAG/e,GACb1R,OAAUywB,EAAIzwB,OACdg0B,QAAWZ,KAGfle,EAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3B3xB,EAAU2qB,kBACkB,SAAnBtW,EAAM0X,YACf6D,EAAM5vB,EAAUgY,mBACDvW,SAAXmuB,EAAI,IACNnwB,QAAQwB,QAAQ2uB,EAAK,SAAUtE,GAC7B7lB,EAAa2tB,UAAU/e,EAAMvQ,UAAWwnB,EAAEza,GAAI0hB,GAC9CptB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,YACVnO,KAAQ4R,EAAMvQ,UACd+M,GAAMya,EAAEza,GACRsiB,QAAWZ,MAIjBle,EAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3B3xB,EAAU2qB,mBAGZ3qB,EAAUwnB,gBAAiB,GAK5BxnB,EAAUirB,oBACb5W,EAAM0d,YAAY7oB,EAAOmpB,MAK/BvqB,EAAQC,KAAK,YAAa,SAAUmB,GAClClJ,EAAUwnB,gBAAiB,EAC3BnT,EAAM0d,YAAY7oB,GAAO,KAG3BpB,EAAQC,KAAK,UAAW,SAAUmB,GAChClJ,EAAUwnB,gBAAiB,EAC3BnT,EAAM0d,YAAY7oB,GAAO,KAG3BpB,EAAQC,KAAK,WAAY,SAAUmB,GACjClJ,EAAUwnB,gBAAiB,EAC3BnT,EAAM0d,YAAY7oB,GAAO,KAO3BmL,EAAM2d,aAAe,SAAUrF,GAC7BtY,EAAMud,uBAAyB5xB,EAAUywB,KAAK9D,GAAK3sB,EAAU4uB,sBAAsBjC,GACnFlnB,EAAauC,iBACbhI,EAAU+V,YAAW,GACrB1B,EAAMmd,eAAiB/rB,EAAagtB,eAAepe,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAI2I,EAAMvQ,UAAWuB,EAAoBmG,OAAOI,KAAKzM,QAC7Ja,EAAUyqB,iBAAiBpW,EAAMvQ,UAAWuQ,EAAM0X,UAAW1X,EAAMjQ,OAC9B3C,SAAjC4S,EAAMmd,eAAe3vB,SAA0DJ,SAAjC4S,EAAMmd,eAAeoB,UACrEntB,EAAa8tB,gBAAgB,IAAMlf,EAAMmd,eAAe3vB,QAAQgP,IAChEpL,EAAa+tB,oBAAoB1rB,EAAQ+O,UACzC7W,EAAU0tB,gBAAgBrZ,EAAMmd,eAAe3vB,SAC/C7B,EAAU2qB,kBAEZtW,EAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3Btd,EAAM8U,UAKR9U,EAAM4d,kBAAoB,SAAUtF,GAOlC,GANI3sB,EAAUiR,yBAA2BoD,EAAMvQ,WAC7CuQ,EAAM2d,aAAarF,GAErBtY,EAAMud,uBAAyB5xB,EAAUywB,KAAK9D,GAAK3sB,EAAU4uB,sBAAsBjC,GACnFlnB,EAAauC,iBACbqM,EAAMmd,eAAiB/rB,EAAagtB,eAAepe,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAI2I,EAAMvQ,UAAWuB,EAAoBmG,OAAOI,KAAKzM,QACxHsC,SAAjC4S,EAAMmd,eAAe3vB,SAA0DJ,SAAjC4S,EAAMmd,eAAeoB,QAAuB,CAC5F,GAAIxI,GAAO3kB,EAAaguB,cAAczzB,EAAUiR,uBAAwBoD,EAAMmd,eAAe3vB,QAAQgP,IAAI,GACrG6iB,EAAOjuB,EAAaguB,cAAczzB,EAAUiR,uBAAwBoD,EAAMmd,eAAe3vB,QAAQgP,IAAI,EACzG7Q,GAAUyqB,iBAAiBpW,EAAMvQ,UAAWuQ,EAAM0X,UAAW1X,EAAMsf,QACnE3zB,EAAU8tB,wBAAwBzZ,EAAMmd,eAAe3vB,QAASuoB,EAAMsJ,GACtE1zB,EAAU2qB,iBAEZtW,EAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3Btd,EAAM8U,UAKR9U,EAAM+d,gBAAkB,SAAUzF,GAChCtY,EAAMud,uBAAyB5xB,EAAUywB,KAAK9D,GAAK3sB,EAAU4uB,sBAAsBjC,GACnFtY,EAAMmd,eAAiB/rB,EAAagtB,eAAepe,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAI2I,EAAMvQ,UAAWuB,EAAoBmG,OAAOI,KAAKzM,OAC7J,IAAIyX,GAA4C,SAAnC9O,EAAQ+O,SAASC,IAAI,WAAuB,GAAQ,CAE5DF,IACH9O,EAAQ+O,SAASA,SAASnC,KAAK,OAAO,GAAGiN,QAENlgB,SAAjC4S,EAAMmd,eAAe3vB,SAA0DJ,SAAjC4S,EAAMmd,eAAeoB,SAAyB5yB,EAAUoQ,cAAc,iBAC9F,YAApBiE,EAAM0X,UACJ1X,EAAMmd,eAAe3vB,QAAQ0W,aAAevY,EAAUyL,YAAYC,IAChE2I,EAAMmd,eAAe3vB,QAAQ0W,YAAclE,EAAMmd,eAAe3vB,QAAQ2W,WAAaxY,EAAUyL,YAAYE,KAC7G3L,EAAUyqB,iBAAiBpW,EAAMvQ,UAAWuQ,EAAM0X,UAAW1X,EAAMsf,QACnE3zB,EAAU0tB,gBAAgBrZ,EAAMmd,eAAe3vB,SAC/C4D,EAAa8tB,gBAAgB,IAAMlf,EAAMmd,eAAe3vB,QAAQgP,IAChEpL,EAAa+tB,oBAAoB1rB,EAAQ+O,UACzC7W,EAAU+V,YAAW,GACrBtQ,EAAamuB,aAAavf,EAAMmd,eAAe3vB,QAASiG,EAAQ+O,SAAUxC,EAAM0X,aAMpF/rB,EAAUyqB,iBAAiBpW,EAAMvQ,UAAWuQ,EAAM0X,UAAW1X,EAAMsf,QACnE3zB,EAAU0tB,gBAAgBrZ,EAAMmd,eAAe3vB,SAC/C4D,EAAa8tB,gBAAgB,IAAMlf,EAAMmd,eAAe3vB,QAAQgP,IAChEpL,EAAa+tB,oBAAoB1rB,EAAQ+O,UACzC7W,EAAU+V,YAAW,GACrBtQ,EAAamuB,aAAavf,EAAMmd,eAAe3vB,QAASiG,EAAQ+O,SAAUxC,EAAM0X,WAChF/rB,EAAU+V,YAAW,KAGzB1B,EAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3Btd,EAAM8U,UAKR9U,EAAM0d,YAAc,SAAUpF,EAAGkH,GAC/Bxf,EAAMud,uBAAyB5xB,EAAUywB,KAAK9D,GAAK3sB,EAAU4uB,sBAAsBjC,GACnFtY,EAAMod,cAAgBhsB,EAAagtB,eAAepe,EAAMud,uBAAyB5xB,EAAUyL,YAAYC,GAAI2I,EAAMvQ,UAAWuB,EAAoBmG,OAAOI,KAAKzM,QACxJ00B,GACkCpyB,SAAhC4S,EAAMod,cAAc5vB,SAAyDJ,SAAhC4S,EAAMod,cAAcmB,UACnEve,EAAMqd,mBAAqBjsB,EAAaquB,2BAA2Bzf,EAAMvQ,UAAWuQ,EAAMod,cAAcmB,QAAQ/hB,GAAIwD,EAAMod,cAAcmB,QAAQ/hB,IAChJ7Q,EAAUsW,gBAAgBjC,EAAMod,cAAcmB,QAASve,EAAMqd,mBAAoBrd,EAAMsd,QAAStd,EAAMod,cAAcxX,QAAS5F,EAAMod,cAActX,SAGrJna,EAAUusB,qBAAqBlY,EAAMvQ,WACrC9D,EAAUwsB,qBAAqBnY,EAAM0X,WACrC1X,EAAMsd,QAAUtd,EAAMud,uBACtB5xB,EAAUouB,WAAW/Z,EAAMsd,SAC3Btd,EAAM8U,eAOhB1pB,QAAQC,OAAO,aAAauU,UAAU,0BACpC,WACA,YACA,eACA,+BACA,sBACA,wBACA,iBACA,eACA,cACA,cACA,iBACA,SAAUlP,EAAU/E,EAAWsG,EAAcytB,EAA8B1uB,EAAqBC,EAAuBH,EAAgBM,EAAcY,EAAa2tB,EAAaC,GAC7K,OACE7f,SAAU,IACVG,KAAM,SAAkBF,EAAOvM,GAC7B/G,EAAEmgB,UAAUnZ,KAAK,QAAS,SAAUO,GAClC,GAAIhE,GAAOgE,EAAEC,QAAUD,EAAEC,QAAUD,EAAEyqB,KACjC/yB,GAAUiuB,cAAgBjuB,EAAUquB,wBACtCha,EAAM6f,eAAe5vB,EAAMgE,KAG/BvH,EAAEmgB,UAAUnZ,KAAK,UAAW,SAAUO,GACpC,IAAK+L,EAAMuL,QAAS,CAClB,GAAItb,GAAOgE,EAAEC,QAAUD,EAAEC,QAAUD,EAAEyqB,OACzB,GAARzuB,GAAqB,GAARA,GAAqB,IAARA,GAAsB,IAARA,GAAsB,IAARA,GAAsB,IAARA,GAAsB,IAARA,GAAsB,IAARA,IAClG+P,EAAM8f,aAAa7vB,EAAMgE,MAI/BvH,EAAEmgB,UAAUnZ,KAAK,WAAY,SAAUO,GACrC,GAAIhE,GAAOgE,EAAEC,QAAUD,EAAEC,QAAUD,EAAEyqB,KACrC1e,GAAM8f,aAAa7vB,EAAMgE,KAE3B+L,EAAM6f,eAAiB,SAAU5vB,EAAMgE,GACrC+L,EAAM8U,OAAO,WACX,GAAI7kB,IAASgB,EAAsBpF,KAAKsI,YAAY4rB,KAAO9vB,IAASgB,EAAsBpF,KAAKsI,YAAY6rB,yBAA0B,CACnI,GAAIC,GAAavzB,EAAE,IAAM0E,EAAa8uB,mBAClChwB,EAAM+vB,EAAWpD,KACrBlxB,GAAUuuB,kBAAiB,EAC3B,IAAIiG,GAAex0B,EAAUuwB,gBAAgBvwB,EAAUiR,wBACnDwjB,EAAUnvB,EAAsBzB,mBAAmB7D,EAAUiR,wBAC7DyjB,IACiCjzB,UAAjCgzB,EAAQloB,sBAAsCkoB,EAAQloB,qBAAqBpN,OAAS,IACtFu1B,EAAcpvB,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwB1E,qBAAqBioB,IAGhF/yB,SAA5BizB,EAAYC,aAA6BpwB,EAAIpF,OAAS,GACpDu1B,EAAYC,YAAYjM,QAAQnkB,GAAO,GACzCvE,EAAUuuB,kBAAiB,GAG3BvuB,EAAUsuB,kBACZgG,EAAWxd,KAAMV,mBAAoB,sBAErCke,EAAWxd,KAAMV,mBAAoB,wBAK7C/B,EAAM8f,aAAe,SAAU7vB,EAAMgE,GACnC+L,EAAM8U,OAAO,WAEX,IAAI7jB,EAAsBpF,KAAK6I,KAAKsC,yBAC7BrL,EAAU4nB,iBAMjB,GAFA5nB,EAAUwwB,eAAelsB,GAErBtE,EAAUkI,eAAeC,WAA0C1G,SAA7BzB,EAAUkI,eAClD,GAAIlI,EAAUkI,eAAemd,gBAAiB,CAE5C,GAAI/gB,IAASgB,EAAsBpF,KAAKsI,YAAYosB,oBAAqB,CACvE,GAMIxf,GANAyf,EAAY70B,EAAUkI,eAAeid,mBACrCrd,EAAUrC,EAAaqvB,YAAYD,GACnC/wB,EAAY2B,EAAasvB,aAAaF,GACtCG,EAAYh1B,EAAUuwB,gBAAgBzsB,GACtC6wB,EAAcrvB,EAAsBzB,mBAAmBC,GAAWyI,qBAAqByoB,GAAWL,YAClGxf,EAAWnV,EAAUkI,eAAesd,cAGtCpQ,GADgC3T,SAA9BqG,EAAQ4Q,OAAOsc,GACNltB,EAAQ4Q,OAAOsc,GAAW5yB,MAE1B,GAEIX,SAAb0T,GAA0BA,IAAaC,GAErB3T,SAAhBkzB,GAA6Bxf,EAAShW,OAAS,GAAKw1B,EAAYjM,QAAQvT,IAAa,KACvF1P,EAAawvB,YAAYnxB,EAAW+wB,EAAWG,EAAW7f,GAC1DhQ,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVnO,KAAQqB,EACR+M,GAAMgkB,EACNG,UAAaA,EACb5f,SAAYA,EACZD,SAAYA,IAEdnV,EAAUkI,eAAegd,oBAG3BllB,EAAUkI,eAAegd,mBAGzB5gB,IAASgB,EAAsBpF,KAAKsI,YAAY0sB,qBAClDl1B,EAAUkI,eAAegd,uBAEtB,CAgBL,GAdI5gB,IAASgB,EAAsBpF,KAAKsI,YAAY2sB,qBAClD7sB,EAAEwpB,iBAGAxtB,IAASgB,EAAsBpF,KAAKsI,YAAY4sB,oBAClD9sB,EAAEwpB,iBACF9xB,EAAUkI,eAAe8c,SAAW,EACpCtjB,QAAQ2zB,IAAI,sBAGV/wB,IAASgB,EAAsBpF,KAAKsI,YAAY8sB,iBAClDt1B,EAAUkI,eAAeyd,iBAGvBrhB,IAASgB,EAAsBpF,KAAKsI,YAAY2sB,oBAAqB,CAQvE,GAAII,GAAMvB,EAAYwB,WAAWx1B,EAAUkI,eAAemc,mBAAoBrkB,EAAUkI,eAAeoc,iBAC3F,MAARiR,GACFpwB,EAAewL,mBACb/G,KAAM,YACNgH,OAAQ,aACR6kB,OAAQz1B,EAAUkI,eAAemc,mBACjCqR,KAAM11B,EAAUkI,eAAeoc,iBAC/BqR,SAAUJ,IAKhB,GAAIjxB,IAASgB,EAAsBpF,KAAKsI,YAAYotB,oBAAqB,CACvE,GAAIC,GAASpwB,EAAaqwB,oBAAoB91B,EAAUkI,eAAekc,eACnD3iB,UAAhBo0B,EAAOpJ,MACTtnB,EAAewL,mBACb/G,KAAM;AACNgH,OAAQ,aACR6b,KAAMoJ,EAAOpJ,KACb3oB,UAAW+xB,EAAO/xB,UAClB6xB,SAAUE,EAAOF,SACjBI,aAAcF,EAAOE,eAM3B,GAAIzxB,IAASgB,EAAsBpF,KAAKsI,YAAYwtB,uBAAwB,CAC1E,GAAIC,GAAQxwB,EAAaywB,QAAQl2B,EAAUkI,eAAekc,gBAAgB,EAC5D,MAAV6R,GACF9wB,EAAewL,mBACb/G,KAAM,YACNgH,OAAQ,UACRqlB,MAAOA,EACPE,WAAYn2B,EAAUkI,eAAekc,eACrCgS,QAAQ,IAKd,GAAI9xB,IAASgB,EAAsBpF,KAAKsI,YAAY6tB,sBAAuB,CACzE,GAAIJ,GAAQxwB,EAAaywB,QAAQl2B,EAAUkI,eAAekc,gBAAgB,EAC5D,MAAV6R,GACF9wB,EAAewL,mBACb/G,KAAM,YACNgH,OAAQ,UACRqlB,MAAOA,EACPE,WAAYn2B,EAAUkI,eAAekc,eACrCgS,QAAQ,IAqBV9xB,IAASgB,EAAsBpF,KAAKsI,YAAY8tB,MAClDnxB,EAAemxB,OAGbhyB,IAASgB,EAAsBpF,KAAKsI,YAAY+tB,MAClDpxB,EAAeoxB,OAGZjuB,EAAE2qB,UAAa3uB,IAASgB,EAAsBpF,KAAKsI,YAAY4rB,KAAO9vB,IAASgB,EAAsBpF,KAAKsI,YAAYguB,eACzHlwB,EAAawa,YAGZ,IAAI9gB,EAAUiuB,YAAa,CAChC,GAAIqG,GAAavzB,EAAE,IAAM0E,EAAa8uB,kBAEtC,KAAKv0B,EAAUsuB,mBAAqBhqB,IAASgB,EAAsBpF,KAAKsI,YAAY6rB,yBAA0B,CAC5G,GAAIK,GAAcpvB,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwB1E,qBAAqBvM,EAAUuwB,gBAAgBvwB,EAAUiR,yBAAyB0jB,WAC/KrsB,GAAEwpB,iBACFxpB,EAAEmuB,kBACFhxB,EAAauC,iBACbhI,EAAU+V,YAAW,GACrBzP,EAAauD,KAAK,mBAAoB,+DAAiEG,KAAKC,UAAUyqB,GAAe,KAGvI,GAAI10B,EAAUsuB,mBAAqBhqB,IAASgB,EAAsBpF,KAAKsI,YAAY6rB,yBAA0B,CAC3G,GAAIqC,GAAiBjxB,EAAaktB,qBAAqB3yB,EAAUiR,uBAAwBxL,EAAakxB,aAClG3B,EAAYh1B,EAAUuwB,gBAAgBvwB,EAAUiR,wBAChDmE,EAAW,EAC0B3T,UAArCi1B,EAAehe,OAAOsc,KACxB5f,EAAWshB,EAAehe,OAAOsc,GAAW5yB,OAE9CqD,EAAawvB,YAAYj1B,EAAUiR,uBAAwBxL,EAAakxB,YAAa32B,EAAUuwB,gBAAgBvwB,EAAUiR,wBAAyBqjB,EAAWpD,OAC7J/rB,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClBJ,GAAMpL,EAAakxB,YACnB3B,UAAaA,EACb5f,SAAYA,EACZD,SAAYmf,EAAWpD,QAEzBzrB,EAAauC,iBACbhI,EAAU+V,YAAW,GACrB/V,EAAU0tB,gBAAgBjoB,EAAaktB,qBAAqB3yB,EAAUiR,uBAAwBxL,EAAakxB,cAGzGryB,IAASgB,EAAsBpF,KAAKsI,YAAY4rB,MAClD3uB,EAAauC,iBACbhI,EAAU+V,YAAW,QAElB,IAAI/V,EAAUquB,0BAA2B,EAAO,CAgJrD,GA/IA5oB,EAAauC,iBAGsC,IAA/ChI,EAAUwoB,SAASL,iBAAiBhpB,QAAgBmF,IAASgB,EAAsBpF,KAAKsI,YAAY4rB,KAAO9tB,EAAaswB,SAAU,GACpItwB,EAAawa,QAIXxc,IAASgB,EAAsBpF,KAAKsI,YAAYguB,eAAiBlxB,EAAsBpF,KAAKmK,cAAcmsB,eACxGx2B,EAAUwoB,WAAaxoB,EAAUioB,OAAOC,oBACtCloB,EAAUkI,eAAeC,UAC3B7B,EAAawa,SAEb9gB,EAAUkI,eAAegK,kBACzB5L,EAAauD,KAAK,mCAKpBvF,IAASgB,EAAsBpF,KAAKsI,YAAYquB,SAC9C72B,EAAUoQ,cAAc,SAC1BpQ,EAAU2S,YAAY,EAAGtN,EAAoBmG,OAAOI,KAAKzM,QAKzDmF,IAASgB,EAAsBpF,KAAKsI,YAAYgnB,QAC9CxvB,EAAUoQ,cAAc,SAC1BpQ,EAAU6S,cAAa,EAAMpN,GAK7BnB,IAASgB,EAAsBpF,KAAKsI,YAAYsuB,SAC9C92B,EAAUoQ,cAAc,SAC1BpQ,EAAU6S,cAAa,EAAOpN,GAK9BnB,IAASgB,EAAsBpF,KAAKsI,YAAYuuB,SAC9C/2B,EAAUoQ,cAAc,SAC1BpQ,EAAU2S,YAAY3S,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,SAK3E9O,IAASgB,EAAsBpF,KAAKsI,YAAYwuB,mBAC9Ch3B,EAAUoQ,cAAc,SAC1BpQ,EAAUgT,eAAc,GAKxB1O,IAASgB,EAAsBpF,KAAKsI,YAAYyuB,oBAC9Cj3B,EAAUoQ,cAAc,SAC1BpQ,EAAUgT,eAAc,GAKxB1O,IAASgB,EAAsBpF,KAAKsI,YAAY0uB,gBAC9Cl3B,EAAUoQ,cAAc,cACtB9K,EAAsBpF,KAAKgyB,aAAaiF,WAC1C9xB,EAAoBiO,WAAW,EAAGjO,EAAoBmG,OAAOI,KAAKzM,QAClEa,EAAUuT,gBAAgB,EAAGlO,EAAoBmG,OAAOI,KAAKzM,SAM/DmF,IAASgB,EAAsBpF,KAAKsI,YAAY4uB,eAC9Cp3B,EAAUoQ,cAAc,cACtB9K,EAAsBpF,KAAKgyB,aAAaiF,WAC1C9xB,EAAoBiO,WAAWtT,EAAUyL,YAAYC,GAAI1L,EAAUyL,YAAYE,IAC/E3L,EAAUuT,gBAAgBvT,EAAUyL,YAAYC,GAAI1L,EAAUyL,YAAYE,KAM5ErH,IAASgB,EAAsBpF,KAAKsI,YAAY6uB,cAC9Cr3B,EAAUoQ,cAAc,cACtB9K,EAAsBpF,KAAKgyB,aAAaiF,WAC1C9xB,EAAoBiO,WAAWtT,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,SACpFpT,EAAUuT,gBAAgBvT,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,UAMjF9O,IAASgB,EAAsBpF,KAAKsI,YAAY8uB,kCAC9Ct3B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAaqF,iBAC1Cv3B,EAAUqnB,oBAAsB,GAKlC/iB,IAASgB,EAAsBpF,KAAKsI,YAAYgvB,mCAC9Cx3B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAaqF,iBAC1Cv3B,EAAUqnB,oBAAsB,GAKlC/iB,IAASgB,EAAsBpF,KAAKsI,YAAYivB,kCAC9Cz3B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAaqF,iBAC1Cv3B,EAAUqnB,oBAAsB,GAKlC/iB,IAASgB,EAAsBpF,KAAKsI,YAAYkvB,mCAC9C13B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAaqF,iBAC1Cv3B,EAAUqnB,oBAAsB,GAKlC/iB,IAASgB,EAAsBpF,KAAKsI,YAAYmvB,+BAC9C33B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAaqF,iBAC1Cv3B,EAAUqnB,oBAAsB5lB,QAKlC6C,IAASgB,EAAsBpF,KAAKsI,YAAYovB,SAC9C53B,EAAUoQ,cAAc,gBAC1BpQ,EAAU8Q,aAAY,EAAOxL,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAOqB,GAIvHnB,IAASgB,EAAsBpF,KAAKsI,YAAYqvB,WAC9C73B,EAAUoQ,cAAc,gBAC1BpQ,EAAU8Q,aAAY,EAAMxL,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAOqB,GAItHnB,IAASgB,EAAsBpF,KAAKsI,YAAYsvB,kCAC9C93B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAAc,CACxD,GAAI+E,GAAW/3B,EAAU+X,kBACrBjU,EAAY9D,EAAUwV,uBACtBuW,EAAY/rB,EAAU0a,uBACtBsd,EAAWh4B,EAAUitB,wBACrBgL,EAAUxyB,EAAayyB,cAAa,EAAMp0B,EAAWi0B,EAAUC,EAAUjM,EACzEkM,MAAY,IAEI,UAAdlM,EACF5mB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,YACVnO,KAAQqB,EACR+M,GAAMknB,EAASlnB,GACfsiB,QAAW8E,IAEU,YAAdlM,GACT5mB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,eACVnO,KAAQqB,EACR+M,GAAMknB,EAASlnB,GACfsiB,QAAW8E,EACXtC,SAAY,IAGhBxwB,EAAewD,8BAMvB,GAAIrE,IAASgB,EAAsBpF,KAAKsI,YAAY2vB,qCAC9Cn4B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAAc,CACxD,GAAI+E,GAAW/3B,EAAU+X,kBACrBjU,EAAY9D,EAAUwV,uBACtBuW,EAAY/rB,EAAU0a,uBACtBsd,EAAWh4B,EAAUitB,wBACrBgL,EAAUxyB,EAAayyB,cAAa,EAAOp0B,EAAWi0B,EAAUC,EAAUjM,EAC/D,IAAXkM,IAEgB,UAAdlM,EACF5mB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,YACVnO,KAAQqB,EACR+M,GAAMknB,EAASlnB,GACfsiB,QAAW8E,IAEU,YAAdlM,GACT5mB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,eACVnO,KAAQqB,EACR+M,GAAMknB,EAASlnB,GACfsiB,QAAW8E,EACXtC,SAAY,IAGhBxwB,EAAewD,8BAMvB,GAAIrE,IAASgB,EAAsBpF,KAAKsI,YAAY4vB,mCAC9Cp4B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAAc,CACxD,GAAIqF,EAMJ,IAJEA,EADuC,YAArCr4B,EAAU0a,uBACLjV,EAAa6yB,kCAAkCt4B,EAAU+X,kBAAkBQ,aAE3E9S,EAAa6yB,kCAAkCt4B,EAAU+X,kBAAkB0B,aAEvE,IAAT4e,EAAY,CACd,GAAIzI,GAAM5vB,EAAU+X,kBAEhBwgB,GADQv4B,EAAUitB,wBACNjtB,EAAUwV,uBAC1B/P,GAAaytB,aAAaqF,EAAW3I,EAAI/e,GAAIwnB,EAAM,GACnDlzB,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,eACVnO,KAAQ81B,EACR1nB,GAAM+e,EAAI/e,GACVsiB,QAAWkF,EACX1C,SAAY,IAEdxwB,EAAewD,8BAMvB,GAAIrE,IAASgB,EAAsBpF,KAAKsI,YAAYgwB,wBAC9Cx4B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAC1C,GAAyCvxB,SAArCzB,EAAUiR,uBACZ3K,EAAauD,KAAK,mBAAoB,0DAEtC,IAAuC,IAAnC7J,EAAUguB,cAAc7uB,OAC1BmH,EAAauD,KAAK,mBAAoB,uEACjC,CACL,GAAI4uB,GAAazO,SAAS1kB,EAAsBpF,KAAKw4B,kBAAkBC,aAAc,GACpB,cAA7DrzB,EAAsBpF,KAAKw4B,kBAAkBE,cAC/CH,EAAanzB,EAAsBpF,KAAKw4B,kBAAkBC,cAAgBtzB,EAAoBmG,OAAOI,KAAKzM,OAAS,MAErHsG,EAAaozB,eAAc,EAAM74B,EAAUgY,mBAAoBhY,EAAUiR,uBAAwBwnB,GACjGtzB,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,iBACVnO,KAAQzC,EAAUiR,uBAClBwb,KAAQzsB,EAAUgY,mBAClB8gB,WAAa,EACbL,WAAcA,IAEhBz4B,EAAU2qB,iBAOpB,GAAIrmB,IAASgB,EAAsBpF,KAAKsI,YAAYuwB,uBAC9C/4B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAC1C,GAAyCvxB,SAArCzB,EAAUiR,uBACZ3K,EAAauD,KAAK,mBAAoB,0DAEtC,IAAuC,IAAnC7J,EAAUguB,cAAc7uB,OAC1BmH,EAAauD,KAAK,mBAAoB,uEACjC,CACL,GAAiE,aAA7DvE,EAAsBpF,KAAKw4B,kBAAkBE,YAC/C,GAAIH,GAAazO,SAAS1kB,EAAsBpF,KAAKw4B,kBAAkBC,aAAc,QAChF,IAAiE,aAA7DrzB,EAAsBpF,KAAKw4B,kBAAkBE,YACtD,GAAIH,GAAanzB,EAAsBpF,KAAKw4B,kBAAkBC,cAAgBtzB,EAAoBmG,OAAOI,KAAKzM,OAAS,SAEvHmH,GAAauD,KAAK,mBAAoB,uFAExCpE,GAAaozB,eAAc,EAAO74B,EAAUgY,mBAAoBhY,EAAUiR,uBAAwBwnB,GAClGtzB,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,iBACVnO,KAAQzC,EAAUiR,uBAClBwb,KAAQzsB,EAAUgY,mBAClB8gB,WAAa,EACbL,WAAcA,IAEhBz4B,EAAU2qB,iBAOpB,GAAIrmB,IAASgB,EAAsBpF,KAAKsI,YAAYwwB,uBAC9Ch5B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAC1C,GAAyCvxB,SAArCzB,EAAUiR,uBACZ3K,EAAauD,KAAK,mBAAoB,0DAEtC,IAAuC,IAAnC7J,EAAUguB,cAAc7uB,OAC1BmH,EAAauD,KAAK,mBAAoB,uEACjC,CACL,GAAiE,aAA7DvE,EAAsBpF,KAAKw4B,kBAAkBE,YAC/C,GAAIH,GAAazO,SAAS1kB,EAAsBpF,KAAKw4B,kBAAkBC,aAAc,QAChF,IAAiE,aAA7DrzB,EAAsBpF,KAAKw4B,kBAAkBE,YACtD,GAAIH,GAAanzB,EAAsBpF,KAAKw4B,kBAAkBC,cAAgBtzB,EAAoBmG,OAAOI,KAAKzM,OAAS,SAEvHmH,GAAauD,KAAK,mBAAoB,uFAExCpE,GAAaozB,eAAc,EAAM74B,EAAUgY,mBAAoBhY,EAAUiR,wBAAyBwnB,GAClGtzB,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,iBACVnO,KAAQzC,EAAUiR,uBAClBwb,KAAQzsB,EAAUgY,mBAClB8gB,WAAa,EACbL,YAAeA,IAEjBz4B,EAAU2qB,iBAOpB,GAAIrmB,IAASgB,EAAsBpF,KAAKsI,YAAYywB,wBAC9Cj5B,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAac,aAC1C,GAAyCvxB,SAArCzB,EAAUiR,uBACZ3K,EAAauD,KAAK,mBAAoB,0DAEtC,IAAuC,IAAnC7J,EAAUguB,cAAc7uB,OAC1BmH,EAAauD,KAAK,mBAAoB,uEACjC,CACL,GAAiE,aAA7DvE,EAAsBpF,KAAKw4B,kBAAkBE,YAC/C,GAAIH,GAAazO,SAAS1kB,EAAsBpF,KAAKw4B,kBAAkBC,aAAc,QAChF,IAAiE,aAA7DrzB,EAAsBpF,KAAKw4B,kBAAkBE,YACtD,GAAIH,GAAanzB,EAAsBpF,KAAKw4B,kBAAkBC,cAAgBtzB,EAAoBmG,OAAOI,KAAKzM,OAAS,SAEvHmH,GAAauD,KAAK,mBAAoB,uFAExCpE,GAAaozB,eAAc,EAAO74B,EAAUgY,mBAAoBhY,EAAUiR,wBAAyBwnB,GACnGtzB,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,iBACVnO,KAAQzC,EAAUiR,uBAClBwb,KAAQzsB,EAAUgY,mBAClB8gB,WAAa,EACbL,YAAeA,IAEjBz4B,EAAU2qB,iBAyBpB,GAlBIrmB,IAASgB,EAAsBpF,KAAKsI,YAAY0wB,mBAC9Cl5B,EAAUoQ,cAAc,mBAEtB9K,EAAsBpF,KAAKmK,cAAc8uB,UAC3Cn5B,EAAU6K,cAAcvF,EAAsBnF,OAAO2K,UAAUC,QAKjEzG,IAASgB,EAAsBpF,KAAKsI,YAAY4wB,oBAC9Cp5B,EAAUoQ,cAAc,mBAEtB9K,EAAsBpF,KAAKmK,cAAc8uB,UAC3Cn5B,EAAU6T,qBAAqB7T,EAAU8T,uBAK3CxP,IAASgB,EAAsBpF,KAAKsI,YAAY6wB,wBAC9Cr5B,EAAUoQ,cAAc,eAC1B,GAAyC3O,SAArCzB,EAAUiR,uBACZ3K,EAAauD,KAAK,mBAAoB,qDACjC,CACL7J,EAAU8mB,gBACV,IAAI4M,GAAO,IACXj0B,SAAQwB,QAAQjB,EAAUktB,oBAAoB7mB,EAAYzF,KAAKyL,QAAS,SAAUogB,GACnE,OAATiH,EACF1zB,EAAU0tB,gBAAgBjB,GAE1BzsB,EAAU8tB,wBAAwBrB,EAAMiH,GAE1CA,EAAOjH,IAETzsB,EAAU2qB,iBAKhB,GAAIrmB,IAASgB,EAAsBpF,KAAKsI,YAAY8wB,aAC9Ct5B,EAAUoQ,cAAc,gBACtBpQ,EAAUgY,mBAAmB7Y,OAAS,EAAG,CAC3C,GAAIuyB,GAAqBjsB,EAAaquB,2BAA2B9zB,EAAUiR,uBAAwBjR,EAAUgY,mBAAmB,GAAGnH,GAAI7Q,EAAUgY,mBAAmBhY,EAAUgY,mBAAmB7Y,OAAS,GAAG0R,IACzM0oB,EAAa9zB,EAAaquB,2BAA2B9zB,EAAUiR,uBAAwBygB,EAAmB/D,KAAK9c,GAAI6gB,EAAmB/D,KAAK9c,GAC/GpP,UAA5BiwB,EAAmB/D,OACuBlsB,SAAxCiwB,EAAmB/D,KAAKpV,YAEtBmZ,EAAmB/D,KAAKpV,YAAcvY,EAAUyL,YAAYC,KAC1DpD,EAAE2qB,UAEJjzB,EAAU8tB,wBAAwB4D,EAAmB/D,KAAM4L,EAAW3L,OACtEnoB,EAAa8tB,gBAAgB,IAAM7B,EAAmB/D,KAAK9c,MAE3D7Q,EAAU0tB,gBAAgBgE,EAAmB/D,MAC7CloB,EAAa8tB,gBAAgB,IAAM7B,EAAmB/D,KAAK9c,KAE7D7Q,EAAU2qB,kBAIR+G,EAAmB/D,KAAKlU,YAAczZ,EAAUyL,YAAYC,KAC1DpD,EAAE2qB,UAEJjzB,EAAU8tB,wBAAwB4D,EAAmB/D,KAAM4L,EAAW3L,OACtEnoB,EAAa8tB,gBAAgB,IAAM7B,EAAmB/D,KAAK9c,MAE3D7Q,EAAU0tB,gBAAgBgE,EAAmB/D,MAC7CloB,EAAa8tB,gBAAgB,IAAM7B,EAAmB/D,KAAK9c,KAE7D7Q,EAAU2qB,mBAQtB,GAAIrmB,IAASgB,EAAsBpF,KAAKsI,YAAYgxB,aAC9Cx5B,EAAUoQ,cAAc,gBACtBpQ,EAAUgY,mBAAmB7Y,OAAS,EAAG,CAC3C,GAAIuyB,GAAqBjsB,EAAaquB,2BAA2B9zB,EAAUiR,uBAAwBjR,EAAUgY,mBAAmB,GAAGnH,GAAI7Q,EAAUgY,mBAAmBhY,EAAUgY,mBAAmB7Y,OAAS,GAAG0R,IACzM0oB,EAAa9zB,EAAaquB,2BAA2B9zB,EAAUiR,uBAAwBygB,EAAmB9D,MAAM/c,GAAI6gB,EAAmB9D,MAAM/c,GAChHpP,UAA7BiwB,EAAmB9D,QACwBnsB,SAAzCiwB,EAAmB9D,MAAMrV,YAEvBmZ,EAAmB9D,MAAMrV,YAAcmZ,EAAmB9D,MAAMpV,UAAYxY,EAAUyL,YAAYE,KAChGrD,EAAE2qB,UAEJjzB,EAAU8tB,wBAAwB4D,EAAmB9D,MAAO2L,EAAW5L,MACvEloB,EAAa8tB,gBAAgB,IAAM7B,EAAmB9D,MAAM/c,MAE5D7Q,EAAU0tB,gBAAgBgE,EAAmB9D,OAC7CnoB,EAAa8tB,gBAAgB,IAAM7B,EAAmB9D,MAAM/c,KAE9D7Q,EAAU2qB,kBAIR+G,EAAmB9D,MAAMnU,YAAczZ,EAAUyL,YAAYE,KAC3DrD,EAAE2qB,UAEJjzB,EAAU8tB,wBAAwB4D,EAAmB9D,MAAO2L,EAAW5L,MACvEloB,EAAa8tB,gBAAgB,IAAM7B,EAAmB9D,MAAM/c,MAE5D7Q,EAAU0tB,gBAAgBgE,EAAmB9D,OAC7CnoB,EAAa8tB,gBAAgB,IAAM7B,EAAmB9D,MAAM/c,KAE9D7Q,EAAU2qB,mBAQtB,GAAIrmB,IAASgB,EAAsBpF,KAAKsI,YAAYixB,iBAC9Cz5B,EAAUoQ,cAAc,gBACtBpQ,EAAUgY,mBAAmB7Y,OAAS,EAAG,CAC3C,GAAIu6B,GAAS15B,EAAUgY,mBAAmB,GAAGnH,GACzC8oB,EAAU35B,EAAUgY,mBAAmBhY,EAAUgY,mBAAmB7Y,OAAS,GAAG0R,GAChF6gB,EAAqBjsB,EAAaquB,2BAA2B9zB,EAAUiR,uBAAwByoB,EAAQC,EACvGrxB,GAAE2qB,SAC4BxxB,SAA5BiwB,EAAmB/D,OACuBlsB,SAAxCiwB,EAAmB/D,KAAKpV,YAEtBmZ,EAAmB/D,KAAKpV,aAAevY,EAAUyL,YAAYC,KAC/D1L,EAAU0tB,gBAAgBgE,EAAmB/D,MAC7CloB,EAAa8tB,gBAAgB,IAAM7B,EAAmB/D,KAAK9c,KAIzD6gB,EAAmB/D,KAAKlU,aAAezZ,EAAUyL,YAAYC,KAC/D1L,EAAU0tB,gBAAgBgE,EAAmB/D,KAAM+D,EAAmB/D,KAAK9c,IAC3EpL,EAAa8tB,gBAAgB,IAAM7B,EAAmB/D,KAAK9c,MAKhCpP,SAA7BiwB,EAAmB9D,QACwBnsB,SAAzCiwB,EAAmB9D,MAAMrV,YAEvBmZ,EAAmB9D,MAAMrV,YAAcmZ,EAAmB9D,MAAMpV,WAAaxY,EAAUyL,YAAYE,KACrG3L,EAAU0tB,gBAAgBgE,EAAmB9D,OAC7CnoB,EAAa8tB,gBAAgB,IAAM7B,EAAmB9D,MAAM/c,KAI1D6gB,EAAmB9D,MAAMnU,YAAczZ,EAAUyL,YAAYE,KAC/D3L,EAAU0tB,gBAAgBgE,EAAmB9D,OAC7CnoB,EAAa8tB,gBAAgB,IAAM7B,EAAmB9D,MAAM/c,MAS1E,GAAIvM,IAASgB,EAAsBpF,KAAKsI,YAAY6rB,yBAElD,GAAI/tB,EAAasQ,OACftQ,EAAaszB,qBAEb,IAAqCn4B,SAAjCzB,EAAUsnB,mBACZhhB,EAAauD,KAAK,mBAAoB,mEAEtC,IAAI7J,EAAUoQ,cAAc,gBACtB9K,EAAsBpF,KAAKgyB,aAAagE,QAC1C,GAAIl2B,EAAU+tB,mBAAmB5rB,QAAUnC,EAAUyL,YAAY0H,SAAWnT,EAAU+tB,mBAAmBxE,MAAQvpB,EAAUyL,YAAY2H,QACzF,IAAxCpT,EAAUgY,mBAAmB7Y,OAE3Ba,EAAU+tB,mBAAmB5rB,OAASnC,EAAUyL,YAAYC,IAAM1L,EAAU+tB,mBAAmBxE,KAAOvpB,EAAUyL,YAAYE,KAC9H3L,EAAU+V,YAAW,GACrBtQ,EAAamuB,aAAa5zB,EAAUgY,mBAAmB,GAAIvS,EAAao0B,sBAAuB75B,EAAUmsB,wBACzG9X,EAAMrE,qBAGR1J,EAAauD,KAAK,mBAAoB,qDAGxC,IAAqC,IAAjC7J,EAAUyL,YAAY2H,SAAkD,IAAjCpT,EAAUyL,YAAY0H,QAC/D7M,EAAauD,KAAK,mBAAoB,sJACjC,CACL,GAAI+lB,GAAMnqB,EAAagtB,eAAezyB,EAAUyL,YAAY0H,QAASnT,EAAUiR,uBAAwB5L,EAAoBmG,OAAOI,KAAKzM,QAAQ0C,OAC/I,IAAyC,YAArC7B,EAAUmsB,uBACZ,GAAY1qB,SAARmuB,EAAmB,CACrB,GAAIkK,GAASr0B,EAAas0B,cAAc/5B,EAAUiR,uBAAwBjR,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,QAAS9N,EAAsBpF,KAAKw4B,kBAAkBsB,eAChLF,GAAO/3B,IAGVoD,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,iBACVnO,KAAQzC,EAAUiR,uBAClB9O,MAASnC,EAAUyL,YAAY0H,QAC/BoW,IAAOvpB,EAAUyL,YAAY2H,QAC7B6mB,IAAOH,EAAOG,IACdC,QAAW50B,EAAsBpF,KAAKw4B,kBAAkBsB,iBAT1D1zB,EAAauD,KAAK,mBAAoB,6DAaxC,IAAI+lB,EAAIrX,cAAgBvY,EAAUyL,YAAY0H,SAAWyc,EAAIrX,YAAcqX,EAAIpX,UAAY,IAAMxY,EAAUyL,YAAY2H,QACrH3N,EAAa8tB,gBAAgB,IAAM3D,EAAI/e,IACvCpL,EAAamuB,aAAahE,EAAKnqB,EAAao0B,sBAAuB75B,EAAUmsB,wBAC7EnsB,EAAU+V,YAAW,OAChB,CACL,GAAI+jB,GAASr0B,EAAas0B,cAAc/5B,EAAUiR,uBAAwBjR,EAAUyL,YAAY0H,QAASnT,EAAUyL,YAAY2H,QAAS9N,EAAsBpF,KAAKw4B,kBAAkBsB,eAChLF,GAAO/3B,IAGVoD,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,iBACVnO,KAAQzC,EAAUiR,uBAClB9O,MAASnC,EAAUyL,YAAY0H,QAC/BoW,IAAOvpB,EAAUyL,YAAY2H,QAC7B6mB,IAAOH,EAAOG,IACdC,QAAW50B,EAAsBpF,KAAKw4B,kBAAkBsB,iBAT1D1zB,EAAauD,KAAK,mBAAoB,6DAcvC,CACL,GAAIgL,GAAWvP,EAAsBzB,mBAAmB7D,EAAUiR,uBAClE,IAAsC,mBAA3B4D,GAASslB,cAA+B,CACjD,GAAIC,GAAW30B,EAAa40B,YAAYr6B,EAAUiR,uBAAwBjR,EAAUyL,YAAY0H,QAAS7N,EAAsBpF,KAAKw4B,kBAAkB4B,aAClJF,GAASG,eACX90B,EAAa8tB,gBAAgB,IAAM3D,EAAI/e,IACvCpL,EAAamuB,aAAahE,EAAKnqB,EAAao0B,sBAAuB75B,EAAUmsB,wBAC7EnsB,EAAU+V,YAAW,IAErB5Q,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAASnC,EAAUyL,YAAY0H,QAC/BtC,GAAMupB,EAASvpB,GACf2pB,UAAal1B,EAAsBpF,KAAKw4B,kBAAkB4B,mBAI9DrG,GAAewG,uBAwBjC,GAZIn2B,IAASgB,EAAsBpF,KAAKsI,YAAY8tB,MAC9Ct2B,EAAUoQ,cAAc,gBAC1BjL,EAAemxB,OAIfhyB,IAASgB,EAAsBpF,KAAKsI,YAAY+tB,MAC9Cv2B,EAAUoQ,cAAc,gBAC1BjL,EAAeoxB,OAIfjyB,IAASgB,EAAsBpF,KAAKsI,YAAYkyB,sBAC9C16B,EAAUoQ,cAAc,eAAgB,CAC1C9H,EAAEwpB,gBACF,IAAIlC,GAAM5vB,EAAU+X,kBAChB4iB,EAAO36B,EAAUgY,mBACjBiC,EAAUja,EAAUka,qBACpBC,EAASna,EAAUoa,oBACnBme,EAAYv4B,EAAUwV,uBACtB5L,EAAO5J,EAAU0a,sBACrB,IAAKpS,EAAE2qB,UAoEL,GAAI3tB,EAAsBpF,KAAKgyB,aAAa0I,YAC7Bn5B,SAATk5B,GAAsBA,EAAKx7B,OAAS,EACtC,GAAyC,YAArCa,EAAUmsB,uBAAsC,CAClD,GAAI0O,GAAiBp1B,EAAaq1B,eAAevC,EAAWoC,EAAK,GAAG9pB,GAAI8pB,EAAKx7B,OAC7EgG,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,iBACVnO,KAAQ81B,EACR1nB,GAAM8pB,EAAK,GAAG9pB,GACd1R,OAAUw7B,EAAKx7B,OACf07B,eAAkBA,GAEpB,IAAI9E,GAAe/B,EAAY+G,kBAAkBJ,EACjDx1B,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,oBACVnO,KAAQ81B,EACRyC,SAAYL,EACZ5E,aAAgBA,IAElB5wB,EAAewD,4BACf,IAAI8oB,GAAgBhsB,EAAagtB,eAAezyB,EAAUmuB,YAAcnuB,EAAUyL,YAAYC,GAAI6sB,EAAWlzB,EAAoBmG,OAAOI,KAAKzM,OAC7I,IAA8BsC,SAA1BgwB,EAAc5vB,SAAmDJ,SAA1BgwB,EAAcmB,QAAuB,CAC9E,GAAIlB,GAAqBjsB,EAAaquB,2BAA2BhwB,EAAW2tB,EAAcmB,QAAQ/hB,GAAI4gB,EAAcmB,QAAQ/hB,GAC5H7Q,GAAUsW,gBAAgBmb,EAAcmB,QAASlB,EAAoB1xB,EAAUmuB,YAAasD,EAAcxX,QAASwX,EAActX,QAEnIna,EAAU0tB,gBAAgBmN,EAAeI,cAEzC30B,GAAauD,KAAK,mBAAoB,kEA/F5C,IAAIvE,EAAsBpF,KAAKgyB,aAAagJ,oBAC9Bz5B,SAARmuB,EAAmB,CACrB,GAAIlD,GAAYjnB,EAAaquB,2BAA2ByE,EAAW3I,EAAI/e,GAAI+e,EAAI/e,GAC/E,IAAa,YAATjH,EAAoB,CACtB,GAAIixB,GAAiBp1B,EAAa01B,eAAe5C,EAAW3I,EAAI/e,GAAIoJ,EAASE,EAC7EhV,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,iBACVnO,KAAQ81B,EACR1nB,GAAM+e,EAAI/e,GACVoJ,QAAWA,EACXE,OAAUA,EACV0gB,eAAkBA,GAEpB,IAAI9E,EACmBt0B,UAAnBirB,EAAUiB,MACZoI,EAAe/B,EAAYoH,mBAAmBxL,EAAI/e,GAAI6b,EAAUiB,KAAK9c,IACrE1L,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,qBACVnO,KAAQ81B,EACR1nB,GAAM+e,EAAI/e,GACVwqB,YAAe3O,EAAUiB,KAAK9c,GAC9BklB,aAAgBA,MAGlBA,EAAe/B,EAAYoH,mBAAmBxL,EAAI/e,GAAI,IACtD1L,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,qBACVnO,KAAQ81B,EACR1nB,GAAM+e,EAAI/e,GACVwqB,YAAe,GACftF,aAAgBA,KAGpB5wB,EAAewD,4BACf,IAAI8oB,GAAgBhsB,EAAagtB,eAAezyB,EAAUmuB,YAAcnuB,EAAUyL,YAAYC,GAAI6sB,EAAWlzB,EAAoBmG,OAAOI,KAAKzM,OAC7I,IAA8BsC,SAA1BgwB,EAAc5vB,SAAmDJ,SAA1BgwB,EAAcmB,QAAuB,CAC9E,GAAIlB,GAAqBjsB,EAAaquB,2BAA2BhwB,EAAW2tB,EAAcmB,QAAQ/hB,GAAI4gB,EAAcmB,QAAQ/hB,GAC5H7Q,GAAUsW,gBAAgBmb,EAAcmB,QAASlB,EAAoB1xB,EAAUmuB,YAAasD,EAAcxX,QAASwX,EAActX,QAEnIna,EAAU0tB,gBAAgBmN,EAAeI,cACpC,CACL,GAAIK,GAAe71B,EAAa81B,YAAYhD,EAAW3I,EAAI/e,GAC3D,IAAIyqB,KAAiB,EAAO,CAC1Bn2B,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQ81B,EACRp2B,MAASm5B,EAAa7hB,YACtB5I,GAAMyqB,EAAazqB,GACnB2pB,UAAac,EAAa5iB,OAAO,GAAGtW,QAEtC+C,EAAewD,4BACf,IAAI8oB,GAAgBhsB,EAAagtB,eAAezyB,EAAUmuB,YAAcnuB,EAAUyL,YAAYC,GAAI6sB,EAAWlzB,EAAoBmG,OAAOI,KAAKzM,OAC7I,IAA8BsC,SAA1BgwB,EAAc5vB,SAAmDJ,SAA1BgwB,EAAcmB,QAAuB,CAC9E,GAAIlB,GAAqBjsB,EAAaquB,2BAA2BhwB,EAAW2tB,EAAcmB,QAAQ/hB,GAAI4gB,EAAcmB,QAAQ/hB,GAC5H7Q,GAAUsW,gBAAgBmb,EAAcmB,QAASlB,EAAoB1xB,EAAUmuB,YAAasD,EAAcxX,QAASwX,EAActX,aAGnIna,GAAUsW,gBAAgB7U,OAAWA,OAAWA,OAAWA,OAAWA,UAyC/E6G,EAAEkzB,SAAYlzB,EAAEmzB,UACnBnzB,EAAEwpB,iBACFxpB,EAAEmuB,uBAKVpiB,EAAMqnB,UAAY,SAAUC,GAC1B,GAAIC,GAAQr9B,KAAKs9B,MAAMC,OACV,WAATF,GAA8B,WAATA,EACnBD,GAAoB,kBAAPA,IACfA,IAGFp9B,KAAK4qB,OAAOwS,IAIhBtnB,EAAMpL,IAAI,WAAY,WACpBlI,EAAEzC,QAAQy9B,IAAI,kBAOxBt8B,QAAQC,OAAO,aAAauU,UAAU,UACpC,eACA,SAAU3N,GACR,OACE8N,SAAU,IACVG,KAAM,SAAUF,EAAOvM,EAAS0M,GAC9B1M,EAAQC,KAAK,QAAS,WACpBsM,EAAMxN,GAAGolB,qBAAqB5X,EAAM/D,MAAM7N,KAAM+R,EAAAA,WAChDH,EAAMxN,GAAG4jB,iBAAiBpW,EAAM/D,MAAM7N,KAAM4R,EAAM/D,MAAM1G,KAAMyK,EAAMjQ,OACpEkC,EAAauD,KAAK,yBAA0BwK,EAAM/D,MAAM7N,aAOlEhD,QAAQC,OAAO,aAAauU,UAAU,UACpC,eACA,YACA,SAAUxO,EAAczF,GACtB,OACEoU,SAAU,IACVG,KAAM,SAAUF,EAAOvM,GACrB,GAAIk0B,GAAOl0B,EAAQ+O,SAASA,SACxBolB,EAAa,EACbC,EAAeF,EAAKtnB,KAAK5M,EAAQ+O,SAASslB,WAAW,IAErDC,GADeJ,EAAKtnB,KAAK5M,EAAQ+O,SAASslB,WAAW,IACxCH,EAAKtnB,KAAK5M,EAAQ+O,SAASslB,WAAW,IACvDr0B,GAAQC,KAAK,QAAS,WACpBtC,EAAauC,iBACbhI,EAAU+V,YAAW,GACjB1B,EAAMxK,MACRwK,EAAMxK,MAAO,EACboyB,EAAaD,EAAKllB,IAAI,UACtBklB,EAAKllB,KAAMK,OAAU,SACjB9C,EAAM7N,IAAItG,KAAKmK,cAAcgyB,mBAC/BH,EAAaI,OAEXjoB,EAAM7N,IAAItG,KAAKmK,cAAckyB,iBAC/BH,EAAWE,SAGbjoB,EAAMxK,MAAO,EACbmyB,EAAKllB,KAAMK,OAAU8kB,IACjB5nB,EAAM7N,IAAItG,KAAKmK,cAAcgyB,mBAC/BH,EAAaM,OAEXnoB,EAAM7N,IAAItG,KAAKmK,cAAckyB,iBAC/BH,EAAWI,QAGfnoB,EAAMgC,oBAOhB5W,QAAQC,OAAO,aAAauU,UAAU,WACpC,aACA,YACA,wBACA,SAAUrP,EAAY5E,EAAWsF,GAC/B,OACE8O,SAAU,IACVG,KAAM,SAAUF,EAAOvM,EAAS8S,GAC9BvG,EAAMa,OAAO,8BAA+B,WACrCnU,EAAEC,cAAcsE,EAAsBpF,KAAK6C,eACzChC,EAAEC,cAAchB,EAAUgD,qBAC4E,IAArGsC,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAemB,MAAMjF,OAC5F2I,EAAQw0B,OAERx0B,EAAQ00B,UAIb,EACH,IAAI3yB,IAAO,CACX/B,GAAQC,KAAK,QAAS,WAChB8B,GACFA,GAAO,EACP7J,EAAU4rB,WAAW,MAErB/hB,GAAO,EACP7J,EAAU4rB,WAAWhR,EAAM6hB,UAE7B73B,EAAWukB,gBAOrB1pB,QAAQC,OAAO,aAAauU,UAAU,QACpC,eACA,oBACA,SAAU3N,EAAcX,GACtB,OACEyO,SAAU,IACVG,KAAM,SAAUF,EAAOvM,EAAS0M,GAC9B1M,EAAQC,KAAK,QAAS,WACpBsM,EAAMxN,GAAGolB,qBAAqB5X,EAAM/D,MAAM7N,KAAM+R,EAAKyM,MACrDtb,EAAkB+2B,cAAcroB,EAAM/D,MAAM7N,MAAMiH,KAAK,SAAUmsB,GAC/DvvB,EAAauD,KAAK,oBAAqBpH,KAAO,YAAaozB,YAQvEp2B,QAAQC,OAAO,aAAauU,UAAU,cAAe,WACnD,OACEG,SAAU,IACVC,OAASuC,OAAQ,gBACjBrC,KAAM,SAAUF,EAAOvM,EAAS0M,GAC9B,GAAImoB,GAAgB3S,SAASxV,EAAKooB,oBAAqB,KAAO,GAE1DvoB,GAAMuC,QAER9O,EAAQ+0B,OAAOC,YAAY,GAI7BzoB,EAAMa,OAAO,SAAU,SAAU6nB,EAAcC,GACzCD,IAAiBC,GACnBl1B,EAAQ+0B,OAAOC,YAAYH,SAOrCl9B,QAAQC,OAAO,aAAauU,UAAU,gBACpC,YACA,sBACA,SAAUjU,EAAWqF,GACnB,OACE+O,SAAU,IACVC,SACAE,KAAM,SAAUF,EAAOvM,GACrB,GAAIm1B,GAAW,EAGfn1B,GAAQC,KAAK,QAAS,SAAU4kB,GAC9B,IAAK5rB,EAAEC,cAAcqE,EAAoBmG,QAAS,CAChD,GAAI0L,GAAQlX,EAAUyL,YAAYE,GAAK3L,EAAUyL,YAAYC,EAC7DuxB,GAAWj9B,EAAUywB,KAAK9D,IAAMtnB,EAAoBmG,OAAOI,KAAKzM,OAASwtB,EAAEmC,cAAclN,OAAO1K,OACrE,EAAvB+lB,EAAW/lB,EAAQ,EACrB+lB,EAAWvjB,KAAK6X,KAAKra,EAAQ,GACpB+lB,EAAW/lB,EAAQ,EAAI7R,EAAoBmG,OAAOI,KAAKzM,SAChE89B,EAAWvjB,KAAKwP,MAAM7jB,EAAoBmG,OAAOI,KAAKzM,OAAS+X,EAAQ,IAEpElX,EAAUiuB,aACb5Z,EAAM8U,OAAO,WACXnpB,EAAU2S,YAAYsqB,EAAW/lB,EAAQ,EAAG+lB,EAAW/lB,EAAQ,QAMvEpP,EAAQC,KAAK,YAAa,SAAU4kB,GAC7B5rB,EAAEC,cAAcqE,EAAoBmG,UACvCyxB,EAAWj9B,EAAUywB,KAAK9D,IAAMtnB,EAAoBmG,OAAOI,KAAKzM,OAASwtB,EAAEmC,cAAclN,OAAO1K,UAIpGpP,EAAQC,KAAK,YAAa,SAAU4kB,GAClC,GAAIkG,GAAU,CAMd,QAJEA,EADgBpxB,SAAdkrB,EAAEmG,QACMnG,EAAEoG,MAEFpG,EAAEmG,SAGd,IAAK,GACH,GAAiB,KAAbmK,EAAiB,CACnB,GAAI/lB,GAAQlX,EAAUyL,YAAYE,GAAK3L,EAAUyL,YAAYC,EAC7DuxB,GAAWj9B,EAAUywB,KAAK9D,IAAMtnB,EAAoBmG,OAAOI,KAAKzM,OAASwtB,EAAEmC,cAAclN,OAAO1K,OAC3FlX,EAAUiuB,aACb5Z,EAAM8U,OAAO,WACXnpB,EAAU2S,YAAYsqB,EAAW/lB,EAAQ,EAAG+lB,EAAW/lB,EAAQ,SAQzEpP,EAAQC,KAAK,UAAW,WACtBk1B,EAAW,KAGbn1B,EAAQC,KAAK,WAAY,WACvBk1B,EAAW,UAOrBx9B,QAAQC,OAAO,aAAaI,QAAQ,oBAClC,aACA,QACA,YACA,KACA,iBACA,YACA,sBACA,oBACA,mBACA,wBACA,wBACA,oBACA,kBACA,mBACA,uBACA,SAA0B8E,EAAYs4B,EAAOh4B,EAAWnF,EAAIoF,EAAgBnF,EAAWqF,EAAqBS,EAAmBD,EAAkBH,EAAuBJ,EAAuBK,EAAmBH,EAAiB23B,EAAkBC,GAEnP,GAAIn9B,KA2JJ,OAzJAA,GAASuJ,IAAM2zB,EAIfl9B,EAAS+M,qBAAuB,WAC9B,GAAIqwB,GAAOH,EAAMI,IAAI,2CACrB,OAAOD,IAKTp9B,EAAS6M,qBAAuB,WAC9B,GAAIuwB,GAAOH,EAAMI,IAAI,2CACrB,OAAOD,IAKTp9B,EAASsK,YAAc,SAAUua,EAAMyY,GACrC,GAAIF,GAAOH,EAAMI,IAAIxY,GAAQ0Y,aAAcD,GAC3C,OAAOF,IAQTp9B,EAASyO,YAAc,WACrB,GAAI+uB,EAMJ,OALgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,+CAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUN,EAAiBzuB,eAEtB+uB,GAKTx9B,EAAS4O,oBAAsB,WAC7B,GAAI4uB,EAMJ,OALgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,uDAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUN,EAAiBtuB,uBAEtB4uB,GAKTx9B,EAAS09B,UAAY,SAAUl7B,EAAMm7B,GACnC,GAAIH,EAMJ,OALgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,6CAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUN,EAAiBQ,UAAUl7B,EAAMm7B,IAEtCH,GAKTx9B,EAAS+O,gBAAkB,SAAU4C,GACnC,GAAI6rB,EAQJ,OAPgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,mDAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,QACzCgvB,EAAUN,EAAiBnuB,kBAC0B,SAA5C1J,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUP,EAAMI,IAAI,WAAa1rB,EAAW,IAAMA,EAAW,mBAExD6rB,GAKTx9B,EAAS6I,cAAgB,SAAU8I,GACjC,GAAI6rB,EAQJ,OAPgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,iDAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,QACzCgvB,EAAUN,EAAiBr0B,gBAC0B,SAA5CxD,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUP,EAAMI,IAAI,WAAa1rB,EAAW,IAAMA,EAAW,qBAExD6rB,GAKTx9B,EAAS49B,UAAY,SAAUp7B,EAAMoL,EAAS+D,GAC5C,GAAI6rB,EAWJ,OAVgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,6CAC+C,aAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,QACzCgvB,EAAUL,EAAqBS,UAAUp7B,EAAMoL,GACM,OAA5CvI,EAAsBpF,KAAK6I,KAAK0F,QACzCgvB,EAAUN,EAAiBU,UAAUp7B,EAAMoL,GACU,SAA5CvI,EAAsBpF,KAAK6I,KAAK0F,UAEzCgvB,EAAUP,EAAMI,IAAI,WAAa1rB,EAAW,IAAMnP,EAAO,eAEpDg7B,GAKTx9B,EAAS69B,WAAa,SAAUC,GAC9B,GAAIN,EAUJ,OATgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,8CAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUN,EAAiBW,WAAWC,IAMjCN,GAKTx9B,EAASoS,kBAAoB,SAAU2rB,GACrC,GAAIP,EAMJ,OALgD,SAA5Cn4B,EAAsBpF,KAAK6I,KAAK0F,QAClCivB,MAAM,8CAC+C,OAA5Cp4B,EAAsBpF,KAAK6I,KAAK0F,UACzCgvB,EAAUN,EAAiB9qB,kBAAkB2rB,IAExCP,GAQTx9B,EAAS8L,eAAiB,SAAUkyB,EAAQC,EAAWz7B,EAAM07B,GAC3D,GAAId,EACJ,IAAiB,SAAbc,EACFd,EAAO13B,EAAkBy4B,eAAeH,EAAQ34B,EAAsBhF,aAAaE,YAAa,oBAC3F,IAAiB,aAAb29B,EACTd,EAAO33B,EAAsB24B,mBAAmBJ,EAAQ34B,EAAsBhF,aAAaE,YAAa,wBACnG,IAAiB,cAAb29B,EAA0B,CACnC,GAAIG,GAAMv+B,EAAG+B,OACbu7B,GAAOiB,EAAIp8B,QACXo8B,EAAIr8B,QAAQxC,QAAQ8+B,SAASN,IAE/B,MAAOZ,IAEFp9B,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,uBAClC,YACA,SAA6BmF,GAc3B,QAASu5B,KACP,IACElgC,OAAOmgC,aAAengC,OAAOmgC,cAAgBngC,OAAOogC,mBACpDC,EAAe,GAAIF,cACnB,MAAOn2B,GACPo1B,MAAM,mGAAsGp1B,IAjBhH,GAAIq2B,GACAC,EAEA3+B,IAyFJ,OAvFAA,GAASuL,UACTvL,EAAS8oB,WAAY,EAqBrB9oB,EAAS4+B,cAAgB,SAAUthB,GACN,mBAAhBohB,IACTH,IAEFG,EAAaG,gBAAgBvhB,EAAQ,SAAUwhB,GAC7CH,EAAYD,EAAaK,qBACzBJ,EAAUrhB,OAASwhB,EACnBH,EAAUK,QAAQN,EAAaO,aAC/BN,EAAUz8B,MAAM,GAChBy8B,EAAUO,QAAU,WAClBl/B,EAAS8oB,WAAY,IAEtB,SAAUzgB,GACXo1B,MAAMp1B,MAWVrI,EAASm/B,oBAAsB,SAAU7mB,EAAa8mB,GACpD,GAAIC,GAAgBr/B,EAASuL,OAAO+zB,cAAgB,EAChDC,EAAa,EACoB,KAAjCv/B,EAASuL,OAAOi0B,gBAClBD,EAAa,GAEf,IAAIryB,GAASlN,EAASuL,OAAOk0B,WAAWzgC,SAAS,EAAGugC,GAChD5+B,EAAOX,EAASuL,OAAOk0B,WAAWzgC,SAASugC,EAAYv/B,EAASuL,OAAOI,KAAKzM,OAASmgC,GACrFK,EAAK,GAAIC,UAASzyB,GAClB0yB,EAAmB,EACc,KAAjC5/B,EAASuL,OAAOi0B,gBAClBI,EAAmB,IAErBF,EAAGG,UAAUD,GAAmBR,EAAY9mB,GAAe+mB,GAAe,EAG1E,IAAIS,GAAUn/B,EAAK3B,SAASsZ,EAAc+mB,GAAgBD,EAAY9mB,GAAe+mB,GACjFh4B,EAAM,GAAI04B,YAAW7yB,EAAO8yB,WAAaF,EAAQE,WAGrD,OAFA34B,GAAI+W,IAAI,GAAI2hB,YAAW7yB,GAAS,GAChC7F,EAAI+W,IAAI,GAAI2hB,YAAWD,GAAU5yB,EAAO8yB,YACjC34B,EAAIiW,QAQbtd,EAASqT,WAAa,SAAUiF,EAAa8mB,GAC3C,GAAIa,GAAa3hC,KAAK6gC,oBAAoB7mB,EAAa8mB,EACnDp/B,GAAS8oB,WACX9oB,EAAS8oB,WAAY,EACrB6V,EAAU/B,KAAK,KAEf58B,EAAS8oB,WAAY,EACjBmX,EAAWD,WAAa,IAE1BhgC,EAAS4+B,cAAcqB,KAItBjgC,KAIXR,QAAQC,OAAO,aAAauU,UAAU,YACpC,WACA,YACA,wBACA,kBACA,iBACA,mBACA,wBACA,SAAUlP,EAAU/E,EAAWsF,EAAuBE,EAAiBL,EAAgBI,EAAkBW,GACvG,OACEkO,SAAU,IACVC,SACAE,KAAM,SAAkBF,EAAOvM,EAASq4B,GACtC9rB,EAAMvR,UAAYq9B,EAAKC,cACvB/rB,EAAMgsB,aAAe,GACrBhsB,EAAMisB,SAAW7U,KAAKlB,MAEtBlW,EAAMxN,GAAK7G,EACXqU,EAAM5N,MAAQtB,EACdkP,EAAMvN,OAAStB,EACf6O,EAAM7N,IAAMlB,EACZ+O,EAAMjN,KAAOlB,EAIbi6B,EAAKI,SAAS,gBAAiB,SAAUrP,GACvC7c,EAAMvR,UAAYouB,IAKpB7c,EAAMa,OAAO,iBAAkB,SAAUC,EAAUC,IAC7CA,EAAS1J,KAAOyJ,EAASzJ,IAAM0J,EAASzJ,KAAOwJ,EAASxJ,KAC1D0I,EAAMmsB,eAEJprB,EAAS3N,cAAgB0N,EAAS1N,aACpC4M,EAAMmsB,eAEJprB,EAAS6O,gBAAkB9O,EAAS8O,eACtC5P,EAAMmsB,iBAEP,GAEHnsB,EAAMa,OAAO,uBAAwB,SAAUC,EAAUC,GACvDf,EAAMmsB,iBACL,GAEHnsB,EAAMa,OAAO,yBAA0B,SAAUC,EAAUC,GACzDf,EAAMmsB,iBACL,GAEHnsB,EAAMa,OAAO,8BAA+B,SAAUC,EAAUC,GAC9Df,EAAMmsB,iBACL,GAEHnsB,EAAMa,OAAO,qBAAsB,SAAUC,EAAUC,GACrDf,EAAMmsB,iBACL,GAEHnsB,EAAMa,OAAO,qBAAsB,SAAUC,EAAUC,GACrDf,EAAMmsB,iBACL,GAEHnsB,EAAMa,OAAO,iBAAkB,SAAUE,EAAUD,GAC7CC,IAAaD,GACfpQ,EAASsP,EAAMmsB,aAAcl7B,EAAsBnF,OAAO2K,UAAUkQ,YAIxE3G,EAAMa,OAAO,kBAAmB,SAAUE,EAAUD,GAC9CC,IAAaD,GACfpQ,EAASsP,EAAMmsB,aAAcl7B,EAAsBnF,OAAO2K,UAAUkQ,SAAW,MAInF3G,EAAMa,OAAO,oBAAqB,SAAUC,EAAUC,IAChDD,EAAS1S,OAAS2S,EAAS3S,MAAQ0S,EAAStH,UAAYuH,EAASvH,UACnEwG,EAAMmsB,iBAEP,GAMHnsB,EAAMmsB,aAAe,WACnB,GAAIzpB,GAAMjP,EAAQ,GAAGkP,WAAW,KAEhC,IADAD,EAAIE,UAAU,EAAG,EAAGnP,EAAQ,GAAGoP,MAAOpP,EAAQ,GAAGqP,QAC5CpW,EAAEC,cAAcwE,EAAgB5E,MA2BnCmW,EAAIE,UAAU,EAAG,EAAGnP,EAAQ,GAAGoP,MAAOpP,EAAQ,GAAGqP,YA1BjD,IAAoC,IAAhC3R,EAAgB5E,KAAKzB,SACvBkV,EAAMgsB,aAAe,GAErB/6B,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAeS,OAAOzC,QAAQ,SAAUw/B,EAAKjhC,GAChH,GAAIihC,EAAI78B,mBAAqByQ,EAAMvR,UAAW,CAC5CuR,EAAMgsB,aAAeI,EAAIr9B,aACzB,IAAIR,GAAK0C,EAAsB9C,mBAAmBi+B,EAAIr9B,eAClDs9B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,YACnDC,EAAQr7B,EAAgBs7B,iCAAiCl+B,EAAGH,MAC5Ds+B,EAAaz7B,EAAsBzC,eAAeD,EAAGH,KAEzD4R,GAAM2sB,WAAWhhC,EAAW8H,EAAQ,GAAIxC,EAAuBo7B,EAAKG,EAAMthB,WAAYshB,EAAMI,UAAWF,MAG3G1sB,EAAMgsB,aAAe,GAEG,SAApBhsB,EAAMvR,WAA4C,SAApBuR,EAAMvR,WAAsB,CAC5D,GAAIF,GAAK0C,EAAsB9C,mBAAmB6R,EAAMvR,WACpD49B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,YACnDC,EAAQr7B,EAAgBs7B,iCAAiCl+B,EAAGH,MAC5Ds+B,EAAaz7B,EAAsBzC,eAAeD,EAAGH,KAEzD4R,GAAM2sB,WAAWhhC,EAAW8H,EAAQ,GAAIxC,EAAuBo7B,EAAKG,EAAMthB,WAAYshB,EAAMI,UAAWF,KAU/G1sB,EAAM2sB,WAAa,SAAUhhC,EAAWyU,EAAQ9U,EAAQ+gC,EAAKQ,EAAIC,EAAIJ,GACnE,GACIK,GAAQC,EADRtqB,EAAMtC,EAAOuC,WAAW,KAEJ,UAApB3C,EAAMvR,WAA+C,aAAvBuR,EAAMgsB,cACtCe,EAASphC,EAAU6d,gBAAgB3P,UACnCmzB,EAASrhC,EAAU6d,gBAAgB1P,UAEnCizB,EAASV,EAAIY,QACbD,EAASX,EAAIa,QAEf,IAAIC,GAAcxhC,EAAU+uB,uBACxB0S,EAAYzhC,EAAUgvB,qBACtB0S,EAAmBhoB,KAAKC,MAAM6nB,EAAcN,EAAKC,GACjDQ,EAAiBjoB,KAAKC,MAAM8nB,EAAYP,EAAKC,GAC7CS,EAAcD,EAAiBD,EAC/BG,EAAgBnB,EAAIoB,OAAOnrB,MAAM+qB,EAAkBA,EAAmBE,EAC1E,IAAIA,EAAcntB,EAAOyC,OAAS0qB,GAAe,EAAG,CAClD,GAAIjV,GAAGoV,EAA0BC,EAAgBC,CAIjDxiC,SAAQwB,QAAQ4gC,EAAc,GAAI,SAAUK,EAAYC,GAEtD,GAAIphC,EAAEC,cAAc+/B,IAAeoB,GAAapB,EAAWqB,eAAiBD,GAAapB,EAAWsB,cAAe,CAEjH,GAAIthC,EAAEC,cAAc+/B,GAClBhqB,EAAIkC,YAAc,OAASkpB,GAAa,IAAMN,EAAc,GAAG1iC,QAAU,aACzE4X,EAAIsB,UAAY,OAAS8pB,GAAa,IAAMN,EAAc,GAAG1iC,QAAU,iBAClE,CACL,GAAImN,GAAIy0B,EAAWsB,cAAgBtB,EAAWqB,cAAgB,CAC9DrrB,GAAIkC,YAAc,OAASkpB,GAAa,IAAM71B,GAAK,aACnDyK,EAAIsB,UAAY,OAAS8pB,GAAa,IAAM71B,GAAK,aAGnD,GAAIg2B,GAAah9B,EAAsBjC,wBAAwBgR,EAAMgsB,aAerE,IAdmB5+B,SAAf6gC,GACmC7gC,SAAjC6gC,EAAWC,OAAOJ,KACpBprB,EAAIkC,YAAc3T,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAeK,cAAc,GAAGi/B,OAAOJ,GAC9HprB,EAAIsB,UAAY/S,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBC,eAAeK,cAAc,GAAGi/B,OAAOJ,IAK5HniC,EAAUqnB,oBAAsB,IAAM8a,GAAiC,SAApB9tB,EAAMvR,WAA+C,aAAvBuR,EAAMgsB,eACzFtpB,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAMwtB,MACrDzrB,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAMwtB,OAErDzrB,EAAImC,YAEAwoB,GAAoB,EAAG,CACzB,GAAIe,GAAa/B,EAAIoB,OAAOJ,EAAmB,GAC3CgB,EAAUD,EAAWN,EACzBH,GAAiBN,EAAmB,EACpCO,EAAqB,EAAIf,EAAKc,EAAiBb,EAC/CxU,GAAKsV,EAAqBT,IAAgBC,EAAYD,GAAe/sB,EAAOyC,MAC5E6qB,EAAIttB,EAAO0C,QAAUurB,EAAUtB,IAAWC,EAASD,GAAU3sB,EAAO0C,OACpEJ,EAAIoC,OAAOwT,EAAGoV,GAYhB,GAVAtiC,QAAQwB,QAAQ4gC,EAAe,SAAUc,EAAQC,GAE/CZ,EAAiBN,EAAmBkB,EACpCX,EAAqB,EAAIf,EAAKc,EAAiBb,EAC/CxU,GAAKsV,EAAqBT,IAAgBC,EAAYD,GAAe/sB,EAAOyC,MAC5E6qB,EAAIttB,EAAO0C,QAAUwrB,EAAOR,GAAaf,IAAWC,EAASD,GAAU3sB,EAAO0C,OAC9EJ,EAAI8rB,IAAIlW,EAAGoV,EAAI,EAAG,EAAG,EAAG,EAAIroB,KAAKopB,IAAI,GACrC/rB,EAAIqC,OAAOuT,EAAGoV,KAGZJ,EAAiBjB,EAAIoB,OAAO3iC,OAAS,EAAG,CAC1C,GAAI4jC,GAAcrC,EAAIoB,OAAOH,EAAiB,GAC1CqB,EAAWD,EAAYZ,EAC3BH,GAAiBL,EAAiB,EAClCM,EAAqB,EAAIf,EAAKc,EAAiBb,EAC/CxU,GAAKsV,EAAqBT,IAAgBC,EAAYD,GAAe/sB,EAAOyC,MAC5E6qB,EAAIttB,EAAO0C,QAAU6rB,EAAW5B,IAAWC,EAASD,GAAU3sB,EAAO0C,OACrEJ,EAAIqC,OAAOuT,EAAGoV,GAEhBhrB,EAAIsC,gBAIRtC,GAAIkC,YAAc,MACC,GAAf2oB,EACFr8B,EAAiBmS,4BAA4BX,EAAK,cAAe,iBAAkBzR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,IAAM,KAAMrR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQlD,EAAOyC,MAAQ,EAAIH,EAAImB,YAAY,kBAAkBhB,MAAQH,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,YAAc,EAAG,GAAI39B,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,KAEpW39B,EAAiBmS,4BAA4BX,EAAK,aAAc,iBAAkBzR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,IAAM,KAAMrR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQlD,EAAOyC,MAAQ,EAAIH,EAAImB,YAAY,kBAAkBhB,MAAQH,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,YAAc,EAAG,GAAI39B,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,WAUjXzjC,QAAQC,OAAO,aAAaI,QAAQ,qBAClC,KACA,SAA2BC,GAEzB,GAEI+B,GAFA7B,KACAvB,EAAS,GAAII,iBAsCjB,OAnCAJ,GAAOuf,KAAK,SAAU3V,GACE,YAAlBA,EAAEoE,OAAO9C,KACX9H,EAAMG,QAAQqG,GAEdxG,EAAMqhC,OAAO76B,KAEd,GAMHrI,EAASmjC,kBAAoB,SAAUC,GAOrC,MANAvhC,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,WACPC,QAAWF,IAGNvhC,EAAMI,SAOfjC,EAASujC,cAAgB,SAAUC,GAOjC,MANA3hC,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,WACPG,IAAOz5B,KAAKC,UAAUw5B,KAGjB3hC,EAAMI,SAERjC,KAIXR,QAAQC,OAAO,aAAauU,UAAU,+BACpC,YACA,wBACA,kBACA,oBACA,iBACA,sBACA,SAAUjU,EAAWsF,EAAuBE,EAAiBO,EAAmBZ,EAAgBE,GAC9F,OACE+O,SAAU,IACVC,SACAE,KAAM,SAAUF,EAAOvM,EAASq4B,GAC9B,GAAIuD,GAGA9gC,EAAI89B,EAAKG,EACT/9B,EACA6gC,EAJAlvB,EAAS3M,EAAQ,GACjBiP,EAAMtC,EAAOuC,WAAW,KAM5BmpB,GAAKI,SAAS,gBAAiB,SAAUrP,GACnCA,IACFpuB,EAAYouB,KAIhBiP,EAAKI,SAAS,aAAc,SAAUrP,GAChCA,IACFyS,EAAazS,EACRnwB,EAAEC,cAAcwE,EAAgB5E,OACC,IAAhC4E,EAAgB5E,KAAKzB,SACvByD,EAAK0C,EAAsB9C,mBAAmB,YACnCf,SAAPmB,IACF89B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,YACnDC,EAAQr7B,EAAgBs7B,iCAAiCl+B,EAAGH,WAQtEqF,EAAQC,KAAK,YAAa,SAAUmB,GAClClJ,EAAUyL,YAAYqY,QAAUpK,KAAKC,MAAM3Z,EAAUywB,KAAKvnB,GAASlJ,EAAU4uB,sBAAsB1lB,GAASlJ,EAAUyL,YAAYC,IAClI1L,EAAUyL,YAAYsY,QAAU/jB,EAAUyL,YAAYqY,QACtD9jB,EAAUspB,OAAOtpB,EAAUyL,YAAYqY,QAAS9jB,EAAUyL,YAAYsY,SACtE1P,EAAMuvB,oBAAoB16B,GAC1BmL,EAAM8U,WAERrhB,EAAQC,KAAK,YAAa,SAAUmB,GAClC,GAAI2pB,GAAU,CAEZA,GADoBpxB,SAAlByH,EAAM4pB,QACE5pB,EAAM6pB,MAEN7pB,EAAM4pB,OAGlB,IAAI+Q,GAAS7jC,EAAUywB,KAAKvnB,EAE5B,QADAlJ,EAAU+mB,kBAAoBrN,KAAKC,MAAM3Z,EAAUyL,YAAYC,GAAKm4B,EAAS/7B,EAAQ,GAAGoP,OAASlX,EAAUyL,YAAYE,GAAK3L,EAAUyL,YAAYC,KAC1ImnB,GACR,IAAK,GACH,GAAI7yB,EAAUoQ,cAAc,iBAC1BiE,EAAMuvB,oBAAoB16B,KACrBnI,EAAEC,cAAcwE,EAAgB5E,OACC,IAAhC4E,EAAgB5E,KAAKzB,QAClBa,EAAUirB,oBACyBxpB,SAAlCzB,EAAUqnB,qBAAsCrnB,EAAUirB,oBAAuBlqB,EAAEC,cAAcsE,EAAsB9B,cAAcV,MAAa,CAEzIrB,SAAPmB,IACFA,EAAK0C,EAAsB9C,mBAAmB,aAEhDk+B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,YACnDC,EAAQr7B,EAAgBs7B,iCAAiCl+B,EAAGH,KAC5D,IAAI++B,GAAcxhC,EAAU+uB,uBACxB0S,EAAYzhC,EAAUgvB,qBACtB0S,EAAmBhoB,KAAKC,MAAM6nB,EAAcX,EAAMthB,WAAashB,EAAMI,WACrEU,EAAiBjoB,KAAKC,MAAM8nB,EAAYZ,EAAMthB,WAAashB,EAAMI,WACjEW,EAAcD,EAAiBD,EAC/BG,EAAgBnB,EAAIoB,OAAOnrB,MAAM+qB,EAAkBA,EAAmBE,GACtEkC,EAAetC,EAAcxhC,EAAUywB,KAAKvnB,GAASA,EAAM4lB,cAAclN,OAAO1K,OAASuqB,EAAYD,GACrGkC,EAAiBhqB,KAAKC,OAAOmqB,EAAejD,EAAMI,WAAaJ,EAAMthB,YAAc,EAEnFwkB,EAAqB,EAAIlD,EAAMthB,WAAamkB,EAAiB7C,EAAMI,SACvE,IAAwC,EAApCyC,EAAiBhC,GAAwBgC,EAAiBhC,GAAoBG,EAAc1iC,OAE9F,MAEFa,GAAUonB,sBAAwBsc,EAAiBhC,CACnD,IAAI/U,IAAKoX,EAAqBvC,IAAgBC,EAAYD,GAAe/sB,EAAOyC,MAC5E6qB,EAAIttB,EAAO0C,OAAS0qB,EAAc7hC,EAAUonB,uBAAuBpnB,EAAUqnB,oBAAsB,IAAMrnB,EAAU6d,gBAAgB1P,QAAUnO,EAAU6d,gBAAgB3P,WAAauG,EAAO0C,MAS/L,IAPAJ,EAAIkC,YAAc,QAClBlC,EAAIsB,UAAY,QAChBtB,EAAImC,YACJnC,EAAI8rB,IAAIlW,EAAGoV,EAAI,EAAG,EAAG,EAAG,EAAIroB,KAAKopB,IAAI,GACrC/rB,EAAImF,YACJnF,EAAIsC,SACJtC,EAAIitB,OACA96B,EAAM+pB,SAAU,CAClB,GAAI7d,GAAW3V,QAAQoB,KAAKghC,EAAc7hC,EAAUonB,uBAAuBpnB,EAAUqnB,oBAAsB,IACvGlS,EAAWnV,EAAU6d,gBAAgB1P,QAAUnO,EAAU6wB,KAAK3nB,GAASA,EAAM4lB,cAAclN,OAAOzK,OAASnX,EAAU6d,gBAAgB1P,OAEzI0zB,GAAc7hC,EAAUonB,uBAAuBpnB,EAAUqnB,oBAAsB,GAAKrnB,EAAU6d,gBAAgB1P,QAAUnO,EAAU6wB,KAAK3nB,GAASA,EAAM4lB,cAAclN,OAAOzK,OAASnX,EAAU6d,gBAAgB1P;AAC9M,GAAI81B,GAAY9+B,EAAeqX,oBAC3B5S,KAAQ,OACR9G,UAAaF,EAAGH,KAChByhC,eAAkBxC,EAAmB1hC,EAAUonB,sBAC/C+c,UAAankC,EAAUqnB,oBAAsB,EAC7CjS,SAAYA,EACZD,SAAYA,GAGhB,KAAK,GAAI9S,KAAO4hC,GACdF,EAAqB,EAAIlD,EAAMthB,WAAa0kB,EAAU5hC,GAAK6hC,eAAiBrD,EAAMI,UAClFtU,GAAKoX,EAAqBvC,IAAgBC,EAAYD,GAAe/sB,EAAOyC,MAC5E6qB,EAAIttB,EAAO0C,OAAS8sB,EAAU5hC,GAAK8S,UAAYnV,EAAU6d,gBAAgB1P,QAAUnO,EAAU6d,gBAAgB3P,WAAauG,EAAO0C,OAEjIJ,EAAIkC,YAAc,MAClBlC,EAAIsB,UAAY,MAEhBtB,EAAImC,YACJnC,EAAI8rB,IAAIlW,EAAGoV,EAAI,EAAG,EAAG,EAAG,EAAIroB,KAAKopB,IAAI,GACrC/rB,EAAImF,YACJnF,EAAIsC,SACJtC,EAAIitB,QAQlB,KACF,KAAK,GACEhkC,EAAUirB,oBACb5W,EAAM+vB,cAAcl7B,GAIxBmL,EAAM8U,WAWRrhB,EAAQC,KAAK,aAAc,SAAUmB,GAC9BnI,EAAEC,cAAcqE,IACdtE,EAAEC,cAAcqE,EAAoBmG,SAClCxL,EAAUirB,oBACTjrB,EAAUoQ,cAAc,gBAC1BiE,EAAMuvB,oBAAoB16B,GAAO,KAS3CmL,EAAMuvB,oBAAsB,SAAU16B,EAAOm7B,GAG3C,GAFAttB,EAAIE,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,QAEf,QAAtBgpB,EAAKC,cACPr6B,EAAkB2V,kBAAkB3E,GAAK,GACzChR,EAAkB+T,wBAAwB/C,GAAK,OAC1C,IAA0B,QAAtBopB,EAAKC,cACdr6B,EAAkB+T,wBAAwB/C,GAAK,GAC/ChR,EAAkB6X,kBAAkB7G,EAAK,GAAI/W,EAAU6d,gBAAgB3P,UAAWlO,EAAU6d,gBAAgB1P,QAAS,OAChH,CACL,GAAIvL,GAAK0C,EAAsB9C,mBAAmB29B,EAAKC,eACnDM,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,WACvD76B,GAAkB+T,wBAAwB/C,GAAK,GAC/ChR,EAAkB6X,kBAAkB7G,EAAKopB,EAAKC,cAAeM,EAAIY,QAASZ,EAAIa,QAAS,GAGrF8C,KAAU,GAAS/+B,EAAsBpF,KAAKgyB,aAAaoS,gBAC7Dv+B,EAAkBu+B,eAAevtB,EAAK7N,EAAOlJ,EAAU6d,gBAAgB3P,UAAWlO,EAAU6d,gBAAgB1P,QAAS,KAAMgyB,EAAKC,eAGlIr6B,EAAkB8T,uBAAuB9C,IAE3C1C,EAAM+vB,cAAgB,SAAUl7B,GAC9Bw6B,EAAiBhqB,KAAKC,MAAM3Z,EAAUywB,KAAKvnB,GAASlJ,EAAU4uB,sBAAsB1lB,GAASlJ,EAAUyL,YAAYC,IAC/Gg4B,EAAiB1jC,EAAUyL,YAAYqY,QACzC9jB,EAAUyL,YAAYsY,QAAU2f,EAEhC1jC,EAAUyL,YAAYqY,QAAU4f,EAElC1jC,EAAUspB,OAAOtpB,EAAUyL,YAAYqY,QAAS9jB,EAAUyL,YAAYsY,SACtE1P,EAAM8U,eAOhB1pB,QAAQC,OAAO,aAAaI,QAAQ,qBAClC,YACA,wBACA,sBACA,mBACA,kBACA,oBACA,SAA2BE,EAAWsF,EAAuBD,EAAqBE,EAAkBC,EAAiBoX,GAGnH,QAAS2nB,GAASxtB,EAAKxS,EAAKigC,GAC1B,MAAOztB,GAAImB,YAAY3T,GAAK2S,MAAQstB,EAEtC,QAASC,GAAc1tB,EAAK2tB,EAAMC,EAAMxsB,GACtC,MAAa1W,UAATijC,GAAsBA,EAAKprB,WAAWna,OAASwlC,EAAKrrB,WAAWna,OAC1DolC,EAASxtB,EAAK2tB,EAAMvsB,GAEpBosB,EAASxtB,EAAK4tB,EAAMxsB,GAa/B,QAASysB,GAAU5kC,EAAW4P,EAAOxN,EAAOyiC,EAAKC,EAAKC,EAAUtwB,EAAQ9U,GACtE,GAAIoX,GAAMtC,EAAOuC,WAAW,MAExBqU,EAAI,EAEJsB,EAAI/c,EAAQyb,EAEZ0W,GAAK+C,EAAM1iC,IAAU0iC,EAAMD,GAAOpwB,EAAO0C,OAGzC6tB,GAASp1B,EAAQ,GAAKyb,EAEtB4Z,GAASH,EAAMC,IAAaD,EAAMD,GAAOpwB,EAAO0C,MACpDJ,GAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4C,MACrDb,EAAIoC,OAAO6rB,EAAOC,GAClBluB,EAAIqC,OAAOuT,EAAGoV,GApChB,GAAI9hC,KAqZJ,OA/WAA,GAASmb,aAMTnb,EAASkb,eAAiB,SAAUnb,EAAWyU,EAAQ7T,GACrD,GAOIskC,GAPAC,GAAenlC,EAAUyL,YAAYE,GAAK,EAAI3L,EAAUyL,YAAYC,IAAM+I,EAAOyC,MAEjFkuB,EAAmB,EAEnBC,KACAC,EAAUC,EAAAA,EACVC,IAAWD,EAAAA,EAEf,IAAmB,GAAfJ,EAGAD,EAD+B,IAA7BllC,EAAUyL,YAAYC,GACd9K,EAAK3B,SAASe,EAAUyL,YAAYC,GAAI1L,EAAUyL,YAAYE,GAAK,GAEnE/K,EAAK3B,SAASe,EAAUyL,YAAYC,GAAK,EAAG1L,EAAUyL,YAAYE,GAAK,GAEnF25B,EAAU5rB,KAAKmrB,IAAIY,MAAM/rB,KAAMwrB,GAC/BM,EAAU9rB,KAAKorB,IAAIW,MAAM/rB,KAAMwrB,GAC/BG,EAAQ9iC,MAAMvD,UAAU2X,MAAM+uB,KAAKR,OAC9B,CACLA,EAAUtkC,EAAK3B,SAASe,EAAUyL,YAAYC,GAAI1L,EAAUyL,YAAYE,GACxE,KAAK,GAAIg6B,GAAW,EAAGA,EAAWlxB,EAAOyC,MAAOyuB,IAAY,CAE1D,IAAK,GADDC,GAAS,EACJC,EAAI,EAAOT,EAAJS,EAAsBA,IAAK,CAIzC,IAAK,GAHD3lC,GAAOglC,EAAQjmC,SAAS0mC,EAAWR,GAAcQ,EAAW,GAAKR,GAEjEW,EAAM,EACDC,EAAI,EAAGz5B,EAAIpM,EAAKf,OAAYmN,EAAJy5B,EAAOA,IAItCD,GAAO5lC,EAAK6lC,EAEdH,IAAUE,EAAM5lC,EAAKf,OAEvBkmC,EAAMM,GAAYC,EACdA,EAASJ,IACXA,EAAUI,GAECN,EAATM,IACFN,EAAUM,IAKhB,OACEP,MAASA,EACTC,QAAWA,EACXE,QAAWA,EACXL,YAAeA,IAMnBllC,EAASob,4BAA8B,SAAUrb,EAAWyU,EAAQyG,EAAaqC,EAAQ5d,GACvF,GAAIoX,GAAMtC,EAAOuC,WAAW,KAI5B,IAHAD,EAAIE,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,QAGrC+D,EAAYmqB,OAASnqB,EAAYiqB,aAAe,EAClDpuB,EAAImC,YACJgC,EAAYmqB,MAAMpkC,QAAQ,SAAU+kC,EAAMp2B,GAC1B,IAAVA,GACFg1B,EAAU5kC,EAAW4P,EAAOo2B,EAAM9qB,EAAYoqB,QAASpqB,EAAYsqB,QAAStqB,EAAYmqB,MAAMz1B,EAAQ,GAAI6E,EAAQ9U,KAGtHoX,EAAIsC,aACC,IAAI6B,EAAYiqB,YAAc,EAAG,CAEtC,GAAIc,GAAO,EAAI/qB,EAAYiqB,YAAc,EAErCe,EAAMlmC,EAAUyL,YAAYC,EAEhCqL,GAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4C,MACrDb,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,KAEnD,IAAIpY,EACJ,IAAiC,IAA7BQ,EAAUyL,YAAYC,GAAU,CAElC,IADAqL,EAAIoC,OAAO8sB,GAAO/qB,EAAYmqB,MAAM,GAAKnqB,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,QAChH3X,EAAI,EAAGA,EAAI0b,EAAYmqB,MAAMlmC,OAAQK,IACxCuX,EAAIqC,OAAO5Z,EAAI0b,EAAYiqB,YAAcc,GAAO/qB,EAAYmqB,MAAM7lC,GAAK0b,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAIrJ,KAFAJ,EAAIsC,SAEC7Z,EAAI,EAAGA,EAAI0b,EAAYmqB,MAAMlmC,OAAQK,IACxCuX,EAAImC,YACJnC,EAAI8rB,IAAIrjC,EAAI0b,EAAYiqB,YAAcc,GAAO/qB,EAAYmqB,MAAM7lC,GAAK0b,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAAS,EAAG,EAAG,EAAG,EAAIuC,KAAKopB,IAAI,GAC/K/rB,EAAIsC,SACJtC,EAAIitB,OACArkC,EAAOO,KAAKgyB,aAAaiU,gBAC3BpvB,EAAIqvB,WAAWF,EAAK1mC,EAAI0b,EAAYiqB,YAAcc,GAAO/qB,EAAYmqB,MAAM7lC,GAAK0b,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAAS,IACrK+uB,GAAY,OAGX,CAIL,IAFAnvB,EAAImC,YACJnC,EAAIoC,QAAQ8sB,EAAMxxB,EAAO0C,QAAU+D,EAAYmqB,MAAM,GAAKnqB,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,QACjI3X,EAAI,EAAGA,GAAK0b,EAAYmqB,MAAMlmC,OAAQK,IACzCuX,EAAIqC,OAAO5Z,EAAI0b,EAAYiqB,YAAcc,EAAMxxB,EAAO0C,SAAW+D,EAAYmqB,MAAM7lC,GAAK0b,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAAS,GAI/K,KAFAJ,EAAIsC,SAEC7Z,EAAI,EAAGA,GAAK0b,EAAYmqB,MAAMlmC,OAAQK,IACzCuX,EAAImC,YACJnC,EAAI8rB,IAAIrjC,EAAI0b,EAAYiqB,YAAcc,EAAMxxB,EAAO0C,QAAU+D,EAAYmqB,MAAM7lC,GAAK0b,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAAS,EAAG,EAAG,EAAG,EAAIuC,KAAKopB,IAAI,GAC/L/rB,EAAIsC,SACJtC,EAAIitB,OACArkC,EAAOO,KAAKgyB,aAAaiU,gBAC3BpvB,EAAIsvB,SAASH,EAAK1mC,EAAI0b,EAAYiqB,YAAcc,EAAMxxB,EAAO0C,QAAU+D,EAAYmqB,MAAM7lC,GAAK0b,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAAS,IACnL+uB,GAAY,IAKpB,GAAIvmC,EAAOO,KAAKgyB,aAAaoU,aAI3B,GAFAvvB,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAMyF,KACrD1D,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAMyF,KAC/CS,EAAYiqB,aAAe,EAAG,CAChC,GAAIoB,GAAY9xB,EAAO0C,QAAU,EAAI+D,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,MACjHJ,GAAImC,YACJnC,EAAIoC,OAAO,EAAGotB,GACdxvB,EAAIqC,OAAO3E,EAAOyC,MAAOqvB,GACzBxvB,EAAIsC,SACJtC,EAAIsvB,SAAS,IAAK,EAAG5xB,EAAO0C,OAAS,EAAI,EAAG1C,EAAOyC,WAC9C,CACL,GAAIqvB,GAAY9xB,EAAO0C,QAAU,EAAI+D,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,MACjHJ,GAAImC,YACJnC,EAAIoC,OAAO,EAAGotB,GACdxvB,EAAIqC,OAAO3E,EAAOyC,MAAOqvB,GACzBxvB,EAAIsC,SACJtC,EAAIitB,OACJjtB,EAAIsvB,SAAS,IAAK,EAAG5xB,EAAO0C,QAAU,EAAI+D,EAAYoqB,UAAYpqB,EAAYsqB,QAAUtqB,EAAYoqB,SAAW7wB,EAAO0C,OAAS,EAAG1C,EAAOyC,SAU/IjX,EAAS4Z,uBAAyB,SAAU9C,GAC1C,GAAIgD,GAAS3C,CAQb,IAPAA,EAAQpX,EAAUuX,cAAcR,EAAItC,OAAOyC,OAGzC6C,EADuC,YAArC/Z,EAAU0a,uBACF,EAEAtD,EAAQ,EAEhBpX,EAAUwnB,eAAgB,CAC5BzQ,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAMyF,IACnD,IAAIsrB,GAAIrsB,KAAKC,MAAM3Z,EAAU4Y,OAAO7B,EAAItC,OAAOyC,MAAOlX,EAAUynB,sBAC5DznB,GAAUoa,oBACZrD,EAAI8B,SAASktB,EAAI3uB,EAAO,EAAG,EAAGL,EAAItC,OAAO0C,QAEzCJ,EAAI8B,SAASktB,EAAIhsB,EAAS,EAAG,EAAGhD,EAAItC,OAAO0C,UAOjDlX,EAAS6Z,wBAA0B,SAAU/C,EAAKyvB,GAChD,GACIzsB,GAAS3C,EAAOqvB,EAAuBtuB,EADvC5B,EAAuE,EAA5DjR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,GAErES,GAAQpX,EAAUuX,cAAcR,EAAItC,OAAOyC,OAGzC6C,EADuC,QAArC/Z,EAAU0a,uBACF,EAEAtD,EAAQ,CAEpB,IAAIC,GAAOrX,EAAU4Y,OAAO7B,EAAItC,OAAOyC,MAAOlX,EAAUyL,YAAY0H,SAChEmE,EAAOtX,EAAU4Y,OAAO7B,EAAItC,OAAOyC,MAAOlX,EAAUyL,YAAY2H,QACpE,IAAIiE,IAASC,EACXP,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYhC,MAC/Db,EAAI8B,SAASxB,EAAO0C,EAAS,EAAG,EAAGhD,EAAItC,OAAO0C,QAC1CqvB,GACExmC,EAAUyL,YAAYC,KAAO1L,EAAUyL,YAAY0H,SAA6C,KAAlCnT,EAAUyL,YAAY0H,UACtFgF,EAASpB,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,YACvCwD,EAAQhC,EAAc1tB,EAAK/W,EAAUyL,YAAY0H,QAASyJ,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAY0H,QAAU9N,EAAoBmG,OAAOkT,WAAY,GAAIvG,GACnL5S,EAAiBmS,4BAA4BX,EAAK/W,EAAUyL,YAAY0H,QAASyJ,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAY0H,QAAU9N,EAAoBmG,OAAOkT,WAAY,GAAInI,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQL,EAAO,EAAG,EAAGhS,EAAsBnF,OAAO6U,MAAM4C,OAAO,QAc/T,IAVAb,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYd,KAC/D/B,EAAI8B,SAASxB,EAAM,EAAGC,EAAOD,EAAMN,EAAItC,OAAO0C,QAC9CJ,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4E,YAAYhC,MACjEb,EAAImC,YACJnC,EAAIoC,OAAO9B,EAAM,GACjBN,EAAIqC,OAAO/B,EAAMN,EAAItC,OAAO0C,QAC5BJ,EAAIoC,OAAO7B,EAAM,GACjBP,EAAIqC,OAAO9B,EAAMP,EAAItC,OAAO0C,QAC5BJ,EAAImF,YACJnF,EAAIsC,SACAmtB,IAEFruB,EAASpB,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,YACvCwD,EAAQhC,EAAc1tB,EAAK/W,EAAUyL,YAAY0H,QAASyJ,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAY0H,QAAU9N,EAAoBmG,OAAOkT,WAAY,GAAIvG,GACnL5S,EAAiBmS,4BAA4BX,EAAK/W,EAAUyL,YAAY0H,QAASyJ,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAY0H,QAAU9N,EAAoBmG,OAAOkT,WAAY,GAAInI,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQN,EAAOovB,EAAQ,EAAG,EAAGnhC,EAAsBnF,OAAO6U,MAAM4C,OAAO,GAEnUrS,EAAiBmS,4BAA4BX,EAAK/W,EAAUyL,YAAY2H,QAASwJ,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAY2H,QAAU/N,EAAoBmG,OAAOkT,WAAY,GAAInI,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQL,EAAO,EAAG,EAAGhS,EAAsBnF,OAAO6U,MAAM4C,OAAO,GAG3T6uB,EAAQlC,EAASxtB,EAAK6F,EAAkB8pB,6BAA6B1mC,EAAUyL,YAAY2H,QAAUpT,EAAUyL,YAAY0H,SAAW9N,EAAoBmG,OAAOkT,WAAY,GAAIvG,GAC7Kb,EAAOD,EAAOovB,GAAO,CACvB,GAAI/B,GAAO1kC,EAAUyL,YAAY2H,QAAUpT,EAAUyL,YAAY0H,QAAU,EACvEwxB,EAAO/nB,EAAkB8pB,6BAA6B1mC,EAAUyL,YAAY2H,QAAUpT,EAAUyL,YAAY0H,SAAW9N,EAAoBmG,OAAOkT,WAAY,EAClK+nB,GAAQhC,EAAc1tB,EAAK2tB,EAAMC,EAAMxsB,GACvC5S,EAAiBmS,4BAA4BX,EAAK2tB,EAAMC,EAAMpuB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQN,GAAQC,EAAOD,GAAQ,EAAIovB,EAAQ,EAAG,EAAGnhC,EAAsBnF,OAAO6U,MAAM4C,OAAO,KAQnN3X,EAASqkC,eAAiB,SAAUvtB,EAAK4vB,EAAU9B,EAAKC,EAAK8B,EAAMC,GAEjE,GAAIvhC,EAAsBpF,KAAKgyB,aAAaoS,eAAgB,CAC1D,GAAI/tB,GAAuE,EAA5DjR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,GAErEI,GAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,IACjEnsB,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,GAM/D,IAAIW,GAAS7jC,EAAUywB,KAAKkW,GACxBG,EAAS9mC,EAAU6wB,KAAK8V,EAK5B5vB,GAAIP,KAAOlR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAO,MAAQpR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,MAC1G,IAAIovB,GAAYnqB,EAAkB8pB,4BAA4B5B,EAAMgC,EAAS/vB,EAAItC,OAAO0C,OAAS2tB,EAAK,GAElGkC,EAAKjwB,EAAImB,YAAY6uB,EAAYH,GAAM1vB,MAAQ3R,EAAiB4S,OAChE8uB,EAAKvtB,KAAKC,MAAM3Z,EAAUyL,YAAYC,GAAKm4B,EAAS9sB,EAAItC,OAAOyC,OAASlX,EAAUyL,YAAYE,GAAK3L,EAAUyL,YAAYC,KACzHw7B,EAAKtqB,EAAkB8pB,4BAA4B1mC,EAAU+uB,uBAAyB8U,EAAS9sB,EAAItC,OAAOyC,OAASlX,EAAUgvB,qBAAuBhvB,EAAU+uB,wBAAyB,EAC3L,IAAYttB,SAARqjC,GAA6BrjC,SAARojC,EACvB,GAAiB,QAAbgC,EAEF9vB,EAAImC,YAMJnC,EAAIoC,OAAO0qB,EAAQ,GACnB9sB,EAAIqC,OAAOyqB,EAAQ9sB,EAAItC,OAAO0C,QAC9BJ,EAAIsC,aACC,IAAiB,QAAbwtB,EACTthC,EAAiBsS,oBAAoBd,EAAKgwB,EAAYH,EAAMrwB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGmvB,EAAQxhC,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,KAAK,GACrL39B,EAAiBsS,oBAAoBd,EAAKgwB,EAAYH,EAAMrwB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQZ,EAAItC,OAAOyC,MAAQ,EAAI8vB,GAAMjwB,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,aAAc6D,EAAQxhC,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,KAAK,GAC3PnsB,EAAImC,YACJnC,EAAIoC,OAAO,EAAG2tB,GACd/vB,EAAIqC,OAAO,EAAG0tB,EAAS,GACvB/vB,EAAIoC,OAAO,EAAG2tB,GACd/vB,EAAIqC,OAAOrC,EAAItC,OAAOyC,MAAO4vB,GAC7B/vB,EAAIqC,OAAOrC,EAAItC,OAAOyC,MAAQ,EAAG4vB,EAAS,GAC1C/vB,EAAIoC,OAAO0qB,EAAQ,GACnB9sB,EAAIqC,OAAOyqB,EAAQ9sB,EAAItC,OAAO0C,QAC9BJ,EAAIsC,aACC,CAEL,GAAIzW,GAAK0C,EAAsB9C,mBAAmBqkC,GAC9CnG,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,WACvDmG,GAAYrG,EAAIa,QAAUuF,EAAS/vB,EAAItC,OAAO0C,QAAUupB,EAAIa,QAAUb,EAAIY,SAC1EyF,EAAYnqB,EAAkB8pB,4BAA4BK,EAAW,GAErExhC,EAAiBsS,oBAAoBd,EAAKgwB,EAAWxwB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGmvB,EAAQxhC,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,KAAK,GAC9K39B,EAAiBsS,oBAAoBd,EAAKgwB,EAAWxwB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQZ,EAAItC,OAAOyC,MAAQ,EAAI8vB,GAAMjwB,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,aAAc6D,EAAQxhC,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,KAAK,GACpPnsB,EAAImC,YACJnC,EAAIoC,OAAO,EAAG2tB,GACd/vB,EAAIqC,OAAO,EAAG0tB,EAAS,GACvB/vB,EAAIoC,OAAO,EAAG2tB,GACd/vB,EAAIqC,OAAOrC,EAAItC,OAAOyC,MAAO4vB,GAC7B/vB,EAAIqC,OAAOrC,EAAItC,OAAOyC,MAAQ,EAAG4vB,EAAS,GAC1C/vB,EAAIoC,OAAO0qB,EAAQ,GACnB9sB,EAAIqC,OAAOyqB,EAAQ9sB,EAAItC,OAAO0C,QAC9BJ,EAAIsC,SAGR9T,EAAiBmS,4BAA4BX,EAAKkwB,EAAIC,EAAI3wB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQksB,EAAS,EAAG,EAAGv+B,EAAsBnF,OAAO6U,MAAM4E,YAAYspB,KAAK,KAW3LjjC,EAAS2d,kBAAoB,SAAU7G,EAAKjU,EAAW+hC,EAAKC,EAAKnrB,GAE/D5C,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4C,MACrDb,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,KACnD,IAAIrB,GAAuE,EAA5DjR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,IAEjEa,EAAST,EAAItC,OAAO0C,OAASJ,EAAItC,OAAOgD,aACxC0vB,EAA4E,EAA5D7hC,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,IAAU,EAChFywB,EAAKD,EAAgB3vB,CAEzBT,GAAImC,YACJnC,EAAIoC,OAAO,EAAG,GACdpC,EAAIqC,OAAO,EAAG,GACdrC,EAAIoC,OAAO,EAAGpC,EAAItC,OAAO0C,QACzBJ,EAAIqC,OAAO,EAAGrC,EAAItC,OAAO0C,OAAS,GAClCJ,EAAIsC,SACJtC,EAAImF,YAEc,KAAdpZ,GACFyC,EAAiBsS,oBAAoBd,EAAKjU,EAAWyT,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGZ,EAAItC,OAAO0C,OAAS,EAAIZ,EAAWiB,EAAS,EAAGlS,EAAsBnF,OAAO6U,MAAM4C,OAG1LnW,SAARqjC,GACFv/B,EAAiBsS,oBAAoBd,EAAK,QAAU6F,EAAkB8pB,4BAA4B5B,EAAKnrB,GAAQwtB,EAAe7hC,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAG,EAAGrS,EAAsBnF,OAAO6U,MAAM8D,MAG7MrX,SAARojC,GACFt/B,EAAiBsS,oBAAoBd,EAAK,QAAU6F,EAAkB8pB,4BAA4B7B,EAAKlrB,GAAQwtB,EAAe7hC,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAGZ,EAAItC,OAAO0C,OAASiwB,EAAK,EAAG9hC,EAAsBnF,OAAO6U,MAAM8D,OAMpP7Y,EAASyb,kBAAoB,SAAU3E,GACrCA,EAAIkC,YAAc3T,EAAsBnF,OAAO6U,MAAM4C,MACrDb,EAAIsB,UAAY/S,EAAsBnF,OAAO6U,MAAM4C,MACnDb,EAAIP,KAAOlR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAO,IAAMpR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,MACxG,IAAIpB,GAAuE,EAA5DjR,EAAsBnF,OAAOqW,KAAKC,MAAMC,KAAKC,MAAM,EAAG,GAErEI,GAAImC,YACJnC,EAAIoC,OAAO,EAAG,GACdpC,EAAIqC,OAAO,EAAG,GACdrC,EAAIoC,OAAOpC,EAAItC,OAAOyC,MAAO,GAC7BH,EAAIqC,OAAOrC,EAAItC,OAAOyC,MAAQ,EAAG,GACjCH,EAAImF,YACJnF,EAAIsC,QACJ,IAEIguB,GACAC,EAEAb,EALAtuB,EAASpB,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,WAC9BlsB,GAAItC,OAAO0C,OAASJ,EAAItC,OAAOgD,YAKxCzX,GAAUyL,cAEZ47B,EAAQzqB,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAYC,GAAKrG,EAAoBmG,OAAOkT,WAAY,GACxH4oB,EAAQ1qB,EAAkB8pB,4BAA4B1mC,EAAUyL,YAAYE,GAAKtG,EAAoBmG,OAAOkT,WAAY,GACxHnZ,EAAiBmS,4BAA4BX,EAAK/W,EAAUyL,YAAYC,GAAI27B,EAAO9wB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQ,EAAG,EAAGrS,EAAsBnF,OAAO6U,MAAM4C,OAAO,GAC7L6uB,EAAQhC,EAAc1tB,EAAK/W,EAAUyL,YAAYE,GAAI27B,EAAOnvB,GAC5D5S,EAAiBmS,4BAA4BX,EAAK/W,EAAUyL,YAAYE,GAAI27B,EAAO/wB,EAAUjR,EAAsBnF,OAAOqW,KAAKC,MAAMkB,OAAQZ,EAAItC,OAAOyC,MAAQuvB,EAAQ,EAAG,EAAGnhC,EAAsBnF,OAAO6U,MAAM4C,OAAO,KAGrN3X,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,kBAClC,OACA,WACA,kBACA,eACA,cACA,wBACA,YACA,sBACA,wBACA,SAAwB+E,EAAMC,EAAUU,EAAiBC,EAAcuuB,EAAa1uB,EAAuBtF,EAAWqF,EAAqBa,GAWzI,QAASqhC,GAAYC,EAAWC,GAC9BvmC,OAAOC,KAAKqmC,GAAWvmC,QAAQ,SAAUoB,GACvC,GAAIqlC,GAAMF,EAAUnlC,EACpB,IAAiB,SAAbqlC,EAAI99B,KACN,GAAI69B,EAAa,CACfxnC,EAAS0nC,sBAAqB,EAAM,oBACpC,IAAI/kC,GAAK0C,EAAsB9C,mBAAmBklC,EAAI5kC,WAClD49B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,WACvDF,GAAIoB,OAAO4F,EAAIxD,gBAAgBwD,EAAIvD,WAAauD,EAAItyB,aAC/C,CACLnV,EAAS0nC,sBAAqB,EAAO,oBACrC,IAAI/kC,GAAK0C,EAAsB9C,mBAAmBklC,EAAI5kC,WAClD49B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,WACvDF,GAAIoB,OAAO4F,EAAIxD,gBAAgBwD,EAAIvD,WAAauD,EAAIvyB,aAEjD,IAAiB,WAAbuyB,EAAI99B,KAAmB,CAChC,GAAIgH,IAAS,CACb,QAAQ82B,EAAI92B,QACZ,IAAK,UAEC62B,GACF72B,GAAS,EACT1K,EAAsB0hC,eAAeF,EAAIjrB,QAASirB,EAAIrlC,IAAKqlC,EAAI93B,QAE/D1J,EAAsB0hC,eAAeF,EAAIvrB,QAASurB,EAAIrlC,IAAKqlC,EAAI93B,MAEjE,MACF,KAAK,WACC63B,GACF72B,GAAS,EACT1K,EAAsB2hC,iBAAiBH,EAAIrrB,SAAUqrB,EAAIrlC,IAAKqlC,EAAI93B,QAElE1J,EAAsB2hC,gBAAgBH,EAAIrrB,SAAUqrB,EAAIrlC,IAAKqlC,EAAI93B,YAIhE,IAAiB,UAAb83B,EAAI99B,KAAkB,CAC/B,GAAIgH,IAAS,CACb,QAAQ82B,EAAI92B,QACZ,IAAK,eACC62B,GACF72B,GAAS,EACTnL,EAAaytB,aAAawU,EAAIjlC,KAAMilC,EAAI72B,IAAK62B,EAAIvU,QAASuU,EAAIztB,QAASytB,EAAIvtB,SAE3E1U,EAAaytB,aAAawU,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIvU,QAASuU,EAAIztB,QAASytB,EAAIvtB,OAE5E,MACF,KAAK,cACCstB,GACF72B,GAAS,EACTnL,EAAa6tB,YAAYoU,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIvoC,QAASuoC,EAAIvU,UAE5D1tB,EAAa6tB,YAAYoU,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIvoC,OAAQuoC,EAAIvU,QAE7D,MACF,KAAK,YACCsU,GACF72B,GAAS,EACTnL,EAAa2tB,UAAUsU,EAAIjlC,KAAMilC,EAAI72B,IAAK62B,EAAIvU,UAE9C1tB,EAAa2tB,UAAUsU,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIvU,QAE/C,MACF,KAAK,cACCsU,GACF72B,GAAS,EACTnL,EAAawvB,YAAYyS,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAI1S,UAAW0S,EAAItyB,WAE9D3P,EAAawvB,YAAYyS,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAI1S,UAAW0S,EAAIvyB,SAEhE,MACF,KAAK,cACCsyB,GACF72B,GAAS,EACTnL,EAAaqiC,YAAYJ,EAAIK,QAASL,EAAIjlC,KAAMilC,EAAI1kC,oBAEpDyC,EAAaqiC,YAAYJ,EAAIjlC,KAAMilC,EAAIK,QAASL,EAAI1kC,kBAEtD,MACF,KAAK,cACCykC,GACF72B,GAAS,EACTnL,EAAaiL,YAAYg3B,EAAIp3B,MAAOo3B,EAAI72B,GAAI62B,EAAI1kC,oBAEhDyC,EAAauiC,YAAYN,EAAI72B,GAAI62B,EAAI1kC,kBAEvC,MACF,KAAK,iBACCykC,GACF72B,GAAS,EACTnL,EAAawiC,qBAAqBP,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIztB,QAASytB,EAAIvtB,OAAQutB,EAAI7M,iBAEjFp1B,EAAa01B,eAAeuM,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIztB,QAASytB,EAAIvtB,OAEjE,MACF,KAAK,iBACCstB,GACF72B,GAAS,EACTnL,EAAayiC,qBAAqBR,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIvoC,OAAQuoC,EAAI7M,iBAEpEp1B,EAAaq1B,eAAe4M,EAAIjlC,KAAMilC,EAAI72B,GAAI62B,EAAIvoC,OAEpD,MACF,KAAK,cACCsoC,GACF72B,GAAS,EACTnL,EAAa40B,YAAYqN,EAAIjlC,KAAMilC,EAAIvlC,MAAOulC,EAAIlN,UAAWkN,EAAI72B,KAEjEpL,EAAa81B,YAAYmM,EAAIjlC,KAAMilC,EAAI72B,GAEzC,MACF,KAAK,gBACC42B,GACF72B,GAAS,EACTojB,EAAYmU,cAAcT,EAAI3R,eAE9B/B,EAAYoU,cAAcV,EAAI72B,GAEhC,MACF,KAAK,qBACC42B,GACF72B,GAAS,EACTojB,EAAYqU,yBAAyBX,EAAI3R,eAEzC/B,EAAYoH,mBAAmBsM,EAAI72B,GAAI62B,EAAIrM,YAE7C,MACF,KAAK,oBACCoM,GACF72B,GAAS,EACTojB,EAAYsU,wBAAwBZ,EAAI3R,eAExC/B,EAAY+G,kBAAkB2M,EAAI1M,SAEpC,MACF,KAAK,cACCyM,GACF72B,GAAS,EACTnL,EAAauiC,YAAYN,EAAI72B,GAAI62B,EAAI1kC,oBAErCyC,EAAaiL,YAAYg3B,EAAIp3B,MAAOo3B,EAAI72B,GAAI62B,EAAI1kC,kBAElD,MACF,KAAK,iBACCykC,GACF72B,GAAS,EACTnL,EAAa8iC,oBAAoBb,EAAIjlC,KAAMilC,EAAIvlC,MAAOulC,EAAIne,IAAKme,EAAIxN,UAEnEz0B,EAAas0B,cAAc2N,EAAIjlC,KAAMilC,EAAIvlC,MAAOulC,EAAIne,IAAKme,EAAIxN,QAASwN,EAAIzN,IAE5E,MACF,KAAK,cACCwN,GACF72B,GAAS,EACTnL,EAAa81B,YAAYmM,EAAIjlC,KAAMilC,EAAI72B,KAEvCpL,EAAa40B,YAAYqN,EAAIjlC,KAAMilC,EAAIvlC,MAAOulC,EAAIlN,UAAWkN,EAAI72B,GAEnE,MACF,KAAK,gBACC42B,GACF72B,GAAS,EACTojB,EAAYoU,cAAcV,EAAIc,SAAUd,EAAIe,WAE5CzU,EAAYmU,cAAcT,EAAIc,SAAUd,EAAIe,SAE9C,MACF,KAAK,iBACChB,GACF72B,GAAS,EACTnL,EAAaozB,cAAc6O,EAAI5O,UAAW4O,EAAIjb,KAAMib,EAAIjlC,MAAOilC,EAAIjP,aAEnEhzB,EAAaozB,cAAc6O,EAAI5O,UAAW4O,EAAIjb,KAAMib,EAAIjlC,KAAMilC,EAAIjP,YAItEx4B,EAAS0nC,qBAAqB/2B,EAAQ82B,EAAI92B,YACrC,IAAiB,cAAb82B,EAAI99B,KAAsB,CACnC,GAAIgH,IAAS,CACb,QAAQ82B,EAAI92B,QACZ,IAAK,aAEC62B,GACF72B,GAAS,EACTojB,EAAY0U,aAAahB,EAAIjS,OAAQiS,EAAIhS,KAAMgS,EAAI/R,WAEnD3B,EAAYwB,WAAWkS,EAAIjS,OAAQiS,EAAIhS,KAEzC,MACF,KAAK,aACC+R,GACF72B,GAAS,EACTnL,EAAakjC,0BAA0BjB,EAAIjb,KAAMib,EAAI5jC,UAAW4jC,EAAI/R,SAAU+R,EAAI3R,eAElFtwB,EAAaqwB,oBAAoB4R,EAAIjb,KAAK5b,GAE5C,MACF,KAAK,UACC42B,GACF72B,GAAS,EACTnL,EAAamjC,cAAclB,EAAIzR,QAE/BxwB,EAAaywB,QAAQwR,EAAIvR,WAAYuR,EAAItR,OAAQsR,EAAIzR,MAEvD,MACF,KAAK,UACCwR,GACF72B,GAAS,EACTojB,EAAYwB,WAAWkS,EAAInzB,KAAKkhB,OAAQiS,EAAInzB,KAAKmhB,OAEjD1B,EAAY6U,WAAWnB,EAAInzB,KAAKkhB,OAAQiS,EAAInzB,KAAKmhB,KAEnD,MACF,KAAK,WACC+R,GACF72B,GAAS,EACTnL,EAAamjC,cAAclB,EAAIzR,QAE/BxwB,EAAaqjC,YAAYpB,EAAIp3B,MAAOo3B,EAAIzR,OAI5Ch2B,EAAS0nC,qBAAqB/2B,EAAQ82B,EAAI92B,WAvOhD,GAAI3Q,KACJA,GAASqS,sBAAwB,CAIjC,IAAIy2B,MACAC,KACAC,IA2WJ,OAlIAhpC,GAASuc,mBAAqB,SAAU0sB,GAEtC,GAAIC,EACJ,IAAqB,SAAjBD,EAAQt/B,KACVu/B,EAAU3kC,OAAO0kC,EAAQt/B,KAAO,IAAMs/B,EAAQpmC,WAAa,IAAM0B,OAAO0kC,EAAQhF,gBAAkB,IAAM1/B,OAAO0kC,EAAQ/E,WAElH8E,EAAaE,IAGhBD,EAAQ9zB,SAAW6zB,EAAaE,GAAS/zB,SACzC6zB,EAAaE,GAAWD,GAHxBD,EAAaE,GAAWD,MAKrB,IAAqB,WAAjBA,EAAQt/B,KACjBu/B,EAAU3kC,OAAO0kC,EAAQt/B,KAAO,IAAMs/B,EAAQt4B,OAAS,IAAMs4B,EAAQ7mC,IAAM,IAAM6mC,EAAQt5B,OAEpFq5B,EAAaE,IAGhBD,EAAQ/sB,QAAU8sB,EAAaE,GAAShtB,QACxC8sB,EAAaE,GAAWD,GAHxBD,EAAaE,GAAWD,MAKrB,IAAqB,UAAjBA,EAAQt/B,KACjB,OAAQs/B,EAAQt4B,QAChB,IAAK,eACL,IAAK,YACL,IAAK,cACL,IAAK,cACL,IAAK,cACHu4B,EAAU3kC,OAAO0kC,EAAQt/B,KAAO,IAAMs/B,EAAQt4B,OAAS,IAAMs4B,EAAQzmC,KAAO,IAAMymC,EAAQr4B,IACrFo4B,EAAaE,IAGhBD,EAAQ/V,SAAW8V,EAAaE,GAAShW,QACzC8V,EAAaE,GAAWD,GAHxBD,EAAaE,GAAWD,CAK1B,MACF,KAAK,gBACL,IAAK,gBACL,IAAK,qBACL,IAAK,oBACL,IAAK,iBACL,IAAK,iBACHC,EAAU3kC,OAAO0kC,EAAQt/B,KAAO,IAAMs/B,EAAQt4B,OAAS,IAAMs4B,EAAQzmC,MAChEwmC,EAAaE,IAGhBD,EAAQ9zB,SAAW6zB,EAAaE,GAAS/zB,SACzC6zB,EAAaE,GAAWD,GAHxBD,EAAaE,GAAWD,EAQ9B,MAAOD,IAGThpC,EAAS0I,2BAA6B,WAEpCqgC,KAEKjoC,EAAEC,cAAcioC,KACnBF,EAAUxnC,KAAK0nC,GACfhpC,EAASqS,uBAAyB,GAEpCzN,EAAKukC,KAAKH,GAEVA,MAGFhpC,EAAS0Q,kBAAoB,SAAU04B,GAErCL,IACA,IAAIM,MACAH,EAAU3kC,OAAO6kC,EAAIz/B,KAAO,IAAMy/B,EAAIz4B,OAAS,IAAMy4B,EAAI5mC,KAAO,IAAM4mC,EAAIx4B,GAC9Ey4B,GAAOH,GAAW1pC,QAAQoB,KAAKwoC,GAE1BtoC,EAAEC,cAAcsoC,KACnBP,EAAUxnC,KAAK+nC,GACfrpC,EAASqS,uBAAyB,GAGpC22B,MAGFhpC,EAASq2B,KAAO,WACd,GAAIyS,EAAU5pC,OAAS,EAAG,CAExB,GAAIoqC,GAAe9pC,QAAQoB,KAAKkoC,EAAUA,EAAU5pC,OAAS,GAC7D6pC,GAAUznC,KAAKgoC,GACfhC,EAAYgC,GAAc,GAE1BR,EAAUS,MACVvpC,EAASqS,uBAAyB,IAItCrS,EAASs2B,KAAO,WACd,GAAIyS,EAAU7pC,OAAS,EAAG,CACxB,GAAIoqC,GAAe9pC,QAAQoB,KAAKmoC,EAAUA,EAAU7pC,OAAS,GAC7D4pC,GAAUxnC,KAAKgoC,GACfhC,EAAYgC,GAAc,GAC1BP,EAAUQ,MACVvpC,EAASqS,uBAAyB,IAItCrS,EAASwpC,qBAAuB,WAC9B,MAAOV,GAAU5pC,QAGnBc,EAASypC,gBAAkB,WACzB,OACEpT,KAAQyS,EACRxS,KAAQyS,IAIZ/oC,EAAS0nC,qBAAuB,SAAUgC,EAAQC,GAChD,GAAIC,GAAQ,sBACPF,KACHE,EAAQ,wBAEV7pC,EAAUymB,iBAAmBojB,EAAQD,GAGvC3pC,EAASmJ,iBAAmB,WAC1B2/B,KACAC,KACAC,KACAhpC,EAASqS,sBAAwB,GAE5BrS,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,oBAClC,KACA,SAA0BC,GAExB,GAEI+B,GAFA7B,KACAvB,EAAS,GAAIN,gBAuBjB,OApBAM,GAAOuf,KAAK,SAAU3V,GACE,YAAlBA,EAAEoE,OAAO9C,KACX9H,EAAMG,QAAQqG,EAAE1H,MAEhBkB,EAAMqhC,OAAO76B,KAQjBrI,EAASqL,eAAiB,SAAUw+B,GAMlC,MALAhoC,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,WACP/lB,OAAUusB,IAELhoC,EAAMI,SAERjC,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,yBAClC,KACA,cACA,YACA,sBACA,SAA+BC,EAAIsG,EAAarG,EAAWqF,GAEzD,GAEIvD,GAFA7B,KACAvB,EAAS,GAAIE,qBAyCjB,OAtCAF,GAAOuf,KAAK,SAAU3V,GACE,YAAlBA,EAAEoE,OAAO9C,KACX9H,EAAMG,QAAQqG,EAAE1H,MAEhBkB,EAAMqhC,OAAO76B,KAEd,GAMHrI,EAASkR,gBAAkB,WAQzB,MAPArP,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,aACPj3B,OAAUhG,EAAYkL,UAAUlF,OAChCkT,WAAcla,EAAoBmG,OAAOkT,WACzCqrB,WAAc1kC,EAAoBmG,OAAOI,KAAKzM,SAEzC2C,EAAMI,SAOfjC,EAASo+B,mBAAqB,SAAU2L,EAAU9L,EAAWz7B,GAS3D,MARAX,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,UACP0G,SAAYA,EACZzqB,WAAcla,EAAoBmG,OAAOkT,WACzCwf,UAAaA,EACbz7B,KAAQA,IAEHX,EAAMI,SAERjC,KAIXR,QAAQC,OAAO,aAAawiB,QAAQ,OAAQ,WAG1C,QAAS+nB,GAAK3e,GACZ,GAAIya,IAAKrsB,KAAKwwB,SAAS5wB,SAAS,IAAM,aAAa5O,OAAO,EAAG,EAC7D,OAAO4gB,GAAI,IAAMya,EAAEr7B,OAAO,EAAG,GAAK,IAAMq7B,EAAEr7B,OAAO,EAAG,GAAKq7B,EAH3D,GAAI9lC,KAgBJ,OAVAA,GAAAA,OAAe,WACb,MAAOgqC,KAASA,GAAK,GAAQA,GAAK,GAAQA,KAE5ChqC,EAASkqC,QAAU,WACjB,MAAOF,KAASA,GAAK,GAAQA,GAAK,GAAQA,KAG5ChqC,EAASmqC,MAAQ,WACf,MAAO,wCAEFnqC,IAGTR,QAAQC,OAAO,aAAawiB,QAAQ,kBAAmB,WAErD,GAAIjiB,KAoEJ,OAnEAA,GAASoqC,UACPC,QAAS,WACP,MAAOC,WAAUC,UAAUC,MAAM,aAEnCC,WAAY,WACV,MAAOH,WAAUC,UAAUC,MAAM,gBAEnCE,IAAK,WACH,MAAOJ,WAAUC,UAAUC,MAAM,sBAEnCG,MAAO,WACL,MAAOL,WAAUC,UAAUC,MAAM,gBAEnCI,QAAS,WACP,MAAON,WAAUC,UAAUC,MAAM,cAEnCK,IAAK,WACH,MAAO7qC,GAASoqC,SAASC,WAAarqC,EAASoqC,SAASK,cAAgBzqC,EAASoqC,SAASM,OAAS1qC,EAASoqC,SAASO,SAAW3qC,EAASoqC,SAASQ,YAGtJ5qC,EAASuN,WACPqS,QAAS,WACP,MAAO0qB,WAAUC,UAAUC,MAAM,aAEnCM,OAAQ,WACN,MAAOR,WAAUC,UAAUC,MAAM,YAEnCO,iBAAkB,WAChB,MAAOT,WAAUC,UAAUC,MAAM,UAEnCG,MAAO,WACL,MAAOL,WAAUC,UAAUC,MAAM,WAEnCh9B,UAAW,WACT,MAAO88B,WAAUC,UAAUC,MAAM,eAEnCQ,OAAQ,WACN,MAAO/pC,QAAOlC,UAAUsa,SAASosB,KAAKpnC,OAAO4sC,aAAaxiB,QAAQ,eAAiB,GAErFoiB,IAAK,WACH,MAAO7qC,GAASuN,UAAUqS,WAAa5f,EAASuN,UAAUu9B,UAAY9qC,EAASuN,UAAUw9B,oBAAsB/qC,EAASuN,UAAUo9B,SAAW3qC,EAASuN,UAAUy9B,UAAYhrC,EAASuN,UAAUC,cAGnMxN,EAASkrC,eAAiB,WACxB,GAAIvqC,GAAOX,EAASoqC,SAASS,KAC7B,OAAa,QAATlqC,GACK,EAEHA,EAAKzB,OAAS,GACT,GAEA,GAIbc,EAASmrC,gBAAkB,WACzB,GAAIxqC,GAAOX,EAASuN,UAAUs9B,KAC9B,OAAa,QAATlqC,GACK,EAEHA,EAAKzB,OAAS,GACT,GAEA,GAINc,IAGTR,QAAQC,OAAO,aAAaI,QAAQ,mBAAoB,WAEtD,GAAIG,KA8CJ,OA7CAA,GAASorC,cAAgB,KACzBprC,EAASqrC,SAAW,EACpBrrC,EAASuX,OAAS,EAClBvX,EAASkY,OAAS,EAIlBlY,EAAS4X,oBAAsB,SAAU0zB,EAAa3B,EAAM4B,EAAYC,EAAU9e,EAAGoV,EAAG/sB,GACtF/U,EAASuX,OAAS+zB,EAAY92B,OAAO0C,OAASo0B,EAAY92B,OAAOgD,aACjExX,EAASkY,OAASozB,EAAY92B,OAAOyC,MAAQq0B,EAAY92B,OAAOwuB,YAChEsI,EAAYtqB,OACZsqB,EAAY/0B,KAAOg1B,EAAa,MAAaC,EAC7CF,EAAY/G,MAAMvkC,EAASkY,OAAQlY,EAASuX,QAC5C+zB,EAAYlzB,UAAYrD,EACxBu2B,EAAYlF,SAASuD,EAAMjd,EAAI1sB,EAASkY,QAAS4pB,EAAIyJ,EAAavrC,EAASqrC,UAAYrrC,EAASuX,QAChG+zB,EAAY/G,MAAM,EAAG,GACrB+G,EAAYG,WAKdzrC,EAASyX,4BAA8B,SAAU6zB,EAAa3B,EAAM+B,EAAOH,EAAYC,EAAU9e,EAAGoV,EAAG/sB,EAAO42B,GAO5G,GANA3rC,EAASuX,OAAS+zB,EAAY92B,OAAO0C,OAASo0B,EAAY92B,OAAOgD,aACjExX,EAASkY,OAASozB,EAAY92B,OAAOyC,MAAQq0B,EAAY92B,OAAOwuB,YAChEsI,EAAYtqB,OACZsqB,EAAY/0B,KAAOg1B,EAAa,MAAaC,EAC7CF,EAAYlzB,UAAYrD,EACxBu2B,EAAY/G,MAAMvkC,EAASkY,OAAQlY,EAASuX,QACxCo0B,EACFL,EAAYlF,SAASuD,EAAMjd,EAAI1sB,EAASkY,OAAQ4pB,EAAIyJ,EAAavrC,EAASqrC,UAC1EC,EAAYlF,SAASsF,EAAOhf,EAAI1sB,EAASkY,OAAQ4pB,EAAI,EAAIyJ,EAAavrC,EAASqrC,cAC1E,CACL,GAAI3nC,GAAI4nC,EAAYrzB,YAAY0xB,GAAM1yB,MAClCyR,EAAI4iB,EAAYrzB,YAAYyzB,GAAOz0B,KAEnCvT,GAAIglB,GACN4iB,EAAYlF,SAASuD,EAAMjd,EAAI1sB,EAASkY,OAAQ4pB,EAAIyJ,EAAavrC,EAASqrC,UAC1EC,EAAYlF,SAASsF,GAAQhf,GAAKhpB,EAAIglB,IAAM1oB,EAASkY,OAAQ4pB,EAAI,EAAIyJ,EAAavrC,EAASqrC,YAE3FC,EAAYlF,SAASuD,GAAOjd,GAAKhE,EAAIhlB,IAAM1D,EAASkY,OAAQ4pB,EAAIyJ,EAAavrC,EAASqrC,UACtFC,EAAYlF,SAASsF,EAAOhf,EAAI1sB,EAASkY,OAAQ4pB,EAAI,EAAIyJ,EAAavrC,EAASqrC,WAGnFC,EAAYG,WAEPzrC,IAGTR,QAAQC,OAAO,aAAaI,QAAQ,qBAClC,KACA,eACA,sBACA,SAA2BC,EAAI0F,EAAcJ,GAE3C,GAEIvD,GAFA7B,KACAvB,EAAS,GAAIC,iBA2CjB,OAxCAD,GAAOuf,KAAK,SAAU3V,GACE,YAAlBA,EAAEoE,OAAO9C,KACX9H,EAAMG,QAAQqG,EAAE1H,MAEhBkB,EAAMqhC,OAAO76B,EAAE1H,QAEhB,GAQHX,EAASm+B,eAAiB,SAAUyN,EAAM3N,EAAWz7B,GASnD,MARAX,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,YACPuI,KAAQA,EACRtsB,WAAcla,EAAoBmG,OAAOkT,WACzCwf,UAAaA,EACbz7B,KAAQA,IAEHX,EAAMI,SAQfjC,EAASy8B,cAAgB,SAAUj6B,GAOjC,MANAX,GAAQ/B,EAAG+B,QACXpD,EAAOsgB,MACLskB,IAAO,WACPhzB,MAAS7K,EAAa+kB,gBAAgB/nB,GACtC8c,WAAcla,EAAoBmG,OAAOkT,aAEpC5c,EAAMI,SAERjC,KAIXR,QAAQC,OAAO,aAAagF,WAAW,aACrC,SACA,aACA,QACA,wBACA,mBACA,YACA,eACA,SAAUC,EAAQC,EAAYs4B,EAAO53B,EAAuBF,EAAkBpF,EAAWsG,GACvF3B,EAAOmnC,WACLC,SAAY,GACZC,SAAY,GACZC,SAAY,IAKdtnC,EAAOunC,SAAW,WAChB9mC,EAAiBu4B,UAAUh5B,EAAOmnC,UAAUC,SAAUpnC,EAAOmnC,UAAUE,UAAUtiC,KAAK,SAAUhH,GAClF,aAARA,EACF4D,EAAa6lC,UAEbxnC,EAAOmnC,UAAUG,SAAW,UAAYvpC,KAS9CiC,EAAOqL,kBAAoB,WACzBhQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOuL,qBAAuB,WAC5BlQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOynC,OAAS,WACd9lC,EAAawa,YAKnBrhB,QAAQC,OAAO,aAAaI,QAAQ,mBAClC,YACA,sBACA,wBACA,SAAyBE,EAAWqF,EAAqBC,GAEvD,GAAIrF,KA6DJ,OA3DAA,GAASW,QAQTX,EAASosC,QAAU,SAAUvpC,GAC3B,GAAIJ,EAYJ,OAX+DjB,UAA3D6D,EAAsBlF,YAAYuC,sBACpC2C,EAAsBlF,YAAYuC,qBAAqB1B,QAAQ,SAAUqrC,GACnEA,EAAI7pC,OAASK,GACf7C,EAASW,KAAKK,QAAQ,SAAUskB,GAC1BA,EAAEgnB,gBAAkBD,EAAIC,gBAC1B7pC,EAAM6iB,OAMT7iB,GAKTzC,EAAS0gC,iBAAmB,SAAU79B,EAAW89B,GAC/C,GAAIl+B,GACA8pC,EAAOvsC,EAASosC,QAAQvpC,EAC5B,OAAarB,UAAT+qC,GACFA,EAAKC,QAAQxrC,QAAQ,SAAUy/B,GACzBA,EAAIj+B,OAASm+B,IACfl+B,EAAMg+B,KAGHh+B,GANT,QAYFzC,EAAS6gC,iCAAmC,SAAUh+B,GACpD,GAAIJ,MACA8pC,EAAOvsC,EAASosC,QAAQvpC,EAC5B,OAAarB,UAAT+qC,GACF9pC,EAAI6c,WAAaitB,EAAKjtB,WACtB7c,EAAIu+B,UAAYuL,EAAKvL,UACdv+B,GAHT,QAUFzC,EAASysC,uBAAyB,SAAUC,EAAaptB,EAAY0hB,GACnE,GAAI2L,GAAaD,EAAcptB,EAAa0hB,EACxC4L,EAAcnzB,KAAKC,MAAMizB,EAAavnC,EAAoBmG,OAAOkT,WACrE,OAAOmuB,IAEF5sC,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,cAAe,WAEjD,GAAIG,KA6IJ,OA5IAA,GAASW,QACTX,EAAS6sC,UAAY,EAOrB7sC,EAASsR,QAAU,WACjB,MAAOtR,GAASW,MAMlBX,EAAS8sC,aAAe,SAAUnsC,GAChCX,EAASW,KAAKyL,OAASzL,GAMzBX,EAAS+sC,aAAe,WACtB,MAAO/sC,GAASW,KAAKyL,QAMvBpM,EAASgtC,cAAgB,SAAU7oC,GACjC,MAA6B3C,UAAzBxB,EAASW,KAAKyL,OACTpM,EAASW,KAAKyL,OAAOmhB,KAAK,SAAU7pB,EAAGglB,GAC5C,MAAOvkB,GAAMskB,QAAQ/kB,EAAElB,MAAQ2B,EAAMskB,QAAQC,EAAElmB,QAFnD,QAUFxC,EAASitC,eAAiB,SAAUvX,GAClC,MAAO11B,GAASW,KAAKyL,OAAOspB,IAO9B11B,EAASktC,kBAAoB,SAAUxX,EAAUyX,GAC/CntC,EAASW,KAAKyL,OAAOghC,OAAO1X,EAAU,EAAGyX,IAM3CntC,EAASqtC,kBAAoB,SAAU3X,GACrC11B,EAASW,KAAKyL,OAAOghC,OAAO1X,EAAU,IAMxC11B,EAASstC,YAAc,WACrB,MAAOttC,GAASW,KAAK4sC,OAMvBvtC,EAASwtC,YAAc,SAAU7sC,GAC/BX,EAASW,KAAK4sC,MAAQ5sC,GAOxBX,EAASytC,eAAiB,SAAUC,GAClC1tC,EAASW,KAAK4sC,MAAMjsC,KAAKosC,IAM3B1tC,EAAS2tC,iBAAmB,SAAUjY,GACpC11B,EAASW,KAAK4sC,MAAMH,OAAO1X,EAAU,IAOvC11B,EAAS4tC,iBAAmB,SAAUlY,EAAUgY,GAC9C1tC,EAASW,KAAK4sC,MAAMH,OAAO1X,EAAU,EAAGgY,IAQ1C1tC,EAAS6tC,iBAAmB,SAAUnY,EAAUoY,EAAWC,GACzD/tC,EAASW,KAAK4sC,MAAM7X,GAAUF,OAASsY,EACvC9tC,EAASW,KAAK4sC,MAAM7X,GAAUD,KAAOsY,GAQvC/tC,EAASiM,QAAU,SAAUtL,GAC3BnB,QAAQoB,KAAKD,EAAMX,EAASW,MAC5BnB,QAAQwB,QAAQhB,EAASW,KAAKyL,OAAQ,SAAUiE,GAC9CA,EAAMC,MAAMtP,QAAQ,SAAUwrB,GACxBA,EAAK5b,GAAK5Q,EAAS6sC,YACrB7sC,EAAS6sC,UAAYrgB,EAAK5b,SAQlC5Q,EAASguC,SAAW,WAElB,MADAhuC,GAAS6sC,WAAa,EACf7sC,EAAS6sC,WAKlB7sC,EAASiuC,QAAU,SAAUC,GAC3BluC,EAAS6sC,WAAaqB,GAKxBluC,EAASmuC,QAAU,SAAUD,GAC3BluC,EAAS6sC,WAAaqB,GAEjBluC,IAGTR,QAAQC,OAAO,aAAaI,QAAQ,gBAClC,KACA,cACA,cACA,wBACA,sBACA,YACA,kBACA,qBACA,SAAsBC,EAAIsG,EAAa2tB,EAAa1uB,EAAuBD,EAAqBrF,EAAWwF,EAAiB6oC,GAa1H,QAASC,GAAY34B,EAAa+C,GAChC,GAAI61B,EAMJ,OALA9uC,SAAQwB,QAAQyX,EAAQ,SAAUpM,EAAGgI,GAC/BhI,EAAE7J,OAASkT,IACb44B,EAAWj6B,KAGRi6B,EAlBT,GAAItuC,KA4iDJ,OA3iDAA,GAASuuC,aAAe,KAExBvuC,EAASwuC,iBAAmB,KAuB5BxuC,EAASuqB,gBAAkB,SAAU/nB,GACnC,GAAIV,GAAM,IAMV,OALAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,IACjBV,EAAMuO,KAGHvO,GAMT9B,EAASyuC,gBAAkB,SAAUC,GACnC,GAAItiC,KAMJ,OALA5M,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDq+B,EAAMjmB,QAAQpY,EAAM1G,OAAS,GAC/ByC,EAAO9K,KAAK+O,KAGTjE,GAQTpM,EAAS2uC,aAAe,SAAUnsC,EAAMoO,GACtC,GAAI9O,GAAM,IAUV,OATAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GACjB6N,EAAMC,MAAMtP,QAAQ,SAAUqH,EAAGumC,GAC3BvmC,EAAEuI,KAAOA,IACX9O,EAAM8sC,OAKP9sC,GAQT9B,EAAS6uC,aAAe,SAAUrsC,EAAM2B,GACtC,GAAIrC,GAAM,IAUV,OATAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GACjB6N,EAAMC,MAAMtP,QAAQ,SAAU6G,EAAS+mC,GACjCA,IAAQzqC,IACVrC,EAAM+F,EAAQ+I,QAKf9O,GAQT9B,EAAS6vB,eAAiB,SAAUrtB,EAAM2B,GACxC,GAAIrC,GAAM,IAMV,OALAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,IACjBV,EAAMuO,EAAMC,MAAMnM,MAGfrC,GAMT9B,EAAS8vB,YAAc,SAAUttB,GAC/B,GAAIssC,GAAU,IAMd,OALAtvC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,IACjBssC,EAAUz+B,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,MAGxC4vC,GAQT9uC,EAAS+uC,YAAc,SAAUvsC,EAAMoO,GACrC,GAAI9O,GAAM,IAUV,OATAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GACjB6N,EAAMC,MAAMtP,QAAQ,SAAU6G,EAAS+mC,GACjC/mC,EAAQ+I,KAAOA,IACjB9O,EAAMuO,EAAMC,MAAMs+B,EAAM,QAKzB9sC,GAST9B,EAASwzB,cAAgB,SAAUhxB,EAAMoO,EAAIo+B,GAC3C,GAAIltC,GAAM,KACNmtC,EAAiB3J,EAAAA,EACjB4J,EAAYlvC,EAAS0yB,qBAAqBlwB,EAAMoO,EACpD,IAAkB,OAAds+B,EAAoB,CACtB,GAAIC,GAAUD,EAAU52B,aAAe42B,EAAU11B,WACjDha,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GACjB6N,EAAMC,MAAMtP,QAAQ,SAAU6G,GAC5B,GAAI3F,GAAQ2F,EAAQyQ,aAAezQ,EAAQ2R,WACvCw1B,GACE9sC,EAAQitC,GAA8BF,GAAnB/sC,EAAQitC,IAC7BF,EAAiB/sC,EAAQitC,EACzBrtC,EAAM+F,GAGIsnC,EAARjtC,GAAsC+sC,GAAnBE,EAAUjtC,IAC/B+sC,EAAiBE,EAAUjtC,EAC3BJ,EAAM+F,OAOlB,MAAO/F,IAOT9B,EAAS0yB,qBAAuB,SAAUlwB,EAAMoO,GAC9C,GAAI9O,GAAM,IAUV,OATAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GACjB6N,EAAMC,MAAMtP,QAAQ,SAAU6G,GACxBA,EAAQ+I,IAAMA,IAChB9O,EAAM+F,OAKP/F,GAQT9B,EAASovC,oBAAsB,SAAUC,GACvC,GAAI15B,GAAa5V,EAAUwQ,cAAc8+B,EAAa7sC,MAClDiW,IASJ,OARAjZ,SAAQwB,QAAQquC,EAAa/+B,MAAO,SAAUkc,GAC5C,GAAI8I,GAAM9I,EAAK/T,OAAO62B,IAAI,SAAUjnC,GAChC,MAAOA,GAAE7F,OACRimB,QAAQ9S,EACT2f,IAAO,GACT7c,EAAOnX,KAAKkrB,EAAK/T,OAAO6c,GAAKnzB,SAG1BsW,GAOTzY,EAAS80B,aAAe,SAAUya,GAChC,GAAIztC,GAAM,IASV,OARAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GACpD,GAAIilB,GAAMjlB,EAAMC,MAAMg/B,IAAI,SAAUjnC,GAChC,MAAOA,GAAEuI,KACR6X,QAAQ8mB,EACTja,IAAO,IACTxzB,EAAMuO,EAAM7N,QAGTV,GAOT9B,EAASwvC,gBAAkB,SAAUD,GACnC,GAAI/sC,GAAOxC,EAAS80B,aAAaya,EACjC,OAAa,QAAT/sC,GAEA6N,MAAOrQ,EAASuqB,gBAAgB/nB,GAChCgqB,KAAMxsB,EAAS60B,YAAY0a,IAGtB,MAQXvvC,EAAS60B,YAAc,SAAU0a,GAC/B,GAAIztC,GAAMN,MASV,OARAhC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GACpD,GAAIilB,GAAMjlB,EAAMC,MAAMg/B,IAAI,SAAUjnC,GAChC,MAAOA,GAAEuI,KACR6X,QAAQ8mB,EACTja,IAAO,IACTxzB,EAAMuO,EAAMC,MAAMglB,MAGfxzB,GAST9B,EAASyvC,+BAAiC,SAAUjtC,EAAMoO,EAAI1R,GAG5D,IAAK,GAFD4C,MACA4tC,EAAS9+B,EACJ++B,EAAI,EAAOzwC,EAAJywC,EAAYA,IAAK,CAC/B,GAAIC,GAAU5vC,EAAS0yB,qBAAqBlwB,EAAMktC,EAClDA,GAAS1vC,EAAS+uC,YAAYvsC,EAAMotC,EAAQh/B,IAC5C9O,EAAIR,KAAKsuC,GAEX,MAAO9tC,IAMT9B,EAAS45B,oBAAsB,WAC7B,MAAO55B,GAASwuC,kBAMlBxuC,EAASuzB,oBAAsB,SAAUlrB,GACvCrI,EAASwuC,iBAAmBnmC,GAM9BrI,EAASszB,gBAAkB,SAAU9wB,GACnCxC,EAASuuC,aAAe/rC,GAM1BxC,EAASs0B,gBAAkB,WACzB,MAAOt0B,GAASuuC,cAMlBvuC,EAAS02B,UAAY,WACnB,MAAO12B,GAASuuC,aAAa9jC,OAAO,IAMtCzK,EAAS+H,eAAiB,WACpB,OAAS/H,EAASs0B,mBACpBxzB,EAAE,IAAMd,EAASs0B,mBAAmBub,SAEtC9vC,EAAU0mB,SAAU,GAUtBzmB,EAAS2zB,aAAe,SAAUpC,EAAgB1pB,EAAS8B,GACzD,GAAI9F,GAAY9D,EAAUiR,uBACtB0E,EAAc3V,EAAUwQ,cAAc1M,GAEtCyqC,EAAWD,EAAY34B,EAAa6b,EAAe9Y,QACnDsjB,EAAOl0B,EAAQ4M,KAAK,UAAUqI,QAAQ/F,WAAW,MACjD4Z,EAAcoL,EAAKvnB,OAAOmc,YAC1Bmf,EAAe/T,EAAKvnB,OAAOu7B,WAC3BC,EAAMjU,EAAKvnB,OAAOy7B,UAClB/4B,EAAS6kB,EAAKvnB,OAAOuc,aAAe,EACpCnhB,EAAM,EACOpO,UAAb8sC,GACE/c,EAAe9Y,OAAO61B,GAAUnsC,MAAMjD,OAAS,IACjD0Q,EAAqD,EAA/C2hB,EAAe9Y,OAAO61B,GAAUnsC,MAAMjD,OAGhD,IAAIgxC,GAAW,EAQf,IAPI3e,EAAe9Y,OAAOvZ,OAAS,IAE/BgxC,EADsC1uC,SAApC+vB,EAAe9Y,OAAO61B,GACb/c,EAAe9Y,OAAO61B,GAAUnsC,MAEhC,IAGF,YAATwH,EAAoB,CACtB,GAAIzH,GAAQuX,KAAKwP,MAAMlpB,EAAU4Y,OAAOgY,EAAaY,EAAejZ,aAAew3B,GAC/ExmB,EAAM7P,KAAK6X,KAAKvxB,EAAU4Y,OAAOgY,EAAaY,EAAejZ,YAAciZ,EAAehZ,UAAY,GAAKu3B,GAC3G74B,EAAQqS,EAAMpnB,CAClBlC,GAASmwC,sBAAsBtoC,EAAS3F,EAAO8tC,EAAK1mB,EAAMpnB,EAAOgV,EAAQqa,EAAe9Y,OAAO61B,GAAUnsC,MAAOovB,EAAe3gB,QAe1H,CACL,GAAI1O,GAAQnC,EAAU4Y,OAAOgY,EAAaY,EAAe/X,aAAes2B,EAAelgC,EAAM,EACzF0Z,EAAMvpB,EAAU4Y,OAAOgY,EAAaY,EAAe/X,aAAes2B,EAAelgC,EAAM,EACvFqH,EAAQqS,EAAMpnB,CACN,GAAI0N,EAAZqH,IACFA,EAAQ,EAAIrH,GAEd5P,EAASmwC,sBAAsBtoC,EAAS3F,EAAO8tC,EAAK/4B,EAAOC,EAAQg5B,EAAU3e,EAAe3gB,IAE9F5Q,EAASowC,gBAAgBvoC,EAAQ4M,KAAK,YAAY,GAAI,EAAGy7B,EAAShxC,SAQpEc,EAASowC,gBAAkB,SAAUC,EAAOnuC,EAAOonB,GACjD,GAAI+mB,EAAMC,gBAAiB,CACzB,GAAIC,GAAWF,EAAMC,iBACrBC,GAASC,UAAS,GAClBD,EAASE,UAAU,YAAavuC,GAChCquC,EAASG,QAAQ,YAAapnB,GAC9BinB,EAASlnB,aACAgnB,GAAMM,kBACfN,EAAMM,kBAAkBzuC,EAAOonB,GACtB+mB,EAAMO,iBACfP,EAAMO,eAAiB1uC,EACvBmuC,EAAMQ,aAAevnB,EAEvB+mB,GAAMS,SAWR9wC,EAASmwC,sBAAwB,SAAUtoC,EAAS6kB,EAAGoV,EAAG7qB,EAAOC,EAAQ65B,EAAOC,GAC9E,GAAIC,GAAS,IAAMD,CACnBnpC,GAAQqpC,QAAQpwC,EAAE,cAAcyT,MAC9B3D,GAAIqgC,EACJE,QAASF,EAAS,wBAClBG,WAAY,UACZC,UAAa,SACZx6B,KACD6W,KAAQjU,KAAKC,MAAMgT,EAAI,GAAK,KAC5BsjB,IAAOv2B,KAAKC,MAAMooB,EAAI,GAAK,KAC3B7qB,MAASwC,KAAKC,MAAMzC,GAAS,EAAI,KACjCC,OAAUuC,KAAKC,MAAMxC,GAAU,GAAK,KACpCo6B,cAAe73B,KAAKC,MAAMxC,EAAS,EAAI,GAAK,OAC3CyyB,KAAKoH,KAKV/wC,EAASuxC,kBAAoB,SAAU3gC,EAAI0nB,EAAW5C,EAAU8b,EAAWtvC,EAAO6Y,GAChF,GAEI02B,GAFAC,EAAWrsC,EAAsBzB,mBAAmB00B,GAAWhsB,qBAC/DqJ,EAAa5V,EAAUwQ,cAAc+nB,EAExB92B,UAAbkwC,IAEFA,MAEFlyC,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GACpD,GAAIA,EAAM7N,OAAS81B,EAAW,CAC5B,GAAkB,WAAdjoB,EAAM1G,KAOR,GANA8nC,GACE7gC,GAAIA,EACJ0H,YAAapW,EACbqW,UAAWwC,EACXtC,WAEEi5B,EAASxyC,OAAS,EACpB,IAAK,GAAIK,GAAI,EAAGA,EAAImyC,EAASxyC,OAAQK,IAC/BmyC,EAASnyC,GAAGiD,OAASmT,EACvB87B,EAAWh5B,OAAOnX,MAChBkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAOqvC,IAGTC,EAAWh5B,OAAOnX,MAChBkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAOqvC,QAKbC,GAAWh5B,OAAOnX,MAChBkB,KAAM81B,EACNn2B,MAAOqvC,QAGN,IAAkB,SAAdnhC,EAAM1G,KAaf,GAXE8nC,EADYjwC,SAAVU,GAEA0O,GAAIA,EACJ4I,YAAatX,EACbuW,YAIA7H,GAAIA,EACJ6H,WAGAi5B,EAASxyC,OAAS,EACpB,IAAK,GAAIK,GAAI,EAAGA,EAAImyC,EAASxyC,OAAQK,IAC/BmyC,EAASnyC,GAAGiD,OAASmT,EACvB87B,EAAWh5B,OAAOnX,MAChBkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAOqvC,IAGTC,EAAWh5B,OAAOnX,MAChBkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAOqvC,QAKbC,GAAWh5B,OAAOnX,MAChBkB,KAAM81B,EACNn2B,MAAOqvC,GAIbnhC,GAAMC,MAAM88B,OAAO1X,EAAU,EAAG+b,OAOtCzxC,EAAS2xC,cAAgB,SAAUrZ,EAAW1nB,EAAI4gC,EAAWlD,EAAUpsC,EAAO6Y,GAC5Evb,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAAS81B,GACjBjoB,EAAMC,MAAMtP,QAAQ,SAAU6G,GACxBA,EAAQ+I,IAAMA,IACFpP,SAAVU,IACF2F,EAAQyQ,YAAcpW,GAEPV,SAAbuZ,IACFlT,EAAQ0Q,UAAYwC,GAEJvZ,SAAdgwC,IACF3pC,EAAQ4Q,OAAO61B,GAAUnsC,MAAQqvC,SAU7CxxC,EAAS4xC,YAAc,SAAUtZ,EAAW1nB,EAAI4gC,EAAWlD,EAAUpsC,GACnE1C,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAAS81B,GACjBjoB,EAAMC,MAAMtP,QAAQ,SAAU6G,GACxBA,EAAQ+I,IAAMA,IAChB/I,EAAQ2R,YAActX,EACLV,SAAb8sC,EACFzmC,EAAQ4Q,OAAO,GAAGtW,MAAQqvC,EAE1B3pC,EAAQ4Q,OAAO61B,GAAUnsC,MAAQqvC,QAU7CxxC,EAAS6zB,2BAA6B,SAAUhwB,EAAWguC,EAASC,GAClE,GAAIpkB,GAAOlsB,OACPmsB,EAAQnsB,MAaZ,OAZAhC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASqB,GACjBwM,EAAMC,MAAMtP,QAAQ,SAAUK,EAAKutC,GAC7BvtC,EAAIuP,IAAMihC,IACZnkB,EAAOrd,EAAMC,MAAMs+B,EAAM,IAEvBvtC,EAAIuP,IAAMkhC,IACZnkB,EAAQtd,EAAMC,MAAMs+B,EAAM,SAMhClhB,KAAMA,EACNC,MAAOA,IAgBX3tB,EAASwyB,eAAiB,SAAUuf,EAAUzZ,EAAW0Z,GACvD,GAAI3hC,GAAQrQ,EAASuqB,gBAAgB+N,GACjC12B,EAAUJ,OACVmxB,EAAUnxB,OACVwY,EAAUxY,OACV0Y,EAAS1Y,MACb,IAAcA,SAAV6O,GAAiC,OAAVA,GAAkBA,EAAMC,MAAMpR,OAAS,EAIhE,GAHA0C,EAAU+wB,EAAUtiB,EAAMC,MAAM,GAChC0J,GAAU,EACVE,GAAS,EACU,YAAf7J,EAAM1G,KACRnK,QAAQwB,QAAQqP,EAAMC,MAAO,SAAUjP,EAAKsO,GACtCoiC,GAAY1wC,EAAIiX,YAAc,KAE5By5B,GAAY1wC,EAAIiX,YAAcjX,EAAIkX,UAAY,KAE5Cw5B,EAAW1wC,EAAIiX,aAAejX,EAAIkX,UAAY,EACjB/W,SAA3B6O,EAAMC,MAAMX,EAAQ,IACtB/N,EAAUyO,EAAMC,MAAMX,GACtBgjB,EAAUtiB,EAAMC,MAAMX,EAAQ,GAC9BuK,GAAS,IAETA,GAAS,EACTtY,EAAU+wB,EAAUtiB,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,KAGvDgb,GAAS,EACTtY,EAAU+wB,EAAUtiB,EAAMC,MAAMX,KAGpCqK,GAAU,GAER+3B,GAAY1wC,EAAIiX,YAAc,KAC5By5B,GAAY1wC,EAAIiX,YAAcjX,EAAIkX,UAAY,GAEhD3W,EAAUP,GAEV6Y,GAAS,EACTtY,EAAU+wB,EAAUtiB,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,WAItD,CACL,GAAI+yC,GAAa,EACbC,EAAc,CAClBl4B,IAAU,EACVE,GAAS,EACT1a,QAAQwB,QAAQqP,EAAMC,MAAO,SAAU6hC,EAAKxiC,GAExCuiC,EADEviC,EAAQU,EAAMC,MAAMpR,OAAS,EACjBizC,EAAI34B,aAAenJ,EAAMC,MAAMX,EAAQ,GAAG6J,YAAcnJ,EAAMC,MAAMX,GAAO6J,aAAe,EAE1Fw4B,EAGdC,EADEtiC,EAAQ,EACGwiC,EAAI34B,aAAenJ,EAAMC,MAAMX,GAAO6J,YAAcnJ,EAAMC,MAAMX,EAAQ,GAAG6J,aAAe,EAE1F,EAEC04B,GAAZH,GAA2BA,GAAYE,IACzCrwC,EAAU+wB,EAAUwf,KAK5B,OACEvwC,QAASA,EACT+wB,QAASA,EACT3Y,QAASA,EACTE,OAAQA,IAMZla,EAAS+nC,YAAc,SAAUhc,EAAYhpB,GAC3C,GAAIqvC,GAAMhsC,EAAY6mC,eAAelhB,EAGrC,OAFA3lB,GAAYinC,kBAAkBthB,GAC9B1mB,EAAsBpF,KAAK6C,aAAaC,GAAmBmB,cAAcC,MAAMipC,OAAOrhB,EAAY,GAC3FqmB,GAKTpyC,EAASyQ,YAAc,SAAU4hC,EAAetmB,EAAYhpB,GACvBvB,SAA/B4E,EAAY2mC,gBACd3mC,EAAY0mC,iBAEd1mC,EAAY8mC,kBAAkBnhB,EAAYsmB,GAC1ChtC,EAAsBpF,KAAK6C,aAAaC,GAAmBmB,cAAcC,MAAMipC,OAAOrhB,EAAY,EAAGsmB,EAAc7vC,OAKrHxC,EAASg1B,YAAc,SAAUnxB,EAAW+M,EAAImkB,EAAWud,GACzDtyC,EAAS2xC,cAAc9tC,EAAW+M,EAAI0hC,EAAcvd,IAKtD/0B,EAAS6nC,YAAc,SAAU0K,EAASzK,EAAS/kC,GAEjDvD,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAAS+vC,IACjBliC,EAAM7N,KAAOslC,EACbtoC,QAAQwB,QAAQjB,EAAU4jB,iBAAkB,SAAU0a,EAAK9+B,GACrD8+B,EAAInO,iBAAmBqiB,GAAWlU,EAAIx6B,YAAc0uC,GACtDxyC,EAAU4jB,iBAAiBjN,MAAMnX,EAAG,KAGxCQ,EAAU4jB,iBAAiBriB,MACzB4uB,eAAgB4X,EAChBjkC,UAAWikC,IAGbtoC,QAAQwB,QAAQqP,EAAMC,MAAO,SAAUkc,GACrCA,EAAK/T,OAAO,GAAGjW,KAAOslC,OAK5BziC,EAAsBpF,KAAK6C,aAAaC,GAAmBmB,cAAcC,MAAMkB,EAAsBpF,KAAK6C,aAAaC,GAAmBmB,cAAcC,MAAMskB,QAAQ8pB,IAAYzK,GAKpL9nC,EAASioC,qBAAuB,SAAUzlC,EAAMoO,EAAI1R,EAAQ07B,GAC1D,GACI0T,GACA5hB,EAAG8lB,EAFH98B,EAAc3V,EAAUwQ,cAAc/N,EAG1CgwC,GAAc,EACdhzC,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GACpD,GAAIA,EAAM7N,OAASA,EAAM,CACvBgwC,EAAc5X,EAAez2B,KAC7B,KAAKuoB,IAAKkO,GAAeG,SACvB1qB,EAAMC,MAAM88B,OAAOoF,IAAe,EAAG5X,EAAeG,SAASrO,MAInE,IAAI+lB,GAAiBzyC,EAAS6zB,2BAA2BrxB,EAAMo4B,EAAeG,SAAS,GAAGnqB,GAAIgqB,EAAeG,SAASH,EAAeG,SAAS77B,OAAS,GAAG0R,GAC9HpP,UAAxBixC,EAAe/kB,MAA+ClsB,SAAzBixC,EAAe9kB,OACtD2gB,EAAWD,EAAY34B,EAAa+8B,EAAe/kB,KAAKjV,QACxDzY,EAAS2xC,cAAcnvC,EAAMiwC,EAAe/kB,KAAK9c,GAAI6hC,EAAe/kB,KAAKjV,OAAO61B,GAAUnsC,MAAOmsC,EAAUmE,EAAe/kB,KAAKpV,YAAam6B,EAAe/kB,KAAKnV,UAAYqiB,EAAe8X,YAC1JlxC,SAAxBixC,EAAe/kB,MAA+ClsB,SAAzBixC,EAAe9kB,OAC7D2gB,EAAWD,EAAY34B,EAAa+8B,EAAe9kB,MAAMlV,QACzDzY,EAAS2xC,cAAcnvC,EAAMiwC,EAAe9kB,MAAM/c,GAAI6hC,EAAe9kB,MAAMlV,OAAO61B,GAAUnsC,MAAOmsC,EAAUmE,EAAe9kB,MAAMrV,YAAcsiB,EAAe+X,SAAUF,EAAe9kB,MAAMpV,UAAYqiB,EAAe+X,WACxLnxC,SAAxBixC,EAAe/kB,MAA+ClsB,SAAzBixC,EAAe9kB,QAE7D2gB,EAAWD,EAAY34B,EAAa+8B,EAAe/kB,KAAKjV,QACxDzY,EAAS2xC,cAAcnvC,EAAMiwC,EAAe/kB,KAAK9c,GAAI6hC,EAAe/kB,KAAKjV,OAAO61B,GAAUnsC,MAAOmsC,EAAUmE,EAAe/kB,KAAKpV,YAAam6B,EAAe/kB,KAAKnV,UAAYqiB,EAAe+X,UAC3L3yC,EAAS2xC,cAAcnvC,EAAMiwC,EAAe9kB,MAAM/c,GAAI6hC,EAAe9kB,MAAMlV,OAAO61B,GAAUnsC,MAAOmsC,EAAUmE,EAAe9kB,MAAMrV,YAAcsiB,EAAe8X,UAAWD,EAAe9kB,MAAMpV,UAAYqiB,EAAe8X,aAM9N1yC,EAAS66B,eAAiB,SAAUr4B,EAAMoO,EAAI1R,GAY5C,IAAK,GAXD0zC,GAAe5yC,EAAS0yB,qBAAqBlwB,EAAMoO,GACnDiiC,EAAa7yC,EAAS2uC,aAAansC,EAAMoO,GACzCkiC,EAAc9yC,EAAS6vB,eAAertB,EAAMqwC,EAAa3zC,EAAS,GAClEo6B,EAAat5B,EAAS6zB,2BAA2BrxB,EAAMowC,EAAahiC,GAAIkiC,EAAYliC,IACpF+hC,EAAW,EACXD,EAAY,EACZK,EAAc,KACdnY,EAAiB,KACjBI,EAAW,KACXtlB,EAAc3V,EAAUwQ,cAAc/N,GACtC8rC,EAAWD,EAAY34B,EAAak9B,EAAan6B,QAC5ClZ,EAAIszC,EAAgBA,EAAa3zC,EAAjBK,EAAyBA,IAChDozC,GAAY3yC,EAAS6vB,eAAertB,EAAMjD,GAAGgZ,UAAY,CAiC3D,OA/BIo6B,GAAW,GAAK,GAClBA,GAAsB,EACtBD,EAAYC,IAEZA,EAAWl5B,KAAK6X,KAAKqhB,EAAW,GAChCD,EAAYC,EAAW,GAEzBnzC,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GACjBhD,QAAQwB,QAAQqP,EAAMC,MAAO,SAAU6hC,EAAKhuC,GACtCguC,EAAIvhC,IAAMA,IACZmiC,EAAc5uC,EACdy2B,EAAiBvqB,EAAMC,MAAM88B,OAAO2F,EAAa7zC,QAKjCsC,SAApB83B,EAAW5L,MAA2ClsB,SAArB83B,EAAW3L,OAC9C3tB,EAAS2xC,cAAcnvC,EAAM82B,EAAW5L,KAAK9c,GAAIpP,OAAW8sC,EAAUhV,EAAW5L,KAAKpV,YAAaghB,EAAW5L,KAAKnV,UAAYm6B,GAC/H1X,EAAW1B,EAAW5L,MACOlsB,SAApB83B,EAAW5L,MAA2ClsB,SAArB83B,EAAW3L,OACrD3tB,EAAS2xC,cAAcnvC,EAAM82B,EAAW3L,MAAM/c,GAAIpP,OAAW8sC,EAAUhV,EAAW3L,MAAMrV,YAAcq6B,EAAUrZ,EAAW3L,MAAMpV,UAAYo6B,GAC7I3X,EAAW1B,EAAW3L,OACOnsB,SAApB83B,EAAW5L,MAA2ClsB,SAArB83B,EAAW3L,MAErD5tB,EAAUsW,gBAAgB7U,OAAWA,OAAWA,SAEhDxB,EAAS2xC,cAAcnvC,EAAM82B,EAAW5L,KAAK9c,GAAIpP,OAAW8sC,EAAUhV,EAAW5L,KAAKpV,YAAaghB,EAAW5L,KAAKnV,UAAYo6B,GAC/H3yC,EAAS2xC,cAAcnvC,EAAM82B,EAAW3L,MAAM/c,GAAIpP,OAAW8sC,EAAUhV,EAAW3L,MAAMrV,YAAco6B,EAAWpZ,EAAW3L,MAAMpV,UAAYm6B,GAC9I1X,EAAW1B,EAAW5L,OAGtBvpB,MAAO4uC,EACPhY,SAAUH,EACV+X,SAAUA,EACVD,UAAWA,EACX1X,SAAUA,IAMdh7B,EAASsoC,oBAAsB,SAAU9lC,EAAMN,EAAOonB,EAAK0pB,GACzD,GACUC,GADNnxC,GAAM,CAiDV,OA/CAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAUzf,GACpD,GAAIA,EAAE9qB,OAASA,EACb,GAAIN,GAASonB,EAAK,CAChB,GAAI4pB,GAAa,EAOjB,IANA1zC,QAAQwB,QAAQssB,EAAEhd,MAAO,SAAU6hC,EAAKhuC,GAClCjC,GAASiwC,EAAI75B,cACf46B,EAAa/uC;AACbrC,GAAM,KAGNA,EAAK,CACP,GAAIqxC,GAAO,CACiB3xC,UAAxB8rB,EAAEhd,MAAM4iC,KACVC,EAAO7lB,EAAEhd,MAAM4iC,GAAY36B,UAAY,GAET/W,SAA5B8rB,EAAEhd,MAAM4iC,EAAa,KAEvB5lB,EAAEhd,MAAM4iC,EAAa,GAAG36B,WAAa46B,GAEvC7lB,EAAEhd,MAAM88B,OAAO8F,EAAY,QAExB,CACL,GAAIA,GAAa,EACjB1zC,SAAQwB,QAAQssB,EAAEhd,MAAO,SAAU6hC,EAAKhuC,GAClCjC,GAASiwC,EAAI75B,cACf46B,EAAa/uC,EACbrC,GAAM,KAGNA,IAC8BN,SAA5B8rB,EAAEhd,MAAM4iC,EAAa,GAEvB5lB,EAAEhd,MAAM88B,OAAO8F,EAAa,EAAG,GACM1xC,SAA5B8rB,EAAEhd,MAAM4iC,EAAa,GAE9B5lB,EAAEhd,MAAM88B,OAAO8F,EAAY,IAG3BC,EAAO7lB,EAAEhd,MAAM4iC,GAAY36B,UAAY,EACvC06B,EAAQ3lB,EAAEhd,MAAM4iC,EAAa,GAAG36B,UAAY,EAC5C+U,EAAEhd,MAAM4iC,EAAa,GAAG36B,WAAa46B,EAAOF,EAC5C3lB,EAAEhd,MAAM88B,OAAO8F,EAAY,QAM9BpxC,GAKT9B,EAAS85B,cAAgB,SAAUt3B,EAAMN,EAAOonB,EAAK0pB,EAAUhZ,GAC7D,GAAIl4B,IAAM,CA6FV,OA5FAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GACpD,GAAIA,EAAM7N,OAASA,EACjB,GAAIN,GAASonB,EAAK,CAChB,GAA0B,GAAtBjZ,EAAMC,MAAMpR,OAEd,OACE4C,KAAK,EACLk4B,IAAKA,EAIKx4B,UAARw4B,IACFA,KACAA,EAAI,GAAK5zB,EAAY4nC,WAEvB,IAAIoF,GAAU,EACd,IAAIlxC,EAAQmO,EAAMC,MAAM,GAAGgI,YAAa,CAEtC,GAAI66B,GAAO9iC,EAAMC,MAAM,GAAGgI,YAAcpW,CACxClC,GAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM,EAAGwwC,EAAU9wC,EAAOixC,EAAO,OAC/D,IAAIjxC,EAAQmO,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGoZ,YAAcjI,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGqZ,UAAW,CAElH,GAAI86B,GAAWhjC,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGoZ,YAAcjI,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGqZ,UAAY,CACjHvY,GAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM6N,EAAMC,MAAMpR,OAAQ8zC,EAAUK,EAAUnxC,EAAQmxC,OAazF,IAXA7zC,QAAQwB,QAAQqP,EAAMC,MAAO,SAAU6hC,EAAKvhC,GACtC1O,GAASiwC,EAAI75B,aAAepW,GAASiwC,EAAI75B,YAAc65B,EAAI55B,YAC7D66B,EAAUxiC,GAERuhC,EAAI75B,aAAepW,IACrBJ,GAAM,GAEJqwC,EAAI75B,YAAc65B,EAAI55B,UAAY,GAAKrW,IACzCJ,GAAM,KAGNA,EAAK,CACP,GAAIqxC,GAAOjxC,EAAQmO,EAAMC,MAAM8iC,GAAS96B,YAAc,CACtDtY,GAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM4wC,EAAU,EAAGJ,EAAU9wC,EAAOmO,EAAMC,MAAM8iC,GAAS76B,UAAY46B,EAAO,GAC/G9iC,EAAMC,MAAM8iC,GAAS76B,UAAY46B,OAUvC,IALY3xC,SAARw4B,IACFA,KACAA,EAAI,GAAK5zB,EAAY4nC,WACrBhU,EAAI,GAAK5zB,EAAY4nC,YAEG,GAAtB39B,EAAMC,MAAMpR,OAEdc,EAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM,EAAGwwC,EAAU9wC,EAAOonB,EAAMpnB,EAAQ,OAG3E,IAAIonB,EAAMjZ,EAAMC,MAAM,GAAGgI,YAAa,CAEpC,GAAI66B,GAAO9iC,EAAMC,MAAM,GAAGgI,YAAcgR,EAAM,EAC1C2pB,EAAQ3pB,EAAMpnB,EAAQ,CAC1BlC,GAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM,EAAGwwC,EAAU1pB,EAAK6pB,GAC3DnzC,EAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM,EAAGwwC,EAAU9wC,EAAO+wC,OACxD,IAAI/wC,EAAQmO,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGoZ,YAAcjI,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGqZ,UAAW,CAElH,GAAI46B,GAAOjxC,GAASmO,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGoZ,YAAcjI,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGqZ,WAAa,EACnH06B,EAAQ3pB,EAAMpnB,EAAQ,EACtB0N,EAAMS,EAAMC,MAAMpR,MACtBc,GAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAMoN,EAAKojC,EAAU3iC,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGoZ,YAAcjI,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,GAAGqZ,UAAW46B,GACzJnzC,EAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAMoN,EAAM,EAAGojC,EAAU9wC,EAAO+wC,OAC9D,CAEL,GAAIG,GAAU,GACVE,EAAQ,EAUZ,IATA9zC,QAAQwB,QAAQqP,EAAMC,MAAO,SAAU6hC,EAAKvhC,GACtC1O,GAASiwC,EAAI75B,aAAepW,GAASiwC,EAAI75B,YAAc65B,EAAI55B,YAC7D66B,EAAUxiC,GAER0Y,GAAO6oB,EAAI75B,aAAegR,GAAO6oB,EAAI75B,YAAc65B,EAAI55B,YACzD+6B,EAAQ1iC,KAGZ9O,EAAMsxC,IAAYE,EACdxxC,GAAmB,KAAZsxC,EAAgB,CACzB,GAAID,GAAOjxC,EAAQmO,EAAMC,MAAM8iC,GAAS96B,YAAc,EAClD26B,EAAQ3pB,EAAMpnB,EAAQ,CAC1BlC,GAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM4wC,EAAU,EAAGJ,EAAU9wC,EAAO+wC,GACvEjzC,EAASuxC,kBAAkBvX,EAAI,GAAIx3B,EAAM4wC,EAAU,EAAGJ,EAAU1pB,EAAKjZ,EAAMC,MAAM8iC,GAAS76B,UAAY46B,EAAO,EAAIF,EAAQ,GACzH5iC,EAAMC,MAAM8iC,GAAS76B,UAAY46B,OAQ3CrxC,IAAKA,EACLk4B,IAAKA,IAMTh6B,EAASo6B,YAAc,SAAU53B,EAAMN,EAAOq4B,EAAW3pB,GACvD,GACI0pB,IAAgB,EAChBhF,EAAM9zB,OACN+xC,EAAO/xC,MAwBX,OAvBAhC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,GAAuB,UAAf6N,EAAM1G,OAE7B4pC,EADEljC,EAAMC,MAAMpR,OAAS,EAChBmR,EAAMC,MAAM,GAAGkJ,YAEf,EAETha,QAAQwB,QAAQqP,EAAMC,MAAO,SAAU6hC,EAAKhuC,GACtCsV,KAAKwP,MAAM/mB,KAAWuX,KAAKwP,MAAMkpB,EAAI34B,eACvC8gB,GAAgB,GAEdp4B,EAAQiwC,EAAI34B,cACd8b,EAAMnxB,EAAQ,QAKjBm2B,IACQ94B,SAAPoP,IACFA,EAAKxK,EAAY4nC,YAEnBhuC,EAASuxC,kBAAkB3gC,EAAIpO,EAAM8yB,EAAKiF,EAAWr4B,KAGrDo4B,cAAeA,EACf1pB,GAAIA,IAMR5Q,EAASs7B,YAAc,SAAU94B,EAAMoO,GACrC,GAAI9O,IAAM,CAcV,OAbAtC,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAUzf,GACpD,GAAIA,EAAE9qB,OAASA,GAAkB,SAAV8qB,EAAE3jB,KAAiB,CAExCnK,QAAQwB,QAAQssB,EAAEhd,MAAO,SAAU6hC,EAAKhuC,GACjCrC,GACC8O,GAAMuhC,EAAIvhC,KACZ9O,EAAMqwC,EACN7kB,EAAEhd,MAAM88B,OAAOjpC,EAAO,SAMzBrC,GAQT9B,EAASk7B,eAAiB,SAAU14B,EAAMoO,EAAIoJ,EAASE,GACrD,GAAIs5B,GAAWxzC,EAAS0yB,qBAAqBlwB,EAAMoO,GAC/C2iC,EAAO,KACPE,EAAW,KACXC,EAAS,KACT1Y,EAAW,IAoCf,OAnCAx7B,SAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GAChDA,EAAM7N,OAASA,IACjB+wC,EAAOljC,EAAMC,MAAM,GACnB9Q,QAAQwB,QAAQqP,EAAMC,MAAO,SAAU6hC,EAAKhuC,GAC1C,GAAmB,YAAfkM,EAAM1G,MACJ6pC,EAASl7B,aAAe65B,EAAI75B,aAAek7B,EAASj7B,WAAa45B,EAAI55B,UACvE,GAAc,IAAVpU,GAAe6V,EACjB3J,EAAMC,MAAM88B,OAAOjpC,EAAO,GAC1BsvC,EAAWtvC,EACXuvC,EAASvB,EACTnX,EAAW3qB,EAAMC,MAAM,OAClB,IAAInM,IAAUkM,EAAMC,MAAMpR,OAAS,GAAKgb,EAC7C7J,EAAMC,MAAM88B,OAAOjpC,EAAO,GAC1BsvC,EAAWtvC,EACXuvC,EAASvB,EACTnX,EAAW3qB,EAAMC,MAAMD,EAAMC,MAAMpR,OAAS,OACvC,CACL,IAAK,GAAIK,GAAI,EAAGA,EAAIg0C,EAAK96B,OAAOvZ,OAAQK,IACtCg0C,EAAK96B,OAAOlZ,GAAG4C,OAASgwC,EAAI15B,OAAOlZ,GAAG4C,KAExCoxC,GAAKh7B,WAAa45B,EAAI55B,UAAY,EAClClI,EAAMC,MAAM88B,OAAOjpC,EAAO,GAC1BsvC,EAAWtvC,EACXuvC,EAASvB,EACTnX,EAAWuY,EAIjBA,EAAOpB,IAEO,MAAZnX,IACFA,EAAW3qB,EAAMC,MAAM,QAK3BnM,MAAOsvC,EACPxqC,MAAOyqC,EACP1Y,SAAUA,IASdh7B,EAASgoC,qBAAuB,SAAUxlC,EAAMoO,EAAIoJ,EAASE,EAAQ0gB,GACnEp7B,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAU18B,GACpD,GAAIA,EAAM7N,OAASA,EAAM,CACvB6N,EAAMC,MAAM88B,OAAOxS,EAAez2B,MAAO,EAAGy2B,EAAe3xB,MAC3D,IAAI0qC,GAAU/Y,EAAe3xB,MAAMwP,OAAO,GAAGtW,KACxC6X,IAAYE,IACfy5B,EAAUtjC,EAAMC,MAAMsqB,EAAez2B,MAAQ,GAAGsU,OAAO,GAAGtW,MAAMuU,MAAM,EAAGrG,EAAMC,MAAMsqB,EAAez2B,MAAQ,GAAGsU,OAAO,GAAGtW,MAAMjD,OAAS07B,EAAe3xB,MAAMwP,OAAO,GAAGtW,MAAMjD,QAC7KmR,EAAMC,MAAMsqB,EAAez2B,MAAQ,GAAGsU,OAAO,GAAGtW,MAAQwxC,EACxDtjC,EAAMC,MAAMsqB,EAAez2B,MAAQ,GAAGoU,WAAaqiB,EAAe3xB,MAAMsP,UAAY,OAQ5FvY,EAASi4B,aAAe,SAAU2b,EAAO/vC,EAAW+rC,EAAS7X,EAAUpuB,GACrE,GAAIkqC,GAGAC,EAEAplB,EACAqlB,EAJAC,EAAa1O,EAAAA,EAEbtN,EAAUx2B,MAqCd,OAlCY,WAARmI,EACF+kB,EAASkhB,EAAQt3B,YACA,SAAR3O,IACT+kB,EAASkhB,EAAQp2B,aAEnBha,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAUkH,EAAQC,GAC5D,GAAID,EAAOzxC,OAASqB,EAAW,CAC7B,GAAI+vC,EAAO,CACT,KAAIM,GAAQ,GAGV,OAAO,CAFPL,GAAUztC,EAAY2mC,eAAemH,EAAO,OAIzC,CACL,KAAIA,EAAO9tC,EAAY2mC,eAAe7tC,OAAS,GAG7C,OAAO,CAFP20C,GAAUztC,EAAY2mC,eAAemH,EAAO,GAKhDL,EAAQvjC,MAAMtP,QAAQ,SAAUK,EAAK8C,GACf,WAAhB0vC,EAAQlqC,KACVoqC,EAAe1yC,EAAIiX,YACM,SAAhBu7B,EAAQlqC,OACjBoqC,EAAe1yC,EAAImY,aAErBs6B,EAAUr6B,KAAK6V,IAAIZ,EAASqlB,GACdC,EAAVF,IACFE,EAAaF,EACb9b,EAAU+b,EAAerlB,QAKjBltB,SAAZw2B,GACU,WAARruB,EACFrL,KAAK20B,aAAapvB,EAAW+rC,EAAQh/B,GAAIonB,EAAS,GACjC,SAARruB,GACTrL,KAAK60B,UAAUtvB,EAAW+rC,EAAQh/B,GAAIonB,GAEjCA,IAEA,GAaXh4B,EAASizB,aAAe,SAAUpvB,EAAW+M,EAAI4nB,EAAYxe,EAASE,GACpE,GAAIi6B,GAAOn0C,EAAS0yB,qBAAqB7uB,EAAW+M,GAChD8E,EAAc3V,EAAUwQ,cAAc1M,GACtCyqC,EAAWD,EAAY34B,EAAay+B,EAAK17B,QACzC27B,EAAKp0C,EAAS6zB,2BAA2BhwB,EAAW+M,EAAIA,EAC5D,IAAIoJ,EAAS,CAEX,GAAIq6B,GAAYD,EAAGzmB,KACDnsB,UAAd6yC,EACEF,EAAK77B,YAAckgB,GAAc,GAAK2b,EAAK77B,YAAckgB,EAAa6b,EAAU/7B,aAClFtY,EAAS2xC,cAAc9tC,EAAWswC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,UAAYigB,GAG9G2b,EAAK77B,YAAckgB,GAAc,GAAK2b,EAAK57B,UAAYigB,GAAc,GAAK2b,EAAK77B,YAAc67B,EAAK57B,UAAYigB,GAAcpzB,EAAoBmG,OAAOI,KAAKzM,QAC9Jc,EAAS2xC,cAAc9tC,EAAWswC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,UAAYigB,OAG/G,IAAIte,EAELi6B,EAAK57B,UAAYigB,GAAc,GAAK2b,EAAK57B,UAAY47B,EAAK77B,YAAckgB,GAAcpzB,EAAoBmG,OAAOI,KAAKzM,QACxHc,EAAS2xC,cAAc9tC,EAAWswC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAa67B,EAAK57B,UAAYigB,OAGrG,IAAgBh3B,SAAZ4yC,EAAG1mB,KAAoB,CACzB,GAAI2mB,GAAYD,EAAGzmB,KACDnsB,UAAd6yC,EACEF,EAAK77B,YAAckgB,GAAc,GAAK2b,EAAK77B,YAAckgB,EAAa6b,EAAU/7B,aAClFtY,EAAS2xC,cAAc9tC,EAAWswC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,UAAYigB,GAG9G2b,EAAK77B,YAAckgB,GAAc,GAAK2b,EAAK77B,YAAc67B,EAAK57B,UAAYigB,GAAcpzB,EAAoBmG,OAAOI,KAAKzM,QAC1Hc,EAAS2xC,cAAc9tC,EAAWswC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,UAAYigB,OAG/G,CACL,GAAI8b,GAAWF,EAAG1mB,IACd4mB,GAAS/7B,UAAYigB,GAAc,GAAK2b,EAAK77B,YAAckgB,GAAc,GAAK2b,EAAK57B,UAAYigB,GAAc,IAC/Gx4B,EAAS2xC,cAAc9tC,EAAWuwC,EAAG1mB,KAAK9c,GAAIpP,OAAW8sC,EAAUgG,EAASh8B,YAAag8B,EAAS/7B,UAAYigB,GAC9Gx4B,EAAS2xC,cAAc9tC,EAAWswC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,UAAYigB,MAQxHx4B,EAASmzB,UAAY,SAAU3wB,EAAMoO,EAAI4nB,GACvC,GAAI2b,GAAOn0C,EAAS0yB,qBAAqBlwB,EAAMoO,GAC3C8E,EAAc3V,EAAUwQ,cAAc/N,GACtC8rC,EAAWD,EAAY34B,EAAay+B,EAAK17B,OAC7C,IAAIsb,EAAYwgB,SAAS3jC,GAAK,CAC5B,GAAI6b,GAAYzsB,EAAS6zB,2BAA2BrxB,EAAMoO,EAAIA,EAC1DujC,GAAK36B,YAAcgf,EAAa,GAAK2b,EAAK36B,YAAcgf,GAAcpzB,EAAoBmG,OAAOI,KAAKzM,SAEjFsC,SAAnBirB,EAAUiB,MAA0ClsB,SAApBirB,EAAUkB,MAGxCwmB,EAAK36B,YAAcgf,EAAa/L,EAAUiB,KAAKlU,aAAe26B,EAAK36B,YAAcgf,EAAa/L,EAAUkB,MAAMnU,aAChHxZ,EAAS4xC,YAAYpvC,EAAM2xC,EAAKvjC,GAAIujC,EAAK17B,OAAO,GAAGtW,MAAOmsC,EAAU6F,EAAK36B,YAAcgf,GAE7Dh3B,SAAnBirB,EAAUiB,MAA0ClsB,SAApBirB,EAAUkB,MAGnD3tB,EAAS4xC,YAAYpvC,EAAM2xC,EAAKvjC,GAAIujC,EAAK17B,OAAO,GAAGtW,MAAOmsC,EAAU6F,EAAK36B,YAAcgf,GAC3Dh3B,SAAnBirB,EAAUiB,MAA0ClsB,SAApBirB,EAAUkB,MAG/CwmB,EAAK36B,YAAcgf,EAAa,GAAK2b,EAAK36B,YAAcgf,EAAa/L,EAAUkB,MAAMnU,aACvFxZ,EAAS4xC,YAAYpvC,EAAM2xC,EAAKvjC,GAAIujC,EAAK17B,OAAO,GAAGtW,MAAOmsC,EAAU6F,EAAK36B,YAAcgf,GAE7Dh3B,SAAnBirB,EAAUiB,MAA0ClsB,SAApBirB,EAAUkB,OAG/CwmB,EAAK36B,YAAcgf,EAAa/L,EAAUiB,KAAKlU,aAAe26B,EAAK36B,YAAcgf,GAAcpzB,EAAoBmG,OAAOI,KAAKzM,QACjIc,EAAS4xC,YAAYpvC,EAAM2xC,EAAKvjC,GAAIujC,EAAK17B,OAAO,GAAGtW,MAAOmsC,EAAU6F,EAAK36B,YAAcgf,QAMzF2b,GAAK36B,YAAcgf,EAAa,GAAK2b,EAAK36B,YAAcgf,GAAcpzB,EAAoBmG,OAAOI,KAAKzM,QACxGc,EAAS4xC,YAAYpvC,EAAM2xC,EAAKvjC,GAAIujC,EAAK17B,OAAO,GAAGtW,MAAOmsC,EAAU6F,EAAK36B,YAAcgf,GAGzFh5B,QAAQwB,QAAQoF,EAAY2mC,eAAgB,SAAUzf,GAChDA,EAAE9qB,OAASA,GACb8qB,EAAEhd,MAAMid,KAAKxtB,EAAUytB,gBAS/BxtB,EAASw0C,YAAc,SAAU9wC,EAAGglB,GAElC,MAAIhlB,GAAE8V,YAAckP,EAAElP,YACb,EACL9V,EAAE8V,YAAckP,EAAElP,YACb,GACF,GAKTxZ,EAASqzB,YAAc,SAAU7wB,EAAMoO,EAAI1R,EAAQs5B,GACjD,GAAIqa,GAAa7yC,EAAS2uC,aAAansC,EAAMoO,GACzCgiC,EAAe5yC,EAAS6vB,eAAertB,EAAMqwC,GAC7CC,EAAc9yC,EAAS6vB,eAAertB,EAAMqwC,EAAa3zC,EAAS,EACtE,IAAqB,OAAjB0zC,GAAyC,OAAhBE,EAAsB,CACjD,GAAIL,GAAiBzyC,EAAS6zB,2BAA2BrxB,EAAMowC,EAAahiC,GAAIkiC,EAAYliC,IACxF8E,EAAc3V,EAAUwQ,cAAc/N,GACtC8rC,EAAWD,EAAY34B,EAAak9B,EAAan6B,OACrD,IAA4BjX,SAAxBixC,EAAe/kB,MAA+ClsB,SAAzBixC,EAAe9kB,MAAqB,CAC3E,GAAIA,GAAQ3tB,EAAS0yB,qBAAqBlwB,EAAMiwC,EAAe9kB,MAAM/c,GACrE,IAAIgiC,EAAat6B,YAAckgB,EAAa,GAAKia,EAAe9kB,MAAMpV,UAAYigB,GAAc,EAAG,CACjGx4B,EAAS2xC,cAAcnvC,EAAMmrB,EAAM/c,GAAIpP,OAAW8sC,EAAU3gB,EAAMrV,YAAckgB,EAAY7K,EAAMpV,UAAYigB,EAC9G,KAAK,GAAIj5B,GAAIszC,EAAgBA,EAAa3zC,EAAjBK,EAAyBA,IAAK,CACrD,GAAI40C,GAAOn0C,EAAS6vB,eAAertB,EAAMjD,EACzCS,GAAS2xC,cAAcnvC,EAAM2xC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,iBAG9F,IAA6B/W,SAAzBixC,EAAe9kB,OAA+CnsB,SAAxBixC,EAAe/kB,KAAoB,CAClF,GAAIA,GAAO1tB,EAAS0yB,qBAAqBlwB,EAAMiwC,EAAe/kB,KAAK9c,GACnE,IAAI6hC,EAAe/kB,KAAKnV,UAAYigB,GAAc,GAC5Csa,EAAYx6B,YAAcw6B,EAAYv6B,UAAYigB,EAAapzB,EAAoBmG,OAAOI,KAAKzM,OAAQ,CACzGc,EAAS2xC,cAAcnvC,EAAMkrB,EAAK9c,GAAIpP,OAAW8sC,EAAU5gB,EAAKpV,YAAaoV,EAAKnV,UAAYigB,EAC9F,KAAK,GAAIj5B,GAAIszC,EAAgBA,EAAa3zC,EAAjBK,EAAyBA,IAAK,CACrD,GAAI40C,GAAOn0C,EAAS6vB,eAAertB,EAAMjD,EACzCS,GAAS2xC,cAAcnvC,EAAM2xC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,iBAIhG,IAA6B/W,SAAzBixC,EAAe9kB,OAA+CnsB,SAAxBixC,EAAe/kB,KAAoB,CAClF,GAAI4mB,GAAWt0C,EAAS0yB,qBAAqBlwB,EAAMiwC,EAAe/kB,KAAK9c,IACnEyjC,EAAYr0C,EAAS0yB,qBAAqBlwB,EAAMiwC,EAAe9kB,MAAM/c,GACzE,IAAI0jC,EAAS/7B,UAAYigB,GAAc,GAAK6b,EAAU97B,UAAYigB,GAAc,EAAG,CACjFx4B,EAAS2xC,cAAcnvC,EAAM8xC,EAAS1jC,GAAIpP,OAAW8sC,EAAUgG,EAASh8B,YAAag8B,EAAS/7B,UAAYigB,GAC1Gx4B,EAAS2xC,cAAcnvC,EAAM6xC,EAAUzjC,GAAIpP,OAAW8sC,EAAU+F,EAAU/7B,YAAckgB,EAAY6b,EAAU97B,UAAYigB,EAC1H,KAAK,GAAIj5B,GAAIszC,EAAgBA,EAAa3zC,EAAjBK,EAAyBA,IAAK,CACrD,GAAI40C,GAAOn0C,EAAS6vB,eAAertB,EAAMjD,EACzCS,GAAS2xC,cAAcnvC,EAAM2xC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,iBAG9F,IAA6B/W,SAAzBixC,EAAe9kB,OAA+CnsB,SAAxBixC,EAAe/kB,KAAoB,CAClF,GAAI+mB,GAAQz0C,EAAS6vB,eAAertB,EAAMqwC,GACtCU,EAAOvzC,EAAS6vB,eAAertB,EAAMqwC,EAAa3zC,EAAS,EAC/D,IAAIu1C,EAAMn8B,YAAckgB,EAAa,GAAK+a,EAAKh7B,UAAYg7B,EAAKj7B,YAAckgB,EAAapzB,EAAoBmG,OAAOI,KAAKzM,OACzH,IAAK,GAAIK,GAAIszC,EAAgBA,EAAa3zC,EAAjBK,EAAyBA,IAAK,CACrD,GAAI40C,GAAOn0C,EAAS6vB,eAAertB,EAAMjD,EACzCS,GAAS2xC,cAAcnvC,EAAM2xC,EAAKvjC,GAAIpP,OAAW8sC,EAAU6F,EAAK77B,YAAckgB,EAAY2b,EAAK57B,eASzGvY,EAAS44B,cAAgB,SAAUC,EAAWkC,EAAUv4B,EAAMg2B,GAC5D,GAKIkc,GALA1T,EAAY,EACZ1H,EAAat5B,EAAS6zB,2BAA2BrxB,EAAMu4B,EAAS,GAAGnqB,GAAImqB,EAASA,EAAS77B,OAAS,GAAG0R,IAErG8E,GADU8iB,EAAauC,EAAS77B,OAClBa,EAAUwQ,cAAc/N,IACtC8rC,EAAWD,EAAY34B,EAAaqlB,EAAS,GAAGtiB,QAEhDk8B,GAAQ,CACZ,IAAI9b,EAEF,GAAyBr3B,SAArB83B,EAAW3L,MAAqB,CAElC,GAAIinB,GAAa7Z,EAASA,EAAS77B,OAAS,GAAGoZ,YAAcyiB,EAASA,EAAS77B,OAAS,GAAGqZ,UAAYigB,EAAauC,EAAS77B,MACzH01C,IAAcxvC,EAAoBmG,OAAOI,KAAKzM,QAChDM,QAAQwB,QAAQ+5B,EAAU,SAAUpL,GAClC+kB,EAAW10C,EAAS0yB,qBAAqBlwB,EAAMmtB,EAAI/e,IACnD5Q,EAAS2xC,cAAcnvC,EAAMkyC,EAAS9jC,GAAIpP,OAAW8sC,EAAUoG,EAASp8B,YAAc0oB,EAAW0T,EAASn8B,UAAYigB,GACtHwI,GAAaxI,QAIjBh5B,SAAQwB,QAAQ+5B,EAAU,SAAUpL,GAC9BA,EAAIpX,UAAY,EAAIigB,EAAa,IACnCmc,GAAQ,KAGRA,GAASrb,EAAW3L,MAAMpV,UAAYigB,EAAauC,EAAS77B,OAAS,IACvEM,QAAQwB,QAAQ+5B,EAAU,SAAUpL,GAClC+kB,EAAW10C,EAAS0yB,qBAAqBlwB,EAAMmtB,EAAI/e,IACnD5Q,EAAS2xC,cAAcnvC,EAAMkyC,EAAS9jC,GAAIpP,OAAW8sC,EAAUoG,EAASp8B,YAAc0oB,EAAW0T,EAASn8B,UAAYigB,GACtHwI,GAAaxI,IAEfx4B,EAAS2xC,cAAcnvC,EAAM82B,EAAW3L,MAAM/c,GAAIpP,OAAW8sC,EAAUhV,EAAW3L,MAAMrV,YAAc0oB,EAAW1H,EAAW3L,MAAMpV,UAAYyoB,QAKlJ,IAAwBx/B,SAApB83B,EAAW5L,KAAoB,CAEjC,GAAI+mB,GAAQz0C,EAAS6vB,eAAertB,EAAM,EACtCiyC,GAAMn8B,YAAckgB,GAAcuC,EAAS77B,OAAS,GAAK,GAC3DM,QAAQwB,QAAQ+5B,EAAU,SAAUpL,GAClC+kB,EAAW10C,EAAS0yB,qBAAqBlwB,EAAMmtB,EAAI/e,IACnD5Q,EAAS2xC,cAAcnvC,EAAMkyC,EAAS9jC,GAAIpP,OAAWkzC,EAASp8B,YAAckgB,EAAY8V,EAAUoG,EAASn8B,UAAYigB,SAI3Hh5B,SAAQwB,QAAQ+5B,EAAU,SAAUpL,GAC9BA,EAAIpX,UAAY,EAAIigB,EAAa,IACnCmc,GAAQ,KAGRA,GAASrb,EAAW5L,KAAKnV,UAAYigB,EAAauC,EAAS77B,OAAS,IACtE8hC,EAAY,EACZxhC,QAAQwB,QAAQ+5B,EAAU,SAAUpL,EAAKpwB,GACvCm1C,EAAW10C,EAAS0yB,qBAAqBlwB,EAAMmtB,EAAI/e,IACnDowB,IAAcjG,EAAS77B,OAASK,GAAKi5B,EACrCx4B,EAAS2xC,cAAcnvC,EAAMkyC,EAAS9jC,GAAIpP,OAAW8sC,EAAUoG,EAASp8B,YAAc0oB,EAAW0T,EAASn8B,UAAYigB,KAExHx4B,EAAS2xC,cAAcnvC,EAAM82B,EAAW5L,KAAK9c,GAAIpP,OAAW8sC,EAAUhV,EAAW5L,KAAKpV,YAAaghB,EAAW5L,KAAKnV,UAAYwiB,EAAS77B,OAASs5B,KAQzJx4B,EAASq4B,kCAAoC,SAAU3J,GAIrD,IAAK,GAFDmmB,GAAYvP,EAAAA,EACZwP,EAAWxP,EAAAA,EACN/lC,EAAImvB,EAAQnvB,EAAI6F,EAAoBmG,OAAOI,KAAKzM,OAAS,EAAGK,IACnE,GAAI6F,EAAoBmG,OAAOI,KAAKpM,IAAM,GAAK6F,EAAoBmG,OAAOI,KAAKpM,EAAI,GAAK,GAAK6F,EAAoBmG,OAAOI,KAAKpM,GAAK,GAAK6F,EAAoBmG,OAAOI,KAAKpM,EAAI,IAAM,EAAG,CAClLs1C,EAAYt1C,EAAImvB,CAChB,OAIJ,IAAK,GAAInvB,GAAImvB,EAAQnvB,EAAI,EAAGA,IAC1B,GAAI6F,EAAoBmG,OAAOI,KAAKpM,IAAM,GAAK6F,EAAoBmG,OAAOI,KAAKpM,EAAI,GAAK,GAAK6F,EAAoBmG,OAAOI,KAAKpM,GAAK,GAAK6F,EAAoBmG,OAAOI,KAAKpM,EAAI,IAAM,EAAG,CAClLu1C,EAAWv1C,EAAImvB,CACf,OAGJ,GAAIjsB,EAMJ,OAJEA,GADEgX,KAAK6V,IAAIwlB,GAAYr7B,KAAK6V,IAAIulB,GAC1BC,EAEAD,EAAY,GAYtB70C,EAAS6oC,YAAc,SAAUhlC,EAAW+M,GAC1C,GAAIP,GAAQrQ,EAASuqB,gBAAgB1mB,EAIrC,IAHApC,QAAQszC,MAAMlxC,EAAWwM,EAAOO,GAGb,SAAfP,EAAM1G,KAAiB,CAEzB,GAAkB,gBAAPiH,GACT,GAAIokC,IACApkC,GAAIA,EACJ6H,eAGJ,IAAIu8B,IACApkC,GAAIxK,EAAY4nC,WAChBv1B,UAKN,KAAK,GADDi5B,GAAWrsC,EAAsBzB,mBAAmByM,EAAM7N,MAAM8J,qBAC3D/M,EAAI,EAAGA,EAAImyC,EAASxyC,SAAUK,EACZ,WAArBmyC,EAASnyC,GAAGoK,KACdqrC,EAAUv8B,OAAOnX,MACfkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAO,KAGT6yC,EAAUv8B,OAAOnX,MACfkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAO,MAMb,OADAkO,GAAMC,MAAMhP,KAAK0zC,GACVA,EAAUpkC,GAEjB,MAAO,IAcX5Q,EAASi2B,QAAU,SAAUgf,EAAK9e,EAAQH,GAExC,GAAYx0B,SAARyzC,EACF,MAAO,EAET,IAAsB,iBAAX9e,GACT,MAAO,EAGT,IAAI+e,GAAel1C,EAASwvC,gBAAgByF,EAC5C,IAAqB,OAAjBC,EAEF,MADAzzC,SAAQszC,MAAM,+BAAgCE,GACvC,EAET,IAAI5kC,GAAQ6kC,EAAa7kC,MACrBmc,EAAO0oB,EAAa1oB,IAGxB,IAAmB,SAAfnc,EAAM1G,KAAiB,CAGzB,GACIwrC,GADAC,EAAS/kC,EAAMC,MAAMmY,QAAQ+D,EAQjC,IALE2oB,EADEhf,KAAW,EACJif,EAEAA,EAAS,EAGN5zC,SAAVw0B,EACF,GAAIgf,IACApkC,GAAIxK,EAAY4nC,WAChBv1B,eAGJ,IAAIu8B,IACApkC,GAAIolB,EACJvd,UAKN,KAAK,GADDi5B,GAAWrsC,EAAsBzB,mBAAmByM,EAAM7N,MAAM8J,qBAC3D/M,EAAI,EAAGA,EAAImyC,EAASxyC,SAAUK,EACZ,WAArBmyC,EAASnyC,GAAGoK,KACdqrC,EAAUv8B,OAAOnX,MACfkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAO,KAGT6yC,EAAUv8B,OAAOnX,MACfkB,KAAMkvC,EAASnyC,GAAGiD,KAClBL,MAAO,MAMb,OADAkO,GAAMC,MAAM88B,OAAO+H,EAAQ,EAAGH,GACvBA,EAAUpkC,GAEnB,MAAO,IAOT5Q,EAAS2oC,cAAgB,SAAU/3B,GAEjC,IAAK,GADDxE,GAAShG,EAAY2mC,eAChBxtC,EAAI,EAAGA,EAAI6M,EAAOlN,SAAUK,EACnC,IAAK,GAAI81C,GAAK,EAAGA,EAAKjpC,EAAO7M,GAAG+Q,MAAMpR,SAAUm2C,EAC9C,GAAIjpC,EAAO7M,GAAG+Q,MAAM+kC,GAAIzkC,KAAOA,EAE7B,WADAxE,GAAO7M,GAAG+Q,MAAM88B,OAAOiI,EAAI,IAanCr1C,EAAS61B,oBAAsB,SAAUjlB,GACvC,GAAIglB,IACApJ,KAAMhrB,OACNqC,UAAWrC,OACXk0B,SAAUl0B,OACVs0B,iBAEAof,EAAel1C,EAASwvC,gBAAgB5+B,EAC5C,IAAqB,OAAjBskC,EAEF,MAAOtf,EAET,IAAIvlB,GAAQ6kC,EAAa7kC,MACrBmc,EAAO0oB,EAAa1oB,IACxB,IAAmB,SAAfnc,EAAM1G,KAER,MAAOisB,EAGTn0B,SAAQ2zB,IAAI,iBAAkB5I,EAAM,cAAenc,GACnDulB,EAAOpJ,KAAOA,EACdoJ,EAAO/xB,UAAYwM,EAAM7N,KACzBozB,EAAOF,SAAWrlB,EAAMC,MAAMmY,QAAQ+D,GACtCnc,EAAMC,MAAM88B,OAAO/8B,EAAMC,MAAMmY,QAAQ+D,GAAO,EAI9C,KAAK,GADD+gB,GAAQnnC,EAAYknC,cACf/tC,EAAIguC,EAAMruC,OAAS,EAAGK,GAAK,IAAKA,GACnCguC,EAAMhuC,GAAGi2B,SAAW5kB,GAAM28B,EAAMhuC,GAAGk2B,OAAS7kB,KAC9CnP,QAAQ2zB,IAAI,gBAAiB71B,GAC7Bq2B,EAAOE,aAAax0B,KAAKisC,EAAMhuC,IAC/BguC,EAAMH,OAAO7tC,EAAG,GAGpB,OAAOq2B,IAKT51B,EAAS0oC,0BAA4B,SAAUlc,EAAM3oB,EAAW6xB,EAAUI,GAExE91B,EAASuqB,gBAAgB1mB,GAAWyM,MAAM88B,OAAO1X,EAAU,EAAGlJ,EAE9D,KAAK,GAAIjtB,GAAI,EAAGA,EAAIu2B,EAAa52B,SAAUK,EACzC6G,EAAYqnC,eAAe3X,EAAav2B,KAGrCS,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,eAClC,cACA,SAAqBuG,GAEnB,GAAIpG,KA2UJ,OApUAA,GAAS4oC,WAAa,SAAUpT,EAAQC,GACtCrvB,EAAYqnC,gBACVjY,OAAUA,EACVC,KAAQA,KAWZz1B,EAASyoC,aAAe,SAAUjT,EAAQC,EAAMtxB,GAC9CiC,EAAYwnC,iBAAiBzpC,GAC3BqxB,OAAUA,EACVC,KAAQA,KAOZz1B,EAASu1B,WAAa,SAAUC,EAAQC,GACtC,GAAI3zB,GAAM,EAQV,OAPAtC,SAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAMghC,GACrDhhC,EAAKkhB,SAAWA,GAAUlhB,EAAKmhB,OAASA,IAC1CrvB,EAAYunC,iBAAiB2H,GAC7BxzC,EAAMwzC,KAIHxzC,GAMT9B,EAASu1C,WAAa,SAAU/f,EAAQC,GACtC,GAAI3zB,IAAM,CAOV,OANAtC,SAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAMghC,GACrDhhC,EAAKkhB,SAAWA,GAAUlhB,EAAKmhB,OAASA,IAC1C3zB,GAAM,KAIHA,GAMT9B,EAASw1C,WAAa,SAAUC,GAC9B,GAAI3zC,IAAM,CAOV,OANAtC,SAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAMghC,GACrDhhC,EAAKmhB,OAASggB,IAChB3zC,GAAM,KAIHA,GAMT9B,EAAS01C,YAAc,SAAUD,GAC/B,GAAI3zC,IAAM,CAOV,OANAtC,SAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAMghC,GACrDhhC,EAAKkhB,SAAWigB,IAClB3zC,GAAM,KAIHA,GAMT9B,EAASu0C,SAAW,SAAUkB,GAC5B,MAAOz1C,GAAS01C,YAAYD,IAAOz1C,EAASw1C,WAAWC,IAOzDz1C,EAASkoC,cAAgB,SAAU1S,EAAQmgB,GACzCn2C,QAAQwB,QAAQ20C,EAAO,SAAUlgB,GAC/Bz1B,EAAS4oC,WAAWpT,EAAQC,MAOhCz1B,EAASmoC,cAAgB,SAAU3S,EAAQmgB,GACzC,GAAI7zC,KAQJ,OAPAtC,SAAQwB,QAAQ20C,EAAO,SAAUlgB,GAC/Bz1B,EAASu1B,WAAWC,EAAQC,GAC5B3zB,EAAIR,MACFk0B,OAAQA,EACRC,KAAMA,MAGH3zB,GAOT9B,EAAS41C,gBAAkB,SAAUC,EAASpgB,GAC5Cj2B,QAAQwB,QAAQ60C,EAAS,SAAUrgB,GACjCx1B,EAAS4oC,WAAWpT,EAAQC,MAOhCz1B,EAAS81C,gBAAkB,SAAUD,EAASpgB,GAC5C,GAAI3zB,KAQJ,OAPAtC,SAAQwB,QAAQ60C,EAAS,SAAUrgB,GACjC1zB,EAAIR,MACFk0B,OAAQA,EACRC,KAAMA,IAERz1B,EAASu1B,WAAWC,EAAQC,KAEvB3zB,GAMT9B,EAAS+1C,WAAa,SAAUtgB,GAC9B,GAAI3zB,KASJ,OARAtC,SAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAM0hC,GACrD1hC,EAAKmhB,OAASA,GAChB3zB,EAAIR,MACFgT,KAAMA,EACNnQ,MAAO6xC,MAINl0C,GAMT9B,EAASi2C,aAAe,SAAUzgB,GAChC,GAAI1zB,KASJ,OARAtC,SAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAM0hC,GACrD1hC,EAAKkhB,SAAWA,GAClB1zB,EAAIR,MACFgT,KAAMA,EACNnQ,MAAO6xC,MAINl0C,GAMT9B,EAASk2C,aAAe,SAAU1gB,EAAQC,EAAMsY,GAC9CvuC,QAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAM0hC,GACrD1hC,EAAKkhB,SAAWA,GAAUlhB,EAAKmhB,OAASA,GAC1CrvB,EAAYynC,iBAAiBmI,EAAWxgB,EAAQuY,MAQtD/tC,EAASm2C,eAAiB,SAAU3gB,EAAQC,EAAMqY,GAChDtuC,QAAQwB,QAAQoF,EAAYknC,cAAe,SAAUh5B,EAAM0hC,GACrD1hC,EAAKkhB,SAAWA,GAAUlhB,EAAKmhB,OAASA,GAC1CrvB,EAAYynC,iBAAiBmI,EAAWlI,EAAWrY,MAOzDz1B,EAAS86B,kBAAoB,SAAUC,GACrC,GAAIqb,MACAC,IAiBJ,OAhBA72C,SAAQwB,QAAQ+5B,EAAU,SAAU6U,GAClCpwC,QAAQwB,QAAQhB,EAAS+1C,WAAWnG,EAAQh/B,IAAK,SAAU0lC,GACzDF,EAAQ90C,MACNk0B,OAAQ8gB,EAAMhiC,KAAKkhB,OACnBC,KAAM6gB,EAAMhiC,KAAKmhB,OAEnBz1B,EAASu1B,WAAW+gB,EAAMhiC,KAAKkhB,OAAQ8gB,EAAMhiC,KAAKmhB,QAEpDj2B,QAAQwB,QAAQhB,EAASi2C,aAAarG,EAAQh/B,IAAK,SAAU0lC,GAC3DD,EAAU/0C,MACRk0B,OAAQ8gB,EAAMhiC,KAAKkhB,OACnBC,KAAM6gB,EAAMhiC,KAAKmhB,OAEnBz1B,EAASu1B,WAAW+gB,EAAMhiC,KAAKkhB,OAAQ8gB,EAAMhiC,KAAKmhB,WAIpD2gB,QAASA,EACTC,UAAWA,IAMfr2C,EAASqoC,wBAA0B,SAAUkO,GAC3C/2C,QAAQwB,QAAQu1C,EAAQH,QAAS,SAAUE,GACzCt2C,EAAS4oC,WAAW0N,EAAM9gB,OAAQ8gB,EAAM7gB,QAE1Cj2B,QAAQwB,QAAQu1C,EAAQF,UAAW,SAAUC,GAC3Ct2C,EAAS4oC,WAAW0N,EAAM9gB,OAAQ8gB,EAAM7gB,SAO5Cz1B,EAASm7B,mBAAqB,SAAUsa,EAAIe,GAC1C,GAAIJ,MACAC,KACAI,EAAM,CAmEV,OAlEID,GAAc,GAEhBh3C,QAAQwB,QAAQhB,EAAS+1C,WAAWN,GAAK,SAAUa,GAC7Ct2C,EAASu1C,WAAWe,EAAMhiC,KAAKkhB,OAAQghB,IACzCC,EAAMz2C,EAASu1B,WAAW+gB,EAAMhiC,KAAKkhB,OAAQigB,GAC7CW,EAAQ90C,MACNk0B,OAAQ8gB,EAAMhiC,KAAKkhB,OACnBC,KAAMggB,EACNc,SAAS,EACTpyC,MAAOsyC,EACPD,YAAa,MAGfx2C,EAASk2C,aAAaI,EAAMhiC,KAAKkhB,OAAQigB,EAAIe,GAC7CJ,EAAQ90C,MACNk0B,OAAQ8gB,EAAMhiC,KAAKkhB,OACnBC,KAAMggB,EACNc,SAAS,EACTpyC,MAAOsyC,EACPD,YAAaA,OAInBh3C,QAAQwB,QAAQhB,EAASi2C,aAAaR,GAAK,SAAUa,GAC/Ct2C,EAASu1C,WAAWiB,EAAaF,EAAMhiC,KAAKmhB,OAC9CghB,EAAMz2C,EAASu1B,WAAWkgB,EAAIa,EAAMhiC,KAAKmhB,MACzC4gB,EAAU/0C,MACRk0B,OAAQigB,EACRhgB,KAAM6gB,EAAMhiC,KAAKmhB,KACjB8gB,SAAS,EACTpyC,MAAOsyC,EACPD,YAAa,MAGfx2C,EAASm2C,eAAeV,EAAIa,EAAMhiC,KAAKmhB,KAAM+gB,GAC7CH,EAAU/0C,MACRk0B,OAAQigB,EACRhgB,KAAM6gB,EAAMhiC,KAAKmhB,KACjB8gB,SAAS,EACTpyC,MAAOsyC,EACPD,YAAaA,SAKnBh3C,QAAQwB,QAAQhB,EAAS+1C,WAAWN,GAAK,SAAUa,GACjDG,EAAMz2C,EAASu1B,WAAW+gB,EAAMhiC,KAAKkhB,OAAQigB,GAC7CW,EAAQ90C,MACNk0B,OAAQ8gB,EAAMhiC,KAAKkhB,OACnBC,KAAMggB,EACNc,SAAS,EACTpyC,MAAOsyC,EACPD,YAAa,MAGjBh3C,QAAQwB,QAAQhB,EAASi2C,aAAaR,GAAK,SAAUa,GACnDG,EAAMz2C,EAASu1B,WAAWkgB,EAAIa,EAAMhiC,KAAKmhB,MACzC4gB,EAAU/0C,MACRk0B,OAAQigB,EACRhgB,KAAM6gB,EAAMhiC,KAAKmhB,KACjB8gB,SAAS,EACTpyC,MAAOsyC,EACPD,YAAa,QAKjBJ,QAASA,EACTC,UAAWA,IAMfr2C,EAASooC,yBAA2B,SAAUmO,GAC5C/2C,QAAQwB,QAAQu1C,EAAQH,QAAS,SAAUE,GACrCA,EAAMC,QACRv2C,EAASyoC,aAAa6N,EAAM9gB,OAAQ8gB,EAAM7gB,KAAM6gB,EAAMnyC,OAEtDnE,EAASk2C,aAAaI,EAAM9gB,OAAQ8gB,EAAME,YAAaF,EAAM7gB,QAGjEj2B,QAAQwB,QAAQu1C,EAAQF,UAAW,SAAUC,GACvCA,EAAMC,QACRv2C,EAASyoC,aAAa6N,EAAM9gB,OAAQ8gB,EAAM7gB,KAAM6gB,EAAMnyC,OAEtDnE,EAASm2C,eAAeG,EAAME,YAAaF,EAAM7gB,KAAM6gB,EAAM9gB,WAI5Dx1B,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,oBAClC,KACA,aACA,YACA,WACA,iBACA,oBACA,wBACA,YACA,mBACA,sBACA,oBACA,OACA,wBACA,kBACA,eACA,SAA0BC,EAAI6E,EAAYM,EAAWH,EAAUI,EAAgBW,EAAmBR,EAAuBtF,EAAW6F,EAAkBR,EAAqBM,EAAmBgxC,EAAM/wC,EAAuBJ,EAAiBc,GAa1O,QAASswC,GAASjtC,GAChBktC,GAAY,EACZjyC,EAAWukB,OAAO2tB,EAAW70C,QAAQ0H,IAEvC,QAASotC,GAAYptC,GACnB,IACE,GAAIqtC,GAAcv3C,QAAQ8+B,SAAS50B,EAAQ/I,KAC3Cq2C,GAASD,GACT,MAAO1uC,GACPhC,EAAauD,KAAK,mBAAoB,qFAAuFF,EAAQ/I,KAAO,6CAA+C0H,GAAGoB,KAAK,WACjMzJ,EAASi3C,eACTtyC,EAAWuyC,WAAW,uBAI5B,QAASC,GAAUztC,GACjBjI,QAAQC,MAAM,wBACdiD,EAAWukB,OAAO2tB,EAAW70C,QAAQ0H,IAEvC,QAAS0tC,GAAU1tC,IACZA,EAAQ2tC,UAAYT,GACvBvwC,EAAauD,KAAK,mBAAoB,sIAAsIH,KAAK,WAC/K9E,EAAWuyC,WAAW,yBAG1BN,GAAY,EACZn1C,QAAQ2zB,IAAI,yBAEd,QAASkiB,GAAYC,GACnB,GAAI11C,GAAQ/B,EAAG+B,QACX21C,EAAaC,GAkBjB,OAjBAC,GAAUF,IACRlsB,KAAM,GAAIE,MACVmsB,GAAI91C,GAEN01C,EAAQK,WAAaJ,EACrBx3C,EAAS63C,GAAGC,KAAKt4C,QAAQ+R,OAAOgmC,IAEhCzyC,EAAS,WACP,GAAIizC,IACAH,WAAcJ,EACd/qC,QACE9C,KAAQ,gBACRD,QAAW,yBAA2B6tC,EAAQ5tC,KAAO,oBAAsBtE,EAAsBpF,KAAK6I,KAAKkvC,sBAAwB,mCAGzIhB,GAASe,IACR1yC,EAAsBpF,KAAK6I,KAAKkvC,uBAC5Bn2C,EAAMI,QAEf,QAAS+0C,GAASr2C,GAChB,GAAIs3C,GAAat3C,CAGjB,IAAI+2C,EAAUQ,eAAeD,EAAWL,YAAa,CAGnD,OAAQK,EAAWtuC,MACnB,IAAK,cACH8zB,MAAM,WAEN,MACF,KAAK,cACHA,MAAM,YAKuB,YAA3Bwa,EAAWxrC,OAAO9C,KACpBhF,EAAWukB,OAAOwuB,EAAUO,EAAWL,YAAYD,GAAG31C,QAAQi2C,EAAWt3C,QAGzEX,EAASi3C,eACTtyC,EAAWuyC,WAAW,oBACtBvyC,EAAWukB,OAAO7iB,EAAauD,KAAK,mBAAoB,sDAAwDquC,EAAWxrC,OAAO/C,iBAE7HguC,GAAUO,EAAWL,gBAEK,mBAAtBK,GAAWxrC,OACpBpG,EAAauD,KAAK,mBAAoB,8GACF,kBAA3BquC,EAAWxrC,OAAO9C,MAE3BtD,EAAauD,KAAK,mBAAoB,2KAA6KquC,EAAWL,YAKpO,QAASH,KACP,GAAIU,GAAUzB,EAAAA,QACd,OAAOyB,GApGT,GAAIn4C,MAEA03C,IAEJ13C,GAAS63C,KAET,IAAIhB,MACAD,GAAY,CAkOhB,OAjIA52C,GAASwJ,YAAc,SAAUjL,GAC/B,GAAIsD,GAAQ/B,EAAG+B,OACf,KACE7B,EAAS63C,GAAK,GAAIO,WAAU75C,GAC5ByB,EAAS63C,GAAGQ,OAAS1B,EACrB32C,EAAS63C,GAAGS,UAAYxB,EACxB92C,EAAS63C,GAAGU,QAAUpB,EACtBn3C,EAAS63C,GAAGW,QAAUpB,EACtB,MAAOtlC,GACP,MAAOhS,GAAGojC,OAAO,mFAGnB,MADA2T,GAAah1C,EACNA,EAAMI,SAGfjC,EAASy4C,YAAc,WACrB,MAAO7B,IAGT52C,EAASi3C,aAAe,WAClBj3C,EAASy4C,eACXz4C,EAAS63C,GAAGW,QAAU,aAEtBx4C,EAAS63C,GAAGh3B,SAEZpf,QAAQ2zB,IAAI,wCAOhBp1B,EAASyO,YAAc,WACrB,GAAI8oC,IAAY5tC,KAAM,eAElB1H,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS4O,oBAAsB,WAC7B,GAAI2oC,IAAY5tC,KAAM,uBAElB1H,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS09B,UAAY,SAAUl7B,EAAMm7B,GACnC,GAAI4Z,IACA5tC,KAAM,YACN+uC,SAAUl2C,EACVm7B,IAAKA,GAGL17B,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS+O,gBAAkB,WACzB,GAAIwoC,IAAY5tC,KAAM,qBAElB1H,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS6I,cAAgB,WACvB,GAAI0uC,IAAY5tC,KAAM,iBAElB1H,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS49B,UAAY,SAAUp7B,EAAMoL,GACnC,GAAI2pC,IACA5tC,KAAM,YACNnH,KAAMA,EACNoL,QAASA,GAGT3L,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS69B,WAAa,SAAUC,GAC9B,GAAIyZ,IACA5tC,KAAM,aACNhJ,KAAMm9B,GAGN77B,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAASoS,kBAAoB,SAAU2rB,GACrC,GAAIwZ,IACA5tC,KAAM,eACNhJ,KAAMo9B,GAGN97B,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS24C,kBAAoB,WAC3B,GAAIpB,IAAY5tC,KAAM,qBAElB1H,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS44C,kBAAoB,WAC3B,GAAIrB,IAAY5tC,KAAM,qBAElB1H,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAGTjC,EAAS64C,aAAe,SAAUC,EAASn4C,GACzC,GAAI42C,IACA5tC,KAAM,eACNmvC,QAASA,EACTn4C,KAAMA,GAGNsB,EAAUq1C,EAAYC,EAC1B,OAAOt1C,IAKFjC,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,wBAAyB,WAE3D,GAAIG,KAqCJ,OAjCAA,GAAS+4C,oBAAsB,SAAUC,GAIvC,IAAK,GAHDC,GAAe56C,OAAO66C,KAAKF,GAC3BppC,EAAMqpC,EAAa/5C,OACnBi6C,EAAQ,GAAIpZ,YAAWnwB,GAClBrQ,EAAI,EAAOqQ,EAAJrQ,EAASA,IAAK,CAC5B,GAAI65C,GAAQH,EAAaI,WAAW95C,EACpC45C,GAAM55C,GAAK65C,EAEb,MAAOD,GAAM77B,QAKftd,EAASs5C,oBAAsB,SAAUh8B,GAIvC,IAAK,GAHDi8B,GAAS,GACTJ,EAAQ,GAAIpZ,YAAWziB,GACvB1N,EAAMupC,EAAMnZ,WACPzgC,EAAI,EAAOqQ,EAAJrQ,EAASA,IACvBg6C,GAAUh1C,OAAOC,aAAa20C,EAAM55C,GAEtC,OAAOlB,QAAOm7C,KAAKD,IAadv5C,IAGTR,QAAQC,OAAO,aAAaI,QAAQ,mBAClC,QACA,eACA,SAAyBo9B,EAAO52B,GAE9B,GAAIrG,MACAy5C,EAAWp7C,OAAOq7C,gBAgHtB,OAvCA15C,GAAS25C,uBAAyB,WAChCtzC,EAAauD,KAAK,0BAA2B,qRAAqRH,KAAK,SAAUhH,GAC3UA,GACF4K,aAAausC,WAAW,yBACxBH,EAASI,YACTx7C,OAAOy7C,SAASjsC,UAEhBR,aAAausC,WAAW,4BAmB9BH,EAASM,iBAAiB,cAAe/5C,EAAS25C,wBAAwB,GAK1E35C,EAAS4H,mBAAqB,WAEJ,IAApB6xC,EAAShtC,QAAoC,IAApBgtC,EAAShtC,SAEpChL,QAAQ2zB,IAAI,0BAA4BqkB,EAAShtC,QACjDgtC,EAASO,WAGNh6C,KAIXR,QAAQC,OAAO,aAAagF,WAAW,qBACrC,SACA,eACA,YACA,cACA,oBACA,sBACA,SAAUC,EAAQ2B,EAActG,EAAWqG,EAAauW,EAAmBvX,GACzEV,EAAOkC,GAAK7G,EACZ2E,EAAOu1C,QAAUh5C,OAAOC,KAAKwD,EAAOkC,GAAG+jB,sBACvCjmB,EAAOw1C,iBACPx1C,EAAOw1C,cAAc13C,KAAOvB,OAAOC,KAAKwD,EAAOkC,GAAG+jB,sBAAsBjmB,EAAOkC,GAAGgX,gBAAgBvf,OAAS,GAC3GqG,EAAOy1C,WACPz1C,EAAO01C,cAAgB,GACvB11C,EAAO21C,WACLpsC,UAAavJ,EAAOkC,GAAGgX,gBAAgB3P,UACvCC,QAAWxJ,EAAOkC,GAAGgX,gBAAgB1P,QACrCC,aAAgBzJ,EAAOkC,GAAGgX,gBAAgBzP,aAC1CH,iBAAoBtJ,EAAOkC,GAAGgX,gBAAgB5P,iBAC9C3P,OAAUqG,EAAOkC,GAAGgX,gBAAgBvf,OACpC+P,kBAAqB1J,EAAOkC,GAAGgX,gBAAgBxP,kBAC/CC,wBAA2B3J,EAAOkC,GAAGgX,gBAAgBvP,wBACrDC,oBAAuBvO,EAAU6d,gBAAgBtP,oBACjDgsC,MAAS,IACTC,qBAAwBn1C,EAAoBmG,OAAOkT,WAAa/Z,EAAOkC,GAAGgX,gBAAgB5P,kBAK5FtJ,EAAOqL,kBAAoB,WACzBhQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOuL,qBAAuB,WAC5BlQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAOjCtL,EAAO81C,wBAA0B,WAC/B91C,EAAO21C,UAAUE,qBAAuBn1C,EAAoBmG,OAAOkT,WAAa/Z,EAAO21C,UAAUrsC,kBAKnGtJ,EAAO+1C,SAAW,WAChB,GAAIl8B,GAAO5B,EAAkB6B,sBAAsB9Z,EAAO21C,UAAUE,qBAEzD,KAAPh8B,IACFA,EAAO,KAET7Z,EAAO21C,UAAUC,MAAQ/7B,GAK3B7Z,EAAOg2C,mBAAqB,WAC1Bh2C,EAAO81C,0BACP91C,EAAO+1C,YAOT/1C,EAAO8W,MAAQ,WACb9W,EAAOy1C,WACPz1C,EAAO21C,WACLpsC,UAAavJ,EAAOkC,GAAGgX,gBAAgB3P,UACvCC,QAAWxJ,EAAOkC,GAAGgX,gBAAgB1P,QACrCC,aAAgBzJ,EAAOkC,GAAGgX,gBAAgBzP,aAC1CH,iBAAoBtJ,EAAOkC,GAAGgX,gBAAgB5P,iBAC9C3P,OAAUqG,EAAOkC,GAAGgX,gBAAgBvf,OACpC+P,kBAAqB1J,EAAOkC,GAAGgX,gBAAgBxP,kBAC/CC,wBAA2B3J,EAAOkC,GAAGgX,gBAAgBvP,wBACrDC,oBAAuBvO,EAAU6d,gBAAgBtP,oBACjDgsC,MAAS,IACTC,qBAAwBn1C,EAAoBmG,OAAOkT,WAAa/Z,EAAOkC,GAAGgX,gBAAgB5P,kBAE5F3H,EAAawa,SAKfnc,EAAOi2C,SAAW,SAAU/pC,EAAIgqC,GAC9B,MAAIl2C,GAAOy1C,QAAQvpC,IACRkE,WAAc,QAEbtT,SAARo5C,GACEl2C,EAAOy1C,QAAQS,IACR9lC,WAAc,QAF3B,QASFpQ,EAAOm2C,UAAY,SAAUjqC,GAC3B,MAAOlM,GAAOy1C,QAAQvpC,IAKxBlM,EAAOo2C,oBAAsB,WAC3B,GAAIp5C,IAAQ,CACZgD,GAAOy1C,QAAQn5C,QAAQ,SAAU4sB,GAC3BA,KAAU,IACZlsB,GAAQ,KAGPA,IACH3B,EAAU+N,mBAAmBpJ,EAAO21C,UAAUrsC,iBAAkBtJ,EAAO21C,UAAUpsC,UAAWvJ,EAAO21C,UAAUnsC,QAASxJ,EAAO21C,UAAUlsC,aAAczJ,EAAOw1C,cAAc13C,KAAMkC,EAAO21C,UAAUjsC,kBAAmB1J,EAAO21C,UAAUhsC,wBAAyB3J,EAAO21C,UAAU/rC,qBAC/Q5J,EAAO8W,UAMX9W,EAAOq2C,qBAAuB,WACxBr2C,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,GAAK5J,EAAO21C,UAAU/rC,oBAAoB,GAAG,GAAK,IAAM,EACrf5J,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAElBa,MAAMt2C,EAAO21C,UAAUhsC,wBAA0BjJ,EAAoBmG,OAAOkT,YAC9E/Z,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAElBa,MAAM51C,EAAoBmG,OAAOkT,WAAa/Z,EAAO21C,UAAUrsC,kBACjEtJ,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAElBz1C,EAAO21C,UAAUlsC,aAAe,IAAM,EACxCzJ,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAElBz1C,EAAO21C,UAAUpsC,UAAY,IAAM,EACrCvJ,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAElBz1C,EAAO21C,UAAUnsC,QAAU,IAAM,EACnCxJ,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAElBz1C,EAAO21C,UAAUpsC,UAAY,EAC/BvJ,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,EAEtBz1C,EAAO01C,cAAgBh0C,EAAYzF,KAAK2e,WAAa,EACjD5a,EAAO21C,UAAUnsC,QAAUxJ,EAAO01C,cACpC11C,EAAOy1C,QAAQ,IAAK,EAEpBz1C,EAAOy1C,QAAQ,IAAK,MAM5B36C,QAAQC,OAAO,aAAaw7C,OAAO,QAAS,WAC1C,MAAO,UAAUC,EAAOC,GAGtB,IAAK,GAFDC,GAAO,GAAIC,QAAOF,EAAMG,eACxBC,KACKh8C,EAAI,EAAGA,EAAI27C,EAAMh8C,OAAQK,IAC5B67C,EAAKI,KAAKN,EAAM37C,GAAGiD,KAAK84C,gBAC1BC,EAAIj6C,KAAK45C,EAAM37C,GAGnB,OAAOg8C,MAIX/7C,QAAQC,OAAO,aAAaw7C,OAAO,gBACjC,wBACA,YACA,SAAU51C,EAAuBtF,GAC/B,MAAO,UAAUm7C,GACf,GAAIA,EAAO,CAIT,IAAK,GADD7mC,GAFAonC,EAAQ,GAAIJ,QAAO,iBACnBE,KAEKh8C,EAAI,EAAGA,EAAI27C,EAAMh8C,OAAQK,IAC5Bk8C,EAAMD,KAAKN,EAAM37C,GAAGoK,OACqEnI,SAAvF6D,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,gBACvEmQ,EAAMhP,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAMskB,QAAQyyB,EAAM37C,GAAGiD,MACpG,KAAR6R,GACFknC,EAAIj6C,KAAK45C,EAAM37C,IAKvB,OAAOg8C,QAMf/7C,QAAQC,OAAO,aAAagF,WAAW,aACrC,SACA,qBACA,kBACA,eACA,YACA,eACA,iBACA,wBACA,SAAUC,EAAQ0pC,EAAoB9nC,EAAiBD,EAActG,EAAWyF,EAAcN,EAAgBG,GAC5GX,EAAO6B,IAAMlB,EACbX,EAAOkC,GAAK7G,EACZ2E,EAAO/D,KAAOa,OACdkD,EAAOg3C,SAAW,KAIlBh3C,EAAOqL,kBAAoB,WACzBhQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOuL,qBAAuB,WAC5BlQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOi3C,YAAc,SAAUn5C,GAC7B6D,EAAawa,SAKfnc,EAAOk3C,eAAiB,SAAUp5C,GAChC6D,EAAawa,SAKfnc,EAAOm3C,QAAU,WACf,GAAIC,GAAcp3C,EAAOq3C,SACyB,MAA9CD,EAAYrzB,QAAQpiB,EAAa21C,UACnCF,EAAYx6C,KAAK+E,EAAa21C,SAEhC3uC,aAAaI,QAAQ,OAAQ1D,KAAKC,UAAU8xC,IAC5Cp3C,EAAOu3C,OAASH,EAChBp3C,EAAOg3C,SAAWh3C,EAAOu3C,OAAO,IAKlCv3C,EAAOq3C,QAAU,WACf,GAAI3uC,GAASC,aAAaC,QAAQ,QAC9B4uC,IAIJ,OAHK51C,GAAgBiH,UAAUC,aAA0B,OAAXJ,IAC5C8uC,EAAUnyC,KAAKoyC,MAAM/uC,IAEhB8uC,GAKTx3C,EAAO03C,cAAgB,SAAUz7C,GAC/B0F,EAAa21C,QAAUr7C,GAKzB+D,EAAO23C,UAAY,SAAU17C,GAC3B,GAAIm7C,GAAcp3C,EAAOq3C,SACS,MAA9BD,EAAYrzB,QAAQ9nB,IACtBm7C,EAAY1O,OAAO0O,EAAYrzB,QAAQ9nB,GAAO,GAEhD0M,aAAaI,QAAQ,OAAQ1D,KAAKC,UAAU8xC,IAC5Cp3C,EAAOu3C,OAASH,EAChBp3C,EAAOg3C,SAAWh3C,EAAOu3C,OAAO,IAKlCv3C,EAAOmjC,YAAc,WACnBriC,EAAaqiC,YAAYxhC,EAAaua,OAAQlc,EAAO/D,KAAMZ,EAAUgD,mBACrEmC,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVm3B,QAAWpjC,EAAO/D,KAClB6B,KAAQ6D,EAAaua,OACrB7d,kBAAqBhD,EAAUgD,oBAEjCsD,EAAawa,SAKfnc,EAAOqjC,YAAc,SAAUvlC,GAC7B,GAAI4vC,GAAM5sC,EAAa+kB,gBAAgBxqB,EAAUiR,uBACjDxL,GAAauiC,YAAYhoC,EAAUosB,wBAAyBpsB,EAAUgD,mBACtEmC,EAAewL,mBACb/G,KAAQ,QACRgH,OAAU,cACVN,MAAS+hC,EACTxhC,GAAM7Q,EAAUosB,wBAChBppB,kBAAqBhD,EAAUgD,oBAEjCsD,EAAawa,YAKnBrhB,QAAQC,OAAO,aAAauU,UAAU,YACpC,WACA,SAAUC,GACR,OACEE,SAAU,IACVG,KAAM,SAAkBF,EAAOvM,EAAS8S,GACtCvG,EAAMa,OAAO0F,EAAM2hC,SAAU,SAAUzgC,GACjCA,GACF5H,EAAS8B,SAASlO,EAAS,gCAC3BoM,EAAS+B,YAAYnO,EAAS,gCAE9BoM,EAAS+B,YAAYnO,EAAS,gCAC9BoM,EAAS8B,SAASlO,EAAS,sCAQvCrI,QAAQC,OAAO,aAAauU,UAAU,YACpC,WACA,SAAUC,GACR,OACEE,SAAU,IACVG,KAAM,SAAkBF,EAAOvM,EAAS8S,GACtCvG,EAAMa,OAAO0F,EAAM4hC,SAAU,SAAU1gC,GACjCA,EACF5H,EAAS8B,SAASlO,EAAS,sBAE3BoM,EAAS+B,YAAYnO,EAAS,6BAQ1CrI,QAAQC,OAAO,aAAaoL,UAAU,qBAAsB,WAC1D,OACEkL,SAAU,SAAUlO,EAAS20C,GAC3B30C,EAAQkO,SAAS,oBAEnBC,YAAa,SAAUnO,EAAS20C,GAC9B30C,EAAQmO,YAAY,uBAI1BxW,QAAQC,OAAO,aAAauU,UAAU,cACpC,aACA,YACA,SAAUrP,EAAY5E,GACpB,OACEoU,SAAU,IACVhD,SAAS,EACTsrC,YAAY,EACZroC,OAASsoC,eAAgB,KACzBC,SAAU,mEACVl4C,YACE,SACA,SAAUC,GACRA,EAAOk4C,SACPl4C,EAAOm4C,sBACPv+C,KAAKw+C,QAAU,SAAUC,GACvB,GAAIr4C,EAAOk4C,MAAM19C,OAAS,EACxB,KAAM,mCAER,OADAwF,GAAOk4C,MAAMt7C,KAAKy7C,GACXr4C,EAAOk4C,MAAM19C,QAEtBZ,KAAK0+C,yBAA2B,SAAUD,GACxCr4C,EAAOm4C,sBAAwBE,KAIrCzoC,KAAM,SAAUF,EAAOvM,EAAS8S,GAC9B,GAAIsiC,IAAsC,EACtCC,GAAuC,EACvCC,GAAyC,EAEzCC,EAAU59C,QAAQqI,QAAQ,yFAC1Bw1C,EAAQjpC,EAAMwoC,MAAM,GACpBU,EAAQlpC,EAAMwoC,MAAM,GACpBW,EAAQnpC,EAAMyoC,sBACdW,EAAkCh+C,QAAQqI,QAAQ,iCAClD41C,EAAmCj+C,QAAQqI,QAAQ,kCACnD61C,EAAqCl+C,QAAQqI,QAAQ,6BACzD01C,GAAMxhB,KAAKmV,QAAQuM,GACnBF,EAAMxhB,KAAKmV,QAAQsM,GACnBD,EAAMxhB,KAAKmV,QAAQwM,EACnB,IAAIC,GAAWN,EAAMO,SAAW,EAC5BC,EAAWP,EAAMM,SAAW,EAC5BE,GAAuB,EACvBC,GAAO,CACXV,GAAMthB,KAAKiT,MAAMoO,GACjBziC,EAAM2lB,SAAS,iBAAkB,SAAUrP,GAC7B,UAARA,EACF7c,EAAMyoC,sBAAsB9gB,KAAKM,OAEjCjoB,EAAMyoC,sBAAsB9gB,KAAKQ,SAKrC10B,EAAQC,KAAK,YAAa,SAAUk2C,GAClC,GAAKD,EAAL,CAGIT,EAAMvhB,KAAK,GAAGkiB,aAAeX,EAAMvhB,KAAK,GAAGhL,aAAe,EAC5DssB,EAAMthB,KAAKllB,IAAI,aAAc,UAE7BwmC,EAAMthB,KAAKllB,IAAI,aAAc,SAE/B,IAAIqnC,GAASr2C,EAAQ,GAAGs2C,wBACpB7oB,EAAM,CACV,IAAIwoB,EAAsB,CACxB,GAAI5mC,GAASgnC,EAAOE,OAASF,EAAOlO,GAIpC,IAHA1a,EAAM0oB,EAAGK,QAAUH,EAAOlO,IAGhB2N,EAANroB,EACF,MACF,IAAmBuoB,EAAf3mC,EAASoe,EACX,MACF8nB,GAAQvmC,IAAI,MAAOye,EAAM,MACzB+nB,EAAMthB,KAAKllB,IAAI,SAAUye,EAAM,MAC/BgoB,EAAMvhB,KAAKllB,IAAI,MAAOye,EAAM,MAC5Bv1B,EAAUorB,iBAAiBmK,GAC3B3wB,EAAWyD,UAEb,GAAI60C,EAAqC,CACvC,GAAI/lC,GAASgnC,EAAOE,OAASF,EAAOlO,GAEpC,IADA1a,EAAM0oB,EAAGK,QAAUH,EAAOlO,IACf,IAAP1a,GAA6B,IAAhBpe,EAASoe,EACxB,MAEFioB,GAAMxhB,KAAKllB,IAAI,MAAOye,EAAM,KAC5B,IAAIjuB,GAAM6P,EAASoe,CACnBioB,GAAMxhB,KAAKllB,IAAI,SAAUxP,EAAM,MAEjC,GAAI61C,EAAsC,CACxC,GAAIjmC,GAAQinC,EAAOvwB,MAAQuwB,EAAOxwB,IAElC,IADA4H,EAAM0oB,EAAGM,QAAUJ,EAAOxwB,KACf,IAAP4H,GAA4B,IAAfre,EAAQqe,EACvB,MAGF,IAAIjuB,GAAM4P,EAAQqe,CAClBioB,GAAMxhB,KAAKllB,IAAI,QAASxP,EAAM,MAEhC,GAAI81C,EAAwC,CAE1C,GAAIjmC,GAASgnC,EAAOE,OAASF,EAAOlO,GAEpC,IADA1a,EAAM0oB,EAAGK,QAAUH,EAAOlO,IACf,IAAP1a,GAA6B,IAAhBpe,EAASoe,EACxB,MAEFioB,GAAMxhB,KAAKllB,IAAI,MAAOye,EAAM,KAC5B,IAAIjuB,GAAM6P,EAASoe,CACnBioB,GAAMxhB,KAAKllB,IAAI,SAAUxP,EAAM,KAE/B,IAAI4P,GAAQinC,EAAOvwB,MAAQuwB,EAAOxwB,IAElC,IADA4H,EAAM0oB,EAAGM,QAAUJ,EAAOxwB,KACf,IAAP4H,GAA4B,IAAfre,EAAQqe,EACvB,MAGF,IAAIjuB,GAAM4P,EAAQqe,CAClBioB,GAAMxhB,KAAKllB,IAAI,QAASxP,EAAM,UAGlC+1C,EAAQt1C,KAAK,YAAa,SAAUk2C,GAClCA,EAAGnsB,iBACHksB,GAAO,EACPD,GAAuB,EACvB/9C,EAAUkrB,kBAAiB,GAC3BtmB,EAAWyD,YAEbo1C,EAAgC11C,KAAK,YAAa,SAAUk2C,GAC1DA,EAAGnsB,iBACHksB,GAAO,EACPd,GAAsC,EACtCl9C,EAAUkrB,kBAAiB,GAC3BtmB,EAAWyD,YAEbq1C,EAAiC31C,KAAK,YAAa,SAAUk2C,GAC3DA,EAAGnsB,iBACHksB,GAAO,EACPb,GAAuC,EACvCn9C,EAAUkrB,kBAAiB,GAC3BtmB,EAAWyD,YAEbs1C,EAAmC51C,KAAK,YAAa,SAAUk2C,GAC7DA,EAAGnsB,iBACHksB,GAAO,EACPZ,GAAyC,EACzCp9C,EAAUkrB,kBAAiB,GAC3BtmB,EAAWyD,YAEb5I,QAAQqI,QAAQoZ,UAAUnZ,KAAK,UAAW,SAAUk2C,GAClDD,GAAO,EACPD,GAAuB,EACvBb,GAAsC,EACtCC,GAAuC,EACvCC,GAAyC,EACzCp9C,EAAUkrB,kBAAiB,GAC3BtmB,EAAWyD,iBAKlB4L,UAAU,SAAU,WACrB,OACEG,SAAU,IACVoqC,QAAS,cACTptC,SAAS,EACTsrC,YAAY,EACZroC,OACEwpC,QAAS,IACTj0C,KAAM,IACN+yC,eAAgB,KAElBC,SAAU,kDACVroC,KAAM,SAAUF,EAAOvM,EAAS8S,EAAO6jC,GAElB,qBAAfpqC,EAAMzK,MACRyK,EAAM2nB,KAAOl0B,EACbuM,EAAMzE,MAAQ6uC,EAAe1B,QAAQ1oC,GACrCA,EAAMqqC,UAAY,aAAerqC,EAAMzE,QAEvCyE,EAAM2nB,KAAOl0B,EACbuM,EAAMzE,MAAQ,EACdyE,EAAMqqC,UAAY,mBAClBD,EAAexB,yBAAyB5oC,QAMhD5U,QAAQC,OAAO,aAAauU,UAAU,aACpC,WACA,YACA,wBACA,wBACA,SAAUlP,EAAU/E,EAAWsF,EAAuBY,GACpD,OACEiO,YAAa,uBACbC,SAAU,IACVG,KAAM,SAAkBF,EAAOvM,EAAS8S,GAEtC,GAKI9X,GALA+X,EAAe/S,EAAQ4M,KAAK,UAAUvV,OAEtC2b,GADahT,EAAQ4M,KAAK,UAAU,GACrB5M,EAAQ4M,KAAK,UAAUmG,EAAe,IAErDmC,EAAYlC,EAAa9D,WAAW,KAExC3C,GAAMjN,KAAOlB,EACb0U,EAAM2lB,SAAS,YAAa,SAAUrP,GAChCA,IACFpuB,EAAYouB,KAGhB7c,EAAMjQ,MAAQwW,EAAMxW,MAKpBiQ,EAAMa,OAAO,gBAAiB,SAAUC,EAAUC,GAC5CD,GAAYC,GACdf,EAAMsqC,wBAIVtqC,EAAMa,OAAO,kBAAmB,WAC9BnQ,EAASsP,EAAMsqC,oBAAqBr5C,EAAsBnF,OAAO2K,UAAUkQ,YAE7E3G,EAAMa,OAAO,iBAAkB,WACxBnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7B6I,EAAMsqC,wBAGT,GACHtqC,EAAMa,OAAO,qBAAsB,WAC5BnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7B6I,EAAMsqC,wBAGT,GACHtqC,EAAMa,OAAO,oBAAqB,WAC3BnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7B6I,EAAMsqC,wBAGT,GACHtqC,EAAMa,OAAO,0BAA2B,WACjCnU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,SAC7B6I,EAAMsqC,wBAGT,GAEHtqC,EAAMa,OAAO,oBAAqB,SAAUC,EAAUC,GAC/CrU,EAAEC,cAAcqT,EAAMtN,MACpBhG,EAAEC,cAAcqT,EAAMtN,IAAIyE,UACzB2J,EAAS1S,OAAS2S,EAAS3S,MAAQ0S,EAAStH,UAAYuH,EAASvH,UACnEwG,EAAMsqC,wBAIX,GAMHtqC,EAAMsqC,oBAAsB,WAC1B,IAAK59C,EAAEC,cAAcqT,EAAMvN,OAAOlG,OACC,IAA7ByT,EAAMvN,OAAOlG,KAAKzB,OAAc,CAClC6d,EAAU/F,UAAU,EAAG,EAAG+F,EAAUvI,OAAOyC,MAAO8F,EAAUvI,OAAO0C,QAEnE9C,EAAMrN,IAAI6S,uBAAuBmD,GAEjC3I,EAAMrN,IAAI8S,wBAAwBkD,GAAW,EAE7C,IAAIpa,GAAKyR,EAAM7N,IAAIhE,mBAAmBM,GAClC49B,EAAMrsB,EAAMvN,OAAO65B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,WACpDvsB,GAAMrN,IAAI4W,kBAAkBZ,EAAWla,EAAW49B,EAAIY,QAASZ,EAAIa,QAAS,UAS1F9hC,QAAQC,OAAO,aAAauU,UAAU,iBACpC,WACA,SAAUC,GACR,OACE0oC,SAAU,2EACVxoC,SAAU,IACVhD,SAAS,EACTmD,KAAM,SAAkBF,EAAOvM,EAAS8S,GAEtCA,EAAM2lB,SAAS,YAAa,SAAUzkB,GACrB,SAAXA,GAEF5H,EAAS+B,YAAYnO,EAAS,+BAC9BoM,EAAS+B,YAAYnO,EAAS,8BAC9BoM,EAAS8B,SAASlO,EAAS,gCAC3BoM,EAAS8B,SAASlO,EAAS,gCAG3BoM,EAAS+B,YAAYnO,EAAS,gCAC9BoM,EAAS+B,YAAYnO,EAAS,8BAC9BoM,EAAS8B,SAASlO,EAAS,+BAC3BoM,EAAS8B,SAASlO,EAAS,sCAQvCrI,QAAQC,OAAO,aAAauU,UAAU,sBACpC,WACA,WACA,wBACA,SAAUC,EAAUnP,EAAUO,GAC5B,OACEs3C,SAAU,sFACVxoC,SAAU,IACVhD,SAAS,EACTmD,KAAM,SAAkBF,EAAOvM,EAAS8S,GAGtCvG,EAAM7N,IAAMlB,EACZ+O,EAAMa,OAAO,sBAAuB,WACA,KAA9Bb,EAAMxN,GAAG4f,kBACXvS,EAAS8B,SAASlO,EAAS,0BAA0B4B,KAAK,WACxD2K,EAAM8U,SACNpkB,EAAS,WACPmP,EAAS+B,YAAYnO,EAAS,0BAA0B4B,KAAK,WAC3D3E,EAAS,WACPsP,EAAMxN,GAAG4f,iBAAmB,IAC3BpS,EAAM7N,IAAIrG,OAAO2K,UAAUC,QAC9BsJ,EAAM8U,YAEP9U,EAAM7N,IAAIrG,OAAO2K,UAAUC,YAGjC,QAMXtL,QAAQC,OAAO,aAAauU,UAAU,WACpC,cACA,wBACA,kBACA,wBACA,SAAU5N,EAAaH,EAAuBK,EAAiBjB;AAC7D,OACE8O,SAAU,IACVhD,SAAS,EACTiD,OAAS5R,KAAM,KACf8R,KAAM,SAAUF,EAAOvM,EAAS8S,GAC9BvG,EAAM7N,IAAMlB,CACZ,IAAIs5C,GAAK92C,EAAQ,GACb+2C,EAAW39B,SAASC,cAAc,MACtC09B,GAASC,IAAM,eACfD,EAAS3nC,MAAQ,KACjB2nC,EAAS1nC,OAAS,IAElB9C,GAAM0qC,YAAc,WAClB,MAAO1qC,GAAM2qC,OAAOv/C,QAAQ+R,OAAOnL,EAAYkL,WAAW,KAE5D8C,EAAM4qC,SAAW,WACf,MAAIrkC,GAAMnY,OAASyD,EAAsBmL,aAAa5O,MAC7C,GAEA,GAEX4R,EAAM2qC,OAAS,SAAUp+C,GACvB,GAAI4f,EAMJ,OAJEA,GADiB,gBAARC,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBtM,EAAMyL,QAAQlf,IAExC6f,IAAIE,gBAAgBtM,EAAMyL,QAAQlf,KAI/CyT,EAAMyL,QAAU,SAAUlf,GACxB,GAAImf,EACJ,KACEA,EAAO,GAAIC,OAAMpf,IAASgJ,KAAM,eAChC,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOzf,GACZmf,EAAOA,EAAKD,UAEd,MAAOC,IAET6+B,EAAG5E,iBAAiB,YAAa,SAAU1xC,GAEzC,GADA5G,QAAQ2zB,IAAI,aACRhhB,EAAM4qC,WAAY,CACpB1gD,KAAK2gD,UAAUC,IAAI,OACnB,IAAI3gD,GAAM6V,EAAM0qC,aAChB,IAAIx4C,EAAgBiH,UAAUqS,WAAatZ,EAAgBiH,UAAUu9B,SAAU,CAG7E,GAAIqU,GAAMl+B,SAASC,cAAc,MACjCi+B,GAAI19B,YAAYm9B,GAChB39B,SAASm+B,cAAc,QAAQ39B,YAAY09B,GAC3C92C,EAAEg3C,aAAaC,aAAaH,EAAK,GAAI,IACrC92C,EAAEg3C,aAAaE,cAAgB,OAC/Bl3C,EAAEg3C,aAAapzC,QAAQ,cAAe,oBAAsB0O,EAAMnY,KAAO,eAAiBjE,QAG5F8J,GAAEwpB,iBACFpwB,QAAQ2zB,IAAI,2CAEd,QAAO,IACN,GACHupB,EAAG5E,iBAAiB,UAAW,SAAU1xC,GAMvC,MALA5G,SAAQ2zB,IAAI,WACRhhB,EAAM4qC,aACR1gD,KAAK2gD,UAAUpP,OAAO,QACtBxnC,EAAEwpB,mBAEG,IACN,QAMXryB,QAAQC,OAAO,aAAauU,UAAU,gBACpC,YACA,iBACA,cACA,eACA,+BACA,yBACA,sBACA,wBACA,WACA,SAAUjU,EAAWmF,EAAgBkB,EAAaZ,EAAcsuB,EAA8B0rB,EAAwBp6C,EAAqBC,EAAuBP,GAChK,OACE63C,SAAU,qFACVxoC,SAAU,IACVC,OACEqrC,SAAU,IACV16B,QAAS,KAEX5T,SAAS,EACTmD,KAAM,SAAkBF,EAAOvM,EAAS8S,GAItCvG,EAAMsrC,aACNtrC,EAAMurC,aACNvrC,EAAMwrC,WAINxrC,EAAMqc,QAAU,GAChBrc,EAAMyc,QAAU,GAEhBzc,EAAMyrC,YAAc,IACpBzrC,EAAM0rC,YAAc,GAEpB1rC,EAAM2rC,YACJhlC,SAAU,IACVwyB,OAAO,EACPyS,OAAO,EACPC,UAAU,EACVC,aAAa,GAGf9rC,EAAM+rC,aACJ,GACA,IAGF/rC,EAAMgsC,aAAe,IACrBhsC,EAAMisC,oBAAqB,EAC3BjsC,EAAMksC,mBAAoB,EAE1BlsC,EAAMmsC,sBAAwB/+C,OAC9B4S,EAAMosC,oBAAsBh/C,OAC5B4S,EAAMqsC,uBAAyBj/C,OAC/B4S,EAAMssC,qBAAuBl/C,OAC7B4S,EAAMusC,iBAAmBn/C,OACzB4S,EAAMwsC,iBAAmBp/C,OACzB4S,EAAMysC,gBAAkBr/C,OACxB4S,EAAM0sC,gBAAkBt/C,OAKxB4S,EAAM2sC,mBAAqB,KAE3B3sC,EAAM4sC,gBAAkB,EAKxB5sC,EAAMrU,UAAYA,EAClBqU,EAAMnM,eAAiBlI,EAAUkI,eACjCmM,EAAM6sC,eAAiB/7C,EACvBkP,EAAM7N,IAAMlB,EACZ+O,EAAMa,OAAO,sBAAuB,SAAUC,EAAUC,GAClDD,IAAaC,IACf1T,QAAQszC,MAAM,iCAAkC7/B,GAChDd,EAAMnM,eAAe2c,cAAgBpjB,OACrC4S,EAAM8sC,YAEP,GACH9sC,EAAMa,OAAO,WAAY,SAAUC,EAAUC,GACvCD,IAAaC,IACf1T,QAAQszC,MAAM,8BAA+B7/B,GAC7Cd,EAAM+sC,YAEP,GACH/sC,EAAMa,OAAO,6BAA8B,SAAUC,EAAUC,GACzDD,IAAaC,IACf1T,QAAQszC,MAAM,sCAAuC7/B,GACrDd,EAAM8sC,YAEP,GACH9sC,EAAMa,OAAO,UAAW,SAAUC,EAAUC,GACtCD,IAAaC,IACf1T,QAAQszC,MAAM,mBAAoB7/B,EAAUd,EAAMsrC,cAChB,mBAAvBtrC,GAAMsrC,cAA6C,IAAbxqC,GAC/Cd,EAAMgtC,KAAKhtC,EAAMsrC,iBAGpB,GACHtrC,EAAMa,OAAO,uCAAwC,SAAUC,EAAUC,GACnED,IAAaC,IACf1T,QAAQszC,MAAM,wCACd3gC,EAAM8sC,YAEP,GACH9sC,EAAMa,OAAO,+BAAgC,SAAUC,EAAUC,GAC3DD,IAAaC,IACff,EAAMwrC,WAAap6C,EAAaqvB,YAAY3f,GAC5Cd,EAAM8sC,YAEP,GACH9sC,EAAMa,OAAO,qCAAsC,SAAUC,GACvDA,KAAa,IACfzT,QAAQszC,MAAM,wCACd3gC,EAAM8sC,YAEP,GACH9sC,EAAMa,OAAO,+BAAgC,SAAUC,EAAUC,GAC3DD,IAAaC,GACff,EAAM8sC,WAEP,GACH9sC,EAAMa,OAAO,wBAAyB,SAAUC,EAAUC,GACxD1T,QAAQszC,MAAM,kCACV7/B,IAAaC,GACff,EAAM8sC,WAEP,GAQH9sC,EAAMitC,WAAa,SAAU70B,GAC3BpY,EAAMsrC,aAAelzB,EACrBzsB,EAAUkI,eAAekc,eAAiBqI,EAAK5b,IAEjDwD,EAAMktC,WAAa,SAAUhtC,GAC3BF,EAAMurC,aAAerrC,EACrBvU,EAAUkI,eAAemc,mBAAqB9P,EAAKkhB,OACnDz1B,EAAUkI,eAAeoc,iBAAmB/P,EAAKmhB,MAkBnDrhB,EAAMmtC,KAAO,WAEXntC,EAAMotC,eAENzhD,EAAUkI,eAAeyc,UAAYtQ,EAAMqtC,aAAa/8B,YACxD3kB,EAAUkI,eAAewc,YAAcrQ,EAAMqtC,aAAald,QAI1DnwB,EAAMstC,IAAIntC,KAAK,YAAaH,EAAMutC,wBAAuB,IACzDvtC,EAAMwtC,aAAartC,KAAK,YAAaH,EAAMytC,yCAC3CztC,EAAMwtC,aAAaE,UAAU,+BAA+BvtC,KAAK,YAAaH,EAAM2tC,oCAEnD,OAA7B3tC,EAAM2sC,qBACRj8C,EAASqnC,OAAO/3B,EAAM2sC,oBACtB3sC,EAAM2sC,mBAAqB,MAE7B3sC,EAAM2sC,mBAAqBj8C,EAASsP,EAAM8sC,OAAQ,MAUpD9sC,EAAMotC,aAAe,WAEnB,GAAI90B,GAAItY,EAAMqtC,aAAa/8B,YAAY,GACnCod,EAAI1tB,EAAMqtC,aAAa/8B,YAAY,EACnCtQ,GAAMqrC,UACHrrC,EAAMksC,mBAGLxe,EAAI1tB,EAAMwsC,iBAAmBxsC,EAAMqsC,yBACrC3e,EAAI1tB,EAAMwsC,iBAAmBxsC,EAAMqsC,wBAEjC3e,EAAI1tB,EAAMusC,iBAAmBvsC,EAAMssC,uBACrC5e,EAAI1tB,EAAMusC,iBAAmBvsC,EAAMssC,uBANrC5e,EAAI,EASFpV,EAAItY,EAAM0sC,gBAAkB1sC,EAAMmsC,wBACpC7zB,EAAItY,EAAM0sC,gBAAkB1sC,EAAMmsC,uBAEhC7zB,EAAItY,EAAMysC,gBAAkBzsC,EAAMosC,sBACpC9zB,EAAItY,EAAMysC,gBAAkBzsC,EAAMosC,uBAG/BpsC,EAAMksC,mBAGL5zB,EAAItY,EAAM0sC,gBAAkB1sC,EAAMqsC,yBACpC/zB,EAAItY,EAAM0sC,gBAAkB1sC,EAAMqsC,wBAEhC/zB,EAAItY,EAAMysC,gBAAkBzsC,EAAMssC,uBACpCh0B,EAAItY,EAAMysC,gBAAkBzsC,EAAMssC,uBANpCh0B,EAAI,EASFoV,EAAI1tB,EAAMwsC,iBAAmBxsC,EAAMmsC,wBACrCze,EAAI1tB,EAAMwsC,iBAAmBxsC,EAAMmsC,uBAEjCze,EAAI1tB,EAAMusC,iBAAmBvsC,EAAMosC,sBACrC1e,EAAI1tB,EAAMusC,iBAAmBvsC,EAAMosC,sBAGvCpsC,EAAMqtC,aAAa/8B,WACjBgI,EACAoV,KAGJ1tB,EAAM+sC,OAAS,WAMb,GAAIz8B,GAAYtQ,EAAMqtC,aAAa/8B,WACnC,IAAItQ,EAAMqrC,YAAa,EAErB,GAAIuC,GAAyBt9B,EAAU,GAAKtQ,EAAMosC,oBAC9CyB,EAA0Bv9B,EAAU,GAAKtQ,EAAMssC,yBAGnD,IAAIsB,GAAyBt9B,EAAU,GAAKtQ,EAAMosC,oBAC9CyB,EAA0Bv9B,EAAU,GAAKtQ,EAAMssC,oBAErDtsC,GAAM8sC,SACNc,GAAkD5tC,EAAMosC,oBACxDyB,GAAoD7tC,EAAMssC,qBACtDtsC,EAAMqrC,YAAa,EAErBrrC,EAAMqtC,aAAa/8B,WACjBs9B,EACAC,IAIF7tC,EAAMqtC,aAAa/8B,WACjBu9B,EACAD,IAGJ5tC,EAAMotC,eAENptC,EAAMqtC,aAAax4C,MAAMmL,EAAMstC,MAOjCttC,EAAMutC,uBAAyB,SAAUO,GACvC,GAAIC,GAAY,EAQhB,IAPI/tC,EAAMqrC,UACR0C,GAAa,aAAe/tC,EAAMqtC,aAAa/8B,YAAY,GAAK,IAAMtQ,EAAMqtC,aAAa/8B,YAAY,GAAK,IAC1Gy9B,GAAa,2BAEbA,GAAa,aAAe/tC,EAAMqtC,aAAa/8B,YAAY,GAAK,IAAMtQ,EAAMqtC,aAAa/8B,YAAY,GAAK,IAC1Gy9B,GAAa,aAEXD,KAAmB,EAAM,CAC3B,GAAIE,GAAShuC,EAAMqtC,aAAald,QAAUnwB,EAAM4sC,eAE9CmB,IADE/tC,EAAMisC,mBACK,SAAW+B,EAAS,IAEpB,WAAaA,EAAS,IAGvC,MAAOD,IAST/tC,EAAMiuC,2BAA6B,SAAU92B,GAE3C,MAAInX,GAAMqrC,SACD,wBAEA,aASXrrC,EAAMkuC,6BAA+B,SAAU/2B,GAC7C,MAAO,OAETnX,EAAMmuC,kCAAoC,SAAUh3B,GAClD,MAAO,QAETnX,EAAMouC,YAAc,SAAUj3B,GAE5B,IAAK,GADDlb,GAAQtQ,EAAUwQ,cAAc/K,EAAasvB,aAAavJ,EAAE3a,KACvDrR,EAAI,EAAGA,EAAIgsB,EAAE9S,OAAOvZ,SAAUK,EACrC,GAAIgsB,EAAE9S,OAAOlZ,GAAGiD,OAAS6N,EACvB,MAAOkb,GAAE9S,OAAOlZ,GAAG4C,KAIvB,OADAV,SAAQszC,MAAM,4DAA6D,kBAAmB1kC,EAAO,SAAUkb,GACxG,YAETnX,EAAMquC,oBAAsB,SAAU5+C,GACpC,GAAI6+C,GAAsB3iD,EAAUwQ,cAAc1M,EAClD,OAAIA,KAAc6+C,EACT7+C,EAEAA,EAAY,IAAM6+C,GAG7BtuC,EAAMuuC,8BAAgC,SAAUp3B,GAC9C,MAAInX,GAAMqrC,SACJ1/C,EAAUkI,eAAe2d,aAAa2F,EAAE3a,IACnC,IAEA,IAGL7Q,EAAUkI,eAAe2d,aAAa2F,EAAE3a,IACnC,IAEA,KAObwD,EAAMwuC,2BAA6B,SAAUr3B,KAE7CnX,EAAMyuC,wBAA0B,SAAUt3B,GACxC,MAAInX,GAAMqrC,SACD,SAEA,SAGXrrC,EAAM0uC,mBAAqB,SAAUv3B,GACnC,MAAInX,GAAMqrC,SACD,EAEA,IAGXrrC,EAAM2uC,mBAAqB,SAAUx3B,GACnC,MAAInX,GAAMqrC,SACD,SAEA,UAGXrrC,EAAMytC,wCAA0C,SAAUt2B,GACxD,MAAInX,GAAMqrC,SACD,gBAAkBrrC,EAAMqtC,aAAa/8B,YAAY,GAAK,IAEtD,aAAetQ,EAAMqtC,aAAa/8B,YAAY,GAAK,QAG9DtQ,EAAM2tC,mCAAqC,SAAUx2B,GACnD,GAAIy3B,GAASxjD,QAAQoB,KAAKb,EAAUkI,eAAe4c,MAAMo+B,SACzD,OAAI7uC,GAAMqrC,SACD,iBAAmBrrC,EAAM8uC,SAASF,EAAOv6B,QAAQ8C,IAAM,IAEvD,aAAenX,EAAM8uC,SAASF,EAAOv6B,QAAQ8C,IAAM,SAG9DnX,EAAM+uC,oCAAsC,SAAU53B,GACpD,MAAInX,GAAMqrC,SAAV,sBAMFrrC,EAAMgvC,0CAA4C,SAAU73B,GAC1D,MAAInX,GAAMqrC,SACD,cAAgBrrC,EAAMyrC,YAAc,IAAM,OAE1C,iBAAmBzrC,EAAMyc,QAAU,IAAM,KAGpDzc,EAAMivC,sCAAwC,SAAU93B,GACtD,MAAInX,GAAMqrC,SACD,OAEA,QAGXrrC,EAAMkvC,uCAAyC,SAAU/3B,GACvD,MAAInX,GAAMqrC,SACD,OAEA,QAGXrrC,EAAMmvC,2BAA6B,SAAUC,GAC3C,MAAIpvC,GAAMqrC,UAEN+D,EAAM,GAAKpvC,EAAMqtC,aAAa/8B,YAAY,GAC1C8+B,EAAM,GAAKpvC,EAAMqtC,aAAa/8B,YAAY,KAI1C8+B,EAAM,GAAKpvC,EAAMqtC,aAAa/8B,YAAY,GAC1C8+B,EAAM,GAAKpvC,EAAMqtC,aAAa/8B,YAAY,KAIhDtQ,EAAMqvC,QAAU,SAAUl4B,GACxB,MAAO,IAAMA,EAAEm4B,OAAS,IAAMn4B,EAAEo4B,OAAS,IAAMp4B,EAAEm4B,OAAS,IAAMn4B,EAAEq4B,KAAO,IAAMr4B,EAAEs4B,KAAO,IAAMt4B,EAAEq4B,MAMlGxvC,EAAM0vC,eAAiB,WACrB,GAAIC,IACAr3B,EAAGtY,EAAMwrC,WAAWoE,GACpBliB,EAAG1tB,EAAMwrC,WAAWqE,IAEpBC,GACAx3B,EAAGtY,EAAMsrC,aAAasE,GACtBliB,EAAG1tB,EAAMsrC,aAAauE,GAE1B,OAAO,IAAMF,EAAKr3B,EAAI,IAAMq3B,EAAKjiB,EAAI,IAAMiiB,EAAKr3B,EAAI,IAAMw3B,EAAGpiB,EAAI,IAAMoiB,EAAGx3B,EAAI,IAAMw3B,EAAGpiB,GAQzF1tB,EAAM+vC,gBAAkB,WACtB,GAAIC,GAAWtwB,EAA6BuwB,kBAAkBtkD,EAAUkI,eAAe4c,KAAMzQ,EAAMwrC,WAAWhvC,GAAIwD,EAAMsrC,aAAa9uC,GACrI,OAAIwzC,GAASE,MACJ,QAEiB,IAApBF,EAASG,SACXH,EAAWtwB,EAA6BuwB,kBAAkBtkD,EAAUkI,eAAe4c,KAAMzQ,EAAMsrC,aAAa9uC,GAAIwD,EAAMwrC,WAAWhvC,IAC7HwzC,EAASE,OACJ,QAGJ,OAGXlwC,EAAMowC,uBAAyB,SAAUj5B,GACvC,GAAIk5B,GAAMrwC,EAAMstC,IAAIr4B,OAAO,mCAAmC,GAAG,GAC7DxlB,EAAY2B,EAAasvB,aAAavJ,EAAE3a,IACxCmkB,EAAYh1B,EAAUuwB,gBAAgBzsB,GACtC6wB,EAActgB,EAAM7N,IAAI3C,mBAAmBC,GAAWyI,qBAAqByoB,GAAWL,WAC1F,OAAoBlzB,UAAhBkzB,GAA6B+vB,EAAItiD,MAAMjD,OAAS,GAAKw1B,EAAYjM,QAAQg8B,EAAItiD,QAAU,EAClF,aAEA,OAGXiS,EAAMswC,eAAiB,SAAUn5B,GAC/B,GAAyB/pB,SAArB4S,EAAMwrC,WAA0B,CAClC,GAAI4D,GAAQpvC,EAAMmvC,2BAA2BoB,GAAGnB,MAAMllD,OAClDouB,EAAI82B,EAAM,GACV1hB,EAAI0hB,EAAM,EACdpvC,GAAMstC,IAAIr4B,OAAO,6BAA6B9U,KAAK,IAAK,IAAMH,EAAMwrC,WAAWoE,GAAK,IAAM5vC,EAAMwrC,WAAWqE,GAAK,KAAOv3B,EAAI,IAAMoV,KAIrI1tB,EAAMwwC,WAAa,SAAUr5B,GACoB/pB,SAA3CzB,EAAUkI,eAAe0c,eAC3BvQ,EAAM8U,OAAO,WACXnpB,EAAUkI,eAAe0c,cAAgBnjB,UAI/C4S,EAAMywC,YAAc,SAAUt5B,GAC5B9pB,QAAQszC,MAAM,eAAgBxpB,GACiB/pB,SAA3CzB,EAAUkI,eAAe0c,gBAC3BggC,GAAG17C,MAAMutB,kBACTz2B,EAAUkI,eAAe0c,cAAgB4G,EAAE3a,GAC3C7Q,EAAUkI,eAAeud,aAAapR,EAAMouC,YAAYj3B,IACxDnX,EAAM8U,OAAO,WACX9U,EAAM8sC,YAGNnhD,EAAUkI,eAAe0c,gBAAkB4G,EAAE3a,IAC/C+zC,GAAG17C,MAAMutB,mBAGbpiB,EAAM0wC,gBAAkB,SAAUv5B,GAChCnX,EAAMgtC,KAAK71B,IAEbnX,EAAM2wC,oBAAsB,SAAUx5B,GACpC9pB,QAAQszC,MAAM,aAAcxpB,GAE5Bi0B,EAAuBwF,eAAez5B,EAAGxrB,EAAUkI,eAAe4c,MAClEzQ,EAAM8sC,UAER9sC,EAAM6wC,gBAAkB,SAAU15B,GAChCnX,EAAMitC,WAAW91B,GACjBnX,EAAM8wC,uBAER9wC,EAAM+wC,YAAc,SAAU55B,GAI5B,GAAIk5B,GAAMrwC,EAAMstC,IAAIr4B,OAAO,mCAAmC,GAAG,EACjEtpB,GAAUkI,eAAeud,aAAai/B,EAAItiD,OAE1CsiD,EAAInjC,MAAM8jC,gBAAkBhxC,EAAMowC,uBAAuBj5B,IAE3DnX,EAAMixC,cAAgB,SAAU95B,GAC9BxrB,EAAUkI,eAAesc,YAAa,GAExCnQ,EAAMkxC,eAAiB,SAAU/5B,GAC/BxrB,EAAUkI,eAAesc,YAAa,GAExCnQ,EAAMmxC,gBAAkB,SAAUh6B,GAChCnX,EAAMktC,WAAW/1B,GACjBnX,EAAM8wC,uBAER9wC,EAAMoxC,iBAAmB,SAAUj6B,GACjC,GAAI3a,GAAKpL,EAAaqjC,YAAYtd,EACvB,MAAP3a,GACFwD,EAAM6sC,eAAevwC,mBACnB/G,KAAM,YACNgH,OAAQ,WACRqlB,MAAOplB,EACPP,MAAOkb,IAGXnX,EAAM8U,UAER9U,EAAMgtC,KAAO,SAAU71B,GACrB,GAAIk6B,GAAgB1lD,EAAUkI,eAAe4c,KAAK,EAClD,IAA6B,mBAAlB4gC,GAET,WADAhkD,SAAQszC,MAAM,kEAAmExpB,EAQnF,KALA,GAIIm6B,GAJAC,EAAengD,EAAa+kB,gBAAgBk7B,GAAe97C,KAC3Di8C,EAAc,KACdxmB,EAAY,KACZymB,GAAYt6B,GAETs6B,EAAS3mD,OAAS,GAAG,CAE1B,GADAwmD,EAAcG,EAAStc,MACnBmc,EAAYjtC,OAAO,GAAGjW,OAASijD,EACjC,GAAqB,UAAjBE,GACED,EAAYlsC,YAAcosC,GAA+B,OAAhBA,KAC3CA,EAAcF,EAAYlsC,cAExBksC,EAAYlsC,YAAc4lB,GAA2B,OAAdA,KACzCA,EAAYsmB,EAAYlsC,iBAErB,IAAqB,YAAjBmsC,EAA4B,EACjCD,EAAYptC,YAAcstC,GAA+B,OAAhBA,KAC3CA,EAAcF,EAAYptC,YAG5B,IAAIjR,GAAMq+C,EAAYptC,YAAcotC,EAAYntC,WAC5ClR,EAAM+3B,GAA2B,OAAdA,KACrBA,EAAY/3B,GAIlBw+C,EAAWA,EAASC,OAAOtG,EAAuBuG,aAAaL,EAAa3lD,EAAUkI,eAAe4c,OAGvG,MADApjB,SAAQszC,MAAM,2BAA4B4Q,EAAcp6B,EAAGq6B,EAAaxmB,GACpD,OAAhBwmB,GAAsC,OAAdxmB,MAC1B39B,SAAQszC,MAAM,wDAAyDxpB,OAGzEnmB,GAAoBiO,WAAWuyC,EAAaxmB,IAkB9ChrB,EAAM8uC,SAAW,SAAU8C,GACzB,GAAI5xC,EAAMqrC,SACR,GAAIwG,GAAgB7xC,EAAM8C,OACtBjY,EAASmV,EAAM0rC,gBAEnB,IAAImG,GAAgB7xC,EAAM6C,MACtBhY,EAASmV,EAAMqc,OAErB,IAAImF,GAASowB,EAAQjmD,EAAUkI,eAAe4c,KAAK3lB,OAAS+mD,CAK5D,OAJI7xC,GAAMisC,qBACRzqB,GAAUxhB,EAAMqtC,aAAald,SAE/B3O,GAAU32B,GAGZmV,EAAM8xC,cAAgB,SAAUC,GAC9B,GAAI/xC,EAAMqrC,SACR,GAAIxgD,GAASmV,EAAMyrC,YACfuG,EAAehyC,EAAM6C,MAAQhY,MAEjC,IAAIA,GAASmV,EAAMyc,QACfu1B,EAAehyC,EAAM8C,OAASjY,CAEpC,IAAI22B,GAASuwB,EAAaC,EAAehyC,EAAMqtC,aAAald,OAE5D,OADA3O,IAAU32B,GAOZmV,EAAMvM,QAAUA,EAChBuM,EAAM6C,MAAQ,EACd7C,EAAM8C,OAAS,EAEf9C,EAAMU,WAAa,GAEYtT,SAA3B4S,EAAM7N,IAAIrG,OAAO6U,QACnBX,EAAMU,WAAaV,EAAM7N,IAAIrG,OAAO6U,MAAMC,WAG5CZ,EAAMqtC,aAAekD,GAAG0B,SAAS9E,OAAOpB,YAAY/rC,EAAM+rC,aAAamG,GAAG,OAAQlyC,EAAMmtC,MAExFntC,EAAMstC,IAAMiD,GAAGt7B,OAAOxhB,EAAQ,IAAIuY,OAAO,OAAO7L,KAAK,QAAS,QAAQA,KAAK,SAAU,QAAQ+M,MAAM,mBAAoBlN,EAAMU,YAAY2wB,KAAKrxB,EAAMqtC,cAAc6E,GAAG,gBAAiB,MAAMA,GAAG,YAAalyC,EAAMswC,gBAAgB4B,GAAG,QAASlyC,EAAMwwC,YAAYxkC,OAAO,KAEvQhM,EAAMmyC,WAAY,EAClBnyC,EAAMoyC,UAAY,SAAUv9C,GAO1B,GANIA,EAAM+pB,WAAa5e,EAAMmyC,WACoB/kD,SAA3CzB,EAAUkI,eAAe2c,gBAC3B7kB,EAAUkI,eAAe2c,cAAgB7kB,EAAUkI,eAAekc,eAClE/P,EAAMmyC,WAAY,IAGjBt9C,EAAM+pB,UAAY5e,EAAMmyC,UAAW,CACtCnyC,EAAMmyC,WAAY,CAClB,IAAIE,GAAU3yB,EAA6B4yB,QAAQ3mD,EAAUkI,eAAe4c,KAAM9kB,EAAUkI,eAAe2c,cAAe7kB,EAAUkI,eAAekc,eACnJpkB,GAAUkI,eAAe2c,cAAgBpjB,OACzB,OAAZilD,GACFvhD,EAAewL,mBACb/G,KAAM,YACNgH,OAAQ,UACR2D,KAAMmyC,MAMdryC,EAAMwtC,aAAextC,EAAMstC,IAAIthC,OAAO,KAAKkB,MAAM,UAAW,GAC5DlN,EAAMuyC,UAAYvyC,EAAMstC,IAAIthC,OAAO,KAAKA,OAAO,QAAQupB,KAAK,UAC5Dv1B,EAAMwyC,mBAAqBxyC,EAAMstC,IAAIthC,OAAO,KAC5ChM,EAAMwyC,mBAAmBxmC,OAAO,QAEhChM,EAAMstC,IAAMttC,EAAMstC,IAAIthC,OAAO,KAAKkB,MAAM,UAAW,GAEnDlN,EAAMqtC,aAAa/8B,UAAU3kB,EAAUkI,eAAeyc,WACtDtQ,EAAMqtC,aAAald,MAAMxkC,EAAUkI,eAAewc,aAelDrQ,EAAM8wC,oBAAsB,WAE1B9wC,EAAMstC,IAAII,UAAU,kCAAkCxgC,MAAM,OAAQ,SAAUiK,GAC5E,GAAIxW,GAAQ1P,EAAsBnF,OAAO6U,MAAM8xC,KAI/C,OAHkC,mBAAvBzyC,GAAMsrC,cAAgCn0B,EAAE3a,KAAOwD,EAAMsrC,aAAa9uC,KAC3EmE,EAAQ1P,EAAsBnF,OAAO6U,MAAMyF,MAEtCzF,IAGTX,EAAMstC,IAAII,UAAU,0BAA0BxgC,MAAM,SAAU,SAAUiK,GACtE,MAAInX,GAAMurC,eAAiBp0B,EAClBlmB,EAAsBnF,OAAO6U,MAAMwF,OAEnClV,EAAsBnF,OAAO6U,MAAM8D,OAI9CzE,EAAMstC,IAAIr4B,OAAO,gCAAgC9U,KAAK,IAAKH,EAAM0vC,gBAAgBxiC,MAAM,SAAUlN,EAAM+vC,kBAkBzG/vC,EAAM8sC,OAAS,WACb9sC,EAAM4sC,gBAAkB5sC,EAAMqtC,aAAald,OAC3C,IAAIhlC,EAEJ6U,GAAM6C,MAAQ8S,SAAS46B,GAAGt7B,OAAOjV,EAAMvM,QAAQ,IAAIyZ,MAAM,SAAU,IACnElN,EAAM8C,OAAS6S,SAAS46B,GAAGt7B,OAAOjV,EAAMvM,QAAQ,IAAIyZ,MAAM,UAAW,IAEjElN,EAAM2rC,WAAWE,SACnB7rC,EAAMstC,IAAI3B,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUxG,KAAK,YAAaH,EAAMutC,0BAGnFvtC,EAAMstC,IAAIntC,KAAK,YAAaH,EAAMutC,0BAIhCvtC,EAAMqrC,SACRrrC,EAAMuyC,UAAUpyC,KAAK,YAAa,aAAeH,EAAM6C,MAAQ,EAAI,KAAO7C,EAAM8C,OAAS,IAAM,KAE/F9C,EAAMuyC,UAAUpyC,KAAK,YAAa,cAAgBH,EAAM6C,MAAQ,IAAM,IAAM7C,EAAM8C,OAAS,EAAI,eAI7F9C,EAAMqrC,UACRrrC,EAAMwyC,mBAAmBryC,KAAK,YAAa,aAAeH,EAAM6C,MAAQ,SAExE7C,EAAMwyC,mBAAmBv9B,OAAO,QAAQ9U,KAAK,cAAe,OAAOo1B,KAAK,SAAWlwB,KAAKC,MAAmC,IAA7BtF,EAAMqtC,aAAald,SAAiB,QAElInwB,EAAMwyC,mBAAmBryC,KAAK,YAAa,gBAAkBH,EAAM8C,OAAS,KAE5E9C,EAAMwyC,mBAAmBv9B,OAAO,QAAQ9U,KAAK,cAAe,SAASo1B,KAAK,SAAWlwB,KAAKC,MAAmC,IAA7BtF,EAAMqtC,aAAald,SAAiB,OAMtInwB,EAAMwtC,aAAartC,KAAK,YAAaH,EAAMytC,wCAG3C,IAAIiF,GAAkB1yC,EAAMwtC,aAAaE,UAAU,+BAA+BnhD,KAAKZ,EAAUkI,eAAe4c,KAAM,SAAU0G,GAC5H,MAAOA,KAEPw7B,EAAmBD,EAAgBE,QACnCC,EAAmBH,EAAgBI,MACvCH,GAAmBA,EAAiB3mC,OAAO,KAAK7L,KAAK,QAAS,6BAE9DwyC,EAAiB3mC,OAAO,OAExB,IAAI+mC,GAAiBJ,EAAiB9L,OAAO,SAAU1vB,GACnD,GAAIO,GAAYtmB,EAAa+kB,gBAAgBgB,GAAG5hB,IAChD,OAAqB,SAAdmiB,IACN1L,OAAO,KAAK7L,KAAK,QAAS,0BAA0BA,KAAK,YAAaH,EAAM+uC,qCAAqCmD,GAAG,QAASlyC,EAAMoxC,iBAExI2B,GAAe/mC,OAAO,UAAUkB,MAAM,OAAQlN,EAAM7N,IAAIrG,OAAO6U,MAAMyF,MAAMjG,KAAK,IAAK,GAErF4yC,EAAe/mC,OAAO,QAAQkB,MAAM,SAAUlN,EAAM7N,IAAIrG,OAAO6U,MAAM8xC,OAAOtyC,KAAK,IAAK,qBAEtFwyC,EAAiB9L,OAAO,SAAU1vB,GAChC,GAAIO,GAAYtmB,EAAa+kB,gBAAgBgB,GAAG5hB,IAChD,OAAqB,YAAdmiB,GAAyC,UAAdA,IACjC1L,OAAO,QAAQ7L,KAAK,QAAS,oCAAoC+M,MAAM,OAAQlN,EAAM7N,IAAIrG,OAAO6U,MAAM4E,YAAYd,MAErHiuC,EAAgBvyC,KAAK,YAAaH,EAAM2tC,oCAExC+E,EAAgBz9B,OAAO,QAAQsgB,KAAKv1B,EAAMquC,qBAC1CqE,EAAgBz9B,OAAO,qCAAqC9U,KAAK,YAAaH,EAAMgvC,2CAA2C9hC,MAAM,QAASlN,EAAMivC,uCAAuC/hC,MAAM,SAAUlN,EAAMkvC,wCAE7MlvC,EAAM2rC,WAAWE,SACnBgH,EAAmBA,EAAiBlH,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAU80B,SAGrFoX,EAAiBpX,SAEnBoX,EAAiB59B,OAAO,QAAQ/H,MAAM,eAAgB,EAOtD,IAAI0+B,KACJR,GAAuB4H,yBAAyBrnD,EAAUkI,eAAe4c,KACzE,KAAK,GAAItlB,GAAI,EAAGA,EAAIQ,EAAUkI,eAAe4c,KAAK3lB,SAAUK,EAG1D,IAAK,GADD8nD,GAAa7hD,EAAa+kB,gBAAgBxqB,EAAUkI,eAAe4c,KAAKtlB,IAAI+Q,MACvE+kC,EAAK,EAAGA,EAAKgS,EAAWnoD,SAAUm2C,EACrCgS,EAAWhS,GAAIiS,UACjBtH,EAAM1+C,KAAK+lD,EAAWhS,GAK5B,IAAIqK,GAAel6C,EAAaqvB,YAAY90B,EAAUkI,eAAekc,gBACjEojC,EAAkB/hD,EAAaqvB,YAAY90B,EAAUkI,eAAe0c,eACpE6iC,EAAuBhiD,EAAaqvB,YAAY90B,EAAUkI,eAAemc,oBACzEqjC,EAAqBjiD,EAAaqvB,YAAY90B,EAAUkI,eAAeoc,iBACtD7iB,UAAjBk+C,GAA+BA,EAAa4H,WAC9C7lD,QAAQszC,MAAM,oBACdh1C,EAAUkI,eAAekc,eAAiB3iB,QAEfA,SAAzBgmD,GAAuCA,EAAqBF,WAC9D7lD,QAAQszC,MAAM,oBACdh1C,EAAUkI,eAAemc,mBAAqB5iB,OAC9CzB,EAAUkI,eAAeoc,iBAAmB7iB,QAEnBA,SAAvBimD,GAAqCA,EAAmBH,WAC1D7lD,QAAQszC,MAAM,oBACdh1C,EAAUkI,eAAemc,mBAAqB5iB,OAC9CzB,EAAUkI,eAAeoc,iBAAmB7iB,QAEtBA,SAApB+lD,GAAkCA,EAAgBD,WACpD7lD,QAAQszC,MAAM,gDACdh1C,EAAUkI,eAAe0c,cAAgBnjB,OAc3C,KAAK,GAFD+rC,MACAma,EAAWthD,EAAYkL,UAAUi8B,MAC5BlhC,EAAI,EAAGA,EAAIq7C,EAASxoD,SAAUmN,EACrC,IAAK,GAAI9M,GAAI,EAAGA,EAAIQ,EAAUkI,eAAe4c,KAAK3lB,OAAS,IAAKK,EAAG,CACjE,GAAIsI,GAAUrC,EAAaktB,qBAAqB3yB,EAAUkI,eAAe4c,KAAKtlB,GAAImoD,EAASr7C,GAAGopB,MAC1FkyB,EAAgBniD,EAAaktB,qBAAqB3yB,EAAUkI,eAAe4c,KAAKtlB,EAAI,GAAImoD,EAASr7C,GAAGmpB,OACxF,QAAZ3tB,GAGkB,OAAlB8/C,GAGC9/C,EAAQy/C,WAGTvnD,EAAUkI,eAAe2d,aAAa+hC,EAAc/2C,KAAQ+2C,EAAcL,UAG9E/Z,EAAMjsC,KAAKomD,EAASr7C,IAIxB2zC,EAAMh/C,QAAQ,SAAUuqB,GACtBA,EAAEy4B,GAAK5vC,EAAM8uC,SAAS33B,EAAEq8B,QACxBr8B,EAAE04B,GAAK7vC,EAAM8xC,cAAc36B,EAAEs8B,eAE/Bta,EAAMvsC,QAAQ,SAAUuqB,GACtBA,EAAEm4B,OAAStvC,EAAM8uC,SAAS33B,EAAEu8B,YAC5Bv8B,EAAEo4B,OAASvvC,EAAM8xC,cAAc36B,EAAEw8B,iBACjCx8B,EAAEs4B,KAAOzvC,EAAM8uC,SAAS33B,EAAEy8B,UAC1Bz8B,EAAEq4B,KAAOxvC,EAAM8xC,cAAc36B,EAAE08B,gBAUjC,IAAIC,GAAU9zC,EAAMstC,IAAII,UAAU,uBAAuBnhD,KAAKq/C,EAAO,SAAUz0B,GAC3E,MAAOA,GAAE3a,KAETu3C,EAAWD,EAAQlB,QACnBoB,EAAWF,EAAQhB,MASvBiB,GAAWA,EAAS/nC,OAAO,KAAK7L,KAAK,QAAS,qBAAqBA,KAAK,iBAAkB,aAAa+xC,GAAG,QAASlyC,EAAMywC,aAAayB,GAAG,YAAalyC,EAAM6wC,gBAE5J,IAAIoD,GAASF,EAAS/nC,OAAO,UAAU7L,KAAK,QAAS,2BAA2B+M,MAAM,SAAUlN,EAAM7N,IAAIrG,OAAO6U,MAAM8D,KAEnHzE,GAAM2rC,WAAWC,MACnBqI,EAAO9zC,KAAK,IAAK,GAAGwrC,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUxG,KAAK,IAAK,KAG/E8zC,EAAO9zC,KAAK,IAAK,KAEnB4zC,EAAS/nC,OAAO,QAAQ7L,KAAK,QAAS,yBAItC4zC,EAAS5zC,KAAK,YAAa,SAAUgX,GACnC,GAAImK,GAAW31B,EAAUkI,eAAe4d,oBAAoB0F,EAAE3a,GAC9D,IAAwB,mBAAb8kB,GAA0B,CACnC,GAAIhJ,GAAIgJ,EAAS,GACboM,EAAIpM,EAAS,EAEjB,OADA31B,GAAUkI,eAAeke,oBAAoBoF,EAAE3a,GAAIpP,QAC5C,aAAekrB,EAAI,IAAMoV,EAAI,IAAM1tB,EAAMiuC,gCAQlD+F,EADEh0C,EAAM2rC,WAAWC,MACRoI,EAASrI,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUxG,KAAK,YAAa,SAAUgX,GAC/F,GAAIzF,GAAmB/lB,EAAUkI,eAAe4d,oBAAoB0F,EAAE3a,GACtE,IAAgC,mBAArBkV,GAAkC,CAC3C,GAAI4G,GAAI5G,EAAiB,GACrBgc,EAAIhc,EAAiB,EAEzB,OADA/lB,GAAUkI,eAAeke,oBAAoBoF,EAAE3a,GAAIpP,QAC5C,aAAekrB,EAAI,IAAMoV,EAAI,IAEpC,MAAO,mBAER+N,SAEQuY,EAAS7zC,KAAK,YAAa,SAAUgX,GAC9C,GAAIzF,GAAmB/lB,EAAUkI,eAAe4d,oBAAoB0F,EAAE3a,GACtE,IAAgC,mBAArBkV,GAAkC,CAC3C,GAAI4G,GAAI5G,EAAiB,GACrBgc,EAAIhc,EAAiB,EAEzB,OADA/lB,GAAUkI,eAAeke,oBAAoBoF,EAAE3a,GAAIpP,QAC5C,aAAekrB,EAAI,IAAMoV,EAAI,IAEpC,MAAO,mBAER+N,SAELuY,EAAS/+B,OAAO,QAAQ/H,MAAM,eAAgB,GAI9C4mC,EAAQ7+B,OAAO,QAAQ9U,KAAK,IAAKH,EAAM0uC,oBAAoBvuC,KAAK,IAAKH,EAAM2uC,oBAAoBxuC,KAAK,cAAeH,EAAMyuC,yBAAyBtuC,KAAK,YAAaH,EAAMwuC,4BAA4BjZ,KAAKv1B,EAAMouC,aAGjN0F,EAAQ7+B,OAAO,kCAAkC/H,MAAM,OAAQ,SAAUiK,GACvE,GAAIxW,GAAQX,EAAM7N,IAAIrG,OAAO6U,MAAM8xC,KAInC,OAHkC,mBAAvBzyC,GAAMsrC,cAAgCn0B,EAAE3a,KAAOwD,EAAMsrC,aAAa9uC,KAC3EmE,EAAQX,EAAM7N,IAAIrG,OAAO6U,MAAMyF,MAE1BzF,IACNuM,MAAM,SAAU,SAAUiK,GAC3B,MAAIxrB,GAAUkI,eAAe2d,aAAa2F,EAAE3a,IACnCwD,EAAM7N,IAAIrG,OAAO6U,MAAMkuB,IAEvB7uB,EAAM7N,IAAIrG,OAAO6U,MAAM8D,OAK9BzE,EAAM2rC,WAAWC,MACnBkI,EAAQnI,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUxG,KAAK,YAAa,SAAUgX,GACnF,MAAO,aAAeA,EAAEy4B,GAAK,IAAMz4B,EAAE04B,GAAK,IAAM7vC,EAAMiuC,+BAGxD6F,EAAQ3zC,KAAK,YAAa,SAAUgX,GAClC,MAAO,aAAeA,EAAEy4B,GAAK,IAAMz4B,EAAE04B,GAAK,IAAM7vC,EAAMiuC,+BAMX7gD,SAA3CzB,EAAUkI,eAAe0c,eAC3BvQ,EAAMstC,IAAII,UAAU,6BAA6BjS,QAInD,IAAIqQ,GAAc9rC,EAAMstC,IAAIr4B,OAAO,4BACnC,IAA0B,OAAtB62B,EAAY,GAAG,GAAa,CAC9BA,EAAcgI,EAAQjN,OAAO,SAAU1vB,GACrC,MAAOA,GAAE3a,KAAO7Q,EAAUkI,eAAe0c,gBACxCvE,OAAO,KAAK7L,KAAK,QAAS,4BAE7B2rC,EAAY9/B,OAAO,UAAUkB,MAAM,OAAQ,YAAY/M,KAAK,IAAK,IAAI+M,MAAM,SAAU,WAEjFlN,EAAM2rC,WAAWG,aACnBA,EAAY5+B,MAAM,UAAW,GAAGy+B,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUuG,MAAM,UAAW,IAGpG4+B,EAAY9/B,OAAO,QAAQupB,KAAKv1B,EAAMuuC,+BAA+BpuC,KAAK,IAAK,KAAKA,KAAK,IAAK,KAAKA,KAAK,cAAe,UAAU+xC,GAAG,QAASlyC,EAAM2wC,qBAE/I3wC,EAAM2rC,WAAWG,aACnBA,EAAY5+B,MAAM,UAAW,GAAGy+B,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUuG,MAAM,UAAW,GAGpG4+B,EAAY9/B,OAAO,QAAQupB,KAAK,QAAQp1B,KAAK,IAAK,KAAKA,KAAK,IAAK,IAAKA,KAAK,cAAe,UAAU+xC,GAAG,QAASlyC,EAAM0wC,iBAElH1wC,EAAM2rC,WAAWG,aACnBA,EAAY5+B,MAAM,UAAW,GAAGy+B,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUuG,MAAM,UAAW,EAGpG,IAAIgnC,GAAgBpI,EAAY9/B,OAAO,iBAAiB7L,KAAK,SAAU,IAAIA,KAAK,IAAK,IAAIA,KAAK,IAAK,KAAKA,KAAK,QAAS,EAElHH,GAAM2rC,WAAWG,YACnBoI,EAAcvI,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUxG,KAAK,QAAS,KAG7E+zC,EAAc/zC,KAAK,QAAS,KAE9B+zC,EAAcloC,OAAO,cAAcA,OAAO,SAAS7L,KAAK,QAASH,EAAMouC,aAAalhC,MAAM,QAAS,QAAQA,MAAM,SAAU,QAAQA,MAAM,UAAW,QAAQA,MAAM,SAAU,KAAKA,MAAM,mBAAoBlN,EAAMowC,wBAAwB8B,GAAG,QAASlyC,EAAM+wC,aAAamB,GAAG,QAASlyC,EAAMixC,eAAeiB,GAAG,OAAQlyC,EAAMkxC,gBAE1R,IAA5BgD,EAAc,GAAGppD,SACnBopD,EAAcj/B,OAAO,SAAS,GAAG,GAAGynB,QACpCwX,EAAcj/B,OAAO,SAAS,GAAG,GAAGA,cAGtCjV,GAAMstC,IAAIr4B,OAAO,kCAAkCsgB,KAAKv1B,EAAMuuC,8BAKhEvuC,GAAMstC,IAAII,UAAU,sBAAsBv0B,KAAK,SAAU7pB,EAAGglB,GAC1D,MAAIhlB,GAAEkN,KAAO7Q,EAAUkI,eAAe0c,cAC7B,EAEL+D,EAAE9X,KAAO7Q,EAAUkI,eAAe0c,cAC7B,GAEF,GAQT,IAAI4jC,GAAUn0C,EAAMstC,IAAII,UAAU,2BAA2BnhD,KAAK4sC,EAAO,SAAUhiB,GAE/E,MAAO,IAAMA,EAAEiK,OAAS,IAAMjK,EAAEkK,OAEhC+yB,EAAWD,EAAQvB,QACnByB,EAAWF,EAAQrB,MAiDvB,IAzCAsB,EAAWA,EAASE,OAAO,IAAK,gBAAgBn0C,KAAK,QAAS,0BAG9Di0C,EAASpoC,OAAO,QAAQ7L,KAAK,QAAS,0BAA0B+M,MAAM,eAAgBlN,EAAMmuC,mCAAmC+D,GAAG,YAAalyC,EAAMmxC,iBAErJiD,EAASpoC,OAAO,QAAQ7L,KAAK,QAAS,qBAAqB+M,MAAM,eAAgBlN,EAAMkuC,8BAEnFluC,EAAM2rC,WAAWxS,OACnBib,EAASlnC,MAAM,UAAW,GAAGy+B,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUuG,MAAM,UAAW,GAI7FlN,EAAM2rC,WAAWxS,MACnBkb,EAAS1I,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUuG,MAAM,UAAW,GAAGuuB,SAG9E4Y,EAAS5Y,SAGX0Y,EAAQzG,UAAU,sBAAsBxgC,MAAM,SAAU,SAAUiK,GAChE,MAAInX,GAAMurC,eAAiBp0B,EAClBnX,EAAM7N,IAAIrG,OAAO6U,MAAMwF,OAEvBnG,EAAM7N,IAAIrG,OAAO6U,MAAM8D,OAK9BzE,EAAM2rC,WAAWxS,MACnBgb,EAAQzG,UAAU,sBAAsB/B,aAAahlC,SAAS3G,EAAM2rC,WAAWhlC,UAAUxG,KAAK,IAAKH,EAAMqvC,SAASniC,MAAM,eAAgBlN,EAAMkuC,8BAA8BhhC,MAAM,UAAW,GAG7LinC,EAAQzG,UAAU,sBAAsBvtC,KAAK,IAAKH,EAAMqvC,SAASniC,MAAM,eAAgBlN,EAAMkuC,8BAG/FiG,EAAQzG,UAAU,2BAA2BvtC,KAAK,IAAKH,EAAMqvC,SAI7DrvC,EAAMstC,IAAII,UAAU,yBAAyBjS,SAC7Cz7B,EAAMstC,IAAII,UAAU,gCAAgCjS,SAC3BruC,SAArB4S,EAAMwrC,WAA0B,CAClCxrC,EAAMstC,IAAIthC,OAAO,QAAQ7L,KAAK,QAAS,wBAAwB+M,MAAM,SAAU,SAASA,MAAM,eAAgBlN,EAAMkuC,6BAEtGluC,GAAMstC,IAAIthC,OAAO,QAAQ7L,KAAK,QAAS,+BAA+BA,KAAK,IAAKH,EAAM0vC,gBAAgBxiC,MAAM,SAAUlN,EAAM+vC,iBAAiB7iC,MAAM,eAAgBlN,EAAMkuC,8BAMrLluC,EAAMqrC,UACRrrC,EAAMusC,iBAAmBvsC,EAAM0rC,YAAc1rC,EAAM8C,QAAU,EAAI9C,EAAMgsC,cACvEhsC,EAAMwsC,iBAAmBxsC,EAAM8C,OAAS9C,EAAMgsC,aAC9ChsC,EAAMysC,gBAAkBzsC,EAAMyrC,YAAczrC,EAAM6C,OAAS,EAAI7C,EAAMgsC,cACrEhsC,EAAM0sC,gBAAkB1sC,EAAM6C,MAAQ7C,EAAMgsC,eAE5ChsC,EAAMusC,iBAAmBvsC,EAAMyc,QAAUzc,EAAM8C,QAAU,EAAI9C,EAAMgsC,cACnEhsC,EAAMwsC,iBAAmBxsC,EAAM8C,OAAS9C,EAAMgsC,aAC9ChsC,EAAMysC,gBAAkBzsC,EAAMqc,QAAUrc,EAAM6C,OAAS,EAAI7C,EAAMgsC,cACjEhsC,EAAM0sC,gBAAkB1sC,EAAM6C,MAAQ7C,EAAMgsC,cAM9ChsC,EAAMmsC,sBAAwBnsC,EAAMstC,IAAIiH,OAAOC,UAAU9mB,EACzD1tB,EAAMosC,oBAAsBpsC,EAAMmsC,sBAAwBnsC,EAAMstC,IAAIiH,OAAOC,UAAU1xC,OACrF9C,EAAMqsC,uBAAyBrsC,EAAMstC,IAAIiH,OAAOC,UAAUl8B,EAC1DtY,EAAMssC,qBAAuBtsC,EAAMqsC,uBAAyBrsC,EAAMstC,IAAIiH,OAAOC,UAAU3xC,YAOjGzX,QAAQC,OAAO,aAAauU,UAAU,OACpC,YACA,SAAUjU,GACR,OACE48C,SAAU,gGACVxoC,SAAU,IACVhD,SAAS,EACTmD,KAAM,SAAkBF,EAAOvM,EAAS8S,GAEtC,GACIhY,GAAI89B,EAAKG,EADTpsB,EAAS3M,EAAQ4M,KAAK,UAAU,EAIpCL,GAAMa,OAAO,iBAAkB,SAAUC,EAAUC,GAC5CrU,EAAEC,cAAcqT,EAAM7N,IAAItG,OACxBa,EAAEC,cAAcqT,EAAMvN,OAAOlG,OACC,IAA7ByT,EAAMvN,OAAOlG,KAAKzB,SAChBiW,EAAS1J,KAAOyJ,EAASzJ,IAAM0J,EAASzJ,KAAOwJ,EAASxJ,KAC1D0I,EAAMy0C,YAAYz0C,KAKzB,GACHA,EAAMa,OAAO,uBAAwB,SAAUC,EAAUC,GAClDrU,EAAEC,cAAcqT,EAAM7N,IAAItG,OACxBa,EAAEC,cAAcqT,EAAMvN,OAAOlG,OACC,IAA7ByT,EAAMvN,OAAOlG,KAAKzB,QACpBkV,EAAMy0C,YAAYz0C,KAIvB,GAMHA,EAAMy0C,YAAc,SAAUz0C,GAC5B,GAAI0C,GAAMtC,EAAOuC,WAAW,KAC5BpU,GAAKyR,EAAM7N,IAAIhE,mBAAmB,OAElCk+B,EAAMrsB,EAAMvN,OAAO65B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,YAChDC,EAAQxsB,EAAMvN,OAAOg6B,iCAAiCl+B,EAAGH,MACzDsU,EAAIE,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,QACzCJ,EAAIsB,UAAY,QAChBtB,EAAIkC,YAAc5E,EAAM7N,IAAIrG,OAAO6U,MAAM4C,MACzCb,EAAIP,KAAOnC,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMzkC,KAAKC,MAAM,EAAG,IAAM,MAAatC,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,MACpG,IAIIoxC,GAJAC,EAAYv0C,EAAOyC,MAAQ,EAC3B+xC,EAAax0C,EAAO0C,OAAS,EAC7B+xC,EAAU,EAAIroB,EAAMthB,WAAashB,EAAMI,UACvCkoB,EAAWzvC,KAAKC,MAAMtF,EAAMxN,GAAGkgB,kBAAoB1S,EAAMtN,IAAIyE,OAAOkT,WAAawqC,GAEjFE,EAAe3pD,QAAQoB,KAAK6/B,EAAIoB,OAAOqnB,GAC3CC,GAAalG,UACbzjD,QAAQwB,QAAQmoD,EAAc,SAAUxK,EAAIyK,GAG1C,IAFAN,EAAenK,EAAGtlC,SAAS,GAAGgwC,MAAM,IAAIpG,UAEjC6F,EAAa5pD,OAAS,GAC3B4pD,EAAaxnD,KAAK,IAEpBwnD,GAAa9nD,QAAQ,SAAUsoD,EAAQC,GACtB,MAAXD,GACFxyC,EAAIsB,UAAY,OAChBtB,EAAI8B,SAAS2wC,EAAYR,EAAY,EAAGC,EAAaI,EAAQ,EAAGL,EAAY,GAAIC,EAAa,MAE7FlyC,EAAIsB,UAAY,QAChBtB,EAAI8B,SAAS2wC,EAAYR,EAAY,EAAGC,EAAaI,EAAQ,EAAGL,EAAY,GAAIC,EAAa,SAKnG50C,EAAM3N,UAAUgR,4BAA4BX,EAAK,MAAO,SAAWoyC,EAA0D,EAAhD90C,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMzkC,KAAKC,MAAM,EAAG,IAAU,EAAGtC,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQ,EAAG,EAAGtD,EAAM7N,IAAIrG,OAAO6U,MAAM4C,OAAO,SAOtNnY,QAAQC,OAAO,aAAauU,UAAU,QACpC,YACA,wBACA,kBACA,mBACA,sBACA,wBACA,oBACA,SAAUjU,EAAWsF,EAAuBE,EAAiBD,EAAkBF,EAAqBa,EAAuB0W,GACzH,OACEggC,SAAU,kNACVxoC,SAAU,IACVhD,SAAS,EACTiD,SACAE,KAAM,SAAkBF,EAAOvM,EAAS8S,GACtCvG,EAAM7N,IAAMlB,EACZ+O,EAAMvN,OAAStB,EACf6O,EAAMxN,GAAK7G,EACXqU,EAAM3N,UAAYnB,EAClB8O,EAAMtN,IAAM1B,EACZgP,EAAMjN,KAAOlB,EACbmO,EAAMo1C,IAAM7sC,CACZ,IAAI8sC,GAAuB5hD,EAAQ4M,KAAK,UAAU,GAC9CD,EAAS3M,EAAQ4M,KAAK,UAAU,GAChCi1C,EAAapkB,EAAAA,EACbqkB,IAAcrkB,EAAAA,GACdskB,EAAatkB,EAAAA,EACbukB,IAAcvkB,EAAAA,GAEdwkB,EAAarwC,KAAKopB,GAAK,IAAM,EAC7BknB,EAAWtwC,KAAKopB,GAAK,IAAM,GAI/BzuB,GAAMa,OAAO,qBAAsB,WAC5BnU,EAAEC,cAAcqT,EAAM7N,IAAItG,OACxBa,EAAEC,cAAcqT,EAAMvN,OAAOlG,OACC,IAA7ByT,EAAMvN,OAAOlG,KAAKzB,QACpBkV,EAAM41C,aAIX,GAEH51C,EAAMa,OAAO,iBAAkB,SAAUC,EAAUC,GAC5CrU,EAAEC,cAAcqT,EAAM7N,IAAItG,OACxBa,EAAEC,cAAcqT,EAAMvN,OAAOlG,OACC,IAA7ByT,EAAMvN,OAAOlG,KAAKzB,SAChBiW,EAAS1J,KAAOyJ,EAASzJ,IAAM0J,EAASzJ,KAAOwJ,EAASxJ,KAC1D0I,EAAM41C,aAKb,GAEH51C,EAAMa,OAAO,uBAAwB,WAC9BnU,EAAEC,cAAcqT,EAAM7N,IAAItG,OACxBa,EAAEC,cAAcqT,EAAMvN,OAAOlG,OACC,IAA7ByT,EAAMvN,OAAOlG,KAAKzB,QACpBkV,EAAM41C,aAIX,GAEH51C,EAAMa,OAAO,uBAAwB,WACnCy0C,EAAapkB,EAAAA,EACbqkB,IAAcrkB,EAAAA,GACdskB,EAAatkB,EAAAA,EACbukB,IAAcvkB,EAAAA,KACb,GAEHlxB,EAAMa,OAAO,oBAAqB,SAAU4G,GAC1C6tC,EAAapkB,EAAAA,EACbqkB,IAAcrkB,EAAAA,GACdskB,EAAatkB,EAAAA,EACbukB,IAAcvkB,EAAAA,KACb,GAGHlxB,EAAM61C,oBAAsB,WAG1B,IAAK,GAFDC,GAAK91C,EAAM7N,IAAItG,KAAK6C,aAAasR,EAAMxN,GAAG7D,mBAAmBonD,eAAeC,yBAAyB,GAEhG7qD,EAAI,EAAGA,EAAI2qD,EAAGG,KAAKnrD,OAAQK,IAAK,CAEvC,GAAI+qD,GAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGG,KAAK9qD,GAAGgrD,YACjDC,EAAOp2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WACzD6pB,GAAKnpB,QAAUqoB,IACjBA,EAAac,EAAKnpB,SAEhBmpB,EAAKlpB,QAAUqoB,IACjBA,EAAaa,EAAKlpB,SAGpBgpB,EAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGG,KAAK9qD,GAAGkrD,WACjD,IAAIC,GAAOt2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WACzD+pB,GAAKrpB,QAAUuoB,IACjBA,EAAac,EAAKrpB,SAEhBqpB,EAAKppB,QAAUuoB,IACjBA,EAAaa,EAAKppB,SAItB4oB,EAAGS,WAAW3pD,QAAQ,SAAU4pD,GAC9BA,EAAGC,aAAa7pD,QAAQ,SAAU8pD,EAAMC,GAE3BrB,EAAPoB,IACFpB,EAAaoB,GAEXA,EAAOnB,IACTA,EAAamB,GAGXF,EAAGI,aAAaD,GAAQnB,IAC1BA,EAAagB,EAAGI,aAAaD,IAE3BH,EAAGI,aAAaD,GAAQlB,IAC1BA,EAAae,EAAGI,aAAaD,QAKnCvrD,QAAQwB,QAAQkpD,EAAGe,eAAgB,SAAUC,GAE3C,GAAIZ,GAASl2C,EAAM7N,IAAIhE,mBAAmB2oD,EAAGX,YACzCC,EAAOp2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WACzD6pB,GAAKnpB,QAAUqoB,IACjBA,EAAac,EAAKnpB,SAEhBmpB,EAAKlpB,QAAUqoB,IACjBA,EAAaa,EAAKlpB,SAGpBgpB,EAASl2C,EAAM7N,IAAIhE,mBAAmB2oD,EAAGT,WACzC,IAAIC,GAAOt2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WACzD+pB,GAAKrpB,QAAUuoB,IACjBA,EAAac,EAAKrpB,SAEhBqpB,EAAKppB,QAAUuoB,IACjBA,EAAaa,EAAKppB,YAOxBltB,EAAM+2C,kBAAoB,WACxB,GAAIr0C,GAAM2yC,EAAqB1yC,WAAW,KAC1CD,GAAIE,UAAU,EAAG,EAAGyyC,EAAqBxyC,MAAOwyC,EAAqBvyC,OAErE,KAAK,GADDgzC,GAAK91C,EAAM7N,IAAItG,KAAK6C,aAAasR,EAAMxN,GAAG7D,mBAAmBonD,eAAeC,yBAAyB,GAChG7qD,EAAI,EAAGA,EAAI2qD,EAAGe,eAAe/rD,OAAQK,IAAK,CAEjD,GAAI+qD,GAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGe,eAAe1rD,GAAGgrD,YAC3DC,EAAOp2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WAE7D2pB,GAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGe,eAAe1rD,GAAGkrD,WAI3D,KAAK,GAHDC,GAAOt2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,YACzDyqB,EAAQ5pD,OACR6pD,EAAQ7pD,OACHmuC,EAAI,EAAGA,EAAI6a,EAAK3oB,OAAO3iC,OAAQywC,IAAK,CAC3C,GAAI2b,GAASl3C,EAAMvN,OAAOg6B,iCAAiCqpB,EAAGe,eAAe1rD,GAAGgrD,YAC5EgB,EAASn3C,EAAMvN,OAAOg6B,iCAAiCqpB,EAAGe,eAAe1rD,GAAGkrD,WAEhF,IAAIa,EAAOhsC,aAAeisC,EAAOjsC,YAAcgsC,EAAO1F,cAAgB2F,EAAO3F,YAG3E,WAFAnoB,OAAM,uFAIR,IAAI/Q,IAAK89B,EAAK3oB,OAAO8N,GAAGua,EAAGe,eAAe1rD,GAAGisD,YAAc9B,IAAeC,EAAaD,GAAcD,EAAqBxyC,MACtH6qB,EAAI2nB,EAAqBvyC,QAAUwzC,EAAK7oB,OAAO8N,GAAGua,EAAGe,eAAe1rD,GAAGksD,YAAc7B,IAAeC,EAAaD,GAAcH,EAAqBvyC,MACxJJ,GAAIkC,YAAckxC,EAAGe,eAAe1rD,GAAGwV,MACvC+B,EAAIsB,UAAY8xC,EAAGe,eAAe1rD,GAAGwV,MACrC+B,EAAImC,YACJnC,EAAI8rB,IAAIlW,EAAGoV,EAAG,EAAGgoB,EAAYC,GAAU,GACvCjzC,EAAIitB,OAGA4L,GAAK,GAAKua,EAAGe,eAAe1rD,GAAGy/B,UACjCloB,EAAImC,YACJnC,EAAIoC,OAAOkyC,EAAOC,GAClBv0C,EAAIqC,OAAOuT,EAAGoV,GACdhrB,EAAIsC,UAENgyC,EAAQ1+B,EACR2+B,EAAQvpB,KAOd1tB,EAAM41C,SAAW,WACXN,IAAepkB,EAAAA,IACjBlxB,EAAM61C,sBACoHzoD,SAAtH4S,EAAM7N,IAAItG,KAAK6C,aAAasR,EAAMxN,GAAG7D,mBAAmBonD,eAAeC,yBAAyB,GAAGa,gBACrG72C,EAAM+2C,oBAGV,IAAIr0C,GAAMtC,EAAOuC,WAAW,KAC5BD,GAAIE,UAAU,EAAG,EAAGxC,EAAOyC,MAAOzC,EAAO0C,OAGzC,IAAIgB,GAASpB,EAAItC,OAAOyC,MAAQH,EAAItC,OAAOwuB,YACvCzrB,EAAST,EAAItC,OAAO0C,OAASJ,EAAItC,OAAOgD,YAE5CV,GAAImC,YACJnC,EAAIoC,OAAO,EAAG,GACdpC,EAAIqC,OAAO,EAAG,GACdrC,EAAIoC,OAAO,EAAG1E,EAAO0C,QACrBJ,EAAIqC,OAAO,EAAG3E,EAAO0C,OAAS,GAC9BJ,EAAIoC,OAAO1E,EAAOyC,MAAOzC,EAAO0C,QAChCJ,EAAIqC,OAAO3E,EAAOyC,MAAQ,EAAGzC,EAAO0C,OAAS,GAC7CJ,EAAIsC,SACJtC,EAAImF,WACJ,IAAIirB,GAAgE,EAAhD9yB,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMzkC,KAAKC,MAAM,EAAG,IAAU,CAExEtC,GAAM3N,UAAUmR,oBAAoBd,EAAK,SAAW1C,EAAMo1C,IAAI/iB,4BAA4BojB,EAAY,GAAI3iB,EAAe9yB,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQ,EAAG,EAAGtD,EAAM7N,IAAIrG,OAAO6U,MAAM4C,OAE1LvD,EAAM3N,UAAUgR,4BAA4BX,EAAK,SAAW1C,EAAMo1C,IAAI/iB,4BAA4BmjB,EAAY,GAAI,SAAWx1C,EAAMo1C,IAAI/iB,4BAA4BijB,EAAY,GAAIxiB,EAAe9yB,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQ,EAAGlD,EAAO0C,OAASgwB,EAAgB3vB,EAAS,EAAI,EAAGnD,EAAM7N,IAAIrG,OAAO6U,MAAM4C,OAAO,EAEvT,IAAI+zC,GAAK50C,EAAImB,YAAY,SAAW7D,EAAMo1C,IAAI/iB,4BAA4BkjB,EAAY,IAAI1yC,MAAQiB,CAElG9D,GAAM3N,UAAUmR,oBAAoBd,EAAK,SAAW1C,EAAMo1C,IAAI/iB,4BAA4BkjB,EAAY,GAAIziB,EAAe9yB,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQlD,EAAOyC,MAAQy0C,EAAK,EAAGl3C,EAAO0C,OAASgwB,EAAgB3vB,EAAS,EAAGnD,EAAM7N,IAAIrG,OAAO6U,MAAM4C,MACvP,IAQIuxC,GARAgB,EAAK91C,EAAM7N,IAAItG,KAAK6C,aAAasR,EAAMxN,GAAG7D,mBAAmBonD,eAAeC,yBAAyB,GAGrGkB,EAASl3C,EAAMvN,OAAOg6B,iCAAiCqpB,EAAGG,KAAK,GAAGE,YAElEgB,EAASn3C,EAAMvN,OAAOg6B,iCAAiCqpB,EAAGG,KAAK,GAAGI,YAElEkB,GADU,EAAIL,EAAOhsC,WACHlL,EAAMxN,GAAGkgB,kBAAoB1S,EAAMtN,IAAIyE,OAAOkT,WAGlEyqC,GADEoC,EAAOtqB,YAAc,EAAIsqB,EAAOhsC,WAAa,EACpC7F,KAAKC,MAAMiyC,EAAkBL,EAAOhsC,YAEpC7F,KAAKC,MAAMiyC,EAAkBL,EAAOhsC,YAAcgsC,EAAOtqB,UAAY,EAAIsqB,EAAOhsC,WAAa,GAAKgsC,EAAOhsC,WAGtH,IAAIgrC,GAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGG,KAAK,GAAGE,YACjDC,EAAOp2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WACzDuoB,GAAWsB,EAAK3oB,OAAO3iC,OAAS,IAClCgqD,EAAWsB,EAAK3oB,OAAO3iC,OAAS,GAElCwsD,EAAK50C,EAAImB,YAAY,UAAYixC,GAAUjyC,MAAQiB,CACnD,IAAI0zC,GAAU,EACd90C,GAAIkK,OACJlK,EAAIqqC,OAAOyK,EAAUnyC,KAAKopB,GAAK,KAC/BzuB,EAAM3N,UAAUmR,oBAAoBd,EAAK,UAAYoyC,EAAU90C,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMzkC,KAAKC,MAAM,EAAG,IAAM,EAAGtC,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQlD,EAAOyC,MAAQ,EAAIy0C,EAAK,GAAIl3C,EAAO0C,OAAQ9C,EAAM7N,IAAIrG,OAAO6U,MAAM4C,OACxNb,EAAI20B,SAOJ,KAAK,GAJDqe,GAAarwC,KAAKopB,GAAK,IAAM,EAE7BknB,EAAWtwC,KAAKopB,GAAK,IAAM,IAC3BgpB,KACKtsD,EAAI,EAAGA,EAAI2qD,EAAGG,KAAKnrD,OAAQK,IAAK,CAEvC,GAAI+qD,GAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGG,KAAK9qD,GAAGgrD,YACjDC,EAAOp2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WAE7D2pB,GAASl2C,EAAM7N,IAAIhE,mBAAmB2nD,EAAGG,KAAK9qD,GAAGkrD,WACjD,IAAIC,GAAOt2C,EAAMvN,OAAO65B,iBAAiB4pB,EAAO9nD,KAAM8nD,EAAO3pB,WAE7D,IAAI6pB,EAAK3oB,OAAO3iC,SAAWwrD,EAAK7oB,OAAO3iC,OAErC,WADAu+B,OAAM,yDAGR,IAAI6tB,GAASl3C,EAAMvN,OAAOg6B,iCAAiCqpB,EAAGG,KAAK9qD,GAAGgrD,YAClEgB,EAASn3C,EAAMvN,OAAOg6B,iCAAiCqpB,EAAGG,KAAK9qD,GAAGkrD,WAEtE,IAAIa,EAAOhsC,aAAeisC,EAAOjsC,YAAcgsC,EAAO1F,cAAgB2F,EAAO3F,YAE3E,WADAnoB,OAAM,uFAGR,IAAI/Q,IAAK89B,EAAK3oB,OAAOqnB,GAAUgB,EAAGG,KAAK9qD,GAAGisD,YAAc9B,IAAeC,EAAaD,GAAcl1C,EAAOyC,MACrG6qB,EAAIttB,EAAO0C,QAAUwzC,EAAK7oB,OAAOqnB,GAAUgB,EAAGG,KAAK9qD,GAAGksD,YAAc7B,IAAeC,EAAaD,GAAcp1C,EAAO0C,MACzHJ,GAAIkC,YAAckxC,EAAGG,KAAK9qD,GAAGwV,MAC7B+B,EAAImC,YACJnC,EAAI8rB,IAAIlW,EAAGoV,EAAG,GAAIgoB,EAAYC,GAAU,GACxCjzC,EAAIsC,SACJtC,EAAImF,YACJnF,EAAImC,YACJnC,EAAI8rB,IAAIlW,EAAGoV,EAAG,EAAGgoB,EAAYC,GAAU,GACvCjzC,EAAIitB,OACJjtB,EAAImF,YAEJ7H,EAAM3N,UAAUmR,oBAAoBd,EAAKozC,EAAGG,KAAK9qD,GAAGiD,KAAM4R,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMzkC,KAAKC,MAAM,EAAG,IAAM,EAAGtC,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQgV,EAAGoV,EAAI,EAAG1tB,EAAM7N,IAAIrG,OAAO6U,MAAM4C,OAElLk0C,EAAQvqD,MACNkB,KAAQ0nD,EAAGG,KAAK9qD,GAAGiD,KACnBkqB,EAAKA,EACLoV,EAAKA,IAKT,GAAIxc,GAAGgI,CACP48B,GAAG4B,aAAa9qD,QAAQ,SAAU4kC,GAChCimB,EAAQ7qD,QAAQ,SAAUuqB,GACpBA,EAAE/oB,OAASojC,EAAEmmB,UACfzmC,EAAIiG,GAEFA,EAAE/oB,OAASojC,EAAEomB,QACf1+B,EAAI/B,KAIRzU,EAAIkC,YAAc4sB,EAAE7wB,MACpB+B,EAAImC,YACJnC,EAAIoC,OAAOoM,EAAEoH,EAAGpH,EAAEwc,GAClBhrB,EAAIqC,OAAOmU,EAAEZ,EAAGY,EAAEwU,GAClBhrB,EAAIsC,SACJtC,EAAImF,aAIN,IAAI6tC,GAAarwC,KAAKopB,GAAK,IAAM,EAC7BknB,EAAWtwC,KAAKopB,GAAK,IAAM,GAC/BqnB,GAAGS,WAAW3pD,QAAQ,SAAU4pD,GAC9B9zC,EAAIkC,YAAc4xC,EAAG71C,MACrB+B,EAAIsB,UAAYwyC,EAAG71C,KAEnB,IAAIk3C,IAAUrB,EAAGsB,gBAAkBxC,IAAeC,EAAaD,GAAcl1C,EAAOyC,MAChFk1C,EAAS33C,EAAO0C,QAAU0zC,EAAGwB,gBAAkBxC,IAAeC,EAAaD,GAAcp1C,EAAO0C,MAClF9C,GAAM3N,UAAUmR,oBAAoBd,EAAK8zC,EAAGpoD,KAAM4R,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMzkC,KAAKC,MAAM,EAAG,IAAM,EAAGtC,EAAM7N,IAAIrG,OAAOqW,KAAK2kC,MAAMxjC,OAAQu0C,EAAQE,EAAQvB,EAAG71C,MAC9K61C,GAAGC,aAAa7pD,QAAQ,SAAU8pD,EAAMC,GACtC,GAAIr+B,IAAKo+B,EAAOpB,IAAeC,EAAaD,GAAcl1C,EAAOyC,MAC7D6qB,EAAIttB,EAAO0C,QAAU0zC,EAAGI,aAAaD,GAAQnB,IAAeC,EAAaD,GAAcp1C,EAAO0C,MAOlG,IALAJ,EAAImC,YACJnC,EAAI8rB,IAAIlW,EAAGoV,EAAG,EAAGgoB,EAAYC,GAAU,GACvCjzC,EAAIitB,OACJjtB,EAAImF,YAEA2uC,EAAG5rB,SAAW+rB,GAAQ,EAAG,CAC3B,GAAIhmB,IAAS6lB,EAAGC,aAAaE,EAAO,GAAKrB,IAAeC,EAAaD,GAAcl1C,EAAOyC,MACtF+tB,EAAQxwB,EAAO0C,QAAU0zC,EAAGI,aAAaD,EAAO,GAAKnB,IAAeC,EAAaD,GAAcp1C,EAAO0C,MAC1GJ,GAAImC,YACJnC,EAAIoC,OAAO6rB,EAAOC,GAClBluB,EAAIqC,OAAOuT,EAAGoV,GACdhrB,EAAIsC,SACJtC,EAAImF,uBAUpBzc,QAAQC,OAAO,aAAauU,UAAU,cACpC,WACA,WACA,mBACA,kBACA,kBACA,eACA,SAAUC,EAAUpP,EAAUwnD,EAAkB/lD,EAAiBH,EAAiBE;AAChF,OACE6N,YAAa,wBACbC,SAAU,IACVhD,SAAS,EACTiD,SACAE,KAAM,SAAkBF,EAAOvM,EAAS0M,GAEtCH,EAAMk4C,gBAAkB,6IACxBl4C,EAAMm4C,sBAAwB,kGAC9Bn4C,EAAMo4C,iBAAmB,2DACzBp4C,EAAMq4C,YAAc,kCACpBr4C,EAAMs4C,mBAAqB,6DAC3Bt4C,EAAMu4C,eAAiB,mDACvBv4C,EAAMw4C,wBAA0B,mEAChCx4C,EAAMy4C,mBAAqB,6FAC3Bz4C,EAAM04C,SAAW14C,EAAMk4C,gBACvBl4C,EAAM24C,UAAY,GAClB34C,EAAM44C,iBAAmB,GACzB54C,EAAM64C,cAAgB,OACtB74C,EAAM84C,eAAiB,QACvB94C,EAAM+4C,MAAQ,EACd/4C,EAAMg5C,WACNh5C,EAAMi5C,WACNj5C,EAAMk5C,eACNl5C,EAAMm5C,kBAAoB,SAAUC,GAClCp5C,EAAM+4C,OAASK,GAEjBp5C,EAAMq5C,oBAAsB,SAAUlhB,GACpC,GAAImhB,GAAanhB,EAAK/pC,KAAKmrD,UAAUphB,EAAK/pC,KAAKkI,YAAY,KAAO,EAAG6hC,EAAK/pC,KAAKkI,YAAY,MAAMkjD,cAC7FC,EAAYthB,EAAK/pC,KAAKiI,OAAO8hC,EAAK/pC,KAAKkI,YAAY,KAAO,GAAGkjD,cAC7DtxC,EAAS,EAEXA,GADiB,UAAfoxC,EACOnhB,EAAK/pC,KAAKiI,OAAO,EAAG8hC,EAAK/pC,KAAKkI,YAAY,MAE1C6hC,EAAK/pC,KAAKiI,OAAO,EAAG8hC,EAAK/pC,KAAKkI,YAAY,KAErD,IAAIilC,GAAIv7B,EAAMk5C,YAAY7kC,QAAQnM,EACxB,MAANqzB,IACFv7B,EAAMk5C,YAAYhsD,KAAKgb,GACvBqzB,EAAIv7B,EAAMk5C,YAAY7kC,QAAQnM,GAC9BlI,EAAMi5C,QAAQ1d,MACdv7B,EAAMi5C,QAAQ1d,GAAG,GAAKrzB,GAEN,QAAduxC,GACFz5C,EAAMi5C,QAAQ1d,GAAG,GAAKpD,EACtBn4B,EAAMg5C,QAAQ9rD,KAAKirC,GACnBn4B,EAAM24C,UAAY34C,EAAM44C,iBACxB54C,EAAM04C,SAAW14C,EAAMu4C,gBACA,aAAdkB,GACTz5C,EAAMi5C,QAAQ1d,GAAG,MACjBv7B,EAAMi5C,QAAQ1d,GAAG,GAAGpD,KAAOA,EAC3Bn4B,EAAMi5C,QAAQ1d,GAAG,GAAGhmC,KAAO,WAC3ByK,EAAMg5C,QAAQ9rD,KAAKirC,GACnBn4B,EAAM24C,UAAY34C,EAAM44C,iBACxB54C,EAAM04C,SAAW14C,EAAMs4C,oBACA,SAAdmB,GAAuC,UAAfH,GACjCt5C,EAAMi5C,QAAQ1d,GAAG,MACjBv7B,EAAMi5C,QAAQ1d,GAAG,GAAGpD,KAAOA,EAC3Bn4B,EAAMi5C,QAAQ1d,GAAG,GAAGhmC,KAAO,aAC3ByK,EAAMg5C,QAAQ9rD,KAAKirC,GACnBn4B,EAAM24C,UAAY34C,EAAM44C,iBACxB54C,EAAM04C,SAAW14C,EAAMw4C,0BAEnBtmD,EAAgBiH,UAAUqS,WACV,IAAd2sB,EAAK91B,MACPrC,EAAM24C,UAAY34C,EAAM84C,eACxB94C,EAAM04C,SAAW14C,EAAMy4C,qBAMzBz4C,EAAM24C,UAAY34C,EAAM84C,eACxB94C,EAAM04C,SAAW14C,EAAMm4C,uBAEzBn4C,EAAMg5C,WACNh5C,EAAMi5C,WACNj5C,EAAMk5C,eACNl5C,EAAM+4C,MAAQ,GAEX7mD,EAAgBiH,UAAUqS,WAActZ,EAAgBiH,UAAUy9B,UACrE52B,EAAMhM,UAEiB5G,SAArB4S,EAAMi5C,QAAQ1d,IAChBv7B,EAAM05C,kBAGV15C,EAAM05C,eAAiB,WAEjB15C,EAAM+4C,QAAU/4C,EAAMg5C,QAAQluD,SAC5BmtD,EAAiBpgD,QAAQmI,EAAMi5C,YAAa,GAC9ChnD,EAAauD,KAAK,mBAAoB,uCAAyCwK,EAAMg5C,QAAQluD,OAAS,wCAA0CmtD,EAAiB0B,mBAAmBtkD,KAAK,WACvLtD,EAAgBgD,qBAGpBiL,EAAMg5C,WACNh5C,EAAMi5C,WACNj5C,EAAMk5C,eACNl5C,EAAM+4C,MAAQ,EACd/4C,EAAM04C,SAAW14C,EAAMk4C,gBACvBl4C,EAAM24C,UAAY34C,EAAM44C,mBAG5B54C,EAAM45C,UAAY,SAAUC,GAC1B75C,EAAMm5C,kBAAkBU,EAAM/uD,OAC9B,KAAK,GAAIK,GAAI,EAAGA,EAAI0uD,EAAM/uD,OAAQK,IAAK,CACrC,GAAIgtC,GAAO0hB,EAAM1uD,EACjB,IAAkB,cAAdgtC,EAAK/pC,KACP4R,EAAMm5C,kBAAkB,QACnB,CACL,GAAI3/B,GAAOsgC,CACX,IAAI3hB,EAAK4hB,QAAU5hB,EAAK6hB,YACtBxgC,EAAQ2e,MACH,IAAIA,EAAK8hB,WACdzgC,EAAQ2e,EAAK8hB,iBACR,CAAA,IAAI9hB,EAAK+hB,iBAET,CAAA,GAA8B,kBAAnB/hB,GAAKgiB,UAA0B,CAC/Cn6C,EAAMq5C,oBAAoBlhB,EAAKgiB,YAC/B,UACK,GAAIC,MAAQjiB,YAAgBiiB,MAAM,CACvCp6C,EAAMq5C,oBAAoBlhB,EAC1B,UAEAn4B,EAAMm5C,kBAAkB,GACxB,UATA3/B,EAAQ2e,EAAK+hB,mBAWV1gC,EAEMA,EAAMugC,OACfvgC,EAAM2e,KAAK,SAAUA,GACnBn4B,EAAMq5C,oBAAoBlhB,IACzB,SAAUz6B,GACXrQ,QAAQgtD,KAAK38C,KAEN8b,EAAMwgC,cACfF,EAAStgC,EAAM8gC,eACfR,EAAOS,YAAY,SAAUC,GAC3Bx6C,EAAM45C,UAAUY,GAChBx6C,EAAMm5C,kBAAkB,KACvB,SAAUz7C,GACXrQ,QAAQgtD,KAAK38C,MAbfy7C,kBAAkB,OAmB1Bn5C,EAAMy6C,UAAY,SAAU1c,GAC1BA,EAAI3b,kBACJ2b,EAAItgB,iBACJzd,EAAM8U,OAAO,WACX,GAAI7qB,OAAOmwD,MAAQnwD,OAAOywD,YAAczwD,OAAO0wD,UAAY1wD,OAAO0hB,MAChE,GAA0Bve,SAAtB2wC,EAAItjB,cAA6B,CACnC,GAAIvoB,EAAgBiH,UAAUqS,UAC5B,GAAItP,GAAQ6hC,EAAItjB,cAAcwwB,aAAa4O,UACtC,IAAI3nD,EAAgBiH,UAAUy9B,SACnC,GAAI16B,GAAQ6hC,EAAItjB,cAAcwwB,aAAa4O,UAG3C,IAAI39C,GAAQ6hC,EAAItjB,cAAcwwB,aAAa/uC,KAE7C8D,GAAM45C,UAAU19C,QAIlBjK,GAAauD,KAAK,mBAAoBwK,EAAMo4C,kBAAkB/iD,KAAK,SAAUhH,GAC3E2R,EAAM04C,SAAW14C,EAAMk4C,gBACvBl4C,EAAM24C,UAAY34C,EAAM44C,iBACxB7mD,EAAgBgD,wBAKxBiL,EAAM46C,eAAiB,SAAU7c,GAC/BA,EAAItgB,iBACJzd,EAAM8U,OAAO,WACX9U,EAAM04C,SAAW14C,EAAMk4C,gBACvBl4C,EAAM24C,UAAY34C,EAAM44C,oBAG5B54C,EAAM66C,eAAiB,SAAU9c,GAC/BA,EAAItgB,iBACJzd,EAAM8U,OAAO,WACX9U,EAAM04C,SAAW14C,EAAMq4C,YACvBr4C,EAAM24C,UAAY34C,EAAM64C,iBAG5BplD,EAAQC,KAAK,OAAQ,SAAUmB,GAC7BmL,EAAMy6C,UAAU5lD,KAElBpB,EAAQC,KAAK,WAAY,SAAUmB,GACjCmL,EAAM66C,eAAehmD,KAEvBpB,EAAQC,KAAK,YAAa,SAAUmB,GAClCmL,EAAM46C,eAAe/lD,KAEvBpB,EAAQC,KAAK,YAAa,SAAUmB,GAClCmL,EAAM46C,eAAe/lD,KAEvBpB,EAAQC,KAAK,QAAS,SAAUmB,GAC9BpB,EAAQiV,QAAQof,SAAS,GAAGA,SAAS,GAAGxa,eAOlDliB,QAAQC,OAAO,aAAauU,UAAU,mBACpC,WACA,kBACA,kBACA,SAAUC,EAAU3N,EAAiBH,GACnC,OACE+N,YAAa,6BACbC,SAAU,IACVC,SACAE,KAAM,SAAkBF,EAAOvM,EAAS0M,GACtCH,EAAM86C,WAAa,YACnB96C,EAAM+6C,UAAY,YAClB/6C,EAAMg7C,WAAa,mBACnBh7C,EAAMi7C,WAAaj7C,EAAM+6C,UAAY,IAAM/6C,EAAM86C,WAAa,IAAM96C,EAAMg7C,WAC1Eh7C,EAAMk7C,WAAal7C,EAAMi7C,WACzBj7C,EAAMm7C,oBAAsB,WAC1B,GAAIC,GAAc3nD,EAAQiV,QAAQof,SAASuzB,UAC3Cr7C,GAAMs7C,QAAQ1B,UAAUwB,EAAYvB,QAEtCpmD,EAAQC,KAAK,SAAU,SAAUmB,GAC/BmL,EAAMm7C,oBAAoBtmD,KAE5BpB,EAAQC,KAAK,QAAS,SAAUmB,GAC9B,GAAI8yB,GAAOv8B,QAAQqI,QAAQ,QACXrG,UAAZu6B,EAAK,IACPA,EAAK,GAAGra,eAQpBliB,QAAQC,OAAO,aAAauU,UAAU,aACpC,YACA,mBACA,wBACA,SAAUjU,EAAWoF,EAAkBE,GACrC,OACE6O,YAAa,uBACbC,SAAU,IACVC,OACE9T,YAAa,IACbC,YAAa,IACbC,UAAW,KAEb8T,KAAM,SAAkBF,EAAOvM,EAAS8S,GAGtC9S,EAAQC,KAAK,aAAc,SAAUmB,GACnClJ,EAAU4nB,kBAAmB,IAE/B9f,EAAQC,KAAK,aAAc,SAAUmB,GACnClJ,EAAU4nB,kBAAmB,IAI/BhN,EAAM2lB,SAAS,cAAe,SAAUrP,GAC1BzvB,SAARyvB,GAA6B,KAARA,IACvB5rB,EAAsBhF,aAAaC,YAAc2wB,KAGrDtW,EAAM2lB,SAAS,cAAe,SAAUrP,GAC1BzvB,SAARyvB,GAA6B,KAARA,IACvB5rB,EAAsBhF,aAAaE,YAAc0wB,KAGrDtW,EAAM2lB,SAAS,YAAa,SAAUrP,GACxBzvB,SAARyvB,GAA6B,KAARA,IACvB5rB,EAAsBhF,aAAaG,UAAYywB,UAQ3DzxB,QAAQC,OAAO,aAAaI,QAAQ,qBAClC,QACA,KACA,wBACA,SAA2Bo9B,EAAOn9B,EAAIuF,GAepC,QAASsqD,GAAwBC,EAAYC,GAC3C,GAAIptD,IAAM,CAYV,OAVAotD,GAAS/rD,iBAAiB9C,QAAQ,SAAU+C,GAE1C,IADA,GAAI+rD,GAAQF,EAAWnnC,QAAQ1kB,EAAGvB,MACjB,KAAVstD,GACLF,EAAWxiB,OAAO0iB,EAAO,GACzBA,EAAQF,EAAWnnC,QAAQ1kB,EAAGvB,QAGR,IAAtBotD,EAAW1wD,SACbuD,EAAM,qCAAuCmtD,GAExCntD,EAKT,QAASstD,GAA4BC,EAAYH,GAC/C,GAAIptD,IAAM,EAENwtD,EAAQD,EAAWvnC,QAAQ,OAmB/B,OAlBc,KAAVwnC,GACFD,EAAW5iB,OAAO6iB,EAAO,GAE3BA,EAAQD,EAAWvnC,QAAQ,QACb,KAAVwnC,GACFD,EAAW5iB,OAAO6iB,EAAO,GAG3BJ,EAASntD,qBAAqB1B,QAAQ,SAAUkvD,GAE9C,IADA,GAAID,GAAQD,EAAWvnC,QAAQynC,EAAG1tD,MACjB,KAAVytD,GACLD,EAAW5iB,OAAO6iB,EAAO,GACzBA,EAAQD,EAAWvnC,QAAQynC,EAAG1tD,QAGR,IAAtBwtD,EAAW9wD,SACbuD,EAAM,yCAA2CutD,GAE5CvtD,EArDT,GAAIzC,MACAmwD,KACAC,GACA,uBACA,wBACA,qBACA,mBACA,eACA,eAwSJ,OApPApwD,GAASqwD,sBAAwB,SAAUplD,EAAiB4kD,GAC1D,GAAIptD,IAAM,EACN6tD,GAAY,CAGhBT,GAAS/rD,iBAAiB9C,QAAQ,SAAU+C,EAAIwsD,GAE9CxsD,EAAGuI,qBAAqBtL,QAAQ,SAAUwvD,EAAKC,GAC7C,GAAIC,GAAU,CACd3sD,GAAGuI,qBAAqBtL,QAAQ,SAAU2vD,GACpCH,EAAIhuD,OAASmuD,EAAInuD,OACnBkuD,GAAoB,KAGpBA,EAAU,IACZjuD,EAAM,uCAAyC8tD,EAAQ,0BAA4BE,EAAS,0DAC5FH,GAAY,OAOlBrlD,EAAgBnI,aAAa9B,QAAQ,SAAU8kC,GAC7C,GAAIwqB,EAAW,CAIb,GAAIM,GAAUb,EAA4BvwD,QAAQoB,KAAKklC,EAAE9iC,eAAemB,OAAQ0rD,EAC5Ee,MAAY,IACdnuD,EAAM,+GAAiHmuD,EACvHN,GAAY,EAEd,IAAIO,KAEJ/qB,GAAE9iC,eAAeS,OAAOzC,QAAQ,SAAUw/B,GACxC,GAAI8vB,EAAW,CACbO,EAAcvvD,KAAKk/B,EAAIr9B,eAEnBq9B,EAAI78B,mBAAqB68B,EAAIr9B,gBAC/BV,EAAM,wHAA0H+9B,EAAI78B,iBACpI2sD,GAAY,IAGY,SAAtB9vB,EAAIr9B,eAAkD,SAAtBq9B,EAAIr9B,iBACtCV,EAAM,2GACN6tD,GAAY,GAGdM,EAAUb,GACRvvB,EAAI78B,iBACJ68B,EAAIr9B,eACH0sD,GACCe,KAAY,IACdnuD,EAAM,gHAAkHmuD,EACxHN,GAAY,EAGd,IAAIL,GAAQnqB,EAAE9iC,eAAemB,MAAMskB,QAAQ+X,EAAI78B,iBACjC,MAAVssD,IACFxtD,EAAM,8JAAgK+9B,EAAI78B,iBAC1K2sD,GAAY,MAKlBxqB,EAAE9iC,eAAeC,YAAYjC,QAAQ,SAAU+S,GAC7C,GAAIu8C,EAAW,CAEbM,EAAUb,GAA6Bh8C,EAAG5Q,eAAgB0sD,GACtDe,KAAY,IACdnuD,EAAM,qHAAuHmuD,EAC7HN,GAAY,EAGd,IAAIL,GAAQnqB,EAAE9iC,eAAemB,MAAM2hD,OAAO+K,GAAepoC,QAAQ1U,EAAG5Q,cACtD,MAAV8sD,IACFxtD,EAAM,mKAAqKsR,EAAG5Q,cAC9KmtD,GAAY,KAOlB,IAAIQ,GAAUnB,EAAwBnwD,QAAQoB,KAAKklC,EAAE5hC,cAAcC,OAAQ0rD,EACvEiB,MAAY,IACdruD,EAAM,0GAA4GquD,EAClHR,GAAY,GAGdxqB,EAAE5hC,cAAcC,MAAMnD,QAAQ,SAAUozC,GACtC,GAAIkc,EAAW,CACb,GAAIvsD,GAAKsB,EAAsBzB,mBAAmBwwC,EAClC,aAAZrwC,EAAG4F,MAAkC,UAAZ5F,EAAG4F,OAC9BlH,EAAM,sLAAwL2xC,EAC9Lkc,GAAY,MAMO9uD,SAArBskC,EAAEqkB,gBAC8C3oD,SAA9CskC,EAAEqkB,eAAeC,0BACnBtkB,EAAEqkB,eAAeC,yBAAyBppD,QAAQ,SAAU+vD,GAC1D,GAAIT,EAAW,CACb,GAAIU,KAEJD,GAAK1G,KAAKrpD,QAAQ,SAAUuqB,GACtB+kC,IACFU,EAAS1vD,KAAKiqB,EAAE/oB,MAEhBouD,EAAUb,GACRxkC,EAAEg/B,WACFh/B,EAAEk/B,YACDoF,GACCe,KAAY,IACdnuD,EAAM,uIAAyImuD,EAC/IN,GAAY,MAKlBS,EAAKjF,aAAa9qD,QAAQ,SAAU+S,GAClC,GAAIu8C,EAAW,CAEb,GAAIL,GAAQe,EAASvoC,QAAQ1U,EAAGg4C,QAClB,MAAVkE,IACFxtD,EAAM,2JAA6JsR,EAAGg4C,QACtKuE,GAAY,GAGdL,EAAQe,EAASvoC,QAAQ1U,EAAGi4C,OACd,KAAViE,IACFxtD,EAAM,yJAA2JsR,EAAGi4C,MACpKsE,GAAY,MAKlBS,EAAKpG,WAAW3pD,QAAQ,SAAUiwD,GAC5BX,GAEEW,EAAGpG,aAAa3rD,SAAW+xD,EAAGjG,aAAa9rD,SAC7CuD,EAAM,sJACN6tD,GAAY,UAa9B,IAAIN,MACAJ,IACJC,GAAS/rD,iBAAiB9C,QAAQ,SAAU+C,GACjBvC,SAArBuC,EAAGm2B,gBACL81B,EAAW1uD,KAAKyC,EAAGm2B,cAAcg3B,0BACjClB,EAAW1uD,KAAKyC,EAAGm2B,cAAci3B,uBACjCvB,EAAWtuD,KAAKyC,EAAGm2B,cAAck3B,qBAIrC,IAAIN,GAAUnB,EAAwBC,EAAYC,EAC9CiB,MAAY,IACdruD,EAAM,mHAAqHquD,EAG7H,IAAIF,GAAUb,EAA4BC,EAAYH,EAItD,OAHIe,MAAY,IACdnuD,EAAM,uJAAyJmuD,GAE1JnuD,GAKTzC,EAAS0M,YAAc,WACrB,GACI2kD,GADAC,IAMJ,OAJA9xD,SAAQwB,QAAQovD,EAAO,SAAUniC,GAC/BojC,EAAM,eAAiBpjC,EAAI,QAC3BqjC,EAAMhwD,KAAK27B,EAAMI,IAAIg0B,MAEhBvxD,EAAGyxD,IAAID,IAKhBtxD,EAAS4M,WAAa,SAAU4kD,GAC9BhyD,QAAQwB,QAAQwwD,EAAW,SAAUnmC,GACnC8kC,EAAY7uD,MACVkB,KAAM6oB,EAAE3rB,OAAOnB,IACfoC,KAAM0qB,EAAE1qB,OAGW,0CAAjB0qB,EAAE3rB,OAAOnB,KACXkzD,IAAIC,UAAUrmC,EAAE3rB,OAAOnB,IAAK8sB,EAAE1qB,SAOpCX,EAAS2xD,UAAY,SAAUC,GAC7B,GAAIC,GAASrwD,MAMb,OALAhC,SAAQwB,QAAQmvD,EAAa,SAAU9kC,GACjCA,EAAE7oB,OAAS,eAAiBovD,EAAa,UAC3CC,EAASxmC,KAGNwmC,GAKT7xD,EAASmL,YAAc,SAAUymD,EAAYpuB,GAC3C,GACI/gC,GADAovD,EAAS7xD,EAAS2xD,UAAUC,EAEhC,IAAepwD,SAAXqwD,GAAwBJ,IAAIK,SAAStuB,EAAKquB,EAAOlxD,MACnD,GAAmB,uBAAfixD,EAAqC,CACvC,GAAIG,GAAc/xD,EAASqwD,sBAAsBhrD,EAAsBpF,KAAMoF,EAAsBlF,YAEjGsC,GADEsvD,KAAgB,GACZ,EAEAA,MAGRtvD,IAAM,MAINA,GADajB,SAAXqwD,EACI,WAAaD,EAAa,2FAE1BH,IAAI/vD,KAGd,OAAOe,IAEFzC,KAIXR,QAAQC,OAAO,aAAagF,WAAW,qBACrC,SACA,YACA,eACA,wBACA,eACA,yBACA,uBACA,SAAUC,EAAQ3E,EAAWsG,EAAchB,EAAuBG,EAAcg6C,EAAwBt9B,GAEtGxd,EAAOstD,OACLC,YACAC,iBACAC,SAAU,IAEZztD,EAAOkC,GAAK7G,EACZ2E,EAAO0tD,iBAAmBlwC,EAE1B1iB,QAAQwB,QAAQqE,EAAsBlF,YAAY2D,iBAAkB,SAAUuI,GAC7D,SAAXA,EAAE1C,OACJjF,EAAOstD,MAAMC,SAAWvtD,EAAOstD,MAAMC,SAASnM,OAAOtG,EAAuB6S,UAAUhmD,EAAE7J,UAI5FhD,QAAQwB,QAAQ0D,EAAOstD,MAAMC,SAAU,SAAUK,EAAKC,GACpD,GAAIvP,GAAS9gC,EAAqBswC,YAAYF,EAC/B,KAAXC,IAEF7tD,EAAOstD,MAAMG,SAAWnP,EAAOyP,KAAK,QAEtC/tD,EAAOstD,MAAME,cAAc5wD,KAAK0hD,EAAOyP,KAAK,UAI9C/tD,EAAOuQ,OAAO,iBAAkB,SAAUC,GACxCnV,EAAUkI,eAAe4c,KAAOngB,EAAOstD,MAAMC,SAASvtD,EAAOguD,eAC5D,GAMHhuD,EAAOguD,UAAY,WACjB,GAAIC,GAASjuD,EAAOstD,MAAME,cAAczpC,QAAQ/jB,EAAOstD,MAAMG,SAC7D,OAAOQ,IAETjuD,EAAOkuD,gBAAkB,WACvB7yD,EAAUkI,eAAeyd,kBAE3BhhB,EAAOmuD,YAAc,WACnB,MAAO9yD,GAAUkI,eAAewd,aAElC/gB,EAAOouD,cAAgB,aACnB/yD,EAAUkI,eAAe8c,SAE7BrgB,EAAOquD,WAAa,WAClB,MAAOhzD,GAAUkI,eAAe8c,SAKlCrgB,EAAOsuD,iBAAmB,SAAUnvD,EAAWovD,GAC7C,MAAIlzD,GAAUwQ,cAAc1M,KAAeovD,GAClC,GAEA,GAUXvuD,EAAOwuD,kBAAoB,SAAUrvD,EAAW6R,EAAay9C,GAC3DpzD,EAAU6V,cAAc/R,EAAW6R,EAAay9C,IAKlDzuD,EAAO0uD,eAAiB,SAAUvvD,GAChC,GAAIwvD,GAAShuD,EAAsBzB,mBAAmBC,EACtD,OAAOwvD,GAAO/mD,sBAKhB5H,EAAOynC,OAAS,WACd9lC,EAAawa,YAmBnBrhB,QAAQC,OAAO,aAAaI,QAAQ,0BAClC,YACA,wBACA,eACA,cACA,SAAUE,EAAWsF,EAAuBG,EAAcY,GAExD,GAAIpG,KA+QJ,OArQAA,GAASqyD,UAAY,SAAUiB,EAAYzuC,GACzC,GAAoB,mBAATA,GACT,GAAIA,IAAQyuC,OAEZzuC,GAAOA,EAAKihC,QAAQwN,GAGtB,IAAIC,GAAUj1D,KAAKk1D,iBAAiBF,EAGpC,IAAuB,IAAnBC,EAAQr0D,OACV,OAAQ2lB,EAKV,KAAK,GADDmtC,MACKzyD,EAAI,EAAGA,EAAIg0D,EAAQr0D,SAAUK,EACpCyyD,EAAQA,EAAMlM,OAAO9lD,EAASqyD,UAAUkB,EAAQh0D,GAAIslB,GAEtD,OAAOmtC,IASThyD,EAASwzD,iBAAmB,SAAUC,GAEpC,IAAK,GADDF,MACKh0D,EAAI,EAAGA,EAAI8F,EAAsBlF,YAAYuzD,gBAAgBx0D,SAAUK,EAC1E8F,EAAsBlF,YAAYuzD,gBAAgBn0D,GAAGo0D,eAAiBF,GACxEF,EAAQjyD,KAAK+D,EAAsBlF,YAAYuzD,gBAAgBn0D,GAAGq0D,eAGtE,OAAOL,IASTvzD,EAASonD,yBAA2B,SAAUyM,GAC5C,GAAIt0D,GAAG81C,CAQP,KAJAr1C,EAAS8zD,YAAYD,GACrB7zD,EAAS+zD,eAAeF,GAGnBt0D,EAAI,EAAGA,EAAIs0D,EAAa30D,SAAUK,EAAG,CACxC,GAAI8Q,GAAQ7K,EAAa+kB,gBAAgBspC,EAAat0D,GAOtD,KAJA8Q,EAAM2jD,QAAU,EAIX3e,EAAK,EAAGA,EAAKhlC,EAAMC,MAAMpR,SAAUm2C,EAClChlC,EAAMC,MAAM+kC,GAAIiS,YAAa,EAC/Bj3C,EAAMC,MAAM+kC,GAAI2e,QAAU,IAE1B3jD,EAAMC,MAAM+kC,GAAI2e,QAAU,EAG5B3jD,EAAM2jD,SAAW3jD,EAAMC,MAAM+kC,GAAI2e,OAOnC,IAAI7N,GAAa,CACjB,KAAK9Q,EAAK,EAAGA,EAAKhlC,EAAMC,MAAMpR,SAAUm2C,EAAI,CAC1ChlC,EAAMC,MAAM+kC,GAAIwS,aAAe1B,EAAa91C,EAAMC,MAAM+kC,GAAI2e,QAAU,GAAK3jD,EAAM2jD,QACjF7N,GAAc91C,EAAMC,MAAM+kC,GAAI2e,QAC9B3jD,EAAMC,MAAM+kC,GAAIuS,OAASiM,EAAa30D,OAASK,EAAI,CAInD,KAAK,GADDguC,GAAQnnC,EAAYkL,UAAUi8B,MACzBlhC,EAAI,EAAGA,EAAIkhC,EAAMruC,SAAUmN,EAC9BkhC,EAAMlhC,GAAGopB,OAASplB,EAAMC,MAAM+kC,GAAIzkC,KACpC28B,EAAMlhC,GAAG47C,cAAgB53C,EAAMC,MAAM+kC,GAAIwS,YACzCta,EAAMlhC,GAAG27C,SAAW33C,EAAMC,MAAM+kC,GAAIuS,QAElCra,EAAMlhC,GAAGmpB,SAAWnlB,EAAMC,MAAM+kC,GAAIzkC,KACtC28B,EAAMlhC,GAAG07C,gBAAkB13C,EAAMC,MAAM+kC,GAAIwS,YAC3Cta,EAAMlhC,GAAGy7C,WAAaz3C,EAAMC,MAAM+kC,GAAIuS,WAahD5nD,EAAS+lD,aAAe,SAAUx6B,EAAGsoC,GACnC,GAAI33B,MAGA+3B,EAAezuD,EAAasvB,aAAavJ,EAAE3a,GAC/C,IAAqB,OAAjBqjD,EAEF,MADAxyD,SAAQ2zB,IAAI,8CAAgD7J,KAK9D,KAAK,GADDkoC,GAAa,KACRl0D,EAAI,EAAGA,EAAIs0D,EAAa30D,OAAS,IAAKK,EAC7C,GAAIs0D,EAAat0D,EAAI,KAAO00D,EAAc,CACxCR,EAAaI,EAAat0D,EAC1B,OAGJ,GAAmB,OAAfk0D,EACF,QAGF,KAAK,GAAIS,GAAK,EAAGA,EAAK9tD,EAAYkL,UAAUi8B,MAAMruC,SAAUg1D,EAC1D,GAAI9tD,EAAYkL,UAAUi8B,MAAM2mB,GAAI1+B,SAAWjK,EAAE3a,GAE/C,IAAK,GAAIvE,GAAI,EAAGA,EAAIjG,EAAYkL,UAAUlF,OAAOlN,SAAUmN,EACzD,GAAIjG,EAAYkL,UAAUlF,OAAOC,GAAG7J,OAASixD,EAG7C,IAAK,GAAIU,GAAK,EAAGA,EAAK/tD,EAAYkL,UAAUlF,OAAOC,GAAGiE,MAAMpR,SAAUi1D,EAChE/tD,EAAYkL,UAAUlF,OAAOC,GAAGiE,MAAM6jD,GAAIvjD,KAAOxK,EAAYkL,UAAUi8B,MAAM2mB,GAAIz+B,MACnFyG,EAAS56B,KAAK8E,EAAYkL,UAAUlF,OAAOC,GAAGiE,MAAM6jD,GAM9D,OAAOj4B,IAaTl8B,EAAS8zD,YAAc,SAAUD,GAC/B,GAAIt0D,GAAG81C,EAAIzP,EAGPv1B,CACJ,KAAK9Q,EAAI,EAAGA,EAAIs0D,EAAa30D,SAAUK,EAErC,IADA8Q,EAAQ7K,EAAa+kB,gBAAgBspC,EAAat0D,IAC7C81C,EAAK,EAAGA,EAAKhlC,EAAMC,MAAMpR,SAAUm2C,EACtChlC,EAAMC,MAAM+kC,GAAI+e,WAKpB,KAAK70D,EAAI,EAAGA,EAAIs0D,EAAa30D,SAAUK,EAIrC,IAHA8Q,EAAQ7K,EAAa+kB,gBAAgBspC,EAAat0D,IAG7C81C,EAAK,EAAGA,EAAKhlC,EAAMC,MAAMpR,SAAUm2C,EAAI,CAC1C,GAAInZ,GAAWl8B,EAAS+lD,aAAa11C,EAAMC,MAAM+kC,GAAKwe,EACtD,KAAKjuB,EAAI,EAAGA,EAAI1J,EAASh9B,SAAU0mC,EACjC1J,EAAS0J,GAAGwuB,SAAS9yD,KAAK+O,EAAMC,MAAM+kC,MAY9Cr1C,EAAS+zD,eAAiB,SAAUF,GAYlC,GAAqBryD,SAAjBqyD,GAA8BA,EAAa30D,OAAS,EAAG,CAGzD,IAAK,GADDmR,GADAgkD,KAEK90D,EAAI,EAAGA,EAAIs0D,EAAa30D,SAAUK,EAAG,CAC5C8Q,EAAQ7K,EAAa+kB,gBAAgBspC,EAAat0D,GAClD,KAAK,GAAI81C,GAAK,EAAGA,EAAKhlC,EAAMC,MAAMpR,SAAUm2C,EACF,IAApChlC,EAAMC,MAAM+kC,GAAI+e,SAASl1D,QAC3Bm1D,EAAe/yD,KAAK+O,EAAMC,MAAM+kC,IAOtC,GAAIqQ,GACAp1C,IAEJ,KADAA,EAAQA,EAAMw1C,OAAOuO,GACd/jD,EAAMpR,OAAS,GACpBwmD,EAAcp1C,EAAMi5B,MACpBj5B,EAAQA,EAAMw1C,OAAO9lD,EAAS+lD,aAAaL,EAAamO,IACxDnO,EAAY4B,UAAW,CAQzB,KAFAh3C,KACAA,EAAQA,EAAMw1C,OAAOuO,GACd/jD,EAAMpR,OAAS,GACpBwmD,EAAcp1C,EAAMi5B,MACfxpC,EAAUkI,eAAe2d,aAAa8/B,EAAY90C,MACrDN,EAAQA,EAAMw1C,OAAO9lD,EAAS+lD,aAAaL,EAAamO,KAE1DnO,EAAY4B,UAAW,IAO7BtnD,EAASglD,eAAiB,SAAUz5B,EAAGsoC,GAErC,GAAIS,IAAgBv0D,EAAUkI,eAAe2d,aAAa2F,EAAE3a,GAC5D7Q,GAAUkI,eAAege,aAAasF,EAAE3a,GAAI0jD,EAO5C,KAFA,GAAIC,GACAC,EAAcx0D,EAAS+lD,aAAax6B,EAAGsoC,GACpCW,EAAYt1D,OAAS,GAAG,CAC7Bq1D,EAAoBC,EAAYjrB,MAChCirB,EAAcA,EAAY1O,OAAO9lD,EAAS+lD,aAAawO,EAAmBV,GAC1E,IAAIjlB,GAAM7uC,EAAUkI,eAAe8d,uBAAuBwuC,EAAkB3jD,GACxE0jD,GACFv0D,EAAUkI,eAAeoe,uBAAuBkuC,EAAkB3jD,GAAIg+B,EAAM,GAE5E7uC,EAAUkI,eAAeoe,uBAAuBkuC,EAAkB3jD,GAAIg+B,EAAM,GAE9E7uC,EAAUkI,eAAeke,oBAAoBouC,EAAkB3jD,IAC7D2a,EAAEy4B,GACFz4B,EAAE04B,OAIDjkD,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,sBAClC,KACA,SAA4BC,GAE1B,GAAIE,KAoFJ,OA3EAA,GAASy0D,mBAAqB,SAAUnC,GACtC,IAAK,GAAI/yD,GAAI,EAAGA,EAAI+yD,EAAIpzD,OAAQK,IAC9B+yD,EAAI/yD,GAAKka,KAAK6V,IAAIgjC,EAAI/yD,GAExB,OAAO+yD,IAKTtyD,EAAS00D,oBAAsB,SAAUpC,EAAKrhC,GAC5C,IAAK,GAAI1xB,GAAI,EAAGA,EAAI+yD,EAAIpzD,OAAQK,IAC9B+yD,EAAI/yD,GAAK+yD,EAAI/yD,GAAK0xB,CAEpB,OAAOqhC,IAMTtyD,EAAS20D,cAAgB,SAAUC,EAAIC,EAAIC,EAAIC,EAAIroC,GACjD,MAAOmoC,IAAME,EAAKF,KAAQnoC,EAAIkoC,IAAOE,EAAKF,KAS5C50D,EAASg1D,WAAa,SAAU1C,EAAK2C,GACnC,GAAIhkC,GAAK5c,CACT,IAAiB,QAAb4gD,EAAoB,CACtBhkC,EAAMqU,EAAAA,CACN,KAAK,GAAI/lC,GAAI,EAAGA,EAAI+yD,EAAIpzD,OAAQK,IAC1B+yD,EAAI/yD,GAAK0xB,IACXA,EAAMqhC,EAAI/yD,GACV8U,EAAM9U,OAGL,IAAiB,QAAb01D,EAAoB,CAC7BhkC,IAAOqU,EAAAA,EACP,KAAK,GAAI/lC,GAAI,EAAGA,EAAI+yD,EAAIpzD,OAAQK,IAC1B+yD,EAAI/yD,GAAK0xB,IACXA,EAAMqhC,EAAI/yD,GACV8U,EAAM9U,GAIZ,OACE0xB,IAAOA,EACP5c,IAAOA,IAMXrU,EAASk1D,oBAAsB,SAAUC,GACvC,GAAIC,KAEJ,OADAA,GAASA,EAAOtP,OAAOtgB,MAAM4vB,EAAQD,IAOvCn1D,EAASq1D,yBAA2B,SAAUvzB,GAE5C,IAAK,GADDwzB,MACK/1D,EAAI,EAAGA,EAAIuiC,EAAE5iC,OAAQK,IAC5B+1D,EAAQh0D,MACNorB,EAAGntB,EACHuiC,EAAGA,EAAEviC,IAGT,OAAO+1D,IAEFt1D,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,kBAClC,KACA,OACA,YACA,eACA,cACA,wBACA,kBACA,qBACA,eACA,iBACA,cACA,SAAwBC,EAAI8E,EAAM7E,EAAWyF,EAAcuuB,EAAa1uB,EAAuBE,EAAiB6oC,EAAoB/nC,EAAcnB,EAAgBkB,GAEhK,GAEIvE,GAFA7B,IAsSJ,OAhSAA,GAASw6B,oBAAsB,WAC7B,GAAI34B,GAAQ/B,EAAG+B,QAEX0zD,EAAYx1D,EAAUktB,oBAAoB7mB,EAAYzF,KAAKyL,OAC/D,IAAyB,IAArBmpD,EAAUr2D,OAIZ,MAHAmH,GAAauD,KAAK,mBAAoB,2EAA2EH,KAAK,WACpH5H,EAAMqhC,WAEDrhC,CAGT,IAAIgB,GAAYwC,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcg3B,yBACrGvuD,EAAK0C,EAAsB9C,mBAAmBM,GAC9C49B,EAAMl7B,EAAgBm7B,iBAAiB/9B,EAAGH,KAAMG,EAAGg+B,YACnDC,EAAQr7B,EAAgBs7B,iCAAiCl+B,EAAGH,MAE5DgzD,EAAanwD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAci3B,sBACtGsE,EAAMpwD,EAAsB9C,mBAAmBizD,GAC/CE,EAAOnwD,EAAgBm7B,iBAAiB+0B,EAAIjzD,KAAMizD,EAAI90B,WAC7Cp7B,GAAgBs7B,iCAAiC40B,EAAIjzD,KAClE,IAAmB,IAAfi+B,EAAIvhC,QAAgC,IAAhBw2D,EAAKx2D,OAI3B,MAHAmH,GAAauD,KAAK,mBAAoB,kHAAkHH,KAAK,WAC3J5H,EAAMqhC,WAEDrhC,CAGT,IAAI8zD,GAAcvnB,EAAmB8mB,oBAAoBz0B,EAAIoB,QACzD+zB,EAAexnB,EAAmB8mB,oBAAoBQ,EAAK7zB,QAE3Dg0B,GACAC,IACAA,KAEAC,GACAD,IACAA,KAEAE,GACAF,IACAA,KAEAG,GACAH,IACAA,IAGJF,GAAexnB,EAAmBqmB,mBAAmBmB,EAErD,IAAIM,GAAen2D,EAAUivB,uBACzBmnC,EAAap2D,EAAUkvB,qBACvBwS,EAAmBhoB,KAAKC,MAAMw8C,EAAet1B,EAAMthB,WAAashB,EAAMI,WACtEU,EAAiBjoB,KAAKC,MAAMy8C,EAAav1B,EAAMthB,WAAashB,EAAMI,WAClEW,EAAcD,EAAiBD,EAC/B20B,EAAST,EAAYj/C,MAAM+qB,EAAkBA,EAAmBE,GAChE00B,EAAUT,EAAal/C,MAAM+qB,EAAkBA,EAAmBE,GAElE20B,EAAiBloB,EAAmB4mB,WAAWoB,EAAQ,MAC3DH,GAAK,GAAKK,EAAejiD,GAEzB,IAAIkiD,GAAwBnoB,EAAmB4mB,WAAWqB,EAAQ3/C,MAAM,EAAGu/C,EAAK,GAAK,GAAI,MACzFF,GAAK,GAAKQ,EAAsBliD,GAEhC,IAAImiD,GAAqBpoB,EAAmB4mB,WAAWqB,EAAQ3/C,MAAM,EAAGq/C,EAAK,GAAK,GAAI,MAsJtF,OApJAnxD,GAAKukC,KAAK,6BACVnpC,EAASy2D,0BAA0BJ,EAAQ3/C,MAAM,EAAGq/C,EAAK,GAAK,GAAIS,EAAmBvlC,IAAKslC,EAAsBtlC,IAAK5rB,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcw8B,UAAW,EAAG,6BAA6BjtD,KAAK,SAAUuB,GAEtQ,GAAI2rD,GAAO3rD,CACX6qD,GAAK,GAAKc,CAEV,IAAIC,GAA6BxoB,EAAmB4mB,WAAWqB,EAAQ3/C,MAAMq/C,EAAK,GAAIE,EAAK,GAAK,GAAI,OAChGY,EAAOD,EAA2BviD,IAAM0hD,EAAK,EAEjDnxD,GAAKukC,KAAK,6BACVnpC,EAASy2D,0BAA0BJ,EAAQ3/C,MAAMq/C,EAAK,GAAIc,EAAO,GAAID,EAA2B3lC,IAAKslC,EAAsBtlC,IAAK5rB,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcw8B,UAAW,GAAI,6BAA6BjtD,KAAK,SAAUuB,GAClR,GAAI8rD,GAAQ9rD,CACZgrD,GAAK,GAAKc,EAAQf,EAAK,EAEvB,IAAIgB,GAAuB3oB,EAAmB4mB,WAAWqB,EAAQ3/C,MAAMu/C,EAAK,IAAK,MAEjFF,GAAK,GAAKgB,EAAqB1iD,IAAM4hD,EAAK,EAE1C,IAAIe,GAA+B5oB,EAAmB4mB,WAAWqB,EAAQ3/C,MAAMu/C,EAAK,GAAIF,EAAK,GAAK,GAAI,MACtGc,GAAOG,EAA6B3iD,IAAM4hD,EAAK,GAE/CrxD,EAAKukC,KAAK,8BACVnpC,EAASy2D,0BAA0BJ,EAAQ3/C,MAAMmgD,EAAMd,EAAK,GAAK,GAAIiB,EAA6B/lC,IAAK8lC,EAAqB9lC,IAAK5rB,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcw8B,UAAW,EAAG,8BAA8BjtD,KAAK,SAAUuB,GACnR,GAAI2rD,GAAO3rD,CACXgrD,GAAK,GAAKW,EAAOE,CAEjB,IAAII,GAA+B7oB,EAAmB4mB,WAAWqB,EAAQ3/C,MAAMq/C,EAAK,IAAK,MACzFc,GAAOI,EAA6B5iD,IAAM0hD,EAAK,GAE/CnxD,EAAKukC,KAAK,8BACVnpC,EAASy2D,0BAA0BJ,EAAQ3/C,MAAMq/C,EAAK,GAAIc,EAAO,GAAII,EAA6BhmC,IAAK8lC,EAAqB9lC,IAAK5rB,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcw8B,UAAW,GAAI,8BAA8BjtD,KAAK,SAAUuB,GACpR,GAAI8rD,GAAQ9rD,CACZ6qD,GAAK,GAAKiB,EAAQf,EAAK,EAGvB,IAAImB,EAEJrB,GAAK,GAAKtwD,EAAgBknC,uBAAuBhL,EAAmBo0B,EAAK,GAAIj1B,EAAMthB,WAAYshB,EAAMI,WACrG60B,EAAK,GAAKtwD,EAAgBknC,uBAAuBhL,EAAmBo0B,EAAK,GAAIj1B,EAAMthB,WAAYshB,EAAMI,WACrGk2B,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAci9B,sBAAsB,EAC1H,IAAIC,GAAgB5xD,EAAa40B,YAAYr6B,EAAUiR,uBAAwB6kD,EAAK,GAAIqB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS2zD,EAAK,GACdjlD,GAAMwmD,EAAcxmD,GACpB2pB,UAAa28B,IAEfA,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAci9B,sBAAsB,EAC1H,IAAIE,GAAgB7xD,EAAa40B,YAAYr6B,EAAUiR,uBAAwB6kD,EAAK,GAAIqB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS2zD,EAAK,GACdjlD,GAAMymD,EAAczmD,GACpB2pB,UAAa28B,IAGfnB,EAAK,GAAKxwD,EAAgBknC,uBAAuBhL,EAAmBs0B,EAAK,GAAIn1B,EAAMthB,WAAYshB,EAAMI,WACrG+0B,EAAK,GAAKxwD,EAAgBknC,uBAAuBhL,EAAmBs0B,EAAK,GAAIn1B,EAAMthB,WAAYshB,EAAMI,WACrGk2B,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAco9B,0BAA0B,EAC9H,IAAIC,GAAgB/xD,EAAa40B,YAAYr6B,EAAUiR,uBAAwB+kD,EAAK,GAAImB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS6zD,EAAK,GACdnlD,GAAM2mD,EAAc3mD,GACpB2pB,UAAa28B,IAEfA,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAco9B,0BAA0B,EAC9H,IAAIE,GAAgBhyD,EAAa40B,YAAYr6B,EAAUiR,uBAAwB+kD,EAAK,GAAImB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS6zD,EAAK,GACdnlD,GAAM4mD,EAAc5mD,GACpB2pB,UAAa28B,IAGflB,EAAK,GAAKzwD,EAAgBknC,uBAAuBhL,EAAmBu0B,EAAK,GAAIp1B,EAAMthB,WAAYshB,EAAMI,WACrGg1B,EAAK,GAAKzwD,EAAgBknC,uBAAuBhL,EAAmBu0B,EAAK,GAAIp1B,EAAMthB,WAAYshB,EAAMI,WACrGk2B,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcu9B,kCAAkC,EACtI,IAAIC,GAAgBlyD,EAAa40B,YAAYr6B,EAAUiR,uBAAwBglD,EAAK,GAAIkB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS8zD,EAAK,GACdplD,GAAM8mD,EAAc9mD,GACpB2pB,UAAa28B,IAEfA,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAcu9B,kCAAkC,EACtI,IAAIE,GAAgBnyD,EAAa40B,YAAYr6B,EAAUiR,uBAAwBglD,EAAK,GAAIkB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS8zD,EAAK,GACdplD,GAAM+mD,EAAc/mD,GACpB2pB,UAAa28B,IAGfjB,EAAK,GAAK1wD,EAAgBknC,uBAAuBhL,EAAmBw0B,EAAK,GAAIr1B,EAAMthB,WAAYshB,EAAMI,WACrGk2B,EAAW7xD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAc09B,oBACpG,IAAIC,GAAgBryD,EAAa40B,YAAYr6B,EAAUiR,uBAAwBilD,EAAK,GAAIiB,EACxFhyD,GAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,cACVnO,KAAQzC,EAAUiR,uBAClB9O,MAAS+zD,EAAK,GACdrlD,GAAMinD,EAAcjnD,GACpB2pB,UAAa28B,GAEf,IAAIY,GAAgBzyD,EAAsBzB,mBAAmB7D,EAAUiR,wBAAwBkpB,cAAck3B,kBACzG2G,EAAmBvyD,EAAa+kB,gBAAgButC,GAChDE,EAAkBxyD,EAAa4pC,oBAAoB2oB,EACvD1xD,GAAauD,KAAK,8BAA+BouD,EAAiBx2D,QAAW,GAAMiI,KAAK,SAAUwuD,GAChG,GAAIA,KAAY,EAAO,CACrB,GAAIzvB,IACA4uB,EAAcxmD,GACdymD,EAAczmD,GACd2mD,EAAc3mD,GACd4mD,EAAc5mD,GACd8mD,EAAc9mD,GACd+mD,EAAc/mD,GACdinD,EAAcjnD,GAElBmjB,GAAYmU,cAAc6vB,EAAiB1nD,MAAMC,MAAM2nD,GAASrnD,GAAI43B,GACpEtjC,EAAeqX,oBACb5S,KAAQ,QACRgH,OAAU,gBACVnO,KAAQu1D,EAAiB1nD,MAAM7N,KAC/B+lC,SAAYwvB,EAAiB1nD,MAAMC,MAAM2nD,GAASrnD,GAClD43B,SAAYA,IAEdtjC,EAAewD,gCAGnB7G,EAAMG,iBAIX,cAEIH,EAAMI,SAcfjC,EAASy2D,0BAA4B,SAAU/pC,EAAGyU,EAAQC,EAAQs1B,EAAWwB,EAAWC,GAEtF,GAAIC,GAAQj3B,GAAUC,EAASD,GAAUu1B,EACrC2B,EAAQH,CACZE,IAAgBC,CAShB,KAAK,GARDC,GAAKlqB,EAAmBsmB,oBAAoBhoC,EAAG2rC,GAE/CE,EAAKD,EAAGp5D,OACRs5D,EAAMF,EAAG5hD,MAAM,EAAG6hD,GAClBE,EAAQ,EACRC,EAAQH,EAAK,EAEbI,KACKp5D,EAAI,EAAGA,EAAI+4D,EAAGp5D,OAAQK,IACzBi5D,EAAIj5D,IAAM64D,GAASE,EAAG/4D,GAAK64D,GAC7BO,EAAGr3D,KAAK/B,EAKZ,KAAK,GADDq5D,MACKr5D,EAAI,EAAGA,EAAIo5D,EAAGz5D,OAAQK,IACzBo5D,EAAGp5D,IAAMk5D,GAASE,EAAGp5D,IAAMm5D,GAC7BE,EAAMt3D,KAAK/B,EAGf,IAAIq5D,EAAM15D,OAAS,EAAG,CACpB2C,EAAQ/B,EAAG+B,OACX,IAAIg3D,KACJA,GAAMV,YAAcA,EACpBU,EAAM5e,WACN4e,EAAM/2B,EAAIw2B,EACVO,EAAM13B,OAASA,EACf03B,EAAMz3B,OAASA,EACfy3B,EAAMnC,UAAYA,CAClB,KAAK,GAAIn3D,GAAI,EAAGA,EAAIo5D,EAAGz5D,OAAQK,IAC7Bs5D,EAAM5e,QAAQ34C,MACZw3D,aAAgBH,EAAGp5D,GACnBw5D,eAAkBT,EAAG/4D,IASzB,OANA8G,GAAauD,KAAK,kCAAmCivD,EAAOr3D,QAAW,GAAMiI,KAAK,SAAUuB,GAC1FvJ,QAAQ2zB,IAAIpqB,EACZ,IAAIguD,GAAKL,EAAGC,EAAM5tD,GAClBguD,GAAK5qB,EAAmBumB,cAAc2D,EAAGU,GAAKA,EAAIV,EAAGU,EAAK,GAAIA,EAAK,EAAGZ,GACtEv2D,EAAMG,QAAQg3D,KAETn3D,EAAMI,QACR,GAAqB,IAAjB22D,EAAM15D,OAKf,MAJA2C,GAAQ/B,EAAG+B,QACXwE,EAAauD,KAAK,mBAAoB,4DAA4DH,KAAK,WACrG5H,EAAMqhC,OAAO,8DAERrhC,EAAMI,OAEbJ,GAAQ/B,EAAG+B,OACX,IAAIm3D,GAAKL,EAAGC,EAAM,GAGlB,OAFAI,GAAK5qB,EAAmBumB,cAAc2D,EAAGU,GAAKA,EAAIV,EAAGU,EAAK,GAAIA,EAAK,EAAGZ,GACtEv2D,EAAMG,QAAQg3D,GACPn3D,EAAMI,SAGVjC,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,wBAClC,KACA,wBACA,eACA,SAA8BC,EAAIuF,EAAuBgB,GAEvD,GAAIrG,KA8BJ,OA7BAA,GAASi5D,oBACTj5D,EAASk5D,eAAiB,GAG1Bl5D,EAAS49B,UAAY,SAAUp7B,EAAMoL,GACnC,GAAI/L,GAAQ/B,EAAG+B,OAYf,OAVArC,SAAQwB,QAAQhB,EAASi5D,iBAAkB,SAAU38C,EAAQ/c,GAC3D,GAAI+c,EAAO9Z,OAASA,EAAM,CACxB,GAAI22D,GAAK35D,QAAQoB,KAAK0b,SACf68C,GAAG32D,KACVX,EAAMG,SACJyK,OAAQ,IACR9L,KAAMw4D,OAILt3D,EAAMI,SAEfjC,EAASmJ,iBAAmB,WAC1BnJ,EAASi5D,oBACTj5D,EAASk5D,eAAiB,IAE5Bl5D,EAASo5D,kBAAoB,SAAU52D,GACrCxC,EAASk5D,eAAiB12D,GAE5BxC,EAASq5D,kBAAoB,WAC3B,MAAOr5D,GAASk5D,gBAEXl5D,KAIXR,QAAQC,OAAO,aAAaI,QAAQ,oBAClC,KACA,aACA,eACA,cACA,oBACA,wBACA,uBACA,mBACA,YACA,sBACA,wBACA,kBACA,mBACA,wBACA,wBACA,eACA,SAA0BC,EAAI6E,EAAY0B,EAAcD,EAAaL,EAAmBV,EAAuB83B,EAAsBh4B,EAAkBpF,EAAWqF,EAAqBO,EAAuBW,EAAiBV,EAAkBH,EAAuBQ,EAAuBT,GAE7R,GAAIxF,KAgRJ,OA/QAA,GAASs5D,mBACTt5D,EAASu5D,cACTv5D,EAASw5D,YAAc,UACvBx5D,EAAS+tD,kBAAoB,GAK7B/tD,EAASiM,QAAU,SAAUohD,GAC3B,GAAIF,GAAQ,CAQZ,OAPA3tD,SAAQwB,QAAQqsD,EAAS,SAAU/wC,EAAQ/c,GACzCS,EAASy5D,iBAAiBn9C,EAAO,GAAI/c,EAAG,MAAO+c,EAAO,IACpC9a,SAAd8a,EAAO,IACTtc,EAASy5D,iBAAiBn9C,EAAO,GAAI/c,EAAG,aAAc+c,EAAO,IAE/D6wC,EAAQ5tD,IAEN4tD,GAASntD,EAAS+tD,sBACpB/tD,GAAS05D,qBAAqB15D,EAASs5D,gBAAiB,GAAG7vD,KAAK,WAK9D,MAJAxD,GAAsBgJ,cAAcjP,EAASu5D,YAC7CtzD,EAAsBuE,eAAexK,EAASu5D,WAAWp8B,EAAqB+7B,iBAC9EjzD,EAAsB4L,cAAc7R,EAASu5D,WAAWp8B,EAAqB+7B,iBAC7El5D,EAAS25D,oBACF,KAGF,GAGX35D,EAASmJ,iBAAmB,iBACnBnJ,GAASs5D,gBAChBt5D,EAASs5D,yBACFt5D,GAASu5D,WAChBv5D,EAASu5D,cACTv5D,EAASw5D,YAAc,UACvBx5D,EAAS+tD,kBAAoB,GAC7B5wB,EAAqBh0B,mBACrBlD,EAAsBkD,oBAKxBnJ,EAASy5D,iBAAmB,SAAUn9C,EAAQ/c,EAAGoK,EAAMhJ,GACrDw8B,EAAqBi8B,kBAAkB75D,GACHiC,SAAhCxB,EAASs5D,gBAAgB/5D,KAC3BS,EAASs5D,gBAAgB/5D,MACzB49B,EAAqB87B,iBAAiB15D,MACtC49B,EAAqB87B,iBAAiB15D,GAAGiD,KAAO8Z,EAChDtc,EAASu5D,WAAWj4D,MAClBkB,KAAM8Z,EACN1O,QAAS5N,EAASw5D,eAGT,QAAT7vD,EACF3J,EAASs5D,gBAAgB/5D,GAAGq6D,IAAMj5D,EAChB,eAATgJ,IACT3J,EAASs5D,gBAAgB/5D,GAAGs6D,WAAal5D,IAM7CX,EAAS85D,iBAAmB,SAAUx9C,EAAQ3S,GAC5C,MAAa,QAATA,EACK3J,EAASs5D,gBAAgBh9C,GAAQs9C,IACtB,eAATjwD,EACF3J,EAASs5D,gBAAgBh9C,GAAQu9C,YAEjC,GAGX75D,EAAS+5D,aAAe,SAAUp5D,GAChC,GAAI4f,EAMJ,OAJEA,GADiB,gBAARC,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgB1gB,EAAS6f,QAAQlf,IAE3C6f,IAAIE,gBAAgB1gB,EAAS6f,QAAQlf,KAOlDX,EAAS6f,QAAU,SAAUlf,GAC3B,GAAImf,EACJ,KACEA,EAAO,GAAIC,OAAMpf,IAASgJ,KAAM,eAChC,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOzf,GACZmf,EAAOA,EAAKD,UAEd,MAAOC,IAET9f,EAAS05D,qBAAuB,SAAUrM,EAAS9tD,GACjD,GAIIkD,GAJAZ,EAAQ/B,EAAG+B,QACXlB,EAAOX,EAASs5D,gBAAgB/5D,GAChC2uD,EAAS,GAAIY,YACbkL,EAAU,GAAIlL,WAElB,OAAIzB,GAAQnuD,OAASK,GACFiC,SAAbb,EAAKi5D,MACP1L,EAAO+L,kBAAkBt5D,EAAKi5D,KAC9B1L,EAAOgM,UAAY,SAAU/nB,GACvBA,EAAIxwB,OAAOw4C,YAAcrL,WAAWsL,OAEpC33D,EADE6D,EAAgBiH,UAAUqS,UACtBuyB,EAAIxwB,OAAOiU,OAEXuc,EAAIkoB,cAAczkC,OAE1BhwB,EAAiByF,eAAe5I,GAAKgH,KAAK,SAAU8B,GACD/J,SAA7C27B,EAAqB87B,iBAAiB15D,KACxC49B,EAAqB87B,iBAAiB15D,OAExC49B,EAAqB87B,iBAAiB15D,GAAG+6D,aACzCl1D,EAAoBmG,OAASA,EAC7B4xB,EAAqB87B,iBAAiB15D,GAAG+6D,UAAU35D,KAAOgF,EAAsB2zC,oBAAoB/tC,EAAOk0B,YAC3GtC,EAAqB87B,iBAAiB15D,GAAG+6D,UAAUC,SAAW,SAC9Dp9B,EAAqB87B,iBAAiB15D,GAAGi7D,YACzC,IAAIl+C,GAAS3b,EAAKi5D,IAAIp3D,KAAKiI,OAAO,EAAG9J,EAAKi5D,IAAIp3D,KAAKkI,YAAY,KACvClJ,UAApBb,EAAKk5D,YACP18B,EAAqB87B,iBAAiB15D,GAAGs6D,YACvCztD,UACAmhC,SACAjuB,WAAY/T,EAAOkT,WACnBwf,UAAW3hB,EACX9Z,KAAM8Z,GAERtc,EAAS05D,qBAAqBrM,EAAS9tD,EAAI,GAAGkK,KAAK,iBAC1CzJ,GAASs5D,gBAChBt5D,EAASs5D,mBACTz3D,EAAMG,aAGqB,aAAzBrB,EAAKk5D,WAAWlwD,MAClBqwD,EAAQS,WAAW95D,EAAKk5D,WAAWttB,MACnCytB,EAAQE,UAAY,SAAU/nB,GACxBA,EAAIxwB,OAAOw4C,YAAcrL,WAAWsL,MACtC30D,EAAsB24B,mBAAmB+T,EAAIkoB,cAAczkC,OAAQj1B,EAAKi5D,IAAIp3D,KAAM8Z,GAAQ7S,KAAK,SAAUsC,GACvGoxB,EAAqB87B,iBAAiB15D,GAAGs6D,WAAa9tD,EACtD/L,EAAS05D,qBAAqBrM,EAAS9tD,EAAI,GAAGkK,KAAK,WACjD5H,EAAMG,aAEP,SAAU8H,GACXzD,EAAauD,KAAK,mBAAoB,gCAAkCE,EAAQ2C,OAAO/C,SAASD,KAAK,WACnG5H,EAAMqhC,eAKoB,eAAzBviC,EAAKk5D,WAAWlwD,OACzBtE,EAAsBpF,KAAKmK,cAAcmsB,eAAgB,EACzDyjC,EAAQS,WAAW95D,EAAKk5D,WAAWttB,MACnCytB,EAAQE,UAAY,SAAU/nB,GACxBA,EAAIxwB,OAAOw4C,YAAcrL,WAAWsL,OACtCj9B,EAAqB87B,iBAAiB15D,GAAGs6D,WAAar6D,QAAQ8+B,SAAS6T,EAAIkoB,cAAczkC,QACzF51B,EAAS05D,qBAAqBrM,EAAS9tD,EAAI,GAAGkK,KAAK,WACjD5H,EAAMG,gBAMf,SAAU8H,GACXzD,EAAauD,KAAK,mBAAoB,2BAA6BE,EAAQ2C,OAAO/C,SAASD,KAAK,WAC9F5H,EAAMqhC,gBAUXrhC,EAAMI,UAHXJ,EAAMG,UACCH,EAAMI,UAOjBjC,EAAS25D,iBAAmB,WAC1B,GAAIzuD,GAGA2uD,EAFAD,EAAMz8B,EAAqB87B,iBAAiB97B,EAAqB+7B,gBAAgBoB,UAAU35D,KAC3Fm+B,EAAKn5B,EAAsBozC,oBAAoB6gB,EAGjDC,GAD4Fr4D,SAA1F27B,EAAqB87B,iBAAiB97B,EAAqB+7B,gBAAgBW,WAChE18B,EAAqB87B,iBAAiB97B,EAAqB+7B,gBAAgBW,YAGtFztD,UACAmhC,UAGJxtC,EAAUwK,cAAe,EACzBxK,EAAUyM,SAAS,iBAEnBzM,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,uBAAyBuwD,EAAIp3D,KAChE2C,EAAiBmF,YAAY,+CAA+Cb,KAAK,SAAUuB,GAEzFjL,EAAUgD,kBAAoB,EAC9BsC,EAAsBxE,QAAQmK,EAAKrK,KAAKsK,uBACjCD,GAAKrK,KAAKsK,gBAEjBC,EAAWnF,EAAkBoF,YAAY,wBAAyB9F,EAAsBpF,MACpFiL,KAAa,IACf7F,EAAsBlF,YAAc6K,EAAKrK,KACzCZ,EAAUsJ,uBAAyB,sBACnCzD,EAAiByF,eAAeyzB,GAAIr1B,KAAK,SAAU6B,GACjD,GAAIC,GAASD,CACbvL,GAAUyL,YAAYC,GAAK,EAC3B1L,EAAUyL,YAAYE,GAAKH,EAAOI,KAAKzM,OACvCa,EAAUyL,YAAY0H,QAAU,GAChCnT,EAAUyL,YAAY2H,QAAU,GAChCpT,EAAU26D,oBACV36D,EAAUinB,kBAAoBxlB,OAC9BzB,EAAUknB,kBAAoBzlB,OAC9ByE,EAAsB00D,WAAWx9B,EAAqB87B,iBAAiB97B,EAAqB+7B,iBAC5Fn5D,EAAU6L,cACV7L,EAAUgD,kBAAoB,EAC9BqD,EAAY6F,QAAQ4tD,EACpB,IAAI3tD,MACAC,IACJ0tD,GAAWztD,OAAOpL,QAAQ,SAAUqL,IACnB,YAAXA,EAAE1C,MAAiC,UAAX0C,EAAE1C,QAC5BuC,EAAO5K,KAAK+K,EAAE7J,MACd2J,EAAU7K,MACRkB,KAAQ6J,EAAE7J,KACVmH,KAAQ0C,EAAE1C,KACV2C,sBACE9J,KAAQ6J,EAAE7J,KACVmH,KAAQ,eAMhBtE,EAAsBlF,YAAY2D,iBAAmBqI,EACrDpM,EAAUwM,oBAAoBlH,EAAsBlF,YAAY2D,kBAChEuB,EAAsBrB,qBAAqBjE,EAAUgD,kBAAmBmJ,GAExE9G,EAAoBmG,OAASA,EAE7BxL,EAAUsJ,uBAAyB,uBACnC,IAAI6B,GAAWnF,EAAkBoF,YAAY,uBAAwB0uD,EACjE3uD,MAAa,GACf9E,EAAYonC,YAAYqsB,EAAWtsB,OACnCxtC,EAAUyM,SAAS,YACnBzM,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,SAEnChD,EAAauD,KAAK,mBAAoB,qCAAuCG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WAEnHzJ,EAASmJ,qBAIR7C,EAAgBiH,UAAUC,aAC7BzN,EAAU8Q,aAAY,EAAOxL,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAOqB,IACxH,SAAUsE,GACXzD,EAAauD,KAAK,mBAAoB,2BAA6BE,GAASL,KAAK,WAE/EzJ,EAASmJ,0BAKjBpJ,EAAUuJ,qBAAsB,GAE3BtJ,KAUXR,QAAQC,OAAO,aAAauU,UAAU,YAAa,WACjD,OACEG,SAAU,IACVC,OACEzT,KAAM,IACN+1D,UAAW,KAEbpiD,KAAM,SAAkBF,EAAOvM,EAAS8S,GAGtCvG,EAAMa,OAAO,OAAQ,WACnBb,EAAM8sC,OAAO9sC,EAAMzT,QAClB,EAGH,IAAIi6D,IACA5qB,IAAK,GACLriB,MAAO,GACPywB,OAAQ,GACR1wB,KAAM,IACLzW,EAAQ,IAAM2jD,EAAOltC,KAAOktC,EAAOjtC,MAAOzW,EAAS,IAAM0jD,EAAO5qB,IAAM4qB,EAAOxc,OAE9EsD,EAAMiD,GAAGt7B,OAAOxhB,EAAQ,IAAIuY,OAAO,OAAO7L,KAAK,QAAS0C,EAAQ2jD,EAAOltC,KAAOktC,EAAOjtC,OAAOpZ,KAAK,SAAU2C,EAAS0jD,EAAO5qB,IAAM4qB,EAAOxc,QAAQh+B,OAAO,KAAK7L,KAAK,YAAa,aAAeqmD,EAAOltC,KAAO,IAAMktC,EAAO5qB,IAAM,KAE9NtjB,EAAIi4B,GAAGpgB,MAAMs2B,SAASC,OACtB,EACA7jD,IAEA6qB,EAAI6iB,GAAGpgB,MAAMs2B,SAASC,OACtB5jD,EACA,IAGA6jD,EAAQpW,GAAGjD,IAAIsZ,OAAOz2B,MAAM7X,GAAGuuC,SAAS,GAAGC,eAAc,GACzDC,EAAQxW,GAAGjD,IAAIsZ,OAAOz2B,MAAMzC,GAAGs5B,OAAO,QAEtCC,EAAW1W,GAAGjD,IAAI4Z,OAAO5uC,EAAE,SAAUnB,GACrC,MAAOmB,GAAEnB,EAAEmB,KACVoV,EAAE,SAAUvW,GACb,MAAOuW,GAAEvW,EAAEuW,KACVy5B,YAAY,SAIjBnnD,GAAM8sC,OAAS,SAAUvgD,GAQvB+rB,EAAE8uC,QACA7W,GAAG/f,IAAIjkC,EAAM,SAAU4qB,GACrB,MAAOA,GAAEmB,IAEXi4B,GAAG9f,IAAIlkC,EAAM,SAAU4qB,GACrB,MAAOA,GAAEmB,MAGboV,EAAE05B,QACA7W,GAAG/f,IAAIjkC,EAAM,SAAU4qB,GACrB,MAAOA,GAAEuW,IAEX6iB,GAAG9f,IAAIlkC,EAAM,SAAU4qB,GACrB,MAAOA,GAAEuW,MAIb4f,EAAII,UAAU,UAAUjS,SAExB6R,EAAIthC,OAAO,KAAK7L,KAAK,QAAS,UAAUA,KAAK,YAAa,eAAiB2C,EAAS,KAAKuuB,KAAKs1B,GAE9FrZ,EAAIthC,OAAO,KAAK7L,KAAK,QAAS,UAAUkxB,KAAK01B,EAEjCzZ,GAAIthC,OAAO,YAAY7L,KAAK,IAAK8mD,EAAS16D,IAAO4T,KAAK,SAAU,OAAOA,KAAK,eAAgB,GAAGA,KAAK,OAAQ,OAExHmtC,GAAIthC,OAAO,YAAY7L,KAAK,KAAM,GAAGA,KAAK,KAAM,GAAGA,KAAK,KAAM,KAAKA,KAAK,KAAM,KAAKA,KAAK,QAAS,aAC9EmtC,GAAIthC,OAAO,QAAQ7L,MAClCugD,GAAMpoC,EAAEtY,EAAMsiD,WACd3B,GAAM,EACN0G,GAAM/uC,EAAEtY,EAAMsiD,WACdgF,GAAMxkD,IACL3C,KAAK,SAAU,aAAaA,KAAK,QAAS,qBAwBvD/U,QAAQC,OAAO,aAAauU,UAAU,OAAQ,WAC5C,OACEE,YAAa,kBACb/C,SAAS,EACTgD,SAAU,IACVG,KAAM,SAAkBF,EAAOvM,EAAS8S,GACtCvG,EAAMunD,OAAS,WACbvnD,EAAM1M,aAAaC,eAAiByM,EAAM1M,aAAaC,cACvDyM,EAAMrC,qBAMdvS,QAAQC,OAAO,aAAauU,UAAU,eAAgB,WACpD,OACEE,YAAa,0BACb/C,SAAS,EACTgD,SAAU,IACVG,KAAM,SAAkBF,EAAOvM,EAAS8S,QAY5Cnb,QAAQC,OAAO,aAAaI,QAAQ,yBAClC,oBACA,SAA+BkG,GAc7B,QAAS61D,GAAmBC,GAC1B,GACIC,GADAC,IAUJ,OARAF,GAAS76D,QAAQ,SAAUg7D,EAAM3nD,GAC/B0nD,EAAMC,EAAKpuD,UAAa6B,WAAa,GACzB,IAAR4E,IACFynD,EAAUE,EAAKpuD,WAInBmuD,EAAMD,GAASrsD,WAAY,EACpBssD,EAET,QAASE,GAAmBJ,GAO1B,MANAA,GAAS76D,QAAQ,SAAUg7D,EAAM3nD,GACO7S,SAAlC06D,EAAgBF,EAAKpuD,WACvBsuD,EAAgBF,EAAKpuD,aAEvBsuD,EAAgBF,EAAKpuD,SAAStM,KAAK06D,KAE9BE,EAhCT,GAAIl8D,MAGAwP,KACA+pD,KACA4C,KACAC,EAAa,GAEbF,IA8KJ,OA3IAl8D,GAASiP,cAAgB,SAAUotD,GAEjC,GAAInxD,GAAWnF,EAAkBoF,YAAY,mBAAoBkxD,EASjE,OARInxD,MAAa,IAEfquD,EAAa8C,EAEb7sD,EAAkBosD,EAAmBrC,GAErC2C,EAAkBD,EAAmB1C,IAEhCruD,GAKTlL,EAAS6I,cAAgB,WACvB,MAAO0wD,IAKTv5D,EAASs8D,mBAAqB,WAC5B,MAAOJ,IAOTl8D,EAASoR,WAAa,WACpB,MAAO+qD,IAKTn8D,EAAS26D,WAAa,SAAUqB,GAC9BG,EAAUH,GAKZh8D,EAAS2nC,eAAiB,SAAUzrB,EAAS9Z,EAAKuN,GAChDusD,EAAgB95D,GAAKuN,GAAOuM,QAAUA,GAKxClc,EAAS4nC,gBAAkB,SAAUxrB,EAAUha,EAAKuN,GAClDusD,EAAgB95D,GAAKuN,GAAOwM,gBAAkBC,GAKhDpc,EAAS0N,eAAiB,WACxB,MAAOyuD,GAAQ35D,MAKjBxC,EAASwK,eAAiB,SAAUhI,GAClC25D,EAAQ35D,KAAOA,GAOjBxC,EAAS6R,cAAgB,SAAUrP,GACjC45D,EAAa55D,GAKfxC,EAASu8D,cAAgB,WACvB,MAAOH,IAOTp8D,EAASsP,sBAAwB,SAAU1B,GACzCnM,QAAQ2zB,IAAIxnB,GACqBpM,SAA7BgO,EAAgB5B,KAClB4B,EAAgB5B,OAElB4B,EAAgB5B,GAAS6B,WAAaD,EAAgB5B,GAAS6B,UAE/DxO,OAAOC,KAAKsO,GAAiBxO,QAAQ,SAAUoB,GACzCA,IAAQwL,IACV4B,EAAgBpN,GAAKqN,WAAY,MAIvCzP,EAASqP,oBAAsB,SAAUzB,GACvCnM,QAAQ2zB,IAAIxnB,GACZ4B,EAAgB5B,MAChB4B,EAAgB5B,GAAS6B,WAAY,EAErCxO,OAAOC,KAAKsO,GAAiBxO,QAAQ,SAAUoB,GACzCA,IAAQwL,IACV4B,EAAgBpN,GAAKqN,WAAY,MAmBvCzP,EAASw8D,wBAA0B,SAAU5uD,GAC3C,MAAiCpM,UAA7BgO,EAAgB5B,GACXpM,OAEAgO,EAAgB5B,GAAS6B,WAQpCzP,EAASmJ,iBAAmB,WAC1BqG,KACA+pD,KACA4C,KACAD,MAEKl8D,KAWXR,QAAQC,OAAO,aAAagF,WAAW,yBACrC,SACA,YACA,iBACA,wBACA,uBACA,wBACA,SAAUC,EAAQ3E,EAAWmF,EAAgBe,EAAuBC,EAAsBb;AACxFX,EAAOkC,GAAK7G,EACZ2E,EAAOyC,KAAOlB,EACdvB,EAAO+3D,MAAQv2D,EACfxB,EAAO6B,IAAMlB,EACbX,EAAOg4D,WAAa,GACpBh4D,EAAOkC,GAAGkhB,SAAW,IACrBpjB,EAAOkC,GAAGmhB,YAAc,EACxBrjB,EAAOi4D,KAAO,SAAUzE,GAClBA,EACFxzD,EAAOkC,GAAGmhB,cAEVrjB,EAAOkC,GAAGmhB,eAMdrjB,EAAOk4D,cAAgB,SAAUZ,GAC/B,MAAIA,GAAKx5D,OAASyD,EAAsBmL,aAAa5O,MAC5C,GAEA,GAUXkC,EAAOm4D,aAAe,SAAUb,GAC9B,GAAI9lD,EAEFA,GAD2C,IAAzChR,EAAemN,uBAEf8D,mBAAoB,OACpBpB,MAAS,UAIToB,mBAAoB,OACpBpB,MAAS,QAIb,IAAIonD,GAAUl2D,EAAsBmL,YACpC,OAAI4qD,GAAKx5D,OAAS25D,EAAQ35D,MAAQw5D,EAAKpuD,UAAYuuD,EAAQvuD,QAClDsI,EADT,QAQFxR,EAAOo4D,iBAAmB,SAAUvtD,GAClC,MAAY,cAARA,GACK,GAEA,MAaf/P,QAAQC,OAAO,aAAaI,QAAQ,wBAClC,OACA,KACA,cACA,YACA,iBACA,wBACA,kBACA,mBACA,wBACA,mBACA,sBACA,oBACA,oBACA,eACA,eACA,wBACA,kBACA,uBACA,SAA8B+E,EAAM9E,EAAIsG,EAAarG,EAAWmF,EAAgBe,EAAuBV,EAAiBJ,EAAkBQ,EAAuBC,EAAkBR,EAAqBS,EAAmBE,EAAmBP,EAAca,EAAchB,EAAuBc,EAAiB+b,GAEhT,GAAIliB,KAmNJ,OA9MAA,GAASoP,WAAa,SAAU4sD,GAG9B,GADAj8D,EAAU0tB,gBAAgB,MACmB,IAAzCvoB,EAAemN,uBAA2E,SAA5ChN,EAAsBpF,KAAK6I,KAAK0F,SAAsBnJ,EAAsBpF,KAAKmK,cAAcyzB,WAAY,CAC3J,GAAIs+B,GAAUl2D,EAAsBmL,YAChC4qD,KAASG,GAEX91D,EAAauD,KAAK,yBAA0BuyD,EAAQvuD,QAAU,IAAMuuD,EAAQ35D,MAAMiH,KAAK,SAAUszD,GAC7E,gBAAdA,EAEF/8D,EAAS69B,aAAap0B,KAAK,WAEzBzJ,EAASoP,WAAW4sD,KAEC,mBAAde,IAET73D,EAAeiE,mBAEfnJ,EAASoP,WAAW4sD,UAKtBA,KAAS/1D,EAAsBmL,eAEjClM,EAAeiE,mBAEfpJ,EAAUkI,eAAeuT,QAEzBhW,EAAauC,iBACbhI,EAAU+V,YAAW,GACrB/V,EAAUyM,SAAS,iBACnBzM,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,mBAAqB2yD,EAAKx5D,KAE7D+C,EAAgB5E,QAChBwE,EAAiBy4B,UAAUo+B,EAAKx5D,KAAMw5D,EAAKpuD,QAAS3H,EAAsBs2D,iBAAiB9yD,KAAK,SAAUq0B,GAE9E,MAAtBA,EAAWrxB,SACbqxB,EAAaA,EAAWn9B,KAG1B,IAAIuK,GAAWnF,EAAkBoF,YAAY,eAAgB2yB,EAC7D,IAAI5yB,KAAa,EAAM,CACrB,GAAI8xD,EAEJA,GAAUr3D,EAAsBozC,oBAAoBjb,EAAWw8B,UAAU35D,MACzEZ,EAAUsJ,uBAAyB,sBACnCzD,EAAiByF,eAAe2xD,GAASvzD,KAAK,SAAU6B,GACtD,GAAIC,GAASD,CACbvL,GAAUyL,YAAYC,GAAK,EAC3B1L,EAAUyL,YAAYE,GAAKH,EAAOI,KAAKzM,OACvCa,EAAUyL,YAAY0H,QAAU,GAChCnT,EAAUyL,YAAY2H,QAAU,GAChCpT,EAAU26D,oBACV36D,EAAUinB,kBAAoBxlB,OAC9BzB,EAAUknB,kBAAoBzlB,OAC9BzB,EAAU6L,cACVxG,EAAoBmG,OAASA,EAE7BxL,EAAUsJ,uBAAyB,wBACnCxD,EAAkBs9B,kBAAkBrF,EAAW08B,WAAW/wD,KAAK,SAAUwzD,GACvE13D,EAAgB5E,KAAOs8D,EAAQt8D,KAE/ByF,EAAY6F,QAAQ6xB,EAAW+7B,YAC/B5zD,EAAsB00D,WAAWqB,GAEjCj8D,EAAU8Q,aAAY,EAAOxL,EAAsBpF,KAAK6C,aAAa/C,EAAUgD,mBAAmBmB,cAAcC,MAAOqB,GACvHzF,EAAUyM,SAAS,YACnBzM,EAAUuJ,qBAAsB,EAChCvJ,EAAUsJ,uBAAyB,SAKlC,SAAUS,GACXzD,EAAauD,KAAK,mBAAoB,4BAA8BE,EAAQ2C,OAAO/C,SAASD,KAAK,WAC/FtD,EAAgBgD,wBAGnB,SAAUW,GACXzD,EAAauD,KAAK,mBAAoB,2BAA6BE,EAAQ2C,OAAO/C,SAASD,KAAK,WAC9FtD,EAAgBgD,2BAIpB9C,GAAauD,KAAK,mBAAoB,qCAAuCG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACnHtD,EAAgBgD,sBAGnB,SAAUW,GAEPA,EAAQnJ,KACV0F,EAAauD,KAAK,mBAAoB,yBAA2BE,EAAQnJ,MAAM8I,KAAK,WAClFtD,EAAgBgD,qBAGlB9C,EAAauD,KAAK,mBAAoB,yBAA2BE,EAAQ2C,OAAO/C,SAASD,KAAK,WAC5FtD,EAAgBgD,yBAW5BnJ,EAAS69B,WAAa,WAGpB,GAAI99B,EAAUoQ,cAAc,oBAAqB,CAC/C,GAAItO,GAAQ/B,EAAG+B,OACf9B,GAAUuJ,qBAAsB,EAChCvJ,EAAUyM,SAAS,gBAEnB,IAAIsxB,KACJ/9B,GAAUsJ,uBAAyB,0BACnCy0B,EAAW08B,YAEX,IAAI0C,GAAW33D,EAAgB6mC,QAAQ,WAgBvC,OAfiB5qC,UAAb07D,EACFr3D,EAAkB09B,cAAc25B,GAAUzzD,KAAK,SAAU0zD,GACvDr/B,EAAW08B,UAAUl5D,MACnBgrC,cAAiB4wB,EAAS5wB,cAC1BiuB,SAAY,SACZ55D,KAAQgF,EAAsB2zC,oBAAoB6jB,EAAWx8D,QAE/DX,EAASo9D,yBAAyBt/B,EAAYj8B,IAC7C,SAAUiI,GACXzD,EAAauD,KAAK,mBAAoB,oDAAsDE,EAAQ2C,OAAO/C,SAC3G7H,EAAMqhC,WAGRljC,EAASo9D,yBAAyBt/B,EAAYj8B,GAEzCA,EAAMI,QAEb2C,EAAKukC,KAAK,gDAMdnpC,EAASo9D,yBAA2B,SAAUt/B,EAAYj8B,GAExD9B,EAAUsJ,uBAAyB,0BACnC,IAAI6B,GAAWnF,EAAkBoF,YAAY,uBAAwB/E,EAAYkL,UAC7EpG,MAAa,IACftG,EAAK6pD,KAAK,4FACV7pD,EAAKlD,MAAMwJ,IAGbgX,EAAqByD,iBAAiBvf,EAAYkL,WAIlDwsB,EAAW+7B,WAAazzD,EAAYkL,UAEpCwsB,EAAWw8B,WACTC,SAAY,SACZ55D,KAAQ,GAEV,IAAIw7D,GAAUl2D,EAAsBmL,YAEL,oBAApB+qD,GAAQvuD,UACjBkwB,EAAWlwB,QAAUuuD,EAAQvuD,SAGQ,mBAA5BuuD,GAAQhgD,kBACjB2hB,EAAW3hB,gBAAkBggD,EAAQhgD,iBAGR,mBAApBggD,GAAQjgD,UACjB4hB,EAAW5hB,QAAUigD,EAAQjgD,SAG/Bnc,EAAUsJ,uBAAyB,wBACnC6B,EAAWnF,EAAkBoF,YAAY,eAAgB2yB,GACrD5yB,KAAa,GACftG,EAAKlD,MAAM,2GACXkD,EAAKlD,MAAMwJ,GACX7E,EAAauD,KAAK,mBAAoB,sNAAwNG,KAAKC,UAAUkB,EAAU,KAAM,IAAIzB,KAAK,WACpS1J,EAAUsJ,uBAAyB,GACnCtJ,EAAUuJ,qBAAsB,EAChCvJ,EAAUyM,SAAS,YACnB3K,EAAMqhC,aAGRnjC,EAAUsJ,uBAAyB,mBACnClE,EAAiB04B,WAAWC,GAAYr0B,KAAK,WAC3C1J,EAAUsJ,uBAAyB,QACnCtJ,EAAUuJ,qBAAsB,EAChCpE,EAAemN,sBAAwB,EACvCxQ,EAAMG,UACNjC,EAAUyM,SAAS,aAClB,SAAU1C,GACXzD,EAAauD,KAAK,mBAAoB,wBAA0BE,EAAQ2C,OAAO/C,SAASD,KAAK,WAC3FtD,EAAgBgD,qBAElBtH,EAAMqhC,aAKLljC,KAWXR,QAAQC,OAAO,aAAaI,QAAQ,mBAClC,OACA,aACA,YACA,mBACA,uBACA,YACA,mBACA,wBACA,sBACA,cACA,kBACA,iBACA,SAAyB+E,EAAMD,EAAYM,EAAWonD,EAAkBlvB,EAAsBp9B,EAAWoF,EAAkBc,EAAuBb,EAAqBgB,EAAab,EAAiBL,GAEnM,GAAIlF,KAiDJ,OA7CAA,GAASmJ,iBAAmB,WACtBhE,EAAiBoE,IAAIkvC,eACvBtzC,EAAiBoE,IAAIovC,oBAAoBlvC,KAAK,SAAUuB,GACtDpG,EAAKukC,KAAK,0CACVhkC,EAAiBoE,IAAI0tC,iBAIzBhxC,EAAsBkD,mBACtB/D,EAAoBmG,UACpBnF,EAAY6F,YACZkxB,EAAqBh0B,mBACrBkjD,EAAiBljD,mBACjB5D,EAAgB5E,QAChBuE,EAAeiE,mBACfpJ,EAAUyM,SAAS,qBACnBzM,EAAUuJ,qBAAsB,EAChCvJ,EAAUoJ,mBACVjE,EAAeiE,mBACfpJ,EAAUwK,cAAe,EACzBtF,EAAU1G,IAAI0G,EAAU4f,QAExBlgB,EAAWuyC,WAAW,qBAExBl3C,EAASsS,kBAAoB,SAAU1E,GACrCzI,EAAiBoE,IAAI0tC,cAErB,IAAI14C,GAAMwB,EAAUxB,GACpB0H,GAAsBkD,mBACtB/D,EAAoBmG,UACpBnF,EAAY6F,YACZkxB,EAAqBh0B,mBACrBkjD,EAAiBljD,mBACjB5D,EAAgB5E,QAChBuE,EAAeiE,mBACfpJ,EAAUyM,SAAS,qBACnBzM,EAAUuJ,qBAAsB,EAChCpE,EAAeiE,mBACfpJ,EAAUoJ,mBACVxE,EAAWuyC,WAAW,qBACpB34C,IAAKA,EACLqP,QAASA,EACTC,QAAQ,KAGL7N,KAeX7B,gBAAgBY,WACds+D,gBAAiB,WACf,GAAIC,GAAK,EAET,OADAA,IAAM,IAAMh/D,KAAKi/D,WAAa,YAGhCA,WAAY,SAAUC,GAEpB1+D,YAAYC,UAAUC,SAAW,SAAUC,EAAQC,GAIjD,IAAK,GAHDC,GAAM,GAAIL,aAAYI,GACtBE,EAAU,GAAIC,WAAUF,GACxBG,EAAW,GAAID,WAAUf,MACpBiB,EAAI,EAAOL,EAAJK,EAAYA,IAC1BH,EAAQG,GAAKD,EAASL,EAASM,EAEjC,OAAOJ,IAETq+D,EAAOC,OAAS,SAAU3+B,GAExB,IAAK,GADD4+B,MACKn+D,EAAI,EAAGA,EAAIu/B,EAAG5/B,OAAQK,IAC7Bm+D,EAAKp8D,KAAKw9B,EAAGv/B,GAEf,OAAOgF,QAAOC,aAAaghC,MAAM,KAAMk4B,IAEzCF,EAAOG,QAAU,SAAU9zB,GACzB,GAEI+zB,GAAWC,EAAWC,EAFtBC,IAWJ,IAJAH,EAAY,EACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAI/9B,YAAW89B,GAC/BE,EAAOC,QAAUR,EAAOC,OAAOK,GACR,SAAnBC,EAAOC,QAET,OACEvxD,QACE9C,KAAQ,QACRD,QAAW,wCAA0Cq0D,EAAOC,SAelE,IAVAJ,EAAY,EACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIG,aAAYJ,GAChCE,EAAOG,UAAYJ,EAAc,GAGjCF,EAAY,EACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAI/9B,YAAW89B,GAC/BE,EAAOI,OAASX,EAAOC,OAAOK,GACR,SAAlBC,EAAOI,OAET,OACE1xD,QACE9C,KAAQ,QACRD,QAAW,uCAAyCq0D,EAAOI,QASjE,IAJAP,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAI/9B,YAAW89B,GAC/BE,EAAOK,YAAcZ,EAAOC,OAAOK,GACR,SAAvBC,EAAOK,YAET,OACE3xD,QACE9C,KAAQ,QACRD,QAAW,4CAA8Cq0D,EAAOK,aAatE,IARAR,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIG,aAAYJ,GAChCE,EAAOv+B,cAAgBs+B,EAAc,GACrCr8D,QAAQ2zB,KACN,GACA,IACA3M,QAAQ,KAI4B,MAFlC,GACA,IACAA,QAAQs1C,EAAOv+B,eAEjB,OACE/yB,QACE9C,KAAQ,QACRD,QAAW,4CAA8Cq0D,EAAOv+B,eAStE,IAJAo+B,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIO,aAAYR,GAChCE,EAAOO,YAAcR,EAAc,GACR,IAAvBC,EAAOO,YAET,OACE7xD,QACE9C,KAAQ,QACRD,QAAW,yCAA2Cq0D,EAAOO,aAUnE,IALAV,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIO,aAAYR,GAChCE,EAAOr+C,YAAco+C,EAAc,GAER,IAAvBC,EAAOr+C,YACT,OACEjT,QACE9C,KAAQ,QACRD,QAAW,yCAA2Cq0D,EAAOr+C,aAyBnE,IApBAk+C,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIG,aAAYJ,GAChCE,EAAOt/C,WAAaq/C,EAAc,GAElCF,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIG,aAAYJ,GAChCE,EAAOQ,SAAWT,EAAc,GAEhCF,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIO,aAAYR,GAChCE,EAAOS,WAAaV,EAAc,GAGlCF,EAAY,GACZC,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIO,aAAYR,GAChCE,EAAOz+B,cAAgBw+B,EAAc,GACR,KAAzBC,EAAOz+B,cAET,OACE7yB,QACE9C,KAAQ,QACRD,QAAW,4CAA8Cq0D,EAAOz+B,eAItE,IAAIm/B,GAAgB,GAChBC,EAAyB,EACzBC,EAAiBF,EAAgBC,EAAyBX,EAAOv+B,aAOrE,OALAo+B,GAAYe,EAEZd,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAI/9B,YAAW89B,GAC/BE,EAAOa,YAAcpB,EAAOC,OAAOK,GACR,SAAvBC,EAAOa,aAGPnyD,QACE9C,KAAQ,QACRD,QAAW,4CAA8Cq0D,EAAOa,eAKtEhB,EAAYe,EAAiB,EAC7Bd,EAAYh0B,EAAI7qC,SAAS4+D,EAAW,GACpCE,EAAgB,GAAIG,aAAYJ,GAChCE,EAAOc,cAAgBf,EAAc,GAErCF,EAAYe,EAAiB,EAC7Bd,EAAYh0B,EAAI7qC,SAAS4+D,EAAWG,EAAOc,eAC3Cf,EAAgB,GAAIgB,YAAWjB,GAC/BE,EAAOpyD,KAAO,GAAImT,cAAag/C,GAG/BC,EAAOt+B,WAAaoK,EACbk0B,IAETP,EAAOllB,UAAY,SAAUjwC,GAC3B,GAAe7G,SAAX6G,EAAE1H,KACJ,OAAQ0H,EAAE1H,KAAK0iC,KACf,IAAK,WACH,GAAI07B,GAAYvB,EAAOG,QAAQt1D,EAAE1H,KAAK2c,OACb9b,UAArBu9D,EAAUtyD,OACZ+wD,EAAOwB,aACLvyD,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQo+D,IAGVvB,EAAOwB,YAAYD,EAErB,MACF,SACEvB,EAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,iDAMjB8zD,GAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,qDAMrBlL,aAAc,WACZ,GAAIshB,GAAMm/C,CACV,KACEn/C,EAAO,GAAIC,OAAMzhB,KAAK++D,oBAAsB1zD,KAAM,2BAClD,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOzhB,sBACZmhB,EAAOA,EAAKD,UAOd,MAJEo/C,GADiB,gBAARz+C,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBZ,GAE1BU,IAAIE,gBAAgBZ,IAIjCjC,KAAM,WACAvf,KAAKG,QACPH,KAAKG,OAAOygE,YAEV5gE,KAAKC,KACPiiB,IAAIwB,gBAAgB1jB,KAAKC,MAG7BwgB,KAAM,SAAUogD,GACV7gE,KAAKG,QACPH,KAAKG,OAAOugE,YAAYG,IAG5BnhD,KAAM,SAAUo/B,GACV9+C,KAAKG,QACPH,KAAKG,OAAOs7C,iBAAiB,UAAW,SAAU1xC,GAChD+0C,EAAQ/0C,EAAE1H,UAiBlBjC,iBAAiBK,WACfs+D,gBAAiB,WACf,GAAIC,GAAK,EAET,OADAA,IAAM,IAAMh/D,KAAKi/D,WAAa,YAGhCA,WAAY,SAAUC,GACpBA,EAAO4B,MAAQ,SAAUphC,EAAQC,EAAWz7B,EAAM8c,GAChD,GAAI+/C,KACJA,GAAS78D,KAAOA,EAChB68D,EAASphC,UAAYA,EACrBohC,EAAS//C,WAAaA,EACtB+/C,EAASjzD,UAGT4xB,EAASA,EAAO7sB,QAAQ,kBAAmB,MAE3C6sB,EAASA,EAAO7sB,QAAQ,UAAW,IAInC,KAAK,GADDmuD,GAFAC,EAAQvhC,EAAOqrB,MAAM,MAGhB9pD,EAAI,EAAGA,EAAIggE,EAAMrgE,OAAQK,IAChC,GAAiB,MAAbggE,EAAMhgE,GAAY,CACpB+/D,EAAa//D,CACb,OAIJ8/D,EAASjzD,OAAO,MAChBizD,EAASjzD,OAAO,GAAG5J,KAAOA,EAC1B68D,EAASjzD,OAAO,GAAGkE,QACnB,IAEIkvD,GAFAC,EAAY,EAGZC,EAAaH,EAAMD,EAAa,GAAGjW,MAAM,MAM7C,IAL0C,OAAtCqW,EAAWA,EAAWxgE,OAAS,GACjCmgE,EAASjzD,OAAO,GAAGzC,KAAO,QAE1B01D,EAASjzD,OAAO,GAAGzC,KAAO,UAEI,UAA5B01D,EAASjzD,OAAO,GAAGzC,KACrB,IAAKpK,EAAI+/D,EAAa,EAAG//D,EAAIggE,EAAMrgE,OAAS,EAAGK,IAC7CmgE,EAAaH,EAAMhgE,GAAG8pD,MAAM,OAC5BgW,EAASjzD,OAAO,GAAGkE,MAAMhP,MACvBsP,GAAI6uD,EACJhnD,SACIjW,KAAMA,EACNL,MAAOu9D,EAAWA,EAAWxgE,OAAS,KAE1Csa,YAAaC,KAAKwP,MAAMy2C,EAAW,GAAKpgD,KAE1CmgD,GAAa,MAKf,KADAA,GAAa,EACRlgE,EAAI+/D,EAAa,EAAG//D,EAAIggE,EAAMrgE,OAAS,EAAGK,IAC7CmgE,EAAaH,EAAMhgE,GAAG8pD,MAAM,OAC5BmW,EAAcD,EAAMhgE,EAAI,GAAG8pD,MAAM,OACjCgW,EAASjzD,OAAO,GAAGkE,MAAMhP,MACvBsP,GAAI6uD,EACJhnD,SACIjW,KAAMA,EACNL,MAAOu9D,EAAWA,EAAWxgE,OAAS,KAE1CoZ,YAAamB,KAAKwP,MAAMu2C,EAAY,GAAKlgD,GACzC/G,UAAWkB,KAAKwP,MAAMy2C,EAAW,GAAKpgD,GAAc7F,KAAKwP,MAAMu2C,EAAY,GAAKlgD,GAAc,IAEhGmgD,GAAa,CAGjB,OAAOJ,IAKT7B,EAAOmC,OAAS,SAAUh/D,EAAM6B,EAAM8c,GACpC,GAAIsgD,GAAU,EAEdA,IAAW,UAAYp9D,EAAO,KAC9Bo9D,GAAW,cACXA,GAAW,KAEX,KAAK,GADD1I,GACKvnB,EAAI,EAAGA,EAAIhvC,EAAKzB,OAAQywC,IAG7BunB,EAD8B,KAA5Bv2D,EAAKgvC,GAAGl3B,OAAO,GAAGtW,OAAsB,IAANwtC,EACzB,KAEAhvC,EAAKgvC,GAAGl3B,OAAO,GAAGtW,MAE/By9D,GAAW,IAAOr7D,QAAQ5D,EAAKgvC,GAAGr3B,YAAc3X,EAAKgvC,GAAGp3B,WAAa+G,GAAc,QAAY43C,EAAW,IAI5G,OAAO0I,IAETpC,EAAOllB,UAAY,SAAUjwC,GAC3B,GAAe7G,SAAX6G,EAAE1H,KAAoB,CACxB,GAAIk/D,EACJ,QAAQx3D,EAAE1H,KAAK0iC,KACf,IAAK,YACHw8B,EAASrC,EAAO4B,MAAM/2D,EAAE1H,KAAKirC,KAAMvjC,EAAE1H,KAAKs9B,UAAW51B,EAAE1H,KAAK6B,KAAM6F,EAAE1H,KAAK2e,YACrD9d,SAAhBq+D,EAAOl2D,KACT6zD,EAAOwB,aACLvyD,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQk/D,IAGVrC,EAAOwB,YAAYa,EAErB,MACF,KAAK,WACHA,EAASrC,EAAOmC,OAAOt3D,EAAE1H,KAAK0P,MAAMC,MAAOjI,EAAE1H,KAAK0P,MAAM7N,KAAM6F,EAAE1H,KAAK2e,YACjD9d,SAAhBq+D,EAAOl2D,KACT6zD,EAAOwB,aACLvyD,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQk/D,IAGVrC,EAAOwB,YAAYa,EAErB,MACF,SACErC,EAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,mDAMjB8zD,GAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,sDAMrBlL,aAAc,WACZ,GAAIshB,GAAMm/C,CACV,KACEn/C,EAAO,GAAIC,OAAMzhB,KAAK++D,oBAAsB1zD,KAAM,2BAClD,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOzhB,sBACZmhB,EAAOA,EAAKD,UAOd,MAJEo/C,GADiB,gBAARz+C,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBZ,GAE1BU,IAAIE,gBAAgBZ,IAIjCjC,KAAM,WACAvf,KAAKG,QACPH,KAAKG,OAAOygE,YAEV5gE,KAAKC,KACPiiB,IAAIwB,gBAAgB1jB,KAAKC,MAG7BwgB,KAAM,SAAUogD,GACV7gE,KAAKG,QACPH,KAAKG,OAAOugE,YAAYG,IAG5BnhD,KAAM,SAAUo/B,GACV9+C,KAAKG,QACPH,KAAKG,OAAOs7C,iBAAiB,UAAW,SAAU1xC,GAChD+0C,EAAQ/0C,EAAE1H,UAiBlBhC,qBAAqBI,WACnBs+D,gBAAiB,WACf,GAAIC,GAAK,EAET,OADAA,IAAM,IAAMh/D,KAAKi/D,WAAa,YAGhCA,WAAY,SAAUC,GACpBA,EAAOsC,GAAK,2BACZtC,EAAOuC,GAAK,4BACZvC,EAAOwC,QAAU,EAKjBxC,EAAOyC,sBAAwB,SAAUZ,GAEvC,IAAK,GADD3O,GAAU,EACLnxD,EAAI,EAAGA,EAAI8/D,EAASjzD,OAAOlN,OAAQK,IAC1C,GAAgC,YAA5B8/D,EAASjzD,OAAO7M,GAAGoK,KACrB,IAAK,GAAIgmC,GAAI,EAAGA,EAAI0vB,EAASjzD,OAAO7M,GAAG+Q,MAAMpR,OAAS,EAAGywC,IACnD0vB,EAASjzD,OAAO7M,GAAG+Q,MAAMq/B,GAAGr3B,YAAc+mD,EAASjzD,OAAO7M,GAAG+Q,MAAMq/B,GAAGp3B,UAAY,IAAM8mD,EAASjzD,OAAO7M,GAAG+Q,MAAMq/B,EAAI,GAAGr3B,cAC1Ho4C,GAAoB,IAS9B8M,EAAO0C,oBAAsB,WAC3B,MAAO,IAKT1C,EAAO2C,oBAAsB,SAAUr2B,EAAYxqB,GACjD,MAAOwqB,GAAaxqB,GAQtBk+C,EAAO4B,MAAQ,SAAUphC,EAAQoiC,EAAQC,EAAQ/gD,GAC/C,GAAIghD,GAAS,oBAGbtiC,GAASA,EAAO7sB,QAAQ,kBAAmB,MAE3C6sB,EAASA,EAAO7sB,QAAQ,cAAe,SAAUovD,EAAIC,GACnD,GAAI/9D,GAAM+9D,EAAGrvD,QAAQ,OAAQmvD,EAC7B,OAAO79D,KAGTu7B,EAASA,EAAO7sB,QAAQ,UAAW,GAEnC,IAAIsvD,GAAK,GAAIplB,QAAOilB,EAAQ,IAC5BtiC,GAASA,EAAO7sB,QAAQsvD,EAAI,IAC5B,IACIC,GAAIC,EAAIC,EAAIloD,EADZ6mD,EAAQvhC,EAAOqrB,MAAM,MAErBwX,GAAW,EACXC,KAEAzB,GACA78D,KAAM69D,EACNpiC,UAAWmiC,EACX9gD,WAAYA,EACZlT,UACAmhC,SAEJ,IAAIgyB,EAAM,GAAGpuD,QAAQ,OAAQ,MAAQqsD,EAAOsC,GAAG3uD,QAAQ,OAAQ,KAAOouD,EAAM,GAAGpuD,QAAQ,OAAQ,MAAQqsD,EAAOuC,GAAG5uD,QAAQ,OAAQ,IAAK,CACpI,IAAK,GAAI5R,GAAI,EAAGA,EAAIggE,EAAMrgE,OAAQK,IAAK,CACrC,GAAI2D,GAAKq8D,EAAMhgE,EACf,IAAW,YAAP2D,GAIJ,IAAI29D,EA0BJ,GAvB4B,IAAxB39D,EAAGulB,QAAQ,WAEbk4C,EAAKpB,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,GAAGl4C,QAAQ,KAAM,IAEX,mBAA/BouD,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,IAC1BqX,EAAK,UAELrB,EAASjzD,OAAO9K,MACdkB,KAAMm+D,EACNh3D,KAAM+2D,EACNpwD,YAEsC,eAA/BivD,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,KACjCqX,EAAK,QAELrB,EAASjzD,OAAO9K,MACdkB,KAAMm+D,EACNh3D,KAAM+2D,EACNpwD,aAKF+uD,EAASjzD,OAAOlN,OAAS,GAA0D,YAArDmgE,EAASjzD,OAAOizD,EAASjzD,OAAOlN,OAAS,GAAGyK,MAAkD,IAA5BzG,EAAGulB,QAAQ,cAAmD,IAA7BvlB,EAAGulB,QAAQ,cAAqB,CAEnK,GAAIs4C,GAAStnD,KAAKwP,MAAMs2C,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,GAAK/pC,GACjD0hD,EAASvnD,KAAKwP,MAAMs2C,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,GAAK/pC,EACrD5G,GAAM6mD,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,GAAGl4C,QAAQ,KAAM,GAC/C,IAAI2vD,KACJA,GAAKx/D,MACHkB,KAAM68D,EAASjzD,OAAOizD,EAASjzD,OAAOlN,OAAS,GAAGsD,KAClDL,MAAOuW,IAET2mD,EAASjzD,OAAOizD,EAASjzD,OAAOlN,OAAS,GAAGoR,MAAMhP,MAChDsP,GAAI4sD,EAAOwC,QACX1nD,YAAayoD,EACbxoD,UAAWyoD,EAASD,EAAS,EAC7BtoD,OAAQqoD,MAERtD,EAAOwC,YACAX,GAASjzD,OAAOlN,OAAS,GAA0D,UAArDmgE,EAASjzD,OAAOizD,EAASjzD,OAAOlN,OAAS,GAAGyK,MAA6C,IAAzBzG,EAAGulB,QAAQ,WAA6C,IAA1BvlB,EAAGulB,QAAQ,aAEhJm4C,EAAKrB,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,GAAK/pC,EAClC5G,EAAM6mD,EAAMhgE,EAAI,GAAG8pD,MAAM,KAAK,GAAGl4C,QAAQ,KAAM,IAC/C2vD,KACAA,EAAKx/D,MACHkB,KAAM68D,EAASjzD,OAAOizD,EAASjzD,OAAOlN,OAAS,GAAGsD,KAClDL,MAAOuW,IAET2mD,EAASjzD,OAAOizD,EAASjzD,OAAOlN,OAAS,GAAGoR,MAAMhP,MAChDsP,GAAI4sD,EAAOwC,QACXxmD,YAAaC,KAAKC,MAAMknD,GACxBnoD,OAAQqoD,MAERtD,EAAOwC,aA5DTa,IAAW,EAiEf,MADArD,GAAOyC,sBAAsBZ,GACtBA,EAGP,OACE5yD,QACE9C,KAAQ,QACRD,QAAW,wDAA0D8zD,EAAOsC,GAAK,KAAOtC,EAAOuC,GAAK,oEAS5GvC,EAAOyD,WAAa,SAAU/zC,EAAW4c,EAAYxqB,GACnD,GAAI4hD,GAAK,GACLC,EAAK,KACL7zC,EAAI,GAER4zC,GAAKA,EAAK1D,EAAOsC,GAAKqB,EAAK3D,EAAOuC,GAAKoB,EAAKA,EAC5CD,EAAKA,EAAK,UAAY1D,EAAO0C,sBAAwBiB,EACrDD,EAAKA,EAAK,UAAY1D,EAAO2C,oBAAoBr2B,EAAYxqB,GAAc6hD,EAC3ED,EAAKA,EAAK,mBAAqBC,EAC/BD,EAAKA,EAAK,UAAYh0C,EAAUhuB,OAASiiE,EACzCD,EAAKA,EAAK,WAAaC,CAEvB,KAAK,GAAIC,GAAU,EAAGA,EAAUl0C,EAAUhuB,OAAQkiE,IAAW,CAI3D,GAAIC,GAAWn0C,EAAUk0C,EACzBF,GAAKA,EAAK5zC,EAAI,SAAW8zC,EAAU,KAAOD,EACpB,YAAlBE,EAAS13D,KACXu3D,EAAKA,EAAK5zC,EAAIA,EAAI,yBAA2B6zC,EAClB,UAAlBE,EAAS13D,OAClBu3D,EAAKA,EAAK5zC,EAAIA,EAAI,qBAAuB6zC,GAE3CD,EAAKA,EAAK5zC,EAAIA,EAAI,WAAa+zC,EAAS7+D,KAAO,IAAM2+D,EACrDD,EAAKA,EAAK5zC,EAAIA,EAAI,UAAYkwC,EAAO0C,sBAAwBiB,EAC7DD,EAAKA,EAAK5zC,EAAIA,EAAI,UAAYkwC,EAAO2C,oBAAoBr2B,EAAYxqB,GAAc6hD,EAC7D,YAAlBE,EAAS13D,KACXu3D,EAAKA,EAAK5zC,EAAIA,EAAI,qBAAuB+zC,EAAS/wD,MAAMpR,OAASiiE,EACtC,UAAlBE,EAAS13D,OAClBu3D,EAAKA,EAAK5zC,EAAIA,EAAI,kBAAoB+zC,EAAS/wD,MAAMpR,OAASiiE,EAGhE,KAAK,GADD/zD,GACKuiC,EAAI,EAAGA,EAAI0xB,EAAS/wD,MAAMpR,OAAQywC,IAAK,CAC9C,GAAI2xB,GAAQ3xB,EAAI,CACM,aAAlB0xB,EAAS13D,MACXu3D,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAI,cAAgBg0C,EAAQ,KAAOH,EACf,IAAlCE,EAAS/wD,MAAMq/B,GAAGr3B,aACpBlL,EAASi0D,EAAS/wD,MAAMq/B,GAAGr3B,YAAcgH,EAAa,EAAIA,EAAa,EACvE4hD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,UAAYlgB,EAAS+zD,GAE/CD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,WAAgB6zC,EAExCxxB,EAAI0xB,EAAS/wD,MAAMpR,OAAS,GAC9BkO,GAAUi0D,EAAS/wD,MAAMq/B,GAAGr3B,YAAc+oD,EAAS/wD,MAAMq/B,GAAGp3B,WAAa+G,EAAa,EAAIA,EAAa,EACvG4hD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,UAAYlgB,EAAS+zD,GAE/CD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,UAAYkwC,EAAO2C,oBAAoBr2B,EAAYxqB,GAAc6hD,EAE7FD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,WAAa+zC,EAAS/wD,MAAMq/B,GAAGl3B,OAAO,GAAGtW,MAAQ,IAAMg/D,GACtD,UAAlBE,EAAS13D,OAClBu3D,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAI,UAAYg0C,EAAQ,KAAOH,EACjDD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,UAAY+zC,EAAS/wD,MAAMq/B,GAAGn2B,YAAc8F,EAAa6hD,EACnFD,EAAKA,EAAK5zC,EAAIA,EAAIA,EAAIA,EAAI,WAAa+zC,EAAS/wD,MAAMq/B,GAAGl3B,OAAO,GAAGtW,MAAQ,IAAMg/D,IAIvF,MAAOD,IAET1D,EAAOllB,UAAY,SAAUjwC,GAC3B,GAAe7G,SAAX6G,EAAE1H,KAAoB,CACxB,GAAIk/D,EACJ,QAAQx3D,EAAE1H,KAAK0iC,KACf,IAAK,UACHw8B,EAASrC,EAAO4B,MAAM/2D,EAAE1H,KAAKopC,SAAU1hC,EAAE1H,KAAKs9B,UAAW51B,EAAE1H,KAAK6B,KAAM6F,EAAE1H,KAAK2e,YACvD9d,SAAlBq+D,EAAOpzD,OACT+wD,EAAOwB,aACLvyD,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQk/D,IAGVrC,EAAOwB,YAAYa,EAErB,MACF,KAAK,aACHA,EAASrC,EAAOyD,WAAW54D,EAAE1H,KAAKyL,OAAQ/D,EAAE1H,KAAKmpC,WAAYzhC,EAAE1H,KAAK2e,YAC9C9d,SAAlBq+D,EAAOpzD,OACT+wD,EAAOwB,aACLvyD,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQk/D,IAGVrC,EAAOwB,YAAYa,EAErB,MACF,SACErC,EAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,uDAMjB8zD,GAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,0DAMrBlL,aAAc,WACZ,GAAIshB,GAAMm/C,CACV,KACEn/C,EAAO,GAAIC,OAAMzhB,KAAK++D,oBAAsB1zD,KAAM,2BAClD,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOzhB,sBACZmhB,EAAOA,EAAKD,UAOd,MAJEo/C,GADiB,gBAARz+C,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBZ,GAE1BU,IAAIE,gBAAgBZ,IAIjCjC,KAAM,WACAvf,KAAKG,QACPH,KAAKG,OAAOygE,YAEV5gE,KAAKC,KACPiiB,IAAIwB,gBAAgB1jB,KAAKC,MAG7BwgB,KAAM,SAAUogD,GACV7gE,KAAKG,QACPH,KAAKG,OAAOugE,YAAYG,IAG5BnhD,KAAM,SAAUo/B,GACV9+C,KAAKG,QACPH,KAAKG,OAAOs7C,iBAAiB,UAAW,SAAU1xC,GAChD+0C,EAAQ/0C,EAAE1H,UAkBlB/B,qBAAqBG,WACnBs+D,gBAAiB,WACf,GAAIC,GAAK,EAET,OADAA,IAAM,IAAMh/D,KAAKi/D,WAAa,YAGhCA,WAAY,SAAUC,GAWpBA,EAAO+D,UAAW,EAClB/D,EAAO36B,GAAK,kBAEZ26B,EAAOgE,OAAS,kBAEhBhE,EAAOiE,SAAW,EAClBjE,EAAOp+C,aAAe,GACtBo+C,EAAOr7C,UACLC,SAAU,EACVC,aAAc,EACdC,SAAU,EACVC,OAAQ,EACRC,MAAO,EACPC,QAAS,EACTC,KAAM,EACNC,QAAS,EACTC,YAAa,EACbC,WAAY,IAEd26C,EAAOt+C,SAAW,EAClBs+C,EAAOr+C,UAAY,EACnBq+C,EAAOx+C,UAAY,EACnBw+C,EAAOv+C,UAAY,EACnBu+C,EAAOn+C,WAAa,EACpBm+C,EAAOlvD,sBAEH,IACA,EACA,IAGA,EACA,IACA,IAGA,EACA,EACA,IAGJkvD,EAAOv/C,cAAgB,EACvBu/C,EAAOl+C,WAAa,EACpBk+C,EAAOnvD,wBAA0B,IACjCmvD,EAAOj+C,aAAe,EACtBi+C,EAAOpvD,mBAAoB,EAC3BovD,EAAOkE,EAAI,EACXlE,EAAOxvD,iBAAmB,IAC1BwvD,EAAOh+C,YAAche,OACrBg8D,EAAO/9C,oBAAsB,EAC7B+9C,EAAOmE,UAAY,EACnBnE,EAAOoE,MAAQpgE,OACfg8D,EAAOqE,YAAc,EACrBrE,EAAOsE,cAAgB,EACvBtE,EAAOuE,OAAS,EAChBvE,EAAOwE,OAAS,EAChBxE,EAAOyE,SACPzE,EAAO0E,IAAM1gE,OACbg8D,EAAO2E,IAAM3gE,OACbg8D,EAAO4E,kBAAoB,EAC3B5E,EAAO6E,gBAAkB,EACzB7E,EAAO8E,aAAe9gE,OAMtBg8D,EAAO+E,cAAgB,SAAUC,GAC/B,MAAO/oD,MAAKgpD,IAAI,GAAID,EAAU,KAGhChF,EAAOkF,MAAQ,SAAUC,GACvB,MAAOlpD,MAAK2b,IAAIutC,GAAO,mBAGzBnF,EAAOoF,UAAY,SAAUC,EAAMC,GACjC,MAAOrpD,MAAKspD,KAAKF,EAAOA,EAAOC,EAAOA,IAMxCtF,EAAOwF,IAAM,WACX,GAAIC,GAAG1jE,EAAGmtB,EACNuB,EAAIuvC,EAAOkE,CAMf,IALAuB,EAAIl5C,SAAStQ,KAAK2b,IAAInH,GAAK,kBAAoB,IAC3CA,IAAM,GAAKg1C,GAEbxhE,QAAQ2zB,IAAI,yCAEK5zB,SAAfg8D,EAAO2E,KAAqBl0C,IAAMuvC,EAAOkE,EAM3C,IAFAlE,EAAO2E,IAAM,GAAIrjD,cAAamP,EAAI,GAE7BvB,EAAI,EAAOuB,EAAI,EAARvB,EAAWA,IACrB8wC,EAAO2E,IAAIz1C,GAAKjT,KAAK0oD,IAAI,GAAK3E,EAAO36B,GAAKnW,EAAIuB,EAGlD,IAAmBzsB,SAAfg8D,EAAO0E,KAAqBj0C,IAAMuvC,EAAOkE,EAM3C,IAFAlE,EAAO0E,IAAM,GAAIpjD,cAAamP,EAAI,GAE7BvB,EAAI,EAAOuB,EAAI,EAARvB,EAAWA,IACrB8wC,EAAO0E,IAAIx1C,GAAKjT,KAAKyoD,IAAI,GAAK1E,EAAO36B,GAAKnW,EAAIuB,EAgBlD3vB,MAAK4kE,0BAA4B,SAAUv5D,EAAMqT,EAAOM,EAAQpe,GAG9D,OADAZ,KAAK0e,MAAQA,EACLrT,GACR,IAAK6zD,GAAOr7C,SAASC,SACnB,IAAK7iB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAK8kE,kBAAkBlkE,EAAQK,EAE9C,MACF,KAAKi+D,GAAOr7C,SAASE,aACnB,IAAK9iB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAK+kE,sBAAsBnkE,EAAQK,EAElD,MACF,KAAKi+D,GAAOr7C,SAASG,SAEnB,IADAhkB,KAAK0e,MAAQ1e,KAAK0e,OAAS,IACtBzd,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKglE,kBAAkBpkE,EAAQK,EAAGyd,EAEjD,MACF,KAAKwgD,GAAOr7C,SAASI,OACnB,IAAKhjB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKilE,gBAAgBrkE,EAAQK,EAE5C,MACF,KAAKi+D,GAAOr7C,SAASK,MAEnB,IADAlkB,KAAK0e,MAAQ1e,KAAK0e,OAAS,IACtBzd,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKklE,eAAetkE,EAAQK,EAAGyd,EAE9C,MACF,KAAKwgD,GAAOr7C,SAASM,QACnB,IAAKljB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKmlE,iBAAiBvkE,EAAQK,EAE7C,MACF,KAAKi+D,GAAOr7C,SAASO,KACnB,IAAKnjB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKolE,cAAcxkE,EAAQK,EAE1C,MACF,KAAKi+D,GAAOr7C,SAASQ,QACnB,IAAKpjB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKqlE,iBAAiBzkE,EAAQK,EAE7C,MACF,KAAKi+D,GAAOr7C,SAASS,YACnB,IAAKrjB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKslE,qBAAqB1kE,EAAQK,EAEjD,MACF,KAAKi+D,GAAOr7C,SAASU,WACnB,IAAKtjB,EAAI,EAAOL,EAAJK,EAAYA,IAClBA,EAAI,IACN+d,EAAO/d,GAAKjB,KAAK6kE,aAAa7lD,EAAO/d,GAAI+d,EAAO/d,EAAI,KAEtD+d,EAAO/d,IAAMjB,KAAKulE,oBAAoB3kE,EAAQK,GAIlD,MAAO+d,IAIThf,KAAK8kE,kBAAoB,SAAUlkE,EAAQyQ,GACzC,MAAO,IAAKzQ,EAAS,KAAOA,EAAS,GAAK,EAAIua,KAAK6V,IAAI3f,GAASzQ,EAAS,GAAK,KAEhFZ,KAAK+kE,sBAAwB,SAAUnkE,EAAQyQ,GAC7C,MAAO,IAAO,IAAO8J,KAAK6V,IAAI3f,GAASzQ,EAAS,GAAK,IAAO,IAAOua,KAAK0oD,IAAI3E,EAAOgE,OAAS7xD,GAASzQ,EAAS,KAEhHZ,KAAKglE,kBAAoB,SAAUpkE,EAAQyQ,EAAOqN,GAChD,GAAI8mD,IAAM,EAAI9mD,GAAS,EACnB+mD,EAAK,GACLC,EAAKhnD,EAAQ,CACjB,OAAO8mD,GAAKC,EAAKtqD,KAAK0oD,IAAI3E,EAAOgE,OAAS7xD,GAASzQ,EAAS,IAAM8kE,EAAKvqD,KAAK0oD,IAAI,EAAI3E,EAAO36B,GAAKlzB,GAASzQ,EAAS,KAEpHZ,KAAKilE,gBAAkB,SAAUrkE,EAAQyQ,GACvC,MAAO8J,MAAK0oD,IAAI3E,EAAO36B,GAAKlzB,GAASzQ,EAAS,GAAKs+D,EAAO36B,GAAK,IAEjEvkC,KAAKklE,eAAiB,SAAUtkE,EAAQyQ,EAAOqN,GAC7C,MAAOvD,MAAKgpD,IAAIhpD,KAAKwqD,GAAI,GAAMxqD,KAAKgpD,KAAK9yD,GAASzQ,EAAS,GAAK,IAAM8d,GAAS9d,EAAS,GAAK,GAAI,KAEnGZ,KAAKmlE,iBAAmB,SAAUvkE,EAAQyQ,GACxC,MAAO,IAAO,IAAO8J,KAAK0oD,IAAI3E,EAAOgE,OAAS7xD,GAASzQ,EAAS,KAElEZ,KAAKolE,cAAgB,SAAUxkE,EAAQyQ,GACrC,MAAO,IAAO,EAAI8J,KAAK0oD,IAAI3E,EAAOgE,OAAS7xD,GAASzQ,EAAS,MAE/DZ,KAAKqlE,iBAAmB,SAAUzkE,EAAQyQ,GACxC,GAAI+c,GAAI,EAAI/c,GAASzQ,EAAS,GAAK,CACnC,OAAOua,MAAKyoD,IAAI1E,EAAO36B,GAAKnW,IAAM8wC,EAAO36B,GAAKnW,IAEhDpuB,KAAKslE,qBAAuB,WAC1B,MAAO,IAETtlE,KAAKulE,oBAAsB,SAAU3kE,EAAQyQ,GAC3C,MAAO,GAAIzQ,GAAUA,EAAS,EAAIua,KAAK6V,IAAI3f,GAASzQ,EAAS,GAAK,KAOpEZ,KAAK6kE,aAAe,SAAUe,EAAWC,GACvC,MAAOD,GAAY1G,EAAOnvD,wBAA0B81D,GAGtD7lE,KAAK8lE,IAAM,SAAU13C,EAAGoV,GAEtB,GAAIviC,GAAGowC,EAAG00B,EAAGC,EAAIC,EAAI7gE,EAAGkiC,EAAGva,EAAGm5C,EAAIC,CAIlC,KAFA90B,EAAI,EACJ40B,EAAKt2C,EAAI,EACJ1uB,EAAI,EAAO0uB,EAAI,EAAR1uB,EAAWA,IAAK,CAE1B,IADA+kE,EAAKC,EACE50B,GAAK20B,GACV30B,GAAQ20B,EACRA,GAAU,CAEZ30B,IAAQ20B,EACA30B,EAAJpwC,IACFilE,EAAK93C,EAAEntB,GACPmtB,EAAEntB,GAAKmtB,EAAEijB,GACTjjB,EAAEijB,GAAK60B,EACPA,EAAK1iC,EAAEviC,GACPuiC,EAAEviC,GAAKuiC,EAAE6N,GACT7N,EAAE6N,GAAK60B,GAMX,IAFAF,EAAK,EACLC,EAAK,EACAhlE,EAAI,EAAO0jE,EAAJ1jE,EAAOA,IAIjB,IAHA+kE,EAAKC,EACLA,GAAUA,EACV7gE,EAAI,EACCisC,EAAI,EAAO20B,EAAJ30B,EAAQA,IAIlB,IAHA/J,EAAI43B,EAAO2E,IAAIz+D,GACf2nB,EAAImyC,EAAO0E,IAAIx+D,GACfA,GAAK,GAAKu/D,EAAI1jE,EAAI,EACb8kE,EAAI10B,EAAO1hB,EAAJo2C,EAAOA,GAAQE,EACzBC,EAAK5+B,EAAIlZ,EAAE23C,EAAIC,GAAMj5C,EAAIyW,EAAEuiC,EAAIC,GAC/BG,EAAKp5C,EAAIqB,EAAE23C,EAAIC,GAAM1+B,EAAI9D,EAAEuiC,EAAIC,GAC/B53C,EAAE23C,EAAIC,GAAM53C,EAAE23C,GAAKG,EACnB1iC,EAAEuiC,EAAIC,GAAMxiC,EAAEuiC,GAAKI,EACnB/3C,EAAE23C,GAAK33C,EAAE23C,GAAKG,EACd1iC,EAAEuiC,GAAKviC,EAAEuiC,GAAKI,IAoBxBjH,EAAOkH,iBAAmB,SAAUC,EAAQC,EAAQ3zC,EAAKqR,GACvD,GAAIuiC,GAAWviC,EAAOpjC,OAAS,EAC3B4lE,GAAK7zC,EAAM0zC,IAAWC,EAASD,GAAUE,EACzCE,EAAKtrD,KAAKwP,MAAM67C,GAChBE,EAAKvrD,KAAKmrB,IAAIY,MAAM,MACpB/rB,KAAKwP,MAAM67C,GAAK,EAChBD,IAEAI,EAAO3iC,EAAOyiC,GACdG,EAAO5iC,EAAO0iC,GACd1/C,EAAIw/C,EAAIC,CACZ,QACEI,EAAK1rD,KAAKwP,MAAMg8C,EAAK,GAAK3/C,GAAK4/C,EAAK,GAAKD,EAAK,KAC9CG,EAAK3rD,KAAKwP,MAAMg8C,EAAK,GAAK3/C,GAAK4/C,EAAK,GAAKD,EAAK,KAC9Cv8C,EAAKjP,KAAKwP,MAAMg8C,EAAK,GAAK3/C,GAAK4/C,EAAK,GAAKD,EAAK,OASlDzH,EAAO6H,6BAA+B,SAAUta,GAE9C,GACIua,GAAK31D,EAAO41D,EAAIC,EADhB1Q,EAAK0I,EAAOqE,YAKZ4D,EAAM,EAAIhsD,KAAKgpD,IAAIjF,EAAOyE,MAAMlX,GAAM,GAAI,GAAKyS,EAAOkE,EACtDgE,EAAS,GAAKlI,EAAOkF,MAAM+C,EAAMjI,EAAOuE,QACxC4D,GAAaD,EAASlI,EAAOp+C,cAAgBo+C,EAAOp+C,YACpDumD,GAAY,EACdA,EAAY,EACS,EAAZA,IACTA,EAAY,EAEd,KAAK,GAAIpmE,GAAI,EAAGA,EAAIi+D,EAAOyE,MAAMlX,GAAM7rD,OAAQK,IAAK,CAClD,GAAIs1D,GAAK8Q,CASTF,GAAM,EAAIhsD,KAAKgpD,IAAIjF,EAAOyE,MAAMlX,GAAMxrD,GAAI,GAAKi+D,EAAOkE,EACtDgE,EAAS,GAAKlI,EAAOkF,MAAM+C,EAAMjI,EAAOuE,QACxC4D,GAAaD,EAASlI,EAAOp+C,cAAgBo+C,EAAOp+C,aAChDumD,EAAY,IACdA,EAAY,GAEE,EAAZA,IACFA,EAAY,EAGd,IAAI5Q,GAAK4Q,CACT,IAAInI,EAAOqE,aAAe,EAExB,IAAK,GAAIn5C,GAAI,EAAGA,EAAI80C,EAAOqE,YAAan5C,IAAK,CAC3C,GAAIgzC,GAAK7G,GAAME,EAAKF,GAAMC,EAAKpsC,CAO/B,IALA48C,EAAM,IAAM7rD,KAAKC,MAAM,IAAMgiD,GAE7B6J,EAAK9rD,KAAKwP,MAAM8hC,GAChBya,EAAK/rD,KAAKwP,MAAMu0C,EAAOr+C,WAAaq+C,EAAOqE,aAAetiE,EAAI,GAAKmpB,IACnE/Y,EAAsC,GAA7B41D,EAAKC,EAAKhI,EAAOt+C,UACtBs+C,EAAOpvD,kBACT,GAAK4sC,MAAMsqB,GAOT9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK6tD,EAAOj+C,iBAVzB,CACf,GAAIqmD,GAASpI,EAAOkH,iBAAiB,EAAG,IAAKY,EAAK9H,EAAOlvD,oBACzDkvD,GAAO8E,aAAa3yD,EAAQ,GAAKi2D,EAAOT,EACxC3H,EAAO8E,aAAa3yD,EAAQ,GAAKi2D,EAAOR,EACxC5H,EAAO8E,aAAa3yD,EAAQ,GAAKi2D,EAAOl9C,EACxC80C,EAAO8E,aAAa3yD,EAAQ,GAAK6tD,EAAOj+C,iBAQ1Ci+C,GAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK6tD,EAAOj+C,iBAI5C+lD,GAAM,IAAM7rD,KAAKC,MAAM,IAAMq7C,GAE7BwQ,EAAK9rD,KAAKwP,MAAM8hC,GAChBya,EAAK/rD,KAAKwP,MAAMu0C,EAAOr+C,UAAYq+C,EAAOqE,aAAetiE,EAAI,IAC7DoQ,EAAsC,GAA7B41D,EAAKC,EAAKhI,EAAOt+C,UAC1Bs+C,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK21D,EACjC9H,EAAO8E,aAAa3yD,EAAQ,GAAK6tD,EAAOj+C,eAe9Ci+C,EAAOqI,sBAAwB,SAAU5mE,EAAQ2f,GAQ/C,IAAK,GANDkkD,GAAO,GAAIhkD,cAAa0+C,EAAOkE,GAE/BmB,EAAO,GAAI/jD,cAAa0+C,EAAOkE,GAE/B9rC,EAAS,GAAI9W,cAAa0+C,EAAO4E,kBAAoB5E,EAAO6E,iBAEvD1yB,EAAI,EAAO/wB,EAAJ+wB,EAAyBA,IACvCkzB,EAAKlzB,GAAK6tB,EAAOh+C,YAAYvgB,EAAS0wC,EAGxC6tB,GAAOoE,MAAMsB,0BAA0B1F,EAAOmE,UAAWnE,EAAOsE,cAAee,EAAMjkD,GAErF4+C,EAAOoE,MAAMwC,IAAIvB,EAAMC,EAEvB,KAAK,GAAIgD,GAAM,EAAGA,GAAOtI,EAAO4E,kBAAoB5E,EAAO6E,gBAAiByD,IAC1ElwC,EAAOkwC,GAAOtI,EAAOoF,UAAUC,EAAKiD,EAAMtI,EAAO6E,iBAAkBS,EAAKgD,EAAMtI,EAAO6E,kBACjF7E,EAAOiE,SAAW7rC,EAAOkwC,KAC3BtI,EAAOiE,SAAW7rC,EAAOkwC,GAG7B,OAAOlwC,IAQT4nC,EAAOuI,kBAAoB,WACzB,IAAKvI,EAAO+D,SAAU,CAEpB/D,EAAO+D,UAAW,CAClB,IAAI3iD,GAAsB4+C,EAAOl+C,WAAak+C,EAAOxvD,gBAErDwvD,GAAOoE,MAAQ,GAAIpE,GAAOwF,IAE1BxF,EAAOyE,MAAQ,GAAI3/D,OAAMk7D,EAAOt+C,UAEhCs+C,EAAOwE,OAASxE,EAAOl+C,WAAa,GAAKk+C,EAAOkE,EAAI,GAEpDlE,EAAO4E,kBAAoB3oD,KAAK6X,KAAKksC,EAAOx+C,UAAYw+C,EAAOwE,QAE/DxE,EAAO6E,gBAAkB5oD,KAAKwP,MAAMu0C,EAAOv+C,UAAYu+C,EAAOwE,QAG9DxE,EAAOqE,YAAcrE,EAAOr+C,WAAaq+C,EAAO4E,kBAAoB5E,EAAO6E,gBAAkB,GAE5D,mBAAtBnkD,qBACTA,kBAAoB6hB,YAGtBy9B,EAAO8E,aAAe,GAAIpkD,mBAAkBzE,KAAK6X,KAAKksC,EAAOt+C,SAAWs+C,EAAOr+C,UAAY,GAE3F,KAAK,GAAI5f,GAAI,EAAGA,EAAIi+D,EAAOt+C,SAAU3f,IACnCi+D,EAAOyE,MAAM1iE,GAAKi+D,EAAOqI,sBAAsBpsD,KAAKC,MAAMna,EAAIi+D,EAAOv/C,eAAgBW,GACrF4+C,EAAOuE,OAAS,EAAItoD,KAAKgpD,IAAIjF,EAAOiE,SAAU,GAAKjE,EAAOkE,CAI5D,KAAK,GAAI/xB,GAAI,EAAGA,EAAI6tB,EAAOt+C,SAAUywB,IACnC6tB,EAAO6H,6BAA6B11B,EAGtC6tB,GAAOwB,aACL3gE,OAAUm/D,EAAOmE,UACjB1jD,cAAiBu/C,EAAOv/C,cACxB4jD,YAAerE,EAAOqE,YACtBxiD,WAAcm+C,EAAOn+C,WACrBpI,MAASumD,EAAOt+C,SAChBhI,OAAUsmD,EAAOr+C,UACjBhB,IAAOq/C,EAAO8E,aAAahlD,SACzBkgD,EAAO8E,aAAahlD,SAExBkgD,EAAOoE,MAAQ,KAEfpE,EAAO+D,UAAW,IAWtB/D,EAAOllB,UAAY,SAAUjwC,GAC3B,GAAe7G,SAAX6G,EAAE1H,KAAoB,CACxB,GAAIugD,IAAS,EACT8kB,EAAc,GACdrlE,EAAO0H,EAAE1H,IAqCb,IApC8Ba,SAA1Bb,EAAKqN,iBACPwvD,EAAOxvD,iBAAmBrN,EAAKqN,kBAE/Bg4D,EAAc,mBACd9kB,GAAS,GAEO1/C,SAAdb,EAAK4d,KACPi/C,EAAOkE,EAAI/gE,EAAK4d,MAEhBynD,EAAc,OACd9kB,GAAS,GAEQ1/C,SAAfb,EAAKqc,MACPwgD,EAAOsE,cAAgBnhE,EAAKqc,OAE5BgpD,EAAc,QACd9kB,GAAS,GAEY1/C,SAAnBb,EAAKqe,UACPw+C,EAAOx+C,UAAYre,EAAKqe,WAExBgnD,EAAc,YACd9kB,GAAS,GAEY1/C,SAAnBb,EAAKse,UACPu+C,EAAOv+C,UAAYte,EAAKse,WAExB+mD,EAAc,YACd9kB,GAAS,GAEgB1/C,SAAvBb,EAAKsd,cACPu/C,EAAOv/C,cAAgBtd,EAAKsd,eAE5B+nD,EAAc,gBACd9kB,GAAS,GAES1/C,SAAhBb,EAAKtC,OACP,OAAQsC,EAAKtC,QACb,IAAK,GACHm/D,EAAOmE,UAAYnE,EAAOr7C,SAASC,QACnC,MACF,KAAK,GACHo7C,EAAOmE,UAAYnE,EAAOr7C,SAASE,YACnC,MACF,KAAK,GACHm7C,EAAOmE,UAAYnE,EAAOr7C,SAASG,QACnC,MACF,KAAK,GACHk7C,EAAOmE,UAAYnE,EAAOr7C,SAASI,MACnC,MACF,KAAK,GACHi7C,EAAOmE,UAAYnE,EAAOr7C,SAASK,KACnC,MACF,KAAK,GACHg7C,EAAOmE,UAAYnE,EAAOr7C,SAASM,OACnC,MACF,KAAK,GACH+6C,EAAOmE,UAAYnE,EAAOr7C,SAASO,IACnC,MACF,KAAK,GACH86C,EAAOmE,UAAYnE,EAAOr7C,SAASQ,OACnC,MACF,KAAK,GACH66C,EAAOmE,UAAYnE,EAAOr7C,SAASS,WACnC,MACF,KAAK,IACH46C,EAAOmE,UAAYnE,EAAOr7C,SAASU,eAIrCmjD,GAAc,SACd9kB,GAAS,CAEW1/C,UAAlBb,EAAKue,SACPs+C,EAAOt+C,SAAWve,EAAKue,UAEvB8mD,EAAc,WACd9kB,GAAS,GAEY1/C,SAAnBb,EAAKwe,UACPq+C,EAAOr+C,UAAYxe,EAAKwe,WAExB6mD,EAAc,YACd9kB,GAAS,GAEe1/C,SAAtBb,EAAKye,aACPo+C,EAAOp+C,aAAeze,EAAKye,cAE3B4mD,EAAc,eACd9kB,GAAS,GAEa1/C,SAApBb,EAAK0e,WACPm+C,EAAOn+C,WAAa1e,EAAK0e,YAEzB2mD,EAAc,aACd9kB,GAAS,GAEa1/C,SAApBb,EAAK2e,WACPk+C,EAAOl+C,WAAa3e,EAAK2e,YAEzB0mD,EAAc,aACd9kB,GAAS,GAEsB1/C,SAA7Bb,EAAK8e,oBACP+9C,EAAO/9C,oBAAsB9e,EAAK8e,qBAElCumD,EAAc,sBACd9kB,GAAS,GAEe1/C,SAAtBb,EAAK4e,aACPi+C,EAAOj+C,aAAe5e,EAAK4e,cAE3BymD,EAAc,eACd9kB,GAAS,GAEc1/C,SAArBb,EAAK6e,YACPg+C,EAAOh+C,YAAc7e,EAAK6e,aAE1BwmD,EAAc,cACd9kB,GAAS,GAEoB1/C,SAA3Bb,EAAKyN,kBACPovD,EAAOpvD,kBAAoBzN,EAAKyN,mBAEhC43D,EAAc,oBACd9kB,GAAS,GAE0B1/C,SAAjCb,EAAK0N,wBACPmvD,EAAOnvD,wBAA0B1N,EAAK0N,yBAEtC23D,EAAc,0BACd9kB,GAAS,GAEsB1/C,SAA7Bb,EAAK2N,oBACPkvD,EAAOlvD,oBAAsB3N,EAAK2N,qBAElC03D,EAAc,sBACd9kB,GAAS,GAEPA,EACFsc,EAAOuI,oBAEPvI,EAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAWs8D,EAAc,uBAK/BxI,GAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,0DAMrBlL,aAAc,WACZ,GAAIshB,GAAMm/C,CACV,KACEn/C,EAAO,GAAIC,OAAMzhB,KAAK++D,oBAAsB1zD,KAAM,2BAClD,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOxhB,sBACZkhB,EAAOA,EAAKD,UAOd,MAJEo/C,GADiB,gBAARz+C,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBZ,GAE1BU,IAAIE,gBAAgBZ,IAIjCjC,KAAM,WACAvf,KAAKG,QACPH,KAAKG,OAAOygE,YAEV5gE,KAAKC,MACY,gBAARiiB,MAAyC,mBAAdC,WACpCA,UAAUuB,gBAAgB1jB,KAAKC,KAE/BiiB,IAAIwB,gBAAgB1jB,KAAKC,OAI/BwgB,KAAM,SAAUogD,GACV7gE,KAAKG,QACPH,KAAKG,OAAOugE,YAAYG,IAG5BnhD,KAAM,SAAUo/B,GACV9+C,KAAKG,QACPH,KAAKG,OAAOs7C,iBAAiB,UAAW,SAAU1xC,GAChD+0C,EAAQ/0C,EAAE1H,UAkBlB9B,iBAAiBE,WACfs+D,gBAAiB,WACf,GAAIC,GAAK,EAET,OADAA,IAAM,IAAMh/D,KAAKi/D,WAAa,YAGhCA,WAAY,SAAUC,GACpB,GAAIyI,MACAC,EAAS,sBACTC,EAAY,mBACZC,EAAY,qBAChBH,GAAS35B,cAAgB,GACzB25B,EAAS3mD,WAAa,GACtB2mD,EAASjlC,UAAY,GACrBilC,EAASI,SAAW,GACpBJ,EAASz5B,WAIR,WAGC,QAAS85B,GAAahiE,GACpB,GAAIi3C,GAAKh8C,EAAGqQ,EACR22D,EAAIC,EAAIC,CAIZ,KAHA72D,EAAMtL,EAAIpF,OACVK,EAAI,EACJg8C,EAAM,GACK3rC,EAAJrQ,GAAS,CAEd,GADAgnE,EAA2B,IAAtBjiE,EAAI+0C,WAAW95C,KAChBA,IAAMqQ,EAAK,CACb2rC,GAAOmrB,EAAkBC,OAAOJ,GAAM,GACtChrB,GAAOmrB,EAAkBC,QAAa,EAALJ,IAAW,GAC5ChrB,GAAO,IACP,OAGF,GADAirB,EAAKliE,EAAI+0C,WAAW95C,KAChBA,IAAMqQ,EAAK,CACb2rC,GAAOmrB,EAAkBC,OAAOJ,GAAM,GACtChrB,GAAOmrB,EAAkBC,QAAa,EAALJ,IAAW,GAAU,IAALC,IAAa,GAC9DjrB,GAAOmrB,EAAkBC,QAAa,GAALH,IAAY,GAC7CjrB,GAAO,GACP,OAEFkrB,EAAKniE,EAAI+0C,WAAW95C,KACpBg8C,GAAOmrB,EAAkBC,OAAOJ,GAAM,GACtChrB,GAAOmrB,EAAkBC,QAAa,EAALJ,IAAW,GAAU,IAALC,IAAa,GAC9DjrB,GAAOmrB,EAAkBC,QAAa,GAALH,IAAY,GAAU,IAALC,IAAa,GAC/DlrB,GAAOmrB,EAAkBC,OAAY,GAALF,GAElC,MAAOlrB,GAET,QAASqrB,GAAatiE,GACpB,GAAIiiE,GAAIC,EAAIC,EAAII,EACZtnE,EAAGqQ,EAAK2rC,CAIZ,KAHA3rC,EAAMtL,EAAIpF,OACVK,EAAI,EACJg8C,EAAM,GACK3rC,EAAJrQ,GAAS,CACd,EACEgnE,GAAKO,EAAwC,IAAtBxiE,EAAI+0C,WAAW95C,YAC3BqQ,EAAJrQ,GAAkB,KAAPgnE,EACpB,IAAW,KAAPA,EACF,KAEF,GACEC,GAAKM,EAAwC,IAAtBxiE,EAAI+0C,WAAW95C,YAC3BqQ,EAAJrQ,GAAkB,KAAPinE,EACpB,IAAW,KAAPA,EACF,KAEFjrB,IAAOh3C,OAAOC,aAAa+hE,GAAM,GAAU,GAALC,IAAY,EAClD,GAAG,CAED,GADAC,EAA2B,IAAtBniE,EAAI+0C,WAAW95C,KACT,KAAPknE,EACF,MAAOlrB,EAETkrB,GAAKK,EAAkBL,SACZ72D,EAAJrQ,GAAkB,KAAPknE,EACpB,IAAW,KAAPA,EACF,KAEFlrB,IAAOh3C,OAAOC,cAAmB,GAALgiE,IAAY,GAAU,GAALC,IAAY,EACzD,GAAG,CAED,GADAI,EAA2B,IAAtBviE,EAAI+0C,WAAW95C,KACT,KAAPsnE,EACF,MAAOtrB,EAETsrB,GAAKC,EAAkBD,SACZj3D,EAAJrQ,GAAkB,KAAPsnE,EACpB,IAAW,KAAPA,EACF,KAEFtrB,IAAOh3C,OAAOC,cAAmB,EAALiiE,IAAW,EAAII,GAE7C,MAAOtrB,GA3ET,GAAImrB,GAAoB,mEACpBI,EAAoB,GAAIxkE,OAAM,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GA6E/gBk7D,GAAOhkB,OACVgkB,EAAOhkB,KAAO8sB,GAEX9I,EAAOtkB,OACVskB,EAAOtkB,KAAO0tB,MAMlBpJ,EAAOzkB,oBAAsB,SAAUC,GAIrC,IAAK,GAHDC,GAAeukB,EAAOtkB,KAAKF,GAC3BppC,EAAMqpC,EAAa/5C,OACnBi6C,EAAQ,GAAIpZ,YAAWnwB,GAClBrQ,EAAI,EAAOqQ,EAAJrQ,EAASA,IAAK,CAC5B,GAAI65C,GAAQH,EAAaI,WAAW95C,EACpC45C,GAAM55C,GAAK65C,EAEb,MAAOD,GAAM77B,QAOfkgD,EAAO9jD,MAAQ,SAAUgT,EAAGuB,GAC1B,GAAQ,EAAJA,GAASA,EAAI,GACf,OAAO,CAET,IAAI5lB,GAAIoR,KAAKgpD,IAAI,GAAIx0C,GACjBo2C,GAAK5qD,KAAKC,MAAMgT,EAAIrkB,GAAKA,GAAGgR,UAKhC,OAJuB,KAAnBgrD,EAAE57C,QAAQ,OACZ47C,GAAK,KAEPA,GAAKh8D,EAAEgR,WAAWs0C,UAAU,GACrB0W,EAAE1W,UAAU,EAAG0W,EAAE57C,QAAQ,KAAOwF,EAAI,IAM7CuvC,EAAOuJ,aAAe,SAAU/oC,GAG9B,IAAK,GAFDgpC,GAAWhpC,EAAOqrB,MAAM,IACxB4d,KACK1nE,EAAI,EAAGA,EAAIynE,EAAS9nE,OAAQK,IACnC0nE,EAAU3lE,KAAK0lE,EAASznE,GAAG85C,WAAW,GAExC,OAAO,IAAItZ,YAAWknC,IAKxBzJ,EAAO0J,YAAc,SAAUzyB,EAAO0yB,GACpC,GAAIC,GAAc3yB,EAAMv1C,OACpB02B,EAAS,GAAImK,YAAWqnC,EAAcD,EAAOjoE,OAGjD,OAFA02B,GAAOxX,IAAIq2B,GACX7e,EAAOxX,IAAI+oD,EAAQC,GACZxxC,GAST4nC,EAAO6J,SAAW,SAAUx9B,EAAKrnC,GAC/ByjE,EAAS35B,cAAgB9pC,EACzByjE,EAASz5B,UAET,IAAI86B,GAAe,GAAIvnC,YAAW8J,GAC9B09B,EAAW,GAAI5nC,UAASkK,GAIxB29B,EAAU,EACd,IAAI,eAAiBlpE,MAAM,CACzB,GAAImpE,GAAU,GAAIC,aAAY,QAC9BF,GAAUC,EAAQE,OAAOJ,OAIzB,KAAK,GAAI53B,GAAI,EAAGA,EAAI23B,EAAapoE,OAAQywC,IACvC63B,GAAoBjjE,OAAOC,aAAa8iE,EAAa33B,GAGzD,IAAIi4B,GAAUJ,EAAQne,MAAM,KAE5B,IAAIue,EAAQ,KAAO1B,EAEjB,OACEz5D,QACE9C,KAAQ,QACRD,QAAW,gFAAkFlH,GAInG,IAAIolE,EAAQ,KAAOzB,EAEjB,OACE15D,QACE9C,KAAQ,QACRD,QAAW,4EAA8ElH,GAK/FyjE,GAAS3mD,WAAa9d,OACtBykE,EAASjlC,UAAYx/B,MAErB,KADA,GAAIkvD,GAAU,EACPkX,EAAQlX,KAAa0V,GACiB,gBAAvCwB,EAAQlX,GAASrH,MAAM,SAAS,KAElC4c,EAAS3mD,WAAasP,WAAWg5C,EAAQlX,GAASrH,MAAM,SAAS,GAAGl4C,QAAQ,iBAAkB,MAErD,eAAvCy2D,EAAQlX,GAASrH,MAAM,SAAS,KAElC4c,EAASjlC,UAAYpS,WAAWg5C,EAAQlX,GAASrH,MAAM,SAAS,GAAGl4C,QAAQ,iBAAkB,MAE/Fu/C,GAAW,CAGb,IAA4BlvD,SAAxBykE,EAAS3mD,YAAmD9d,SAAvBykE,EAASjlC,UAEhD,OACEv0B,QACE9C,KAAQ,QACRD,QAAW,kGAAoGlH,GAIrH,KAAK,GAAIjD,GAAI,EAAGA,EAAIqoE,EAAQ1oE,SACW,kBAAjC0oE,EAAQroE,GAAG8pD,MAAM,SAAS,KAC5B4c,EAASI,SAAWz3C,WAAWg5C,EAAQroE,GAAG8pD,MAAM,SAAS,GAAGl4C,QAAQ,iBAAkB,MAEpFy2D,EAAQroE,KAAO6mE,GAJe7mE,IAAK,CAOvC,GAAIsoE,GAAOD,EAAQroE,GAAG8pD,MAAM,OACZ,YAAZwe,EAAK,IACP5B,EAASz5B,QAAQlrC,MACfkB,KAAQqlE,EAAK,GACbC,aAAgBD,EAAK,GACrB3oE,OAAU6qB,SAAS89C,EAAK,GAAG12D,QAAQ,iBAAkB,IAAK,IAC1D0wB,UACAR,QAAWiE,EAAAA,EACXhE,UAAYgE,EAAAA,KAMlB,IAFA,GACIw4B,GAAeD,EAAWkK,EAAQC,EAAQC,EAD1CrK,EAAYgK,EAAQlxD,MAAM,EAAGnX,EAAI,GAAGkzD,KAAK,IAAIvzD,OAE1C0+D,EAAY0J,EAAapoE,QAC9B,IAAKK,EAAI,EAAGA,EAAI0mE,EAASz5B,QAAQttC,OAAQK,IAEvC,GAAyC,WAArC0mE,EAASz5B,QAAQjtC,GAAGuoE,aACtBC,EAAS,EAAI9B,EAASz5B,QAAQjtC,GAAGL,OACjC2+D,EAAYh0B,EAAI7qC,SAAS4+D,EAAWmK,GAET,mBAAhBG,gBACTA,aAAeppD,cAEjBg/C,EAAgB,GAAIoK,cAAarK,GACjCoI,EAASz5B,QAAQjtC,GAAGsiC,OAAOvgC,KAAKgB,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IAC3DF,GAAamK,EAEbC,EAASvuD,KAAKmrB,IAAIY,MAAM,KAAMljC,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IACzDmK,EAASxuD,KAAKorB,IAAIW,MAAM,KAAMljC,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IACrDkK,EAAS/B,EAASz5B,QAAQjtC,GAAG8hC,UAC/B4kC,EAASz5B,QAAQjtC,GAAG8hC,QAAU2mC,GAE5BC,EAAShC,EAASz5B,QAAQjtC,GAAG+hC,UAC/B2kC,EAASz5B,QAAQjtC,GAAG+hC,QAAU2mC,OAE3B,IAAyC,UAArChC,EAASz5B,QAAQjtC,GAAGuoE,aAC7BC,EAAS,EAAI9B,EAASz5B,QAAQjtC,GAAGL,OACjC2+D,EAAYh0B,EAAI7qC,SAAS4+D,EAAWmK,GACpCjK,EAAgB,GAAIh/C,cAAa++C,GACjCoI,EAASz5B,QAAQjtC,GAAGsiC,OAAOvgC,KAAKgB,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IAC3DF,GAAamK,EAEbC,EAASvuD,KAAKmrB,IAAIY,MAAM,KAAMljC,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IACzDmK,EAASxuD,KAAKorB,IAAIW,MAAM,KAAMljC,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IACrDkK,EAAS/B,EAASz5B,QAAQjtC,GAAG8hC,UAC/B4kC,EAASz5B,QAAQjtC,GAAG8hC,QAAU2mC,GAE5BC,EAAShC,EAASz5B,QAAQjtC,GAAG+hC,UAC/B2kC,EAASz5B,QAAQjtC,GAAG+hC,QAAU2mC,OAE3B,IAAyC,UAArChC,EAASz5B,QAAQjtC,GAAGuoE,aAC7BC,EAAS,EAAI9B,EAASz5B,QAAQjtC,GAAGL,OACjC2+D,EAAYh0B,EAAI7qC,SAAS4+D,EAAWmK,GACpCjK,EAAgB,GAAIO,aAAYR,GAChCoI,EAASz5B,QAAQjtC,GAAGsiC,OAAOvgC,KAAKgB,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IAC3DF,GAAamK,EAEbC,EAASvuD,KAAKmrB,IAAIY,MAAM,KAAMljC,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IACzDmK,EAASxuD,KAAKorB,IAAIW,MAAM,KAAMljC,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IACrDkK,EAAS/B,EAASz5B,QAAQjtC,GAAG8hC,UAC/B4kC,EAASz5B,QAAQjtC,GAAG8hC,QAAU2mC,GAE5BC,EAAShC,EAASz5B,QAAQjtC,GAAG+hC,UAC/B2kC,EAASz5B,QAAQjtC,GAAG+hC,QAAU2mC,OAE3B,CAAA,GAAyC,SAArChC,EAASz5B,QAAQjtC,GAAGuoE,aAQ7B,OACEr7D,QACE9C,KAAQ,QACRD,QAAW,4HAA8HlH,GAV7IulE,GAAS,EAAI9B,EAASz5B,QAAQjtC,GAAGL,OACjC2+D,EAAYh0B,EAAI7qC,SAAS4+D,EAAWmK,GACpCjK,EAAgB,GAAI/9B,YAAW89B,GAC/BoI,EAASz5B,QAAQjtC,GAAGsiC,OAAOvgC,KAAKgB,MAAMvD,UAAU2X,MAAM+uB,KAAKq4B,IAC3DF,GAAamK,EAanB,MAAO9B,IAQTzI,EAAO2K,SAAW,SAAU3kC,GAE1B,GAAI4kC,GAAYlC,EAASC,CACzBiC,IAAa,eAAiB5K,EAAO9jD,MAAM8pB,EAAIlkB,WAAY,GAAK,KAChE8oD,GAAa,cAAgB5kC,EAAIxC,UAAY,KAC7CwC,EAAIgJ,QAAQxrC,QAAQ,SAAUy/B,GAE5B2nC,GAAa,UAAY3nC,EAAIj+B,KAAO,IAAMi+B,EAAIqnC,aAAe,IAAMrnC,EAAIvhC,OAAS,OAElFkpE,GAAa,wBAA0B5K,EAAO9jD,MAAM8pB,EAAI6iC,SAAU,GAAK,KACvE+B,GAAahC,CAEb,IAAIiC,GAAc,EACdC,GAAS,CASb,IARA9kC,EAAIgJ,QAAQxrC,QAAQ,SAAUy/B,GACH,UAArBA,EAAIqnC,aACNO,GAAe,EAAI5nC,EAAIvhC,OAEvBopE,GAAS;GAITA,EACF,OACE77D,QACE9C,KAAQ,QACRD,QAAW,kEAIjB,IAAI6+D,GAAuBF,EAAc7kC,EAAIgJ,QAAQ,GAAG3K,OAAO3iC,OAC3DspE,EAAW,GAAI1pE,aAAYypE,GAC3BE,EAAe,GAAI9oC,UAAS6oC,GAE5BE,EAAc,GAAI3oC,YAAWy9B,EAAOuJ,aAAaqB,IAEjDO,EAAa,CAcjB,IAbAnlC,EAAIgJ,QAAQ,GAAG3K,OAAO7gC,QAAQ,SAAU4nE,EAAUC,GAChDrlC,EAAIgJ,QAAQxrC,QAAQ,SAAU8nE,GACA,UAAxBA,EAAOhB,aACTgB,EAAOjnC,OAAOgnC,GAAa7nE,QAAQ,SAAUiwB,GAC3Cw3C,EAAaM,SAASJ,EAAY13C,GAAK,GACvC03C,GAAc,IAGhBL,GAAS,MAKXA,EACF,OACE77D,QACE9C,KAAQ,QACRD,QAAW,kEAKjB,IAAIrC,GAAM,GAAI04B,YAAW0oC,EAAanrD,OAEtC,OADAorD,GAAc,GAAIlL,GAAO0J,YAAYwB,EAAarhE,IAEhDoF,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQ+nE,EAAYprD,SAMxBkgD,EAAOwL,SAAW,SAAU1lC,GAI1B,IAAK,GADD25B,GAFAgM,GAAU,EACVC,KAEK3pE,EAAI,EAAGA,EAAI+jC,EAAQpkC,OAAQK,IAAK,CACvC09D,IACA,IAAID,EAGJ,IAFAA,EAAUQ,EAAOzkB,oBAAoBzV,EAAQ/jC,GAAGoB,MAChDs8D,EAAUO,EAAO6J,SAASrK,EAAS15B,EAAQ/jC,GAAG+sC,eACvB9qC,SAAnBy7D,EAAQxwD,OAIV,MADAw8D,IAAU,EACHhM,CAHPiM,GAAO5nE,KAAKyI,KAAKoyC,MAAMpyC,KAAKC,UAAUizD,KAM1C,MAAIgM,IAEAx8D,QACE9C,KAAQ,UACRD,QAAW,IAEb/I,KAAQuoE,IAIRz8D,QACE9C,KAAQ,QACRD,QAAW,6BAA+BK,KAAKC,UAAUs5B,MAMjExkC,YAAYC,UAAUC,SAAW,SAAUC,EAAQC,GAIjD,IAAK,GAHDC,GAAM,GAAIL,aAAYI,GACtBE,EAAU,GAAIC,WAAUF,GACxBG,EAAW,GAAID,WAAUf,MACpBiB,EAAI,EAAOL,EAAJK,EAAYA,IAC1BH,EAAQG,GAAKD,EAASL,EAASM,EAEjC,OAAOJ,IAETq+D,EAAOllB,UAAY,SAAUjwC,GAC3B,GAAe7G,SAAX6G,EAAE1H,KACJ,OAAQ0H,EAAE1H,KAAK0iC,KACf,IAAK,WACHm6B,EAAOwB,YAAYxB,EAAOwL,SAAS3gE,EAAE1H,KAAK2iC,SAC1C,MACF,KAAK,WACHk6B,EAAOwB,YAAYxB,EAAO2K,SAASp+D,KAAKoyC,MAAM9zC,EAAE1H,KAAK6iC,MACrD,MACF,SACEg6B,EAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,kDAMjB8zD,GAAOwB,aACLvyD,QACE9C,KAAQ,QACRD,QAAW,sDAMrBlL,aAAc,WACZ,GAAIshB,GAAMm/C,CACV,KACEn/C,EAAO,GAAIC,OAAMzhB,KAAK++D,oBAAsB1zD,KAAM,2BAClD,MAAOtB,GAEPhK,OAAO4hB,YAAc5hB,OAAO4hB,aAAe5hB,OAAO6hB,mBAAqB7hB,OAAO8hB,eAC9EL,EAAO,GAAIG,aACXH,EAAKM,OAAOzhB,sBACZmhB,EAAOA,EAAKD,UAOd,MAJEo/C,GADiB,gBAARz+C,MAAyC,mBAAdC,WAC3BA,UAAUC,gBAAgBZ,GAE1BU,IAAIE,gBAAgBZ,IAIjCjC,KAAM,WACAvf,KAAKG,SACPH,KAAKG,OAAOygE,YACZ5gE,KAAKG,OAAS+C,QAEZlD,KAAKC,MACY,gBAARiiB,MAAyC,mBAAdC,WACpCA,UAAUuB,gBAAgB1jB,KAAKC,KAE/BiiB,IAAIwB,gBAAgB1jB,KAAKC,KAE3BD,KAAKC,IAAMiD,SAGfud,KAAM,SAAUogD,GACV7gE,KAAKG,QACPH,KAAKG,OAAOugE,YAAYG,IAG5BnhD,KAAM,SAAUo/B,GACV9+C,KAAKG,QACPH,KAAKG,OAAOs7C,iBAAiB,UAAW,SAAU1xC,GAChD+0C,EAAQ/0C,EAAE1H,UAalBnB,QAAQC,OAAO,aAAaI,QAAQ,oBAAqB,WAEvD,GAAIG,KAqCJ,OA3BAA,GAASwe,sBAAwB,SAAUowB,GAEzC,IADA,GAAIu6B,GAAS,EACN1vD,KAAKgpD,IAAI,EAAG0G,GAAUv6B,GAC3Bu6B,GAAkB,CAEpB,OAAO1vD,MAAKgpD,IAAI,EAAG0G,IAUrBnpE,EAASymC,4BAA8B,SAAU/Z,EAAGuB,IAC1C,EAAJA,GAASA,EAAI,KACfxsB,QAAQC,MAAM,oCAEhB,IAAI2G,GAAIoR,KAAKgpD,IAAI,GAAIx0C,GACjBo2C,GAAK5qD,KAAKC,MAAMgT,EAAIrkB,GAAKA,GAAGgR,UAKhC,OAJuB,KAAnBgrD,EAAE57C,QAAQ,OACZ47C,GAAK,KAEPA,GAAKh8D,EAAEgR,WAAWs0C,UAAU,GACrB/+B,WAAWy1C,EAAE1W,UAAU,EAAG0W,EAAE57C,QAAQ,KAAOwF,EAAI,KAEjDjuB,IAGTR,QAAQC,OAAO,aAAauU,UAAU,SACpC,WACA,eACA,SAAUC,EAAU5N,GAClB,OACE8N,SAAU,IACVD,YAAa,mBACb/C,SAAS,EACTiD,SACAE,KAAM,SAAUF,EAAOvM,EAAS0M,GAC9BH,EAAMF,YAAc,GACpBE,EAAMM,MAAQrO,EACd+N,EAAMuC,QAAS,EACfvC,EAAMuiB,OAAQ,EACdviB,EAAMwM,OAAS,GACfxM,EAAMa,OAAO,eAAgB,SAAUC,EAAUC,GAC9B3T,SAAb0T,IACFd,EAAMF,YAAc7N,EAAa+iE,iBACjCh1D,EAAMwM,OAASva,EAAaua,OAC5BxM,EAAMuiB,MAAQtwB,EAAaswB,MACvBzhB,EACFrN,EAAQ,GAAGo3C,UAAUC,IAAI,wBAEzBr3C,EAAQ,GAAGo3C,UAAUpP,OAAO,2BAIlCz7B,EAAMa,OAAO,oBAAqB,SAAUC,EAAUC,GACnC3T,SAAb0T,IACFd,EAAMF,YAAcgB,EACpBd,EAAMwM,OAASva,EAAaua,OAC5BxM,EAAMuiB,MAAQtwB,EAAaswB,cAevCn3B,QAAQC,OAAO,aAAaI,QAAQ,gBAClC,KACA,qBACA,YACA,SAAsBC,EAAIsuC,EAAoBruC,GAE5C,GAAIC,KA6GJ,OA5GAA,GAAS2W,QAAS,EAClB3W,EAASkU,YAAc,GACvBlU,EAAS6B,MAAQL,OACjBxB,EAASqpE,YAAc7nE,OACvBxB,EAAS22B,OAAQ,EACjB32B,EAASg8C,QAAUx6C,OACnBxB,EAAS4gB,OAASpf,OAClBxB,EAASggB,WAAaxe,OAItBxB,EAAS4J,KAAO,SAAU+yC,EAAU2sB,EAAQC,EAAQ5yC,GAkBlD,MAjBen1B,UAAX8nE,IACFtpE,EAAS4gB,OAAS0oD,EACD9nE,SAAb8nE,EAAOxnC,IACT9hC,EAAS4gB,OAAO4oD,UAAYp7B,EAAmBinB,yBAAyBiU,EAAOxnC,KAGpEtgC,SAAX+nE,IACFvpE,EAASggB,WAAaupD,GAEV/nE,SAAVm1B,IAEF32B,EAAS22B,MAAQA,GAEnB32B,EAAS6B,MAAQ/B,EAAG+B,QACpB7B,EAASkU,YAAcyoC,EACvB58C,EAAUyM,SAAS,gBACnBxM,EAAS2W,QAAS,EACX3W,EAAS6B,MAAMI,SAKxBjC,EAASypE,YAAc,SAAU9sB,EAAU2sB,EAAQC,EAAQ5yC,GAazD,MAZen1B,UAAX8nE,IACFtpE,EAAS4gB,OAAS0oD,GAEL9nE,SAAX+nE,IACFvpE,EAASggB,WAAaupD,GAEV/nE,SAAVm1B,IAEF32B,EAAS22B,MAAQA,GAEnB32B,EAASqpE,YAAcvpE,EAAG+B,QAC1B7B,EAASkU,YAAcyoC,EAChB38C,EAASqpE,YAAYpnE,SAK9BjC,EAAS0B,MAAQ,SAAUy9D,GACzBn/D,EAAS4gB,OAASu+C,EAClBn/D,EAASkU,YAAc,mBACvBnU,EAAUyM,SAAS,iBAKrBxM,EAAS6gB,MAAQ,WACf9gB,EAAU+V,YAAW,GACrB/V,EAAUyM,SAASzM,EAAUuoB,WAC7BtoB,EAAS2W,QAAS,EACd5W,EAAUkI,eAAeC,WAC3BnI,EAAUkI,eAAegK,kBAE3BjS,EAAS6B,MAAMG,SAAQ,IAKzBhC,EAAS0pE,gBAAkB,SAAUj9D,GACnC1M,EAAU+V,YAAW,GACrB/V,EAAUyM,SAASzM,EAAUuoB,WAC7BtoB,EAAS2W,QAAS,EAClB3W,EAAS6B,MAAMG,QAAQyK,IAKzBzM,EAASksC,QAAU,WACjBnsC,EAAU+V,YAAW,GACrB/V,EAAUyM,SAASzM,EAAUuoB,WAC7BtoB,EAAS2W,QAAS,EAClB3W,EAAS6B,MAAMG,SAAQ,IAKzBhC,EAASqpB,OAAS,SAAUhV,GAC1BrU,EAAS0pE,gBAAgBr1D,IAK3BrU,EAAS25B,eAAiB,WACxB55B,EAAU+V,YAAW,GACrB/V,EAAUyM,SAASzM,EAAUuoB,WAC7BtoB,EAAS2W,QAAS,EAClB3W,EAAS6B,MAAMG,QAAQhC,EAASg8C,UAKlCh8C,EAASopE,eAAiB,WACxB,MAAOppE,GAASkU,aAEXlU,KAIXR,QAAQC,OAAO,aAAagF,WAAW,cACrC,SACA,WACA,wBACA,oBACA,YACA,eACA,SAAUC,EAAQI,EAAUO,EAAuBU,EAAmBhG,EAAWsG,GAC/E3B,EAAO6B,IAAMlB,EACbX,EAAOkC,GAAK7G,EAEZ2E,EAAOilE,OAEHC,MAAO,6BACPrrE,IAAK,mCAGLqrE,MAAO,uBACPrrE,IAAK,8BAGLqrE,MAAO,kBACPrrE,IAAK,6BAGTmG,EAAO6B,IAAMlB,EACbX,EAAOgQ,MAAQrO,EACf3B,EAAOmtD,OAAS9rD,EAAkB4rD,UAAU,yBAAyBhxD,KAAKkpE,WAC1EnlE,EAAOgQ,MAAMsnC,QAAUx8C,QAAQoB,KAAKyE,EAAsBpF,MAC1DyE,EAAOolE,QAAU,GACjBplE,EAAOqlE,KAAO,WACZrlE,EAAOu1C,QAAUh5C,OAAOC,KAAKnB,EAAU4qB,sBACvCjmB,EAAOslE,SAAW/oE,OAAOC,KAAKnB,EAAU8qB,gBACxCnmB,EAAO8J,QAAUvN,OAAOC,KAAKnB,EAAU6qB,yBACvClmB,EAAOulE,YAAchpE,OAAOC,KAAKnB,EAAU+qB,kBAC3CpmB,EAAOwlE,cACP1qE,QAAQwB,QAAQqE,EAAsBlF,YAAYuC,qBAAsB,SAAUuuB,EAAK7uB,GACrFsC,EAAOulE,YAAY3oE,KAAK2vB,EAAIzuB,QAE9BhD,QAAQwB,QAAQqE,EAAsBlF,YAAY2D,iBAAkB,SAAUmtB,EAAK7uB,IAChE,YAAb6uB,EAAItnB,MAAmC,UAAbsnB,EAAItnB,OAChCjF,EAAOwlE,WAAW5oE,KAAK2vB,EAAIzuB,QAG/BkC,EAAOylE,cAAgBzlE,EAAOulE,YAAY,GACtCvlE,EAAOwlE,WAAWhrE,OAAS,IAC7BwF,EAAOuvD,aAAevvD,EAAOwlE,WAAW,KAG5CxlE,EAAO0lE,WAAa,SAAUzhB,GACxBA,EAAKpqD,OAAQ,IACfmG,EAAO2lE,cAAgB1hB,EAAKpqD,MAGhCmG,EAAO4lE,QAAU,SAAUC,EAASnoE,GAClC,GAAI6uB,GAAMzvB,MAUV,OATAhC,SAAQwB,QAAQ0D,EAAOmtD,OAAQ,SAAU2Y,EAAaC,GAChDA,IAAcF,GAChB/qE,QAAQwB,QAAQwpE,EAAYX,WAAY,SAAU1nE,EAAOuoE,GACnDA,IAActoE,IAChB6uB,EAAM9uB,EAAMwH,UAKbsnB,GAETvsB,EAAOimE,GAAK,SAAUvoE,EAAKuN,EAAOi7D,GAChC,GAAI9kC,GAAIphC,EAAOgQ,MAAMsnC,QAAQl5C,aAAaV,EAC1C,IAAIuN,EAAQ,EACV,GAAiB,IAAbi7D,EAAgB,CAClB,GAAIvjE,GAAMy+B,EAAE9iC,eAAemB,MAAMwL,EAAQ,EACzCm2B,GAAE9iC,eAAemB,MAAMwL,EAAQ,GAAKm2B,EAAE9iC,eAAemB,MAAMwL,GAC3Dm2B,EAAE9iC,eAAemB,MAAMwL,GAAStI,MAC3B,IAAiB,IAAbujE,EAAgB,CACzB,GAAIvjE,GAAMy+B,EAAE5hC,cAAcC,MAAMwL,EAAQ,EACxCm2B,GAAE5hC,cAAcC,MAAMwL,EAAQ,GAAKm2B,EAAE5hC,cAAcC,MAAMwL,GACzDm2B,EAAE5hC,cAAcC,MAAMwL,GAAStI,IAIrC3C,EAAOmmE,KAAO,SAAUzoE,EAAKuN,EAAOi7D,GAClC,GAAI9kC,GAAIphC,EAAOgQ,MAAMsnC,QAAQl5C,aAAaV,EAC1C,IAAiB,IAAbwoE,GACF,GAA0CppE,SAAtCskC,EAAE9iC,eAAemB,MAAMwL,EAAQ,GAAkB,CACnD,GAAItI,GAAMy+B,EAAE9iC,eAAemB,MAAMwL,EAAQ,EACzCm2B,GAAE9iC,eAAemB,MAAMwL,EAAQ,GAAKm2B,EAAE9iC,eAAemB,MAAMwL,GAC3Dm2B,EAAE9iC,eAAemB,MAAMwL,GAAStI,OAE7B,IAAiB,IAAbujE,GACgCppE,SAArCskC,EAAE5hC,cAAcC,MAAMwL,EAAQ,GAAkB,CAClD,GAAItI,GAAMy+B,EAAE5hC,cAAcC,MAAMwL,EAAQ,EACxCm2B,GAAE5hC,cAAcC,MAAMwL,EAAQ,GAAKm2B,EAAE5hC,cAAcC,MAAMwL,GACzDm2B,EAAE5hC,cAAcC,MAAMwL,GAAStI,IAIrC3C,EAAOomE,IAAM,SAAU1oE,EAAKuN,EAAOi7D,GACjC,GAAI9kC,GAAIphC,EAAOgQ,MAAMsnC,QAAQl5C,aAAaV,EAC1C,IAAgCZ,SAA5BskC,EAAE9iC,eAAeS,OAGnB,IAAK,GAFDsnE,IAAa,EACbC,EAAU,GACLt+C,EAAI,EAAGA,EAAIoZ,EAAE9iC,eAAeS,OAAOvE,OAAQwtB,IAC9CoZ,EAAE9iC,eAAeS,OAAOipB,GAAG/oB,mBAAqBmiC,EAAE9iC,eAAemB,MAAMwL,KACzEo7D,GAAa,EACbC,EAAUllC,EAAE9iC,eAAeS,OAAOipB,GAAG/oB,kBAEnCmiC,EAAE9iC,eAAeS,OAAOipB,GAAGvpB,gBAAkB2iC,EAAE9iC,eAAemB,MAAMwL,KACtEo7D,GAAa,EACbC,EAAUllC,EAAE9iC,eAAeS,OAAOipB,GAAGvpB,cAItC4nE,GAGHrmE,EAAOumE,YAAY,qBAAuBD,EAAU,wCAFpDllC,EAAE9iC,eAAemB,MAAMipC,OAAOz9B,EAAO,IAKzCjL,EAAOumE,YAAc,SAAU9L,GAC7Bz6D,EAAOwmE,eAAgB,EACvBxmE,EAAOolE,QAAU3K,EACjBr6D,EAAS,WACPJ,EAAOwmE,eAAgB,GACtB,MAELxmE,EAAOymE,YAAc,SAAU/oE,SACtBsC,GAAOgQ,MAAMsnC,QAAQl5C,aAAasqC,OAAOhrC,EAAK,IAEvDsC,EAAO0mE,UAAY,SAAUhpE,EAAKipE,GAChC,GAAIvlC,GAAIphC,EAAOgQ,MAAMsnC,QAAQl5C,aAAaV,EACXZ,UAA3BskC,EAAE9iC,eAAemB,QACnB2hC,EAAE9iC,eAAemB,UAE4B,KAA3C2hC,EAAE9iC,eAAemB,MAAMskB,QAAQ4iD,GACjCvlC,EAAE9iC,eAAemB,MAAM7C,KAAK+pE,GAE5B3mE,EAAOumE,YAAY,WAAa56D,MAAQ,uBAG5C3L,EAAO4mE,SAAW,SAAUlpE,EAAKiO,GAC/B,GAAIy1B,GAAIphC,EAAOgQ,MAAMsnC,QAAQl5C,aAAaV,EACZZ,UAA1BskC,EAAE5hC,cAAcC,QAClB2hC,EAAE5hC,cAAcC,UAE2B,KAAzC2hC,EAAE5hC,cAAcC,MAAMskB,QAAQpY,GAChCy1B,EAAE5hC,cAAcC,MAAM7C,KAAK+O,GAE3B3L,EAAOumE,YAAY,UAAY56D,EAAQ,uBAG3C3L,EAAO6mE,SAAW,WAChB,GAAIniC,IACA5mC,KAAM,kBACNQ,kBACAkB,eAAiBC,UACjBgmD,kBAEJzlD,GAAOgQ,MAAMsnC,QAAQl5C,aAAasqC,OAAO1oC,EAAOgQ,MAAMsnC,QAAQl5C,aAAa5D,OAAQ,EAAGkqC,IAKxF1kC,EAAOqL,kBAAoB,WACzBhQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAKjCtL,EAAOuL,qBAAuB,WAC5BlQ,EAAU+V,YAAW,GACrB/V,EAAUiQ,sBAAqB,IAEjCtL,EAAO0lE,WAAW1lE,EAAOilE,KAAK,IAC9BjlE,EAAOqlE,UAIXvqE,QAAQC,OAAO,aAAagF,WAAW,kBACrC,SACA,wBACA,mBACA,SAAUC,EAAQW,EAAuBF,GACvCT,EAAO6B,IAAMlB,EACbX,EAAOilE,QACPxkE,EAAiBmF,YAAY,qBAAqBb,KAAK,SAAUuB,GAC/DtG,EAAOilE,KAAO3+D,EAAKrK,KACnBc,QAAQ2zB,IAAI1wB,EAAOilE,MAEnBjlE,EAAO0lE,WAAW1lE,EAAOilE,KAAK,IAE9BjlE,EAAOilE,KAAK,GAAG6B,UAAW,IAE5B9mE,EAAO0lE,WAAa,SAAUzhB,GAC5BA,EAAK6iB,UAAY7iB,EAAK6iB,SAClB7iB,EAAKpqD,OAAQ,IACsD,OAAjEoqD,EAAKpqD,IAAIkM,OAAOk+C,EAAKpqD,IAAImM,YAAY,KAAO,GAAG4wC,eACjD52C,EAAO+mE,UAAW,EAClB/mE,EAAO2lE,cAAgB1hB,EAAKpqD,MAE5BmG,EAAO+mE,UAAW,EAClB/mE,EAAO2lE,cAAgB1hB,EAAKpqD,OAIlCmG,EAAOgxC,YAAc,SAAUiT,GAC7B,MAAmBnnD,UAAfmnD,EAAK3I,OACH2I,EAAK3I,MAAM9gD,OAAS,GACf,GAGJ,MAKbM,QAAQC,OAAO,aAAaI,QAAQ,gCAClC,KACA,yBACA,cACA,eACA,wBACA,qBACA,SAAsCC,EAAI0/C,EAAwBp5C,EAAaZ,EAAcH,EAAuB+oC,GAElH,GAAIpuC,KA8MJ,OAhMAA,GAAS0mD,QAAU,SAAU7hC,EAAMk/B,EAAMG,GACvC,GAAIE,GAAWpkD,EAASqkD,kBAAkBx/B,EAAMk/B,EAAMG,EACtD,IAAIE,EAASE,MAAO,CAClB,GAAIlb,IACA5T,OAAQuuB,EACRtuB,KAAMyuB,EAGV,OADA99C,GAAYqnC,eAAerE,GACpBA,EAGP,GADA3nC,QAAQszC,MAAM,2BAA4BgP,EAAM,KAAMG,EAAI,gBAAiBE,EAASG,OAAQ,KACpE,IAApBH,EAASG,OAAc,CAEzB,GADAH,EAAWpkD,EAASqkD,kBAAkBx/B,EAAMq/B,EAAIH,GAC5CK,EAASE,MAAO,CAClB7iD,QAAQszC,MAAM,8BACd,IAAI3L,IACA5T,OAAQ0uB,EACRzuB,KAAMsuB,EAGV,OADA39C,GAAYqnC,eAAerE,GACpBA,EAEP,MAAO,MAGT,MAAO,OA2BbppC,EAASqkD,kBAAoB,SAAUx/B,EAAMk/B,EAAMG,GACjD,GAAItuB,IACA0uB,OAAO,EACPC,OAAQ,GAERhX,EAAQnnC,EAAYknC,aAMxB,IAAIyW,IAASG,EAGX,MAFAtuB,GAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,CAGT,KAAK,GAAIr2B,GAAI,EAAGA,EAAIguC,EAAMruC,SAAUK,EAClC,GAAIguC,EAAMhuC,GAAGi2B,SAAWuuB,GAAQxW,EAAMhuC,GAAGk2B,OAASyuB,EAGhD,MAFAtuB,GAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,CAOX,IAAIg+B,GAAiBpuD,EAAasvB,aAAaivB,GAC3C4P,EAAenuD,EAAasvB,aAAaovB,GACzCwnB,EAAkB7mD,EAAK4D,QAAQmrC,EACnC,IAAI/uC,EAAK6mD,EAAkB,KAAO/X,EAGhC,MAFA/9B,GAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,CAIT,KAAK,GADD+1C,GACKpsE,EAAI,EAAGA,EAAI8F,EAAsBlF,YAAYuzD,gBAAgBx0D,SAAUK,EAC1E8F,EAAsBlF,YAAYuzD,gBAAgBn0D,GAAGo0D,eAAiBA,GAAgBtuD,EAAsBlF,YAAYuzD,gBAAgBn0D,GAAGq0D,iBAAmBA,IAChK+X,EAAWtmE,EAAsBlF,YAAYuzD,gBAAgBn0D,GAAGoK,KAGpE,IAAiBnI,SAAbmqE,EAIF,MAHAC,QAAO72B,MAAM,mCAAoCgP,EAAM,KAAMG,EAAI,+HACjEtuB,EAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,CAOT,IAAiB,gBAAb+1C,GAA2C,eAAbA,EAA2B,CAC3D,GAAIE,GAAYrmE,EAAaqvB,YAAYqvB,EACzC,IAAI2nB,EAAUzX,SAASl1D,OAAS,EAG9B,MAFA02B,GAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,EAGX,GAAiB,eAAb+1C,EAA2B,CAC7B,GAAIG,GAActmE,EAAaqvB,YAAYkvB,GACvC7nB,EAAWsjB,EAAuBuG,aAAa+lB,EAAajnD,EAChE,IAAIqX,EAASh9B,OAAS,EAGpB,MAFA02B,GAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,EA2BX,IARA,GAOIm2C,GAPAC,EAAyBxqE,OACzByqE,EAAwBzqE,OACxB0qE,EAAa1mE,EAAagqC,gBAAgBuU,GAAM1zC,MAChD87D,EAAW3mE,EAAagqC,gBAAgB0U,GAAI7zC,MAC5C+7D,EAAc5mE,EAAampC,aAAailB,EAAgB7P,GACxDsoB,EAAa7mE,EAAampC,aAAaglB,EAAczP,GACrDooB,EAAuB,EAEO9qE,SAA3BwqE,GAAsC,CAG3C,GAFAM,GAAwB,EACxBP,EAAUG,EAAW57D,MAAM87D,EAAcE,GACzB9qE,SAAZuqE,EAAuB,CACzBC,EAAyB,CACzB,OAEFvqE,QAAQszC,MAAM,0BAA2Bg3B,EAAQn7D,GAAIm7D,EAAQtzD,OAAO,GAEpE,KAAK,GADDyjB,GAAWsjB,EAAuBuG,aAAagmB,EAASlnD,GACnDtlB,EAAI,EAAGA,EAAI28B,EAASh9B,SAAUK,EAAG,CACxC,GAAIoQ,GAAQnK,EAAampC,aAAaglB,EAAcz3B,EAAS38B,GAAGqR,KACjCpP,SAA3BwqE,GAAwCr8D,EAAQq8D,KAClDA,EAAyBr8D,IAK/B,IADA28D,EAAuB,EACU9qE,SAA1ByqE,GAAqC,CAG1C,GAFAK,GAAwB,EACxBP,EAAUG,EAAW57D,MAAM87D,EAAcE,GACzB9qE,SAAZuqE,EAAuB,CACzBE,EAAwBE,EAAS77D,MAAMpR,OAAS,CAChD,OAEFuC,QAAQszC,MAAM,2BAA4Bg3B,EAAQn7D,GAAIm7D,EAAQtzD,OAAO,GACrE,IAAIyjB,GAAWsjB,EAAuBuG,aAAagmB,EAASlnD,EAC5D,IAAwB,IAApBqX,EAASh9B,OAGb,IAAK,GAAIK,GAAI,EAAGA,EAAI28B,EAASh9B,SAAUK,EAAG,CACxC,GAAIoQ,GAAQnK,EAAampC,aAAaglB,EAAcz3B,EAAS38B,GAAGqR,KAClCpP,SAA1ByqE,GAA+CA,EAARt8D,KACzCs8D,EAAwBt8D,IAK9B,MADAlO,SAAQszC,MAAM,uBAAwBi3B,EAAwBC,GAC7CD,EAAbK,GAAuCA,EAAaJ,GACtDr2C,EAAO0uB,OAAQ,EACf1uB,EAAO2uB,OAAS,EACT3uB,GAGFA,GAEF51B,KAQXR,QAAQC,OAAO,aAAaI,QAAQ,uBAAwB,WAE1D,GAAIG,KA2BJ,OAnBAA,GAAS2lB,iBAAmB,SAAU4mD,GACpC,IAAK,GAAIhtE,KAAKgtE,GACW,MAAnBhtE,EAAEkL,OAAO,EAAG,UACP8hE,GAAEhtE,GAEE,OAATgtE,EAAEhtE,IAA+B,gBAATgtE,GAAEhtE,IAE5BS,EAAS2lB,iBAAiB4mD,EAAEhtE,KAOlCS,EAASwyD,YAAc,SAAU9uD,GAC/B,GAAIyhE,GAAI3lE,QAAQoB,KAAK8C,EAErB,OADAyhE,GAAEliB,UACKkiB,GAEFnlE,IAWTR,QAAQC,OAAO,aAAaw7C,OAAO,YAAa,WAC9C,MAAO,UAAUC,EAAOh5C,GAGtB,MAFAA,IAASA,EAEFg5C,EAAMxkC,MAAMxU,MAWvB1C,QAAQC,OAAO,aAAagF,WAAW,cACrC,SACA,wBACA,SAAUC,EAAQW,GAChBX,EAAO8nE,sBAEH5C,MAAO,eACPrrE,IAAK,2BAGLqrE,MAAO,gCACPrrE,IAAK,4CAGLqrE,MAAO,6BACPrrE,IAAK,yCAGTmG,EAAO+nE,UAAY/nE,EAAO8nE,oBAAoB,GAC9C9nE,EAAOgoE,iBAAmB,SAAUC,GAClCjoE,EAAO+nE,UAAYE,GAErBjoE,EAAOkoE,gBAAkB,SAAUC,GAGjC,MAFAprE,SAAQ2zB,IAAIy3C,GACZprE,QAAQ2zB,IAAI1wB,EAAO+nE,UAAUluE,KACzBsuE,IAAWnoE,EAAO+nE,UAAUluE,KAE5B4X,mBAAoB9Q,EAAsBnF,OAAO6U,MAAM8xC,MACvD9xC,MAAS1P,EAAsBnF,OAAO6U,MAAM4C,MAC5Cm1D,cAAe,QAIjB32D,mBAAoB9Q,EAAsBnF,OAAO6U,MAAMyF,KACvDzF,MAAS1P,EAAsBnF,OAAO6U,MAAM8xC,MAC5CimB,cAAe","sourcesContent":["'use strict';\nArrayBuffer.prototype.subarray = function (offset, length) {\n  var sub = new ArrayBuffer(length);\n  var subView = new Int8Array(sub);\n  var thisView = new Int8Array(this);\n  for (var i = 0; i < length; i++) {\n    subView[i] = thisView[offset + i];\n  }\n  return sub;\n};\n'use strict';\nangular.module('emuwebApp', [\n  'ui',\n  'ngAnimate',\n  'angular.filter',\n  'btford.markdown'\n]).config([\n  '$locationProvider',\n  function ($locationProvider) {\n    $locationProvider.html5Mode(true);\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ConfigProviderService', [\n  '$q',\n  'viewState',\n  function ($q, viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.vals = {};\n    sServObj.design = {};\n    sServObj.curDbConfig = {};\n    sServObj.initDbConfig = {};\n    // embedded values -> if these are set this overrides the normal config  \n    sServObj.embeddedVals = {\n      audioGetUrl: '',\n      labelGetUrl: '',\n      labelType: '',\n      fromUrlParams: false\n    };\n    sServObj.setDesign = function (data) {\n      angular.copy(data, sServObj.design);\n    };\n    /**\n\t\t * depth of 2 = max\n\t\t */\n    sServObj.setVals = function (data) {\n      if ($.isEmptyObject(sServObj.vals)) {\n        sServObj.vals = data;\n      } else {\n        angular.forEach(Object.keys(data), function (key1) {\n          // if array... overwrite entire thing!\n          if (angular.isArray(sServObj.vals[key1])) {\n            //empty array\n            sServObj.vals[key1] = [];\n            angular.forEach(data[key1], function (itm) {\n              sServObj.vals[key1].push(itm);\n            });\n          } else {\n            angular.forEach(Object.keys(data[key1]), function (key2) {\n              if (sServObj.vals[key1][key2] !== undefined) {\n                sServObj.vals[key1][key2] = data[key1][key2];\n              } else {\n                console.error('BAD ENTRY IN CONFIG! Key1: ' + key1 + ' key2: ' + key2);\n              }\n            });\n          }\n        });\n      }\n    };\n    sServObj.getDelta = function (current) {\n      var defer = $q.defer();\n      var ret = sServObj.getDeltas(current, sServObj.initDbConfig);\n      defer.resolve(ret);\n      return defer.promise;\n    };\n    sServObj.getDeltas = function (current, start) {\n      var ret = {};\n      angular.forEach(current, function (value, key) {\n        if (!angular.equals(value, start[key])) {\n          if (Array.isArray(value)) {\n            ret[key] = [];\n            angular.copy(value, ret[key]);\n          } else if (typeof value == 'object') {\n            ret[key] = {};\n            ret[key] = sServObj.getDeltas(value, start[key]);\n          } else {\n            if (key !== 'clear' && key !== 'openDemoDB' && key !== 'specSettings') {\n              ret[key] = value;\n            }\n          }\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSsffTrackConfig = function (name) {\n      var res;\n      if (sServObj.curDbConfig.ssffTrackDefinitions !== undefined) {\n        angular.forEach(sServObj.curDbConfig.ssffTrackDefinitions, function (tr) {\n          if (tr.name === name) {\n            res = tr;\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLimsOfTrack = function (trackName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourLims, function (cL) {\n        if (cL.ssffTrackName === trackName) {\n          res = cL;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getContourColorsOfTrack = function (trackName) {\n      var res;\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors, function (cC) {\n        if (cC.ssffTrackName === trackName) {\n          res = cC;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAssignment = function (signalName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign, function (a) {\n        if (a.signalCanvasName === signalName) {\n          res = a;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLevelDefinition = function (levelName) {\n      var res = {};\n      angular.forEach(sServObj.curDbConfig.levelDefinitions, function (ld) {\n        if (ld.name === levelName) {\n          res = ld;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setPerspectivesOrder = function (curPerspective, levelName) {\n      if (sServObj.vals !== undefined) {\n        if (sServObj.vals.perspectives !== undefined) {\n          if (sServObj.vals.perspectives[curPerspective] !== undefined) {\n            if (sServObj.vals.perspectives[curPerspective].levelCanvases !== undefined) {\n              sServObj.vals.perspectives[curPerspective].levelCanvases.order = levelName;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t *  replace ascii codes from config with strings\n\t\t */\n    sServObj.getStrRep = function (code) {\n      var str;\n      switch (code) {\n      case 8:\n        str = 'BACKSPACE';\n        break;\n      case 9:\n        str = 'TAB';\n        break;\n      case 13:\n        str = 'ENTER';\n        break;\n      case 16:\n        str = 'SHIFT';\n        break;\n      case 18:\n        str = 'ALT';\n        break;\n      case 32:\n        str = 'SPACE';\n        break;\n      case 37:\n        str = '\\u2190';\n        break;\n      case 39:\n        str = '\\u2192';\n        break;\n      case 38:\n        str = '\\u2191';\n        break;\n      case 40:\n        str = '\\u2193';\n        break;\n      case 42:\n        str = '+';\n        break;\n      case 43:\n        str = '+';\n        break;\n      case 45:\n        str = '-';\n        break;\n      case 95:\n        str = '-';\n        break;\n      default:\n        str = String.fromCharCode(code);\n      }\n      return str;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('MainController', [\n  '$scope',\n  '$rootScope',\n  '$log',\n  '$compile',\n  '$timeout',\n  '$q',\n  '$window',\n  '$document',\n  '$location',\n  'viewState',\n  'HistoryService',\n  'Iohandlerservice',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'fontScaleService',\n  'Ssffdataservice',\n  'LevelService',\n  'Textgridparserservice',\n  'Espsparserservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Ssffparserservice',\n  'Drawhelperservice',\n  'Validationservice',\n  'Appcachehandler',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'appStateService',\n  'DataService',\n  'modalService',\n  'browserDetector',\n  function ($scope, $rootScope, $log, $compile, $timeout, $q, $window, $document, $location, viewState, HistoryService, Iohandlerservice, Soundhandlerservice, ConfigProviderService, fontScaleService, Ssffdataservice, LevelService, Textgridparserservice, Espsparserservice, Binarydatamaniphelper, Wavparserservice, Ssffparserservice, Drawhelperservice, Validationservice, Appcachehandler, loadedMetaDataService, dbObjLoadSaveService, appStateService, DataService, modalService, browserDetector) {\n    // hook up services to use abbreviated forms\n    $scope.cps = ConfigProviderService;\n    $scope.hists = HistoryService;\n    $scope.fontImage = fontScaleService;\n    $scope.levServ = LevelService;\n    $scope.dataServ = DataService;\n    $scope.vs = viewState;\n    $scope.ssffds = Ssffdataservice;\n    $scope.shs = Soundhandlerservice;\n    $scope.dhs = Drawhelperservice;\n    $scope.wps = Wavparserservice;\n    $scope.io = Iohandlerservice;\n    $scope.ach = Appcachehandler;\n    $scope.lmds = loadedMetaDataService;\n    // init vars\n    $scope.connectBtnLabel = 'connect';\n    $scope.tmp = {};\n    $scope.dbLoaded = false;\n    $scope.is2dCancasesHidden = true;\n    $scope.windowWidth = $window.outerWidth;\n    $scope.internalVars = {};\n    $scope.internalVars.showAboutHint = false;\n    // this should probably be moved to viewState\n    // check for new version\n    $scope.ach.checkForNewVersion();\n    //////////////\n    // bindings\n    // bind window resize event\n    angular.element($window).bind('resize', function () {\n      LevelService.deleteEditArea();\n      viewState.setWindowWidth($window.outerWidth);\n      if (viewState.hierarchyState.isShown()) {\n        ++viewState.hierarchyState.resize;\n      }\n      $scope.$digest();\n    });\n    // bind shift/alt keyups for history\n    angular.element($window).bind('keyup', function (e) {\n      if (e.keyCode === ConfigProviderService.vals.keyMappings.shift || e.keyCode === ConfigProviderService.vals.keyMappings.alt) {\n        HistoryService.addCurChangeObjToUndoStack();\n        $scope.$digest();\n      }\n    });\n    // bind focus check for mouse on window and document ( mouse inside )\n    angular.element($window).bind('blur', function (e) {\n      viewState.focusOnEmuWebApp = false;\n    });\n    // bind focus check for mouse on window and document ( mouse inside )\n    angular.element($document).bind('blur', function (e) {\n      viewState.focusOnEmuWebApp = false;\n    });\n    // bind blur check for mouse on window and document ( mouse outside )\n    angular.element($window).bind('focus', function (e) {\n      viewState.focusOnEmuWebApp = true;\n    });\n    // bind blur check for mouse on window and document ( mouse outside )\n    angular.element($document).bind('focus', function (e) {\n      viewState.focusOnEmuWebApp = true;\n    });\n    // Take care of preventing navigation out of app (only if something is loaded, not in embedded mode and not developing (auto connecting))\n    window.onbeforeunload = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl === '' && loadedMetaDataService.getBundleList().length > 0 && !ConfigProviderService.vals.main.autoConnect) {\n        return 'Do you really wish to leave/reload the EMU-webApp? All unsaved changes will be lost...';\n      }\n    };\n    //////////////\n    // watches\n    // watch if embedded override (if attributes are set on emuwebapp tag)\n    // $scope.$watch('cps.embeddedVals.audioGetUrl', function (val) {\n    // \tif (val !== undefined && val !== '') {\n    // \t\t// check if both are set\n    // \t\t$scope.loadFilesForEmbeddedApp();\n    // \t}\n    // }, true);\n    //\n    //////////////\n    /////////////\n    // listens\n    // listen for connectionDisrupted event -> I don't like listens but in this case it might me the way to go...\n    $scope.$on('connectionDisrupted', function (event, args) {\n      appStateService.resetToInitState();\n    });\n    // listen for resetToInitState\n    $scope.$on('resetToInitState', function () {\n      $scope.loadDefaultConfig();\n    });\n    $scope.$on('reloadToInitState', function (event, data) {\n      $scope.loadDefaultConfig();\n      viewState.url = data.url;\n      viewState.somethingInProgressTxt = 'Connecting to server...';\n      viewState.somethingInProgress = true;\n      Iohandlerservice.wsH.initConnect(data.url).then(function (message) {\n        if (message.type === 'error') {\n          modalService.open('views/error.html', 'Could not connect to websocket server: ' + data.url).then(function () {\n            appStateService.resetToInitState();\n          });\n        } else {\n          $scope.handleConnectedToWSserver(data);\n        }\n      }, function (errMess) {\n        modalService.open('views/error.html', 'Could not connect to websocket server: ' + JSON.stringify(errMess, null, 4)).then(function () {\n          appStateService.resetToInitState();\n        });\n      });\n    });\n    //\n    ////////////\n    // check if URL parameters are set -> if so set embedded flags!\n    var searchObject = $location.search();\n    if (searchObject['audioGetUrl'] && searchObject['labelGetUrl'] && searchObject['labelType']) {\n      ConfigProviderService.embeddedVals.audioGetUrl = searchObject.audioGetUrl;\n      ConfigProviderService.embeddedVals.labelGetUrl = searchObject.labelGetUrl;\n      ConfigProviderService.embeddedVals.labelType = searchObject.labelType;\n      ConfigProviderService.embeddedVals.fromUrlParams = true;\n    }\n    ;\n    /**\n\t\t *\n\t\t */\n    $scope.loadFilesForEmbeddedApp = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl) {\n        ConfigProviderService.vals.activeButtons.openDemoDB = false;\n        Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.audioGetUrl, 'arraybuffer').then(function (data) {\n          viewState.showDropZone = false;\n          // set bundle name\n          var tmp = ConfigProviderService.embeddedVals.audioGetUrl;\n          loadedMetaDataService.setCurBndlName(tmp.substr(0, tmp.lastIndexOf('.')).substr(tmp.lastIndexOf('/') + 1, tmp.length));\n          //hide menu\n          if (viewState.getsubmenuOpen()) {\n            viewState.toggleSubmenu(ConfigProviderService.design.animation.period);\n          }\n          viewState.somethingInProgressTxt = 'Loading DB config...';\n          // test if DBconfigGetUrl is set if so use it\n          var searchObject = $location.search();\n          var DBconfigGetUrl;\n          if (searchObject['DBconfigGetUrl']) {\n            DBconfigGetUrl = searchObject.DBconfigGetUrl;\n          } else {\n            DBconfigGetUrl = 'configFiles/embedded_emuwebappConfig.json';\n          }\n          // then get the DBconfigFile\n          Iohandlerservice.httpGetPath(DBconfigGetUrl).then(function (resp) {\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n            // validate emuwebappConfigSchema\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              // turn of keybinding only on mouseover\n              if (ConfigProviderService.embeddedVals.fromUrlParams) {\n                ConfigProviderService.vals.main.catchMouseForKeyBinding = false;\n              }\n              ConfigProviderService.curDbConfig = resp.data;\n              // validate DBconfigFileSchema!\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // set wav file\n                viewState.somethingInProgress = true;\n                viewState.somethingInProgressTxt = 'Parsing WAV file...';\n                Wavparserservice.parseWavArrBuf(data.data).then(function (messWavParser) {\n                  var wavJSO = messWavParser;\n                  viewState.curViewPort.sS = 0;\n                  viewState.curViewPort.eS = wavJSO.Data.length;\n                  viewState.resetSelect();\n                  Soundhandlerservice.wavJSO = wavJSO;\n                  // get + parse file\n                  Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.labelGetUrl, 'utf-8').then(function (data2) {\n                    viewState.somethingInProgressTxt = 'Parsing ' + ConfigProviderService.embeddedVals.labelType + ' file...';\n                    Iohandlerservice.parseLabelFile(data2.data, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTextGrid', ConfigProviderService.embeddedVals.labelType).then(function (parseMess) {\n                      var annot = parseMess;\n                      DataService.setData(annot);\n                      var lNames = [];\n                      var levelDefs = [];\n                      annot.levels.forEach(function (l) {\n                        lNames.push(l.name);\n                        levelDefs.push({\n                          'name': l.name,\n                          'type': l.type,\n                          'attributeDefinitions': {\n                            'name': l.name,\n                            'type': 'string'\n                          }\n                        });\n                      });\n                      // set level defs\n                      ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n                      viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                      ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n                      viewState.somethingInProgressTxt = 'Done!';\n                      viewState.somethingInProgress = false;\n                      viewState.setState('labeling');\n                    }, function (errMess) {\n                      modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message);\n                    });\n                  }, function (errMess) {\n                    modalService.open('views/error.html', 'Could not get label file: ' + ConfigProviderService.embeddedVals.labelGetUrl + ' ERROR ' + JSON.stringify(errMess, null, 4));\n                  });\n                }, function (errMess) {\n                  modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message);\n                });\n              } else {\n                modalService.open('views/error.html', 'Error validating / checking DBconfig: ' + JSON.stringify(validRes, null, 4));\n              }\n            } else {\n              modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Could not get embedded_config.json: ' + errMess);\n          });\n        }, function (errMess) {\n          modalService.open('views/error.html', 'Could not get audio file:' + ConfigProviderService.embeddedVals.audioGetUrl + ' ERROR: ' + JSON.stringify(errMess, null, 4));\n        });\n      }\n    };\n    /**\n\t\t * init load of config files\n\t\t */\n    $scope.loadDefaultConfig = function () {\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading schema files';\n      // load schemas first\n      Validationservice.loadSchemas().then(function (replies) {\n        Validationservice.setSchemas(replies);\n        Iohandlerservice.httpGetDefaultDesign().success(function (data) {\n          ConfigProviderService.setDesign(data);\n          Iohandlerservice.httpGetDefaultConfig().success(function (data) {\n            viewState.somethingInProgressTxt = 'Validating emuwebappConfig';\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', data);\n            if (validRes === true) {\n              ConfigProviderService.setVals(data);\n              angular.copy($scope.cps.vals, $scope.cps.initDbConfig);\n              $scope.handleDefaultConfigLoaded();\n              // loadFilesForEmbeddedApp if these are set\n              $scope.loadFilesForEmbeddedApp();\n              $scope.checkIfToShowWelcomeModal();\n              // FOR DEVELOPMENT\n              //$scope.aboutBtnClick();\n              viewState.somethingInProgress = false;\n            } else {\n              modalService.open('views/error.html', 'Error validating / checking emuwebappConfigSchema: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }).error(function (data, status, header, config) {\n            modalService.open('views/error.html', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n              appStateService.resetToInitState();\n            });\n          });\n        }).error(function (data, status, header, config) {\n          modalService.open('views/error.html', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }, function (errMess) {\n        modalService.open('views/error.html', 'Error loading schema file: ' + JSON.stringify(errMess, null, 4)).then(function () {\n          appStateService.resetToInitState();\n        });\n      });\n    };\n    // call function on init\n    $scope.loadDefaultConfig();\n    $scope.checkIfToShowWelcomeModal = function (argument) {\n      var curVal = localStorage.getItem('haveShownWelcomeModal');\n      if (!browserDetector.isBrowser.PhantomJS() && curVal === null) {\n        localStorage.setItem('haveShownWelcomeModal', 'true');\n        $scope.internalVars.showAboutHint = true;\n      }  // FOR DEVELOPMENT\n         //$scope.internalVars.showAboutHint = true;\n    };\n    $scope.getCurBndlName = function () {\n      return loadedMetaDataService.getCurBndlName();\n    };\n    /**\n\t\t * function called after default config was loaded\n\t\t */\n    $scope.handleDefaultConfigLoaded = function () {\n      if (!viewState.getsubmenuOpen()) {\n        viewState.toggleSubmenu(ConfigProviderService.design.animation.period);\n      }\n      // check if either autoConnect is set in DBconfig or as get parameter\n      var searchObject = $location.search();\n      if (ConfigProviderService.vals.main.autoConnect || searchObject['autoConnect'] === 'true') {\n        if (typeof searchObject['serverUrl'] !== 'undefined') {\n          // overwrite serverUrl if set as GET parameter\n          ConfigProviderService.vals.main.serverUrl = searchObject['serverUrl'];\n        }\n        Iohandlerservice.wsH.initConnect(ConfigProviderService.vals.main.serverUrl).then(function (message) {\n          if (message.type === 'error') {\n            modalService.open('views/error.html', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl).then(function () {\n              appStateService.resetToInitState();\n            });\n          } else {\n            $scope.handleConnectedToWSserver({\n              session: null,\n              reload: null\n            });\n          }\n        }, function (errMess) {\n          modalService.open('views/error.html', 'Could not connect to websocket server: ' + JSON.stringify(errMess, null, 4)).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }\n      // init loading of files for testing\n      viewState.setspectroSettings(ConfigProviderService.vals.spectrogramSettings.windowSizeInSecs, ConfigProviderService.vals.spectrogramSettings.rangeFrom, ConfigProviderService.vals.spectrogramSettings.rangeTo, ConfigProviderService.vals.spectrogramSettings.dynamicRange, ConfigProviderService.vals.spectrogramSettings.window, ConfigProviderService.vals.spectrogramSettings.drawHeatMapColors, ConfigProviderService.vals.spectrogramSettings.preEmphasisFilterFactor, ConfigProviderService.vals.spectrogramSettings.heatMapColorAnchors);\n      // setting transition values\n      viewState.setTransitionTime(ConfigProviderService.design.animation.period);\n    };\n    /**\n\t\t * function is called after websocket connection\n\t\t * has been established. It executes the protocol\n\t\t * and loads the first bundle in the bundle list (= default behavior).\n\t\t */\n    $scope.handleConnectedToWSserver = function (data) {\n      // hide drop zone\n      var session = data.session;\n      var reload = data.reload;\n      viewState.showDropZone = false;\n      ConfigProviderService.vals.main.comMode = 'WS';\n      ConfigProviderService.vals.activeButtons.openDemoDB = false;\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Checking protocol...';\n      // Check if server speaks the same protocol\n      Iohandlerservice.getProtocol().then(function (res) {\n        if (res.protocol === 'EMU-webApp-websocket-protocol' && res.version === '0.0.2') {\n          viewState.somethingInProgressTxt = 'Checking user management...';\n          // then ask if server does user management\n          Iohandlerservice.getDoUserManagement().then(function (doUsrData) {\n            if (doUsrData === 'NO') {\n              $scope.innerHandleConnectedToWSserver({\n                session: session,\n                reload: reload\n              });\n            } else {\n              // show user management error\n              modalService.open('views/loginModal.html').then(function (res) {\n                if (res) {\n                  $scope.innerHandleConnectedToWSserver({\n                    session: session,\n                    reload: reload\n                  });\n                } else {\n                  appStateService.resetToInitState();\n                }\n              });\n            }\n          });\n        } else {\n          // show protocol error and disconnect from server\n          modalService.open('views/error.html', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl + '. It does not speak the same protocol as this client. Its protocol answer was: \"' + res.protocol + '\" with the version: \"' + res.version + '\"').then(function () {\n            appStateService.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t * to avoid redundant code...\n\t\t */\n    $scope.innerHandleConnectedToWSserver = function (data) {\n      var session = data.session;\n      var reload = data.reload;\n      viewState.somethingInProgressTxt = 'Loading DB config...';\n      // then get the DBconfigFile\n      Iohandlerservice.httpGetDefaultDesign().success(function (data) {\n        ConfigProviderService.setDesign(data);\n        Iohandlerservice.getDBconfigFile().then(function (data) {\n          // first element of perspectives is default perspective\n          viewState.curPerspectiveIdx = 0;\n          ConfigProviderService.setVals(data.EMUwebAppConfig);\n          // FOR DEVELOPMENT\n          //$scope.showEditDBconfigBtnClick();\n          delete data.EMUwebAppConfig;\n          // delete to avoid duplicate\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n          if (validRes === true) {\n            ConfigProviderService.curDbConfig = data;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            validRes = Validationservice.validateJSO('DBconfigFileSchema', data);\n            if (validRes === true) {\n              // then get the DBconfigFile\n              viewState.somethingInProgressTxt = 'Loading bundle list...';\n              Iohandlerservice.getBundleList().then(function (bdata) {\n                validRes = loadedMetaDataService.setBundleList(bdata);\n                // show standard buttons\n                ConfigProviderService.vals.activeButtons.clear = true;\n                ConfigProviderService.vals.activeButtons.specSettings = true;\n                if (validRes === true) {\n                  // then load first bundle in list\n                  if (session === null) {\n                    session = loadedMetaDataService.getBundleList()[0];\n                  }\n                  dbObjLoadSaveService.loadBundle(session);\n                  //viewState.currentPage = (viewState.numberOfPages(loadedMetaDataService.getBundleList().length)) - 1;\n                  if (reload) {\n                    loadedMetaDataService.openCollapseSession(session.session);\n                  }\n                } else {\n                  modalService.open('views/error.html', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                }\n              });\n            } else {\n              modalService.open('views/error.html', 'Error validating / checking DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          } else {\n            modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        });\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.toggleCollapseSession = function (ses) {\n      $scope.uniqSessionList[ses].collapsed = !$scope.uniqSessionList[ses].collapsed;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getEnlarge = function (index) {\n      var len = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length;\n      var large = 50;\n      if (viewState.getenlarge() == -1) {\n        return 'auto';\n      } else {\n        if (len === 1) {\n          return 'auto';\n        }\n        if (len === 2) {\n          if (viewState.getenlarge() == index) {\n            return '70%';\n          } else {\n            return '27%';\n          }\n        } else {\n          if (viewState.getenlarge() == index) {\n            return large + '%';\n          } else {\n            return (95 - large) / (len - 1) + '%';\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setcursorInTextField(false);\n    };\n    /////////////////////////////////////////\n    // handle button clicks\n    // top menu:\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelSegBtnClick = function () {\n      if (viewState.getPermission('addLevelSegBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [],\n            name: newName,\n            type: 'SEGMENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n        viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelPointBtnClick = function () {\n      if (viewState.getPermission('addLevelPointBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [],\n            name: newName,\n            type: 'EVENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n        viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.renameSelLevelBtnClick = function () {\n      if (viewState.getPermission('renameSelLevelBtnClick')) {\n        if (viewState.getcurClickLevelName() !== undefined) {\n          modalService.open('views/renameLevel.html', viewState.getcurClickLevelName());\n        } else {\n          modalService.open('views/error.html', 'Rename Error : Please choose a Level first !');\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadTextGridBtnClick = function () {\n      if (viewState.getPermission('downloadTextGridBtnClick')) {\n        Textgridparserservice.asyncToTextGrid().then(function (parseMess) {\n          parseMess = parseMess.replace(/\\t/g, '    ');\n          // replace all tabs with 4 spaces\n          modalService.open('views/export.html', loadedMetaDataService.getCurBndl().name + '.TextGrid', parseMess);\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadAnnotationBtnClick = function () {\n      if (viewState.getPermission('downloadAnnotationBtnClick')) {\n        if (Validationservice.validateJSO('emuwebappConfigSchema', DataService.getData())) {\n          modalService.open('views/export.html', loadedMetaDataService.getCurBndl().name + '_annot.json', angular.toJson(DataService.getData(), true));\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.spectSettingsBtnClick = function () {\n      if (viewState.getPermission('spectSettingsChange')) {\n        modalService.open('views/spectSettings.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.connectBtnClick = function () {\n      if (viewState.getPermission('connectBtnClick')) {\n        modalService.open('views/connectModal.html').then(function (url) {\n          if (url) {\n            viewState.somethingInProgressTxt = 'Connecting to server...';\n            viewState.somethingInProgress = true;\n            viewState.url = url;\n            Iohandlerservice.wsH.initConnect(url).then(function (message) {\n              if (message.type === 'error') {\n                modalService.open('views/error.html', 'Could not connect to websocket server: ' + url).then(function () {\n                  appStateService.resetToInitState();\n                });\n              } else {\n                $scope.handleConnectedToWSserver({\n                  session: null,\n                  reload: null\n                });\n              }\n            }, function (errMess) {\n              modalService.open('views/error.html', 'Could not connect to websocket server: ' + JSON.stringify(errMess, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            });\n          }\n        });\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openDemoDBbtnClick = function (nameOfDB) {\n      if (viewState.getPermission('openDemoBtnDBclick')) {\n        $scope.dropdown = false;\n        ConfigProviderService.vals.activeButtons.openDemoDB = false;\n        loadedMetaDataService.setDemoDbName(nameOfDB);\n        // hide drop zone\n        viewState.showDropZone = false;\n        viewState.somethingInProgress = true;\n        // alert(nameOfDB);\n        viewState.setState('loadingSaving');\n        ConfigProviderService.vals.main.comMode = 'DEMO';\n        viewState.somethingInProgressTxt = 'Loading DB config...';\n        Iohandlerservice.httpGetDefaultDesign().success(function (data) {\n          ConfigProviderService.setDesign(data);\n          Iohandlerservice.getDBconfigFile(nameOfDB).then(function (res) {\n            var data = res.data;\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(data.EMUwebAppConfig);\n            delete data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              ConfigProviderService.curDbConfig = data;\n              viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // then get the DBconfigFile\n                viewState.somethingInProgressTxt = 'Loading bundle list...';\n                Iohandlerservice.getBundleList(nameOfDB).then(function (res) {\n                  var bdata = res.data;\n                  // validRes = Validationservice.validateJSO('bundleListSchema', bdata);\n                  // if (validRes === true) {\n                  loadedMetaDataService.setBundleList(bdata);\n                  // show standard buttons\n                  ConfigProviderService.vals.activeButtons.clear = true;\n                  ConfigProviderService.vals.activeButtons.specSettings = true;\n                  // then load first bundle in list\n                  dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);\n                }, function (err) {\n                  modalService.open('views/error.html', 'Error loading bundle list of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                });\n              } else {\n                modalService.open('views/error.html', 'Error validating / checking DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                  appStateService.resetToInitState();\n                });\n              }\n            } else {\n              modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }, function (err) {\n            modalService.open('views/error.html', 'Error loading DB config of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n              appStateService.resetToInitState();\n            });\n          });\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.aboutBtnClick = function () {\n      if (viewState.getPermission('aboutBtnClick')) {\n        modalService.open('views/help.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showHierarchyBtnClick = function () {\n      if (!viewState.hierarchyState.isShown()) {\n        viewState.hierarchyState.toggleHierarchy();\n        modalService.open('views/showHierarchyModal.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showEditDBconfigBtnClick = function () {\n      modalService.open('views/tabbed.html').then(function (res) {\n        if (res === false) {\n        } else {\n          if (Validationservice.validateJSO('emuwebappConfigSchema', res)) {\n            $scope.cps.getDelta(res).then(function (delta) {\n              Iohandlerservice.saveConfiguration(angular.toJson(delta, true)).then(function (ret) {\n                if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n                  modalService.open('views/confirmModal.html', 'Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.').then(function (res) {\n                    if (res) {\n                      appStateService.reloadToInitState();\n                    }\n                  });\n                } else {\n                  appStateService.reloadToInitState($scope.lmds.getCurBndl());\n                }\n              });\n            });\n          } else {\n            modalService.open('views/error.html', 'Sorry, there were errors in your configuration.');\n          }\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.clearBtnClick = function () {\n      // viewState.setdragBarActive(false);\n      var modalText;\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.';\n      } else {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? You have NO unsaved changes so no changes will be lost.';\n      }\n      modalService.open('views/confirmModal.html', modalText).then(function (res) {\n        if (res) {\n          appStateService.resetToInitState();\n        }\n      });\n    };\n    // bottom menu:\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomAll = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomIn = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(true);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomOut = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(false);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomLeft = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(false);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomRight = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(true);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomSel = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayView = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlaySel = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n        viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayAll = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n        viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n      }\n    };\n    ///////////////////////////\n    // other\n    /**\n\t\t * function used to change perspective\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.changePerspective = function (persp) {\n      var newIdx;\n      for (var i = 0; i < ConfigProviderService.vals.perspectives.length; i++) {\n        if (persp.name === ConfigProviderService.vals.perspectives[i].name) {\n          newIdx = i;\n        }\n      }\n      viewState.curPerspectiveIdx = newIdx;\n      // close submenu\n      viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n    };\n    /**\n\t\t * function used by right side menu to get color of current perspecitve in ul\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.getPerspectiveColor = function (persp) {\n      var cl;\n      if (viewState.curPerspectiveIdx === -1 || persp.name === ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].name) {\n        cl = 'emuwebapp-curSelPerspLi';\n      } else {\n        cl = 'emuwebapp-perspLi';\n      }\n      return cl;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('level', [\n  '$timeout',\n  '$animate',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'HistoryService',\n  'fontScaleService',\n  'modalService',\n  'LevelService',\n  'loadedMetaDataService',\n  function ($timeout, $animate, viewState, ConfigProviderService, Drawhelperservice, HistoryService, fontScaleService, modalService, LevelService, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/level.html',\n      restrict: 'E',\n      scope: {\n        level: '=',\n        idx: '='\n      },\n      link: function postLink(scope, element, attr) {\n        // select the needed DOM items from the template\n        var canvas = element.find('canvas');\n        scope.open = attr.open;\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.modal = modalService;\n        scope.lmds = loadedMetaDataService;\n        var levelCanvasContainer = element.find('div');\n        scope.levelDef = ConfigProviderService.getLevelDefinition(scope.level.name);\n        scope.backgroundCanvas = { 'background': ConfigProviderService.design.color.lightGrey };\n        ///////////////\n        // watches\n        scope.$watch('vs.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue) {\n            scope.redraw();\n          }\n        });\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS || oldValue.windowWidth !== newValue.windowWidth) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();\n          } else {\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMouseX', function (newValue, oldValue) {\n          // only repaint if mouse over current level\n          if (scope.vs.getcurMouseLevelName() === scope.level.name) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();  //}\n          }\n        }, true);\n        //\n        scope.$watch('vs.curClickLevelName', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (scope.level.name === scope.vs.curMouseLevelName) {\n            scope.drawLevelDetails();\n          }\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('vs.movingBoundary', function () {\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('hists.movesAwayFromLastSave', function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        /////////////////\n        scope.redraw = function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.changeCurAttrDef = function (attrDefName, index) {\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if (curAttrDef !== attrDefName) {\n            // curAttrDef = attrDefName;\n            scope.vs.setCurAttrDef(scope.level.name, attrDefName, index);\n            if (!element.hasClass('emuwebapp-level-animation')) {\n              scope.vs.setEditing(false);\n              LevelService.deleteEditArea();\n              $animate.addClass(levelCanvasContainer, 'emuwebapp-level-animation').then(function () {\n                $animate.removeClass(levelCanvasContainer, 'emuwebapp-level-animation');\n                // redraw\n                scope.drawLevelDetails();\n                scope.drawLevelMarkup();\n              });\n            }\n          }\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.getAttrDefBtnColor = function (attrDefName) {\n          var curColor;\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if (attrDefName === curAttrDef) {\n            curColor = { 'background': '-webkit-radial-gradient(50% 50%, closest-corner, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 60%)' };\n          } else {\n            curColor = { 'background-color': 'white' };\n          }\n          return curColor;\n        };\n        scope.updateView = function () {\n          if ($.isEmptyObject(scope.cps)) {\n            return;\n          }\n          scope.drawLevelDetails();\n        };\n        ///////////////\n        // bindings\n        // on mouse leave reset viewState.\n        element.bind('mouseleave', function () {\n          scope.vs.setcurMouseItem(undefined, undefined, undefined);\n          scope.drawLevelMarkup();\n        });\n        /**\n\t\t\t\t * draw level details\n\t\t\t\t * @param levelDetails\n\t\t\t\t */\n        scope.drawLevelDetails = function () {\n          var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          var isOpen = element.parent().css('height') === '25px' ? false : true;\n          if ($.isEmptyObject(scope.level)) {\n            //console.log('undef levelDetails');\n            return;\n          }\n          if ($.isEmptyObject(scope.vs)) {\n            //console.log('undef viewState');\n            return;\n          }\n          if ($.isEmptyObject(scope.cps)) {\n            //console.log('undef config');\n            return;\n          }\n          var ctx = canvas[0].getContext('2d');\n          ctx.clearRect(0, 0, canvas[0].width, canvas[0].height);\n          //predef vars\n          var sDist, posS, posE, horizontalText;\n          sDist = scope.vs.getSampleDist(canvas[0].width);\n          // draw name of level and type\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          if (scope.level.name === curAttrDef) {\n            if (isOpen) {\n              fontScaleService.drawUndistortedTextTwoLines(ctx, scope.level.name, '(' + scope.level.type + ')', fontSize, ConfigProviderService.design.font.small.family, 4, ctx.canvas.height / 2 - fontSize * scaleY, ConfigProviderService.design.color.black, true);\n            } else {\n              fontSize -= 2;\n              fontScaleService.drawUndistortedText(ctx, scope.level.name, fontSize, ConfigProviderService.design.font.small.family, 4, ctx.canvas.height / 2 - fontSize * scaleY / 2, ConfigProviderService.design.color.black);\n            }\n          } else {\n            fontScaleService.drawUndistortedTextTwoLines(ctx, scope.level.name + ':' + curAttrDef, '(' + scope.level.type + ')', fontSize, ConfigProviderService.design.font.small.family, 4, ctx.canvas.height / 2 - fontSize * scaleY, ConfigProviderService.design.color.black, true);\n          }\n          var segMId = scope.vs.getcurMouseItem();\n          var segCId = scope.vs.getcurClickItems();\n          var levelId = scope.vs.getcurClickLevelName();\n          var curID = -1;\n          // calculate generic max with of single char (m char used)\n          //var mTxtImg = fontScaleService.drawUndistortedText(ctx, 'm', fontSize - 2, ConfigProviderService.design.font.small.family, ConfigProviderService.design.color.black);\n          var mTxtImgWidth = ctx.measureText('m').width * fontScaleService.scaleX;\n          // calculate generic max with of single digit (0 digit used)\n          //var zeroTxtImg = fontScaleService.drawUndistortedText(ctx, '0', fontSize - 4, ConfigProviderService.design.font.small.family, ConfigProviderService.design.color.black);\n          var zeroTxtImgWidth = ctx.measureText('0').width * fontScaleService.scaleX;\n          if (scope.level.type === 'SEGMENT') {\n            ctx.fillStyle = ConfigProviderService.design.color.black;\n            // draw segments\n            var e = scope.level.items;\n            e.forEach(function (curEvt) {\n              ++curID;\n              if (curEvt.sampleStart >= scope.vs.curViewPort.sS && curEvt.sampleStart <= scope.vs.curViewPort.eS || curEvt.sampleStart + curEvt.sampleDur > scope.vs.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur < scope.vs.curViewPort.eS || curEvt.sampleStart < scope.vs.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur > scope.vs.curViewPort.eS) {\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                // draw segment start\n                posS = scope.vs.getPos(canvas[0].width, curEvt.sampleStart);\n                posE = scope.vs.getPos(canvas[0].width, curEvt.sampleStart + curEvt.sampleDur + 1);\n                ctx.fillStyle = ConfigProviderService.design.color.black;\n                ctx.fillRect(posS, 0, 2, canvas[0].height / 2);\n                //draw segment end\n                ctx.fillStyle = ConfigProviderService.design.color.grey;\n                ctx.fillRect(posE, canvas[0].height / 2, 2, canvas[0].height);\n                ctx.font = fontSize - 2 + 'px' + ' ' + ConfigProviderService.design.font.small.family;\n                //check for enough space to stroke text\n                if (curLabVal !== undefined && posE - posS > mTxtImgWidth * curLabVal.length) {\n                  if (isOpen) {\n                    fontScaleService.drawUndistortedText(ctx, curLabVal, fontSize - 2, ConfigProviderService.design.font.small.family, posS + (posE - posS) / 2 - ctx.measureText(curLabVal).width / 2 - 2, canvas[0].height / 2 - (fontSize - 2) + 2, ConfigProviderService.design.color.black);\n                  } else {\n                    fontScaleService.drawUndistortedText(ctx, curLabVal, fontSize - 2, ConfigProviderService.design.font.small.family, posS + (posE - posS) / 2 - ctx.measureText(curLabVal).width / 2 - 2, canvas[0].height / 2 - fontSize + 2, ConfigProviderService.design.color.black);\n                  }\n                }\n                //draw helper lines\n                if (scope.open && curLabVal !== undefined && curLabVal.length !== 0) {\n                  // only draw if label is not empty\n                  var labelCenter = posS + (posE - posS) / 2;\n                  var hlY = canvas[0].height / 4;\n                  // start helper line\n                  ctx.strokeStyle = ConfigProviderService.design.color.black;\n                  ctx.beginPath();\n                  ctx.moveTo(posS, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY + 5);\n                  ctx.stroke();\n                  hlY = canvas[0].height / 4 * 3;\n                  // end helper line\n                  ctx.strokeStyle = ConfigProviderService.design.color.grey;\n                  ctx.beginPath();\n                  ctx.moveTo(posE, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY - 5);\n                  ctx.stroke();\n                }\n                // draw sampleStart numbers\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * curEvt.sampleStart.toString().length && isOpen) {\n                  fontScaleService.drawUndistortedText(ctx, curEvt.sampleStart, fontSize - 2, ConfigProviderService.design.font.small.family, posS + 3, 0, ConfigProviderService.design.color.grey);\n                }\n                // draw sampleDur numbers.\n                var durtext = 'dur: ' + curEvt.sampleDur + ' ';\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * durtext.length && isOpen) {\n                  fontScaleService.drawUndistortedText(ctx, durtext, fontSize - 2, ConfigProviderService.design.font.small.family, posE - ctx.measureText(durtext).width * fontScaleService.scaleX, canvas[0].height / 4 * 3, ConfigProviderService.design.color.grey);\n                }\n              }\n            });\n          } else if (scope.level.type === 'EVENT') {\n            ctx.fillStyle = ConfigProviderService.design.color.black;\n            // predef. vars\n            var perc;\n            scope.level.items.forEach(function (curEvt) {\n              if (curEvt.samplePoint > scope.vs.curViewPort.sS && curEvt.samplePoint < scope.vs.curViewPort.eS) {\n                perc = Math.round(scope.vs.getPos(canvas[0].width, curEvt.samplePoint) + sDist / 2);\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                ctx.fillStyle = ConfigProviderService.design.color.black;\n                ctx.fillRect(perc, 0, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                ctx.fillRect(perc, canvas[0].height / 2 + canvas[0].height / 10, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                fontScaleService.drawUndistortedText(ctx, curLabVal, fontSize - 2, ConfigProviderService.design.font.small.family, perc - 5, canvas[0].height / 3, ConfigProviderService.design.color.black);\n                if (isOpen) {\n                  fontScaleService.drawUndistortedText(ctx, curEvt.samplePoint, fontSize - 2, ConfigProviderService.design.font.small.family, perc + 5, 0, ConfigProviderService.design.color.grey);\n                }\n              }\n            });\n          }  // draw cursor/selected area\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawLevelMarkup = function () {\n          var ctx = canvas[1].getContext('2d');\n          ctx.clearRect(0, 0, canvas[1].width, canvas[1].height);\n          if (scope.level.name === scope.vs.getcurClickLevelName()) {\n            ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n            ctx.fillRect(0, 0, canvas[0].width, canvas[0].height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx);\n          var posS, posE, sDist, xOffset, curEvt;\n          posS = scope.vs.getPos(canvas[1].width, scope.vs.curViewPort.selectS);\n          posE = scope.vs.getPos(canvas[1].width, scope.vs.curViewPort.selectE);\n          sDist = scope.vs.getSampleDist(canvas[1].width);\n          var segMId = scope.vs.getcurMouseItem();\n          var isFirst = scope.vs.getcurMouseisFirst();\n          var isLast = scope.vs.getcurMouseisLast();\n          var clickedSegs = scope.vs.getcurClickItems();\n          var levelId = scope.vs.getcurClickLevelName();\n          if (clickedSegs !== undefined) {\n            // draw clicked on selected areas\n            if (scope.level.name === levelId && clickedSegs.length > 0) {\n              clickedSegs.forEach(function (cs) {\n                if (cs !== undefined) {\n                  // check if segment or event level\n                  if (cs.sampleStart !== undefined) {\n                    posS = Math.round(scope.vs.getPos(canvas[0].width, cs.sampleStart));\n                    posE = Math.round(scope.vs.getPos(canvas[0].width, cs.sampleStart + cs.sampleDur + 1));\n                  } else {\n                    posS = Math.round(scope.vs.getPos(canvas[0].width, cs.samplePoint) + sDist / 2);\n                    posS = posS - 5;\n                    posE = posS + 10;\n                  }\n                  ctx.fillStyle = ConfigProviderService.design.color.transparent.yellow;\n                  ctx.fillRect(posS, 0, posE - posS, canvas[0].height);\n                  ctx.fillStyle = ConfigProviderService.design.color.black;\n                }\n              });\n            }\n          }\n          // draw preselected boundary\n          curEvt = scope.vs.getcurMouseItem();\n          if (scope.level.items.length > 0 && curEvt !== undefined && segMId !== undefined && scope.level.name === scope.vs.getcurMouseLevelName()) {\n            ctx.fillStyle = ConfigProviderService.design.color.blue;\n            if (isFirst === true) {\n              // before first segment\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = scope.level.items[0];\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else if (isLast === true) {\n              // after last segment\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = scope.level.items[scope.level.items.length - 1];\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart + curEvt.sampleDur + 1));\n                // +1 because boundaries are drawn on sampleStart\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else {\n              // in the middle\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              } else {\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.samplePoint));\n                xOffset = sDist / 2;\n                ctx.fillRect(posS + xOffset, 0, 3, canvas[1].height);\n              }\n            }\n            ctx.fillStyle = ConfigProviderService.design.color.black;\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('osci', [\n  '$timeout',\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'loadedMetaDataService',\n  function ($timeout, viewState, Soundhandlerservice, ConfigProviderService, Drawhelperservice, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/osci.html',\n      replace: true,\n      restrict: 'E',\n      scope: {},\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.changeAttrDef = function () {\n          };\n        }\n      ],\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // assign attributes to scope\n        scope.order = attrs.order;\n        scope.trackName = attrs.trackName;\n        scope.cps = ConfigProviderService;\n        scope.viewState = viewState;\n        scope.lmds = loadedMetaDataService;\n        ///////////////\n        // watches\n        //\n        scope.$watch('viewState.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue) {\n            scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n          }\n        });\n        //\n        scope.$watch('viewState.timelineSize', function () {\n          $timeout(scope.redraw, ConfigProviderService.design.animation.duration);\n        });\n        //\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n        }, true);\n        //\n        scope.$watch('viewState.playHeadAnimationInfos', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawPlayHead(scope, ConfigProviderService);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundarySample', function (newValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundary', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n                Drawhelperservice.osciPeaks = allPeakVals;\n                Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n              }\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n          }\n        }, true);\n        //\n        /////////////////////////\n        scope.redraw = function () {\n          scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPlayHead = function (scope, config) {\n          var ctx = markupCanvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          var posS = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.sS);\n          var posCur = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.curS);\n          ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n          ctx.fillRect(posS, 0, posCur - posS, canvas.height);\n          scope.drawVpOsciMarkup(scope, config, false);\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (scope, config, reset) {\n          var ctx = markupCanvas.getContext('2d');\n          if (reset) {\n            ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          Drawhelperservice.drawViewPortTimes(ctx, true);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx, true);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('preview', [\n  'viewState',\n  'Soundhandlerservice',\n  'Drawhelperservice',\n  'ConfigProviderService',\n  function (viewState, Soundhandlerservice, Drawhelperservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/preview.html',\n      restrict: 'E',\n      scope: { currentBundleName: '@' },\n      link: function postLink(scope, element) {\n        // select the needed DOM elements from the template and init vals\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[1];\n        var initialized = false;\n        // hook up scope vars for watches\n        scope.vs = viewState;\n        scope.shs = Soundhandlerservice;\n        scope.backgroundCanvas = {\n          'background': '#eee',\n          'border': '1px solid gray',\n          'width': '100%',\n          'height': '100%'\n        };\n        /////////////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newVal, oldVal) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            if (oldVal.sS !== newVal.sS || oldVal.eS !== newVal.eS) {\n              scope.drawPreview();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('currentBundleName', function () {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            initialized = false;\n            scope.backgroundCanvas = {\n              'background': ConfigProviderService.design.color.lightGrey,\n              'border': '1px solid gray',\n              'width': '100%',\n              'height': '100%'\n            };\n            scope.drawPreview();\n          }\n          //clear on empty bundle name\n          if (scope.currentBundleName === '') {\n            var ctx = canvas.getContext('2d');\n            var ctxMarkup = markupCanvas.getContext('2d');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctxMarkup.clearRect(0, 0, canvas.width, canvas.height);\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPreview = function () {\n          if (!initialized) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n            initialized = true;\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          } else {\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          }\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (vs, canvas, config) {\n          var ctx = markupCanvas.getContext('2d');\n          var posS = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.sS;\n          var posE = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.eS;\n          ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n          ctx.fillRect(posS, 0, posE - posS, markupCanvas.height);\n          ctx.strokeStyle = ConfigProviderService.design.color.transparent.black;\n          ctx.beginPath();\n          ctx.moveTo(posS, 0);\n          ctx.lineTo(posS, markupCanvas.height);\n          ctx.moveTo(posE, 0);\n          ctx.lineTo(posE, markupCanvas.height);\n          ctx.closePath();\n          ctx.stroke();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('bundleListSideBar', [\n  'HistoryService',\n  function (HistoryService) {\n    return {\n      templateUrl: 'views/bundleListSideBar.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        scope.comment = '';\n        scope.finishedEditing = function (finished, key, index) {\n          HistoryService.addObjToUndoStack({\n            type: 'WEBAPP',\n            action: 'FINISHED',\n            finished: finished,\n            key: key,\n            index: index\n          });\n        };\n        scope.updateHistory = function (bundle, key, index) {\n          HistoryService.updateCurChangeObj({\n            type: 'WEBAPP',\n            action: 'COMMENT',\n            initial: scope.comment,\n            comment: bundle.comment,\n            key: key,\n            index: index\n          });\n        };\n        scope.endHistory = function () {\n          HistoryService.addCurChangeObjToUndoStack();\n        };\n        scope.startHistory = function (bundle) {\n          scope.comment = bundle.comment;\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('spectro', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  'mathHelperService',\n  'loadedMetaDataService',\n  function ($timeout, viewState, ConfigProviderService, Drawhelperservice, fontScaleService, Soundhandlerservice, mathHelperService, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/spectro.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.shs = Soundhandlerservice;\n        scope.order = attrs.order;\n        scope.vs = viewState;\n        scope.cps = ConfigProviderService;\n        scope.dhs = Drawhelperservice;\n        scope.lmds = loadedMetaDataService;\n        scope.trackName = attrs.trackName;\n        // select the needed DOM elements from the template\n        scope.canvas0 = element.find('canvas')[0];\n        scope.canvas1 = element.find('canvas')[element.find('canvas').length - 1];\n        scope.context = scope.canvas0.getContext('2d');\n        scope.markupCtx = scope.canvas1.getContext('2d');\n        // FFT default vars\n        // default alpha for Window Function\n        scope.alpha = 0.16;\n        scope.devicePixelRatio = window.devicePixelRatio || 1;\n        // Spectro Worker\n        scope.primeWorker = new spectroDrawingWorker();\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.timelineSize', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.clearAndDrawSpectMarkup, ConfigProviderService.design.animation.duration);\n            }\n          }\n        });\n        //\n        scope.$watch('viewState.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue && !$.isEmptyObject(scope.shs) && !$.isEmptyObject(scope.shs.wavJSO)) {\n            scope.clearAndDrawSpectMarkup();\n          }\n        });\n        scope.$watch('vs.submenuOpen', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.clearAndDrawSpectMarkup, ConfigProviderService.design.animation.duration);\n            }\n          }\n        });\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                scope.redraw();\n              }\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // scope.redraw();\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.spectroSettings', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.setupEvent();\n              scope.redraw();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n                scope.redraw();\n              }\n            }\n          }\n        }, true);\n        ///////////////\n        // bindings\n        scope.redraw = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectro(scope.shs.wavJSO.Data);\n        };\n        scope.drawSpectro = function (buffer) {\n          scope.killSpectroRenderingThread();\n          scope.startSpectroRenderingThread(buffer);\n        };\n        scope.calcSamplesPerPxl = function () {\n          return (scope.vs.curViewPort.eS + 1 - scope.vs.curViewPort.sS) / scope.canvas0.width;\n        };\n        scope.clearAndDrawSpectMarkup = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectMarkup();\n        };\n        scope.drawSpectMarkup = function () {\n          // draw moving boundary line if moving\n          scope.dhs.drawMovingBoundaryLine(scope.markupCtx);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          // draw min max vals and name of track\n          scope.dhs.drawMinMaxAndName(scope.markupCtx, '', scope.vs.spectroSettings.rangeFrom, scope.vs.spectroSettings.rangeTo, 2);\n        };\n        scope.killSpectroRenderingThread = function () {\n          scope.context.fillStyle = ConfigProviderService.design.color.lightGrey;\n          scope.context.fillRect(0, 0, scope.canvas0.width, scope.canvas0.height);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          fontScaleService.drawUndistortedText(scope.context, 'rendering...', ConfigProviderService.design.font.small.size.slice(0, -2) * 0.75, ConfigProviderService.design.font.small.family, 10, 50, ConfigProviderService.design.color.black, true);\n          if (scope.primeWorker !== null) {\n            scope.primeWorker.kill();\n            scope.primeWorker = null;\n          }\n        };\n        scope.setupEvent = function () {\n          var imageData = scope.context.createImageData(scope.canvas0.width, scope.canvas0.height);\n          scope.primeWorker.says(function (event) {\n            if (event.status === undefined) {\n              if (scope.calcSamplesPerPxl() === event.samplesPerPxl) {\n                var tmp = new Uint8ClampedArray(event.img);\n                imageData.data.set(tmp);\n                scope.context.putImageData(imageData, 0, 0);\n                scope.drawSpectMarkup();\n              }\n            } else {\n              console.error('Error rendering spectrogram:', event.status.message);\n            }\n          });\n        };\n        scope.startSpectroRenderingThread = function (buffer) {\n          if (buffer.length > 0) {\n            scope.primeWorker = new spectroDrawingWorker();\n            var parseData = [];\n            var fftN = mathHelperService.calcClosestPowerOf2Gt(scope.shs.wavJSO.SampleRate * scope.vs.spectroSettings.windowSizeInSecs);\n            // fftN must be greater than 512 (leads to better resolution of spectrogram)\n            if (fftN < 512) {\n              fftN = 512;\n            }\n            // extract relavant data\n            parseData = buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS);\n            var leftPadding = [];\n            var rightPadding = [];\n            // check if any zero padding at LEFT edge is necessary\n            var windowSizeInSamples = scope.shs.wavJSO.SampleRate * scope.vs.spectroSettings.windowSizeInSecs;\n            if (scope.vs.curViewPort.sS < windowSizeInSamples / 2) {\n            } else {\n              leftPadding = buffer.subarray(scope.vs.curViewPort.sS - windowSizeInSamples / 2, scope.vs.curViewPort.sS);\n            }\n            // check if zero padding at RIGHT edge is necessary\n            if (scope.vs.curViewPort.eS + fftN / 2 - 1 >= scope.shs.wavJSO.Data.length) {\n            } else {\n              rightPadding = buffer.subarray(scope.vs.curViewPort.eS, scope.vs.curViewPort.eS + fftN / 2 - 1);\n            }\n            // add padding\n            var paddedSamples = new Float32Array(leftPadding.length + parseData.length + rightPadding.length);\n            paddedSamples.set(leftPadding);\n            paddedSamples.set(parseData, leftPadding.length);\n            paddedSamples.set(rightPadding, leftPadding.length + parseData.length);\n            if (scope.vs.curViewPort.sS >= fftN / 2) {\n              // pass in half a window extra at the front and a full window extra at the back so everything can be drawn/calculated this also fixes alignment issue\n              parseData = buffer.subarray(scope.vs.curViewPort.sS - fftN / 2, scope.vs.curViewPort.eS + fftN);\n            } else {\n              // tolerate window/2 alignment issue if at beginning of file\n              parseData = buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS + fftN);\n            }\n            scope.setupEvent();\n            scope.primeWorker.tell({\n              'windowSizeInSecs': scope.vs.spectroSettings.windowSizeInSecs,\n              'fftN': fftN,\n              'alpha': scope.alpha,\n              'upperFreq': scope.vs.spectroSettings.rangeTo,\n              'lowerFreq': scope.vs.spectroSettings.rangeFrom,\n              'samplesPerPxl': scope.calcSamplesPerPxl(),\n              'window': scope.vs.spectroSettings.window,\n              'imgWidth': scope.canvas0.width,\n              'imgHeight': scope.canvas0.height,\n              'dynRangeInDB': scope.vs.spectroSettings.dynamicRange,\n              'pixelRatio': scope.devicePixelRatio,\n              'sampleRate': scope.shs.wavJSO.SampleRate,\n              'transparency': scope.cps.vals.spectrogramSettings.transparency,\n              'audioBuffer': paddedSamples,\n              'audioBufferChannels': scope.shs.wavJSO.NumChannels,\n              'drawHeatMapColors': scope.vs.spectroSettings.drawHeatMapColors,\n              'preEmphasisFilterFactor': scope.vs.spectroSettings.preEmphasisFilterFactor,\n              'heatMapColorAnchors': scope.vs.spectroSettings.heatMapColorAnchors\n            }, [paddedSamples.buffer]);\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ExportCtrl', [\n  '$scope',\n  'modalService',\n  'browserDetector',\n  'viewState',\n  'HistoryService',\n  function ($scope, modalService, browserDetector, viewState, HistoryService) {\n    $scope.firefox = browserDetector.isBrowser.Firefox();\n    /**\n\t\t *\n\t\t */\n    $scope.getBlob = function () {\n      var blob;\n      try {\n        blob = new Blob([modalService.dataExport], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append($scope.exportData);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.updateHistoryService = function () {\n      HistoryService.movesAwayFromLastSave = 0;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.export = function () {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL($scope.getBlob());\n      } else {\n        objURL = URL.createObjectURL($scope.getBlob());\n      }\n      $scope.SaveToDisk(objURL, modalService.dataIn);\n      modalService.close();\n    };\n    /**\n\t\t *  Save file to disk // Non-IE ONLY !!\n\t\t */\n    $scope.SaveToDisk = function (fileURL, fileName) {\n      var save = document.createElement('a');\n      if ($scope.firefox) {\n        save.setAttribute('download', fileName);\n        save.href = fileURL;\n        save.innerHTML = '';\n        save.style.display = 'none';\n        document.body.appendChild(save);\n        save.click();\n      } else {\n        save.href = fileURL;\n        save.target = '_blank';\n        save.download = fileName || 'unknown';\n        var event = document.createEvent('Event');\n        event.initEvent('click', true, true);\n        save.dispatchEvent(event);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n      }\n      $scope.updateHistoryService();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('viewState', [\n  '$rootScope',\n  '$timeout',\n  '$window',\n  'Soundhandlerservice',\n  'DataService',\n  'StandardFuncsService',\n  function ($rootScope, $timeout, $window, Soundhandlerservice, DataService, StandardFuncsService) {\n    //shared service object to be returned\n    var sServObj = {};\n    // window functions enum for spectro\n    var myWindow = {\n        BARTLETT: 1,\n        BARTLETTHANN: 2,\n        BLACKMAN: 3,\n        COSINE: 4,\n        GAUSS: 5,\n        HAMMING: 6,\n        HANN: 7,\n        LANCZOS: 8,\n        RECTANGULAR: 9,\n        TRIANGULAR: 10\n      };\n    // communication modes enum\n    var myMode = {\n        DEMO: 1,\n        WS: 2,\n        EMBEDDED: 3\n      };\n    // time modes enum\n    var myTimeMode = {\n        absolute: 1,\n        relative: 2\n      };\n    // signal types enum\n    var mySignalType = {\n        OSCI: 1,\n        SPEC: 2\n      };\n    // twoDim types enum\n    var myTwoDimType = {\n        DOTS: 1,\n        EPG: 2\n      };\n    // hold the current attribute definitions that are in view\n    sServObj.curLevelAttrDefs = [];\n    /**\n\t\t * initialize all needed vars in viewState\n\t\t */\n    sServObj.initialize = function () {\n      sServObj.curViewPort = {\n        sS: 0,\n        eS: 0,\n        selectS: -1,\n        selectE: -1,\n        movingS: -1,\n        movingE: -1,\n        dragBarActive: false,\n        dragBarHeight: -1,\n        windowWidth: undefined\n      };\n      sServObj.spectroSettings = {\n        windowSizeInSecs: -1,\n        rangeFrom: -1,\n        rangeTo: -1,\n        dynamicRange: -1,\n        window: -1,\n        drawHeatMapColors: -1,\n        preEmphasisFilterFactor: -1\n      };\n      sServObj.playHeadAnimationInfos = {\n        sS: -1,\n        eS: -1,\n        curS: null,\n        endFreezeSample: -1\n      };\n      // HierarchyState object with all variables and functions\n      sServObj.hierarchyState = {\n        hierarchyShown: false,\n        selectedItemID: undefined,\n        selectedLinkFromID: undefined,\n        selectedLinkToID: undefined,\n        editValue: undefined,\n        inputFocus: false,\n        collapseInfo: {},\n        scaleFactor: 1,\n        translate: [\n          0,\n          0\n        ],\n        contextMenuID: undefined,\n        newLinkFromID: undefined,\n        path: [],\n        rotated: false,\n        playing: 0,\n        resize: 0,\n        contextMenuIsOpen: function () {\n          return sServObj.hierarchyState.contextMenuID !== undefined;\n        },\n        closeContextMenu: function () {\n          sServObj.hierarchyState.contextMenuID = undefined;\n        },\n        getContextMenuID: function () {\n          return sServObj.hierarchyState.contextMenuID;\n        },\n        setContextMenuID: function (id) {\n          sServObj.hierarchyState.contextMenuID = id;\n        },\n        getInputFocus: function () {\n          return sServObj.hierarchyState.inputFocus;\n        },\n        setInputFocus: function (f) {\n          sServObj.hierarchyState.inputFocus = f;\n        },\n        getEditValue: function () {\n          return sServObj.hierarchyState.editValue;\n        },\n        setEditValue: function (e) {\n          sServObj.hierarchyState.editValue = e;\n        },\n        reset: function () {\n          sServObj.hierarchyState.selectedItemID = undefined;\n          sServObj.hierarchyState.selectedLinkFromID = undefined;\n          sServObj.hierarchyState.selectedLinkToID = undefined;\n          sServObj.hierarchyState.editValue = undefined;\n          sServObj.hierarchyState.inputFocus = false;\n          sServObj.hierarchyState.collapseInfo = {};\n          sServObj.hierarchyState.scaleFactor = 1;\n          sServObj.hierarchyState.translate = [\n            0,\n            0\n          ];\n          sServObj.hierarchyState.contextMenuID = undefined;\n          sServObj.hierarchyState.newLinkFromID = undefined;\n        },\n        isRotated: function () {\n          return sServObj.hierarchyState.rotated;\n        },\n        toggleRotation: function () {\n          sServObj.hierarchyState.rotated = !sServObj.hierarchyState.rotated;\n        },\n        toggleHierarchy: function () {\n          sServObj.hierarchyState.hierarchyShown = !sServObj.hierarchyState.hierarchyShown;\n          if (sServObj.hierarchyState.hierarchyShown === false) {\n            // Make sure no private attributes (such as do start with an underscore\n            // are left in the data when the hierarchy modal is closed\n            StandardFuncsService.traverseAndClean(DataService.getData());\n          }\n        },\n        isShown: function () {\n          return sServObj.hierarchyState.hierarchyShown;\n        },\n        getCollapsed: function (id) {\n          if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n            return false;\n          } else {\n            if (typeof sServObj.hierarchyState.collapseInfo[id].collapsed === 'boolean') {\n              return sServObj.hierarchyState.collapseInfo[id].collapsed;\n            } else {\n              return false;\n            }\n          }\n        },\n        getCollapsePosition: function (id) {\n          if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n            return undefined;\n          } else {\n            if (typeof sServObj.hierarchyState.collapseInfo[id].collapsePosition === 'object') {\n              return sServObj.hierarchyState.collapseInfo[id].collapsePosition;\n            } else {\n              return undefined;\n            }\n          }\n        },\n        getNumCollapsedParents: function (id) {\n          if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n            return 0;\n          } else {\n            if (typeof sServObj.hierarchyState.collapseInfo[id].numCollapsedParents === 'number') {\n              return sServObj.hierarchyState.collapseInfo[id].numCollapsedParents;\n            } else {\n              return 0;\n            }\n          }\n        },\n        setCollapsed: function (id, newState) {\n          if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n            sServObj.hierarchyState.collapseInfo[id] = {};\n          }\n          sServObj.hierarchyState.collapseInfo[id].collapsed = newState;\n        },\n        setCollapsePosition: function (id, newPosition) {\n          if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n            sServObj.hierarchyState.collapseInfo[id] = {};\n          }\n          sServObj.hierarchyState.collapseInfo[id].collapsePosition = newPosition;\n        },\n        setNumCollapsedParents: function (id, newNum) {\n          if (typeof sServObj.hierarchyState.collapseInfo[id] === 'undefined') {\n            sServObj.hierarchyState.collapseInfo[id] = {};\n          }\n          sServObj.hierarchyState.collapseInfo[id].numCollapsedParents = newNum;\n        }\n      };\n      sServObj.timelineSize = -1;\n      sServObj.somethingInProgress = false;\n      sServObj.somethingInProgressTxt = '';\n      sServObj.historyActionTxt = '';\n      sServObj.editing = false;\n      sServObj.cursorInTextField = false;\n      sServObj.saving = true;\n      sServObj.submenuOpen = false;\n      sServObj.rightSubmenuOpen = false;\n      sServObj.curClickItems = [];\n      sServObj.curMousePosSample = 0;\n      sServObj.curMouseLevelName = undefined;\n      sServObj.curMouseLevelType = undefined;\n      sServObj.curClickLevelName = undefined;\n      sServObj.curClickLevelType = undefined;\n      sServObj.lastPcm = undefined;\n      sServObj.curPreselColumnSample = 2;\n      sServObj.curCorrectionToolNr = undefined;\n      sServObj.curClickLevelIndex = undefined;\n      sServObj.start = null;\n      sServObj.TransitionTime = undefined;\n      sServObj.showDropZone = true;\n      sServObj.movingBoundary = false;\n      sServObj.movingBoundarySample = undefined;\n      sServObj.focusInTextField = false;\n      sServObj.curTaskPercCompl = 0;\n      sServObj.curPerspectiveIdx = -1;\n      sServObj.mouseInEmuWebApp = false;\n      sServObj.focusOnEmuWebApp = true;\n      sServObj.lastKeyCode = undefined;\n      sServObj.lastUpdate = undefined;\n      sServObj.url = undefined;\n      sServObj.pageSize = 500;\n      sServObj.currentPage = undefined;\n      // possible general states of state machine\n      sServObj.states = [];\n      sServObj.states.noDBorFilesloaded = {\n        'permittedActions': [\n          'connectBtnClick',\n          'openDemoBtnDBclick',\n          'aboutBtnClick'\n        ]\n      };\n      sServObj.states.loadingSaving = { 'permittedActions': [] };\n      sServObj.states.labeling = {\n        'permittedActions': [\n          'zoom',\n          'playaudio',\n          'spectSettingsChange',\n          'addLevelSegBtnClick',\n          'addLevelPointBtnClick',\n          'renameSelLevelBtnClick',\n          'downloadTextGridBtnClick',\n          'downloadAnnotationBtnClick',\n          'spectSettingsChange',\n          'clearBtnClick',\n          'labelAction',\n          'toggleSideBars',\n          'saveBndlBtnClick',\n          'showHierarchyBtnClick',\n          'editDBconfigBtnClick',\n          'aboutBtnClick'\n        ]\n      };\n      sServObj.states.modalShowing = sServObj.states.loadingSaving;\n      sServObj.prevState = sServObj.states.noDBorFilesloaded;\n      sServObj.curState = sServObj.states.noDBorFilesloaded;\n      sServObj.curLevelAttrDefs = [];\n    };\n    // initialize on init\n    sServObj.initialize();\n    /**\n\t\t * function to ask permission in current labeler state\n\t\t */\n    sServObj.getPermission = function (actionName) {\n      return sServObj.curState.permittedActions.indexOf(actionName) > -1;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setWindowWidth = function (b) {\n      this.curViewPort.windowWidth = b;\n    };\n    /**\n\t\t * set state\n\t\t */\n    sServObj.setState = function (nameOrObj) {\n      sServObj.prevState = sServObj.curState;\n      if (typeof nameOrObj === 'string') {\n        sServObj.curState = sServObj.states[nameOrObj];\n      } else {\n        sServObj.curState = nameOrObj;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.updatePlayHead = function (timestamp) {\n      // at first push animation !!!\n      if (Soundhandlerservice.isPlaying) {\n        $window.requestAnimationFrame(sServObj.updatePlayHead);\n      }\n      // do work in this animation round now\n      if (sServObj.start === null) {\n        sServObj.start = timestamp;\n      }\n      var samplesPassed = Math.floor(timestamp - sServObj.start) / 1000 * Soundhandlerservice.wavJSO.SampleRate;\n      sServObj.playHeadAnimationInfos.curS = Math.floor(sServObj.playHeadAnimationInfos.sS + samplesPassed);\n      if (Soundhandlerservice.isPlaying && sServObj.playHeadAnimationInfos.curS <= sServObj.playHeadAnimationInfos.eS) {\n        if (sServObj.playHeadAnimationInfos.curS !== -1) {\n          sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.curS;\n        }\n        $rootScope.$apply();\n      } else {\n        sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.endFreezeSample;\n        sServObj.playHeadAnimationInfos.sS = -1;\n        sServObj.playHeadAnimationInfos.eS = -1;\n        sServObj.playHeadAnimationInfos.curS = 0;\n        sServObj.start = null;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.animatePlayHead = function (startS, endS) {\n      sServObj.playHeadAnimationInfos.sS = startS;\n      sServObj.playHeadAnimationInfos.eS = endS;\n      sServObj.playHeadAnimationInfos.endFreezeSample = endS;\n      sServObj.playHeadAnimationInfos.curS = startS;\n      $window.requestAnimationFrame(sServObj.updatePlayHead);\n    };\n    /**\n\t\t * set selected Area\n\t\t * @param start of selected Area\n\t\t * @param end of selected Area\n\t\t */\n    sServObj.select = function (start, end) {\n      sServObj.curViewPort.selectS = start;\n      sServObj.curViewPort.selectE = end;  //$rootScope.$digest();\n    };\n    /**\n\t\t * reset selected Area to default\n\t\t * @param length of current pcm stream\n\t\t */\n    sServObj.resetSelect = function () {\n      sServObj.curViewPort.selectS = -1;\n      sServObj.curViewPort.selectE = -1;\n    };\n    /**\n\t\t * gets the current Viewport\n\t\t */\n    sServObj.getViewPort = function () {\n      return sServObj.curViewPort;\n    };\n    /**\n\t\t * setspectroSettings\n\t\t */\n    sServObj.setspectroSettings = function (len, rfrom, rto, dyn, win, hm, preEmph, hmColorAnchors) {\n      sServObj.spectroSettings.windowSizeInSecs = len;\n      sServObj.spectroSettings.rangeFrom = parseInt(rfrom, 10);\n      sServObj.spectroSettings.rangeTo = parseInt(rto, 10);\n      sServObj.spectroSettings.dynamicRange = parseInt(dyn, 10);\n      sServObj.setWindowFunction(win);\n      sServObj.spectroSettings.drawHeatMapColors = hm;\n      sServObj.spectroSettings.preEmphasisFilterFactor = preEmph;\n      sServObj.spectroSettings.heatMapColorAnchors = hmColorAnchors;\n    };\n    /**\n\t\t * returns current selection as array\n\t\t */\n    sServObj.getSelect = function () {\n      return [\n        sServObj.curViewPort.selectS,\n        sServObj.curViewPort.selectE\n      ];\n    };\n    /**\n\t\t * set selected Area if new\n\t\t * start value is smaler than actual and\n\t\t * end value is greater than actual\n\t\t * @param start of selected Area\n\t\t * @param end of seleected Area\n\t\t */\n    sServObj.selectDependent = function (start, end) {\n      if (start < this.curViewPort.selectS) {\n        this.curViewPort.selectS = start;\n      }\n      if (end > this.curViewPort.selectE) {\n        this.curViewPort.selectE = end;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.selectLevel = function (next, order, Levelserv) {\n      var curLev;\n      var now = sServObj.getcurClickLevelName();\n      if (now === undefined) {\n        if (!next) {\n          // select first if none prev. defined (up)\n          // viewState.setcurClickLevel(levelID, levelType, scope.$index, scope.this.level.items.length);\n          curLev = Levelserv.getLevelDetails(order[0]);\n          if (curLev !== null) {\n            sServObj.setcurClickLevel(curLev.name, curLev.type, 0);\n          }\n          return;\n        } else {\n          // select last if none prev. defined (down)\n          curLev = Levelserv.getLevelDetails(order[order.length - 1]);\n          sServObj.setcurClickLevel(curLev.name, curLev.type, order.length - 1);\n          return;\n        }\n      }\n      var idxOfNow;\n      order.forEach(function (name, idx) {\n        if (name === now) {\n          idxOfNow = idx;\n        }\n      });\n      if (idxOfNow === undefined) {\n        curLev = Levelserv.getLevelDetails(order[0]);\n        sServObj.setcurClickLevel(curLev.name, curLev.type, 0);\n        sServObj.curClickItems = [];\n        sServObj.selectBoundary();\n      } else {\n        if (next) {\n          if (idxOfNow + 1 < order.length) {\n            curLev = Levelserv.getLevelDetails(order[idxOfNow + 1]);\n            // sServObj.setcurClickLevelName(order[idxOfNow + 1]);\n            sServObj.setcurClickLevel(curLev.name, curLev.type, order.idxOfNow + 1);\n            sServObj.curClickItems = [];\n            sServObj.selectBoundary();  //sServObj.resetSelect();\n          }\n        } else {\n          if (idxOfNow - 1 >= 0) {\n            curLev = Levelserv.getLevelDetails(order[idxOfNow - 1]);\n            // sServObj.setcurClickLevelName(order[idxOfNow - 1]);\n            sServObj.setcurClickLevel(curLev.name, curLev.type, order.idxOfNow - 1);\n            sServObj.curClickItems = [];\n            sServObj.selectBoundary();  //sServObj.resetSelect();\n          }\n        }\n      }\n    };\n    /**\n\t\t * set the window Function for the Spectrogram\n\t\t * @param name of Window Function\n\t\t */\n    sServObj.setWindowFunction = function (name) {\n      switch (name) {\n      case 'BARTLETT':\n        sServObj.spectroSettings.window = myWindow.BARTLETT;\n        break;\n      case 'BARTLETTHANN':\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      case 'BLACKMAN':\n        sServObj.spectroSettings.window = myWindow.BLACKMAN;\n        break;\n      case 'COSINE':\n        sServObj.spectroSettings.window = myWindow.COSINE;\n        break;\n      case 'GAUSS':\n        sServObj.spectroSettings.window = myWindow.GAUSS;\n        break;\n      case 'HAMMING':\n        sServObj.spectroSettings.window = myWindow.HAMMING;\n        break;\n      case 'HANN':\n        sServObj.spectroSettings.window = myWindow.HANN;\n        break;\n      case 'LANCZOS':\n        sServObj.spectroSettings.window = myWindow.LANCZOS;\n        break;\n      case 'RECTANGULAR':\n        sServObj.spectroSettings.window = myWindow.RECTANGULAR;\n        break;\n      case 'TRIANGULAR':\n        sServObj.spectroSettings.window = myWindow.TRIANGULAR;\n        break;\n      default:\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      }\n    };\n    /**\n\t\t * @returns myWindow object\n\t\t */\n    sServObj.getWindowFunctions = function () {\n      return myWindow;\n    };\n    /**\n\t\t * @returns myWindow object\n\t\t */\n    sServObj.getCommunicationModes = function () {\n      return myMode;\n    };\n    /**\n\t\t * @returns myWindow object\n\t\t */\n    sServObj.getTimeModes = function () {\n      return myTimeMode;\n    };\n    /**\n\t\t * @returns myWindow object\n\t\t */\n    sServObj.getSignalTypes = function () {\n      return mySignalType;\n    };\n    /**\n\t\t * @returns myWindow object\n\t\t */\n    sServObj.getTwoDimTypes = function () {\n      return myTwoDimType;\n    };\n    /**\n\t\t * set if user is dragging dragbar\n\t\t */\n    sServObj.getdragBarActive = function () {\n      return this.curViewPort.dragBarActive;\n    };\n    /**\n\t\t * set if user is dragging dragbar\n\t\t */\n    sServObj.setdragBarActive = function (b) {\n      this.curViewPort.dragBarActive = b;\n    };\n    /**\n\t\t * set if user is dragging dragbar\n\t\t */\n    sServObj.getdragBarHeight = function () {\n      return this.curViewPort.dragBarHeight;\n    };\n    /**\n\t\t * set if user is dragging dragbar\n\t\t */\n    sServObj.setdragBarHeight = function (b) {\n      this.curViewPort.dragBarHeight = b;\n    };\n    /**\n\t\t * get pixel position in current viewport given the canvas width\n\t\t * @param w is width of canvas\n\t\t * @param s is current sample to convert to pixel value\n\t\t */\n    sServObj.getPos = function (w, s) {\n      return w * (s - this.curViewPort.sS) / (this.curViewPort.eS - this.curViewPort.sS + 1);  // + 1 because of view (displays all samples in view)\n    };\n    /**\n\t\t * calculate the pixel distance between two samples\n\t\t * @param w is width of canvas\n\t\t */\n    sServObj.getSampleDist = function (w) {\n      return this.getPos(w, this.curViewPort.sS + 1) - this.getPos(w, this.curViewPort.sS);\n    };\n    /**\n\t\t * toggle boolean if left submenu is open\n\t\t */\n    sServObj.toggleSubmenu = function (time) {\n      this.submenuOpen = !this.submenuOpen;\n      $timeout(function () {\n        var d = new Date();\n        sServObj.lastUpdate = d.getTime();\n      }, time);\n    };\n    /**\n\t\t * get boolean if left submenu is open\n\t\t */\n    sServObj.getsubmenuOpen = function () {\n      return this.submenuOpen;\n    };\n    /**\n\t\t * set boolean if left submenu is open\n\t\t */\n    sServObj.setsubmenuOpen = function (s) {\n      this.submenuOpen = s;\n    };\n    /**\n\t\t * get the height of the osci\n\t\t */\n    sServObj.setenlarge = function (s) {\n      this.timelineSize = s;\n    };\n    /**\n\t\t * get the height of the osci\n\t\t */\n    sServObj.getenlarge = function () {\n      return this.timelineSize;\n    };\n    /**\n\t\t * get the height of the osci\n\t\t */\n    sServObj.getTransitionTime = function () {\n      return this.TransitionTime;\n    };\n    /**\n\t\t * get the height of the osci\n\t\t */\n    sServObj.setTransitionTime = function (s) {\n      this.TransitionTime = s;\n    };\n    /**\n\t\t * get the height of the osci\n\t\t */\n    sServObj.getRightsubmenuOpen = function () {\n      return this.rightSubmenuOpen;\n    };\n    /**\n\t\t * get the height of the osci\n\t\t */\n    sServObj.setRightsubmenuOpen = function (s) {\n      this.rightSubmenuOpen = s;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setcurClickLevel = function (levelID, levelType, levelIndex) {\n      sServObj.setcurClickLevelName(levelID, levelIndex);\n      sServObj.setcurClickLevelType(levelType);\n    };\n    /**\n\t\t * sets the current (clicked) Level Name\n\t\t * @param name is name of level\n\t\t */\n    sServObj.setcurClickLevelType = function (name) {\n      this.curClickLevelType = name;\n    };\n    /**\n\t\t * gets the current (clicked) Level Name\n\t\t */\n    sServObj.getcurClickLevelType = function () {\n      return this.curClickLevelType;\n    };\n    /**\n\t\t * sets the current (clicked) Level Name\n\t\t * @param name is name of level\n\t\t */\n    sServObj.setcurClickLevelName = function (name, index) {\n      this.curClickLevelName = name;\n      this.curClickLevelIndex = index;\n    };\n    /**\n\t\t * gets the current (clicked) Level Name\n\t\t */\n    sServObj.getcurClickLevelName = function () {\n      return this.curClickLevelName;\n    };\n    /**\n\t\t * gets the current (clicked) Level Name\n\t\t */\n    sServObj.getcurClickLevelIndex = function () {\n      return this.curClickLevelIndex;\n    };\n    /**\n\t\t * gets the current (clicked) Level Name\n\t\t */\n    sServObj.getcurClickNeighbours = function () {\n      return this.curClickNeighbours;\n    };\n    /**\n\t\t * sets the current (mousemove) Level Name\n\t\t * @param name is name of level\n\t\t */\n    sServObj.setcurMouseLevelName = function (name) {\n      this.curMouseLevelName = name;\n    };\n    /**\n\t\t * gets the current (mousemove) Level Name\n\t\t */\n    sServObj.getcurMouseLevelName = function () {\n      return this.curMouseLevelName;\n    };\n    /**\n\t\t * sets the current (mousemove) Level Name\n\t\t * @param name is name of level\n\t\t */\n    sServObj.setcurMouseLevelType = function (name) {\n      this.curMouseLevelType = name;\n    };\n    /**\n\t\t * gets the current (mousemove) Level Name\n\t\t */\n    sServObj.getcurMouseLevelType = function () {\n      return this.curMouseLevelType;\n    };\n    /**\n\t\t * sets the current (mousemove) Item\n\t\t * @param item Object representing the current mouse item\n\t\t * @param neighbour Objects of left and right neighbours of the current mouse item\n\t\t * @param x current horizontal mouse pointer position\n\t\t * @param isFirst true if item is the first item on current level\n\t\t * @param isLast true if item is last item on current level\n\t\t */\n    sServObj.setcurMouseItem = function (item, neighbour, x, isFirst, isLast) {\n      this.curMouseItem = item;\n      this.curMouseX = x;\n      this.curMouseNeighbours = neighbour;\n      this.curMouseisFirst = isFirst;\n      this.curMouseisLast = isLast;\n    };\n    /**\n\t\t * Getter for current Mouse Item\n\t\t * @return Object representing the current mouse item\n\t\t */\n    sServObj.getcurMouseItem = function () {\n      return this.curMouseItem;\n    };\n    /**\n\t\t * Getter for isFirst\n\t\t * @return true if item is first item on level\n\t\t */\n    sServObj.getcurMouseisFirst = function () {\n      return this.curMouseisFirst;\n    };\n    /**\n\t\t * Getter for isLast\n\t\t * @return true if item is last item on level\n\t\t */\n    sServObj.getcurMouseisLast = function () {\n      return this.curMouseisLast;\n    };\n    /**\n\t\t * Getter for current Mouse Item Neighbours (left and right)\n\t\t * @return Object representing the current mouse item neighbours\n\t\t */\n    sServObj.getcurMouseNeighbours = function () {\n      return this.curMouseNeighbours;\n    };\n    /**\n\t\t * get all items of current level which are inside the selected viewport\n\t\t */\n    sServObj.getItemsInSelection = function (levelData) {\n      var itemsInRange = [];\n      var rangeStart = sServObj.curViewPort.selectS;\n      var rangeEnd = sServObj.curViewPort.selectE;\n      angular.forEach(levelData, function (t) {\n        if (t.name === sServObj.getcurClickLevelName()) {\n          angular.forEach(t.items, function (item) {\n            if (item.sampleStart >= rangeStart && item.sampleStart + item.sampleDur <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n            if (item.samplePoint >= rangeStart && item.samplePoint <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n          });\n        }\n      });\n      return itemsInRange.sort(sServObj.sortbystart);\n    };\n    /**\n\t\t * Setter for the current (click) Item\n\t\t * @param item Object representing the currently clicked item\n\t\t */\n    sServObj.setcurClickItem = function (item) {\n      if (item !== null && item !== undefined) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n        sServObj.selectBoundary();\n      } else {\n        sServObj.curClickItems = [];\n      }\n    };\n    /**\n\t\t * Selects the current Boundary\n\t\t */\n    sServObj.selectBoundary = function () {\n      if (sServObj.curClickItems.length > 0) {\n        if (typeof sServObj.curClickItems[0].samplePoint === 'undefined') {\n          var left = sServObj.curClickItems[0].sampleStart;\n        } else {\n          var left = sServObj.curClickItems[0].samplePoint;\n        }\n        if (typeof sServObj.curClickItems[0].samplePoint === 'undefined') {\n          var right = sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleStart + sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleDur;\n        } else {\n          var right = sServObj.curClickItems[0].samplePoint;\n        }\n        sServObj.curClickItems.forEach(function (entry) {\n          if (entry.sampleStart <= left) {\n            left = entry.sampleStart;\n          }\n          if (entry.sampleStart + entry.sampleDur >= right) {\n            right = entry.sampleStart + entry.sampleDur;\n          }\n        });\n        sServObj.select(left, right + 1);\n      }\n    };\n    /**\n\t\t * adds an item to the currently selected items if the left or right one of current selected items\n\t\t * @param item representing the Object to be added to selection\n\t\t * @param next Object next to the Object to be added to selection\n\t\t * @param prev Object previous of the Object to be added to selection\n\t\t */\n    sServObj.setcurClickItemMultiple = function (item, neighbour) {\n      // if nothing is in curClickItems\n      if (sServObj.curClickItems.length == 0 || sServObj.curClickItems === undefined || sServObj.curClickItems === null) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n      }  // if there is something in curClickItems\n      else {\n        // if item is not yet in curClickItems\n        if (sServObj.curClickItems.indexOf(item) === -1) {\n          if (sServObj.curClickItems.indexOf(neighbour) < 0) {\n            sServObj.curClickItems = [];\n          }\n          sServObj.curClickItems.push(item);\n          sServObj.curClickItems.sort(sServObj.sortbystart);\n        }  // if item is in curClickItems reset and add\n        else {\n          sServObj.curClickItems = [];\n          sServObj.curClickItems.push(item);\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.sortbystart = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.sampleStart > b.sampleStart || a.samplePoint > b.samplePoint) {\n        return 1;\n      }\n      if (a.sampleStart < b.sampleStart || a.samplePoint < b.samplePoint) {\n        return -1;\n      }\n      return 0;\n    };\n    /**\n\t\t * Getter for the current selected range in samples\n\t\t * if nothing is selected returns -1\n\t\t * @return Object with Start and End values in samples\n\t\t */\n    sServObj.getselectedRange = function () {\n      if (this.curClickItems.length > 1) {\n        return {\n          start: this.curClickItems[0].sampleStart,\n          end: this.curClickItems[this.curClickItems.length - 1].sampleStart + this.curClickItems[this.curClickItems.length - 1].sampleDur\n        };\n      } else if (this.curClickItems.length === 1) {\n        if (this.curClickItems[0].sampleStart !== undefined) {\n          return {\n            start: this.curClickItems[0].sampleStart,\n            end: this.curClickItems[0].sampleStart + this.curClickItems[0].sampleDur\n          };\n        } else {\n          return {\n            start: this.curClickItems[0].samplePoint,\n            end: this.curClickItems[0].samplePoint\n          };\n        }\n      } else {\n        return {\n          start: -1,\n          end: -1\n        };\n      }\n    };\n    /**\n\t\t * Getter for the currently (clicked) items\n\t\t */\n    sServObj.getcurClickItems = function () {\n      return this.curClickItems;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getselected = function () {\n      return this.curClickItems;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.isEditing = function () {\n      return this.editing;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setEditing = function (n) {\n      this.editing = n;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLasPcm = function () {\n      return this.lastPcm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setLastPcm = function (n) {\n      this.lastPcm = n;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getcursorInTextField = function () {\n      return this.cursorInTextField;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setcursorInTextField = function (n) {\n      this.cursorInTextField = n;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.isSavingAllowed = function () {\n      return this.saving;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setSavingAllowed = function (n) {\n      this.saving = n;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.countSelected = function () {\n      return this.curClickItems.length;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getCurrentSample = function (perc) {\n      return this.curViewPort.sS + (this.curViewPort.eS - this.curViewPort.sS) * perc;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getCurrentPercent = function (sample) {\n      return sample * (100 / (this.curViewPort.eS - this.curViewPort.sS) / 100);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSamplesPerPixelVal = function (event) {\n      var start = parseFloat(this.curViewPort.sS);\n      var end = parseFloat(this.curViewPort.eS);\n      return (end - start) / event.originalEvent.target.width;\n    };\n    /**\n\t\t * calcs and returns start in secs\n\t\t */\n    sServObj.getViewPortStartTime = function () {\n      return this.curViewPort.sS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n\t\t * calcs and returns end time in secs\n\t\t */\n    sServObj.getViewPortEndTime = function () {\n      return this.curViewPort.eS * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n\t\t * calcs and returns start in secs\n\t\t */\n    sServObj.getSelectedStartTime = function () {\n      return this.curViewPort.selectS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n\t\t * calcs and returns end time in secs\n\t\t */\n    sServObj.getSelectedEndTime = function () {\n      return this.curViewPort.selectE * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n\t\t * set view port to start and end sample\n\t\t * (with several out-of-bounds like checks)\n\t\t *\n\t\t * @param sSample start sample of view\n\t\t * @param sSample end sample of view\n\t\t */\n    sServObj.setViewPort = function (sSample, eSample) {\n      var oldStart = this.curViewPort.sS;\n      var oldEnd = this.curViewPort.eS;\n      if (sSample !== undefined) {\n        this.curViewPort.sS = Math.round(sSample);\n      }\n      if (eSample !== undefined) {\n        this.curViewPort.eS = Math.round(eSample);\n      }\n      // check if moving left or right is not out of bounds -> prevent zooming on edge when moving left/right\n      if (oldStart > this.curViewPort.sS && oldEnd > this.curViewPort.eS) {\n        //moved left\n        if (this.curViewPort.sS < 0) {\n          this.curViewPort.sS = 0;\n          this.curViewPort.eS = oldEnd + Math.abs(this.curViewPort.sS);\n        }\n      }\n      if (oldStart < this.curViewPort.sS && oldEnd < this.curViewPort.eS) {\n        //moved right\n        if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n          this.curViewPort.sS = oldStart;\n          this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n        }\n      }\n      // check if in range\n      if (this.curViewPort.sS < 0) {\n        this.curViewPort.sS = 0;\n      }\n      if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n        this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n      }\n      // check if at least 4 samples are showing (fixed max zoom size)\n      if (this.curViewPort.eS - this.curViewPort.sS < 4) {\n        this.curViewPort.sS = oldStart;\n        this.curViewPort.eS = oldEnd;\n      }\n    };\n    /**\n\t\t * set view port to start and end sample\n\t\t * (with several out-of-bounds like checks)\n\t\t *\n\t\t * @param zoomIn bool to specify zooming direction\n\t\t * if set to true -> zoom in\n\t\t * if set to false -> zoom out\n\t\t */\n    sServObj.zoomViewPort = function (zoomIn, LevelService) {\n      var newStartS, newEndS, curMouseMoveItemStart;\n      var seg = this.getcurMouseItem();\n      var d = this.curViewPort.eS - this.curViewPort.sS;\n      var isLastSeg = false;\n      if (seg !== undefined) {\n        if (this.getcurMouseisFirst()) {\n          // before first element\n          seg = LevelService.getItemDetails(sServObj.getcurMouseLevelName(), 0);\n        } else if (this.getcurMouseisLast()) {\n          seg = LevelService.getLastItem(sServObj.getcurMouseLevelName());\n          isLastSeg = true;\n        }\n        if (this.getcurMouseLevelType() === 'SEGMENT') {\n          if (isLastSeg) {\n            curMouseMoveItemStart = seg.sampleStart + seg.sampleDur;\n          } else {\n            curMouseMoveItemStart = seg.sampleStart;\n          }\n        } else {\n          curMouseMoveItemStart = seg.samplePoint;\n        }\n        var d1 = curMouseMoveItemStart - this.curViewPort.sS;\n        var d2 = this.curViewPort.eS - curMouseMoveItemStart;\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + d1 * 0.5;\n          newEndS = this.curViewPort.eS - d2 * 0.5;\n        } else {\n          newStartS = this.curViewPort.sS - d1 * 0.5;\n          newEndS = this.curViewPort.eS + d2 * 0.5;\n        }\n      } else {\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + ~~(d / 4);\n          newEndS = this.curViewPort.eS - ~~(d / 4);\n        } else {\n          newStartS = this.curViewPort.sS - ~~(d / 4);\n          newEndS = this.curViewPort.eS + ~~(d / 4);\n        }\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n\t\t * moves view port to the right or to the left\n\t\t * without changing the zoom\n\t\t *\n\t\t * @param shiftRight bool to specify direction\n\t\t * if set to true -> shift right\n\t\t * if set to false -> shift left\n\t\t */\n    sServObj.shiftViewPort = function (shiftRight) {\n      // my.removeLabelDoubleClick();\n      var newStartS, newEndS;\n      if (shiftRight) {\n        newStartS = this.curViewPort.sS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      } else {\n        newStartS = this.curViewPort.sS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n\t\t * sets all the curLevelAttrDefs array\n\t\t * to hold the default attr. definitions\n\t\t * which are the same as the level names\n\t\t *\n\t\t * @param levelDefs level definitions from the DBconfig\n\t\t */\n    sServObj.setCurLevelAttrDefs = function (levelDefs) {\n      angular.forEach(levelDefs, function (ld) {\n        sServObj.curLevelAttrDefs.push({\n          'levelName': ld.name,\n          'curAttrDefName': ld.name\n        });\n      });\n    };\n    /**\n\t\t * set the current attribute definition name of the\n\t\t * given levelName\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @param newAttrDefName\n\t\t */\n    sServObj.setCurAttrDef = function (levelName, newAttrDefName, index) {\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          ad.curAttrDefName = newAttrDefName;\n          ad.curAttrDefIndex = index;\n        }\n      });\n    };\n    /**\n\t\t * get the current attribute definition name of the\n\t\t * given levelName\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @returns attrDefName\n\t\t */\n    sServObj.getCurAttrDef = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          curAttrDef = ad.curAttrDefName;\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n\t\t * get the current attribute definition index of the\n\t\t * given levelName\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @returns attrDefName\n\t\t */\n    sServObj.getCurAttrIndex = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          if (ad.curAttrDefIndex === undefined) {\n            curAttrDef = 0;\n          } else {\n            curAttrDef = ad.curAttrDefIndex;\n          }\n        }\n      });\n      return curAttrDef;\n    };\n    sServObj.setlastKeyCode = function (e) {\n      this.lastKeyCode = e;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getX = function (e) {\n      return (e.offsetX || e.originalEvent.layerX) * (e.originalEvent.target.width / e.originalEvent.target.clientWidth);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getY = function (e) {\n      return (e.offsetY || e.originalEvent.layerY) * (e.originalEvent.target.height / e.originalEvent.target.clientHeight);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.resetToInitState = function () {\n      sServObj.initialize();\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getColorOfAnchor = function (val, anchorNr) {\n      var curStyle = {\n          'background-color': 'rgb(' + val[anchorNr][0] + ',' + val[anchorNr][1] + ',' + val[anchorNr][2] + ')',\n          'width': '10px',\n          'height': '10px'\n        };\n      return curStyle;\n    };\n    sServObj.numberOfPages = function (sessionLength) {\n      return Math.ceil(sessionLength / sServObj.pageSize);\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('trackMouseInLevel', [\n  '$document',\n  'viewState',\n  'LevelService',\n  'ConfigProviderService',\n  'HistoryService',\n  'Soundhandlerservice',\n  function ($document, viewState, LevelService, ConfigProviderService, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      replace: true,\n      scope: {\n        levelName: '=',\n        levelType: '='\n      },\n      link: function (scope, element, attr) {\n        scope.lastEventClick = undefined;\n        scope.lastEventMove = undefined;\n        scope.lastNeighboursMove = undefined;\n        scope.lastPCM = undefined;\n        scope.curMouseSampleNrInView = undefined;\n        scope.order = attr.trackMouseInLevel;\n        /////////////////////////////\n        // Bindings\n        //\n        element.bind('click', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastClick(event);\n        });\n        //\n        element.bind('contextmenu', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastRightClick(event);\n        });\n        //\n        element.bind('dblclick', function (event) {\n          scope.setLastMove(event, true);\n          if (ConfigProviderService.vals.restrictions.editItemName) {\n            scope.setLastDblClick(event);\n          } else {\n            scope.setLastClick(event);\n          }\n        });\n        //\n        element.bind('mousemove', function (event) {\n          if (viewState.focusOnEmuWebApp) {\n            if (!viewState.getdragBarActive()) {\n              var moveLine = true;\n              var samplesPerPixel = viewState.getSamplesPerPixelVal(event);\n              scope.curMouseSampleNrInView = viewState.getX(event) * samplesPerPixel;\n              var moveBy = scope.curMouseSampleNrInView - scope.lastPCM;\n              if (samplesPerPixel <= 1) {\n                var zoomEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n                // absolute movement in pcm below 1 pcm per pixel\n                if (scope.levelType === 'SEGMENT') {\n                  if (zoomEventMove.isFirst === true && zoomEventMove.isLast === false) {\n                    // before first elem\n                    moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemDetails(scope.levelName, 0).sampleStart);\n                  } else if (zoomEventMove.isFirst === false && zoomEventMove.isLast === true) {\n                    // after last elem\n                    var lastItem = LevelService.getLastItem(scope.levelName);\n                    moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - lastItem.sampleStart - lastItem.sampleDur);\n                  } else {\n                    moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).sampleStart);\n                  }\n                } else {\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).samplePoint - 0.5);  // 0.5 to break between samples not on\n                }\n              } else {\n                // relative movement in pcm above 1 pcm per pixel\n                moveBy = Math.round(scope.curMouseSampleNrInView - scope.lastPCM);\n              }\n            }\n            var mbutton = 0;\n            if (event.buttons === undefined) {\n              mbutton = event.which;\n            } else {\n              mbutton = event.buttons;\n            }\n            switch (mbutton) {\n            case 1:\n              //console.log('Left mouse button pressed');\n              break;\n            case 2:\n              //console.log('Middle mouse button pressed');\n              break;\n            case 3:\n              //console.log('Right mouse button pressed');\n              break;\n            default:\n              if (!viewState.getdragBarActive()) {\n                var curMouseItem = viewState.getcurMouseItem();\n                if (ConfigProviderService.vals.restrictions.editItemSize && event.shiftKey) {\n                  LevelService.deleteEditArea();\n                  if (curMouseItem !== undefined) {\n                    viewState.movingBoundary = true;\n                    if (scope.levelType === 'SEGMENT') {\n                      if (viewState.getcurMouseisFirst() || viewState.getcurMouseisLast()) {\n                        var seg, leftMost, rightB;\n                        // before first segment\n                        if (viewState.getcurMouseisFirst()) {\n                          seg = LevelService.getItemDetails(scope.levelName, 0);\n                          viewState.movingBoundarySample = seg.sampleStart + moveBy;\n                        } else if (viewState.getcurMouseisLast()) {\n                          seg = LevelService.getLastItem(scope.levelName);\n                          viewState.movingBoundarySample = seg.sampleStart + seg.sampleDur + moveBy;\n                        }\n                      } else {\n                        viewState.movingBoundarySample = curMouseItem.sampleStart + moveBy;\n                        seg = curMouseItem;\n                      }\n                      LevelService.moveBoundary(scope.levelName, seg.id, moveBy, viewState.getcurMouseisFirst(), viewState.getcurMouseisLast());\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEBOUNDARY',\n                        'name': scope.levelName,\n                        'id': seg.id,\n                        'movedBy': moveBy,\n                        'isFirst': viewState.getcurMouseisFirst(),\n                        'isLast': viewState.getcurMouseisLast()\n                      });\n                    } else {\n                      seg = curMouseItem;\n                      viewState.movingBoundarySample = curMouseItem.samplePoint + moveBy;\n                      LevelService.moveEvent(scope.levelName, seg.id, moveBy);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEEVENT',\n                        'name': scope.levelName,\n                        'id': seg.id,\n                        'movedBy': moveBy\n                      });\n                    }\n                    scope.lastPCM = scope.curMouseSampleNrInView;\n                    viewState.setLastPcm(scope.lastPCM);\n                    viewState.selectBoundary();\n                    moveLine = false;\n                  }\n                } else if (ConfigProviderService.vals.restrictions.editItemSize && event.altKey) {\n                  LevelService.deleteEditArea();\n                  if (scope.levelType == 'SEGMENT') {\n                    seg = viewState.getcurClickItems();\n                    if (seg[0] !== undefined) {\n                      LevelService.moveSegment(scope.levelName, seg[0].id, seg.length, moveBy);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVESEGMENT',\n                        'name': scope.levelName,\n                        'id': seg[0].id,\n                        'length': seg.length,\n                        'movedBy': moveBy\n                      });\n                    }\n                    scope.lastPCM = scope.curMouseSampleNrInView;\n                    viewState.setLastPcm(scope.lastPCM);\n                    viewState.selectBoundary();\n                  } else if (scope.levelType == 'EVENT') {\n                    seg = viewState.getcurClickItems();\n                    if (seg[0] !== undefined) {\n                      angular.forEach(seg, function (s) {\n                        LevelService.moveEvent(scope.levelName, s.id, moveBy);\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': scope.levelName,\n                          'id': s.id,\n                          'movedBy': moveBy\n                        });\n                      });\n                    }\n                    scope.lastPCM = scope.curMouseSampleNrInView;\n                    viewState.setLastPcm(scope.lastPCM);\n                    viewState.selectBoundary();\n                  }\n                } else {\n                  viewState.movingBoundary = false;\n                }\n              }\n              break;\n            }\n            if (!viewState.getdragBarActive()) {\n              scope.setLastMove(event, moveLine);\n            }\n          }\n        });\n        //\n        element.bind('mousedown', function (event) {\n          viewState.movingBoundary = true;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseup', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseout', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        /////////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.setLastClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.order);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n            LevelService.setlasteditAreaElem(element.parent());\n            viewState.setcurClickItem(scope.lastEventClick.current);\n            viewState.selectBoundary();\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.setLastRightClick = function (x) {\n          if (viewState.getcurClickLevelName() !== scope.levelName) {\n            scope.setLastClick(x);\n          }\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            var next = LevelService.getItemInTime(viewState.getcurClickLevelName(), scope.lastEventClick.current.id, true);\n            var prev = LevelService.getItemInTime(viewState.getcurClickLevelName(), scope.lastEventClick.current.id, false);\n            viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n            viewState.setcurClickItemMultiple(scope.lastEventClick.current, next, prev);\n            viewState.selectBoundary();\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.setLastDblClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          var isOpen = element.parent().css('height') === '25px' ? false : true;\n          // expand to full size on dbl click if level is in small size\n          if (!isOpen) {\n            element.parent().parent().find('div')[3].click();\n          }\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined && viewState.getPermission('labelAction')) {\n            if (scope.levelType === 'SEGMENT') {\n              if (scope.lastEventClick.current.sampleStart >= viewState.curViewPort.sS) {\n                if (scope.lastEventClick.current.sampleStart + scope.lastEventClick.current.sampleDur <= viewState.curViewPort.eS) {\n                  viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n                  viewState.setcurClickItem(scope.lastEventClick.current);\n                  LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n                  LevelService.setlasteditAreaElem(element.parent());\n                  viewState.setEditing(true);\n                  LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n                } else {\n                }\n              } else {\n              }\n            } else {\n              viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n              viewState.setcurClickItem(scope.lastEventClick.current);\n              LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n              LevelService.setlasteditAreaElem(element.parent());\n              viewState.setEditing(true);\n              LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n              viewState.setEditing(true);\n            }\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.setLastMove = function (x, doChange) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (doChange) {\n            if (scope.lastEventMove.current !== undefined && scope.lastEventMove.nearest !== undefined) {\n              scope.lastNeighboursMove = LevelService.getItemNeighboursFromLevel(scope.levelName, scope.lastEventMove.nearest.id, scope.lastEventMove.nearest.id);\n              viewState.setcurMouseItem(scope.lastEventMove.nearest, scope.lastNeighboursMove, scope.lastPCM, scope.lastEventMove.isFirst, scope.lastEventMove.isLast);\n            }\n          }\n          viewState.setcurMouseLevelName(scope.levelName);\n          viewState.setcurMouseLevelType(scope.levelType);\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('handleglobalkeystrokes', [\n  '$timeout',\n  'viewState',\n  'modalService',\n  'HierarchyManipulationService',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'HistoryService',\n  'LevelService',\n  'DataService',\n  'LinkService',\n  'AnagestService',\n  function ($timeout, viewState, modalService, HierarchyManipulationService, Soundhandlerservice, ConfigProviderService, HistoryService, LevelService, DataService, LinkService, AnagestService) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element) {\n        $(document).bind('keyup', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          if (viewState.isEditing() && !viewState.getcursorInTextField()) {\n            scope.applyKeyCodeUp(code, e);\n          }\n        });\n        $(document).bind('keydown', function (e) {\n          if (!scope.firefox) {\n            var code = e.keyCode ? e.keyCode : e.which;\n            if (code == 8 || code == 9 || code == 27 || code == 37 || code == 38 || code == 39 || code == 40 || code == 32) {\n              scope.applyKeyCode(code, e);\n            }\n          }\n        });\n        $(document).bind('keypress', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          scope.applyKeyCode(code, e);\n        });\n        scope.applyKeyCodeUp = function (code, e) {\n          scope.$apply(function () {\n            if (code !== ConfigProviderService.vals.keyMappings.esc && code !== ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              var str = domElement.val();\n              viewState.setSavingAllowed(true);\n              var curAttrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n              var lvlDefs = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n              var definitions = {};\n              if (lvlDefs.attributeDefinitions !== undefined && lvlDefs.attributeDefinitions.length > 0) {\n                definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[curAttrIndex];\n              }\n              // if it is defined then check if characters are ok\n              if (definitions.legalLabels !== undefined && str.length > 0) {\n                if (definitions.legalLabels.indexOf(str) < 0) {\n                  viewState.setSavingAllowed(false);\n                }\n              }\n              if (viewState.isSavingAllowed()) {\n                domElement.css({ 'background-color': 'rgba(255,255,0,1)' });\n              } else {\n                domElement.css({ 'background-color': 'rgba(255,0,0,1)' });\n              }\n            }\n          });\n        };\n        scope.applyKeyCode = function (code, e) {\n          scope.$apply(function () {\n            // check if mouse has to be in labeler for key mappings\n            if (ConfigProviderService.vals.main.catchMouseForKeyBinding) {\n              if (!viewState.mouseInEmuWebApp) {\n                return;\n              }\n            }\n            viewState.setlastKeyCode(code);\n            // Handle key strokes for the hierarchy modal\n            if (viewState.hierarchyState.isShown() && viewState.hierarchyState !== undefined) {\n              if (viewState.hierarchyState.getInputFocus()) {\n                // Commit label change\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyCommitEdit) {\n                  var elementID = viewState.hierarchyState.getContextMenuID();\n                  var element = LevelService.getItemByID(elementID);\n                  var levelName = LevelService.getLevelName(elementID);\n                  var attrIndex = viewState.getCurAttrIndex(levelName);\n                  var legalLabels = ConfigProviderService.getLevelDefinition(levelName).attributeDefinitions[attrIndex].legalLabels;\n                  var newValue = viewState.hierarchyState.getEditValue();\n                  var oldValue;\n                  if (element.labels[attrIndex] !== undefined) {\n                    oldValue = element.labels[attrIndex].value;\n                  } else {\n                    oldValue = '';\n                  }\n                  if (newValue !== undefined && newValue !== oldValue) {\n                    // Check if new value is legal\n                    if (legalLabels === undefined || newValue.length > 0 && legalLabels.indexOf(newValue) >= 0) {\n                      LevelService.renameLabel(levelName, elementID, attrIndex, newValue);\n                      HistoryService.addObjToUndoStack({\n                        'type': 'ANNOT',\n                        'action': 'RENAMELABEL',\n                        'name': levelName,\n                        'id': elementID,\n                        'attrIndex': attrIndex,\n                        'oldValue': oldValue,\n                        'newValue': newValue\n                      });\n                      viewState.hierarchyState.closeContextMenu();\n                    }\n                  } else {\n                    viewState.hierarchyState.closeContextMenu();\n                  }\n                }\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyCancelEdit) {\n                  viewState.hierarchyState.closeContextMenu();\n                }\n              } else {\n                //if (!e.metaKey && !e.ctrlKey) {\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyDeleteLink) {\n                  e.preventDefault();\n                }\n                // Play selected item\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyPlayback) {\n                  e.preventDefault();\n                  viewState.hierarchyState.playing += 1;\n                  console.log('hierarchyPlayback');\n                }\n                // rotateHierarchy\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyRotate) {\n                  viewState.hierarchyState.toggleRotation();\n                }\n                // Delete link\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyDeleteLink) {\n                  /*\n\t\t\t\t\t\t\t\t\t This block is currently obsoleted because e.preventDefault() is called above\n\t\t\t\t\t\t\t\t\t at the beginning of the hierarchy block\n\t\t\t\t\t\t\t\t\t // This should only be called when certain keys are pressed that are known to trigger some browser behaviour.\n\t\t\t\t\t\t\t\t\t // But what if the key code is reconfigured (possibly by the user)?\n\t\t\t\t\t\t\t\t\t e.preventDefault();\n\t\t\t\t\t\t\t\t\t */\n                  var pos = LinkService.deleteLink(viewState.hierarchyState.selectedLinkFromID, viewState.hierarchyState.selectedLinkToID);\n                  if (pos !== -1) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'DELETELINK',\n                      fromID: viewState.hierarchyState.selectedLinkFromID,\n                      toID: viewState.hierarchyState.selectedLinkToID,\n                      position: pos\n                    });\n                  }\n                }\n                // Delete item\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyDeleteItem) {\n                  var result = LevelService.deleteItemWithLinks(viewState.hierarchyState.selectedItemID);\n                  if (result.item !== undefined) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'DELETEITEM',\n                      item: result.item,\n                      levelName: result.levelName,\n                      position: result.position,\n                      deletedLinks: result.deletedLinks\n                    });\n                  }\n                }\n                // Add item ...\n                // ... before the currently selected one\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyAddItemBefore) {\n                  var newID = LevelService.addItem(viewState.hierarchyState.selectedItemID, true);\n                  if (newID !== -1) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'ADDITEM',\n                      newID: newID,\n                      neighborID: viewState.hierarchyState.selectedItemID,\n                      before: true\n                    });\n                  }\n                }\n                // ... after the currently selected one\n                if (code === ConfigProviderService.vals.keyMappings.hierarchyAddItemAfter) {\n                  var newID = LevelService.addItem(viewState.hierarchyState.selectedItemID, false);\n                  if (newID !== -1) {\n                    HistoryService.addObjToUndoStack({\n                      type: 'HIERARCHY',\n                      action: 'ADDITEM',\n                      newID: newID,\n                      neighborID: viewState.hierarchyState.selectedItemID,\n                      before: false\n                    });\n                  }\n                }\n                /* Add link\n\t\t\t\t\t\t\t\t if (code === ConfigProviderService.vals.keyMappings.hierarchyAddLink) {\n\t\t\t\t\t\t\t\t if (viewState.hierarchyState.newLinkFromID === undefined) {\n\t\t\t\t\t\t\t\t viewState.hierarchyState.newLinkFromID = viewState.hierarchyState.selectedItemID;\n\t\t\t\t\t\t\t\t } else {\n\t\t\t\t\t\t\t\t var linkObj = HierarchyManipulationService.addLink(viewState.hierarchyState.path, viewState.hierarchyState.newLinkFromID, viewState.hierarchyState.selectedItemID);\n\t\t\t\t\t\t\t\t viewState.hierarchyState.newLinkFromID = undefined;\n\t\t\t\t\t\t\t\t if (linkObj !== null) {\n\t\t\t\t\t\t\t\t HistoryService.addObjToUndoStack({\n\t\t\t\t\t\t\t\t type: 'HIERARCHY',\n\t\t\t\t\t\t\t\t action: 'ADDLINK',\n\t\t\t\t\t\t\t\t link: linkObj\n\t\t\t\t\t\t\t\t });\n\t\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t\t }*/\n                // undo\n                if (code === ConfigProviderService.vals.keyMappings.undo) {\n                  HistoryService.undo();\n                }\n                // redo\n                if (code === ConfigProviderService.vals.keyMappings.redo) {\n                  HistoryService.redo();\n                }\n                // close modal\n                if (!e.shiftKey && (code === ConfigProviderService.vals.keyMappings.esc || code === ConfigProviderService.vals.keyMappings.showHierarchy)) {\n                  modalService.close();\n                }\n              }\n            } else if (viewState.isEditing()) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              // preventing new line if saving not allowed\n              if (!viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())].legalLabels;\n                e.preventDefault();\n                e.stopPropagation();\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                modalService.open('views/error.html', 'Editing Error: Sorry, characters allowed on this Level are \"' + JSON.stringify(definitions) + '\"');\n              }\n              // save text on enter if saving is allowed\n              if (viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var editingElement = LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID());\n                var attrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n                var oldValue = '';\n                if (editingElement.labels[attrIndex] !== undefined) {\n                  oldValue = editingElement.labels[attrIndex].value;\n                }\n                LevelService.renameLabel(viewState.getcurClickLevelName(), LevelService.getlastID(), viewState.getCurAttrIndex(viewState.getcurClickLevelName()), domElement.val());\n                HistoryService.addObjToUndoStack({\n                  'type': 'ANNOT',\n                  'action': 'RENAMELABEL',\n                  'name': viewState.getcurClickLevelName(),\n                  'id': LevelService.getlastID(),\n                  'attrIndex': attrIndex,\n                  'oldValue': oldValue,\n                  'newValue': domElement.val()\n                });\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                viewState.setcurClickItem(LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID()));\n              }\n              // escape from text if esc\n              if (code === ConfigProviderService.vals.keyMappings.esc) {\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n              }\n            } else if (viewState.getcursorInTextField() === false) {\n              LevelService.deleteEditArea();\n              // escape from open modal dialog\n              //\n              if (viewState.curState.permittedActions.length === 0 && code === ConfigProviderService.vals.keyMappings.esc && modalService.force === false) {\n                modalService.close();\n              }\n              // delegate keyboard keyMappings according to keyMappings of scope\n              // showHierarchy\n              if (code === ConfigProviderService.vals.keyMappings.showHierarchy && ConfigProviderService.vals.activeButtons.showHierarchy) {\n                if (viewState.curState !== viewState.states.noDBorFilesloaded) {\n                  if (viewState.hierarchyState.isShown()) {\n                    modalService.close();\n                  } else {\n                    viewState.hierarchyState.toggleHierarchy();\n                    modalService.open('views/showHierarchyModal.html');\n                  }\n                }\n              }\n              // zoomAll\n              if (code === ConfigProviderService.vals.keyMappings.zoomAll) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n                } else {\n                }\n              }\n              // zoomIn\n              if (code === ConfigProviderService.vals.keyMappings.zoomIn) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(true, LevelService);\n                } else {\n                }\n              }\n              // zoomOut\n              if (code === ConfigProviderService.vals.keyMappings.zoomOut) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(false, LevelService);\n                } else {\n                }\n              }\n              // zoomSel\n              if (code === ConfigProviderService.vals.keyMappings.zoomSel) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                } else {\n                }\n              }\n              // shiftViewPortLeft\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortLeft) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(false);\n                } else {\n                }\n              }\n              // shiftViewPortRight\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortRight) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(true);\n                } else {\n                }\n              }\n              // playEntireFile\n              if (code === ConfigProviderService.vals.keyMappings.playEntireFile) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n                    viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n                  }\n                } else {\n                }\n              }\n              // playAllInView\n              if (code === ConfigProviderService.vals.keyMappings.playAllInView) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                    viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                  }\n                } else {\n                }\n              }\n              // playSelected\n              if (code === ConfigProviderService.vals.keyMappings.playSelected) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                    viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                  }\n                } else {\n                }\n              }\n              // selectFirstContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFirstContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 1;\n                  }\n                }\n              }\n              // selectSecondContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectSecondContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 2;\n                  }\n                }\n              }\n              // selectThirdContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectThirdContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 3;\n                  }\n                }\n              }\n              // selectFourthContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFourthContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 4;\n                  }\n                }\n              }\n              // selectNOContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectNoContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = undefined;\n                  }\n                }\n              }\n              // levelUp\n              if (code === ConfigProviderService.vals.keyMappings.levelUp) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n                }\n              }\n              // levelDown\n              if (code === ConfigProviderService.vals.keyMappings.levelDown) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(true, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass LevelService to prevent circular deps\n                }\n              }\n              // preselected boundary snap to top\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestTopBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(true, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist === false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary snap to bottom\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestBottomBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(false, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist == false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary to nearest zero crossing\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestZeroCrossing) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var dist;\n                    if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().sampleStart);\n                    } else {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().samplePoint);\n                    }\n                    if (dist !== 0) {\n                      var seg = viewState.getcurMouseItem();\n                      var neigh = viewState.getcurMouseNeighbours();\n                      var levelname = viewState.getcurMouseLevelName();\n                      LevelService.moveBoundary(levelname, seg.id, dist, 0);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEBOUNDARY',\n                        'name': levelname,\n                        'id': seg.id,\n                        'movedBy': dist,\n                        'position': 0\n                      });\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // expand Segments\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // expand Segment left\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Left\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Right\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarLeft) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.toggleSubmenu(ConfigProviderService.design.animation.period);\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarRight) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n                  }\n                }\n              }\n              // select Segments in viewport selection\n              if (code === ConfigProviderService.vals.keyMappings.selectItemsInSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickLevelName() === undefined) {\n                    modalService.open('views/error.html', 'Selection Error : Please select a Level first');\n                  } else {\n                    viewState.curClickItems = [];\n                    var prev = null;\n                    angular.forEach(viewState.getItemsInSelection(DataService.data.levels), function (item) {\n                      if (prev === null) {\n                        viewState.setcurClickItem(item);\n                      } else {\n                        viewState.setcurClickItemMultiple(item, prev);\n                      }\n                      prev = item;\n                    });\n                    viewState.selectBoundary();\n                  }\n                }\n              }\n              // selPrevItem (arrow key left)\n              if (code === ConfigProviderService.vals.keyMappings.selPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), viewState.getcurClickItems()[0].id, viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id);\n                    var neighbours = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), lastNeighboursMove.left.id, lastNeighboursMove.left.id);\n                    if (lastNeighboursMove.left !== undefined) {\n                      if (lastNeighboursMove.left.sampleStart !== undefined) {\n                        // check if in view\n                        if (lastNeighboursMove.left.sampleStart > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left, neighbours.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                          viewState.selectBoundary();\n                        }\n                      } else {\n                        // check if in view\n                        if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left, neighbours.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                          viewState.selectBoundary();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // selNextItem (arrow key right)\n              if (code === ConfigProviderService.vals.keyMappings.selNextItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), viewState.getcurClickItems()[0].id, viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id);\n                    var neighbours = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), lastNeighboursMove.right.id, lastNeighboursMove.right.id);\n                    if (lastNeighboursMove.right !== undefined) {\n                      if (lastNeighboursMove.right.sampleStart !== undefined) {\n                        // check if in view\n                        if (lastNeighboursMove.right.sampleStart + lastNeighboursMove.right.sampleDur < viewState.curViewPort.eS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.right, neighbours.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                          viewState.selectBoundary();\n                        }\n                      } else {\n                        // check if in view\n                        if (lastNeighboursMove.right.samplePoint < viewState.curViewPort.eS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.right, neighbours.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                          viewState.selectBoundary();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // selNextPrevItem (tab key and tab+shift key)\n              if (code === ConfigProviderService.vals.keyMappings.selNextPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (e.shiftKey) {\n                      if (lastNeighboursMove.left !== undefined) {\n                        if (lastNeighboursMove.left.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.left.sampleStart >= viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.left.samplePoint >= viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    } else {\n                      if (lastNeighboursMove.right !== undefined) {\n                        if (lastNeighboursMove.right.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.right.sampleStart + lastNeighboursMove.right.sampleDur <= viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.right.samplePoint < viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // createNewItemAtSelection\n              if (code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                // auto action in model when open and user presses 'enter'\n                if (modalService.isOpen) {\n                  modalService.confirmContent();\n                } else {\n                  if (viewState.curClickLevelIndex === undefined) {\n                    modalService.open('views/error.html', 'Modify Error: Please select a Segment or Event Level first.');\n                  } else {\n                    if (viewState.getPermission('labelAction')) {\n                      if (ConfigProviderService.vals.restrictions.addItem) {\n                        if (viewState.getselectedRange().start === viewState.curViewPort.selectS && viewState.getselectedRange().end === viewState.curViewPort.selectE) {\n                          if (viewState.getcurClickItems().length === 1) {\n                            // check if in view\n                            if (viewState.getselectedRange().start >= viewState.curViewPort.sS && viewState.getselectedRange().end <= viewState.curViewPort.eS) {\n                              viewState.setEditing(true);\n                              LevelService.openEditArea(viewState.getcurClickItems()[0], LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                              scope.cursorInTextField();\n                            }\n                          } else {\n                            modalService.open('views/error.html', 'Modify Error: Please select a single Segment.');\n                          }\n                        } else {\n                          if (viewState.curViewPort.selectE == -1 && viewState.curViewPort.selectS == -1) {\n                            modalService.open('views/error.html', 'Error : Please select a Segment or Point to modify it\\'s name. Or select a level plus a range in the viewport in order to insert a new Segment.');\n                          } else {\n                            var seg = LevelService.getClosestItem(viewState.curViewPort.selectS, viewState.getcurClickLevelName(), Soundhandlerservice.wavJSO.Data.length).current;\n                            if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                              if (seg === undefined) {\n                                var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                                if (!insSeg.ret) {\n                                  modalService.open('views/error.html', 'Error : You are not allowed to insert a Segment here.');\n                                } else {\n                                  HistoryService.addObjToUndoStack({\n                                    'type': 'ANNOT',\n                                    'action': 'INSERTSEGMENTS',\n                                    'name': viewState.getcurClickLevelName(),\n                                    'start': viewState.curViewPort.selectS,\n                                    'end': viewState.curViewPort.selectE,\n                                    'ids': insSeg.ids,\n                                    'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                                  });\n                                }\n                              } else {\n                                if (seg.sampleStart === viewState.curViewPort.selectS && seg.sampleStart + seg.sampleDur + 1 === viewState.curViewPort.selectE) {\n                                  LevelService.setlasteditArea('_' + seg.id);\n                                  LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                                  viewState.setEditing(true);\n                                } else {\n                                  var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                                  if (!insSeg.ret) {\n                                    modalService.open('views/error.html', 'Error : You are not allowed to insert a Segment here.');\n                                  } else {\n                                    HistoryService.addObjToUndoStack({\n                                      'type': 'ANNOT',\n                                      'action': 'INSERTSEGMENTS',\n                                      'name': viewState.getcurClickLevelName(),\n                                      'start': viewState.curViewPort.selectS,\n                                      'end': viewState.curViewPort.selectE,\n                                      'ids': insSeg.ids,\n                                      'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                                    });\n                                  }\n                                }\n                              }\n                            } else {\n                              var levelDef = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n                              if (typeof levelDef.anagestConfig === 'undefined') {\n                                var insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, ConfigProviderService.vals.labelCanvasConfig.newEventName);\n                                if (insPoint.alreadyExists) {\n                                  LevelService.setlasteditArea('_' + seg.id);\n                                  LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                                  viewState.setEditing(true);\n                                } else {\n                                  HistoryService.addObjToUndoStack({\n                                    'type': 'ANNOT',\n                                    'action': 'INSERTEVENT',\n                                    'name': viewState.getcurClickLevelName(),\n                                    'start': viewState.curViewPort.selectS,\n                                    'id': insPoint.id,\n                                    'pointName': ConfigProviderService.vals.labelCanvasConfig.newEventName\n                                  });\n                                }\n                              } else {\n                                AnagestService.insertAnagestEvents();\n                              }\n                            }\n                          }\n                        }\n                      } else {\n                      }\n                    }\n                  }\n                }\n              }\n              // undo\n              if (code === ConfigProviderService.vals.keyMappings.undo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.undo();\n                }\n              }\n              // redo\n              if (code === ConfigProviderService.vals.keyMappings.redo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.redo();\n                }\n              }\n              // deletePreselBoundary\n              if (code === ConfigProviderService.vals.keyMappings.deletePreselBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  e.preventDefault();\n                  var seg = viewState.getcurMouseItem();\n                  var cseg = viewState.getcurClickItems();\n                  var isFirst = viewState.getcurMouseisFirst();\n                  var isLast = viewState.getcurMouseisLast();\n                  var levelname = viewState.getcurMouseLevelName();\n                  var type = viewState.getcurMouseLevelType();\n                  if (!e.shiftKey) {\n                    if (ConfigProviderService.vals.restrictions.deleteItemBoundary) {\n                      if (seg !== undefined) {\n                        var neighbour = LevelService.getItemNeighboursFromLevel(levelname, seg.id, seg.id);\n                        if (type === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteBoundary(levelname, seg.id, isFirst, isLast);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETEBOUNDARY',\n                            'name': levelname,\n                            'id': seg.id,\n                            'isFirst': isFirst,\n                            'isLast': isLast,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks;\n                          if (neighbour.left !== undefined) {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, neighbour.left.id);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': neighbour.left.id,\n                              'deletedLinks': deletedLinks\n                            });\n                          } else {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, -1);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': -1,\n                              'deletedLinks': deletedLinks\n                            });\n                          }\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          var deletedPoint = LevelService.deleteEvent(levelname, seg.id);\n                          if (deletedPoint !== false) {\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETEEVENT',\n                              'name': levelname,\n                              'start': deletedPoint.samplePoint,\n                              'id': deletedPoint.id,\n                              'pointName': deletedPoint.labels[0].value\n                            });\n                            HistoryService.addCurChangeObjToUndoStack();\n                            var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                            if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                              var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                              viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                            }\n                          } else {\n                            viewState.setcurMouseItem(undefined, undefined, undefined, undefined, undefined);\n                          }\n                        }\n                      }\n                    }\n                  } else {\n                    if (ConfigProviderService.vals.restrictions.deleteItem) {\n                      if (cseg !== undefined && cseg.length > 0) {\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteSegments(levelname, cseg[0].id, cseg.length);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETESEGMENTS',\n                            'name': levelname,\n                            'id': cseg[0].id,\n                            'length': cseg.length,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks = LinkService.deleteLinkSegment(cseg);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETELINKSEGMENT',\n                            'name': levelname,\n                            'segments': cseg,\n                            'deletedLinks': deletedLinks\n                          });\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          modalService.open('views/error.html', 'Delete Error: You can not delete Segments on Point Levels.');\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              if (!e.metaKey && !e.ctrlKey) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }\n          });\n        };\n        scope.safeApply = function (fn) {\n          var phase = this.$root.$$phase;\n          if (phase == '$apply' || phase == '$digest') {\n            if (fn && typeof fn === 'function') {\n              fn();\n            }\n          } else {\n            this.$apply(fn);\n          }\n        };\n        //remove binding on destroy\n        scope.$on('$destroy', function () {\n          $(window).off('keydown');\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('delete', [\n  'modalService',\n  function (modalService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(scope.level.name, attr.delete);\n          scope.vs.setcurClickLevel(scope.level.name, scope.level.type, scope.order);\n          modalService.open('views/deleteLevel.html', scope.level.name);\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('resize', [\n  'LevelService',\n  'viewState',\n  function (LevelService, viewState) {\n    return {\n      restrict: 'A',\n      link: function (scope, element) {\n        var elem = element.parent().parent();\n        var elemHeight = 0;\n        var deleteButton = elem.find(element.parent().children()[0]);\n        var resizeButton = elem.find(element.parent().children()[1]);\n        var saveButton = elem.find(element.parent().children()[2]);\n        element.bind('click', function () {\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          if (scope.open) {\n            scope.open = false;\n            elemHeight = elem.css('height');\n            elem.css({ 'height': '25px' });\n            if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n              deleteButton.hide();\n            }\n            if (scope.cps.vals.activeButtons.saveSingleLevel) {\n              saveButton.hide();\n            }\n          } else {\n            scope.open = true;\n            elem.css({ 'height': elemHeight });\n            if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n              deleteButton.show();\n            }\n            if (scope.cps.vals.activeButtons.saveSingleLevel) {\n              saveButton.show();\n            }\n          }\n          scope.updateView();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('enlarge', [\n  '$rootScope',\n  'viewState',\n  'ConfigProviderService',\n  function ($rootScope, viewState, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attrs) {\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          if (!$.isEmptyObject(ConfigProviderService.vals.perspectives)) {\n            if (!$.isEmptyObject(viewState.curPerspectiveIdx)) {\n              if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length === 1) {\n                element.hide();\n              } else {\n                element.show();\n              }\n            }\n          }\n        }, true);\n        var open = false;\n        element.bind('click', function () {\n          if (open) {\n            open = false;\n            viewState.setenlarge(-1);\n          } else {\n            open = true;\n            viewState.setenlarge(attrs.enlarge);\n          }\n          $rootScope.$apply();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('save', [\n  'modalService',\n  'Espsparserservice',\n  function (modalService, Espsparserservice) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(scope.level.name, attr.save);\n          Espsparserservice.asyncParseJSO(scope.level.name).then(function (result) {\n            modalService.open('views/export.html', name + '_esps.txt', result);\n          });\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('slideToggle', function () {\n  return {\n    restrict: 'A',\n    scope: { isOpen: '=slideToggle' },\n    link: function (scope, element, attr) {\n      var slideDuration = parseInt(attr.slideToggleDuration, 10) || 200;\n      // trigger a slideToggle at initialization\n      if (scope.isOpen) {\n      } else {\n        element.stop().slideToggle(0);\n      }\n      // Watch for when the value bound to isOpen changes\n      // When it changes trigger a slideToggle\n      scope.$watch('isOpen', function (newIsOpenVal, oldIsOpenVal) {\n        if (newIsOpenVal !== oldIsOpenVal) {\n          element.stop().slideToggle(slideDuration);\n        }\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('previewtrack', [\n  'viewState',\n  'Soundhandlerservice',\n  function (viewState, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element) {\n        var startPCM = -1;\n        ///////////////\n        // bindings\n        element.bind('click', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n            if (startPCM - width / 2 < 0) {\n              startPCM = Math.ceil(width / 2);\n            } else if (startPCM + width / 2 > Soundhandlerservice.wavJSO.Data.length) {\n              startPCM = Math.floor(Soundhandlerservice.wavJSO.Data.length - width / 2);\n            }\n            if (!viewState.isEditing()) {\n              scope.$apply(function () {\n                viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n              });\n            }\n          }\n        });\n        //\n        element.bind('mousedown', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n          }\n        });\n        //\n        element.bind('mousemove', function (x) {\n          var mbutton = 0;\n          if (x.buttons === undefined) {\n            mbutton = x.which;\n          } else {\n            mbutton = x.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            if (startPCM !== -1) {\n              var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n              startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n              if (!viewState.isEditing()) {\n                scope.$apply(function () {\n                  viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n                });\n              }\n            }\n            break;\n          }\n        });\n        //\n        element.bind('mouseup', function () {\n          startPCM = -1;\n        });\n        //\n        element.bind('mouseout', function () {\n          startPCM = -1;\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Iohandlerservice', [\n  '$rootScope',\n  '$http',\n  '$location',\n  '$q',\n  'HistoryService',\n  'viewState',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Espsparserservice',\n  'Ssffdataservice',\n  'Websockethandler',\n  'DragnDropDataService',\n  function Iohandlerservice($rootScope, $http, $location, $q, HistoryService, viewState, Soundhandlerservice, Ssffparserservice, Wavparserservice, Textgridparserservice, ConfigProviderService, Espsparserservice, Ssffdataservice, Websockethandler, DragnDropDataService) {\n    // shared service object\n    var sServObj = {};\n    // $http.defaults.useXDomain = true;\n    sServObj.wsH = Websockethandler;\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultConfig = function () {\n      var prom = $http.get('configFiles/default_emuwebappConfig.json');\n      return prom;\n    };\n    /**\n\t\t * default design is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultDesign = function () {\n      var prom = $http.get('configFiles/default_emuwebappDesign.json');\n      return prom;\n    };\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetPath = function (path, respType) {\n      var prom = $http.get(path, { responseType: respType });\n      return prom;\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    /**\n\t\t *\n\t\t */\n    sServObj.getProtocol = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getProtocol not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getProtocol();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDoUserManagement = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDoUserManagement not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDoUserManagement();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.logOnUser = function (name, pwd) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of logOnUser not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.logOnUser(name, pwd);\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDBconfigFile = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDBconfigFile not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDBconfigFile();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_DBconfig.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundleList = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundleList not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundleList();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_bundleList.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundle = function (name, session, nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'EMBEDDED') {\n        getProm = DragnDropDataService.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + name + '_bndl.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.saveBundle = function (bundleData) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of saveBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.saveBundle(bundleData);\n      }\n      // else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n      // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n      // \tgetProm = $http.get('testData/testAeBundle.json'); // SIC SIC SIC HARDCODED -> name is ignored\n      // }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.saveConfiguration = function (configData) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of saveBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.saveConfiguration(configData);\n      }\n      return getProm;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    /**\n\t\t * pass through to according parser\n\t\t */\n    sServObj.parseLabelFile = function (string, annotates, name, fileType) {\n      var prom;\n      if (fileType === 'ESPS') {\n        prom = Espsparserservice.asyncParseEsps(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedESPS');\n      } else if (fileType === 'TEXTGRID') {\n        prom = Textgridparserservice.asyncParseTextGrid(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTEXTGRID');\n      } else if (fileType === 'annotJSON') {\n        var def = $q.defer();\n        prom = def.promise;\n        def.resolve(angular.fromJson(string));\n      }\n      return prom;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Soundhandlerservice', [\n  '$document',\n  function Soundhandlerservice($document) {\n    // private vars\n    var audioContext;\n    var curSource;\n    // shared service object\n    var sServObj = {};\n    // public vars\n    sServObj.wavJSO = {};\n    sServObj.isPlaying = false;\n    ///////////////////////////////////////////\n    // private API\n    /**\n\t\t * safely initialize audio context\n\t\t * */\n    function initAudioContext() {\n      try {\n        window.AudioContext = window.AudioContext || window.webkitAudioContext;\n        audioContext = new AudioContext();\n      } catch (e) {\n        alert('Error loading the AudioContext (could mean your browser doesn\\'t support the HTML5 webaudio API):' + e);\n      }\n    }\n    ///////////////////////////////////////////\n    // public API\n    /**\n\t\t * decode and play a passed in buffer\n\t\t *\n\t\t * @param buffer arraybuffer containing audio file (as returned by XHR for example)\n\t\t * */\n    sServObj.decodeAndPlay = function (buffer) {\n      if (typeof audioContext == 'undefined') {\n        initAudioContext();\n      }\n      audioContext.decodeAudioData(buffer, function (ab) {\n        curSource = audioContext.createBufferSource();\n        curSource.buffer = ab;\n        curSource.connect(audioContext.destination);\n        curSource.start(0);\n        curSource.onended = function () {\n          sServObj.isPlaying = false;\n        };\n      }, function (e) {\n        alert(e);\n      });\n    };\n    /**\n\t\t * Creates new ArrayBuffer containing wav file that goes\n\t\t * from sampleStart to endSample\n\t\t *\n\t\t * @param sampleStart number that represents start sample\n\t\t * @paramn endSample number that represents end sample\n\t\t * @returns ArrayBuffer containing wav file\n\t\t * */\n    sServObj.extractRelPartOfWav = function (sampleStart, endSample) {\n      var bytePerSample = sServObj.wavJSO.BitsPerSample / 8;\n      var headerSize = 44;\n      if (sServObj.wavJSO.Subchunk1Size == 18) {\n        headerSize = 46;\n      }\n      var header = sServObj.wavJSO.origArrBuf.subarray(0, headerSize);\n      var data = sServObj.wavJSO.origArrBuf.subarray(headerSize, sServObj.wavJSO.Data.length * bytePerSample);\n      var dv = new DataView(header);\n      var Subchunk2SizePos = 40;\n      if (sServObj.wavJSO.Subchunk1Size == 18) {\n        Subchunk2SizePos = 42;\n      }\n      dv.setUint32(Subchunk2SizePos, (endSample - sampleStart) * bytePerSample, true);\n      // var Subchunk2Size = dv.getUint32(40, true);\n      // console.log(Subchunk2Size);\n      var newData = data.subarray(sampleStart * bytePerSample, (endSample - sampleStart) * bytePerSample);\n      var tmp = new Uint8Array(header.byteLength + newData.byteLength);\n      tmp.set(new Uint8Array(header), 0);\n      tmp.set(new Uint8Array(newData), header.byteLength);\n      return tmp.buffer;\n    };\n    /**\n\t\t * play audio from to specified in samples\n\t\t *\n\t\t * @param sampleStart number that represents start sample\n\t\t * @param endSample number that represents end sample\n\t\t * */\n    sServObj.playFromTo = function (sampleStart, endSample) {\n      var cutWavBuff = this.extractRelPartOfWav(sampleStart, endSample);\n      if (sServObj.isPlaying) {\n        sServObj.isPlaying = false;\n        curSource.stop(0);\n      } else {\n        sServObj.isPlaying = true;\n        if (cutWavBuff.byteLength > 44) {\n          // if wav file is bigger than just the header (a.k.a. data block is empty)\n          sServObj.decodeAndPlay(cutWavBuff);\n        }\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('drawssff', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'HistoryService',\n  'fontScaleService',\n  'loadedMetaDataService',\n  function ($timeout, viewState, ConfigProviderService, Ssffdataservice, HistoryService, fontScaleService, loadedMetaDataService) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function postLink(scope, element, atts) {\n        scope.trackName = atts.ssffTrackname;\n        scope.assTrackName = '';\n        scope.lastDraw = Date.now();\n        // add watch vars to scope\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.ssffds = Ssffdataservice;\n        scope.cps = ConfigProviderService;\n        scope.lmds = loadedMetaDataService;\n        ////////////////////\n        // observes\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          scope.trackName = val;\n        });\n        ////////////////////\n        // watches\n        //watch viewPort change\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n            scope.handleUpdate();\n          }\n          if (oldValue.windowWidth !== newValue.windowWidth) {\n            scope.handleUpdate();\n          }\n          if (oldValue.dragBarHeight !== newValue.dragBarHeight) {\n            scope.handleUpdate();\n          }\n        }, true);\n        //watch perspective change\n        scope.$watch('vs.curPerspectiveIdx', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch vs.curCorrectionToolNr change\n        scope.$watch('vs.curCorrectionToolNr', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch hists.\n        scope.$watch('hists.movesAwayFromLastSave', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch ssffds.data change\n        scope.$watch('ssffds.data.length', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch vs.spectroSettings change\n        scope.$watch('vs.spectroSettings', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //\n        scope.$watch('vs.submenuOpen', function (oldValue, newValue) {\n          if (oldValue !== newValue) {\n            $timeout(scope.handleUpdate, ConfigProviderService.design.animation.duration);\n          }\n        });\n        //\n        scope.$watch('vs.timelineSize', function (oldValue, newValue) {\n          if (oldValue !== newValue) {\n            $timeout(scope.handleUpdate, ConfigProviderService.design.animation.duration / 10);\n          }\n        });\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n            scope.handleUpdate();\n          }\n        }, true);\n        //\n        //////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.handleUpdate = function () {\n          var ctx = element[0].getContext('2d');\n          ctx.clearRect(0, 0, element[0].width, element[0].height);\n          if (!$.isEmptyObject(Ssffdataservice.data)) {\n            if (Ssffdataservice.data.length !== 0) {\n              scope.assTrackName = '';\n              // check assignments (= overlays)\n              ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign.forEach(function (ass, i) {\n                if (ass.signalCanvasName === scope.trackName) {\n                  scope.assTrackName = ass.ssffTrackName;\n                  var tr = ConfigProviderService.getSsffTrackConfig(ass.ssffTrackName);\n                  var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                  var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                  // draw values\n                  scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n                }\n              });\n              scope.assTrackName = '';\n              // draw ssffTrack onto own canvas\n              if (scope.trackName !== 'OSCI' && scope.trackName !== 'SPEC') {\n                var tr = ConfigProviderService.getSsffTrackConfig(scope.trackName);\n                var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                // draw values\n                scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n              }\n            }\n          } else {\n            ctx.clearRect(0, 0, element[0].width, element[0].height);\n          }\n        };\n        /**\n\t\t\t\t * draw values onto canvas\n\t\t\t\t */\n        scope.drawValues = function (viewState, canvas, config, col, sR, sT, minMaxLims) {\n          var ctx = canvas.getContext('2d');\n          var minVal, maxVal;\n          if (scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n            minVal = viewState.spectroSettings.rangeFrom;\n            maxVal = viewState.spectroSettings.rangeTo;\n          } else {\n            minVal = col._minVal;\n            maxVal = col._maxVal;\n          }\n          var startTimeVP = viewState.getViewPortStartTime();\n          var endTimeVP = viewState.getViewPortEndTime();\n          var colStartSampleNr = Math.round(startTimeVP * sR + sT);\n          var colEndSampleNr = Math.round(endTimeVP * sR + sT);\n          var nrOfSamples = colEndSampleNr - colStartSampleNr;\n          var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n          if (nrOfSamples < canvas.width && nrOfSamples >= 2) {\n            var x, y, prevX, prevY, prevVal, curSampleInCol, curSampleInColTime;\n            ////////////////////////////////\n            // NEW VERSION\n            ////////////////////////////////\n            angular.forEach(curSampleArrs[0], function (contourVal, contourNr) {\n              // console.log(contourNr);\n              if ($.isEmptyObject(minMaxLims) || contourNr >= minMaxLims.minContourIdx && contourNr <= minMaxLims.maxContourIdx) {\n                // set color\n                if ($.isEmptyObject(minMaxLims)) {\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                } else {\n                  var l = minMaxLims.maxContourIdx - minMaxLims.minContourIdx + 1;\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                }\n                // overwrite color settings if they are preconfigured\n                var contColors = ConfigProviderService.getContourColorsOfTrack(scope.assTrackName);\n                if (contColors !== undefined) {\n                  if (contColors.colors[contourNr] !== undefined) {\n                    ctx.strokeStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                    ctx.fillStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                  }\n                }\n                // mark selected\n                // console.log(viewState.curCorrectionToolNr);\n                if (viewState.curCorrectionToolNr - 1 === contourNr && scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n                  ctx.strokeStyle = ConfigProviderService.design.color.green;\n                  ctx.fillStyle = ConfigProviderService.design.color.green;\n                }\n                ctx.beginPath();\n                // first line from sample not in view (left)\n                if (colStartSampleNr >= 1) {\n                  var leftBorder = col.values[colStartSampleNr - 1];\n                  var leftVal = leftBorder[contourNr];\n                  curSampleInCol = colStartSampleNr - 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (leftVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.moveTo(x, y);\n                }\n                angular.forEach(curSampleArrs, function (curArr, curArrIdx) {\n                  // console.log(curArr[contourNr]);\n                  curSampleInCol = colStartSampleNr + curArrIdx;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (curArr[contourNr] - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                  ctx.lineTo(x, y);\n                });\n                // last line from sample not in view (right)\n                if (colEndSampleNr < col.values.length - 1) {\n                  var rightBorder = col.values[colEndSampleNr + 1];\n                  var rightVal = rightBorder[contourNr];\n                  curSampleInCol = colEndSampleNr + 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (rightVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.lineTo(x, y);\n                }\n                ctx.stroke();  // ctx.fill();\n              }\n            });\n          } else {\n            ctx.strokeStyle = 'red';\n            if (nrOfSamples <= 2) {\n              fontScaleService.drawUndistortedTextTwoLines(ctx, 'Zoom out to', 'see contour(s)', ConfigProviderService.design.font.small.size.slice(0, -2) / 1.05, ConfigProviderService.design.font.small.family, canvas.width / 2 - ctx.measureText('see contour(s)').width * ctx.canvas.width / ctx.canvas.offsetWidth / 2, 25, ConfigProviderService.design.color.transparent.red);\n            } else {\n              fontScaleService.drawUndistortedTextTwoLines(ctx, 'Zoom in to', 'see contour(s)', ConfigProviderService.design.font.small.size.slice(0, -2) / 1.05, ConfigProviderService.design.font.small.family, canvas.width / 2 - ctx.measureText('see contour(s)').width * ctx.canvas.width / ctx.canvas.offsetWidth / 2, 25, ConfigProviderService.design.color.transparent.red);\n            }\n          }\n        }  //function\n;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffparserservice', [\n  '$q',\n  function Ssffparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new ssffParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e);\n      } else {\n        defer.reject(e);\n      }\n    }, false);\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseSsffArr = function (ssffArray) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseArr',\n        'ssffArr': ssffArray\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * convert jso to ssff binary file using webworker\n\t\t * @param java script object of ssff file (internal rep)\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncJso2ssff = function (jso) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'jso2ssff',\n        'jso': JSON.stringify(jso)\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('mouseTrackAndCorrectionTool', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'Drawhelperservice',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, Drawhelperservice, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element, atts) {\n        var curMouseSample;\n        var canvas = element[0];\n        var ctx = canvas.getContext('2d');\n        var tr, col, sRaSt;\n        var trackName;\n        var bundleName;\n        /////////////////////////////\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        // bundleName needed to reset tr, col, sRaSt on bundle change\n        atts.$observe('bundleName', function (val) {\n          if (val) {\n            bundleName = val;\n            if (!$.isEmptyObject(Ssffdataservice.data)) {\n              if (Ssffdataservice.data.length !== 0) {\n                tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                if (tr !== undefined) {\n                  col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                }\n              }\n            }\n          }\n        });\n        /////////////////////////////\n        // Bindings\n        element.bind('mousedown', function (event) {\n          viewState.curViewPort.movingS = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          viewState.curViewPort.movingE = viewState.curViewPort.movingS;\n          viewState.select(viewState.curViewPort.movingS, viewState.curViewPort.movingE);\n          scope.switchMarkupContext(event);\n          scope.$apply();\n        });\n        element.bind('mousemove', function (event) {\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          // perform mouse tracking\n          var mouseX = viewState.getX(event);\n          viewState.curMousePosSample = Math.round(viewState.curViewPort.sS + mouseX / element[0].width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n          switch (mbutton) {\n          case 0:\n            if (viewState.getPermission('labelAction')) {\n              scope.switchMarkupContext(event);\n              if (!$.isEmptyObject(Ssffdataservice.data)) {\n                if (Ssffdataservice.data.length !== 0) {\n                  if (!viewState.getdragBarActive()) {\n                    if (viewState.curCorrectionToolNr !== undefined && !viewState.getdragBarActive() && !$.isEmptyObject(ConfigProviderService.getAssignment(trackName))) {\n                      // var col = Ssffdataservice.data[0].Columns[0];\n                      if (tr === undefined) {\n                        tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                      }\n                      col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                      sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                      var startTimeVP = viewState.getViewPortStartTime();\n                      var endTimeVP = viewState.getViewPortEndTime();\n                      var colStartSampleNr = Math.round(startTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var colEndSampleNr = Math.round(endTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n                      var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n                      var curMouseTime = startTimeVP + viewState.getX(event) / event.originalEvent.target.width * (endTimeVP - startTimeVP);\n                      var curMouseSample = Math.round((curMouseTime + sRaSt.startTime) * sRaSt.sampleRate) - 1;\n                      //-1 for in view correction\n                      var curMouseSampleTime = 1 / sRaSt.sampleRate * curMouseSample + sRaSt.startTime;\n                      if (curMouseSample - colStartSampleNr < 0 || curMouseSample - colStartSampleNr >= curSampleArrs.length) {\n                        //console.log('early return');\n                        return;\n                      }\n                      viewState.curPreselColumnSample = curMouseSample - colStartSampleNr;\n                      var x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                      var y = canvas.height - curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                      // draw sample\n                      ctx.strokeStyle = 'black';\n                      ctx.fillStyle = 'black';\n                      ctx.beginPath();\n                      ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                      ctx.closePath();\n                      ctx.stroke();\n                      ctx.fill();\n                      if (event.shiftKey) {\n                        var oldValue = angular.copy(curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1]);\n                        var newValue = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        // SIC only using rangeTo\n                        curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        var updateObj = HistoryService.updateCurChangeObj({\n                            'type': 'SSFF',\n                            'trackName': tr.name,\n                            'sampleBlockIdx': colStartSampleNr + viewState.curPreselColumnSample,\n                            'sampleIdx': viewState.curCorrectionToolNr - 1,\n                            'oldValue': oldValue,\n                            'newValue': newValue\n                          });\n                        //draw updateObj as overlay\n                        for (var key in updateObj) {\n                          curMouseSampleTime = 1 / sRaSt.sampleRate * updateObj[key].sampleBlockIdx + sRaSt.startTime;\n                          x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                          y = canvas.height - updateObj[key].newValue / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                          // draw sample\n                          ctx.strokeStyle = 'red';\n                          ctx.fillStyle = 'red';\n                          // ctx.lineWidth = 4;\n                          ctx.beginPath();\n                          ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                          ctx.closePath();\n                          ctx.stroke();\n                          ctx.fill();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            break;\n          case 1:\n            if (!viewState.getdragBarActive()) {\n              scope.setSelectDrag(event);\n            }\n            break;\n          }\n          scope.$apply();\n        });\n        /*\n\t\t\t\t element.bind('mouseup', function (event) {\n\t\t\t\t if (!viewState.getdragBarActive()) {\n\t\t\t\t scope.setSelectDrag(event);\n\t\t\t\t scope.switchMarkupContext(event, false);\n\t\t\t\t }\n\t\t\t\t });\n\t\t\t\t */\n        // on mouse leave clear markup canvas\n        element.bind('mouseleave', function (event) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              if (!viewState.getdragBarActive()) {\n                if (viewState.getPermission('labelAction')) {\n                  scope.switchMarkupContext(event, false);\n                }\n              }\n            }\n          }\n        });\n        //\n        ////////////////////\n        // Functions\n        scope.switchMarkupContext = function (event, leave) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          // draw current viewport selected\n          if (atts.ssffTrackname == 'OSCI') {\n            Drawhelperservice.drawViewPortTimes(ctx, true);\n            Drawhelperservice.drawCurViewPortSelected(ctx, true);\n          } else if (atts.ssffTrackname == 'SPEC') {\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, '', viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 2);\n          } else {\n            var tr = ConfigProviderService.getSsffTrackConfig(atts.ssffTrackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, atts.ssffTrackname, col._minVal, col._maxVal, 2);\n          }\n          // draw crossHairs\n          if (leave !== false && ConfigProviderService.vals.restrictions.drawCrossHairs) {\n            Drawhelperservice.drawCrossHairs(ctx, event, viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 'Hz', atts.ssffTrackname);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n        };\n        scope.setSelectDrag = function (event) {\n          curMouseSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          if (curMouseSample > viewState.curViewPort.movingS) {\n            viewState.curViewPort.movingE = curMouseSample;\n          } else {\n            viewState.curViewPort.movingS = curMouseSample;\n          }\n          viewState.select(viewState.curViewPort.movingS, viewState.curViewPort.movingE);\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Drawhelperservice', [\n  'viewState',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'fontScaleService',\n  'Ssffdataservice',\n  'mathHelperService',\n  function Drawhelperservice(viewState, ConfigProviderService, Soundhandlerservice, fontScaleService, Ssffdataservice, mathHelperService) {\n    //shared service object to be returned\n    var sServObj = {};\n    function getScale(ctx, str, scale) {\n      return ctx.measureText(str).width * scale;\n    }\n    function getScaleWidth(ctx, str1, str2, scaleX) {\n      if (str1 !== undefined && str1.toString().length > str2.toString().length) {\n        return getScale(ctx, str1, scaleX);\n      } else {\n        return getScale(ctx, str2, scaleX);\n      }\n    }\n    /**\n\t\t * drawing method to draw single line between two\n\t\t * envelope points. Is used by drawOsciOnCanvas if\n\t\t * envelope drawing is done\n\t\t * @param index\n\t\t * @param value\n\t\t * @param max\n\t\t * @param prevPeak\n\t\t * @param canvas\n\t\t */\n    function drawFrame(viewState, index, value, min, max, prevPeak, canvas, config) {\n      var ctx = canvas.getContext('2d');\n      //cur\n      var w = 1;\n      // var h = Math.round(value * (canvas.height / max)); //rel to max\n      var x = index * w;\n      // var y = Math.round((canvas.height - h) / 2);\n      var y = (max - value) / (max - min) * canvas.height;\n      //prev\n      // var prevH = Math.round(prevPeak * (canvas.height / max));\n      var prevX = (index - 1) * w;\n      // var prevY = Math.round((canvas.height - prevH) / 2);\n      var prevY = (max - prevPeak) / (max - min) * canvas.height;\n      ctx.strokeStyle = ConfigProviderService.design.color.black;\n      ctx.moveTo(prevX, prevY);\n      ctx.lineTo(x, y);\n    }\n    sServObj.osciPeaks = [];\n    /**\n\t\t * get current peaks to be drawn\n\t\t * if drawing over sample exact -> samples\n\t\t * if multiple samples per pixel -> calculate envelope points\n\t\t */\n    sServObj.calculatePeaks = function (viewState, canvas, data) {\n      var samplePerPx = (viewState.curViewPort.eS + 1 - viewState.curViewPort.sS) / canvas.width;\n      // PCM Samples per new pixel + one to correct for subtraction\n      var numberOfChannels = 1;\n      // hardcode for now...\n      var peaks = [];\n      var minPeak = Infinity;\n      var maxPeak = -Infinity;\n      var relData;\n      if (samplePerPx <= 1) {\n        // check if view at start\n        if (viewState.curViewPort.sS === 0) {\n          relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        } else {\n          relData = data.subarray(viewState.curViewPort.sS - 1, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        }\n        minPeak = Math.min.apply(Math, relData);\n        maxPeak = Math.max.apply(Math, relData);\n        peaks = Array.prototype.slice.call(relData);\n      } else {\n        relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        for (var curPxIdx = 0; curPxIdx < canvas.width; curPxIdx++) {\n          var avrVal = 0;\n          for (var c = 0; c < numberOfChannels; c++) {\n            var vals = relData.subarray(curPxIdx * samplePerPx, (curPxIdx + 1) * samplePerPx);\n            // var peak = -Infinity;\n            var sum = 0;\n            for (var p = 0, l = vals.length; p < l; p++) {\n              // if (vals[p] > peak) {\n              // \tpeak = vals[p];\n              // }\n              sum += vals[p];\n            }\n            avrVal += sum / vals.length;\n          }\n          peaks[curPxIdx] = avrVal;\n          if (avrVal > maxPeak) {\n            maxPeak = avrVal;\n          }\n          if (avrVal < minPeak) {\n            minPeak = avrVal;\n          }\n        }\n      }\n      //else\n      return {\n        'peaks': peaks,\n        'minPeak': minPeak,\n        'maxPeak': maxPeak,\n        'samplePerPx': samplePerPx\n      };\n    };\n    /**\n\t\t * @param cps color provider service\n\t\t */\n    sServObj.freshRedrawDrawOsciOnCanvas = function (viewState, canvas, allPeakVals, buffer, config) {\n      var ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      //set font\n      // ctx.font = (this.params.fontPxSize + \"px\" + \" \" + this.params.fontType);\n      if (allPeakVals.peaks && allPeakVals.samplePerPx >= 1) {\n        ctx.beginPath();\n        allPeakVals.peaks.forEach(function (peak, index) {\n          if (index !== 0) {\n            drawFrame(viewState, index, peak, allPeakVals.minPeak, allPeakVals.maxPeak, allPeakVals.peaks[index - 1], canvas, config);\n          }\n        });\n        ctx.stroke();\n      } else if (allPeakVals.samplePerPx < 1) {\n        // console.log(\"at 0 over sample exact\")\n        var hDbS = 1 / allPeakVals.samplePerPx / 2;\n        // half distance between samples\n        var sNr = viewState.curViewPort.sS;\n        // over sample exact\n        ctx.strokeStyle = ConfigProviderService.design.color.black;\n        ctx.fillStyle = ConfigProviderService.design.color.black;\n        // ctx.beginPath();\n        var i;\n        if (viewState.curViewPort.sS === 0) {\n          ctx.moveTo(hDbS, (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.strokeText(sNr, i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        } else {\n          //draw lines\n          ctx.beginPath();\n          ctx.moveTo(-hDbS, canvas.height - (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx - hDbS, canvas.height - ((allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height + 3));\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.fillText(sNr, i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        }\n      }\n      if (config.vals.restrictions.drawZeroLine) {\n        // draw zero line\n        ctx.strokeStyle = ConfigProviderService.design.color.blue;\n        ctx.fillStyle = ConfigProviderService.design.color.blue;\n        if (allPeakVals.samplePerPx >= 1) {\n          var zeroLineY = canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height;\n          ctx.beginPath();\n          ctx.moveTo(0, zeroLineY);\n          ctx.lineTo(canvas.width, zeroLineY);\n          ctx.stroke();\n          ctx.fillText('0', 5, canvas.height / 2 - 5, canvas.width);\n        } else {\n          var zeroLineY = canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height;\n          ctx.beginPath();\n          ctx.moveTo(0, zeroLineY);\n          ctx.lineTo(canvas.width, zeroLineY);\n          ctx.stroke();\n          ctx.fill();\n          ctx.fillText('0', 5, canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 5, canvas.width);\n        }  // see if Chrome ->dashed line\n           //if (navigator.vendor === 'Google Inc.') {\n           //\tctx.setLineDash([0]);\n           //}\n      }\n    };\n    /**\n\t\t * drawing method to drawMovingBoundaryLine\n\t\t */\n    sServObj.drawMovingBoundaryLine = function (ctx) {\n      var xOffset, sDist;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      if (viewState.movingBoundary) {\n        ctx.fillStyle = ConfigProviderService.design.color.blue;\n        var p = Math.round(viewState.getPos(ctx.canvas.width, viewState.movingBoundarySample));\n        if (viewState.getcurMouseisLast()) {\n          ctx.fillRect(p + sDist, 0, 1, ctx.canvas.height);\n        } else {\n          ctx.fillRect(p + xOffset, 0, 1, ctx.canvas.height);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCurViewPortSelected\n\t\t */\n    sServObj.drawCurViewPortSelected = function (ctx, drawTimeAndSamples) {\n      var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n      var xOffset, sDist, space, horizontalText, scaleX;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'seg') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      var posS = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectS);\n      var posE = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectE);\n      if (posS === posE) {\n        ctx.fillStyle = ConfigProviderService.design.color.transparent.black;\n        ctx.fillRect(posS + xOffset, 0, 2, ctx.canvas.height);\n        if (drawTimeAndSamples) {\n          if (viewState.curViewPort.sS !== viewState.curViewPort.selectS && viewState.curViewPort.selectS !== -1) {\n            scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n            space = getScaleWidth(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n            fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), fontSize, ConfigProviderService.design.font.small.family, posE + 5, 0, ConfigProviderService.design.color.black, true);\n          }\n        }\n      } else {\n        ctx.fillStyle = ConfigProviderService.design.color.transparent.grey;\n        ctx.fillRect(posS, 0, posE - posS, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.design.color.transparent.black;\n        ctx.beginPath();\n        ctx.moveTo(posS, 0);\n        ctx.lineTo(posS, ctx.canvas.height);\n        ctx.moveTo(posE, 0);\n        ctx.lineTo(posE, ctx.canvas.height);\n        ctx.closePath();\n        ctx.stroke();\n        if (drawTimeAndSamples) {\n          // start values\n          scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          space = getScaleWidth(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.selectS, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), fontSize, ConfigProviderService.design.font.small.family, posS - space - 5, 0, ConfigProviderService.design.color.black, false);\n          // end values\n          fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.selectE, mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.selectE / Soundhandlerservice.wavJSO.SampleRate, 6), fontSize, ConfigProviderService.design.font.small.family, posE + 5, 0, ConfigProviderService.design.color.black, true);\n          // dur values\n          // check if space\n          space = getScale(ctx, mathHelperService.roundToNdigitsAfterDecPoint((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          if (posE - posS > space) {\n            var str1 = viewState.curViewPort.selectE - viewState.curViewPort.selectS - 1;\n            var str2 = mathHelperService.roundToNdigitsAfterDecPoint((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6);\n            space = getScaleWidth(ctx, str1, str2, scaleX);\n            fontScaleService.drawUndistortedTextTwoLines(ctx, str1, str2, fontSize, ConfigProviderService.design.font.small.family, posS + (posE - posS) / 2 - space / 2, 0, ConfigProviderService.design.color.black, false);\n          }\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCrossHairs\n\t\t */\n    sServObj.drawCrossHairs = function (ctx, mouseEvt, min, max, unit, trackname) {\n      // console.log(mathHelperService.roundToNdigitsAfterDecPoint(min, round))\n      if (ConfigProviderService.vals.restrictions.drawCrossHairs) {\n        var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n        // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.design.color.transparent.red;\n        ctx.fillStyle = ConfigProviderService.design.color.transparent.red;\n        // see if Chrome -> dashed line\n        //if (navigator.vendor === 'Google Inc.') {\n        //\tctx.setLineDash([2]);\n        //}\n        // draw lines\n        var mouseX = viewState.getX(mouseEvt);\n        var mouseY = viewState.getY(mouseEvt);\n        //if (navigator.vendor === 'Google Inc.') {\n        //\tctx.setLineDash([0]);\n        //}\n        // draw frequency / sample / time\n        ctx.font = ConfigProviderService.design.font.small.size + 'px ' + ConfigProviderService.design.font.small.family;\n        var mouseFreq = mathHelperService.roundToNdigitsAfterDecPoint(max - mouseY / ctx.canvas.height * max, 2);\n        // SIC only uses max\n        var tW = ctx.measureText(mouseFreq + unit).width * fontScaleService.scaleX;\n        var s1 = Math.round(viewState.curViewPort.sS + mouseX / ctx.canvas.width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n        var s2 = mathHelperService.roundToNdigitsAfterDecPoint(viewState.getViewPortStartTime() + mouseX / ctx.canvas.width * (viewState.getViewPortEndTime() - viewState.getViewPortStartTime()), 6);\n        if (max !== undefined || min !== undefined) {\n          if (trackname == 'OSCI') {\n            // no horizontal values\n            ctx.beginPath();\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(5, mouseY + 5);\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(ctx.canvas.width, mouseY);\n            //ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else if (trackname == 'SPEC') {\n            fontScaleService.drawUndistortedText(ctx, mouseFreq + unit, fontSize, ConfigProviderService.design.font.small.family, 5, mouseY, ConfigProviderService.design.color.transparent.red, true);\n            fontScaleService.drawUndistortedText(ctx, mouseFreq + unit, fontSize, ConfigProviderService.design.font.small.family, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, ConfigProviderService.design.color.transparent.red, true);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else {\n            // draw min max an name of track\n            var tr = ConfigProviderService.getSsffTrackConfig(trackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            mouseFreq = col._maxVal - mouseY / ctx.canvas.height * (col._maxVal - col._minVal);\n            mouseFreq = mathHelperService.roundToNdigitsAfterDecPoint(mouseFreq, 2);\n            // crop\n            fontScaleService.drawUndistortedText(ctx, mouseFreq, fontSize, ConfigProviderService.design.font.small.family, 5, mouseY, ConfigProviderService.design.color.transparent.red, true);\n            fontScaleService.drawUndistortedText(ctx, mouseFreq, fontSize, ConfigProviderService.design.font.small.family, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, ConfigProviderService.design.color.transparent.red, true);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          }\n        }\n        fontScaleService.drawUndistortedTextTwoLines(ctx, s1, s2, fontSize, ConfigProviderService.design.font.small.family, mouseX + 5, 0, ConfigProviderService.design.color.transparent.red, true);\n      }\n    };\n    /**\n\t\t * drawing method to drawMinMaxAndName\n\t\t * @param ctx is context to be drawn on\n\t\t * @param trackName name of track to be drawn in the center of the canvas (left aligned)\n\t\t * @param min value to be drawn at the bottom of the canvas (left aligned)\n\t\t * @param max value to be drawn at the top of the canvas (left aligned)\n\t\t * @param round value to round to for min/max values (== digits after comma)\n\t\t */\n    sServObj.drawMinMaxAndName = function (ctx, trackName, min, max, round) {\n      // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      ctx.strokeStyle = ConfigProviderService.design.color.black;\n      ctx.fillStyle = ConfigProviderService.design.color.black;\n      var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n      // var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var smallFontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 3 / 4;\n      var th = smallFontSize * scaleY;\n      // draw corner pointers\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(0, ctx.canvas.height);\n      ctx.lineTo(5, ctx.canvas.height - 5);\n      ctx.stroke();\n      ctx.closePath();\n      // draw trackName\n      if (trackName !== '') {\n        fontScaleService.drawUndistortedText(ctx, trackName, fontSize, ConfigProviderService.design.font.small.family, 0, ctx.canvas.height / 2 - fontSize * scaleY / 2, ConfigProviderService.design.color.black);\n      }\n      // draw min/max vals\n      if (max !== undefined) {\n        fontScaleService.drawUndistortedText(ctx, 'max: ' + mathHelperService.roundToNdigitsAfterDecPoint(max, round), smallFontSize, ConfigProviderService.design.font.small.family, 5, 5, ConfigProviderService.design.color.grey);\n      }\n      // draw min/max vals\n      if (min !== undefined) {\n        fontScaleService.drawUndistortedText(ctx, 'min: ' + mathHelperService.roundToNdigitsAfterDecPoint(min, round), smallFontSize, ConfigProviderService.design.font.small.family, 5, ctx.canvas.height - th - 5, ConfigProviderService.design.color.grey);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.drawViewPortTimes = function (ctx) {\n      ctx.strokeStyle = ConfigProviderService.design.color.black;\n      ctx.fillStyle = ConfigProviderService.design.color.black;\n      ctx.font = ConfigProviderService.design.font.small.size + ' ' + ConfigProviderService.design.font.small.family;\n      var fontSize = ConfigProviderService.design.font.small.size.slice(0, -2) * 1;\n      // lines to corners\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(ctx.canvas.width, 0);\n      ctx.lineTo(ctx.canvas.width - 5, 5);\n      ctx.closePath();\n      ctx.stroke();\n      var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var sTime;\n      var eTime;\n      var horizontalText;\n      var space;\n      if (viewState.curViewPort) {\n        //draw time and sample nr\n        sTime = mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.sS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        eTime = mathHelperService.roundToNdigitsAfterDecPoint(viewState.curViewPort.eS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.sS, sTime, fontSize, ConfigProviderService.design.font.small.family, 5, 5, ConfigProviderService.design.color.black, true);\n        space = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n        fontScaleService.drawUndistortedTextTwoLines(ctx, viewState.curViewPort.eS, eTime, fontSize, ConfigProviderService.design.font.small.family, ctx.canvas.width - space - 5, 0, ConfigProviderService.design.color.black, false);\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HistoryService', [\n  '$log',\n  '$compile',\n  'Ssffdataservice',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'viewState',\n  'Soundhandlerservice',\n  'loadedMetaDataService',\n  function HistoryService($log, $compile, Ssffdataservice, LevelService, LinkService, ConfigProviderService, viewState, Soundhandlerservice, loadedMetaDataService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.movesAwayFromLastSave = 0;\n    //////////////////////////////////////////\n    // new dual stack implementation\n    // private\n    var undoStack = [];\n    var redoStack = [];\n    var curChangeObj = {};\n    // applyChanges should be called by undo redo functions\n    function applyChange(changeObj, applyOldVal) {\n      Object.keys(changeObj).forEach(function (key) {\n        var cur = changeObj[key];\n        if (cur.type === 'SSFF') {\n          if (applyOldVal) {\n            sServObj.setHistoryActionText(true, 'SSFF manipulation');\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.oldValue;\n          } else {\n            sServObj.setHistoryActionText(false, 'SSFF manipulation');\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.newValue;\n          }\n        } else if (cur.type === 'WEBAPP') {\n          var action = false;\n          switch (cur.action) {\n          case 'COMMENT':\n            // The order of links is not preserved on undo\n            if (applyOldVal) {\n              action = true;\n              loadedMetaDataService.setBndlComment(cur.initial, cur.key, cur.index);\n            } else {\n              loadedMetaDataService.setBndlComment(cur.comment, cur.key, cur.index);\n            }\n            break;\n          case 'FINISHED':\n            if (applyOldVal) {\n              action = true;\n              loadedMetaDataService.setBndlFinished(!cur.finished, cur.key, cur.index);\n            } else {\n              loadedMetaDataService.setBndlFinished(cur.finished, cur.key, cur.index);\n            }\n            break;\n          }\n        } else if (cur.type === 'ANNOT') {\n          var action = false;\n          switch (cur.action) {\n          case 'MOVEBOUNDARY':\n            if (applyOldVal) {\n              action = true;\n              LevelService.moveBoundary(cur.name, cur.id, -cur.movedBy, cur.isFirst, cur.isLast);\n            } else {\n              LevelService.moveBoundary(cur.name, cur.id, cur.movedBy, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'MOVESEGMENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.moveSegment(cur.name, cur.id, cur.length, -cur.movedBy);\n            } else {\n              LevelService.moveSegment(cur.name, cur.id, cur.length, cur.movedBy);\n            }\n            break;\n          case 'MOVEEVENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.moveEvent(cur.name, cur.id, -cur.movedBy);\n            } else {\n              LevelService.moveEvent(cur.name, cur.id, cur.movedBy);\n            }\n            break;\n          case 'RENAMELABEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.oldValue);\n            } else {\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.newValue);\n            }\n            break;\n          case 'RENAMELEVEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.renameLevel(cur.newname, cur.name, cur.curPerspectiveIdx);\n            } else {\n              LevelService.renameLevel(cur.name, cur.newname, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETELEVEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            } else {\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETEBOUNDARY':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteBoundaryInvers(cur.name, cur.id, cur.isFirst, cur.isLast, cur.deletedSegment);\n            } else {\n              LevelService.deleteBoundary(cur.name, cur.id, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'DELETESEGMENTS':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteSegmentsInvers(cur.name, cur.id, cur.length, cur.deletedSegment);\n            } else {\n              LevelService.deleteSegments(cur.name, cur.id, cur.length);\n            }\n            break;\n          case 'DELETEEVENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            } else {\n              LevelService.deleteEvent(cur.name, cur.id);\n            }\n            break;\n          case 'DELETELINKSTO':\n            if (applyOldVal) {\n              action = true;\n              LinkService.insertLinksTo(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinksTo(cur.id);\n            }\n            break;\n          case 'DELETELINKBOUNDARY':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLinkBoundaryInvers(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinkBoundary(cur.id, cur.neighbourId);\n            }\n            break;\n          case 'DELETELINKSEGMENT':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLinkSegmentInvers(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinkSegment(cur.segments);\n            }\n            break;\n          case 'INSERTLEVEL':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            } else {\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'INSERTSEGMENTS':\n            if (applyOldVal) {\n              action = true;\n              LevelService.insertSegmentInvers(cur.name, cur.start, cur.end, cur.segName);\n            } else {\n              LevelService.insertSegment(cur.name, cur.start, cur.end, cur.segName, cur.ids);\n            }\n            break;\n          case 'INSERTEVENT':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteEvent(cur.name, cur.id);\n            } else {\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            }\n            break;\n          case 'INSERTLINKSTO':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLinksTo(cur.parentID, cur.childIDs);\n            } else {\n              LinkService.insertLinksTo(cur.parentID, cur.childIDs);\n            }\n            break;\n          case 'EXPANDSEGMENTS':\n            if (applyOldVal) {\n              action = true;\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, -cur.changeTime);\n            } else {\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, cur.changeTime);\n            }\n            break;\n          }\n          sServObj.setHistoryActionText(action, cur.action);\n        } else if (cur.type === 'HIERARCHY') {\n          var action = false;\n          switch (cur.action) {\n          case 'DELETELINK':\n            // The order of links is not preserved on undo\n            if (applyOldVal) {\n              action = true;\n              LinkService.insertLinkAt(cur.fromID, cur.toID, cur.position);\n            } else {\n              LinkService.deleteLink(cur.fromID, cur.toID);\n            }\n            break;\n          case 'DELETEITEM':\n            if (applyOldVal) {\n              action = true;\n              LevelService.deleteItemWithLinksInvers(cur.item, cur.levelName, cur.position, cur.deletedLinks);\n            } else {\n              LevelService.deleteItemWithLinks(cur.item.id);\n            }\n            break;\n          case 'ADDITEM':\n            if (applyOldVal) {\n              action = true;\n              LevelService.addItemInvers(cur.newID);\n            } else {\n              LevelService.addItem(cur.neighborID, cur.before, cur.newID);\n            }\n            break;\n          case 'ADDLINK':\n            if (applyOldVal) {\n              action = true;\n              LinkService.deleteLink(cur.link.fromID, cur.link.toID);\n            } else {\n              LinkService.insertLink(cur.link.fromID, cur.link.toID);\n            }\n            break;\n          case 'PUSHITEM':\n            if (applyOldVal) {\n              action = true;\n              LevelService.addItemInvers(cur.newID);\n            } else {\n              LevelService.pushNewItem(cur.level, cur.newID);\n            }\n            break;\n          }\n          sServObj.setHistoryActionText(action, cur.action);\n        }\n      });\n    }\n    /////////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.updateCurChangeObj = function (dataObj) {\n      // console.log(dataObj);\n      var dataKey;\n      if (dataObj.type === 'SSFF') {\n        dataKey = String(dataObj.type + '#' + dataObj.trackName) + '#' + String(dataObj.sampleBlockIdx) + '#' + String(dataObj.sampleIdx);\n        // update curChangeObj\n        if (!curChangeObj[dataKey]) {\n          curChangeObj[dataKey] = dataObj;\n        } else {\n          dataObj.oldValue = curChangeObj[dataKey].oldValue;\n          curChangeObj[dataKey] = dataObj;\n        }\n      } else if (dataObj.type === 'WEBAPP') {\n        dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.key + '#' + dataObj.index);\n        // update curChangeObj\n        if (!curChangeObj[dataKey]) {\n          curChangeObj[dataKey] = dataObj;\n        } else {\n          dataObj.comment = curChangeObj[dataKey].comment;\n          curChangeObj[dataKey] = dataObj;\n        }\n      } else if (dataObj.type === 'ANNOT') {\n        switch (dataObj.action) {\n        case 'MOVEBOUNDARY':\n        case 'MOVEEVENT':\n        case 'MOVESEGMENT':\n        case 'INSERTEVENT':\n        case 'DELETEEVENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name + '#' + dataObj.id);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.movedBy += curChangeObj[dataKey].movedBy;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        case 'INSERTLINKSTO':\n        case 'DELETELINKSTO':\n        case 'DELETELINKBOUNDARY':\n        case 'DELETELINKSEGMENT':\n        case 'DELETEBOUNDARY':\n        case 'DELETESEGMENTS':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.oldValue = curChangeObj[dataKey].oldValue;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        }\n      }\n      return curChangeObj;\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addCurChangeObjToUndoStack = function () {\n      // empty redo stack\n      redoStack = [];\n      // add to undoStack\n      if (!$.isEmptyObject(curChangeObj)) {\n        undoStack.push(curChangeObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      $log.info(curChangeObj);\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addObjToUndoStack = function (obj) {\n      // empty redo stack\n      redoStack = [];\n      var tmpObj = {};\n      var dataKey = String(obj.type + '#' + obj.action + '#' + obj.name + '#' + obj.id);\n      tmpObj[dataKey] = angular.copy(obj);\n      // add to undoStack\n      if (!$.isEmptyObject(tmpObj)) {\n        undoStack.push(tmpObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // undo\n    sServObj.undo = function () {\n      if (undoStack.length > 0) {\n        // add to redo stack\n        var oldChangeObj = angular.copy(undoStack[undoStack.length - 1]);\n        redoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, true);\n        // remove old\n        undoStack.pop();\n        sServObj.movesAwayFromLastSave -= 1;\n      }\n    };\n    // redo\n    sServObj.redo = function () {\n      if (redoStack.length > 0) {\n        var oldChangeObj = angular.copy(redoStack[redoStack.length - 1]);\n        undoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, false);\n        redoStack.pop();\n        sServObj.movesAwayFromLastSave += 1;\n      }\n    };\n    // getNrOfPossibleUndos\n    sServObj.getNrOfPossibleUndos = function () {\n      return undoStack.length;\n    };\n    // return current History Stack\n    sServObj.getCurrentStack = function () {\n      return {\n        'undo': undoStack,\n        'redo': redoStack\n      };\n    };\n    // set the displayed text of the historyActionPopup\n    sServObj.setHistoryActionText = function (isUndo, text) {\n      var front = '<i>UNDO</i> &#8594; ';\n      if (!isUndo) {\n        front = '<i>REDO</i> &#8592; ';\n      }\n      viewState.historyActionTxt = front + text;\n    };\n    // resetToInitState\n    sServObj.resetToInitState = function () {\n      undoStack = [];\n      redoStack = [];\n      curChangeObj = {};\n      sServObj.movesAwayFromLastSave = 0;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Wavparserservice', [\n  '$q',\n  function Wavparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new wavParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e);\n      }\n    });\n    /**\n\t\t * parse buffer containing wav file using webworker\n\t\t * @param buf\n\t\t * @returns promise\n\t\t */\n    sServObj.parseWavArrBuf = function (buf) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseBuf',\n        'buffer': buf\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Textgridparserservice', [\n  '$q',\n  'DataService',\n  'viewState',\n  'Soundhandlerservice',\n  function Textgridparserservice($q, DataService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new textGridParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e);\n      }\n    }, false);\n    /**\n\t\t * parse level data to Textgrid File\n\t\t * @param level data\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncToTextGrid = function () {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'toTextGrid',\n        'levels': DataService.getData().levels,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'buffLength': Soundhandlerservice.wavJSO.Data.length\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseTextGrid = function (textGrid, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseTG',\n        'textGrid': textGrid,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('uuid', function () {\n  // shared service object\n  var sServObj = {};\n  function rand(s) {\n    var p = (Math.random().toString(16) + '000000000').substr(2, 8);\n    return s ? '-' + p.substr(0, 4) + '-' + p.substr(4, 4) : p;\n  }\n  //\n  sServObj.new = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  sServObj.newHash = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  //\n  sServObj.empty = function () {\n    return '00000000-0000-0000-0000-000000000000';\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').factory('browserDetector', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  sServObj.isMobile = {\n    Android: function () {\n      return navigator.userAgent.match(/Android/i);\n    },\n    BlackBerry: function () {\n      return navigator.userAgent.match(/BlackBerry/i);\n    },\n    iOS: function () {\n      return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera Mini/i);\n    },\n    Windows: function () {\n      return navigator.userAgent.match(/IEMobile/i);\n    },\n    any: function () {\n      return sServObj.isMobile.Android() || sServObj.isMobile.BlackBerry() || sServObj.isMobile.iOS() || sServObj.isMobile.Opera() || sServObj.isMobile.Windows();\n    }\n  };\n  sServObj.isBrowser = {\n    Firefox: function () {\n      return navigator.userAgent.match(/Firefox/i);\n    },\n    Chrome: function () {\n      return navigator.userAgent.match(/Chrome/i);\n    },\n    InternetExplorer: function () {\n      return navigator.userAgent.match(/MSIE/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera/i);\n    },\n    PhantomJS: function () {\n      return navigator.userAgent.match(/PhantomJS/i);\n    },\n    Safari: function () {\n      return Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;\n    },\n    any: function () {\n      return sServObj.isBrowser.Firefox() || sServObj.isBrowser.Chrome() || sServObj.isBrowser.InternetExplorer() || sServObj.isBrowser.Opera() || sServObj.isBrowser.Safari() || sServObj.isBrowser.PhantomJS();\n    }\n  };\n  sServObj.isMobileDevice = function () {\n    var data = sServObj.isMobile.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  sServObj.isDesktopDevice = function () {\n    var data = sServObj.isBrowser.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('fontScaleService', function fontScaleService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.lastTextWidth = null;\n  sServObj.spaceTop = 0;\n  sServObj.scaleY = 0;\n  sServObj.scaleX = 0;\n  /**\n\t\t *\n\t\t */\n  sServObj.drawUndistortedText = function (ctxOriginal, text, fontPxSize, fontType, x, y, color) {\n    sServObj.scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    sServObj.scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    ctxOriginal.save();\n    ctxOriginal.font = fontPxSize + 'px' + ' ' + fontType;\n    ctxOriginal.scale(sServObj.scaleX, sServObj.scaleY);\n    ctxOriginal.fillStyle = color;\n    ctxOriginal.fillText(text, x / sServObj.scaleX, (y + fontPxSize + sServObj.spaceTop) / sServObj.scaleY);\n    ctxOriginal.scale(1, 1);\n    ctxOriginal.restore();\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.drawUndistortedTextTwoLines = function (ctxOriginal, text, text2, fontPxSize, fontType, x, y, color, alignLeft) {\n    sServObj.scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    sServObj.scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    ctxOriginal.save();\n    ctxOriginal.font = fontPxSize + 'px' + ' ' + fontType;\n    ctxOriginal.fillStyle = color;\n    ctxOriginal.scale(sServObj.scaleX, sServObj.scaleY);\n    if (alignLeft) {\n      ctxOriginal.fillText(text, x / sServObj.scaleX, y + fontPxSize + sServObj.spaceTop);\n      ctxOriginal.fillText(text2, x / sServObj.scaleX, y + 2 * fontPxSize + sServObj.spaceTop);\n    } else {\n      var a = ctxOriginal.measureText(text).width;\n      var b = ctxOriginal.measureText(text2).width;\n      // var c;\n      if (a > b) {\n        ctxOriginal.fillText(text, x / sServObj.scaleX, y + fontPxSize + sServObj.spaceTop);\n        ctxOriginal.fillText(text2, (x + (a - b)) / sServObj.scaleX, y + 2 * fontPxSize + sServObj.spaceTop);\n      } else {\n        ctxOriginal.fillText(text, (x + (b - a)) / sServObj.scaleX, y + fontPxSize + sServObj.spaceTop);\n        ctxOriginal.fillText(text2, x / sServObj.scaleX, y + 2 * fontPxSize + sServObj.spaceTop);\n      }\n    }\n    ctxOriginal.restore();\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Espsparserservice', [\n  '$q',\n  'LevelService',\n  'Soundhandlerservice',\n  function Espsparserservice($q, LevelService, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new espsParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse ESPS file using webworker\n\t\t * @param esps\n\t\t * @param annotates\n\t\t * @param name\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseEsps = function (esps, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseESPS',\n        'esps': esps,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse JSO data to ESPS file using webworker\n\t\t * @param name\n\t\t * @param sampleRate\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseJSO = function (name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseJSO',\n        'level': LevelService.getLevelDetails(name),\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('LoginCtrl', [\n  '$scope',\n  '$rootScope',\n  '$http',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'modalService',\n  function ($scope, $rootScope, $http, ConfigProviderService, Iohandlerservice, viewState, modalService) {\n    $scope.loginData = {\n      'username': '',\n      'password': '',\n      'errorMsg': ''\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.tryLogin = function () {\n      Iohandlerservice.logOnUser($scope.loginData.username, $scope.loginData.password).then(function (res) {\n        if (res === 'LOGGEDON') {\n          modalService.confirm();\n        } else {\n          $scope.loginData.errorMsg = 'ERROR: ' + res;\n        }\n      });\n    };\n    // FOR DEVELOPMENT\n    // $scope.tryLogin(); // for autologin uncomment and set username + password\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      modalService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffdataservice', [\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  function Ssffdataservice(viewState, Soundhandlerservice, ConfigProviderService) {\n    // shared service object\n    var sServObj = {};\n    // stores files referred to by ssffTrackDefinitions\n    sServObj.data = [];\n    /////////////////////\n    // public API\n    /**\n\t\t * Search through ssffTrackDefinitions to find correct\n\t\t * file. Then search thought data and return file.\n\t\t * @param trackName name of track to get file for\n\t\t */\n    sServObj.getFile = function (trackName) {\n      var res;\n      if (ConfigProviderService.curDbConfig.ssffTrackDefinitions !== undefined) {\n        ConfigProviderService.curDbConfig.ssffTrackDefinitions.forEach(function (std) {\n          if (std.name === trackName) {\n            sServObj.data.forEach(function (f) {\n              if (f.fileExtension === std.fileExtension) {\n                res = f;\n              }\n            });\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getColumnOfTrack = function (trackName, columnName) {\n      var res;\n      var file = sServObj.getFile(trackName);\n      if (file !== undefined) {\n        file.Columns.forEach(function (col) {\n          if (col.name === columnName) {\n            res = col;\n          }\n        });\n        return res;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSampleRateAndStartTimeOfTrack = function (trackName) {\n      var res = {};\n      var file = sServObj.getFile(trackName);\n      if (file !== undefined) {\n        res.sampleRate = file.sampleRate;\n        res.startTime = file.startTime;\n        return res;\n      }\n    };\n    /**\n\t\t * calculates the closest audio sample of\n\t\t * the passed in column sample nr\n\t\t */\n    sServObj.calculateSamplePosInVP = function (colSampleNr, sampleRate, startTime) {\n      var sampleTime = colSampleNr / sampleRate + startTime;\n      var audioSample = Math.round(sampleTime * Soundhandlerservice.wavJSO.SampleRate);\n      return audioSample;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DataService', function DataService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.data = {};\n  sServObj.maxItemID = 0;\n  ///////////////////////////////\n  // public api\n  /**\n\t\t * returns all the data\n\t\t * @return the data\n\t\t */\n  sServObj.getData = function () {\n    return sServObj.data;\n  };\n  /**\n\t\t * sets all the level data\n\t\t * @param data containing all level data\n\t\t */\n  sServObj.setLevelData = function (data) {\n    sServObj.data.levels = data;\n  };\n  /**\n\t\t * returns all the level data\n\t\t * @return data containing all level data\n\t\t */\n  sServObj.getLevelData = function () {\n    return sServObj.data.levels;\n  };\n  /**\n\t\t * returns all the level data\n\t\t * @return data containing all level data\n\t\t */\n  sServObj.getLevelOrder = function (order) {\n    if (sServObj.data.levels !== undefined) {\n      return sServObj.data.levels.sort(function (a, b) {\n        return order.indexOf(a.name) - order.indexOf(b.name);\n      });\n    }\n  };\n  /**\n\t\t * returns a specific level at given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.getLevelDataAt = function (position) {\n    return sServObj.data.levels[position];\n  };\n  /**\n\t\t * inserts a single level into level data at a given position\n\t\t * @param position of the level in the level array\n\t\t * @param newLevel the new level to insert\n\t\t */\n  sServObj.insertLevelDataAt = function (position, newLevel) {\n    sServObj.data.levels.splice(position, 0, newLevel);\n  };\n  /**\n\t\t * deletes a single level from level data at a given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.deleteLevelDataAt = function (position) {\n    sServObj.data.levels.splice(position, 1);\n  };\n  /**\n\t\t * returns all the link data\n\t\t * @return the data\n\t\t */\n  sServObj.getLinkData = function () {\n    return sServObj.data.links;\n  };\n  /**\n\t\t * sets all the link data\n\t\t * @param data containing all link data\n\t\t */\n  sServObj.setLinkData = function (data) {\n    sServObj.data.links = data;\n  };\n  /**\n\t\t * inserts a single link into link data by pushing it\n\t\t * on to the array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkData = function (newLink) {\n    sServObj.data.links.push(newLink);\n  };\n  /**\n\t\t * deletes a single link from link data at a given position\n\t\t * @param position of the link in the link array\n\t\t */\n  sServObj.deleteLinkDataAt = function (position) {\n    sServObj.data.links.splice(position, 1);\n  };\n  /**\n\t\t * inserts a single link into link data at a given position\n\t\t * @param position of the link in the link array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkDataAt = function (position, newLink) {\n    sServObj.data.links.splice(position, 0, newLink);\n  };\n  /**\n\t\t * changes a single link at a given position with new data\n\t\t * @param position of the link in the link array\n\t\t * @param fromNewID the new fromID of the link\n\t\t * @param toNewID the new toID of the link\n\t\t */\n  sServObj.changeLinkDataAt = function (position, fromNewID, toNewID) {\n    sServObj.data.links[position].fromID = fromNewID;\n    sServObj.data.links[position].toID = toNewID;\n  };\n  /**\n\t\t * sets annotation data and sets maxItemID\n\t\t * by parsing id in elements\n\t\t * should be used to fill links and levels\n\t\t * @param the data\n\t\t */\n  sServObj.setData = function (data) {\n    angular.copy(data, sServObj.data);\n    angular.forEach(sServObj.data.levels, function (level) {\n      level.items.forEach(function (item) {\n        if (item.id > sServObj.maxItemID) {\n          sServObj.maxItemID = item.id;\n        }\n      });\n    });\n  };\n  /**\n\t\t * called externally by functions\n\t\t */\n  sServObj.getNewId = function () {\n    sServObj.maxItemID += 1;\n    return sServObj.maxItemID;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.raiseId = function (amount) {\n    sServObj.maxItemID += amount;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.lowerId = function (amount) {\n    sServObj.maxItemID -= amount;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('LevelService', [\n  '$q',\n  'DataService',\n  'LinkService',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'viewState',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  function LevelService($q, DataService, LinkService, ConfigProviderService, Soundhandlerservice, viewState, Ssffdataservice, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.lasteditArea = null;\n    // holding current edit area\n    sServObj.lasteditAreaElem = null;\n    // holding current edit area element\n    /**\n\t\t * search for the according label field in labels\n\t\t * and return its position\n\t\t *    @param attrDefName\n\t\t *    @param labels\n\t\t */\n    function getLabelIdx(attrDefName, labels) {\n      var labelIdx;\n      angular.forEach(labels, function (l, idx) {\n        if (l.name === attrDefName) {\n          labelIdx = idx;\n        }\n      });\n      return labelIdx;\n    }\n    /**\n\t\t * returns level details by passing in level name\n\t\t * if the corresponding level exists\n\t\t * otherwise returns 'null'\n\t\t *    @param name\n\t\t */\n    sServObj.getLevelDetails = function (name) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          ret = level;\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all levels with details for a specific type\n\t\t *    @param types\n\t\t */\n    sServObj.getLevelsByType = function (types) {\n      var levels = [];\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (types.indexOf(level.type) >= 0) {\n          levels.push(level);\n        }\n      });\n      return levels;\n    };\n    /**\n\t\t * gets element position inside a level with 'name'\n\t\t * by passing in the element id\n\t\t *    @param name\n\t\t *    @param id\n\t\t */\n    sServObj.getOrderById = function (name, id) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (e, num) {\n            if (e.id === id) {\n              ret = num;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets element id inside a level with 'name' by\n\t\t * passing in the element position/order\n\t\t *    @param name\n\t\t *    @param order\n\t\t */\n    sServObj.getIdByOrder = function (name, order) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num === order) {\n              ret = element.id;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets item details by passing in 'name' of level\n\t\t * and item position/order\n\t\t *    @param name\n\t\t *    @param order\n\t\t */\n    sServObj.getItemDetails = function (name, order) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          ret = level.items[order];\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns the last element inside a level with 'name'\n\t\t *    @param name\n\t\t */\n    sServObj.getLastItem = function (name) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          details = level.items[level.items.length - 1];\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * get next element of element with id in order/position\n\t\t * inside a level with 'name'\n\t\t *    @param name\n\t\t *    @param id\n\t\t */\n    sServObj.getNextItem = function (name, id) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (element.id === id) {\n              ret = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * get next or prev Element in time inside level with 'name'\n\t\t * after or bevore (boolean) an element with 'id'\n\t\t *    @param name\n\t\t *    @param id\n\t\t *    @param after\n\t\t */\n    sServObj.getItemInTime = function (name, id, after) {\n      var ret = null;\n      var timeDifference = Infinity;\n      var startItem = sServObj.getItemFromLevelById(name, id);\n      if (startItem !== null) {\n        var myStart = startItem.sampleStart || startItem.samplePoint;\n        angular.forEach(DataService.getLevelData(), function (level) {\n          if (level.name === name) {\n            level.items.forEach(function (element) {\n              var start = element.sampleStart || element.samplePoint;\n              if (after) {\n                if (start > myStart && start - myStart <= timeDifference) {\n                  timeDifference = start - myStart;\n                  ret = element;\n                }\n              } else {\n                if (start < myStart && myStart - start <= timeDifference) {\n                  timeDifference = myStart - start;\n                  ret = element;\n                }\n              }\n            });\n          }\n        });\n      }\n      return ret;\n    };\n    /**\n\t\t * returns item from a level with 'name' by passing in the item 'id'\n\t\t *    @param name\n\t\t *    @param id\n\t\t */\n    sServObj.getItemFromLevelById = function (name, id) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              ret = element;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * get all labels (curAttr def applies) of a level and\n\t\t * return them as a flat array\n\t\t * @param levelDetails containing labels\n\t\t * @return array containing all labels (form==['x','y','z'])\n\t\t */\n    sServObj.getAllLabelsOfLevel = function (levelDetails) {\n      var curAttrDef = viewState.getCurAttrDef(levelDetails.name);\n      var labels = [];\n      angular.forEach(levelDetails.items, function (item) {\n        var pos = item.labels.map(function (e) {\n            return e.name;\n          }).indexOf(curAttrDef);\n        if (pos >= 0) {\n          labels.push(item.labels[pos].value);\n        }\n      });\n      return labels;\n    };\n    /**\n\t\t * returns level name of a given node id\n\t\t * @param nodeID id of the node\n\t\t * @return name of the containing level\n\t\t */\n    sServObj.getLevelName = function (nodeID) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        var pos = level.items.map(function (e) {\n            return e.id;\n          }).indexOf(nodeID);\n        if (pos >= 0) {\n          ret = level.name;\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * Returns a level object and an item object according to a given item id\n\t\t * @param nodeID id of the node\n\t\t * @return object with level and item\n\t\t */\n    sServObj.getLevelAndItem = function (nodeID) {\n      var name = sServObj.getLevelName(nodeID);\n      if (name !== null) {\n        return {\n          level: sServObj.getLevelDetails(name),\n          item: sServObj.getItemByID(nodeID)\n        };\n      } else {\n        return null;\n      }\n    };\n    /**\n\t\t * Returns an item with a given id\n\t\t * @param nodeID id of the node\n\t\t * @return item with id\n\t\t */\n    sServObj.getItemByID = function (nodeID) {\n      var ret = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        var pos = level.items.map(function (e) {\n            return e.id;\n          }).indexOf(nodeID);\n        if (pos >= 0) {\n          ret = level.items[pos];\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns multiple item(s) from a level with 'name' by passing in\n\t\t * the start item 'id' and the length (how many objects to return)\n\t\t *    @param name\n\t\t *    @param id\n\t\t *    @param length\n\t\t */\n    sServObj.getItemsFromLevelByIdAndLength = function (name, id, length) {\n      var ret = [];\n      var lastID = id;\n      for (var j = 0; j < length; j++) {\n        var segment = sServObj.getItemFromLevelById(name, lastID);\n        lastID = sServObj.getNextItem(name, segment.id);\n        ret.push(segment);\n      }\n      return ret;\n    };\n    /**\n\t\t * Getter for last edit Area Element\n\t\t *   @return lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.getlasteditAreaElem = function () {\n      return sServObj.lasteditAreaElem;\n    };\n    /**\n\t\t * Setter for last edit Area Element\n\t\t *   @param lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.setlasteditAreaElem = function (e) {\n      sServObj.lasteditAreaElem = e;\n    };\n    /**\n\t\t * Setter for last edit Area\n\t\t *   @param lasteditAreaElem last edit Area\n\t\t */\n    sServObj.setlasteditArea = function (name) {\n      sServObj.lasteditArea = name;\n    };\n    /**\n\t\t * Getter for last edit Area\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlasteditArea = function () {\n      return sServObj.lasteditArea;\n    };\n    /**\n\t\t * Getter for id of last edited Element\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlastID = function () {\n      return sServObj.lasteditArea.substr(1);\n    };\n    /**\n\t\t * Remove currently open html textarea (if there is a textarea open)\n\t\t * and set viewState.editing to false.\n\t\t */\n    sServObj.deleteEditArea = function () {\n      if (null !== sServObj.getlasteditArea()) {\n        $('.' + sServObj.getlasteditArea()).remove();\n      }\n      viewState.editing = false;\n    };\n    /**\n\t\t * Calculate values (x,y,width,height) for textarea to open\n\t\t * depending on the current Level type, the current canvas\n\t\t * and the current clicked Element\n\t\t *   @param lastEventClick the current clicked Level Element\n\t\t *   @param element the current html Element to get canvas from\n\t\t *   @param type the current Level type\n\t\t */\n    sServObj.openEditArea = function (lastEventClick, element, type) {\n      var levelName = viewState.getcurClickLevelName();\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      // find labelIdx\n      var labelIdx = getLabelIdx(attrDefName, lastEventClick.labels);\n      var elem = element.find('canvas').context.getContext('2d');\n      var clientWidth = elem.canvas.clientWidth;\n      var clientOffset = elem.canvas.offsetLeft;\n      var top = elem.canvas.offsetTop;\n      var height = elem.canvas.clientHeight - 1;\n      var len = 10;\n      if (labelIdx !== undefined) {\n        if (lastEventClick.labels[labelIdx].value.length > 0) {\n          len = lastEventClick.labels[labelIdx].value.length * 7;\n        }\n      }\n      var editText = '';\n      if (lastEventClick.labels.length > 0) {\n        if (lastEventClick.labels[labelIdx] !== undefined) {\n          editText = lastEventClick.labels[labelIdx].value;\n        } else {\n          editText = '';\n        }\n      }\n      if (type === 'SEGMENT') {\n        var start = Math.floor(viewState.getPos(clientWidth, lastEventClick.sampleStart) + clientOffset);\n        var end = Math.ceil(viewState.getPos(clientWidth, lastEventClick.sampleStart + lastEventClick.sampleDur + 1) + clientOffset);\n        var width = end - start;\n        sServObj.createEditAreaElement(element, start, top, end - start, height, lastEventClick.labels[labelIdx].value, lastEventClick.id);  /*\n\tzooming in disabled\n\t\n\t\t\t\tif (width < (2 * len)) {\n\t\t\t\t\tvar zoom = viewState.curViewPort.eS - viewState.curViewPort.sS;\n\t\t\t\t\tif (zoom <= 10) { // if already zoomed in but text is still too long\n\t\t\t\t\t\tsServObj.createEditAreaElement(element, start, top, end - start, height, lastEventClick.labels[labelIdx].value, lastEventClick.id);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tviewState.zoomViewPort(true, this);\n\t\t\t\t\t\tsServObj.openEditArea(lastEventClick, element, type);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n*/\n      } else {\n        var start = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset - len / 2;\n        var end = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset + len / 2;\n        var width = end - start;\n        if (width < 2 * len) {\n          width = 2 * len;\n        }\n        sServObj.createEditAreaElement(element, start, top, width, height, editText, lastEventClick.id);\n      }\n      sServObj.createSelection(element.find('textarea')[0], 0, editText.length);\n    };\n    /**\n\t\t * Create a Text Selection in a html Textarea\n\t\t *   @param field the textarea element\n\t\t *   @param start the starting character position as int\n\t\t *   @param end the ending character position as int\n\t\t */\n    sServObj.createSelection = function (field, start, end) {\n      if (field.createTextRange) {\n        var selRange = field.createTextRange();\n        selRange.collapse(true);\n        selRange.moveStart('character', start);\n        selRange.moveEnd('character', end);\n        selRange.select();\n      } else if (field.setSelectionRange) {\n        field.setSelectionRange(start, end);\n      } else if (field.selectionStart) {\n        field.selectionStart = start;\n        field.selectionEnd = end;\n      }\n      field.focus();\n    };\n    /**\n\t\t * create a html textarea element at given\n\t\t *   @param x the x Position\n\t\t *   @param y the y Position\n\t\t *   @param width the Width\n\t\t *   @param height the Height\n\t\t *   @param label the Text Content of the Textarea\n\t\t *   @param labelid the id of the element\n\t\t */\n    sServObj.createEditAreaElement = function (element, x, y, width, height, label, labelid) {\n      var textid = '_' + labelid;\n      element.prepend($('<textarea>').attr({\n        id: textid,\n        'class': textid + ' emuwebapp-label-edit',\n        'ng-model': 'message',\n        'autofocus': 'true'\n      }).css({\n        'left': Math.round(x + 2) + 'px',\n        'top': Math.round(y + 1) + 'px',\n        'width': Math.round(width) - 2 + 'px',\n        'height': Math.round(height) - 20 + 'px',\n        'padding-top': Math.round(height / 3 + 1) + 'px'\n      }).text(label));\n    };\n    /**\n\t\t * insert a new Item with id labelname start and duration at position on level\n\t\t */\n    sServObj.insertItemDetails = function (id, levelname, position, labelname, start, duration) {\n      var attrdefs = ConfigProviderService.getLevelDefinition(levelname).attributeDefinitions;\n      var curAttrDef = viewState.getCurAttrDef(levelname);\n      var newElement;\n      if (attrdefs === undefined) {\n        // ugly hack if attrdefs undefined\n        attrdefs = [];\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          if (level.type == 'SEGMENT') {\n            newElement = {\n              id: id,\n              sampleStart: start,\n              sampleDur: duration,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          } else if (level.type == 'EVENT') {\n            if (start !== undefined) {\n              newElement = {\n                id: id,\n                samplePoint: start,\n                labels: []\n              };\n            } else {\n              newElement = {\n                id: id,\n                labels: []\n              };\n            }\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          }\n          level.items.splice(position, 0, newElement);\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updateSegment = function (levelname, id, labelname, labelIdx, start, duration) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              if (start !== undefined) {\n                element.sampleStart = start;\n              }\n              if (duration !== undefined) {\n                element.sampleDur = duration;\n              }\n              if (labelname !== undefined) {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updatePoint = function (levelname, id, labelname, labelIdx, start) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              element.samplePoint = start;\n              if (labelIdx === undefined) {\n                element.labels[0].value = labelname;\n              } else {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * gets item details by passing in levelName and item id's\n\t\t */\n    sServObj.getItemNeighboursFromLevel = function (levelName, firstid, lastid) {\n      var left = undefined;\n      var right = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (itm, num) {\n            if (itm.id == firstid) {\n              left = level.items[num - 1];\n            }\n            if (itm.id == lastid) {\n              right = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return {\n        left: left,\n        right: right\n      };\n    };\n    /**\n\t\t * get item details by passing in level, sampleNr and maximum pcm\n\t\t *\n\t\t * @param level\n\t\t * @param sampleNr\n\t\t * @param maximum\n\t\t * @returns object of the form {current: item, nearest: item, isFirst: boolean, isLast: boolean} where\n\t\t * - current is the actual item where the mouse is\n\t\t * - nearest is the item next to the current one depending on where the mouse is (ie if over 50% right element, under 50% left element)\n\t\t * - isFirst is true if the mouse is before the first item\n\t\t * - isLast is true if the mouse is after the last item\n\t\t *\n\t\t */\n    sServObj.getClosestItem = function (sampleNr, levelname, maximum) {\n      var level = sServObj.getLevelDetails(levelname);\n      var current = undefined;\n      var nearest = undefined;\n      var isFirst = undefined;\n      var isLast = undefined;\n      if (level !== undefined && level !== null && level.items.length > 0) {\n        current = nearest = level.items[0];\n        isFirst = true;\n        isLast = false;\n        if (level.type === 'SEGMENT') {\n          angular.forEach(level.items, function (itm, index) {\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              // 0.5 sample correction\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                if (sampleNr - itm.sampleStart >= itm.sampleDur / 2) {\n                  if (level.items[index + 1] !== undefined) {\n                    current = level.items[index];\n                    nearest = level.items[index + 1];\n                    isLast = false;\n                  } else {\n                    isLast = true;\n                    current = nearest = level.items[level.items.length - 1];\n                  }\n                } else {\n                  isLast = false;\n                  current = nearest = level.items[index];\n                }\n              }\n              isFirst = false;\n            }\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                current = itm;\n              } else {\n                isLast = true;\n                current = nearest = level.items[level.items.length - 1];\n              }\n            }\n          });\n        } else {\n          var spaceLower = 0;\n          var spaceHigher = 0;\n          isFirst = false;\n          isLast = false;\n          angular.forEach(level.items, function (evt, index) {\n            if (index < level.items.length - 1) {\n              spaceHigher = evt.samplePoint + (level.items[index + 1].samplePoint - level.items[index].samplePoint) / 2;\n            } else {\n              spaceHigher = maximum;\n            }\n            if (index > 0) {\n              spaceLower = evt.samplePoint - (level.items[index].samplePoint - level.items[index - 1].samplePoint) / 2;\n            } else {\n              spaceLower = 0;\n            }\n            if (sampleNr <= spaceHigher && sampleNr >= spaceLower) {\n              current = nearest = evt;\n            }\n          });\n        }\n      }\n      return {\n        current: current,\n        nearest: nearest,\n        isFirst: isFirst,\n        isLast: isLast\n      };\n    };\n    /**\n\t\t * deletes a level by its index\n\t\t */\n    sServObj.deleteLevel = function (levelIndex, curPerspectiveIdx) {\n      var lvl = DataService.getLevelDataAt(levelIndex);\n      DataService.deleteLevelDataAt(levelIndex);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 1);\n      return lvl;\n    };\n    /**\n\t\t * adds a level by its name\n\t\t */\n    sServObj.insertLevel = function (originalLevel, levelIndex, curPerspectiveIdx) {\n      if (DataService.getLevelData() === undefined) {\n        DataService.setLevelData([]);\n      }\n      DataService.insertLevelDataAt(levelIndex, originalLevel);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 0, originalLevel.name);\n    };\n    /**\n\t\t * rename the label of an element by passing in level name and id\n\t\t */\n    sServObj.renameLabel = function (levelName, id, attrIndex, newLabelName) {\n      sServObj.updateSegment(levelName, id, newLabelName, attrIndex);\n    };\n    /**\n\t\t * rename a level by passing in old and new level name and perspective id\n\t\t */\n    sServObj.renameLevel = function (oldname, newname, curPerspectiveIdx) {\n      //rename level name\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === oldname) {\n          level.name = newname;\n          angular.forEach(viewState.curLevelAttrDefs, function (def, i) {\n            if (def.curAttrDefName === oldname && def.levelName === oldname) {\n              viewState.curLevelAttrDefs.slice(i, 1);\n            }\n          });\n          viewState.curLevelAttrDefs.push({\n            curAttrDefName: newname,\n            levelName: newname\n          });\n          // rename all first label names to match new\n          angular.forEach(level.items, function (item) {\n            item.labels[0].name = newname;\n          });\n        }\n      });\n      // update order name as well\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order[ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.indexOf(oldname)] = newname;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegmentsInvers = function (name, id, length, deletedSegment) {\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx;\n      var x, insertPoint;\n      insertPoint = 0;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          insertPoint = deletedSegment.order;\n          for (x in deletedSegment.segments) {\n            level.items.splice(insertPoint++, 0, deletedSegment.segments[x]);\n          }\n        }\n      });\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, deletedSegment.segments[0].id, deletedSegment.segments[deletedSegment.segments.length - 1].id);\n      if (lastNeighbours.left !== undefined && lastNeighbours.right === undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegment(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeRight);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.right.labels);\n        sServObj.updateSegment(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeLeft, lastNeighbours.right.sampleDur - deletedSegment.timeLeft);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right === undefined) {\n      } else {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegment(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeLeft);\n        sServObj.updateSegment(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeRight, lastNeighbours.right.sampleDur - deletedSegment.timeRight);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegments = function (name, id, length) {\n      var firstSegment = sServObj.getItemFromLevelById(name, id);\n      var firstOrder = sServObj.getOrderById(name, id);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var timeLeft = 0;\n      var timeRight = 0;\n      var deleteOrder = null;\n      var deletedSegment = null;\n      var clickSeg = null;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      for (var i = firstOrder; i < firstOrder + length; i++) {\n        timeLeft += sServObj.getItemDetails(name, i).sampleDur + 1;\n      }\n      if (timeLeft % 2 == 0) {\n        timeLeft = timeLeft / 2;\n        timeRight = timeLeft;\n      } else {\n        timeLeft = Math.ceil(timeLeft / 2);\n        timeRight = timeLeft - 1;\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          angular.forEach(level.items, function (evt, order) {\n            if (evt.id == id) {\n              deleteOrder = order;\n              deletedSegment = level.items.splice(deleteOrder, length);\n            }\n          });\n        }\n      });\n      if (neighbours.left !== undefined && neighbours.right === undefined) {\n        sServObj.updateSegment(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      } else if (neighbours.left === undefined && neighbours.right !== undefined) {\n        sServObj.updateSegment(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeLeft, neighbours.right.sampleDur + timeLeft);\n        clickSeg = neighbours.right;\n      } else if (neighbours.left === undefined && neighbours.right === undefined) {\n        // nothing left to do level empty now\n        viewState.setcurMouseItem(undefined, undefined, undefined);\n      } else {\n        sServObj.updateSegment(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeLeft);\n        sServObj.updateSegment(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeRight, neighbours.right.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      }\n      return {\n        order: deleteOrder,\n        segments: deletedSegment,\n        timeLeft: timeLeft,\n        timeRight: timeRight,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegmentInvers = function (name, start, end, newLabel) {\n      var ret = true;\n      var diff, diff2;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name) {\n          if (start == end) {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              var diff = 0;\n              if (t.items[startOrder] !== undefined) {\n                diff = t.items[startOrder].sampleDur + 1;\n              }\n              if (t.items[startOrder - 1] !== undefined) {\n                // if not leftmost item\n                t.items[startOrder - 1].sampleDur += diff;\n              }\n              t.items.splice(startOrder, 1);\n            }\n          } else {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              if (t.items[startOrder + 1] === undefined) {\n                // if rightmost item\n                t.items.splice(startOrder - 1, 2);\n              } else if (t.items[startOrder - 1] === undefined) {\n                // if leftmost item\n                t.items.splice(startOrder, 2);\n              } else {\n                // in the middle\n                diff = t.items[startOrder].sampleDur + 1;\n                diff2 = t.items[startOrder + 1].sampleDur + 1;\n                t.items[startOrder - 1].sampleDur += diff + diff2;\n                t.items.splice(startOrder, 2);\n              }\n            }\n          }\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegment = function (name, start, end, newLabel, ids) {\n      var ret = true;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          if (start == end) {\n            if (level.items.length == 0) {\n              // if on an empty level\n              return {\n                ret: false,\n                ids: ids\n              };\n            } else {\n              // if not on an empty level\n              if (ids === undefined) {\n                ids = [];\n                ids[0] = DataService.getNewId();\n              }\n              var startID = -1;\n              if (start < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - start;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, diff - 1);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var newStart = level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur + 1;\n                sServObj.insertItemDetails(ids[0], name, level.items.length, newLabel, newStart, start - newStart);\n              } else {\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (evt.sampleStart == start) {\n                    ret = false;\n                  }\n                  if (evt.sampleStart + evt.sampleDur + 1 == start) {\n                    ret = false;\n                  }\n                });\n                if (ret) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, level.items[startID].sampleDur - diff - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          } else {\n            if (ids === undefined) {\n              ids = [];\n              ids[0] = DataService.getNewId();\n              ids[1] = DataService.getNewId();\n            }\n            if (level.items.length == 0) {\n              // if on an empty level\n              sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, end - start - 1);\n            } else {\n              // if not on an empty level\n              if (end < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - end - 1;\n                var diff2 = end - start - 1;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, end, diff);\n                sServObj.insertItemDetails(ids[1], name, 0, newLabel, start, diff2);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var diff = start - (level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) - 1;\n                var diff2 = end - start - 1;\n                var len = level.items.length;\n                sServObj.insertItemDetails(ids[0], name, len, newLabel, level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur, diff);\n                sServObj.insertItemDetails(ids[1], name, len + 1, newLabel, start, diff2);\n              } else {\n                // in the middle\n                var startID = -1;\n                var endID = -1;\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (end >= evt.sampleStart && end <= evt.sampleStart + evt.sampleDur) {\n                    endID = id;\n                  }\n                });\n                ret = startID === endID;\n                if (ret && startID !== -1) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  var diff2 = end - start - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, diff2);\n                  sServObj.insertItemDetails(ids[1], name, startID + 2, newLabel, end, level.items[startID].sampleDur - diff - 1 - diff2 - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          }\n        }\n      });\n      return {\n        ret: ret,\n        ids: ids\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertEvent = function (name, start, pointName, id) {\n      var ret = false;\n      var alreadyExists = false;\n      var pos = undefined;\n      var last = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name && level.type === 'EVENT') {\n          if (level.items.length > 0) {\n            last = level.items[0].samplePoint;\n          } else {\n            last = 0;\n          }\n          angular.forEach(level.items, function (evt, order) {\n            if (Math.floor(start) === Math.floor(evt.samplePoint)) {\n              alreadyExists = true;\n            }\n            if (start > evt.samplePoint) {\n              pos = order + 1;\n            }\n          });\n        }\n      });\n      if (!alreadyExists) {\n        if (id === undefined) {\n          id = DataService.getNewId();\n        }\n        sServObj.insertItemDetails(id, name, pos, pointName, start);\n      }\n      return {\n        alreadyExists: alreadyExists,\n        id: id\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteEvent = function (name, id) {\n      var ret = false;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name && t.type == 'EVENT') {\n          var last = 0;\n          angular.forEach(t.items, function (evt, order) {\n            if (!ret) {\n              if (id == evt.id) {\n                ret = evt;\n                t.items.splice(order, 1);\n              }\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *   delete a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundary = function (name, id, isFirst, isLast) {\n      var toDelete = sServObj.getItemFromLevelById(name, id);\n      var last = null;\n      var retOrder = null;\n      var retEvt = null;\n      var clickSeg = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          last = level.items[0];\n          angular.forEach(level.items, function (evt, order) {\n            if (level.type === 'SEGMENT') {\n              if (toDelete.sampleStart == evt.sampleStart && toDelete.sampleDur == evt.sampleDur) {\n                if (order === 0 && isFirst) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[0];\n                } else if (order === level.items.length - 1 && isLast) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[level.items.length - 1];\n                } else {\n                  for (var i = 0; i < last.labels.length; i++) {\n                    last.labels[i].value += evt.labels[i].value;\n                  }\n                  last.sampleDur += evt.sampleDur + 1;\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = last;\n                }\n              }\n            }\n            last = evt;\n          });\n          if (clickSeg == null) {\n            clickSeg = level.items[0];\n          }\n        }\n      });\n      return {\n        order: retOrder,\n        event: retEvt,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *   restore a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundaryInvers = function (name, id, isFirst, isLast, deletedSegment) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.splice(deletedSegment.order, 0, deletedSegment.event);\n          var oldName = deletedSegment.event.labels[0].value;\n          if (!isFirst && !isLast) {\n            oldName = level.items[deletedSegment.order - 1].labels[0].value.slice(0, level.items[deletedSegment.order - 1].labels[0].value.length - deletedSegment.event.labels[0].value.length);\n            level.items[deletedSegment.order - 1].labels[0].value = oldName;\n            level.items[deletedSegment.order - 1].sampleDur -= deletedSegment.event.sampleDur + 1;\n          }\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.snapBoundary = function (toTop, levelName, segment, neighbor, type) {\n      var neighTd;\n      var neighTdIdx;\n      var absMinDist = Infinity;\n      var absDist;\n      var minDist = undefined;\n      var sample;\n      var sampleTarget;\n      if (type == 'SEGMENT') {\n        sample = segment.sampleStart;\n      } else if (type == 'EVENT') {\n        sample = segment.samplePoint;\n      }\n      angular.forEach(DataService.getLevelData(), function (thisTd, tIdx) {\n        if (thisTd.name === levelName) {\n          if (toTop) {\n            if (tIdx >= 1) {\n              neighTd = DataService.getLevelData()[tIdx - 1];\n            } else {\n              return false;\n            }\n          } else {\n            if (tIdx < DataService.getLevelData().length - 1) {\n              neighTd = DataService.getLevelData()[tIdx + 1];\n            } else {\n              return false;\n            }\n          }\n          neighTd.items.forEach(function (itm, order) {\n            if (neighTd.type == 'SEGMENT') {\n              sampleTarget = itm.sampleStart;\n            } else if (neighTd.type == 'EVENT') {\n              sampleTarget = itm.samplePoint;\n            }\n            absDist = Math.abs(sample - sampleTarget);\n            if (absDist < absMinDist) {\n              absMinDist = absDist;\n              minDist = sampleTarget - sample;\n            }\n          });\n        }\n      });\n      if (minDist !== undefined) {\n        if (type == 'SEGMENT') {\n          this.moveBoundary(levelName, segment.id, minDist, 0);\n        } else if (type == 'EVENT') {\n          this.moveEvent(levelName, segment.id, minDist);\n        }\n        return minDist;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t *  moves a boundary of a given segment\n\t\t *\n\t\t *  @param {string} name The name of the level in which the segment lies.\n\t\t *  @param {number} id The id of the segment.\n\t\t *  @param {number} changeTime The time to add or substract.\n\t\t *  @param {isFirst} if item is first\n\t\t *  @param {isLast} if item is last\n\t\t *\n\t\t */\n    sServObj.moveBoundary = function (levelName, id, changeTime, isFirst, isLast) {\n      var orig = sServObj.getItemFromLevelById(levelName, id);\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      var ln = sServObj.getItemNeighboursFromLevel(levelName, id, id);\n      if (isFirst) {\n        // before first item\n        var origRight = ln.right;\n        if (origRight !== undefined) {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n            sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        } else {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      } else if (isLast) {\n        // after last item\n        if (orig.sampleDur + changeTime >= 0 && orig.sampleDur + orig.sampleStart + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart, orig.sampleDur + changeTime);\n        }\n      } else {\n        if (ln.left === undefined) {\n          var origRight = ln.right;\n          if (origRight !== undefined) {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n              sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          } else {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          }\n        } else {\n          var origLeft = ln.left;\n          if (origLeft.sampleDur + changeTime >= 0 && orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0) {\n            sServObj.updateSegment(levelName, ln.left.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegment(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveEvent = function (name, id, changeTime) {\n      var orig = sServObj.getItemFromLevelById(name, id);\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      if (LinkService.isLinked(id)) {\n        var neighbour = sServObj.getItemNeighboursFromLevel(name, id, id);\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          // if within audio\n          if (neighbour.left !== undefined && neighbour.right !== undefined) {\n            // if between two events\n            // console.log('between two events')\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint && orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n              sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n            }\n          } else if (neighbour.left === undefined && neighbour.right === undefined) {\n            // if only event\n            // console.log('only element')\n            sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n          } else if (neighbour.left === undefined && neighbour.right !== undefined) {\n            // if first event\n            // console.log('first event')\n            if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n              sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n            }\n          } else if (neighbour.left !== undefined && neighbour.right === undefined) {\n            // if last event\n            // console.log('last event')\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n            }\n          }\n        }\n      } else {\n        // console.log('unlinked event')\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updatePoint(name, orig.id, orig.labels[0].value, labelIdx, orig.samplePoint + changeTime);\n        }\n        //resort Points after moving\n        angular.forEach(DataService.getLevelData(), function (t) {\n          if (t.name === name) {\n            t.items.sort(viewState.sortbystart);\n          }\n        });\n      }\n    };\n    /**\n\t\t * reorder points on Event level after moving them. This is needed when Points are moved before or after each other\n\t\t *\n\t\t */\n    sServObj.orderPoints = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.samplePoint > b.samplePoint)\n        return 1;\n      if (a.samplePoint < b.samplePoint)\n        return -1;\n      return 0;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveSegment = function (name, id, length, changeTime) {\n      var firstOrder = sServObj.getOrderById(name, id);\n      var firstSegment = sServObj.getItemDetails(name, firstOrder);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      if (firstSegment !== null && lastSegment !== null) {\n        var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n        var attrDefName = viewState.getCurAttrDef(name);\n        var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n        if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n          var right = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n          if (firstSegment.sampleStart + changeTime > 0 && lastNeighbours.right.sampleDur - changeTime >= 0) {\n            sServObj.updateSegment(name, right.id, undefined, labelIdx, right.sampleStart + changeTime, right.sampleDur - changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        } else if (lastNeighbours.right === undefined && lastNeighbours.left !== undefined) {\n          var left = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n          if (lastNeighbours.left.sampleDur + changeTime >= 0) {\n            if (lastSegment.sampleStart + lastSegment.sampleDur + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegment(name, left.id, undefined, labelIdx, left.sampleStart, left.sampleDur + changeTime);\n              for (var i = firstOrder; i < firstOrder + length; i++) {\n                var orig = sServObj.getItemDetails(name, i);\n                sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n              }\n            }\n          }\n        } else if (lastNeighbours.right !== undefined && lastNeighbours.left !== undefined) {\n          var origLeft = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n          var origRight = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n          if (origLeft.sampleDur + changeTime >= 0 && origRight.sampleDur - changeTime >= 0) {\n            sServObj.updateSegment(name, origLeft.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegment(name, origRight.id, undefined, labelIdx, origRight.sampleStart + changeTime, origRight.sampleDur - changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        } else if (lastNeighbours.right === undefined && lastNeighbours.left === undefined) {\n          var first = sServObj.getItemDetails(name, firstOrder);\n          var last = sServObj.getItemDetails(name, firstOrder + length - 1);\n          if (first.sampleStart + changeTime > 0 && last.sampleDur + last.sampleStart + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegment(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.expandSegment = function (rightSide, segments, name, changeTime) {\n      var startTime = 0;\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, segments[0].id, segments[segments.length - 1].id);\n      var segTime = changeTime * segments.length;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, segments[0].labels);\n      var tempItem;\n      var allow = true;\n      if (rightSide) {\n        // if expand or shrink on RIGHT side\n        if (neighbours.right === undefined) {\n          // last element\n          var lastLength = segments[segments.length - 1].sampleStart + segments[segments.length - 1].sampleDur + changeTime * segments.length;\n          if (lastLength <= Soundhandlerservice.wavJSO.Data.length) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegment(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.right.sampleDur - changeTime * segments.length > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegment(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n            sServObj.updateSegment(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart + startTime, neighbours.right.sampleDur - startTime);\n          }\n        }\n      } else {\n        // if expand or shrink on LEFT side\n        if (neighbours.left === undefined) {\n          // first element\n          var first = sServObj.getItemDetails(name, 0);\n          if (first.sampleStart + changeTime * (segments.length + 1) > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegment(name, tempItem.id, undefined, tempItem.sampleStart - changeTime, labelIdx, tempItem.sampleDur + changeTime);\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.left.sampleDur - changeTime * segments.length > 0) {\n            startTime = 0;\n            angular.forEach(segments, function (seg, i) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              startTime = -(segments.length - i) * changeTime;\n              sServObj.updateSegment(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n            });\n            sServObj.updateSegment(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur - segments.length * changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.calcDistanceToNearestZeroCrossing = function (sample) {\n      // walk right\n      var distRight = Infinity;\n      var distLeft = Infinity;\n      for (var i = sample; i < Soundhandlerservice.wavJSO.Data.length - 1; i++) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i + 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i + 1] >= 0) {\n          distRight = i - sample;\n          break;\n        }\n      }\n      // walk left\n      for (var i = sample; i > 1; i--) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i - 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i - 1] >= 0) {\n          distLeft = i - sample;\n          break;\n        }\n      }\n      var res;\n      if (Math.abs(distLeft) < Math.abs(distRight)) {\n        res = distLeft;\n      } else {\n        res = distRight + 1;\n      }\n      return res;\n    };\n    /**\n\t\t * Add an item to the end of the specified level\n\t\t *\n\t\t * @param level Name of the level onto which to push the new item\n\t\t * @param id (optional) if given, this id is used instead of a new one\n\t\t *\n\t\t * @returns id of the new item or -1 if no item has been added\n\t\t */\n    sServObj.pushNewItem = function (levelName, id) {\n      var level = sServObj.getLevelDetails(levelName);\n      console.debug(levelName, level, id);\n      // Check whether the level has time information\n      // and only proceed if this is not the case\n      if (level.type === 'ITEM') {\n        // Create new item object\n        if (typeof id === 'number') {\n          var newObject = {\n              id: id,\n              labels: []\n            };\n        } else {\n          var newObject = {\n              id: DataService.getNewId(),\n              labels: []\n            };\n        }\n        // Add all necessary labels\n        var attrdefs = ConfigProviderService.getLevelDefinition(level.name).attributeDefinitions;\n        for (var i = 0; i < attrdefs.length; ++i) {\n          if (attrdefs[i].type === 'STRING') {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: ''\n            });\n          } else {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: null\n            });\n          }\n        }\n        // Insert item into level\n        level.items.push(newObject);\n        return newObject.id;\n      } else {\n        return -1;\n      }\n    };\n    /**\n\t\t * Add an item next to the item with id === eid.\n\t\t * Do nothing if eid is not of type ITEM (ie, if it is on a level with time information)\n\t\t *\n\t\t * @param eid The ID of the element that will get a new sibling\n\t\t * @param before boolean to define whether the new sibling will be inserted before or after eid\n\t\t * @param newID optional, only used for redoing from within the history service. if given, no new id is requested from the DataService.\n\t\t *\n\t\t * @return the id of the newly added item (if an item has been added)\n\t\t * @return -1 (if no item has been added)\n\t\t */\n    sServObj.addItem = function (eid, before, newID) {\n      // Check parameters\n      if (eid === undefined) {\n        return -1;\n      }\n      if (typeof before !== 'boolean') {\n        return -1;\n      }\n      // Find the level and item objects corresponding to the given id\n      var levelAndItem = sServObj.getLevelAndItem(eid);\n      if (levelAndItem === null) {\n        console.debug('Could not find item with id:', eid);\n        return -1;\n      }\n      var level = levelAndItem.level;\n      var item = levelAndItem.item;\n      // Check whether the level has time information\n      // and only proceed if this is not the case\n      if (level.type === 'ITEM') {\n        // Find position of the given element and\n        // define position of the new one\n        var posOld = level.items.indexOf(item);\n        var posNew;\n        if (before === true) {\n          posNew = posOld;\n        } else {\n          posNew = posOld + 1;\n        }\n        // Create new item object\n        if (newID === undefined) {\n          var newObject = {\n              id: DataService.getNewId(),\n              labels: []\n            };\n        } else {\n          var newObject = {\n              id: newID,\n              labels: []\n            };\n        }\n        // Add all necessary labels\n        var attrdefs = ConfigProviderService.getLevelDefinition(level.name).attributeDefinitions;\n        for (var i = 0; i < attrdefs.length; ++i) {\n          if (attrdefs[i].type === 'STRING') {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: ''\n            });\n          } else {\n            newObject.labels.push({\n              name: attrdefs[i].name,\n              value: null\n            });\n          }\n        }\n        // Insert item into level\n        level.items.splice(posNew, 0, newObject);\n        return newObject.id;\n      }\n      return -1;\n    };\n    /**\n\t\t * This is only used as an undo function for the above addItem() and pushNewItem()\n\t\t *\n\t\t * Deletes an item but doesn't check whether there are links to or from it\n\t\t */\n    sServObj.addItemInvers = function (id) {\n      var levels = DataService.getLevelData();\n      for (var i = 0; i < levels.length; ++i) {\n        for (var ii = 0; ii < levels[i].items.length; ++ii) {\n          if (levels[i].items[ii].id === id) {\n            levels[i].items.splice(ii, 1);\n            return;\n          }\n        }\n      }\n    };\n    /**\n\t\t * Delete an item (of type ITEM, not of type SEGMENT or EVENT)\n\t\t * and all links that lead from or to it\n\t\t *\n\t\t * @param id The ID of the item to be deleted\n\t\t * @return an object like {item: object/undefined, ...} (an undefined value of item means that nothing has been done)\n\t\t */\n    sServObj.deleteItemWithLinks = function (id) {\n      var result = {\n          item: undefined,\n          levelName: undefined,\n          position: undefined,\n          deletedLinks: []\n        };\n      var levelAndItem = sServObj.getLevelAndItem(id);\n      if (levelAndItem === null) {\n        // item with the specified id does not exist\n        return result;\n      }\n      var level = levelAndItem.level;\n      var item = levelAndItem.item;\n      if (level.type !== 'ITEM') {\n        // Never touch non-ITEMs\n        return result;\n      }\n      // Delete the item itself\n      console.log('Deleting item:', item, 'From level:', level);\n      result.item = item;\n      result.levelName = level.name;\n      result.position = level.items.indexOf(item);\n      level.items.splice(level.items.indexOf(item), 1);\n      // Delete all links that lead from or to the item\n      // Iterate over the links array backwards so we can manipulate the array from within the loop\n      var links = DataService.getLinkData();\n      for (var i = links.length - 1; i >= 0; --i) {\n        if (links[i].fromID === id || links[i].toID === id) {\n          console.log('Deleting link', i);\n          result.deletedLinks.push(links[i]);\n          links.splice(i, 1);\n        }\n      }\n      return result;\n    };\n    /**\n\t\t * undo the deletion of an item with its links\n\t\t */\n    sServObj.deleteItemWithLinksInvers = function (item, levelName, position, deletedLinks) {\n      // Re-add item\n      sServObj.getLevelDetails(levelName).items.splice(position, 0, item);\n      // Re-add deleted links\n      for (var i = 0; i < deletedLinks.length; ++i) {\n        DataService.insertLinkData(deletedLinks[i]);\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('LinkService', [\n  'DataService',\n  function LinkService(DataService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * adds single links by pairing all childIds\n\t\t * with the parent id (form=={'fromID':fromID, 'toID':toID})\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t */\n    sServObj.insertLink = function (fromID, toID) {\n      DataService.insertLinkData({\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * adds single links to DataService\n\t\t * by pairing all childIds with the parent\n\t\t * at a given position\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t * @param order position of the node pair\n\t\t */\n    sServObj.insertLinkAt = function (fromID, toID, order) {\n      DataService.insertLinkDataAt(order, {\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * removes single link from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLink = function (fromID, toID) {\n      var ret = -1;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.deleteLinkDataAt(linkIdx);\n          ret = linkIdx;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given link exists\n\t\t * that matches the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.linkExists = function (fromID, toID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasParents = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.toID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasChildren = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents or children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.isLinked = function (ID) {\n      return sServObj.hasChildren(ID) || sServObj.hasParents(ID);\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all childIds with the parent\n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksTo = function (fromID, toIDs) {\n      angular.forEach(toIDs, function (toID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to children from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksTo = function (fromID, toIDs) {\n      var ret = [];\n      angular.forEach(toIDs, function (toID) {\n        sServObj.deleteLink(fromID, toID);\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n      });\n      return ret;\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all parentIds with the child\n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksFrom = function (fromIDs, toID) {\n      angular.forEach(fromIDs, function (fromID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to parents from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksFrom = function (fromIDs, toID) {\n      var ret = [];\n      angular.forEach(fromIDs, function (fromID) {\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n        sServObj.deleteLink(fromID, toID);\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksTo = function (toID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.toID === toID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksFrom = function (fromID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID})\n\t\t * to (to=={'fromID':fromID, 'toID':toNewID})\n\t\t */\n    sServObj.changeLinkTo = function (fromID, toID, toNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromID, toNewID);\n        }\n      });\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID})\n\t\t * to (to=={'fromID':fromID, 'toID':toNewID})\n\t\t */\n    sServObj.changeLinkFrom = function (fromID, toID, fromNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromNewID, toID);\n        }\n      });\n    };\n    /**\n\t\t * removes multiple links from and to ID\n\t\t */\n    sServObj.deleteLinkSegment = function (segments) {\n      var linksTo = [];\n      var linksFrom = [];\n      angular.forEach(segments, function (segment) {\n        angular.forEach(sServObj.getLinksTo(segment.id), function (found) {\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n        angular.forEach(sServObj.getLinksFrom(segment.id), function (found) {\n          linksFrom.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n      });\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID\n\t\t */\n    sServObj.deleteLinkSegmentInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n    };\n    /**\n\t\t * reorganizes multiple links from and to ID\n\t\t * if a boundary between two items is deleted\n\t\t */\n    sServObj.deleteLinkBoundary = function (ID, neighbourID) {\n      var linksTo = [];\n      var linksFrom = [];\n      var ord = 0;\n      if (neighbourID > 0) {\n        // if not first item\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          if (sServObj.linkExists(found.link.fromID, neighbourID)) {\n            ord = sServObj.deleteLink(found.link.fromID, ID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkTo(found.link.fromID, ID, neighbourID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          if (sServObj.linkExists(neighbourID, found.link.toID)) {\n            ord = sServObj.deleteLink(ID, found.link.toID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkFrom(ID, found.link.toID, neighbourID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n      } else {\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          ord = sServObj.deleteLink(found.link.fromID, ID);\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: ID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          ord = sServObj.deleteLink(ID, found.link.toID);\n          linksFrom.push({\n            fromID: ID,\n            toID: found.link.toID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n      }\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID\n\t\t */\n    sServObj.deleteLinkBoundaryInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkTo(found.fromID, found.neighbourID, found.toID);\n        }\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkFrom(found.neighbourID, found.toID, found.fromID);\n        }\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Websockethandler', [\n  '$q',\n  '$rootScope',\n  '$location',\n  '$timeout',\n  'HistoryService',\n  'Ssffparserservice',\n  'ConfigProviderService',\n  'viewState',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Espsparserservice',\n  'uuid',\n  'Binarydatamaniphelper',\n  'Ssffdataservice',\n  'modalService',\n  function Websockethandler($q, $rootScope, $location, $timeout, HistoryService, Ssffparserservice, ConfigProviderService, viewState, Wavparserservice, Soundhandlerservice, Espsparserservice, uuid, Binarydatamaniphelper, Ssffdataservice, modalService) {\n    // shared service object\n    var sServObj = {};\n    // Keep all pending requests here until they get responses\n    var callbacks = {};\n    // Create our websocket object with the address to the websocket\n    sServObj.ws = {};\n    // empty promise object to be resolved when connection is up\n    var conPromise = {};\n    var connected = false;\n    ////////////////////////////\n    // ws function\n    // broadcast on open\n    function wsonopen(message) {\n      connected = true;\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonmessage(message) {\n      try {\n        var jsonMessage = angular.fromJson(message.data);\n        listener(jsonMessage);\n      } catch (e) {\n        modalService.open('views/error.html', 'Got non-JSON string as message from server! This is not allowed! The message was: ' + message.data + ' which caused the angular.fromJson error: ' + e).then(function () {\n          sServObj.closeConnect();\n          $rootScope.$broadcast('resetToInitState');\n        });\n      }\n    }\n    function wsonerror(message) {\n      console.error('WEBSOCKET ERROR!!!!!');\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonclose(message) {\n      if (!message.wasClean && connected) {\n        modalService.open('views/error.html', 'A non clean disconnect to the server occurred! This probably means that the server is down. Please check the server and reconnect!').then(function () {\n          $rootScope.$broadcast('connectionDisrupted');\n        });\n      }\n      connected = false;\n      console.log('WEBSOCKET closed!!!!!');\n    }\n    function sendRequest(request) {\n      var defer = $q.defer();\n      var callbackId = getCallbackId();\n      callbacks[callbackId] = {\n        time: new Date(),\n        cb: defer\n      };\n      request.callbackID = callbackId;\n      sServObj.ws.send(angular.toJson(request));\n      // timeout request if not answered\n      $timeout(function () {\n        var tOutResp = {\n            'callbackID': callbackId,\n            'status': {\n              'type': 'ERROR:TIMEOUT',\n              'message': 'Sent request of type: ' + request.type + ' timed out after ' + ConfigProviderService.vals.main.serverTimeoutInterval + 'ms!  Please check the server...'\n            }\n          };\n        listener(tOutResp);\n      }, ConfigProviderService.vals.main.serverTimeoutInterval);\n      return defer.promise;\n    }\n    function listener(data) {\n      var messageObj = data;\n      // console.log(\"Received data from websocket: \", messageObj);\n      // If an object exists with callbackID in our callbacks object, resolve it\n      if (callbacks.hasOwnProperty(messageObj.callbackID)) {\n        // console.log(callbacks[messageObj.callbackID]);\n        // console.log('resolving callback: ' + messageObj.type + ' Nr.: ' + messageObj.callbackID);\n        switch (messageObj.type) {\n        case 'getESPSfile':\n          alert('espsfile');\n          //handleReceivedESPS(messageObj.fileName, messageObj.data);\n          break;\n        case 'getSSFFfile':\n          alert('ssfffile');\n          //handleReceivedSSFF(messageObj.fileName, messageObj.data);\n          break;\n        }\n        // resolve promise with data only\n        if (messageObj.status.type === 'SUCCESS') {\n          $rootScope.$apply(callbacks[messageObj.callbackID].cb.resolve(messageObj.data));\n        } else {\n          // show protocol error and disconnect from server\n          sServObj.closeConnect();\n          $rootScope.$broadcast('resetToInitState');\n          $rootScope.$apply(modalService.open('views/error.html', 'Communication error with server! Error message is: ' + messageObj.status.message));\n        }\n        delete callbacks[messageObj.callbackID];\n      } else {\n        if (typeof messageObj.status === 'undefined') {\n          modalService.open('views/error.html', 'Just got JSON message from server that the EMU-webApp does not know how to deal with! This is not allowed!');\n        } else if (messageObj.status.type === 'ERROR:TIMEOUT') {\n        } else {\n          modalService.open('views/error.html', 'Received invalid messageObj.callbackID that could not be resolved to a request! This should not happen and indicates a bad server response! The invalid callbackID was: ' + messageObj.callbackID);\n        }\n      }\n    }\n    // This creates a new callback ID for a request\n    function getCallbackId() {\n      var newUUID = uuid.new();\n      return newUUID;\n    }\n    ///////////////////////////////////////////\n    // public api\n    sServObj.initConnect = function (url) {\n      var defer = $q.defer();\n      try {\n        sServObj.ws = new WebSocket(url);\n        sServObj.ws.onopen = wsonopen;\n        sServObj.ws.onmessage = wsonmessage;\n        sServObj.ws.onerror = wsonerror;\n        sServObj.ws.onclose = wsonclose;\n      } catch (err) {\n        return $q.reject('A malformed websocket URL that doesn\\'t start with ws:// or wss:// was provided.');\n      }\n      conPromise = defer;\n      return defer.promise;\n    };\n    //\n    sServObj.isConnected = function () {\n      return connected;\n    };\n    // close connection with ws\n    sServObj.closeConnect = function () {\n      if (sServObj.isConnected()) {\n        sServObj.ws.onclose = function () {\n        };\n        sServObj.ws.close();\n      } else {\n        console.log('WEBSOCKET ERROR: was not connected!');\n      }\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    // ws getProtocol\n    sServObj.getProtocol = function () {\n      var request = { type: 'GETPROTOCOL' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getProtocol\n    sServObj.getDoUserManagement = function () {\n      var request = { type: 'GETDOUSERMANAGEMENT' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws logOnUser\n    sServObj.logOnUser = function (name, pwd) {\n      var request = {\n          type: 'LOGONUSER',\n          userName: name,\n          pwd: pwd\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getConfigFile\n    sServObj.getDBconfigFile = function () {\n      var request = { type: 'GETGLOBALDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getBundleList\n    sServObj.getBundleList = function () {\n      var request = { type: 'GETBUNDLELIST' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  getBundle\n    sServObj.getBundle = function (name, session) {\n      var request = {\n          type: 'GETBUNDLE',\n          name: name,\n          session: session\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  saveBundle\n    sServObj.saveBundle = function (bundleData) {\n      var request = {\n          type: 'SAVEBUNDLE',\n          data: bundleData\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  saveConfiguration\n    sServObj.saveConfiguration = function (configData) {\n      var request = {\n          type: 'SAVEDBCONFIG',\n          data: configData\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  disconnecting\n    sServObj.disconnectWarning = function () {\n      var request = { type: 'DISCONNECTWARNING' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  GetDoEditDBConfig\n    sServObj.getDoEditDBConfig = function () {\n      var request = { type: 'GETDOEDITDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  editDBConfig with subtype and data\n    sServObj.editDBConfig = function (subtype, data) {\n      var request = {\n          type: 'EDITDBCONFIG',\n          subtype: subtype,\n          data: data\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Binarydatamaniphelper', function Binarydatamaniphelper() {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t *\n\t\t */\n  sServObj.base64ToArrayBuffer = function (stringBase64) {\n    var binaryString = window.atob(stringBase64);\n    var len = binaryString.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n      var ascii = binaryString.charCodeAt(i);\n      bytes[i] = ascii;\n    }\n    return bytes.buffer;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.arrayBufferToBase64 = function (buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  };\n  /**\n\t\t *\n\t\t sServObj.stringToArrayBuffer = function (str) {\n\t\t\tvar ab = new ArrayBuffer(str.length);\n\t\t\tvar view = new Uint8Array(ab);\n\t\t\tfor (var i = 0; i < str.length; ++i) {\n\t\t\t\tview[i] = str.charCodeAt(i);\n\t\t\t}\n\t\t\treturn ab;\n\t\t};\n\t\t */\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Appcachehandler', [\n  '$http',\n  'modalService',\n  function Appcachehandler($http, modalService) {\n    // shared service object\n    var sServObj = {};\n    var appCache = window.applicationCache;\n    // var cacheProperties = {\n    // \tfilesDownloaded: 0,\n    // \ttotalFiles: 0\n    // };\n    // function getTotalFiles() {\n    // \t// First, reset the total file count and download count.\n    // \tcacheProperties.filesDownloaded = 0;\n    // \tcacheProperties.totalFiles = 0;\n    // \t$http.get('manifest.appcache').success(function (content) {\n    // \t\t// console.log(content);\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp(\n    // \t\t\t\t'(NETWORK|FALLBACK):' +\n    // \t\t\t\t'((?!(NETWORK|FALLBACK|CACHE):)[\\\\w\\\\W]*)',\n    // \t\t\t\t'gi'\n    // \t\t\t),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out all comments.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('#[^\\\\r\\\\n]*(\\\\r\\\\n?|\\\\n)', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out the cache manifest header and\n    // \t\t// trailing slashes.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('CACHE MANIFEST\\\\s*|\\\\s*$', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out extra line breaks and replace with\n    // \t\t// a hash sign that we can break on.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('[\\\\r\\\\n]+', 'g'),\n    // \t\t\t'#'\n    // \t\t);\n    // \t\t// Get the total number of files.\n    // \t\tvar totalFiles = content.split('#').length;\n    // \t\t// Store the total number of files. Here, we are\n    // \t\t// adding one for *THIS* file, which is cached\n    // \t\t// implicitly as it points to the manifest.\n    // \t\tcacheProperties.totalFiles = (totalFiles + 1);\n    // \t\t// console.log('##########################');\n    // \t\t// alert('INFO: appcache update of: ' + cacheProperties.totalFiles + ' files');\n    // \t});\n    // }\n    // function handleCheckingEvent(e) {\n    // \tconsole.log('###### handleCheckingEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleNoupdateEvent(e) {\n    // \tconsole.log('###### handleNoupdateEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleDownloadingEvent(e) {\n    // \tconsole.log('######## handleDownloadingEvent ##########');\n    // \tconsole.log(e);\n    // \tgetTotalFiles();\n    // }\n    // function handleProgressEvent(e) {\n    // \tconsole.log('###### handleProgressEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    // function handleCachedEvent(e) {\n    // \tconsole.log('###### handleCachedEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    sServObj.handleUpdatereadyEvent = function () {\n      modalService.open('views/confirmModal.html', 'A new version of the EMU-WebApp is available and has already been downloaded and cached in your browser. Would you like to use it? CAUTION: A reload will delete all current changes... TIP: the next time you use the EMU-webApp you will automatically use the updated version)').then(function (res) {\n        if (res) {\n          localStorage.removeItem('haveShownWelcomeModal');\n          appCache.swapCache();\n          window.location.reload();\n        } else {\n          localStorage.removeItem('haveShownWelcomeModal');\n        }\n      });\n    };\n    // function handleObsoleteEvent(e) {\n    // \tconsole.log('###### handleObsoleteEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleErrorEvent(e) {\n    // \tconsole.log('###### handleErrorEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // // bind evts\n    // // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('checking', handleCheckingEvent, false);\n    // appCache.addEventListener('noupdate', handleNoupdateEvent, false);\n    // appCache.addEventListener('downloading', handleDownloadingEvent, false);\n    // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('cached', handleCachedEvent, false);\n    appCache.addEventListener('updateready', sServObj.handleUpdatereadyEvent, false);\n    // appCache.addEventListener('obsolete', handleObsoleteEvent, false);\n    // appCache.addEventListener('error', handleErrorEvent, false);\n    // /////////////////////////////////////////////////\n    // // public api\n    sServObj.checkForNewVersion = function () {\n      // console.log('check for new version');\n      if (appCache.status !== 0 && appCache.status !== 3) {\n        // uncached == 0 & downloading == 3\n        console.log('INFO: appCache.status: ' + appCache.status);\n        appCache.update();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('spectSettingsCtrl', [\n  '$scope',\n  'modalService',\n  'viewState',\n  'DataService',\n  'mathHelperService',\n  'Soundhandlerservice',\n  function ($scope, modalService, viewState, DataService, mathHelperService, Soundhandlerservice) {\n    $scope.vs = viewState;\n    $scope.options = Object.keys($scope.vs.getWindowFunctions());\n    $scope.selWindowInfo = {};\n    $scope.selWindowInfo.name = Object.keys($scope.vs.getWindowFunctions())[$scope.vs.spectroSettings.window - 1];\n    $scope.errorID = [];\n    $scope.upperBoundary = '';\n    $scope.modalVals = {\n      'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n      'rangeTo': $scope.vs.spectroSettings.rangeTo,\n      'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n      'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n      'window': $scope.vs.spectroSettings.window,\n      'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n      'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n      'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n      '_fftN': 512,\n      '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    //////////////////////////\n    // window size functions\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeInSamples = function () {\n      $scope.modalVals._windowSizeInSamples = Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcFftN = function () {\n      var fftN = mathHelperService.calcClosestPowerOf2Gt($scope.modalVals._windowSizeInSamples);\n      // fftN must be greater than 512 (leads to better resolution of spectrogram)\n      if (fftN < 512) {\n        fftN = 512;\n      }\n      $scope.modalVals._fftN = fftN;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeVals = function () {\n      $scope.calcWindowSizeInSamples();\n      $scope.calcFftN();\n    };\n    //\n    ////////////////////\n    /**\n\t\t *\n\t\t */\n    $scope.reset = function () {\n      $scope.errorID = [];\n      $scope.modalVals = {\n        'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n        'rangeTo': $scope.vs.spectroSettings.rangeTo,\n        'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n        'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n        'window': $scope.vs.spectroSettings.window,\n        'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n        'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n        'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n        '_fftN': 512,\n        '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n      };\n      modalService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cssError = function (id, id2) {\n      if ($scope.errorID[id]) {\n        return { 'background': '#f00' };\n      }\n      if (id2 !== undefined) {\n        if ($scope.errorID[id2]) {\n          return { 'background': '#f00' };\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.htmlError = function (id) {\n      return $scope.errorID[id];\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveSpectroSettings = function () {\n      var error = false;\n      $scope.errorID.forEach(function (entry) {\n        if (entry === true) {\n          error = true;\n        }\n      });\n      if (!error) {\n        viewState.setspectroSettings($scope.modalVals.windowSizeInSecs, $scope.modalVals.rangeFrom, $scope.modalVals.rangeTo, $scope.modalVals.dynamicRange, $scope.selWindowInfo.name, $scope.modalVals.drawHeatMapColors, $scope.modalVals.preEmphasisFilterFactor, $scope.modalVals.heatMapColorAnchors);\n        $scope.reset();\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.checkSpectroSettings = function () {\n      if ($scope.modalVals.heatMapColorAnchors[0][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[0][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[0][2] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][2] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][2] % 1 !== 0) {\n        $scope.errorID[8] = true;\n      } else {\n        $scope.errorID[8] = false;\n      }\n      if (isNaN($scope.modalVals.preEmphasisFilterFactor * Soundhandlerservice.wavJSO.SampleRate)) {\n        $scope.errorID[7] = true;\n      } else {\n        $scope.errorID[7] = false;\n      }\n      if (isNaN(Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs)) {\n        $scope.errorID[6] = true;\n      } else {\n        $scope.errorID[6] = false;\n      }\n      if ($scope.modalVals.dynamicRange % 1 !== 0) {\n        $scope.errorID[5] = true;\n      } else {\n        $scope.errorID[5] = false;\n      }\n      if ($scope.modalVals.rangeFrom % 1 !== 0) {\n        $scope.errorID[4] = true;\n      } else {\n        $scope.errorID[4] = false;\n      }\n      if ($scope.modalVals.rangeTo % 1 !== 0) {\n        $scope.errorID[3] = true;\n      } else {\n        $scope.errorID[3] = false;\n      }\n      if ($scope.modalVals.rangeFrom < 0) {\n        $scope.errorID[2] = true;\n      } else {\n        $scope.errorID[2] = false;\n      }\n      $scope.upperBoundary = DataService.data.sampleRate / 2;\n      if ($scope.modalVals.rangeTo > $scope.upperBoundary) {\n        $scope.errorID[1] = true;\n      } else {\n        $scope.errorID[1] = false;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').filter('regex', function () {\n  return function (input, regex) {\n    var patt = new RegExp(regex.toLowerCase());\n    var out = [];\n    for (var i = 0; i < input.length; i++) {\n      if (patt.test(input[i].name.toLowerCase())) {\n        out.push(input[i]);\n      }\n    }\n    return out;\n  };\n});\n'use strict';\nangular.module('emuwebApp').filter('levelsFilter', [\n  'ConfigProviderService',\n  'viewState',\n  function (ConfigProviderService, viewState) {\n    return function (input) {\n      if (input) {\n        var patt1 = new RegExp('SEGMENT|EVENT');\n        var out = [];\n        var idx;\n        for (var i = 0; i < input.length; i++) {\n          if (patt1.test(input[i].type)) {\n            if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases !== undefined) {\n              idx = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order.indexOf(input[i].name);\n              if (idx !== -1) {\n                out.push(input[i]);\n              }\n            }\n          }\n        }\n        return out;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ModalCtrl', [\n  '$scope',\n  'ArrayHelperService',\n  'browserDetector',\n  'modalService',\n  'viewState',\n  'LevelService',\n  'HistoryService',\n  'ConfigProviderService',\n  function ($scope, ArrayHelperService, browserDetector, modalService, viewState, LevelService, HistoryService, ConfigProviderService) {\n    $scope.cps = ConfigProviderService;\n    $scope.vs = viewState;\n    $scope.data = undefined;\n    $scope.mySelect = null;\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.saveChanges = function (name) {\n      modalService.close();\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.discardChanges = function (name) {\n      modalService.close();\n    };\n    /**\n\t\t *  Save a URL\n\t\t */\n    $scope.saveURL = function () {\n      var currentURLS = $scope.getURLs();\n      if (currentURLS.indexOf(modalService.dataOut) === -1) {\n        currentURLS.push(modalService.dataOut);\n      }\n      localStorage.setItem('urls', JSON.stringify(currentURLS));\n      $scope.myUrls = currentURLS;\n      $scope.mySelect = $scope.myUrls[0];\n    };\n    /**\n\t\t *  Return all URLs from localStorage\n\t\t */\n    $scope.getURLs = function () {\n      var curVal = localStorage.getItem('urls');\n      var urlData = [];\n      if (!browserDetector.isBrowser.PhantomJS() && curVal !== null) {\n        urlData = JSON.parse(curVal);\n      }\n      return urlData;\n    };\n    /**\n\t\t *  Return all URLs from localStorage\n\t\t */\n    $scope.setCurrentURL = function (data) {\n      modalService.dataOut = data;\n    };\n    /**\n\t\t *  delete a specific url\n\t\t */\n    $scope.deleteURL = function (data) {\n      var currentURLS = $scope.getURLs();\n      if (currentURLS.indexOf(data) !== -1) {\n        currentURLS.splice(currentURLS.indexOf(data), 1);\n      }\n      localStorage.setItem('urls', JSON.stringify(currentURLS));\n      $scope.myUrls = currentURLS;\n      $scope.mySelect = $scope.myUrls[0];\n    };\n    /**\n\t\t *  Rename a level\n\t\t */\n    $scope.renameLevel = function () {\n      LevelService.renameLevel(modalService.dataIn, $scope.data, viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'RENAMELEVEL',\n        'newname': $scope.data,\n        'name': modalService.dataIn,\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      modalService.close();\n    };\n    /**\n\t\t *  Delete a complete level from LevelService\n\t\t */\n    $scope.deleteLevel = function (name) {\n      var lvl = LevelService.getLevelDetails(viewState.getcurClickLevelName());\n      LevelService.deleteLevel(viewState.getcurClickLevelIndex(), viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'DELETELEVEL',\n        'level': lvl,\n        'id': viewState.getcurClickLevelIndex(),\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      modalService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showMenu', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showMenu, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.removeClass(element, 'emuwebapp-shrinkWidthTo0px');\n          } else {\n            $animate.removeClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showTwod', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showTwod, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, '.slideIn2dCanvases');\n          } else {\n            $animate.removeClass(element, '.slideIn2dCanvases');\n          }\n        });\n      }\n    };\n  }\n]);\n// simple animation to add slideLeft class\nangular.module('emuwebApp').animation('.slideIn2dCanvases', function () {\n  return {\n    addClass: function (element, className) {\n      element.addClass('slide2dCanvases');\n    },\n    removeClass: function (element, className) {\n      element.removeClass('slide2dCanvases');\n    }\n  };\n});\nangular.module('emuwebApp').directive('bgSplitter', [\n  '$rootScope',\n  'viewState',\n  function ($rootScope, viewState) {\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      scope: { showTwoDimCans: '@' },\n      template: '<div class=\"emuwebapp-split-panes vertical\" ng-transclude></div>',\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.panes = [];\n          $scope.bottomRightResizePane;\n          this.addPane = function (pane) {\n            if ($scope.panes.length > 1)\n              throw 'splitters can only have two panes';\n            $scope.panes.push(pane);\n            return $scope.panes.length;\n          };\n          this.setBottomRightResizePane = function (pane) {\n            $scope.bottomRightResizePane = pane;\n          };\n        }\n      ],\n      link: function (scope, element, attrs) {\n        var dragBottomRightResizePaneTopResizer = false;\n        var dragBottomRightResizePaneLeftResizer = false;\n        var dragBottomRightResizePaneCornerResizer = false;\n        // create split pane view\n        var handler = angular.element('<div id=\"emuwebapp-split-handler\" class=\"emuwebapp-split-handler\"><span></span></div>');\n        var pane1 = scope.panes[0];\n        var pane2 = scope.panes[1];\n        var pane3 = scope.bottomRightResizePane;\n        var bottomRightResizePaneTopResizer = angular.element('<div class=\"topBorder\"></div>');\n        var bottomRightResizePaneLeftResizer = angular.element('<div class=\"leftBorder\"></div>');\n        var bottomRightResizePaneCornerResizer = angular.element('<div class=\"corner\"></div>');\n        pane3.elem.prepend(bottomRightResizePaneLeftResizer);\n        pane3.elem.prepend(bottomRightResizePaneTopResizer);\n        pane3.elem.prepend(bottomRightResizePaneCornerResizer);\n        var pane1Min = pane1.minSize || 0;\n        var pane2Min = pane2.minSize || 0;\n        var dragSplitPaneResizer = false;\n        var drag = false;\n        pane1.elem.after(handler);\n        attrs.$observe('showTwoDimCans', function (val) {\n          if (val === 'false') {\n            scope.bottomRightResizePane.elem.hide();\n          } else {\n            scope.bottomRightResizePane.elem.show();\n          }\n        });\n        ////////////////////\n        // bindings\n        element.bind('mousemove', function (ev) {\n          if (!drag)\n            return;\n          // check if scrollbar exists -> set scrollbar on pane1 to ensure equal indentation due to scrollbar width\n          if (pane2.elem[0].scrollHeight > pane2.elem[0].clientHeight + 1) {\n            pane1.elem.css('overflow-y', 'scroll');\n          } else {\n            pane1.elem.css('overflow-y', 'hidden');\n          }\n          var bounds = element[0].getBoundingClientRect();\n          var pos = 0;\n          if (dragSplitPaneResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            // perc = pos/height * 100;\n            // console.log(perc);\n            if (pos < pane1Min)\n              return;\n            if (height - pos < pane2Min)\n              return;\n            handler.css('top', pos + 'px');\n            pane1.elem.css('height', pos + 'px');\n            pane2.elem.css('top', pos + 'px');\n            viewState.setdragBarHeight(pos);\n            $rootScope.$digest();\n          }\n          if (dragBottomRightResizePaneTopResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneLeftResizer) {\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            //pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneCornerResizer) {\n            // do height and top\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n            // do width and left\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            //pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n        });\n        handler.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragSplitPaneResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneTopResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneTopResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneLeftResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneLeftResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneCornerResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneCornerResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        angular.element(document).bind('mouseup', function (ev) {\n          drag = false;\n          dragSplitPaneResizer = false;\n          dragBottomRightResizePaneTopResizer = false;\n          dragBottomRightResizePaneLeftResizer = false;\n          dragBottomRightResizePaneCornerResizer = false;\n          viewState.setdragBarActive(false);\n          $rootScope.$digest();\n        });\n      }\n    };\n  }\n]).directive('bgPane', function () {\n  return {\n    restrict: 'E',\n    require: '^bgSplitter',\n    replace: true,\n    transclude: true,\n    scope: {\n      minSize: '=',\n      type: '@',\n      showTwoDimCans: '@'\n    },\n    template: '<div class=\"{{typeclass}}\" ng-transclude></div>',\n    link: function (scope, element, attrs, bgSplitterCtrl) {\n      var newElement;\n      if (scope.type !== 'emuwebapp-2d-map') {\n        scope.elem = element;\n        scope.index = bgSplitterCtrl.addPane(scope);\n        scope.typeclass = 'split-pane' + scope.index;\n      } else {\n        scope.elem = element;\n        scope.index = 3;\n        scope.typeclass = 'emuwebapp-2d-map';\n        bgSplitterCtrl.setBottomRightResizePane(scope);\n      }\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('ssffTrack', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'loadedMetaDataService',\n  function ($timeout, viewState, ConfigProviderService, loadedMetaDataService) {\n    return {\n      templateUrl: 'views/ssffTrack.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var ssffCanvas = element.find('canvas')[1];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // var context = canvas0.getContext('2d');\n        var markupCtx = markupCanvas.getContext('2d');\n        var trackName;\n        scope.lmds = loadedMetaDataService;\n        attrs.$observe('trackName', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        scope.order = attrs.order;\n        /////////////////////\n        // watches\n        //\n        //\n        scope.$watch('vs.lastUpdate', function (newValue, oldValue) {\n          if (newValue != oldValue) {\n            scope.drawSsffTrackMarkup();\n          }\n        });\n        //\n        scope.$watch('vs.timelineSize', function () {\n          $timeout(scope.drawSsffTrackMarkup, ConfigProviderService.design.animation.duration);\n        });\n        scope.$watch('vs.curViewPort', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              if (newValue.name !== oldValue.name || newValue.session !== oldValue.session) {\n                scope.drawSsffTrackMarkup();\n              }\n            }\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawSsffTrackMarkup = function () {\n          if (!$.isEmptyObject(scope.ssffds.data)) {\n            if (scope.ssffds.data.length !== 0) {\n              markupCtx.clearRect(0, 0, markupCtx.canvas.width, markupCtx.canvas.height);\n              // draw moving boundary line if moving\n              scope.dhs.drawMovingBoundaryLine(markupCtx);\n              // draw current viewport selected\n              scope.dhs.drawCurViewPortSelected(markupCtx, false);\n              // draw min max an name of track\n              var tr = scope.cps.getSsffTrackConfig(trackName);\n              var col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n              scope.dhs.drawMinMaxAndName(markupCtx, trackName, col._minVal, col._maxVal, 2);\n            }\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('progressThing', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-progressThing\">{{vs.somethingInProgressTxt}}</div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the progressThing directive');\n        attrs.$observe('showThing', function (newVal) {\n          if (newVal === 'true') {\n            // $animate.removeClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.removeClass(element, 'emuwebapp-animationStopped');\n            $animate.addClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.addClass(element, 'emuwebapp-animationRunning');\n          } else {\n            // $animate.addClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.removeClass(element, 'emuwebapp-animationRunning');\n            $animate.addClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.addClass(element, 'emuwebapp-animationStopped');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('historyActionPopup', [\n  '$animate',\n  '$timeout',\n  'ConfigProviderService',\n  function ($animate, $timeout, ConfigProviderService) {\n    return {\n      template: '<div class=\"emuwebapp-history\"><div ng-bind-html=\"vs.historyActionTxt\"></div></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        ////////////////\n        //watches\n        scope.cps = ConfigProviderService;\n        scope.$watch('vs.historyActionTxt', function () {\n          if (scope.vs.historyActionTxt !== '') {\n            $animate.addClass(element, 'emuwebapp-history-fade').then(function () {\n              scope.$apply();\n              $timeout(function () {\n                $animate.removeClass(element, 'emuwebapp-history-fade').then(function () {\n                  $timeout(function () {\n                    scope.vs.historyActionTxt = '';\n                  }, scope.cps.design.animation.period);\n                  scope.$apply();\n                });\n              }, scope.cps.design.animation.period);\n            });\n          }\n        }, true);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dragout', [\n  'DataService',\n  'loadedMetaDataService',\n  'browserDetector',\n  'ConfigProviderService',\n  function (DataService, loadedMetaDataService, browserDetector, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      replace: true,\n      scope: { name: '@' },\n      link: function (scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        var el = element[0];\n        var dragIcon = document.createElement('img');\n        dragIcon.src = 'img/save.svg';\n        dragIcon.width = '35';\n        dragIcon.height = '35';\n        var dataString = '';\n        scope.generateURL = function () {\n          return scope.getURL(angular.toJson(DataService.getData(), true));\n        };\n        scope.isActive = function () {\n          if (attrs.name === loadedMetaDataService.getCurBndl().name) {\n            return true;\n          } else\n            return false;\n        };\n        scope.getURL = function (data) {\n          var objURL;\n          if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n            objURL = webkitURL.createObjectURL(scope.getBlob(data));\n          } else {\n            objURL = URL.createObjectURL(scope.getBlob(data));\n          }\n          return objURL;\n        };\n        scope.getBlob = function (data) {\n          var blob;\n          try {\n            blob = new Blob([data], { type: 'text/plain' });\n          } catch (e) {\n            // Backwards-compatibility\n            window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n            blob = new BlobBuilder();\n            blob.append(data);\n            blob = blob.getBlob();\n          }\n          return blob;\n        };\n        el.addEventListener('dragstart', function (e) {\n          console.log('dragstart');\n          if (scope.isActive()) {\n            this.classList.add('drag');\n            var url = scope.generateURL();\n            if (browserDetector.isBrowser.Firefox() || browserDetector.isBrowser.Chrome()) {\n              // normal <img png> is not scalable\n              // therefore generate div, place <img> in it and then scale\n              var div = document.createElement('div');\n              div.appendChild(dragIcon);\n              document.querySelector('body').appendChild(div);\n              e.dataTransfer.setDragImage(div, -8, -8);\n              e.dataTransfer.effectAllowed = 'move';\n              e.dataTransfer.setData('DownloadURL', 'application/json:' + attrs.name + '_annot.json:' + url);\n            }\n          } else {\n            e.preventDefault();\n            console.log('dropping inactive bundles is not allowed');\n          }\n          return false;\n        }, false);\n        el.addEventListener('dragend', function (e) {\n          console.log('dragend');\n          if (scope.isActive()) {\n            this.classList.remove('drag');\n            e.preventDefault();\n          }\n          return false;\n        }, false);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuhierarchy', [\n  'viewState',\n  'HistoryService',\n  'DataService',\n  'LevelService',\n  'HierarchyManipulationService',\n  'HierarchyLayoutService',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  '$timeout',\n  function (viewState, HistoryService, DataService, LevelService, HierarchyManipulationService, HierarchyLayoutService, Soundhandlerservice, ConfigProviderService, $timeout) {\n    return {\n      template: '<div class=\"emuwebapp-hierarchy-container\" ng-mousemove=\"checkLink($event)\"></div>',\n      restrict: 'E',\n      scope: {\n        vertical: '=',\n        playing: '='\n      },\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        //////////////////////\n        // private variables\n        // FIXME move these to viewState\n        scope.selectedItem;\n        scope.selectedLink;\n        scope.newLinkSrc;\n        // END FIXME\n        // Graphical offset from the SVG's border to the first nodes\n        // Note that level captions are drawn within that offset\n        scope.offsetX = 25;\n        scope.offsetY = 30;\n        // The same when in rotated mode\n        scope.vertOffsetX = 150;\n        scope.vertOffsetY = 25;\n        // Settings for CSS transitions\n        scope.transition = {\n          duration: 750,\n          links: false,\n          nodes: false,\n          rotation: false,\n          contextMenu: false\n        };\n        // Possible zoom range\n        scope.scaleExtent = [\n          0.5,\n          10\n        ];\n        // Possible pan range\n        scope.panningLimit = 0.95;\n        scope.allowCrossAxisZoom = false;\n        scope.allowCrossAxisPan = false;\n        // Boundaries for enforcing pan range\n        scope.timeAxisStartPosition = undefined;\n        scope.timeAxisEndPosition = undefined;\n        scope.crossAxisStartPosition = undefined;\n        scope.crossAxisEndPosition = undefined;\n        scope.northernBoundary = undefined;\n        scope.southernBoundary = undefined;\n        scope.westernBoundary = undefined;\n        scope.easternBoundary = undefined;\n        // While the user zooms (scrolls mouse wheel), many zoom events are\n        // fired. The last zoom event must be treated differently than the ones\n        // before it:\n        // A promise that can be cancelled from within scope.zoom()\n        scope.zoomTimeoutPromise = null;\n        // The last scale factor that was applied by a \"final zoom event\"\n        scope.lastScaleFactor = 1;\n        //\n        //////////////////////\n        //////////////////////\n        // watches\n        scope.viewState = viewState;\n        scope.hierarchyState = viewState.hierarchyState;\n        scope.historyService = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.$watch('hierarchyState.path', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Rendering due to path change: ', newValue);\n            scope.hierarchyState.newLinkFromID = undefined;\n            scope.render();\n          }\n        }, false);\n        scope.$watch('vertical', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Rendering due to rotation: ', newValue);\n            scope.rotate();\n          }\n        }, false);\n        scope.$watch('viewState.curLevelAttrDefs', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Rendering due to attribute change: ', newValue);\n            scope.render();\n          }\n        }, true);\n        scope.$watch('playing', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('Play() triggered', newValue, scope.selectedItem);\n            if (typeof scope.selectedItem !== 'undefined' && newValue !== 0) {\n              scope.play(scope.selectedItem);\n            }\n          }\n        }, true);\n        scope.$watch('historyService.movesAwayFromLastSave', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            console.debug('history service is active, rendering');\n            scope.render();\n          }\n        }, false);\n        scope.$watch('hierarchyState.newLinkFromID', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            scope.newLinkSrc = LevelService.getItemByID(newValue);\n            scope.render();\n          }\n        }, false);\n        scope.$watch('viewState.hierarchyState.isShown()', function (newValue) {\n          if (newValue === true) {\n            console.debug('Hierarchy modal activated, rendering');\n            scope.render();\n          }\n        }, false);\n        scope.$watch('hierarchyState.contextMenuID', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            scope.render();\n          }\n        }, false);\n        scope.$watch('hierarchyState.resize', function (newValue, oldValue) {\n          console.debug('Rendering due to window resize');\n          if (newValue !== oldValue) {\n            scope.render();\n          }\n        }, false);\n        //\n        //////////////////////\n        //////////////////////\n        // helper functions\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.selectItem = function (item) {\n          scope.selectedItem = item;\n          viewState.hierarchyState.selectedItemID = item.id;\n        };\n        scope.selectLink = function (link) {\n          scope.selectedLink = link;\n          viewState.hierarchyState.selectedLinkFromID = link.fromID;\n          viewState.hierarchyState.selectedLinkToID = link.toID;\n        };\n        /**\n\t\t\t\t * Function to center node when clicked/dropped so node doesn't get lost when\n\t\t\t\t * collapsing/moving with large amount of children.\n\t\t\t\t *\n\t\t\t\t scope.centerNode = function (node) {\n\t\tvar x = -node._x + scope.width/2;\n\t\tvar y = -node._y  + scope.height/2;\n\t\tscope.svg.transition()\n\t\t\t.duration(scope.transition.duration)\n\t\t\t.attr('transform', scope.getOrientatedTransform()+'translate(' + x + ',' + y + ')');\n\t\tscope.zoomListener.translate([x, y]);\n\t};\n\t\t\t\t */\n        /**\n\t\t\t\t * The zoom function is called by the zoom listener, which listens for d3 zoom events and must be appended to the svg element\n\t\t\t\t */\n        scope.zoom = function () {\n          // Make sure panning is within allowed regions\n          scope.limitPanning();\n          // Save translate and scale so they can be re-used when the modal is re-opened\n          viewState.hierarchyState.translate = scope.zoomListener.translate();\n          viewState.hierarchyState.scaleFactor = scope.zoomListener.scale();\n          // Transform all SVG elements\n          // Note that scope.svg is actually not the svg itself but rather the main <g> within it\n          // Note further that scope.captionLayer is a sibling and not a descendant of scope.svg\n          scope.svg.attr('transform', scope.getOrientatedTransform(true));\n          scope.captionLayer.attr('transform', scope.getOrientatedLevelCaptionLayerTransform);\n          scope.captionLayer.selectAll('g.emuhierarchy-levelcaption').attr('transform', scope.getOrientatedLevelCaptionTransform);\n          // Call scope.render(), but make sure it's only called once a rush of zoom events has finished\n          if (scope.zoomTimeoutPromise !== null) {\n            $timeout.cancel(scope.zoomTimeoutPromise);\n            scope.zoomTimeoutPromise = null;\n          }\n          scope.zoomTimeoutPromise = $timeout(scope.render, 200);\n        };\n        /**\n\t\t\t\t * Check if user's chosen panning value is within such limits that the\n\t\t\t\t * graph is still visible.\n\t\t\t\t *\n\t\t\t\t * Actually, a portion of the graph defined by (1-scope.limit)%.\n\t\t\t\t *\n\t\t\t\t * If the factor is not within that limit, reset it.\n\t\t\t\t */\n        scope.limitPanning = function () {\n          // Read user's panning value\n          var x = scope.zoomListener.translate()[0];\n          var y = scope.zoomListener.translate()[1];\n          if (scope.vertical) {\n            if (!scope.allowCrossAxisPan) {\n              y = 0;\n            } else {\n              if (y > scope.southernBoundary - scope.crossAxisStartPosition) {\n                y = scope.southernBoundary - scope.crossAxisStartPosition;\n              }\n              if (y < scope.northernBoundary - scope.crossAxisEndPosition) {\n                y = scope.northernBoundary - scope.crossAxisEndPosition;\n              }\n            }\n            if (x > scope.easternBoundary - scope.timeAxisStartPosition) {\n              x = scope.easternBoundary - scope.timeAxisStartPosition;\n            }\n            if (x < scope.westernBoundary - scope.timeAxisEndPosition) {\n              x = scope.westernBoundary - scope.timeAxisEndPosition;\n            }\n          } else {\n            if (!scope.allowCrossAxisPan) {\n              x = 0;\n            } else {\n              if (x > scope.easternBoundary - scope.crossAxisStartPosition) {\n                x = scope.easternBoundary - scope.crossAxisStartPosition;\n              }\n              if (x < scope.westernBoundary - scope.crossAxisEndPosition) {\n                x = scope.westernBoundary - scope.crossAxisEndPosition;\n              }\n            }\n            if (y > scope.southernBoundary - scope.timeAxisStartPosition) {\n              y = scope.southernBoundary - scope.timeAxisStartPosition;\n            }\n            if (y < scope.northernBoundary - scope.timeAxisEndPosition) {\n              y = scope.northernBoundary - scope.timeAxisEndPosition;\n            }\n          }\n          scope.zoomListener.translate([\n            x,\n            y\n          ]);\n        };\n        scope.rotate = function () {\n          // When rotating, we should preserve (to some accuracy)\n          // the part of the graph we're looking at.\n          // We therefore calculate how much of the graph is\n          // panned away before the rotation and try to restore\n          // that value afterwards.\n          var translate = scope.zoomListener.translate();\n          if (scope.vertical === true) {\n            // Changing from horizontal to vertical\n            var percentageAwayTimeAxis = translate[1] / scope.timeAxisEndPosition;\n            var percentageAwayCrossAxis = translate[0] / scope.crossAxisEndPosition;\n          } else {\n            // Changing from vertical to horizontal\n            var percentageAwayTimeAxis = translate[0] / scope.timeAxisEndPosition;\n            var percentageAwayCrossAxis = translate[1] / scope.crossAxisEndPosition;\n          }\n          scope.render();\n          percentageAwayTimeAxis = percentageAwayTimeAxis * scope.timeAxisEndPosition;\n          percentageAwayCrossAxis = percentageAwayCrossAxis * scope.crossAxisEndPosition;\n          if (scope.vertical === true) {\n            // Changing from horizontal to vertical\n            scope.zoomListener.translate([\n              percentageAwayTimeAxis,\n              percentageAwayCrossAxis\n            ]);\n          } else {\n            // Changing from vertical to horizontal\n            scope.zoomListener.translate([\n              percentageAwayCrossAxis,\n              percentageAwayTimeAxis\n            ]);\n          }\n          scope.limitPanning();\n          // Make sure the programmatic changes to the translate vector are applied\n          scope.zoomListener.event(scope.svg);\n        };\n        /**\n\t\t\t\t * This transform is applied to the main <g> within the SVG\n\t\t\t\t * That <g> contains all the nodes and links but not the level captions\n\t\t\t\t * and neither the time arrow\n\t\t\t\t */\n        scope.getOrientatedTransform = function (zoomInProgress) {\n          var transform = '';\n          if (scope.vertical) {\n            transform += 'translate(' + scope.zoomListener.translate()[0] + ',' + scope.zoomListener.translate()[1] + ')';\n            transform += 'scale(-1,1),rotate(90)';\n          } else {\n            transform += 'translate(' + scope.zoomListener.translate()[0] + ',' + scope.zoomListener.translate()[1] + ')';\n            transform += 'rotate(0)';\n          }\n          if (zoomInProgress === true) {\n            var factor = scope.zoomListener.scale() / scope.lastScaleFactor;\n            if (scope.allowCrossAxisZoom) {\n              transform += 'scale(' + factor + ')';\n            } else {\n              transform += 'scale(1,' + factor + ')';\n            }\n          }\n          return transform;\n        };\n        /**\n\t\t\t\t * This transform is applied to each individual node, which includes\n\t\t\t\t * both the circle and the label.\n\t\t\t\t *\n\t\t\t\t * It reverses the zoom factor applied to the complete graphics so that\n\t\t\t\t * the text doesn't consume more space than needed.\n\t\t\t\t */\n        scope.getOrientatedNodeTransform = function (d) {\n          // Parameter d is never used because this is independent from the node's position\n          if (scope.vertical) {\n            return 'scale(-1,1)rotate(90)';\n          } else {\n            return 'rotate(0)';\n          }\n        };\n        //\n        // This returns the stroke width for links\n        // It does not really depend on the orientation but rather on the zoom\n        // scale. It is named getORIENTATEDLinkStrokeWidth anyway because all\n        // functions are named like that, althoug they depend on both zoom\n        // scale and orientation.\n        scope.getOrientatedLinkStrokeWidth = function (d) {\n          return '2px';\n        };\n        scope.getOrientatedGhostLinkStrokeWidth = function (d) {\n          return '15px';\n        };\n        scope.getNodeText = function (d) {\n          var level = viewState.getCurAttrDef(LevelService.getLevelName(d.id));\n          for (var i = 0; i < d.labels.length; ++i) {\n            if (d.labels[i].name === level) {\n              return d.labels[i].value;\n            }\n          }\n          console.debug('Likely a bug: Did not find the label selected for display', 'Selected level:', level, 'Node: ', d);\n          return 'NO VALUE';\n        };\n        scope.getLevelCaptionText = function (levelName) {\n          var attributeDefinition = viewState.getCurAttrDef(levelName);\n          if (levelName === attributeDefinition) {\n            return levelName;\n          } else {\n            return levelName + ':' + attributeDefinition;\n          }\n        };\n        scope.getOrientatedNodeCollapseText = function (d) {\n          if (scope.vertical) {\n            if (viewState.hierarchyState.getCollapsed(d.id)) {\n              return '\\u2193';\n            } else {\n              return '\\u2191';\n            }\n          } else {\n            if (viewState.hierarchyState.getCollapsed(d.id)) {\n              return '\\u2192';\n            } else {\n              return '\\u2190';\n            }\n          }\n        };\n        /**\n\t\t\t\t * This transform is applied to all nodes' text labels\n\t\t\t\t */\n        scope.getOrientatedTextTransform = function (d) {\n        };\n        scope.getOrientatedTextAnchor = function (d) {\n          if (scope.vertical) {\n            return 'middle';\n          } else {\n            return 'begin';\n          }\n        };\n        scope.getOrientatedTextX = function (d) {\n          if (scope.vertical) {\n            return 0;\n          } else {\n            return 10;\n          }\n        };\n        scope.getOrientatedTextY = function (d) {\n          if (scope.vertical) {\n            return '1.45em';\n          } else {\n            return '0.35em';\n          }\n        };\n        scope.getOrientatedLevelCaptionLayerTransform = function (d) {\n          if (scope.vertical) {\n            return 'translate(0, ' + scope.zoomListener.translate()[1] + ')';\n          } else {\n            return 'translate(' + scope.zoomListener.translate()[0] + ', 0)';\n          }\n        };\n        scope.getOrientatedLevelCaptionTransform = function (d) {\n          var revArr = angular.copy(viewState.hierarchyState.path).reverse();\n          if (scope.vertical) {\n            return 'translate(25, ' + scope.depthToX(revArr.indexOf(d)) + ')';\n          } else {\n            return 'translate(' + scope.depthToX(revArr.indexOf(d)) + ', 20)';\n          }\n        };\n        scope.getOrientatedAddItemButtonTransform = function (d) {\n          if (scope.vertical) {\n            return 'translate(-12, -5)';\n          } else {\n            return 'translate(-12, -5)';\n          }\n        };\n        scope.getOrientatedTimeLevelBackgroundTransform = function (d) {\n          if (scope.vertical) {\n            return 'translate(' + (scope.vertOffsetX - 25) + ',-8)';\n          } else {\n            return 'translate(-8,' + (scope.offsetY - 20) + ')';\n          }\n        };\n        scope.getOrientatedTimeLevelBackgroundWidth = function (d) {\n          if (scope.vertical) {\n            return '100%';\n          } else {\n            return '15px';\n          }\n        };\n        scope.getOrientatedTimeLevelBackgroundHeight = function (d) {\n          if (scope.vertical) {\n            return '15px';\n          } else {\n            return '100%';\n          }\n        };\n        scope.getOrientatedMousePosition = function (mouse) {\n          if (scope.vertical) {\n            return [\n              mouse[1] - scope.zoomListener.translate()[1],\n              mouse[0] - scope.zoomListener.translate()[0]\n            ];\n          } else {\n            return [\n              mouse[0] - scope.zoomListener.translate()[0],\n              mouse[1] - scope.zoomListener.translate()[1]\n            ];\n          }\n        };\n        scope.getPath = function (d) {\n          return 'M' + d._fromX + ' ' + d._fromY + 'Q' + d._fromX + ' ' + d._toY + ' ' + d._toX + ' ' + d._toY;\n        };\n        /**\n\t\t\t\t * Calculate the path for the dashed preview link that is shown when\n\t\t\t\t * trying to add a new link.\n\t\t\t\t */\n        scope.getPreviewPath = function () {\n          var from = {\n              x: scope.newLinkSrc._x,\n              y: scope.newLinkSrc._y\n            };\n          var to = {\n              x: scope.selectedItem._x,\n              y: scope.selectedItem._y\n            };\n          return 'M' + from.x + ' ' + from.y + 'Q' + from.x + ' ' + to.y + ' ' + to.x + ' ' + to.y;\n        };\n        /**\n\t\t\t\t * Return a color depending on the validity of the link the user is\n\t\t\t\t * trying to create.\n\t\t\t\t *\n\t\t\t\t * If the link is invalid, this function will try reversing the link.\n\t\t\t\t */\n        scope.getPreviewColor = function () {\n          var validity = HierarchyManipulationService.checkLinkValidity(viewState.hierarchyState.path, scope.newLinkSrc.id, scope.selectedItem.id);\n          if (validity.valid) {\n            return 'green';\n          } else {\n            if (validity.reason === 3) {\n              validity = HierarchyManipulationService.checkLinkValidity(viewState.hierarchyState.path, scope.selectedItem.id, scope.newLinkSrc.id);\n              if (validity.valid) {\n                return 'green';\n              }\n            }\n            return 'red';\n          }\n        };\n        scope.getLabelLegalnessColor = function (d) {\n          var dom = scope.svg.select('.emuhierarchy-contextmenu input')[0][0];\n          var levelName = LevelService.getLevelName(d.id);\n          var attrIndex = viewState.getCurAttrIndex(levelName);\n          var legalLabels = scope.cps.getLevelDefinition(levelName).attributeDefinitions[attrIndex].legalLabels;\n          if (legalLabels === undefined || dom.value.length > 0 && legalLabels.indexOf(dom.value) >= 0) {\n            return 'lightgreen';\n          } else {\n            return 'red';\n          }\n        };\n        scope.svgOnMouseMove = function (d) {\n          if (scope.newLinkSrc !== undefined) {\n            var mouse = scope.getOrientatedMousePosition(d3.mouse(this));\n            var x = mouse[0];\n            var y = mouse[1];\n            scope.svg.select('path.emuhierarchy-newlink').attr('d', 'M' + scope.newLinkSrc._x + ',' + scope.newLinkSrc._y + ' L' + x + ',' + y);\n            ;\n          }\n        };\n        scope.svgOnClick = function (d) {\n          if (viewState.hierarchyState.contextMenuID !== undefined) {\n            scope.$apply(function () {\n              viewState.hierarchyState.contextMenuID = undefined;\n            });\n          }\n        };\n        scope.nodeOnClick = function (d) {\n          console.debug('Clicked node', d);\n          if (viewState.hierarchyState.contextMenuID === undefined) {\n            d3.event.stopPropagation();\n            viewState.hierarchyState.contextMenuID = d.id;\n            viewState.hierarchyState.setEditValue(scope.getNodeText(d));\n            scope.$apply(function () {\n              scope.render();\n            });\n          }\n          if (viewState.hierarchyState.contextMenuID === d.id) {\n            d3.event.stopPropagation();\n          }\n        };\n        scope.nodeOnPlayClick = function (d) {\n          scope.play(d);\n        };\n        scope.nodeOnCollapseClick = function (d) {\n          console.debug('collapsing', d);\n          // (De-)Collapse sub-tree\n          HierarchyLayoutService.toggleCollapse(d, viewState.hierarchyState.path);\n          scope.render();\n        };\n        scope.nodeOnMouseOver = function (d) {\n          scope.selectItem(d);\n          scope.renderSelectionOnly();\n        };\n        scope.nodeOnInput = function (d) {\n          // select() returns a single-element selection, which is always\n          // a multi-dimensional array with [0][0] being the DOM node I'm\n          // looking for\n          var dom = scope.svg.select('.emuhierarchy-contextmenu input')[0][0];\n          viewState.hierarchyState.setEditValue(dom.value);\n          // Give feedback on legalness\n          dom.style.backgroundColor = scope.getLabelLegalnessColor(d);\n        };\n        scope.nodeOnFocusIn = function (d) {\n          viewState.hierarchyState.inputFocus = true;\n        };\n        scope.nodeOnFocusOut = function (d) {\n          viewState.hierarchyState.inputFocus = false;\n        };\n        scope.linkOnMouseOver = function (d) {\n          scope.selectLink(d);\n          scope.renderSelectionOnly();\n        };\n        scope.addButtonOnClick = function (d) {\n          var id = LevelService.pushNewItem(d);\n          if (id !== -1) {\n            scope.historyService.addObjToUndoStack({\n              type: 'HIERARCHY',\n              action: 'PUSHITEM',\n              newID: id,\n              level: d\n            });\n          }\n          scope.$apply();\n        };\n        scope.play = function (d) {\n          var timeInfoLevel = viewState.hierarchyState.path[0];\n          if (typeof timeInfoLevel === 'undefined') {\n            console.debug('Likely a bug: There is no path selection. Not executing play():', d);\n            return;\n          }\n          var timeInfoType = LevelService.getLevelDetails(timeInfoLevel).type;\n          var startSample = null;\n          var endSample = null;\n          var itemList = [d];\n          var currentItem;\n          while (itemList.length > 0) {\n            currentItem = itemList.pop();\n            if (currentItem.labels[0].name === timeInfoLevel) {\n              if (timeInfoType === 'EVENT') {\n                if (currentItem.samplePoint < startSample || startSample === null) {\n                  startSample = currentItem.samplePoint;\n                }\n                if (currentItem.samplePoint > endSample || endSample === null) {\n                  endSample = currentItem.samplePoint;\n                }\n              } else if (timeInfoType === 'SEGMENT') {\n                if (currentItem.sampleStart < startSample || startSample === null) {\n                  startSample = currentItem.sampleStart;\n                }\n                // I promise I'll never again use tmp as a variable name :-)\n                var tmp = currentItem.sampleStart + currentItem.sampleDur;\n                if (tmp > endSample || endSample === null) {\n                  endSample = tmp;\n                }\n              }\n            }\n            itemList = itemList.concat(HierarchyLayoutService.findChildren(currentItem, viewState.hierarchyState.path));\n          }\n          console.debug('Node info for playback: ', timeInfoType, d, startSample, endSample);\n          if (startSample === null || endSample === null) {\n            console.debug('No time information found for node, aborting playback', d);\n            return;\n          }\n          Soundhandlerservice.playFromTo(startSample, endSample);\n        };\n        /***********************************************************************\n\t\t\t\t * Transform relative into absolute coordinates\n\t\t\t\t *\n\t\t\t\t * Uses the two functions depthToX() and posInLevelToY()\n\t\t\t\t *\n\t\t\t\t * The relative coordinates are defined on the time-axis and on the\n\t\t\t\t * cross-axis.\n\t\t\t\t *\n\t\t\t\t * In vertical mode, the time-axis is X and the cross-axis is Y.\n\t\t\t\t * In default mode, the time-axis is Y and the cross-axis is X.\n\t\t\t\t *\n\t\t\t\t * The relative coordinate on the cross-axis is specified as \"number of\n\t\t\t\t * levels away from the time level\".\n\t\t\t\t *\n\t\t\t\t * On the time-axis, the relative coordinate is a number within [0;1].\n\t\t\t\t */\n        scope.depthToX = function (depth) {\n          if (scope.vertical) {\n            var crossAxisSize = scope.height;\n            var offset = scope.vertOffsetY;\n          } else {\n            var crossAxisSize = scope.width;\n            var offset = scope.offsetX;\n          }\n          var result = depth / viewState.hierarchyState.path.length * crossAxisSize;\n          if (scope.allowCrossAxisZoom) {\n            result *= scope.zoomListener.scale();\n          }\n          result += offset;\n          return result;\n        };\n        scope.posInLevelToY = function (posInLevel) {\n          if (scope.vertical) {\n            var offset = scope.vertOffsetX;\n            var timeAxisSize = scope.width - offset;\n          } else {\n            var offset = scope.offsetY;\n            var timeAxisSize = scope.height - offset;\n          }\n          var result = posInLevel * timeAxisSize * scope.zoomListener.scale();\n          result += offset;\n          return result;\n        };\n        //\n        /////////////////////////////\n        /////////////////////////////\n        // inital d3.js setup stuff\n        scope.element = element;\n        scope.width = 0;\n        scope.height = 0;\n        // lazy loading\n        scope.background = '';\n        // set background according to config only if config is loaded\n        if (scope.cps.design.color !== undefined) {\n          scope.background = scope.cps.design.color.lightGrey;\n        }\n        // scaleExtent limits the amount of zooming possible\n        scope.zoomListener = d3.behavior.zoom().scaleExtent(scope.scaleExtent).on('zoom', scope.zoom);\n        // Create the d3 element and position it based on margins\n        scope.svg = d3.select(element[0]).append('svg').attr('width', '100%').attr('height', '100%').style('background-color', scope.background).call(scope.zoomListener).on('dblclick.zoom', null).on('mousemove', scope.svgOnMouseMove).on('click', scope.svgOnClick).append('g');\n        ;\n        scope.shiftMode = false;\n        scope.checkLink = function (event) {\n          if (event.shiftKey && !scope.shiftMode) {\n            if (viewState.hierarchyState.newLinkFromID === undefined) {\n              viewState.hierarchyState.newLinkFromID = viewState.hierarchyState.selectedItemID;\n              scope.shiftMode = true;\n            }\n          }\n          if (!event.shiftKey && scope.shiftMode) {\n            scope.shiftMode = false;\n            var linkObj = HierarchyManipulationService.addLink(viewState.hierarchyState.path, viewState.hierarchyState.newLinkFromID, viewState.hierarchyState.selectedItemID);\n            viewState.hierarchyState.newLinkFromID = undefined;\n            if (linkObj !== null) {\n              HistoryService.addObjToUndoStack({\n                type: 'HIERARCHY',\n                action: 'ADDLINK',\n                link: linkObj\n              });\n            }\n          }\n        };\n        // Append a group which holds all overlay captions and which do not react to zooming\n        scope.captionLayer = scope.svg.append('g').style('z-index', 5);\n        scope.timeArrow = scope.svg.append('g').append('text').text('time \\u2192');\n        scope.scaleFactorDisplay = scope.svg.append('g');\n        scope.scaleFactorDisplay.append('text');\n        // Append a group which holds all nodes and which the zoom Listener can act upon.\n        scope.svg = scope.svg.append('g').style('z-index', 1);\n        // read previously stored zoom and pan values\n        scope.zoomListener.translate(viewState.hierarchyState.translate);\n        scope.zoomListener.scale(viewState.hierarchyState.scaleFactor);\n        //\n        /////////////////////////////\n        ////////////\n        // Here come the two main functions of the directive\n        //\n        // scope.render() and scope.renderSelectionOnly() do the bulk of the\n        // work\n        /**\n\t\t\t\t * Adjust the colors of all nodes and links to reflect the user's\n\t\t\t\t * selection.\n\t\t\t\t *\n\t\t\t\t * @param nothing\n\t\t\t\t * @returns nothing\n\t\t\t\t */\n        scope.renderSelectionOnly = function () {\n          // Change the circle fill of all nodes depending on whether they are selected\n          scope.svg.selectAll('circle.emuhierarchy-nodeCircle').style('fill', function (d) {\n            var color = ConfigProviderService.design.color.white;\n            if (typeof scope.selectedItem !== 'undefined' && d.id === scope.selectedItem.id) {\n              color = ConfigProviderService.design.color.blue;\n            }\n            return color;\n          });\n          ;\n          scope.svg.selectAll('path.emuhierarchy-link').style('stroke', function (d) {\n            if (scope.selectedLink === d) {\n              return ConfigProviderService.design.color.yellow;\n            } else {\n              return ConfigProviderService.design.color.grey;\n            }\n          });\n          ;\n          scope.svg.select('.emuhierarchy-newlinkpreview').attr('d', scope.getPreviewPath).style('stroke', scope.getPreviewColor);\n          ;\n        };\n        /**\n\t\t\t\t * (Re-)Render the complete hierarchical structure\n\t\t\t\t *\n\t\t\t\t * Calls HierarchyLayoutService to calculate the relative positions of\n\t\t\t\t * all nodes and links within the graph and then uses the above helper\n\t\t\t\t * functions to calculate the absolute positons within the SVG.\n\t\t\t\t *\n\t\t\t\t * Makes use of D3JS data joins at various positions. For an\n\t\t\t\t * introduction to the concept, see: http://bost.ocks.org/mike/join/\n\t\t\t\t *\n\t\t\t\t * It basically works by associating a data set with an SVG selection.\n\t\t\t\t * D3 then divides this data set in three sections: enter, update and\n\t\t\t\t * exit.\n\t\t\t\t *\n\t\t\t\t */\n        scope.render = function () {\n          scope.lastScaleFactor = scope.zoomListener.scale();\n          var i;\n          // Get current width and height of SVG\n          scope.width = parseInt(d3.select(scope.element[0]).style('width'), 10);\n          scope.height = parseInt(d3.select(scope.element[0]).style('height'), 10);\n          // Set orientation\n          if (scope.transition.rotation) {\n            scope.svg.transition().duration(scope.transition.duration).attr('transform', scope.getOrientatedTransform());\n            ;\n          } else {\n            scope.svg.attr('transform', scope.getOrientatedTransform());\n          }\n          /////////\n          // Draw time arrow\n          if (scope.vertical) {\n            scope.timeArrow.attr('transform', 'translate(' + scope.width / 2 + ',' + (scope.height - 10) + ')');\n          } else {\n            scope.timeArrow.attr('transform', 'translate(' + (scope.width - 20) + ',' + scope.height / 2 + ')rotate(90)');\n          }\n          /////////\n          // Draw scale factor display\n          if (scope.vertical) {\n            scope.scaleFactorDisplay.attr('transform', 'translate(' + scope.width + ', 20)');\n            ;\n            scope.scaleFactorDisplay.select('text').attr('text-anchor', 'end').text('Zoom: ' + Math.round(scope.zoomListener.scale() * 100) + ' %');\n          } else {\n            scope.scaleFactorDisplay.attr('transform', 'translate(0, ' + scope.height + ')');\n            ;\n            scope.scaleFactorDisplay.select('text').attr('text-anchor', 'start').text('Zoom: ' + Math.round(scope.zoomListener.scale() * 100) + ' %');\n            ;\n          }\n          /////////\n          // Draw level captions and 'add item buttons' (which append\n          // nodes to the respective levels\n          scope.captionLayer.attr('transform', scope.getOrientatedLevelCaptionLayerTransform);\n          // for reference on the .data() call, compare the comment on\n          // scope.render() above\n          var levelCaptionSet = scope.captionLayer.selectAll('g.emuhierarchy-levelcaption').data(viewState.hierarchyState.path, function (d) {\n              return d;\n            });\n          var newLevelCaptions = levelCaptionSet.enter();\n          var oldLevelCaptions = levelCaptionSet.exit();\n          newLevelCaptions = newLevelCaptions.append('g').attr('class', 'emuhierarchy-levelcaption');\n          ;\n          newLevelCaptions.append('text');\n          ;\n          var addItemButtons = newLevelCaptions.filter(function (d) {\n              var levelType = LevelService.getLevelDetails(d).type;\n              return levelType === 'ITEM';\n            }).append('g').attr('class', 'emuhierarchy-addbutton').attr('transform', scope.getOrientatedAddItemButtonTransform).on('click', scope.addButtonOnClick);\n          ;\n          addItemButtons.append('circle').style('fill', scope.cps.design.color.blue).attr('r', 8);\n          ;\n          addItemButtons.append('path').style('stroke', scope.cps.design.color.white).attr('d', 'M0,-6 V6 M-6,0 H6');\n          ;\n          newLevelCaptions.filter(function (d) {\n            var levelType = LevelService.getLevelDetails(d).type;\n            return levelType === 'SEGMENT' || levelType === 'EVENT';\n          }).append('rect').attr('class', 'emuhierarchy-timelevelbackground').style('fill', scope.cps.design.color.transparent.grey);\n          ;\n          levelCaptionSet.attr('transform', scope.getOrientatedLevelCaptionTransform);\n          ;\n          levelCaptionSet.select('text').text(scope.getLevelCaptionText);\n          levelCaptionSet.select('.emuhierarchy-timelevelbackground').attr('transform', scope.getOrientatedTimeLevelBackgroundTransform).style('width', scope.getOrientatedTimeLevelBackgroundWidth).style('height', scope.getOrientatedTimeLevelBackgroundHeight);\n          ;\n          if (scope.transition.rotation) {\n            oldLevelCaptions = oldLevelCaptions.transition().duration(scope.transition.duration).remove();\n            ;\n          } else {\n            oldLevelCaptions.remove();\n          }\n          oldLevelCaptions.select('text').style('fill-opacity', 0);\n          ;\n          //\n          /////////\n          /////////\n          // Compute the new tree layout (first nodes and then links)\n          //\n          var nodes = [];\n          HierarchyLayoutService.calculateWeightsBottomUp(viewState.hierarchyState.path);\n          for (var i = 0; i < viewState.hierarchyState.path.length; ++i) {\n            // Add all nodes that are not collapsed\n            var levelItems = LevelService.getLevelDetails(viewState.hierarchyState.path[i]).items;\n            for (var ii = 0; ii < levelItems.length; ++ii) {\n              if (levelItems[ii]._visible) {\n                nodes.push(levelItems[ii]);\n              }\n            }\n          }\n          // Make sure the selected things are visible, otherwise un-select them\n          var selectedItem = LevelService.getItemByID(viewState.hierarchyState.selectedItemID);\n          var contextMenuItem = LevelService.getItemByID(viewState.hierarchyState.contextMenuID);\n          var selectedLinkFromItem = LevelService.getItemByID(viewState.hierarchyState.selectedLinkFromID);\n          var selectedLinkToItem = LevelService.getItemByID(viewState.hierarchyState.selectedLinkToID);\n          if (selectedItem !== undefined && !selectedItem._visible) {\n            console.debug('Unselecting node');\n            viewState.hierarchyState.selectedItemID = undefined;\n          }\n          if (selectedLinkFromItem !== undefined && !selectedLinkFromItem._visible) {\n            console.debug('Unselecting link');\n            viewState.hierarchyState.selectedLinkFromID = undefined;\n            viewState.hierarchyState.selectedLinkToID = undefined;\n          }\n          if (selectedLinkToItem !== undefined && !selectedLinkToItem._visible) {\n            console.debug('Unselecting link');\n            viewState.hierarchyState.selectedLinkFromID = undefined;\n            viewState.hierarchyState.selectedLinkToID = undefined;\n          }\n          if (contextMenuItem !== undefined && !contextMenuItem._visible) {\n            console.debug('Closing context menu (node became invisible)');\n            viewState.hierarchyState.contextMenuID = undefined;\n          }\n          ////////\n          // Now layout links\n          //\n          // We must only draw links that are part of the currently selected path.\n          // We must therefore filter the links.\n          //\n          // We must also filter out links that are collapsed\n          //\n          // What follows below is a probably very low-performance approach to filtering\n          //\n          var links = [];\n          var allLinks = DataService.getData().links;\n          for (var l = 0; l < allLinks.length; ++l) {\n            for (var i = 0; i < viewState.hierarchyState.path.length - 1; ++i) {\n              var element = LevelService.getItemFromLevelById(viewState.hierarchyState.path[i], allLinks[l].toID);\n              var parentElement = LevelService.getItemFromLevelById(viewState.hierarchyState.path[i + 1], allLinks[l].fromID);\n              if (element === null) {\n                continue;\n              }\n              if (parentElement === null) {\n                continue;\n              }\n              if (!element._visible) {\n                continue;\n              }\n              if (viewState.hierarchyState.getCollapsed(parentElement.id) || !parentElement._visible) {\n                continue;\n              }\n              links.push(allLinks[l]);\n            }\n          }\n          // Transform relative coordinates (_posInLevel and _depth) to actual coordinates (_x and _y)\n          nodes.forEach(function (d) {\n            d._x = scope.depthToX(d._depth);\n            d._y = scope.posInLevelToY(d._posInLevel);\n          });\n          links.forEach(function (d) {\n            d._fromX = scope.depthToX(d._fromDepth);\n            d._fromY = scope.posInLevelToY(d._fromPosInLevel);\n            d._toX = scope.depthToX(d._toDepth);\n            d._toY = scope.posInLevelToY(d._toPosInLevel);\n          });\n          //////\n          // Now that all actual coordinates have been calculated, we\n          // update our SVG using d3js data joins\n          //\n          // for reference on the .data() call, compare the comment on\n          // scope.render() above\n          //\n          // Define the data set to be visualised\n          var dataSet = scope.svg.selectAll('g.emuhierarchy-node').data(nodes, function (d) {\n              return d.id;\n            });\n          var newNodes = dataSet.enter();\n          var oldNodes = dataSet.exit();\n          //\n          // Add nodes that were previously not part of the svg.\n          //\n          // Any node will consist of an svg group (\"g\"), a circle, a\n          // text and a second, invisible circle for mouseover handling.\n          //\n          // Note that properties that can be changed after the node is\n          // added will be set further below\n          newNodes = newNodes.append('g').attr('class', 'emuhierarchy-node').attr('pointer-events', 'mouseover').on('click', scope.nodeOnClick).on('mouseover', scope.nodeOnMouseOver);\n          ;\n          var circle = newNodes.append('circle').attr('class', 'emuhierarchy-nodeCircle').style('stroke', scope.cps.design.color.grey);\n          ;\n          if (scope.transition.nodes) {\n            circle.attr('r', 0).transition().duration(scope.transition.duration).attr('r', 4.5);\n            ;\n          } else {\n            circle.attr('r', 4.5);\n          }\n          newNodes.append('text').attr('class', 'emuhierarchy-nodeText');\n          ;\n          // Make sure that nodes that appear due to their ancestry being uncollapsed do not fly in from the origin\n          // (as do all other nodes)\n          newNodes.attr('transform', function (d) {\n            var position = viewState.hierarchyState.getCollapsePosition(d.id);\n            if (typeof position !== 'undefined') {\n              var x = position[0];\n              var y = position[1];\n              viewState.hierarchyState.setCollapsePosition(d.id, undefined);\n              return 'translate(' + x + ',' + y + ')' + scope.getOrientatedNodeTransform();\n            }\n          });\n          //\n          // Remove nodes that shall no longer be part of the svg\n          // Transition exiting nodes to the origin\n          // FIXME put that anyonymous transform function on scope\n          if (scope.transition.nodes) {\n            oldNodes = oldNodes.transition().duration(scope.transition.duration).attr('transform', function (d) {\n              var collapsePosition = viewState.hierarchyState.getCollapsePosition(d.id);\n              if (typeof collapsePosition !== 'undefined') {\n                var x = collapsePosition[0];\n                var y = collapsePosition[1];\n                viewState.hierarchyState.setCollapsePosition(d.id, undefined);\n                return 'translate(' + x + ',' + y + ')';\n              } else {\n                return 'translate(' + 0 + ',' + 0 + ')';\n              }\n            }).remove();\n          } else {\n            oldNodes = oldNodes.attr('transform', function (d) {\n              var collapsePosition = viewState.hierarchyState.getCollapsePosition(d.id);\n              if (typeof collapsePosition !== 'undefined') {\n                var x = collapsePosition[0];\n                var y = collapsePosition[1];\n                viewState.hierarchyState.setCollapsePosition(d.id, undefined);\n                return 'translate(' + x + ',' + y + ')';\n              } else {\n                return 'translate(' + 0 + ',' + 0 + ')';\n              }\n            }).remove();\n          }\n          oldNodes.select('text').style('fill-opacity', 0);\n          //\n          // Set or update properties that are subject to change after\n          // the node is added.\n          dataSet.select('text').attr('x', scope.getOrientatedTextX).attr('y', scope.getOrientatedTextY).attr('text-anchor', scope.getOrientatedTextAnchor).attr('transform', scope.getOrientatedTextTransform).text(scope.getNodeText);\n          ;\n          // Change the circle fill depending on whether it is collapsed and/or selected\n          dataSet.select('circle.emuhierarchy-nodeCircle').style('fill', function (d) {\n            var color = scope.cps.design.color.white;\n            if (typeof scope.selectedItem !== 'undefined' && d.id === scope.selectedItem.id) {\n              color = scope.cps.design.color.blue;\n            }\n            return color;\n          }).style('stroke', function (d) {\n            if (viewState.hierarchyState.getCollapsed(d.id)) {\n              return scope.cps.design.color.red;\n            } else {\n              return scope.cps.design.color.grey;\n            }\n          });\n          ;\n          // Transition nodes to their new position\n          if (scope.transition.nodes) {\n            dataSet.transition().duration(scope.transition.duration).attr('transform', function (d) {\n              return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n            });\n          } else {\n            dataSet.attr('transform', function (d) {\n              return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n            });\n          }\n          /////\n          // Create context menu\n          // If the context menu has been closed, remove the elements\n          if (viewState.hierarchyState.contextMenuID === undefined) {\n            scope.svg.selectAll('.emuhierarchy-contextmenu').remove();\n            ;\n          }\n          // If the context menu does not yet exist, create it\n          var contextMenu = scope.svg.select('.emuhierarchy-contextmenu');\n          if (contextMenu[0][0] === null) {\n            contextMenu = dataSet.filter(function (d) {\n              return d.id === viewState.hierarchyState.contextMenuID;\n            }).append('g').attr('class', 'emuhierarchy-contextmenu');\n            ;\n            contextMenu.append('circle').style('fill', 'darkgrey').attr('r', 50).style('cursor', 'default');\n            ;\n            if (scope.transition.contextMenu) {\n              contextMenu.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 0.5);\n              ;\n            }\n            contextMenu.append('text').text(scope.getOrientatedNodeCollapseText).attr('x', -25).attr('y', -25).attr('text-anchor', 'middle').on('click', scope.nodeOnCollapseClick);\n            ;\n            if (scope.transition.contextMenu) {\n              contextMenu.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 1);\n              ;\n            }\n            contextMenu.append('text').text('play').attr('x', -25).attr('y', +25).attr('text-anchor', 'middle').on('click', scope.nodeOnPlayClick);\n            ;\n            if (scope.transition.contextMenu) {\n              contextMenu.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 1);\n              ;\n            }\n            var foreignObject = contextMenu.append('foreignObject').attr('height', 30).attr('x', 10).attr('y', -15).attr('width', 0);\n            ;\n            if (scope.transition.contextMenu) {\n              foreignObject.transition().duration(scope.transition.duration).attr('width', 100);\n              ;\n            } else {\n              foreignObject.attr('width', 100);\n            }\n            foreignObject.append('xhtml:body').append('input').attr('value', scope.getNodeText).style('width', '100%').style('height', '100%').style('outline', 'none').style('border', '0').style('background-color', scope.getLabelLegalnessColor).on('input', scope.nodeOnInput).on('focus', scope.nodeOnFocusIn).on('blur', scope.nodeOnFocusOut);\n            ;\n            if (foreignObject[0].length !== 0) {\n              foreignObject.select('input')[0][0].focus();\n              foreignObject.select('input')[0][0].select();\n            }\n          } else {\n            scope.svg.select('.emuhierarchy-contextmenu text').text(scope.getOrientatedNodeCollapseText);\n          }\n          // Make sure the node containing the context menu is the last\n          // one in the SVG, otherwise the succeeding elements are drawn\n          // visually on top of the context menu.\n          scope.svg.selectAll('.emuhierarchy-node').sort(function (a, b) {\n            if (a.id === viewState.hierarchyState.contextMenuID) {\n              return 1;\n            }\n            if (b.id === viewState.hierarchyState.contextMenuID) {\n              return -1;\n            }\n            return 0;\n          });\n          //\n          //\n          // Now we turn to visualising links\n          //\n          // for reference on the .data() call, compare the comment on\n          // scope.render() above\n          var linkSet = scope.svg.selectAll('.emuhierarchy-linkgroup').data(links, function (d) {\n              // Form unique link ID\n              return 's' + d.fromID + 't' + d.toID;\n            });\n          var newLinks = linkSet.enter();\n          var oldLinks = linkSet.exit();\n          // The new link's paths are inserted within the svg element\n          // that linkSet was generated from.\n          // They must be inserted at the beginning (before the nodes,\n          // which have already been appended), because there is no CSS\n          // z-index for SVG.\n          // So the order of insertion is the only way to make sure that\n          // the lines are painted under the nodes.\n          newLinks = newLinks.insert('g', ':first-child').attr('class', 'emuhierarchy-linkgroup');\n          ;\n          // Append thicker ghost lines for better mouseover\n          newLinks.append('path').attr('class', 'emuhierarchy-ghostlink').style('stroke-width', scope.getOrientatedGhostLinkStrokeWidth).on('mouseover', scope.linkOnMouseOver);\n          ;\n          newLinks.append('path').attr('class', 'emuhierarchy-link').style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n          ;\n          if (scope.transition.links) {\n            newLinks.style('opacity', 0).transition().duration(scope.transition.duration).style('opacity', 1);\n            ;\n          }\n          // Remove old links\n          if (scope.transition.links) {\n            oldLinks.transition().duration(scope.transition.duration).style('opacity', 0).remove();\n            ;\n          } else {\n            oldLinks.remove();\n          }\n          // Set color depending on whether the link is selected\n          linkSet.selectAll('.emuhierarchy-link').style('stroke', function (d) {\n            if (scope.selectedLink === d) {\n              return scope.cps.design.color.yellow;\n            } else {\n              return scope.cps.design.color.grey;\n            }\n          });\n          ;\n          // Transition links to their new position.\n          if (scope.transition.links) {\n            linkSet.selectAll('.emuhierarchy-link').transition().duration(scope.transition.duration).attr('d', scope.getPath).style('stroke-width', scope.getOrientatedLinkStrokeWidth).style('opacity', 1);\n            ;\n          } else {\n            linkSet.selectAll('.emuhierarchy-link').attr('d', scope.getPath).style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n            ;\n          }\n          linkSet.selectAll('.emuhierarchy-ghostlink').attr('d', scope.getPath);\n          ;\n          // If the user is trying to add a new link,\n          // visualise what he's doing\n          scope.svg.selectAll('.emuhierarchy-newlink').remove();\n          scope.svg.selectAll('.emuhierarchy-newlinkpreview').remove();\n          if (scope.newLinkSrc !== undefined) {\n            scope.svg.append('path').attr('class', 'emuhierarchy-newlink').style('stroke', 'black').style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n            ;\n            var preview = scope.svg.append('path').attr('class', 'emuhierarchy-newlinkpreview').attr('d', scope.getPreviewPath).style('stroke', scope.getPreviewColor).style('stroke-width', scope.getOrientatedLinkStrokeWidth);\n            ;\n          }\n          // Set boundaries within which the graph has to stay when the\n          // user is panning. That is, the graph can never *completely*\n          // leave these boundaries\n          if (scope.vertical) {\n            scope.northernBoundary = scope.vertOffsetY + scope.height * (1 - scope.panningLimit);\n            scope.southernBoundary = scope.height * scope.panningLimit;\n            scope.westernBoundary = scope.vertOffsetX + scope.width * (1 - scope.panningLimit);\n            scope.easternBoundary = scope.width * scope.panningLimit;\n          } else {\n            scope.northernBoundary = scope.offsetY + scope.height * (1 - scope.panningLimit);\n            scope.southernBoundary = scope.height * scope.panningLimit;\n            scope.westernBoundary = scope.offsetX + scope.width * (1 - scope.panningLimit);\n            scope.easternBoundary = scope.width * scope.panningLimit;\n          }\n          // Find out where the time and cross axis start and end, to\n          // prevent that these points leave the above boundaries.\n          // Note that these do not depend on scope.vertical because they\n          // are transformed when the user is in \"scope.vertical mode\".\n          scope.timeAxisStartPosition = scope.svg.node().getBBox().y;\n          scope.timeAxisEndPosition = scope.timeAxisStartPosition + scope.svg.node().getBBox().height;\n          scope.crossAxisStartPosition = scope.svg.node().getBBox().x;\n          scope.crossAxisEndPosition = scope.crossAxisStartPosition + scope.svg.node().getBBox().width;\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('epg', [\n  'viewState',\n  function (viewState) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the epg directive');\n        var canvas = element.find('canvas')[0];\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawEpgGrid(scope);\n                }\n              }\n            }\n          }\n        }, true);\n        scope.$watch('vs.curMousePosSample', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawEpgGrid(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        ////////////////////\n        /**\n\t\t\t\t * drawing method to drawEpgGrid\n\t\t\t\t */\n        scope.drawEpgGrid = function (scope) {\n          var ctx = canvas.getContext('2d');\n          tr = scope.cps.getSsffTrackConfig('EPG');\n          // SIC SIC SIC hardcoded for now although it might stay that way because it only is allowed to draw epg data anyway\n          col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n          sRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(tr.name);\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.fillStyle = 'green';\n          ctx.strokeStyle = scope.cps.design.color.black;\n          ctx.font = scope.cps.design.font.input.size.slice(0, -2) + 'px' + ' ' + scope.cps.design.font.input.family;\n          var gridWidth = canvas.width / 8;\n          var gridHeight = canvas.height / 8;\n          var sInterv = 1 / sRaSt.sampleRate - sRaSt.startTime;\n          var curFrame = Math.round(scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate / sInterv);\n          var binValStrArr;\n          var curFrameVals = angular.copy(col.values[curFrame]);\n          curFrameVals.reverse();\n          angular.forEach(curFrameVals, function (el, elIdx) {\n            binValStrArr = el.toString(2).split('').reverse();\n            // pad with zeros\n            while (binValStrArr.length < 8) {\n              binValStrArr.push('0');\n            }\n            binValStrArr.forEach(function (binStr, binStrIdx) {\n              if (binStr === '1') {\n                ctx.fillStyle = 'grey';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              } else {\n                ctx.fillStyle = 'white';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              }\n            });\n          });\n          // draw labels\n          scope.fontImage.drawUndistortedTextTwoLines(ctx, 'EPG', 'Frame:' + curFrame, scope.cps.design.font.input.size.slice(0, -2) * 3 / 4, scope.cps.design.font.input.family, 5, 0, scope.cps.design.color.black, true);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dots', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  'loadedMetaDataService',\n  'mathHelperService',\n  function (viewState, ConfigProviderService, Ssffdataservice, fontScaleService, Soundhandlerservice, loadedMetaDataService, mathHelperService) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas class=\"emuwebapp-twoDimCanvasStatic\" width=\"512\" height=\"512\"></canvas><canvas class=\"emuwebapp-twoDimCanvasDots\" width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        scope.ssffds = Ssffdataservice;\n        scope.vs = viewState;\n        scope.fontImage = fontScaleService;\n        scope.shs = Soundhandlerservice;\n        scope.lmds = loadedMetaDataService;\n        scope.mhs = mathHelperService;\n        var staticContoursCanvas = element.find('canvas')[0];\n        var canvas = element.find('canvas')[1];\n        var globalMinX = Infinity;\n        var globalMaxX = -Infinity;\n        var globalMinY = Infinity;\n        var globalMaxY = -Infinity;\n        var tr, col, sRaSt;\n        var startPoint = Math.PI / 180 * 0;\n        var endPoint = Math.PI / 180 * 360;\n        ////////////////////\n        // watches\n        //\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawDots();\n                }\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMousePosSample', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curPerspectiveIdx', function () {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        scope.$watch('lmds.getCurBndl()', function (newVal) {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        //////////////////\n        scope.setGlobalMinMaxVals = function () {\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          }\n          // also check staticDots\n          dD.staticDots.forEach(function (sD) {\n            sD.xCoordinates.forEach(function (xVal, xIdx) {\n              // check x\n              if (xVal < globalMinX) {\n                globalMinX = xVal;\n              }\n              if (xVal > globalMaxX) {\n                globalMaxX = xVal;\n              }\n              // check y\n              if (sD.yCoordinates[xIdx] < globalMinY) {\n                globalMinY = sD.yCoordinates[xIdx];\n              }\n              if (sD.yCoordinates[xIdx] > globalMaxY) {\n                globalMaxY = sD.yCoordinates[xIdx];\n              }\n            });\n          });\n          // and staticContours\n          angular.forEach(dD.staticContours, function (sC) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(sC.xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(sC.ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          });\n        };\n        /**\n\t\t\t\t * drawing to draw overlay1 i.e. static\n\t\t\t\t */\n        scope.drawStaticContour = function () {\n          var ctx = staticContoursCanvas.getContext('2d');\n          ctx.clearRect(0, 0, staticContoursCanvas.width, staticContoursCanvas.height);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          for (var i = 0; i < dD.staticContours.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.staticContours[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.staticContours[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            var xPrev = undefined;\n            var yPrev = undefined;\n            for (var j = 0; j < xCol.values.length; j++) {\n              var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.staticContours[i].xSsffTrack);\n              var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.staticContours[i].ySsffTrack);\n              //check if sampleRate and startTime is the same\n              if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n                alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n                // SIC should never get here!\n                return;\n              }\n              var x = (xCol.values[j][dD.staticContours[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * staticContoursCanvas.width;\n              var y = staticContoursCanvas.height - (yCol.values[j][dD.staticContours[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * staticContoursCanvas.height;\n              ctx.strokeStyle = dD.staticContours[i].color;\n              ctx.fillStyle = dD.staticContours[i].color;\n              ctx.beginPath();\n              ctx.arc(x, y, 2, startPoint, endPoint, true);\n              ctx.fill();\n              //ctx.closePath();\n              // draw lines\n              if (j >= 1 && dD.staticContours[i].connect) {\n                ctx.beginPath();\n                ctx.moveTo(xPrev, yPrev);\n                ctx.lineTo(x, y);\n                ctx.stroke();\n              }\n              xPrev = x;\n              yPrev = y;\n            }\n          }\n        };\n        /**\n\t\t\t\t * drawing method to drawDots\n\t\t\t\t */\n        scope.drawDots = function () {\n          if (globalMinX === Infinity) {\n            scope.setGlobalMinMaxVals();\n            if (scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0].staticContours !== undefined) {\n              scope.drawStaticContour();\n            }\n          }\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          //////////////////////////////\n          // markup to improve visualization\n          var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          // draw corner pointers\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.lineTo(5, 5);\n          ctx.moveTo(0, canvas.height);\n          ctx.lineTo(5, canvas.height - 5);\n          ctx.moveTo(canvas.width, canvas.height);\n          ctx.lineTo(canvas.width - 5, canvas.height - 5);\n          ctx.stroke();\n          ctx.closePath();\n          var smallFontSize = scope.cps.design.font.input.size.slice(0, -2) * 3 / 4;\n          // ymax\n          scope.fontImage.drawUndistortedText(ctx, 'yMax: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMaxY, 2), smallFontSize, scope.cps.design.font.input.family, 5, 5, scope.cps.design.color.black);\n          // xmin + y min\n          scope.fontImage.drawUndistortedTextTwoLines(ctx, 'yMin: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMinY, 2), 'xMin: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMinX, 2), smallFontSize, scope.cps.design.font.input.family, 5, canvas.height - smallFontSize * scaleY * 2 - 5, scope.cps.design.color.black, true);\n          // xmax\n          var tw = ctx.measureText('xMax: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMaxX, 5)).width * scaleX;\n          // SIC why 5???\n          scope.fontImage.drawUndistortedText(ctx, 'xMax: ' + scope.mhs.roundToNdigitsAfterDecPoint(globalMaxX, 2), smallFontSize, scope.cps.design.font.input.family, canvas.width - tw - 5, canvas.height - smallFontSize * scaleY - 5, scope.cps.design.color.black);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          // frame nr\n          var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].xSsffTrack);\n          // use first track for sample numbers\n          var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].ySsffTrack);\n          var sInterv = 1 / xsRaSt.sampleRate;\n          var curMousePosTime = scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate;\n          var curFrame;\n          if (xsRaSt.startTime === 1 / xsRaSt.sampleRate / 2) {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate);\n          } else {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate + (xsRaSt.startTime - 1 / xsRaSt.sampleRate / 2) * xsRaSt.sampleRate);\n          }\n          // check if due to math.round curFrame > col.length\n          var trConf = scope.cps.getSsffTrackConfig(dD.dots[0].xSsffTrack);\n          var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n          if (curFrame > xCol.values.length - 1) {\n            curFrame = xCol.values.length - 1;\n          }\n          tw = ctx.measureText('frame: ' + curFrame).width * scaleX;\n          var degrees = 90;\n          ctx.save();\n          ctx.rotate(degrees * Math.PI / 180);\n          scope.fontImage.drawUndistortedText(ctx, 'frame: ' + curFrame, scope.cps.design.font.input.size.slice(0, -2) - 4, scope.cps.design.font.input.family, canvas.width / 2 - tw / 2, -canvas.height, scope.cps.design.color.black);\n          ctx.restore();\n          //////////////////////////////\n          // draw dots\n          var startPoint = Math.PI / 180 * 0;\n          // really don't get why the globals and visable here???\n          var endPoint = Math.PI / 180 * 360;\n          var allDots = [];\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // check if x and why have the same amount of cols\n            if (xCol.values.length !== yCol.values.length) {\n              alert('columns do not have same length or length of one not 1');\n              return;\n            }\n            var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].xSsffTrack);\n            var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].ySsffTrack);\n            // check if sampleRate and startTime is the same\n            if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n              alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n              return;\n            }\n            var x = (xCol.values[curFrame][dD.dots[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var y = canvas.height - (yCol.values[curFrame][dD.dots[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            ctx.strokeStyle = dD.dots[i].color;\n            ctx.beginPath();\n            ctx.arc(x, y, 20, startPoint, endPoint, true);\n            ctx.stroke();\n            ctx.closePath();\n            ctx.beginPath();\n            ctx.arc(x, y, 2, startPoint, endPoint, true);\n            ctx.fill();\n            ctx.closePath();\n            // draw labels\n            scope.fontImage.drawUndistortedText(ctx, dD.dots[i].name, scope.cps.design.font.input.size.slice(0, -2) - 4, scope.cps.design.font.input.family, x, y - 5, scope.cps.design.color.black);\n            // append to all dots\n            allDots.push({\n              'name': dD.dots[i].name,\n              'x': x,\n              'y': y\n            });\n          }\n          //////////////////////////\n          // draw connect lines\n          var f, t;\n          dD.connectLines.forEach(function (c) {\n            allDots.forEach(function (d) {\n              if (d.name === c.fromDot) {\n                f = d;\n              }\n              if (d.name === c.toDot) {\n                t = d;\n              }\n            });\n            // draw line\n            ctx.strokeStyle = c.color;\n            ctx.beginPath();\n            ctx.moveTo(f.x, f.y);\n            ctx.lineTo(t.x, t.y);\n            ctx.stroke();\n            ctx.closePath();\n          });\n          //////////////////////////\n          // draw static dots\n          var startPoint = Math.PI / 180 * 0;\n          var endPoint = Math.PI / 180 * 360;\n          dD.staticDots.forEach(function (sD) {\n            ctx.strokeStyle = sD.color;\n            ctx.fillStyle = sD.color;\n            // draw name\n            var labelX = (sD.xNameCoordinate - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var labelY = canvas.height - (sD.yNameCoordinate - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            var labelTxtImg = scope.fontImage.drawUndistortedText(ctx, sD.name, scope.cps.design.font.input.size.slice(0, -2) - 4, scope.cps.design.font.input.family, labelX, labelY, sD.color);\n            sD.xCoordinates.forEach(function (xVal, xIdx) {\n              var x = (xVal - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n              var y = canvas.height - (sD.yCoordinates[xIdx] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n              // draw dot\n              ctx.beginPath();\n              ctx.arc(x, y, 2, startPoint, endPoint, true);\n              ctx.fill();\n              ctx.closePath();\n              // draw connection\n              if (sD.connect && xIdx >= 1) {\n                var prevX = (sD.xCoordinates[xIdx - 1] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n                var prevY = canvas.height - (sD.yCoordinates[xIdx - 1] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n                ctx.beginPath();\n                ctx.moveTo(prevX, prevY);\n                ctx.lineTo(x, y);\n                ctx.stroke();\n                ctx.closePath();\n              }\n            });\n          });\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZone', [\n  '$animate',\n  '$compile',\n  'DragnDropService',\n  'browserDetector',\n  'appStateService',\n  'modalService',\n  function ($animate, $compile, DragnDropService, browserDetector, appStateService, modalService) {\n    return {\n      templateUrl: 'views/myDropZone.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        /* --------- Messages -------- */\n        scope.dropTextDefault = 'Drop your files here (.wav files; .wav & annotJSON file pairs; .wav & TextGrid file pairs) or click here to do the same with a file dialog';\n        scope.dropTextErrorFileType = 'Error: Could not parse file. The following file types are supported: .WAV .TEXTGRID _annot.json';\n        scope.dropTextErrorAPI = 'Sorry ! The File APIs are not supported in your browser.';\n        scope.dropAllowed = 'Drop file(s) to start loading !';\n        scope.dropParsingWaiting = '.TextGrid loaded! Please load .WAV file in order to start!';\n        scope.dropParsingWAV = '.WAV loaded! Proceeding without annotation data.';\n        scope.dropParsingWaitingAnnot = 'Annotation file loaded! Please load .WAV file in order to start!';\n        scope.dropFirefoxWarning = 'Sorry ! Firefox does not support dropping folders ! please drop single or multiple files !';\n        scope.dropText = scope.dropTextDefault;\n        scope.dropClass = '';\n        scope.dropClassDefault = '';\n        scope.dropClassOver = 'over';\n        scope.dropClassError = 'error';\n        scope.count = 0;\n        scope.handles = [];\n        scope.bundles = [];\n        scope.bundleNames = [];\n        scope.updateQueueLength = function (quantity) {\n          scope.count += quantity;\n        };\n        scope.enqueueFileAddition = function (file) {\n          var identifier = file.name.substring(file.name.lastIndexOf('_') + 1, file.name.lastIndexOf('.')).toUpperCase();\n          var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n          var bundle = '';\n          if (identifier === 'ANNOT') {\n            bundle = file.name.substr(0, file.name.lastIndexOf('_'));\n          } else {\n            bundle = file.name.substr(0, file.name.lastIndexOf('.'));\n          }\n          var j = scope.bundleNames.indexOf(bundle);\n          if (j === -1) {\n            scope.bundleNames.push(bundle);\n            j = scope.bundleNames.indexOf(bundle);\n            scope.bundles[j] = [];\n            scope.bundles[j][0] = bundle;\n          }\n          if (extension === 'WAV') {\n            scope.bundles[j][1] = file;\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWAV;\n          } else if (extension === 'TEXTGRID') {\n            scope.bundles[j][2] = {};\n            scope.bundles[j][2].file = file;\n            scope.bundles[j][2].type = 'textgrid';\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWaiting;\n          } else if (extension === 'JSON' && identifier === 'ANNOT') {\n            scope.bundles[j][2] = {};\n            scope.bundles[j][2].file = file;\n            scope.bundles[j][2].type = 'annotation';\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWaitingAnnot;\n          } else {\n            if (browserDetector.isBrowser.Firefox()) {\n              if (file.size === 0) {\n                scope.dropClass = scope.dropClassError;\n                scope.dropText = scope.dropFirefoxWarning;\n              } else {\n                scope.dropClass = scope.dropClassError;\n                scope.dropText = scope.dropTextErrorFileType;\n              }\n            } else {\n              scope.dropClass = scope.dropClassError;\n              scope.dropText = scope.dropTextErrorFileType;\n            }\n            scope.handles = [];\n            scope.bundles = [];\n            scope.bundleNames = [];\n            scope.count = 0;\n          }\n          if (!browserDetector.isBrowser.Firefox() && !browserDetector.isBrowser.Safari()) {\n            scope.$digest();\n          }\n          if (scope.bundles[j] !== undefined) {\n            scope.startRendering();\n          }\n        };\n        scope.startRendering = function () {\n          // If all the files we expect have shown up, then flush the queue.\n          if (scope.count === scope.handles.length) {\n            if (DragnDropService.setData(scope.bundles) === false) {\n              modalService.open('views/error.html', 'Sorry you dropped too many bundles (' + scope.handles.length + '). The maximum currently allowed is: ' + DragnDropService.maxDroppedBundles).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n            scope.handles = [];\n            scope.bundles = [];\n            scope.bundleNames = [];\n            scope.count = 0;\n            scope.dropText = scope.dropTextDefault;\n            scope.dropClass = scope.dropClassDefault;\n          }\n        };\n        scope.loadFiles = function (files) {\n          scope.updateQueueLength(files.length);\n          for (var i = 0; i < files.length; i++) {\n            var file = files[i];\n            if (file.name === '.DS_Store') {\n              scope.updateQueueLength(-1);\n            } else {\n              var entry, reader;\n              if (file.isFile || file.isDirectory) {\n                entry = file;\n              } else if (file.getAsEntry) {\n                entry = file.getAsEntry();\n              } else if (file.webkitGetAsEntry) {\n                entry = file.webkitGetAsEntry();\n              } else if (typeof file.getAsFile === 'function') {\n                scope.enqueueFileAddition(file.getAsFile());\n                continue;\n              } else if (File && file instanceof File) {\n                scope.enqueueFileAddition(file);\n                continue;\n              } else {\n                scope.updateQueueLength(-1);\n                continue;\n              }\n              if (!entry) {\n                updateQueueLength(-1);\n              } else if (entry.isFile) {\n                entry.file(function (file) {\n                  scope.enqueueFileAddition(file);\n                }, function (err) {\n                  console.warn(err);\n                });\n              } else if (entry.isDirectory) {\n                reader = entry.createReader();\n                reader.readEntries(function (entries) {\n                  scope.loadFiles(entries);\n                  scope.updateQueueLength(-1);\n                }, function (err) {\n                  console.warn(err);\n                });\n              }\n            }\n          }\n        };\n        scope.dropFiles = function (evt) {\n          evt.stopPropagation();\n          evt.preventDefault();\n          scope.$apply(function () {\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\n              if (evt.originalEvent !== undefined) {\n                if (browserDetector.isBrowser.Firefox()) {\n                  var items = evt.originalEvent.dataTransfer.files;\n                } else if (browserDetector.isBrowser.Safari()) {\n                  var items = evt.originalEvent.dataTransfer.files;\n                } else {\n                  // we assume it is chrome\n                  var items = evt.originalEvent.dataTransfer.items;\n                }\n                scope.loadFiles(items);\n              }\n            } else {\n              // no browser support for FileAPI\n              modalService.open('views/error.html', scope.dropTextErrorAPI).then(function (res) {\n                scope.dropText = scope.dropTextDefault;\n                scope.dropClass = scope.dropClassDefault;\n                appStateService.resetToInitState();\n              });\n            }\n          });\n        };\n        scope.dragEnterLeave = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropTextDefault;\n            scope.dropClass = scope.dropClassDefault;\n          });\n        };\n        scope.handleDragOver = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropAllowed;\n            scope.dropClass = scope.dropClassOver;\n          });\n        };\n        element.bind('drop', function (event) {\n          scope.dropFiles(event);\n        });\n        element.bind('dragover', function (event) {\n          scope.handleDragOver(event);\n        });\n        element.bind('dragenter', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('dragleave', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('click', function (event) {\n          element.context.children[1].children[0].click();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZoneInput', [\n  '$animate',\n  'browserDetector',\n  'appStateService',\n  function ($animate, browserDetector, appStateService) {\n    return {\n      templateUrl: 'views/myDropZoneInput.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        scope.acceptGrid = '.TextGrid';\n        scope.acceptWav = 'audio/wav';\n        scope.acceptJson = 'application/json';\n        scope.acceptBoth = scope.acceptWav + ',' + scope.acceptGrid + ',' + scope.acceptJson;\n        scope.acceptFile = scope.acceptBoth;\n        scope.handleFilesonChange = function () {\n          var loadedFiles = element.context.children.fileDialog;\n          scope.$parent.loadFiles(loadedFiles.files);\n        };\n        element.bind('change', function (event) {\n          scope.handleFilesonChange(event);\n        });\n        element.bind('click', function (event) {\n          var elem = angular.element('input');\n          if (elem[1] !== undefined) {\n            elem[1].click();\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuwebapp', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/emuwebapp.html',\n      restrict: 'E',\n      scope: {\n        audioGetUrl: '@',\n        labelGetUrl: '@',\n        labelType: '@'\n      },\n      link: function postLink(scope, element, attrs) {\n        ////////////////////////\n        // Bindings\n        element.bind('mouseenter', function (event) {\n          viewState.mouseInEmuWebApp = true;\n        });\n        element.bind('mouseleave', function (event) {\n          viewState.mouseInEmuWebApp = false;\n        });\n        ///////////////////////\n        // observe attrs\n        attrs.$observe('audioGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.audioGetUrl = val;\n          }\n        });\n        attrs.$observe('labelGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelGetUrl = val;\n          }\n        });\n        attrs.$observe('labelType', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelType = val;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Validationservice', [\n  '$http',\n  '$q',\n  'ConfigProviderService',\n  function Validationservice($http, $q, ConfigProviderService) {\n    //shared service object to be returned\n    var sServObj = {};\n    var schemasJsos = [];\n    var names = [\n        'annotationFileSchema',\n        'emuwebappConfigSchema',\n        'DBconfigFileSchema',\n        'bundleListSchema',\n        'bundleSchema',\n        'designSchema'\n      ];\n    /**\n\t\t *\n\t\t */\n    function checkIfLevelsAreDefined(levelNames, DBconfig) {\n      var res = true;\n      // check levels are defined\n      DBconfig.levelDefinitions.forEach(function (ld) {\n        var lnIdx = levelNames.indexOf(ld.name);\n        while (lnIdx !== -1) {\n          levelNames.splice(lnIdx, 1);\n          lnIdx = levelNames.indexOf(ld.name);\n        }\n      });\n      if (levelNames.length !== 0) {\n        res = 'Following levels are not defined: ' + levelNames;\n      }\n      return res;\n    }\n    /**\n\t\t *\n\t\t */\n    function checkIfSsffTracksAreDefined(trackNames, DBconfig) {\n      var res = true;\n      // remove OSCI and SPEC\n      var tnIdx = trackNames.indexOf('OSCI');\n      if (tnIdx !== -1) {\n        trackNames.splice(tnIdx, 1);\n      }\n      tnIdx = trackNames.indexOf('SPEC');\n      if (tnIdx !== -1) {\n        trackNames.splice(tnIdx, 1);\n      }\n      // check levels are defined\n      DBconfig.ssffTrackDefinitions.forEach(function (td) {\n        var tnIdx = trackNames.indexOf(td.name);\n        while (tnIdx !== -1) {\n          trackNames.splice(tnIdx, 1);\n          tnIdx = trackNames.indexOf(td.name);\n        }\n      });\n      if (trackNames.length !== 0) {\n        res = 'Following ssffTracks are not defined: ' + trackNames;\n      }\n      return res;\n    }\n    //////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.semCheckLoadedConfigs = function (EMUwebAppConfig, DBconfig) {\n      var res = true;\n      var keepGoing = true;\n      /////////////////////////////////////////////////////////////////////\n      // check DBconfig levelDefinitions\n      DBconfig.levelDefinitions.forEach(function (ld, ldIdx) {\n        // check for duplicate attributeDefinition names\n        ld.attributeDefinitions.forEach(function (ad1, ad1idx) {\n          var counter = 0;\n          ld.attributeDefinitions.forEach(function (ad2) {\n            if (ad1.name === ad2.name) {\n              counter = counter + 1;\n            }\n          });\n          if (counter > 1) {\n            res = 'Error in DBconfig /levelDefinitions[' + ldIdx + ']/attributeDefinitions[' + ad1idx + '] duplicate attribute definitions found for this entry!';\n            keepGoing = false;\n          }\n        });\n      });\n      // TODO check for unique perspective names\n      ////////////////////////////////////////////////////////////////////\n      // check perspectives\n      EMUwebAppConfig.perspectives.forEach(function (p) {\n        if (keepGoing) {\n          /////////////////////////\n          // check signalCanvases\n          // check only defined signalCanvases are displayed\n          var tDefRes = checkIfSsffTracksAreDefined(angular.copy(p.signalCanvases.order), DBconfig);\n          if (tDefRes !== true) {\n            res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/order! References to undefined ssffTracks are present. ' + tDefRes;\n            keepGoing = false;\n          }\n          var assTrackNames = [];\n          // check only defined and displayed (in order array) assignments are present\n          p.signalCanvases.assign.forEach(function (ass) {\n            if (keepGoing) {\n              assTrackNames.push(ass.ssffTrackName);\n              // self assignments are not allowed\n              if (ass.signalCanvasName === ass.ssffTrackName) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! Assignment to self is not possible! signalCanvasesName: ' + ass.signalCanvasName;\n                keepGoing = false;\n              }\n              // OSCI and SPEC can not be assigned \n              if (ass.ssffTrackName === 'OSCI' || ass.ssffTrackName === 'SPEC') {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! Assignment of OSCI or SPEC is not possible!';\n                keepGoing = false;\n              }\n              // are defined\n              tDefRes = checkIfSsffTracksAreDefined([\n                ass.signalCanvasName,\n                ass.ssffTrackName\n              ], DBconfig);\n              if (tDefRes !== true) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! References to undefined ssffTracks are present. ' + tDefRes;\n                keepGoing = false;\n              }\n              // are displayed\n              var tnIdx = p.signalCanvases.order.indexOf(ass.signalCanvasName);\n              if (tnIdx === -1) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/assign! References to ssffTracks that are not displayed (not in order array of that perspective) are: ' + ass.signalCanvasName;\n                keepGoing = false;\n              }\n            }\n          });\n          // check only defined and displayed contourLims are present\n          p.signalCanvases.contourLims.forEach(function (cl) {\n            if (keepGoing) {\n              // are defined\n              tDefRes = checkIfSsffTracksAreDefined([cl.ssffTrackName], DBconfig);\n              if (tDefRes !== true) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/contourLims! References to undefined ssffTracks are present. ' + tDefRes;\n                keepGoing = false;\n              }\n              // are displayed (concat to find assigned ssffTracks as well)\n              var tnIdx = p.signalCanvases.order.concat(assTrackNames).indexOf(cl.ssffTrackName);\n              if (tnIdx === -1) {\n                res = 'Error in EMUwebAppConfig/perspectives/signalCanvases/contourLims! References to ssffTracks that are not displayed (not in order array of that perspective) are: ' + cl.ssffTrackName;\n                keepGoing = false;\n              }\n            }\n          });\n          /////////////////////////\n          // check levelCanvases\n          // check only defined levels are displayed\n          var lDefRes = checkIfLevelsAreDefined(angular.copy(p.levelCanvases.order), DBconfig);\n          if (lDefRes !== true) {\n            res = 'Error in EMUwebAppConfig/perspectives/levelCanvases/order! References to undefined levels are present. ' + lDefRes;\n            keepGoing = false;\n          }\n          // check only SEGMENT or EVENT levels are displayed\n          p.levelCanvases.order.forEach(function (ln) {\n            if (keepGoing) {\n              var ld = ConfigProviderService.getLevelDefinition(ln);\n              if (ld.type !== 'SEGMENT' && ld.type !== 'EVENT') {\n                res = 'Error in EMUwebAppConfig/perspectives/levelCanvases/order! Configured to display levels of type ITEM as levels containing time information (ITEM level in order array). LevelName: ' + ln;\n                keepGoing = false;\n              }\n            }\n          });\n          /////////////////////////\n          // check twoDimCanvases\n          if (p.twoDimCanvases !== undefined) {\n            if (p.twoDimCanvases.twoDimDrawingDefinitions !== undefined) {\n              p.twoDimCanvases.twoDimDrawingDefinitions.forEach(function (tddd) {\n                if (keepGoing) {\n                  var dotNames = [];\n                  // check dots\n                  tddd.dots.forEach(function (d) {\n                    if (keepGoing) {\n                      dotNames.push(d.name);\n                      // are defined\n                      tDefRes = checkIfSsffTracksAreDefined([\n                        d.xSsffTrack,\n                        d.ySsffTrack\n                      ], DBconfig);\n                      if (tDefRes !== true) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/dots! References to undefined ssffTracks are present. ' + tDefRes;\n                        keepGoing = false;\n                      }\n                    }\n                  });\n                  // check connectLines\n                  tddd.connectLines.forEach(function (cl) {\n                    if (keepGoing) {\n                      // fromDot is defined\n                      var tnIdx = dotNames.indexOf(cl.fromDot);\n                      if (tnIdx === -1) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/connectLines! References dots in fromDot that are not defined. dots.name: ' + cl.fromDot;\n                        keepGoing = false;\n                      }\n                      // toDot is defined\n                      tnIdx = dotNames.indexOf(cl.toDot);\n                      if (tnIdx === -1) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/connectLines! References dots in toDot that are not defined. dots.name: ' + cl.toDot;\n                        keepGoing = false;\n                      }\n                    }\n                  });\n                  // check staticDots\n                  tddd.staticDots.forEach(function (sd) {\n                    if (keepGoing) {\n                      // check array is of the same length\n                      if (sd.xCoordinates.length !== sd.yCoordinates.length) {\n                        res = 'Error in EMUwebAppConfig/perspectives/twoDimCanvases/twoDimDrawingDefinitions/staticDots! xCoordinates and yCoordinates are not of the same length!';\n                        keepGoing = false;\n                      }\n                    }\n                  });\n                }\n              });\n            }\n          }\n        }\n      });\n      ////////////////////////////////////////////////////////////////////\n      // check for anagestConfig and if the according tracks/levels are defined\n      // get tack and level names of anagestConfigs\n      var trackNames = [];\n      var levelNames = [];\n      DBconfig.levelDefinitions.forEach(function (ld) {\n        if (ld.anagestConfig !== undefined) {\n          trackNames.push(ld.anagestConfig.verticalPosSsffTrackName);\n          trackNames.push(ld.anagestConfig.velocitySsffTrackName);\n          levelNames.push(ld.anagestConfig.autoLinkLevelName);\n        }\n      });\n      // check levels\n      var lDefRes = checkIfLevelsAreDefined(levelNames, DBconfig);\n      if (lDefRes !== true) {\n        res = 'Error in DBconfig/levelDefinitions/anagestConfig/autoLinkLevelName! References to undefined levels are present. ' + lDefRes;\n      }\n      // check ssffTrackDefs\n      var tDefRes = checkIfSsffTracksAreDefined(trackNames, DBconfig);\n      if (tDefRes !== true) {\n        res = 'Error in DBconfig/levelDefinitions/anagestConfig/verticalPosSsffTrackName || velocitySsffTrackName! References to undefined ssffTracks are present. ' + tDefRes;\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.loadSchemas = function () {\n      var proms = [];\n      var uri;\n      angular.forEach(names, function (n) {\n        uri = 'schemaFiles/' + n + '.json';\n        proms.push($http.get(uri));\n      });\n      return $q.all(proms);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setSchemas = function (schemaArr) {\n      angular.forEach(schemaArr, function (s) {\n        schemasJsos.push({\n          name: s.config.url,\n          data: s.data\n        });\n        // add annotationFileSchema to tv4 for de-referencing $ref\n        if (s.config.url === 'schemaFiles/annotationFileSchema.json') {\n          tv4.addSchema(s.config.url, s.data);\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSchema = function (schemaName) {\n      var schema = undefined;\n      angular.forEach(schemasJsos, function (s) {\n        if (s.name === 'schemaFiles/' + schemaName + '.json') {\n          schema = s;\n        }\n      });\n      return schema;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.validateJSO = function (schemaName, jso) {\n      var schema = sServObj.getSchema(schemaName);\n      var res;\n      if (schema !== undefined && tv4.validate(jso, schema.data)) {\n        if (schemaName === 'DBconfigFileSchema') {\n          var semCheckRes = sServObj.semCheckLoadedConfigs(ConfigProviderService.vals, ConfigProviderService.curDbConfig);\n          if (semCheckRes === true) {\n            res = true;\n          } else {\n            res = semCheckRes;\n          }\n        } else {\n          res = true;\n        }\n      } else {\n        if (schema === undefined) {\n          res = 'Schema: ' + schemaName + ' is currently undefined! This is probably due to a misnamed schema file on the server...';\n        } else {\n          res = tv4.error;\n        }\n      }\n      return res;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ShowhierarchyCtrl', [\n  '$scope',\n  'viewState',\n  'modalService',\n  'ConfigProviderService',\n  'LevelService',\n  'HierarchyLayoutService',\n  'StandardFuncsService',\n  function ($scope, viewState, modalService, ConfigProviderService, LevelService, HierarchyLayoutService, StandardFuncsService) {\n    // Scope data\n    $scope.paths = {\n      possible: [],\n      possibleAsStr: [],\n      selected: ''\n    };\n    $scope.vs = viewState;\n    $scope.standardFuncServ = StandardFuncsService;\n    // Find non-ITEM levels to start calculating possible paths through the hierarchy of levels\n    angular.forEach(ConfigProviderService.curDbConfig.levelDefinitions, function (l) {\n      if (l.type !== 'ITEM') {\n        $scope.paths.possible = $scope.paths.possible.concat(HierarchyLayoutService.findPaths(l.name));\n      }\n    });\n    // convert array paths to strings\n    angular.forEach($scope.paths.possible, function (arr, arrIdx) {\n      var revArr = StandardFuncsService.reverseCopy(arr);\n      if (arrIdx === 0) {\n        // select first possible path on load\n        $scope.paths.selected = revArr.join(' \\u2192 ');\n      }\n      $scope.paths.possibleAsStr.push(revArr.join(' \\u2192 '));\n    });\n    //////////////\n    // watches\n    $scope.$watch('paths.selected', function (newValue) {\n      viewState.hierarchyState.path = $scope.paths.possible[$scope.getSelIdx()];\n    }, false);\n    //\n    //////////////\n    /**\n\t\t * Returns index of the currently selected path (within the $scope.paths.possible array)\n\t\t */\n    $scope.getSelIdx = function () {\n      var selIdx = $scope.paths.possibleAsStr.indexOf($scope.paths.selected);\n      return selIdx;\n    };\n    $scope.rotateHierarchy = function () {\n      viewState.hierarchyState.toggleRotation();\n    };\n    $scope.getRotation = function () {\n      return viewState.hierarchyState.isRotated();\n    };\n    $scope.playSelection = function () {\n      ++viewState.hierarchyState.playing;\n    };\n    $scope.getPlaying = function () {\n      return viewState.hierarchyState.playing;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.isCurrentAttrDef = function (levelName, attrDef) {\n      if (viewState.getCurAttrDef(levelName) === attrDef) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t * set current attribute definition\n\t\t * just delegates same fuction call to viewState\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @param attrDef name of attribute definition\n\t\t */\n    $scope.setCurrentAttrDef = function (levelName, attrDefName, attrDefIndex) {\n      viewState.setCurAttrDef(levelName, attrDefName, attrDefIndex);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getAllAttrDefs = function (levelName) {\n      var levDef = ConfigProviderService.getLevelDefinition(levelName);\n      return levDef.attributeDefinitions;\n    };\n    /**\n\t\t * cancel dialog i.e. close\n\t\t */\n    $scope.cancel = function () {\n      modalService.close();\n    };\n  }\n]);\n'use strict';\n/**\n * This service aims to provide functions for laying out the hierarchy of a\n * bundle (ie, calculating the positions of the nodes). The actual drawing is\n * done in a directive, the manipulation of the hierarchy is done in another\n * service.\n *\n * While the DBConfig allows for a complex network of levels, the visualisation\n * is always limited to one straight path of levels. This path has to be passed\n * in to the individual functions that expect a selectedPath parameter.\n *\n * A selection menu shall be offered comprising all possible paths through the\n * hierarchy. Therefore, this service offers the function findPaths() to return\n * all possible paths.\n */\nangular.module('emuwebApp').service('HierarchyLayoutService', [\n  'viewState',\n  'ConfigProviderService',\n  'LevelService',\n  'DataService',\n  function (viewState, ConfigProviderService, LevelService, DataService) {\n    // shared service object\n    var sServObj = {};\n    /////////////////////\n    // public API\n    /**\n\t\t * Recursively find all paths through the hierarchy of levels.\n\t\t * This is done bottom-up because there is no explicit root element in the levelDefinitions.\n\t\t *\n\t\t * @param startLevel The name of the level from which to start\n\t\t * @param path An array of levels' names that form a path to startLevel (optional; shouldn't be an empty array)\n\t\t */\n    sServObj.findPaths = function (startLevel, path) {\n      if (typeof path === 'undefined') {\n        var path = [startLevel];\n      } else {\n        path = path.concat([startLevel]);\n      }\n      // Find all parents of startLevel\n      var parents = this.findParentLevels(startLevel);\n      // If we have no more parents, we're at the end of the\n      // path and thus returning it\n      if (parents.length === 0) {\n        return [path];\n      }\n      // If, on the other hand, there are parents, we start\n      // recursion to find all paths\n      var paths = [];\n      for (var i = 0; i < parents.length; ++i) {\n        paths = paths.concat(sServObj.findPaths(parents[i], path));\n      }\n      return paths;\n    };\n    /**\n\t\t * Find all parent levels of a given level by iterating through the\n\t\t * current database's linkDefinitions.\n\t\t *\n\t\t * @param childLevel The name of the level whose parents to find\n\t\t * @returns An array of names of childLevel's parent levels\n\t\t */\n    sServObj.findParentLevels = function (childLevel) {\n      var parents = [];\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === childLevel) {\n          parents.push(ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName);\n        }\n      }\n      return parents;\n    };\n    /**\n\t\t * Calculate the weights (size within their level) of all\n\t\t * nodes bottom-up.\n\t\t *\n\t\t * This is most likely rather slow and -definitely needs- could\n\t\t * use some tweaking\n\t\t */\n    sServObj.calculateWeightsBottomUp = function (selectedPath) {\n      var i, ii, iii;\n      /////\n      // Make sure all items have proper _parents and\n      // _visibile attributes\n      sServObj.findParents(selectedPath);\n      sServObj.findVisibility(selectedPath);\n      /////\n      // Iterate through levels bottom-up\n      for (i = 0; i < selectedPath.length; ++i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]);\n        // This will be the total of the weights of all\n        // items on this level\n        level._weight = 0;\n        //////\n        // Iterate through items to calculate their\n        // _weight and the level's _weight\n        for (ii = 0; ii < level.items.length; ++ii) {\n          if (level.items[ii]._visible === false) {\n            level.items[ii]._weight = 0.35;\n          } else {\n            level.items[ii]._weight = 1;\n          }\n          // Calculate weight of the level\n          level._weight += level.items[ii]._weight;\n        }\n        /////\n        // Iterate through items again to calculate\n        // their _posInLevel and _depth.\n        // This is done in a new for loop because it\n        // depends on the correctness of level._weight\n        var posInLevel = 0;\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._posInLevel = (posInLevel + level.items[ii]._weight / 2) / level._weight;\n          posInLevel += level.items[ii]._weight;\n          level.items[ii]._depth = selectedPath.length - i - 1;\n          //////\n          // Additionally, calculate link positions\n          var links = DataService.getData().links;\n          for (var l = 0; l < links.length; ++l) {\n            if (links[l].toID === level.items[ii].id) {\n              links[l]._toPosInLevel = level.items[ii]._posInLevel;\n              links[l]._toDepth = level.items[ii]._depth;\n            }\n            if (links[l].fromID === level.items[ii].id) {\n              links[l]._fromPosInLevel = level.items[ii]._posInLevel;\n              links[l]._fromDepth = level.items[ii]._depth;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t * Find all children of a node d that are part of the currently selected\n\t\t * path through the hierarchy\n\t\t *\n\t\t * @return an array of children nodes\n\t\t * @return empty array if there are no children (previously would return null due to a d3 dependency that no longer exists)\n\t\t */\n    sServObj.findChildren = function (d, selectedPath) {\n      var children = [];\n      // Find the level that d is a part of\n      // Return empty array if that fails (which shouldn't happen at all)\n      var currentLevel = LevelService.getLevelName(d.id);\n      if (currentLevel === null) {\n        console.log('Likely a bug: failed to find a node\\'s level', d);\n        return [];\n      }\n      // Find the child level\n      var childLevel = null;\n      for (var i = 0; i < selectedPath.length - 1; ++i) {\n        if (selectedPath[i + 1] === currentLevel) {\n          childLevel = selectedPath[i];\n          break;\n        }\n      }\n      if (childLevel === null) {\n        return [];\n      }\n      // Iterate over links to find children\n      for (var li = 0; li < DataService.getData().links.length; ++li) {\n        if (DataService.getData().links[li].fromID === d.id) {\n          // Iterate over levels to find the object corresponding to d.id\n          for (var l = 0; l < DataService.getData().levels.length; ++l) {\n            if (DataService.getData().levels[l].name !== childLevel) {\n              continue;\n            }\n            for (var it = 0; it < DataService.getData().levels[l].items.length; ++it) {\n              if (DataService.getData().levels[l].items[it].id === DataService.getData().links[li].toID) {\n                children.push(DataService.getData().levels[l].items[it]);\n              }\n            }\n          }\n        }\n      }\n      return children;\n    };\n    /**\n\t\t * This function aims to find and store the parents of every\n\t\t * node (along the selected path).\n\t\t *\n\t\t * First clears the _parents attribute from all item and then\n\t\t * re-calculates them.\n\t\t *\n\t\t * All items on the currently selected path will then have a\n\t\t * _parents property that is either an empty array (if it has\n\t\t * no parents) or an array containing its parents.\n\t\t */\n    sServObj.findParents = function (selectedPath) {\n      var i, ii, c;\n      //////\n      // Clear _parents from all items\n      var level;\n      for (i = 0; i < selectedPath.length; ++i) {\n        level = LevelService.getLevelDetails(selectedPath[i]);\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._parents = [];\n        }\n      }\n      /////\n      // Iterate through levels\n      for (i = 0; i < selectedPath.length; ++i) {\n        level = LevelService.getLevelDetails(selectedPath[i]);\n        // Iterate through the current level's items\n        // And save them as _parents in their children\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var children = sServObj.findChildren(level.items[ii], selectedPath);\n          for (c = 0; c < children.length; ++c) {\n            children[c]._parents.push(level.items[ii]);\n          }\n        }\n      }\n    };\n    /**\n\t\t * Find out, which paths ought to be drawn because they are not\n\t\t * collapsed.\n\t\t *\n\t\t * Will add a boolean attribute _visible to all items on the\n\t\t * currently selected path.\n\t\t */\n    sServObj.findVisibility = function (selectedPath) {\n      // Root nodes are all nodes that have no parents and\n      // thus form a sub-graph.\n      //\n      // Note that some descendants of a given root node\n      // might also be the descendant of another root node.\n      // thus \"connecting\" the different sub-graphs. If this\n      // were a real connection, the different sub-graphs\n      // would actually be one graph. But it is not a real\n      // connection since the whole graph is directed and the\n      // connections can never be along the direction of an\n      // edge.\n      if (selectedPath !== undefined && selectedPath.length > 0) {\n        var rootLevelItems = [];\n        var level;\n        for (var i = 0; i < selectedPath.length; ++i) {\n          level = LevelService.getLevelDetails(selectedPath[i]);\n          for (var ii = 0; ii < level.items.length; ++ii) {\n            if (level.items[ii]._parents.length === 0) {\n              rootLevelItems.push(level.items[ii]);\n            }\n          }\n        }\n        // First, set all nodes invisible. Later we will search\n        // all paths and if we find one uncollasped path to a\n        // node, that node will be set visible.\n        var currentItem;\n        var items = [];\n        items = items.concat(rootLevelItems);\n        while (items.length > 0) {\n          currentItem = items.pop();\n          items = items.concat(sServObj.findChildren(currentItem, selectedPath));\n          currentItem._visible = false;\n        }\n        // Now all nodes on the selectedPath have been set\n        // invisible. Try and find those that must be visible,\n        // i.e. either they are a root node or there is an\n        // uncollapsed path to them from a root node.\n        items = [];\n        items = items.concat(rootLevelItems);\n        while (items.length > 0) {\n          currentItem = items.pop();\n          if (!viewState.hierarchyState.getCollapsed(currentItem.id)) {\n            items = items.concat(sServObj.findChildren(currentItem, selectedPath));\n          }\n          currentItem._visible = true;\n        }\n      }\n    };\n    /**\n\t\t * Toggle the state of a single item with its subtree\n\t\t */\n    sServObj.toggleCollapse = function (d, selectedPath) {\n      // Find out whether we're collapsing or decollapsing\n      var isCollapsing = !viewState.hierarchyState.getCollapsed(d.id);\n      viewState.hierarchyState.setCollapsed(d.id, isCollapsing);\n      // Traverse sub-tree and change each item's number of collapsed parents\n      //\n      // Set each item's collapsePosition as well\n      // collapsePosition is the coordinate where they fade out to or fade in from\n      var currentDescendant;\n      var descendants = sServObj.findChildren(d, selectedPath);\n      while (descendants.length > 0) {\n        currentDescendant = descendants.pop();\n        descendants = descendants.concat(sServObj.findChildren(currentDescendant, selectedPath));\n        var num = viewState.hierarchyState.getNumCollapsedParents(currentDescendant.id);\n        if (isCollapsing) {\n          viewState.hierarchyState.setNumCollapsedParents(currentDescendant.id, num + 1);\n        } else {\n          viewState.hierarchyState.setNumCollapsedParents(currentDescendant.id, num - 1);\n        }\n        viewState.hierarchyState.setCollapsePosition(currentDescendant.id, [\n          d._x,\n          d._y\n        ]);\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ArrayHelperService', [\n  '$q',\n  function ArrayHelperService($q) {\n    // shared service object\n    var sServObj = {};\n    var defer;\n    // defer promise obj\n    /**\n\t\t * convert values of array to max values\n\t\t *\n\t\t * @param arr array to convert\n\t\t * @returns array containing Math.abs() values\n\t\t */\n    sServObj.convertToAbsValues = function (arr) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = Math.abs(arr[i]);\n      }\n      return arr;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.multiplyEachElement = function (arr, val) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = arr[i] * val;\n      }\n      return arr;\n    };\n    /**\n\t\t * find value between two points\n\t\t * by linearly interpolating them\n\t\t */\n    sServObj.interp2points = function (x0, y0, x1, y1, x) {\n      return y0 + (y1 - y0) * ((x - x0) / (x1 - x0));\n    };\n    /**\n\t\t * find min or maximum value in array\n\t\t *\n\t\t * @param arr array to search in\n\t\t * @param minOrMax string value either 'min' or 'max'\n\t\t * @returns object with attributes val and idx\n\t\t */\n    sServObj.findMinMax = function (arr, minOrMax) {\n      var val, idx;\n      if (minOrMax === 'min') {\n        val = Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] < val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      } else if (minOrMax === 'max') {\n        val = -Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] > val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      }\n      return {\n        'val': val,\n        'idx': idx\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.flattenArrayOfArray = function (arrOfArrs) {\n      var merged = [];\n      merged = merged.concat.apply(merged, arrOfArrs);\n      return merged;\n    };\n    /**\n\t\t * convert array to an array that contains\n\t\t * objects of the form {x: i, y:y[i]}\n\t\t */\n    sServObj.convertArrayToXYjsoArray = function (y) {\n      var xyArray = [];\n      for (var i = 0; i < y.length; i++) {\n        xyArray.push({\n          x: i,\n          y: y[i]\n        });\n      }\n      return xyArray;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('AnagestService', [\n  '$q',\n  '$log',\n  'viewState',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  'modalService',\n  'HistoryService',\n  'DataService',\n  function AnagestService($q, $log, viewState, LevelService, LinkService, ConfigProviderService, Ssffdataservice, ArrayHelperService, modalService, HistoryService, DataService) {\n    // shared service object\n    var sServObj = {};\n    // defer object \n    var defer;\n    /**\n\t\t *\n\t\t */\n    sServObj.insertAnagestEvents = function () {\n      var defer = $q.defer();\n      // precheck if there are items in selection\n      var itemInSel = viewState.getItemsInSelection(DataService.data.levels);\n      if (itemInSel.length !== 0) {\n        modalService.open('views/error.html', 'There are already events in the selected area! This is not permitted...').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // vertical position signal\n      var trackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.verticalPosSsffTrackName;\n      var tr = ConfigProviderService.getSsffTrackConfig(trackName);\n      var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n      var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n      // velocity signal\n      var vTrackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.velocitySsffTrackName;\n      var vTr = ConfigProviderService.getSsffTrackConfig(vTrackName);\n      var vCol = Ssffdataservice.getColumnOfTrack(vTr.name, vTr.columnName);\n      var vSRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(vTr.name);\n      if (col.length !== 1 || vCol.length !== 1) {\n        modalService.open('views/error.html', 'UPS... the column length of of one of the tracks is != 1 this means something is badly configured in the DB!!!').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // flatten columns\n      var flatColVals = ArrayHelperService.flattenArrayOfArray(col.values);\n      var flatVcolVals = ArrayHelperService.flattenArrayOfArray(vCol.values);\n      /////////////////////////////////////////\n      var gdat = [\n          NaN,\n          NaN\n        ];\n      var vdat = [\n          NaN,\n          NaN\n        ];\n      var ndat = [\n          NaN,\n          NaN\n        ];\n      var cdat = [\n          NaN,\n          NaN\n        ];\n      // easiest way to handle non-tangential signals (and has no effect on tangential signals)\n      flatVcolVals = ArrayHelperService.convertToAbsValues(flatVcolVals);\n      // selected column samples\n      var startTimeSel = viewState.getSelectedStartTime();\n      var endTimeSel = viewState.getSelectedEndTime();\n      var colStartSampleNr = Math.round(startTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var colEndSampleNr = Math.round(endTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n      var selCol = flatColVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      var selVCol = flatVcolVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      // maxConstr\n      var maxVerticalPos = ArrayHelperService.findMinMax(selCol, 'max');\n      cdat[0] = maxVerticalPos.idx;\n      // max vel before max constriction\n      var maxVelBeforeMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(0, cdat[0] + 1), 'max');\n      vdat[0] = maxVelBeforeMaxConstr.idx;\n      // min vel before max vel\n      var minVelBeforeMaxVel = ArrayHelperService.findMinMax(selVCol.slice(0, vdat[0] + 1), 'min');\n      // gesture onset\n      $log.info('Looking for gesture onset');\n      sServObj.interactiveFindThresholds(selVCol.slice(0, vdat[0] + 1), minVelBeforeMaxVel.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for gesture onset').then(function (resp) {\n        // keyboard;\n        var on20 = resp;\n        gdat[0] = on20;\n        // min vel between max vel 1 and max constriction\n        var minVelBetwMaxVel1maxConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[0], cdat[0] + 1), 'min');\n        var minp = minVelBetwMaxVel1maxConstr.idx + vdat[0];\n        // nucleus onset\n        $log.info('Looking for nucleus onset');\n        sServObj.interactiveFindThresholds(selVCol.slice(vdat[0], minp + 1), minVelBetwMaxVel1maxConstr.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for nucleus onset').then(function (resp) {\n          var off20 = resp;\n          ndat[0] = off20 + vdat[0];\n          // max vel after max constriction\n          var maxVelAfterMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0]), 'max');\n          // max vel before max constriction\n          vdat[1] = maxVelAfterMaxConstr.idx + cdat[0];\n          // minimum between max constriction and max vel after constriction\n          var minBetwMaxConstrMaxVelConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0], vdat[1] + 1), 'min');\n          minp = minBetwMaxConstrMaxVelConstr.idx + cdat[0];\n          // nucleus offset\n          $log.info('Looking for nucleus offset');\n          sServObj.interactiveFindThresholds(selVCol.slice(minp, vdat[1] + 1), minBetwMaxConstrMaxVelConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for nucleus offset').then(function (resp) {\n            var on20 = resp;\n            ndat[1] = on20 + minp;\n            // minimum velocity after max vel after constriction\n            var minVelAfterMaxVelAfterConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[1]), 'min');\n            minp = minVelAfterMaxVelAfterConstr.idx + vdat[1];\n            // gesture offset\n            $log.info('Looking for gesture offset');\n            sServObj.interactiveFindThresholds(selVCol.slice(vdat[1], minp + 1), minVelAfterMaxVelAfterConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for gesture offset').then(function (resp) {\n              var off20 = resp;\n              gdat[1] = off20 + vdat[1];\n              // insert points\n              // var insPoint;\n              var curLabel;\n              // console.log(gdat)\n              gdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              gdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[0];\n              var gdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[0],\n                'id': gdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[1];\n              var gdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[1],\n                'id': gdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(vdat);\n              vdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              vdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[0];\n              var vdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[0],\n                'id': vdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[1];\n              var vdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[1],\n                'id': vdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(ndat);\n              ndat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[0], sRaSt.sampleRate, sRaSt.startTime);\n              ndat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[0];\n              var ndat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[0],\n                'id': ndat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[1];\n              var ndat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[1],\n                'id': ndat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(cdat);\n              cdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + cdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxConstrictionLabel;\n              var cdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), cdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': cdat[0],\n                'id': cdat0insPoint.id,\n                'pointName': curLabel\n              });\n              var linkLevelName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.autoLinkLevelName;\n              var linkLevelDetails = LevelService.getLevelDetails(linkLevelName);\n              var linkLevelLabels = LevelService.getAllLabelsOfLevel(linkLevelDetails);\n              modalService.open('views/SelectLabelModal.html', linkLevelLabels, undefined, true).then(function (itemIdx) {\n                if (itemIdx !== false) {\n                  var childIDs = [\n                      gdat0insPoint.id,\n                      gdat1insPoint.id,\n                      vdat0insPoint.id,\n                      vdat1insPoint.id,\n                      ndat0insPoint.id,\n                      ndat1insPoint.id,\n                      cdat0insPoint.id\n                    ];\n                  LinkService.insertLinksTo(linkLevelDetails.level.items[itemIdx].id, childIDs);\n                  HistoryService.updateCurChangeObj({\n                    'type': 'ANNOT',\n                    'action': 'INSERTLINKSTO',\n                    'name': linkLevelDetails.level.name,\n                    'parentID': linkLevelDetails.level.items[itemIdx].id,\n                    'childIDs': childIDs\n                  });\n                  HistoryService.addCurChangeObjToUndoStack();\n                }\n              });\n              defer.resolve();\n            });\n          });\n        });\n      }, function () {\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * find threshold in array (an adapted reimplementation of findth.m by\n\t\t * Phil Hoole Version 17.6.2006)\n\t\t *\n\t\t * @param x\n\t\t * @param minVal\n\t\t * @param maxVal\n\t\t * @param threshold\n\t\t * @param direction\n\t\t * @param descriptions describes the task\n\t\t * @returns promise that resolves to threshold value\n\t\t */\n    sServObj.interactiveFindThresholds = function (x, minVal, maxVal, threshold, direction, description) {\n      // console.log('interactiveFindThresholds');\n      var thdat = minVal + (maxVal - minVal) * threshold;\n      var thdir = direction;\n      thdat = thdat * thdir;\n      var xx = ArrayHelperService.multiplyEachElement(x, thdir);\n      // handle positive/neg.\n      var lx = xx.length;\n      var xsh = xx.slice(1, lx);\n      var loguk = 0;\n      var higuk = lx - 1;\n      // vz=find((xsh>=thdat)&(xx(1:(lx-1))<thdat));\n      var vz = [];\n      for (var i = 0; i < xx.length; i++) {\n        if (xsh[i] >= thdat && xx[i] < thdat) {\n          vz.push(i);\n        }\n      }\n      // anavv=find(vz>=loguk & vz<=higuk);\n      var anavv = [];\n      for (var i = 0; i < vz.length; i++) {\n        if (vz[i] >= loguk && vz[i] <= higuk) {\n          anavv.push(i);\n        }\n      }\n      if (anavv.length > 1) {\n        defer = $q.defer();\n        var infos = {};\n        infos.description = description;\n        infos.options = [];\n        infos.y = xx;\n        infos.minVal = minVal;\n        infos.maxVal = maxVal;\n        infos.threshold = threshold;\n        for (var i = 0; i < vz.length; i++) {\n          infos.options.push({\n            'thresholdIdx': vz[i],\n            'thresholdValue': xx[i]\n          });\n        }\n        modalService.open('views/SelectThresholdModal.html', infos, undefined, true).then(function (resp) {\n          console.log(resp);\n          var ap = vz[anavv[resp]];\n          ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n          defer.resolve(ap);\n        });\n        return defer.promise;\n      } else if (anavv.length === 0) {\n        defer = $q.defer();\n        modalService.open('views/error.html', 'Could not find any values that step over the threshold!!').then(function () {\n          defer.reject('Could not find any values that step over the threshold!!');\n        });\n        return defer.promise;\n      } else {\n        defer = $q.defer();\n        var ap = vz[anavv[0]];\n        ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n        defer.resolve(ap);\n        return defer.promise;\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DragnDropDataService', [\n  '$q',\n  'ConfigProviderService',\n  'modalService',\n  function DragnDropDataService($q, ConfigProviderService, modalService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.convertedBundles = [];\n    sServObj.sessionDefault = '';\n    ///////////////////////////////\n    // public api\n    sServObj.getBundle = function (name, session) {\n      var defer = $q.defer();\n      var ret = {};\n      angular.forEach(sServObj.convertedBundles, function (bundle, i) {\n        if (bundle.name === name) {\n          var bc = angular.copy(bundle);\n          delete bc.name;\n          defer.resolve({\n            status: 200,\n            data: bc\n          });\n        }\n      });\n      return defer.promise;\n    };\n    sServObj.resetToInitState = function () {\n      sServObj.convertedBundles = [];\n      sServObj.sessionDefault = '';\n    };\n    sServObj.setDefaultSession = function (name) {\n      sServObj.sessionDefault = name;\n    };\n    sServObj.getDefaultSession = function () {\n      return sServObj.sessionDefault;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DragnDropService', [\n  '$q',\n  '$rootScope',\n  'modalService',\n  'DataService',\n  'Validationservice',\n  'ConfigProviderService',\n  'DragnDropDataService',\n  'Iohandlerservice',\n  'viewState',\n  'Soundhandlerservice',\n  'Binarydatamaniphelper',\n  'browserDetector',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'loadedMetaDataService',\n  'LevelService',\n  function DragnDropService($q, $rootScope, modalService, DataService, Validationservice, ConfigProviderService, DragnDropDataService, Iohandlerservice, viewState, Soundhandlerservice, Binarydatamaniphelper, browserDetector, Wavparserservice, Textgridparserservice, loadedMetaDataService, LevelService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.drandropBundles = [];\n    sServObj.bundleList = [];\n    sServObj.sessionName = 'File(s)';\n    sServObj.maxDroppedBundles = 10;\n    ///////////////////////////////\n    // public api\n    ///////////////////\n    // drag n drop data\n    sServObj.setData = function (bundles) {\n      var count = 0;\n      angular.forEach(bundles, function (bundle, i) {\n        sServObj.setDragnDropData(bundle[0], i, 'wav', bundle[1]);\n        if (bundle[2] !== undefined) {\n          sServObj.setDragnDropData(bundle[0], i, 'annotation', bundle[2]);\n        }\n        count = i;\n      });\n      if (count <= sServObj.maxDroppedBundles) {\n        sServObj.convertDragnDropData(sServObj.drandropBundles, 0).then(function () {\n          loadedMetaDataService.setBundleList(sServObj.bundleList);\n          loadedMetaDataService.setCurBndlName(sServObj.bundleList[DragnDropDataService.sessionDefault]);\n          loadedMetaDataService.setDemoDbName(sServObj.bundleList[DragnDropDataService.sessionDefault]);\n          sServObj.handleLocalFiles();\n          return true;\n        });\n      } else {\n        return false;\n      }\n    };\n    sServObj.resetToInitState = function () {\n      delete sServObj.drandropBundles;\n      sServObj.drandropBundles = [];\n      delete sServObj.bundleList;\n      sServObj.bundleList = [];\n      sServObj.sessionName = 'File(s)';\n      sServObj.maxDroppedBundles = 10;\n      DragnDropDataService.resetToInitState();\n      loadedMetaDataService.resetToInitState();\n    };\n    /**\n\t\t * setter sServObj.drandropBundles\n\t\t */\n    sServObj.setDragnDropData = function (bundle, i, type, data) {\n      DragnDropDataService.setDefaultSession(i);\n      if (sServObj.drandropBundles[i] === undefined) {\n        sServObj.drandropBundles[i] = {};\n        DragnDropDataService.convertedBundles[i] = {};\n        DragnDropDataService.convertedBundles[i].name = bundle;\n        sServObj.bundleList.push({\n          name: bundle,\n          session: sServObj.sessionName\n        });\n      }\n      if (type === 'wav') {\n        sServObj.drandropBundles[i].wav = data;\n      } else if (type === 'annotation') {\n        sServObj.drandropBundles[i].annotation = data;\n      }\n    };\n    /**\n\t\t * getter sServObj.drandropBundles\n\t\t */\n    sServObj.getDragnDropData = function (bundle, type) {\n      if (type === 'wav') {\n        return sServObj.drandropBundles[bundle].wav;\n      } else if (type === 'annotation') {\n        return sServObj.drandropBundles[bundle].annotation;\n      } else {\n        return false;\n      }\n    };\n    sServObj.generateDrop = function (data) {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL(sServObj.getBlob(data));\n      } else {\n        objURL = URL.createObjectURL(sServObj.getBlob(data));\n      }\n      return objURL;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBlob = function (data) {\n      var blob;\n      try {\n        blob = new Blob([data], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append(data);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    sServObj.convertDragnDropData = function (bundles, i) {\n      var defer = $q.defer();\n      var data = sServObj.drandropBundles[i];\n      var reader = new FileReader();\n      var reader2 = new FileReader();\n      var res;\n      if (bundles.length > i) {\n        if (data.wav !== undefined) {\n          reader.readAsArrayBuffer(data.wav);\n          reader.onloadend = function (evt) {\n            if (evt.target.readyState == FileReader.DONE) {\n              if (browserDetector.isBrowser.Firefox()) {\n                res = evt.target.result;\n              } else {\n                res = evt.currentTarget.result;\n              }\n              Wavparserservice.parseWavArrBuf(res).then(function (wavJSO) {\n                if (DragnDropDataService.convertedBundles[i] === undefined) {\n                  DragnDropDataService.convertedBundles[i] = {};\n                }\n                DragnDropDataService.convertedBundles[i].mediaFile = {};\n                Soundhandlerservice.wavJSO = wavJSO;\n                DragnDropDataService.convertedBundles[i].mediaFile.data = Binarydatamaniphelper.arrayBufferToBase64(wavJSO.origArrBuf);\n                DragnDropDataService.convertedBundles[i].mediaFile.encoding = 'BASE64';\n                DragnDropDataService.convertedBundles[i].ssffFiles = [];\n                var bundle = data.wav.name.substr(0, data.wav.name.lastIndexOf('.'));\n                if (data.annotation === undefined) {\n                  DragnDropDataService.convertedBundles[i].annotation = {\n                    levels: [],\n                    links: [],\n                    sampleRate: wavJSO.SampleRate,\n                    annotates: bundle,\n                    name: bundle\n                  };\n                  sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                    delete sServObj.drandropBundles;\n                    sServObj.drandropBundles = [];\n                    defer.resolve();\n                  });\n                } else {\n                  if (data.annotation.type === 'textgrid') {\n                    reader2.readAsText(data.annotation.file);\n                    reader2.onloadend = function (evt) {\n                      if (evt.target.readyState == FileReader.DONE) {\n                        Textgridparserservice.asyncParseTextGrid(evt.currentTarget.result, data.wav.name, bundle).then(function (parseMess) {\n                          DragnDropDataService.convertedBundles[i].annotation = parseMess;\n                          sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                            defer.resolve();\n                          });\n                        }, function (errMess) {\n                          modalService.open('views/error.html', 'Error parsing TextGrid file: ' + errMess.status.message).then(function () {\n                            defer.reject();\n                          });\n                        });\n                      }\n                    };\n                  } else if (data.annotation.type === 'annotation') {\n                    ConfigProviderService.vals.activeButtons.showHierarchy = true;\n                    reader2.readAsText(data.annotation.file);\n                    reader2.onloadend = function (evt) {\n                      if (evt.target.readyState == FileReader.DONE) {\n                        DragnDropDataService.convertedBundles[i].annotation = angular.fromJson(evt.currentTarget.result);\n                        sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                          defer.resolve();\n                        });\n                      }\n                    };\n                  }\n                }\n              }, function (errMess) {\n                modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message).then(function () {\n                  defer.reject();\n                });\n              });\n            }\n          };\n        }\n      } else {\n        defer.resolve();\n        return defer.promise;\n      }\n      return defer.promise;\n    };\n    /**\n\t\t * handling local file drops after loading them\n\t\t */\n    sServObj.handleLocalFiles = function () {\n      var validRes;\n      var wav = DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].mediaFile.data;\n      var ab = Binarydatamaniphelper.base64ToArrayBuffer(wav);\n      var annotation;\n      if (DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].annotation !== undefined) {\n        annotation = DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].annotation;\n      } else {\n        annotation = {\n          levels: [],\n          links: []\n        };\n      }\n      viewState.showDropZone = false;\n      viewState.setState('loadingSaving');\n      // reset history\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading local File: ' + wav.name;\n      Iohandlerservice.httpGetPath('configFiles/standalone_emuwebappConfig.json').then(function (resp) {\n        // first element of perspectives is default perspective\n        viewState.curPerspectiveIdx = 0;\n        ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n        delete resp.data.EMUwebAppConfig;\n        // delete to avoid duplicate\n        validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n        if (validRes === true) {\n          ConfigProviderService.curDbConfig = resp.data;\n          viewState.somethingInProgressTxt = 'Parsing WAV file...';\n          Wavparserservice.parseWavArrBuf(ab).then(function (messWavParser) {\n            var wavJSO = messWavParser;\n            viewState.curViewPort.sS = 0;\n            viewState.curViewPort.eS = wavJSO.Data.length;\n            viewState.curViewPort.selectS = -1;\n            viewState.curViewPort.selectE = -1;\n            viewState.curClickSegments = [];\n            viewState.curClickLevelName = undefined;\n            viewState.curClickLevelType = undefined;\n            loadedMetaDataService.setCurBndl(DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault]);\n            viewState.resetSelect();\n            viewState.curPerspectiveIdx = 0;\n            DataService.setData(annotation);\n            var lNames = [];\n            var levelDefs = [];\n            annotation.levels.forEach(function (l) {\n              if (l.type === 'SEGMENT' || l.type === 'EVENT') {\n                lNames.push(l.name);\n                levelDefs.push({\n                  'name': l.name,\n                  'type': l.type,\n                  'attributeDefinitions': {\n                    'name': l.name,\n                    'type': 'string'\n                  }\n                });\n              }\n            });\n            // set level defs\n            ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            ConfigProviderService.setPerspectivesOrder(viewState.curPerspectiveIdx, lNames);\n            //ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n            Soundhandlerservice.wavJSO = wavJSO;\n            // set all ssff files\n            viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n            var validRes = Validationservice.validateJSO('annotationFileSchema', annotation);\n            if (validRes === true) {\n              DataService.setLinkData(annotation.links);\n              viewState.setState('labeling');\n              viewState.somethingInProgress = false;\n              viewState.somethingInProgressTxt = 'Done!';\n            } else {\n              modalService.open('views/error.html', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                //appStateService.resetToInitState();\n                sServObj.resetToInitState();\n              });\n            }\n            // select first level\n            if (!browserDetector.isBrowser.PhantomJS())\n              viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Error parsing wav file: ' + errMess).then(function () {\n              //appStateService.resetToInitState();\n              sServObj.resetToInitState();\n            });\n          });\n        }\n      });\n      viewState.somethingInProgress = false;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc directive\n * @name emuWebApp.directive:lineChart\n * @description\n * # lineChart\n */\nangular.module('emuwebApp').directive('lineChart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      threshold: '='\n    },\n    link: function postLink(scope, element, attrs) {\n      //////////////////////\n      // watches \n      scope.$watch('data', function () {\n        scope.render(scope.data);\n      }, true);\n      //////////////////////\n      //Set margins, width, and height\n      var margin = {\n          top: 20,\n          right: 20,\n          bottom: 20,\n          left: 40\n        }, width = 400 - margin.left - margin.right, height = 200 - margin.top - margin.bottom;\n      //Create the d3 element and position it based on margins\n      var svg = d3.select(element[0]).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      //Create the scales we need for the graph\n      var x = d3.scale.linear().range([\n          0,\n          width\n        ]);\n      var y = d3.scale.linear().range([\n          height,\n          0\n        ]);\n      //Create the axes we need for the graph\n      var xAxis = d3.svg.axis().scale(x).tickSize(5).tickSubdivide(true);\n      var yAxis = d3.svg.axis().scale(y).orient('left');\n      // line drawing function\n      var lineFunc = d3.svg.line().x(function (d) {\n          return x(d.x);\n        }).y(function (d) {\n          return y(d.y);\n        }).interpolate('linear');\n      /**\n\t\t\t\t *\n\t\t\t\t */\n      scope.render = function (data) {\n        //Set our scale's domains\n        // x.domain(data.map(function (d) {\n        // \treturn d.name;\n        // }));\n        // y.domain([0, d3.max(data, function (d) {\n        // \treturn d.count;\n        // })]);\n        x.domain([\n          d3.min(data, function (d) {\n            return d.x;\n          }),\n          d3.max(data, function (d) {\n            return d.x;\n          })\n        ]);\n        y.domain([\n          d3.min(data, function (d) {\n            return d.y;\n          }),\n          d3.max(data, function (d) {\n            return d.y;\n          })\n        ]);\n        //Remove the axes so we can draw updated ones\n        svg.selectAll('g.axis').remove();\n        //Render X axis\n        svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);\n        //Render Y axis\n        svg.append('g').attr('class', 'y axis').call(yAxis);\n        // Render path\n        var lines = svg.append('svg:path').attr('d', lineFunc(data)).attr('stroke', 'red').attr('stroke-width', 1).attr('fill', 'none');\n        // draw threshold SIC SIC SIC... not working yet!\n        svg.append('svg:line').attr('x1', 5).attr('y1', 5).attr('x2', 200).attr('y2', 200).attr('class', 'label-line');\n        var verticalLine = svg.append('line').attr({\n            'x1': x(scope.threshold),\n            'y1': 0,\n            'x2': x(scope.threshold),\n            'y2': height\n          }).attr('stroke', 'steelblue').attr('class', 'verticalLine');  //Create or update the bar data\n                                                                         // var bars = svg.selectAll('.bar').data(data);\n                                                                         // bars.enter()\n                                                                         // \t.append('rect')\n                                                                         // \t.attr('class', 'bar')\n                                                                         // \t.attr('x', function (d) {\n                                                                         // \t\treturn x(d.name);\n                                                                         // \t})\n                                                                         // \t.attr('width', x.rangeBand());\n                                                                         //Animate bars\n                                                                         // bars\n                                                                         // \t.transition()\n                                                                         // \t.duration(1000)\n                                                                         // \t.attr('height', function (d) {\n                                                                         // \t\treturn height - y(d.count);\n                                                                         // \t})\n                                                                         // \t.attr('y', function (d) {\n                                                                         // \t\treturn y(d.count);\n                                                                         // \t})\n      };\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('hint', function () {\n  return {\n    templateUrl: 'views/hint.html',\n    replace: true,\n    restrict: 'E',\n    link: function postLink(scope, element, attrs) {\n      scope.hideMe = function () {\n        scope.internalVars.showAboutHint = !scope.internalVars.showAboutHint;\n        scope.aboutBtnClick();\n      };\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('perspectives', function () {\n  return {\n    templateUrl: 'views/perspectives.html',\n    replace: true,\n    restrict: 'E',\n    link: function postLink(scope, element, attrs) {\n    }\n  };\n});\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.loadedMetaDataService\n * @description\n * # loadedMetaDataService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('loadedMetaDataService', [\n  'Validationservice',\n  function loadedMetaDataService(Validationservice) {\n    // shared service object\n    var sServObj = {};\n    //////////////////////\n    // private vars\n    var uniqSessionList = [];\n    var bundleList = [];\n    var curBndl = {};\n    var demoDbName = '';\n    var drandropBundles = [];\n    var rendOptBndlList = {};\n    // render optimized bundle list\n    //////////////////////\n    // private functions\n    function genUniqSessionList(bndlList) {\n      var sList = [];\n      var fistSes;\n      bndlList.forEach(function (bndl, idx) {\n        sList[bndl.session] = { 'collapsed': true };\n        if (idx === 0) {\n          fistSes = bndl.session;\n        }\n      });\n      // open fist session up \n      sList[fistSes].collapsed = false;\n      return sList;\n    }\n    function genRendOptBndlList(bndlList) {\n      bndlList.forEach(function (bndl, idx) {\n        if (rendOptBndlList[bndl.session] === undefined) {\n          rendOptBndlList[bndl.session] = [];\n        }\n        rendOptBndlList[bndl.session].push(bndl);\n      });\n      return rendOptBndlList;\n    }\n    //////////////////////\n    //////////////////////\n    // public API\n    ///////////////\n    // bundleList\n    /**\n\t\t * setter for bundleList\n\t\t * @returns validation result for bundle list\n\t\t */\n    sServObj.setBundleList = function (bList) {\n      // validate\n      var validRes = Validationservice.validateJSO('bundleListSchema', bList);\n      if (validRes === true) {\n        // set\n        bundleList = bList;\n        // generate uniqSessionList\n        uniqSessionList = genUniqSessionList(bundleList);\n        // generate render optimized bundlList\n        rendOptBndlList = genRendOptBndlList(bundleList);\n      }\n      return validRes;\n    };\n    /**\n\t\t * getter for bundleList\n\t\t */\n    sServObj.getBundleList = function () {\n      return bundleList;\n    };\n    /**\n\t\t * getter for rendOptBndlList\n\t\t */\n    sServObj.getRendOptBndlList = function () {\n      return rendOptBndlList;\n    };\n    ///////////\n    // curBndl \n    /**\n\t\t * getter curBndl\n\t\t */\n    sServObj.getCurBndl = function () {\n      return curBndl;\n    };\n    /**\n\t\t * setter curBndl\n\t\t */\n    sServObj.setCurBndl = function (bndl) {\n      curBndl = bndl;\n    };\n    /**\n\t\t * remove BndlComment\n\t\t */\n    sServObj.setBndlComment = function (comment, key, index) {\n      rendOptBndlList[key][index].comment = comment;\n    };\n    /**\n\t\t * setter BndlFinished\n\t\t */\n    sServObj.setBndlFinished = function (finished, key, index) {\n      rendOptBndlList[key][index].finishedEditing = finished;\n    };\n    /**\n\t\t * getter curBndl name\n\t\t */\n    sServObj.getCurBndlName = function () {\n      return curBndl.name;\n    };\n    /**\n\t\t * setter curBndl name\n\t\t */\n    sServObj.setCurBndlName = function (name) {\n      curBndl.name = name;\n    };\n    //////////////\n    // demoDbName\n    /**\n\t\t * setter demoDbName\n\t\t */\n    sServObj.setDemoDbName = function (name) {\n      demoDbName = name;\n    };\n    /**\n\t\t * getter demoDbName\n\t\t */\n    sServObj.getDemoDbName = function () {\n      return demoDbName;\n    };\n    ///////////////////\n    // uniqSessionList\n    /**\n\t\t *\n\t\t */\n    sServObj.toggleCollapseSession = function (session) {\n      console.log(session);\n      if (uniqSessionList[session] === undefined) {\n        uniqSessionList[session] = {};\n      }\n      uniqSessionList[session].collapsed = !uniqSessionList[session].collapsed;\n      // close all other sessions\n      Object.keys(uniqSessionList).forEach(function (key) {\n        if (key !== session) {\n          uniqSessionList[key].collapsed = true;\n        }\n      });\n    };\n    sServObj.openCollapseSession = function (session) {\n      console.log(session);\n      uniqSessionList[session] = {};\n      uniqSessionList[session].collapsed = false;\n      // close all other sessions\n      Object.keys(uniqSessionList).forEach(function (key) {\n        if (key !== session) {\n          uniqSessionList[key].collapsed = true;\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    // sServObj.updateCollapseSessionState = function (text) {\n    // \tangular.forEach(sServObj.getBundleList(), function (bundle) {\n    // \t\tif (bundle.name.indexOf(text)) {\n    // \t\t\tuniqSessionList[bundle.session].collapsed = false;\n    // \t\t} else {\n    // \t\t\tuniqSessionList[bundle.session].collapsed = true;\n    // \t\t}\n    // \t});\n    // };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSessionCollapseState = function (session) {\n      if (uniqSessionList[session] === undefined) {\n        return undefined;\n      } else {\n        return uniqSessionList[session].collapsed;\n      }\n    };\n    ///////////////////\n    // other functions\n    /**\n\t\t * reset all private vals to init state\n\t\t */\n    sServObj.resetToInitState = function () {\n      uniqSessionList = [];\n      bundleList = [];\n      curBndl = {};\n      rendOptBndlList = {};\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc function\n * @name emuwebApp.controller:BundlelistsidebarctrlCtrl\n * @description\n * # bundleListSideBarCtrl\n * Controller of the bundleListSideBar\n */\nangular.module('emuwebApp').controller('bundleListSideBarCtrl', [\n  '$scope',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'ConfigProviderService',\n  function ($scope, viewState, HistoryService, loadedMetaDataService, dbObjLoadSaveService, ConfigProviderService) {\n    $scope.vs = viewState;\n    $scope.lmds = loadedMetaDataService;\n    $scope.dolss = dbObjLoadSaveService;\n    $scope.cps = ConfigProviderService;\n    $scope.filterText = '';\n    $scope.vs.pageSize = 500;\n    $scope.vs.currentPage = 0;\n    $scope.turn = function (direction) {\n      if (direction) {\n        $scope.vs.currentPage++;\n      } else {\n        $scope.vs.currentPage--;\n      }\n    };\n    /**\n\t\t * returns false if bndl is current bndl\n\t\t */\n    $scope.uttIsDisabled = function (bndl) {\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return false;\n      } else {\n        return true;\n      }\n    };\n    /**\n\t\t * returns jso with css defining color dependent\n\t\t * on if changes have been made that have not been saved\n\t\t * @param bndl object containing name attribute of bundle item\n\t\t * requesting color\n\t\t * @returns color as jso object used by ng-style\n\t\t */\n    $scope.getBndlColor = function (bndl) {\n      var curColor;\n      if (HistoryService.movesAwayFromLastSave !== 0) {\n        curColor = {\n          'background-color': '#f00',\n          'color': 'white'\n        };\n      } else {\n        curColor = {\n          'background-color': '#999',\n          'color': 'black'\n        };\n      }\n      // console.log(bndl.name)\n      var curBndl = loadedMetaDataService.getCurBndl();\n      if (bndl.name === curBndl.name && bndl.session === curBndl.session) {\n        return curColor;\n      }\n    };\n    /**\n\t\t * checks if name is undefined\n\t\t * @return bool\n\t\t */\n    $scope.isSessionDefined = function (ses) {\n      if (ses === 'undefined') {\n        return false;\n      } else {\n        return true;\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.dbObjLoadSaveService\n * @description\n * # dbObjLoadSaveService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('dbObjLoadSaveService', [\n  '$log',\n  '$q',\n  'DataService',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'Ssffdataservice',\n  'Iohandlerservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Validationservice',\n  'LevelService',\n  'modalService',\n  'ConfigProviderService',\n  'appStateService',\n  'StandardFuncsService',\n  function dbObjLoadSaveService($log, $q, DataService, viewState, HistoryService, loadedMetaDataService, Ssffdataservice, Iohandlerservice, Binarydatamaniphelper, Wavparserservice, Soundhandlerservice, Ssffparserservice, Validationservice, LevelService, modalService, ConfigProviderService, appStateService, StandardFuncsService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * general loadBundle method.\n\t\t * @param bndl object containing name attribute of currently loaded bundle\n\t\t */\n    sServObj.loadBundle = function (bndl) {\n      // check if bndl has to be saved\n      viewState.setcurClickItem(null);\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO' && ConfigProviderService.vals.activeButtons.saveBundle) {\n        var curBndl = loadedMetaDataService.getCurBndl();\n        if (bndl !== curBndl) {\n          // $scope.lastclickedutt = bndl;\n          modalService.open('views/saveChanges.html', curBndl.session + ':' + curBndl.name).then(function (messModal) {\n            if (messModal === 'saveChanges') {\n              // save current bundle\n              sServObj.saveBundle().then(function () {\n                // load new bundle\n                sServObj.loadBundle(bndl);\n              });\n            } else if (messModal === 'discardChanges') {\n              // reset history\n              HistoryService.resetToInitState();\n              // load new bundle\n              sServObj.loadBundle(bndl);\n            }\n          });\n        }\n      } else {\n        if (bndl !== loadedMetaDataService.getCurBndl()) {\n          // reset history\n          HistoryService.resetToInitState();\n          // reset hierarchy\n          viewState.hierarchyState.reset();\n          // set state\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          viewState.setState('loadingSaving');\n          viewState.somethingInProgress = true;\n          viewState.somethingInProgressTxt = 'Loading bundle: ' + bndl.name;\n          // empty ssff files\n          Ssffdataservice.data = [];\n          Iohandlerservice.getBundle(bndl.name, bndl.session, loadedMetaDataService.getDemoDbName()).then(function (bundleData) {\n            // check if response from http request\n            if (bundleData.status === 200) {\n              bundleData = bundleData.data;\n            }\n            // validate bundle\n            var validRes = Validationservice.validateJSO('bundleSchema', bundleData);\n            if (validRes === true) {\n              var arrBuff;\n              // set wav file\n              arrBuff = Binarydatamaniphelper.base64ToArrayBuffer(bundleData.mediaFile.data);\n              viewState.somethingInProgressTxt = 'Parsing WAV file...';\n              Wavparserservice.parseWavArrBuf(arrBuff).then(function (messWavParser) {\n                var wavJSO = messWavParser;\n                viewState.curViewPort.sS = 0;\n                viewState.curViewPort.eS = wavJSO.Data.length;\n                viewState.curViewPort.selectS = -1;\n                viewState.curViewPort.selectE = -1;\n                viewState.curClickSegments = [];\n                viewState.curClickLevelName = undefined;\n                viewState.curClickLevelType = undefined;\n                viewState.resetSelect();\n                Soundhandlerservice.wavJSO = wavJSO;\n                // set all ssff files\n                viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n                Ssffparserservice.asyncParseSsffArr(bundleData.ssffFiles).then(function (ssffJso) {\n                  Ssffdataservice.data = ssffJso.data;\n                  // set annotation\n                  DataService.setData(bundleData.annotation);\n                  loadedMetaDataService.setCurBndl(bndl);\n                  // select first level\n                  viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);\n                  viewState.setState('labeling');\n                  viewState.somethingInProgress = false;\n                  viewState.somethingInProgressTxt = 'Done!';  // FOR DEVELOPMENT:\n                                                               // sServObj.saveBundle(); // for testing save function\n                                                               // $scope.menuBundleSaveBtnClick(); // for testing save button\n                                                               // $scope.showHierarchyBtnClick(); // for devel of showHierarchy modal\n                                                               // $scope.spectSettingsBtnClick(); // for testing spect settings dial\n                }, function (errMess) {\n                  modalService.open('views/error.html', 'Error parsing SSFF file: ' + errMess.status.message).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                });\n              }, function (errMess) {\n                modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message).then(function () {\n                  appStateService.resetToInitState();\n                });\n              });\n            } else {\n              modalService.open('views/error.html', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }, function (errMess) {\n            // check for http vs websocket response\n            if (errMess.data) {\n              modalService.open('views/error.html', 'Error loading bundle: ' + errMess.data).then(function () {\n                appStateService.resetToInitState();\n              });\n            } else {\n              modalService.open('views/error.html', 'Error loading bundle: ' + errMess.status.message).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          });\n        }\n      }\n    };\n    /**\n\t\t * general purpose save bundle function.\n\t\t * @return promise that is resolved after completion (rejected on error)\n\t\t */\n    sServObj.saveBundle = function () {\n      // check if something has changed\n      // if (HistoryService.movesAwayFromLastSave !== 0) {\n      if (viewState.getPermission('saveBndlBtnClick')) {\n        var defer = $q.defer();\n        viewState.somethingInProgress = true;\n        viewState.setState('loadingSaving');\n        //create bundle json\n        var bundleData = {};\n        viewState.somethingInProgressTxt = 'Creating bundle json...';\n        bundleData.ssffFiles = [];\n        // ssffFiles (only FORMANTS are allowed to be manipulated so only this track is sent back to server)\n        var formants = Ssffdataservice.getFile('FORMANTS');\n        if (formants !== undefined) {\n          Ssffparserservice.asyncJso2ssff(formants).then(function (messParser) {\n            bundleData.ssffFiles.push({\n              'fileExtension': formants.fileExtension,\n              'encoding': 'BASE64',\n              'data': Binarydatamaniphelper.arrayBufferToBase64(messParser.data)\n            });\n            sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Error converting javascript object to SSFF file: ' + errMess.status.message);\n            defer.reject();\n          });\n        } else {\n          sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n        }\n        return defer.promise;  // }\n      } else {\n        $log.info('Action: menuBundleSaveBtnClick not allowed!');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAnnotationAndSaveBndl = function (bundleData, defer) {\n      // Validate annotation before saving\n      viewState.somethingInProgressTxt = 'Validating annotJSON ...';\n      var validRes = Validationservice.validateJSO('annotationFileSchema', DataService.getData());\n      if (validRes !== true) {\n        $log.warn('PROBLEM: trying to save bundle but bundle is invalid. traverseAndClean() will be called.');\n        $log.error(validRes);\n      }\n      // clean annot data just to be safe...\n      StandardFuncsService.traverseAndClean(DataService.getData());\n      ////////////////////////////\n      // construct bundle\n      // annotation\n      bundleData.annotation = DataService.getData();\n      // empty media file (depricated since schema was updated)\n      bundleData.mediaFile = {\n        'encoding': 'BASE64',\n        'data': ''\n      };\n      var curBndl = loadedMetaDataService.getCurBndl();\n      // add session if available\n      if (typeof curBndl.session !== 'undefined') {\n        bundleData.session = curBndl.session;\n      }\n      // add finishedEditing if available\n      if (typeof curBndl.finishedEditing !== 'undefined') {\n        bundleData.finishedEditing = curBndl.finishedEditing;\n      }\n      // add comment if available\n      if (typeof curBndl.comment !== 'undefined') {\n        bundleData.comment = curBndl.comment;\n      }\n      // validate bundle\n      viewState.somethingInProgressTxt = 'Validating bundle ...';\n      validRes = Validationservice.validateJSO('bundleSchema', bundleData);\n      if (validRes !== true) {\n        $log.error('GRAVE PROBLEM: trying to save bundle but bundle is invalid. traverseAndClean() HAS ALREADY BEEN CALLED.');\n        $log.error(validRes);\n        modalService.open('views/error.html', 'Somehow the data for this bundle has been corrupted. This is most likely a nasty and diffucult to spot bug. If you are at the IPS right now, please contact an EMU developer immediately. The Validation error is: ' + JSON.stringify(validRes, null, 4)).then(function () {\n          viewState.somethingInProgressTxt = '';\n          viewState.somethingInProgress = false;\n          viewState.setState('labeling');\n          defer.reject();\n        });\n      } else {\n        viewState.somethingInProgressTxt = 'Saving bundle...';\n        Iohandlerservice.saveBundle(bundleData).then(function () {\n          viewState.somethingInProgressTxt = 'Done!';\n          viewState.somethingInProgress = false;\n          HistoryService.movesAwayFromLastSave = 0;\n          defer.resolve();\n          viewState.setState('labeling');\n        }, function (errMess) {\n          modalService.open('views/error.html', 'Error saving bundle: ' + errMess.status.message).then(function () {\n            appStateService.resetToInitState();\n          });\n          defer.reject();\n        });\n      }\n      ;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.appStateService\n * @description\n * # appStateService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('appStateService', [\n  '$log',\n  '$rootScope',\n  '$location',\n  'DragnDropService',\n  'DragnDropDataService',\n  'viewState',\n  'Iohandlerservice',\n  'loadedMetaDataService',\n  'Soundhandlerservice',\n  'DataService',\n  'Ssffdataservice',\n  'HistoryService',\n  function appStateService($log, $rootScope, $location, DragnDropService, DragnDropDataService, viewState, Iohandlerservice, loadedMetaDataService, Soundhandlerservice, DataService, Ssffdataservice, HistoryService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t *\n\t\t */\n    sServObj.resetToInitState = function () {\n      if (Iohandlerservice.wsH.isConnected()) {\n        Iohandlerservice.wsH.disconnectWarning().then(function (resp) {\n          $log.info('Closing websocket connection to server');\n          Iohandlerservice.wsH.closeConnect();\n        });\n      }\n      // $scope.curBndl = {};\n      loadedMetaDataService.resetToInitState();\n      Soundhandlerservice.wavJSO = {};\n      DataService.setData({});\n      DragnDropDataService.resetToInitState();\n      DragnDropService.resetToInitState();\n      Ssffdataservice.data = [];\n      HistoryService.resetToInitState();\n      viewState.setState('noDBorFilesloaded');\n      viewState.somethingInProgress = false;\n      viewState.resetToInitState();\n      HistoryService.resetToInitState();\n      viewState.showDropZone = true;\n      $location.url($location.path());\n      // reset URL without get values\n      $rootScope.$broadcast('resetToInitState');  //$scope.loadDefaultConfig();\n    };\n    sServObj.reloadToInitState = function (session) {\n      Iohandlerservice.wsH.closeConnect();\n      // $scope.curBndl = {};\n      var url = viewState.url;\n      loadedMetaDataService.resetToInitState();\n      Soundhandlerservice.wavJSO = {};\n      DataService.setData({});\n      DragnDropDataService.resetToInitState();\n      DragnDropService.resetToInitState();\n      Ssffdataservice.data = [];\n      HistoryService.resetToInitState();\n      viewState.setState('noDBorFilesloaded');\n      viewState.somethingInProgress = false;\n      HistoryService.resetToInitState();\n      viewState.resetToInitState();\n      $rootScope.$broadcast('reloadToInitState', {\n        url: url,\n        session: session,\n        reload: true\n      });\n    };\n    return sServObj;\n  }\n]);\n/**\n * A simple class that creates another thread\n * which does the wavParserWorker work\n * @class wavParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction wavParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nwavParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.ab2str = function (ab) {\n      var unis = [];\n      for (var i = 0; i < ab.length; i++) {\n        unis.push(ab[i]);\n      }\n      return String.fromCharCode.apply(null, unis);\n    };\n    global.wav2jso = function (buf) {\n      var wavRep = {};\n      // var uIntBuffView = new Uint8Array(buf);\n      var curBinIdx, curBuffer, curBufferView;\n      // var dv = new DataView(buf);\n      // var ChunkSize = dv.getUint32(4)\n      // console.log(ChunkSize)\n      // ChunkId == RIFF CHECK\n      curBinIdx = 0;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.ChunkID = global.ab2str(curBufferView);\n      if (wavRep.ChunkID !== 'RIFF') {\n        // console.error('Wav read error: ChunkID not RIFF. Got ' + wavRep.ChunkID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: ChunkID not RIFF but ' + wavRep.ChunkID\n          }\n        };\n      }\n      // ChunkSize\n      curBinIdx = 4;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ChunkSize = curBufferView[0];\n      // console.log(chunkSize)\n      // Format == WAVE CHECK\n      curBinIdx = 8;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Format = global.ab2str(curBufferView);\n      if (wavRep.Format !== 'WAVE') {\n        // console.error('Wav read error: Format not WAVE. Got ' + wavRep.Format);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Format not WAVE but ' + wavRep.Format\n          }\n        };\n      }\n      // Subchunk1ID == \"fmt \" CHECK\n      curBinIdx = 12;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk1ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk1ID !== 'fmt ') {\n        // console.error('Wav read error: Subchunk1ID not fmt. Got ' + wavRep.Subchunk1ID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1ID not fmt  but ' + wavRep.Subchunk1ID\n          }\n        };\n      }\n      // Subchunk1Size == 16 CHECK\n      curBinIdx = 16;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk1Size = curBufferView[0];\n      console.log([\n        16,\n        18\n      ].indexOf(19));\n      if ([\n          16,\n          18\n        ].indexOf(wavRep.Subchunk1Size) === -1) {\n        // console.error('Wav read error: Subchunk1Size not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1Size not 16 but ' + wavRep.Subchunk1Size\n          }\n        };\n      }\n      // AudioFormat == 1  CHECK\n      curBinIdx = 20;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.AudioFormat = curBufferView[0];\n      if (wavRep.AudioFormat !== 1) {\n        // console.error('Wav read error: AudioFormat not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: AudioFormat not 1 but ' + wavRep.AudioFormat\n          }\n        };\n      }\n      // NumChannels == 1  CHECK\n      curBinIdx = 22;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.NumChannels = curBufferView[0];\n      // console.error('Wav read error: NumChannels not 1');\n      if (wavRep.NumChannels !== 1) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: NumChannels not 1 but ' + wavRep.NumChannels\n          }\n        };\n      }\n      // SampleRate\n      curBinIdx = 24;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.SampleRate = curBufferView[0];\n      // ByteRate\n      curBinIdx = 28;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ByteRate = curBufferView[0];\n      // BlockAlign\n      curBinIdx = 32;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BlockAlign = curBufferView[0];\n      // console.error(blockAlign);\n      // BitsPerSample\n      curBinIdx = 34;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BitsPerSample = curBufferView[0];\n      if (wavRep.BitsPerSample !== 16) {\n        // console.error('Wav read error: NumChannels not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: BitsPerSample not 16 but ' + wavRep.BitsPerSample\n          }\n        };\n      }\n      var riffChunkSize = 12;\n      var Subchunk1IDandSizeSize = 8;\n      var Subchunk2start = riffChunkSize + Subchunk1IDandSizeSize + wavRep.Subchunk1Size;\n      // Subchunk2ID\n      curBinIdx = Subchunk2start;\n      // 36\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk2ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk2ID !== 'data') {\n        // console.error('Wav read error: BitsPerSample not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk2ID not data but ' + wavRep.Subchunk2ID\n          }\n        };\n      }\n      // Subchunk2Size\n      curBinIdx = Subchunk2start + 4;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk2Size = curBufferView[0];\n      // Data\n      curBinIdx = Subchunk2start + 8;\n      curBuffer = buf.subarray(curBinIdx, wavRep.Subchunk2Size);\n      curBufferView = new Int16Array(curBuffer);\n      wavRep.Data = new Float32Array(curBufferView);\n      // console.log(wavRep);\n      // finally append original array buffer\n      wavRep.origArrBuf = buf;\n      return wavRep;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseBuf':\n          var parserRes = global.wav2jso(e.data.buffer);\n          if (parserRes.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': parserRes\n            });\n          } else {\n            global.postMessage(parserRes);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to wavParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to wavParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the espsParserWorker work\n * @class espsParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction espsParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nespsParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.toJSO = function (string, annotates, name, sampleRate) {\n      var labelJSO = {};\n      labelJSO.name = name;\n      labelJSO.annotates = annotates;\n      labelJSO.sampleRate = sampleRate;\n      labelJSO.levels = [];\n      // var ext = '_' + filePath.split('.')[filePath.split('.').length - 1];\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace all blanks with single whitespace\n      string = string.replace(/[ \\t]+/g, ' ');\n      var lines = string.split('\\n');\n      // find header end\n      var headEndIdx;\n      for (var i = 0; i < lines.length; i++) {\n        if (lines[i] === '#') {\n          headEndIdx = i;\n          break;\n        }\n      }\n      //init empty labelJSO\n      labelJSO.levels[0] = {};\n      labelJSO.levels[0].name = name;\n      labelJSO.levels[0].items = [];\n      var idCounter = 1;\n      // set level type\n      var prevLineArr;\n      var curLineArr = lines[headEndIdx + 1].split(/\\s+/);\n      if (curLineArr[curLineArr.length - 1] !== 'H#') {\n        labelJSO.levels[0].type = 'EVENT';\n      } else {\n        labelJSO.levels[0].type = 'SEGMENT';\n      }\n      if (labelJSO.levels[0].type === 'EVENT') {\n        for (i = headEndIdx + 1; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            samplePoint: Math.floor(curLineArr[1] * sampleRate)\n          });\n          idCounter += 1;\n        }\n      } else {\n        // take care of H# by not doing anything :-)\n        idCounter += 1;\n        for (i = headEndIdx + 2; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          prevLineArr = lines[i - 1].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            sampleStart: Math.floor(prevLineArr[1] * sampleRate),\n            sampleDur: Math.floor(curLineArr[1] * sampleRate) - Math.floor(prevLineArr[1] * sampleRate) - 1\n          });\n          idCounter += 1;\n        }\n      }\n      return labelJSO;\n    };\n    /**\n\t\t * SIC! This function probably has to be fixed...\n\t\t */\n    global.toESPS = function (data, name, sampleRate) {\n      var espsStr = '';\n      // construct header\n      espsStr += 'signal ' + name + '\\n';\n      espsStr += 'nfields 1\\n';\n      espsStr += '#\\n';\n      var curLabel;\n      for (var j = 0; j < data.length; j++) {\n        //angular.forEach(data, function (i, idx) {\n        if (data[j].labels[0].value === '' && j === 0) {\n          curLabel = 'H#';\n        } else {\n          curLabel = data[j].labels[0].value;\n        }\n        espsStr += '\\t' + String((data[j].sampleStart + data[j].sampleDur) / sampleRate) + '\\t125\\t' + curLabel + '\\n';\n      }\n      //});\n      // console.log(espsStr);\n      return espsStr;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseESPS':\n          retVal = global.toJSO(e.data.esps, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'parseJSO':\n          retVal = global.toESPS(e.data.level.items, e.data.level.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to espsParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to espsParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the textGridParserWorker work\n * @class textGridParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction textGridParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\ntextGridParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.l1 = 'File type = \"ooTextFile\"';\n    global.l2 = 'Object class = \"TextGrid\"';\n    global.localID = 0;\n    /**\n\t\t * test to see if all the segments in seg levels\n\t\t * are \"snapped\" -> sampleStart+dur+1 = sampleStart of next Segment\n\t\t */\n    global.testForGapsInLabelJSO = function (labelJSO) {\n      var counter = 0;\n      for (var i = 0; i < labelJSO.levels.length; i++) {\n        if (labelJSO.levels[i].type === 'SEGMENT') {\n          for (var j = 0; j < labelJSO.levels[i].items.length - 1; j++) {\n            if (labelJSO.levels[i].items[j].sampleStart + labelJSO.levels[i].items[j].sampleDur + 1 !== labelJSO.levels[i].items[j + 1].sampleStart) {\n              counter = counter + 1;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    global.findTimeOfMinSample = function () {\n      return 0;  // maybe needed at some point...\n    };\n    /**\n\t\t *\n\t\t */\n    global.findTimeOfMaxSample = function (buffLength, sampleRate) {\n      return buffLength / sampleRate;\n    };\n    /**\n\t\t * parse a textgrid string to the specified json format\n\t\t *\n\t\t * @param string TextGrid file string to be parsed\n\t\t * @returns a label java script object\n\t\t */\n    global.toJSO = function (string, myFile, myName, sampleRate) {\n      var VU_STR = '123abcABCCBAcba321';\n      // very unlikly string\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace blanks in quates with VU_STR to preserve blanks in labels\n      string = string.replace(/(\"[^\\n]*\")/g, function ($0, $1) {\n        var res = $1.replace(/\\s+/g, VU_STR);\n        return res;\n      });\n      // remove remaining blanks\n      string = string.replace(/[\\t ]+/g, '');\n      // convert VU_STR back to blanks\n      var re = new RegExp(VU_STR, 'g');\n      string = string.replace(re, ' ');\n      var lines = string.split('\\n');\n      var tT, tN, eT, lab;\n      var inHeader = true;\n      var labs = [];\n      //meta info for labelJSO\n      var labelJSO = {\n          name: myName,\n          annotates: myFile,\n          sampleRate: sampleRate,\n          levels: [],\n          links: []\n        };\n      if (lines[0].replace(/\\s+/g, '') === global.l1.replace(/\\s+/g, '') && lines[1].replace(/\\s+/g, '') === global.l2.replace(/\\s+/g, '')) {\n        for (var i = 2; i < lines.length; i++) {\n          var cL = lines[i];\n          if (cL === 'item[]:') {\n            inHeader = false;\n            continue;\n          }\n          if (inHeader) {\n            continue;\n          }\n          if (cL.indexOf('item[') === 0) {\n            // get level name\n            tN = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            // get level type\n            if (lines[i + 1].split(/=/)[1] === '\"IntervalTier\"') {\n              tT = 'SEGMENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else if (lines[i + 1].split(/=/)[1] === '\"TextTier\"') {\n              tT = 'EVENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else {\n            }\n          }\n          if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'SEGMENT' && cL.indexOf('intervals') === 0 && cL.indexOf('intervals:') !== 0) {\n            // parse seg levels event\n            var itemST = Math.floor(lines[i + 1].split(/=/)[1] * sampleRate);\n            var itemET = Math.floor(lines[i + 2].split(/=/)[1] * sampleRate);\n            lab = lines[i + 3].split(/=/)[1].replace(/\"/g, '');\n            var labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              sampleStart: itemST,\n              sampleDur: itemET - itemST - 1,\n              labels: labs\n            });\n            ++global.localID;\n          } else if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'EVENT' && cL.indexOf('points') === 0 && cL.indexOf('points:') !== 0) {\n            // parse point level event\n            eT = lines[i + 1].split(/=/)[1] * sampleRate;\n            lab = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              samplePoint: Math.round(eT),\n              labels: labs\n            });\n            ++global.localID;\n          }\n        }\n        // console.log(JSON.stringify(labelJSO, undefined, 2));\n        global.testForGapsInLabelJSO(labelJSO);\n        return labelJSO;\n      } else {\n        // alert('bad header in TextGrid file!!! The header has to be: ', global.l1, '\\n', global.l2);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'bad header in TextGrid file!!! The header has to be: ' + global.l1 + '\\n' + global.l2 + '; Note: Currently only long-form text TextGrids are supported!'\n          }\n        };\n      }\n    };\n    /**\n\t\t * converts the internal levels format returned from levelHandler.getLevels\n\t\t * to a string containing a TextGrid file\n\t\t */\n    global.toTextGrid = function (levelData, buffLength, sampleRate) {\n      var tG = '';\n      var nl = '\\n';\n      var t = '\\t';\n      // writing header infos\n      tG = tG + global.l1 + nl + global.l2 + nl + nl;\n      tG = tG + 'xmin = ' + global.findTimeOfMinSample() + nl;\n      tG = tG + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n      tG = tG + 'levels? <exists>' + nl;\n      tG = tG + 'size = ' + levelData.length + nl;\n      tG = tG + 'item []:' + nl;\n      //var levelNr = 0;\n      for (var levelNr = 0; levelNr < levelData.length; levelNr++) {\n        //angular.forEach(levelData, function (curLevel) {\n        //write level items\n        //levelNr = levelNr + 1;\n        var curLevel = levelData[levelNr];\n        tG = tG + t + 'item [' + levelNr + ']:' + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'class = \"IntervalTier\"' + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'class = \"TextTier\"' + nl;\n        }\n        tG = tG + t + t + 'name = \"' + curLevel.name + '\"' + nl;\n        tG = tG + t + t + 'xmin = ' + global.findTimeOfMinSample() + nl;\n        tG = tG + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'intervals: size = ' + curLevel.items.length + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'points: size = ' + curLevel.items.length + nl;\n        }\n        var curVal;\n        for (var j = 0; j < curLevel.items.length; j++) {\n          var evtNr = j + 1;\n          if (curLevel.type === 'SEGMENT') {\n            tG = tG + t + t + t + 'intervals [' + evtNr + ']:' + nl;\n            if (curLevel.items[j].sampleStart !== 0) {\n              curVal = curLevel.items[j].sampleStart / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmin = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmin = ' + 0 + nl;\n            }\n            if (j < curLevel.items.length - 1) {\n              curVal = (curLevel.items[j].sampleStart + curLevel.items[j].sampleDur) / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmax = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n            }\n            tG = tG + t + t + t + t + 'text = \"' + curLevel.items[j].labels[0].value + '\"' + nl;\n          } else if (curLevel.type === 'EVENT') {\n            tG = tG + t + t + t + 'points[' + evtNr + ']:' + nl;\n            tG = tG + t + t + t + t + 'time = ' + curLevel.items[j].samplePoint / sampleRate + nl;\n            tG = tG + t + t + t + t + 'mark = \"' + curLevel.items[j].labels[0].value + '\"' + nl;\n          }\n        }\n      }\n      return tG;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseTG':\n          retVal = global.toJSO(e.data.textGrid, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'toTextGrid':\n          retVal = global.toTextGrid(e.data.levels, e.data.buffLength, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to textGridParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to textGridParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n//'use strict';\n/**\n * A simple class that creates another thread\n * which does the spectroDrawingWorker work\n * @class spectroDrawingWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction spectroDrawingWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nspectroDrawingWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    /**\n\t\t * A handy web worker to draw a spectrom (and calculate a fft)\n\t\t *\n\t\t * @version 1.2\n\t\t * @author Georg Raess <georg.raess@campus.lmu.de>\n\t\t * @link http://www.phonetik.uni-muenchen.de/\n\t\t *\n\t\t */\n    ///////////////////////////////////\n    // start: global vars\n    global.executed = false;\n    global.PI = 3.141592653589793;\n    // value : Math.PI\n    global.TWO_PI = 6.283185307179586;\n    // value : 2 * Math.PI\n    global.totalMax = 0;\n    global.dynRangeInDB = 50;\n    global.myWindow = {\n      BARTLETT: 1,\n      BARTLETTHANN: 2,\n      BLACKMAN: 3,\n      COSINE: 4,\n      GAUSS: 5,\n      HAMMING: 6,\n      HANN: 7,\n      LANCZOS: 8,\n      RECTANGULAR: 9,\n      TRIANGULAR: 10\n    };\n    global.imgWidth = 0;\n    global.imgHeight = 0;\n    global.upperFreq = 0;\n    global.lowerFreq = 0;\n    global.pixelRatio = 1;\n    global.heatMapColorAnchors = [\n      [\n        255,\n        0,\n        0\n      ],\n      [\n        0,\n        255,\n        0\n      ],\n      [\n        0,\n        0,\n        0\n      ]\n    ];\n    global.samplesPerPxl = 0;\n    global.sampleRate = 0;\n    global.preEmphasisFilterFactor = 0.97;\n    global.transparency = 0;\n    global.drawHeatMapColors = false;\n    global.N = 0;\n    global.windowSizeInSecs = 0.01;\n    global.audioBuffer = undefined;\n    global.audioBufferChannels = 0;\n    global.wFunction = 0;\n    global.myFFT = undefined;\n    global.pixelHeight = 1;\n    global.internalalpha = 1;\n    global.maxPsd = 0;\n    global.HzStep = 0;\n    global.paint = [];\n    global.sin = undefined;\n    global.cos = undefined;\n    global.ceilingFreqFftIdx = 0;\n    global.floorFreqFftIdx = 0;\n    global.resultImgArr = undefined;\n    // end: global vars\n    //////////////////////////////////\n    /////////////////////////////////\n    // start: math helper functions\n    // used by FFT\n    global.toLinearLevel = function (dbLevel) {\n      return Math.pow(10, dbLevel / 10);\n    };\n    // calculate decadic logarithm\n    global.log10 = function (arg) {\n      return Math.log(arg) / 2.302585092994046;  // Math.log(x) / Math.LN10\n    };\n    // calculate magintude\n    global.magnitude = function (real, imag) {\n      return Math.sqrt(real * real + imag * imag);\n    };\n    // end: math helper functions\n    ////////////////////////////////\n    ///////////////////////////////////////////////////\n    // start: FFT class (incl. fft() function itself)\n    global.FFT = function () {\n      var m, i, x;\n      var n = global.N;\n      m = parseInt(Math.log(n) / 0.6931471805599453, 10);\n      if (n !== 1 << m) {\n        // Make sure n is a power of 2\n        console.log('ERROR : FFT length must be power of 2');\n      }\n      if (global.cos === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes\n        global.cos = new Float32Array(n / 2);\n        // precompute cos table\n        for (x = 0; x < n / 2; x++) {\n          global.cos[x] = Math.cos(-2 * global.PI * x / n);\n        }\n      }\n      if (global.sin === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes \n        global.sin = new Float32Array(n / 2);\n        // precompute sin table\n        for (x = 0; x < n / 2; x++) {\n          global.sin[x] = Math.sin(-2 * global.PI * x / n);\n        }\n      }\n      /**\n\t\t\t * apply window function and pre-emphasis from idx 0 to length\n\t\t\t * in buffer given\n\t\t\t *\n\t\t\t * @param type is the chosen window Function as enum\n\t\t\t * @param alpha is the alpha value for Window Functions (default 0.16)\n\t\t\t * @param buffer is the zero padded magnitude spectrum\n\t\t\t * @param length is the length to in the buffer (starting at idx 0)\n\t\t\t * to which to apply the window to. If the buffer is [x0, x1, x2, x4] and\n\t\t\t * length is 2 the window will be applied to [x0, x1, x2] this is needed\n\t\t\t * to only apply function to non-zero-padded values of magnitude spectrum.\n\t\t\t * @return the windowed/pre-emphasised buffer\n\t\t\t */\n      this.applyWindowFuncAndPreemph = function (type, alpha, buffer, length) {\n        // var length = buffer.length;\n        this.alpha = alpha;\n        switch (type) {\n        case global.myWindow.BARTLETT:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlett(length, i);\n          }\n          break;\n        case global.myWindow.BARTLETTHANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlettHann(length, i);\n          }\n          break;\n        case global.myWindow.BLACKMAN:\n          this.alpha = this.alpha || 0.16;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBlackman(length, i, alpha);\n          }\n          break;\n        case global.myWindow.COSINE:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionCosine(length, i);\n          }\n          break;\n        case global.myWindow.GAUSS:\n          this.alpha = this.alpha || 0.25;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionGauss(length, i, alpha);\n          }\n          break;\n        case global.myWindow.HAMMING:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHamming(length, i);\n          }\n          break;\n        case global.myWindow.HANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHann(length, i);\n          }\n          break;\n        case global.myWindow.LANCZOS:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionLanczos(length, i);\n          }\n          break;\n        case global.myWindow.RECTANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionRectangular(length, i);\n          }\n          break;\n        case global.myWindow.TRIANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionTriangular(length, i);\n          }\n          break;\n        }\n        return buffer;\n      };\n      ////////////////////////////////////\n      // start: the windowing functions\n      this.wFunctionBartlett = function (length, index) {\n        return 2 / (length - 1) * ((length - 1) / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      this.wFunctionBartlettHann = function (length, index) {\n        return 0.62 - 0.48 * Math.abs(index / (length - 1) - 0.5) - 0.38 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionBlackman = function (length, index, alpha) {\n        var a0 = (1 - alpha) / 2;\n        var a1 = 0.5;\n        var a2 = alpha / 2;\n        return a0 - a1 * Math.cos(global.TWO_PI * index / (length - 1)) + a2 * Math.cos(4 * global.PI * index / (length - 1));\n      };\n      this.wFunctionCosine = function (length, index) {\n        return Math.cos(global.PI * index / (length - 1) - global.PI / 2);\n      };\n      this.wFunctionGauss = function (length, index, alpha) {\n        return Math.pow(Math.E, -0.5 * Math.pow((index - (length - 1) / 2) / (alpha * (length - 1) / 2), 2));\n      };\n      this.wFunctionHamming = function (length, index) {\n        return 0.54 - 0.46 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionHann = function (length, index) {\n        return 0.5 * (1 - Math.cos(global.TWO_PI * index / (length - 1)));\n      };\n      this.wFunctionLanczos = function (length, index) {\n        var x = 2 * index / (length - 1) - 1;\n        return Math.sin(global.PI * x) / (global.PI * x);\n      };\n      this.wFunctionRectangular = function () {\n        return 1;\n      };\n      this.wFunctionTriangular = function (length, index) {\n        return 2 / length * (length / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      // end: the windowing functions\n      ///////////////////////////////////\n      /**\n\t\t\t * calculate and apply according pre-emphasis on sample\n\t\t\t */\n      this.applyPreEmph = function (curSample, prevSample) {\n        return curSample - global.preEmphasisFilterFactor * prevSample;\n      };\n      // the FFT calculation\n      this.fft = function (x, y) {\n        // Bit-reverse\n        var i, j, k, n1, n2, a, c, s, t1, t2;\n        // Bit-reverse\n        j = 0;\n        n2 = n / 2;\n        for (i = 1; i < n - 1; i++) {\n          n1 = n2;\n          while (j >= n1) {\n            j = j - n1;\n            n1 = n1 / 2;\n          }\n          j = j + n1;\n          if (i < j) {\n            t1 = x[i];\n            x[i] = x[j];\n            x[j] = t1;\n            t1 = y[i];\n            y[i] = y[j];\n            y[j] = t1;\n          }\n        }\n        // FFT\n        n1 = 0;\n        n2 = 1;\n        for (i = 0; i < m; i++) {\n          n1 = n2;\n          n2 = n2 + n2;\n          a = 0;\n          for (j = 0; j < n1; j++) {\n            c = global.cos[a];\n            s = global.sin[a];\n            a += 1 << m - i - 1;\n            for (k = j; k < n; k = k + n2) {\n              t1 = c * x[k + n1] - s * y[k + n1];\n              t2 = s * x[k + n1] + c * y[k + n1];\n              x[k + n1] = x[k] - t1;\n              y[k + n1] = y[k] - t2;\n              x[k] = x[k] + t1;\n              y[k] = y[k] + t2;\n            }\n          }\n        }\n      };\n    };\n    // end: FFT class \n    ///////////////////\n    /////////////////////////////////\n    // start: rendering function \n    /**\n\t\t * interpolates a 3D color space and calculate accoring\n\t\t * value on that plane\n\t\t *\n\t\t * @param minval is the minimum value to map to (number)\n\t\t * @param maxval is the maximum value to map to (number)\n\t\t * @param val is the value itself (number)\n\t\t * @param colors is an array of arrays containing the colors\n\t\t * to interpol. against (of the form: [[255, 0, 0],[0, 255, 0],[0, 0, 255]])\n\t\t */\n    global.convertToHeatmap = function (minval, maxval, val, colors) {\n      var maxIndex = colors.length - 1;\n      var v = (val - minval) / (maxval - minval) * maxIndex;\n      var i1 = Math.floor(v);\n      var i2 = Math.min.apply(null, [\n          Math.floor(v) + 1,\n          maxIndex\n        ]);\n      var rgb1 = colors[i1];\n      var rgb2 = colors[i2];\n      var f = v - i1;\n      return {\n        'r': Math.floor(rgb1[0] + f * (rgb2[0] - rgb1[0])),\n        'g': Math.floor(rgb1[1] + f * (rgb2[1] - rgb1[1])),\n        'b': Math.floor(rgb1[2] + f * (rgb2[2] - rgb1[2]))\n      };\n    };\n    /**\n\t\t * draws a single line of the spectrogram into the imageResult array.\n\t\t * by calculating the RGB value of the current pixel with:\n\t\t * 255-(255*scaled)\n\t\t * @param xIdx in the global.paint array\n\t\t */\n    global.drawVerticalLineOfSpectogram = function (xIdx) {\n      // set upper boundary for linear interpolation\n      var x1 = global.pixelHeight;\n      var rgb, index, px, py;\n      // value for first interpolation at lower boundry (height=0)\n      // calculate the one sided power spectral density PSD (f, t) in Pa2/Hz\n      // PSD(f) proportional to 2|X(f)|2 / (t2 - t1)\n      var psd = 2 * Math.pow(global.paint[xIdx][1], 2) / global.N;\n      var psdLog = 10 * global.log10(psd / global.maxPsd);\n      var scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n      if (scaledVal > 1) {\n        scaledVal = 1;\n      } else if (scaledVal < 0) {\n        scaledVal = 0;\n      }\n      for (var i = 0; i < global.paint[xIdx].length; i++) {\n        var y0 = scaledVal;\n        // !!!! set y0 to previous scaled value\n        // for each value in paint[] calculate pixelHeight interpolation points\n        // x0=0\n        // x1=pixelHeight\n        // if(paint[i-1]<0) paint[i-1] = 1\n        // y0=paint[i-1]    \n        // y1=paint[i]\n        // !!!! calculate next scaledValue [0...1] \n        psd = 2 * Math.pow(global.paint[xIdx][i], 2) / global.N;\n        psdLog = 10 * global.log10(psd / global.maxPsd);\n        scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n        if (scaledVal > 1) {\n          scaledVal = 1;\n        }\n        if (scaledVal < 0) {\n          scaledVal = 0;\n        }\n        // !!!! set y1 to this scaled value\n        var y1 = scaledVal;\n        if (global.pixelHeight >= 1) {\n          // do interpolation between y0 (previous scaledValue) and y1 (scaledValue now)\n          for (var b = 0; b < global.pixelHeight; b++) {\n            var y2 = y0 + (y1 - y0) / x1 * b;\n            // calculate corresponding color value for interpolation point [0...255]\n            rgb = 255 - Math.round(255 * y2);\n            // set internal image buffer to calculated & interpolated value\n            px = Math.floor(xIdx);\n            py = Math.floor(global.imgHeight - (global.pixelHeight * (i - 2) + b));\n            index = (px + py * global.imgWidth) * 4;\n            if (global.drawHeatMapColors) {\n              if (!isNaN(rgb)) {\n                var hmVals = global.convertToHeatmap(0, 255, rgb, global.heatMapColorAnchors);\n                global.resultImgArr[index + 0] = hmVals.r;\n                global.resultImgArr[index + 1] = hmVals.g;\n                global.resultImgArr[index + 2] = hmVals.b;\n                global.resultImgArr[index + 3] = global.transparency;\n              } else {\n                global.resultImgArr[index + 0] = rgb;\n                global.resultImgArr[index + 1] = rgb;\n                global.resultImgArr[index + 2] = rgb;\n                global.resultImgArr[index + 3] = global.transparency;\n              }\n            } else {\n              global.resultImgArr[index + 0] = rgb;\n              global.resultImgArr[index + 1] = rgb;\n              global.resultImgArr[index + 2] = rgb;\n              global.resultImgArr[index + 3] = global.transparency;\n            }\n          }\n        } else {\n          rgb = 255 - Math.round(255 * y1);\n          // set internal image buffer to calculated & interpolated value\n          px = Math.floor(xIdx);\n          py = Math.floor(global.imgHeight - global.pixelHeight * (i - 2));\n          index = (px + py * global.imgWidth) * 4;\n          global.resultImgArr[index + 0] = rgb;\n          global.resultImgArr[index + 1] = rgb;\n          global.resultImgArr[index + 2] = rgb;\n          global.resultImgArr[index + 3] = global.transparency;\n        }\n      }\n    };\n    /**\n\t\t * calculates Magnitude by\n\t\t * - reading the current (defined with offset) data from localSoundBuffer\n\t\t * - applying the current Window Function to the selected data\n\t\t * - calculating the actual FFT\n\t\t * - (and saving the biggest value in totalMax)\n\t\t *\n\t\t * @param offset calculated offset in PCM Stream\n\t\t * @param windowSizeInSamples size of window in samples (actual samples -> not FFT length; rest zero-padded)\n\t\t * @return magnitude spectrum as Float32Array\n\t\t */\n    global.calcMagnitudeSpectrum = function (offset, windowSizeInSamples) {\n      // imaginary array of length N\n      var imag = new Float32Array(global.N);\n      // real array of length N\n      var real = new Float32Array(global.N);\n      // result array of length c - d\n      var result = new Float32Array(global.ceilingFreqFftIdx - global.floorFreqFftIdx);\n      // set real values by reading local sound buffer (this auto zeropads everything > windowSizeInSamples)\n      for (var j = 0; j < windowSizeInSamples; j++) {\n        real[j] = global.audioBuffer[offset + j];\n      }\n      // apply window function and pre-emphasis to non zero padded real \n      global.myFFT.applyWindowFuncAndPreemph(global.wFunction, global.internalalpha, real, windowSizeInSamples);\n      // calculate FFT over real and save to result\n      global.myFFT.fft(real, imag);\n      // calculate magnitude for each spectral component \n      for (var low = 0; low <= global.ceilingFreqFftIdx - global.floorFreqFftIdx; low++) {\n        result[low] = global.magnitude(real[low + global.floorFreqFftIdx], imag[low + global.floorFreqFftIdx]);\n        if (global.totalMax < result[low]) {\n          global.totalMax = result[low];\n        }\n      }\n      return result;\n    };\n    /**\n\t\t * initial function call for calculating and drawing Spectrogram\n\t\t * input sample data comes from the buffer global.audioBuffer\n\t\t * - first loop calculates magnitude spectra to draw (calcMagnitudeSpectrum())\n\t\t * - second loop draws these values into the global.resultImgArr (drawVerticalLineOfSpectogram())\n\t\t */\n    global.renderSpectrogram = function () {\n      if (!global.executed) {\n        // start execution once\n        global.executed = true;\n        var windowSizeInSamples = global.sampleRate * global.windowSizeInSecs;\n        // instance of FFT with windowSize N\n        global.myFFT = new global.FFT();\n        // array holding FFT results paint[canvas width][canvas height]\n        global.paint = new Array(global.imgWidth);\n        // Hz per pixel height\n        global.HzStep = global.sampleRate / 2 / (global.N / 2);\n        // upper Hz boundary to display\n        global.ceilingFreqFftIdx = Math.ceil(global.upperFreq / global.HzStep);\n        // lower Hz boundary to display\n        global.floorFreqFftIdx = Math.floor(global.lowerFreq / global.HzStep);\n        // -1 for value below display when lower>0\n        // height between two interpolation points\n        global.pixelHeight = global.imgHeight / (global.ceilingFreqFftIdx - global.floorFreqFftIdx - 2);\n        // ugly hack in order to support PhantomJS < 2.0 testing\n        if (typeof Uint8ClampedArray === 'undefined') {\n          Uint8ClampedArray = Uint8Array;\n        }\n        // create new picture\n        global.resultImgArr = new Uint8ClampedArray(Math.ceil(global.imgWidth * global.imgHeight * 4));\n        // calculate i FFT runs, save result into paint and set maxPsd while doing so\n        for (var i = 0; i < global.imgWidth; i++) {\n          global.paint[i] = global.calcMagnitudeSpectrum(Math.round(i * global.samplesPerPxl), windowSizeInSamples);\n          global.maxPsd = 2 * Math.pow(global.totalMax, 2) / global.N;\n        }\n        // draw spectrogram on png image with canvas width\n        // one column is drawn per drawVerticalLineOfSpectogram\n        for (var j = 0; j < global.imgWidth; j++) {\n          global.drawVerticalLineOfSpectogram(j);\n        }\n        // post generated image block with settings back\n        global.postMessage({\n          'window': global.wFunction,\n          'samplesPerPxl': global.samplesPerPxl,\n          'pixelHeight': global.pixelHeight,\n          'pixelRatio': global.pixelRatio,\n          'width': global.imgWidth,\n          'height': global.imgHeight,\n          'img': global.resultImgArr.buffer\n        }, [global.resultImgArr.buffer]);\n        // free vars\n        global.myFFT = null;\n        // stop execution\n        global.executed = false;\n      }\n    };\n    // end: rendering function \n    //////////////////////////////\n    //////////////////////////\n    // communication functions\n    /**\n\t\t * function to handle messages events if used ad web worker\n\t\t * @param e message event\n\t\t */\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var render = true;\n        var renderError = '';\n        var data = e.data;\n        if (data.windowSizeInSecs !== undefined) {\n          global.windowSizeInSecs = data.windowSizeInSecs;\n        } else {\n          renderError = 'windowSizeInSecs';\n          render = false;\n        }\n        if (data.fftN !== undefined) {\n          global.N = data.fftN;\n        } else {\n          renderError = 'fftN';\n          render = false;\n        }\n        if (data.alpha !== undefined) {\n          global.internalalpha = data.alpha;\n        } else {\n          renderError = 'alpha';\n          render = false;\n        }\n        if (data.upperFreq !== undefined) {\n          global.upperFreq = data.upperFreq;\n        } else {\n          renderError = 'upperFreq';\n          render = false;\n        }\n        if (data.lowerFreq !== undefined) {\n          global.lowerFreq = data.lowerFreq;\n        } else {\n          renderError = 'lowerFreq';\n          render = false;\n        }\n        if (data.samplesPerPxl !== undefined) {\n          global.samplesPerPxl = data.samplesPerPxl;\n        } else {\n          renderError = 'samplesPerPxl';\n          render = false;\n        }\n        if (data.window !== undefined) {\n          switch (data.window) {\n          case 1:\n            global.wFunction = global.myWindow.BARTLETT;\n            break;\n          case 2:\n            global.wFunction = global.myWindow.BARTLETTHANN;\n            break;\n          case 3:\n            global.wFunction = global.myWindow.BLACKMAN;\n            break;\n          case 4:\n            global.wFunction = global.myWindow.COSINE;\n            break;\n          case 5:\n            global.wFunction = global.myWindow.GAUSS;\n            break;\n          case 6:\n            global.wFunction = global.myWindow.HAMMING;\n            break;\n          case 7:\n            global.wFunction = global.myWindow.HANN;\n            break;\n          case 8:\n            global.wFunction = global.myWindow.LANCZOS;\n            break;\n          case 9:\n            global.wFunction = global.myWindow.RECTANGULAR;\n            break;\n          case 10:\n            global.wFunction = global.myWindow.TRIANGULAR;\n            break;\n          }\n        } else {\n          renderError = 'window';\n          render = false;\n        }\n        if (data.imgWidth !== undefined) {\n          global.imgWidth = data.imgWidth;\n        } else {\n          renderError = 'imgWidth';\n          render = false;\n        }\n        if (data.imgHeight !== undefined) {\n          global.imgHeight = data.imgHeight;\n        } else {\n          renderError = 'imgHeight';\n          render = false;\n        }\n        if (data.dynRangeInDB !== undefined) {\n          global.dynRangeInDB = data.dynRangeInDB;\n        } else {\n          renderError = 'dynRangeInDB';\n          render = false;\n        }\n        if (data.pixelRatio !== undefined) {\n          global.pixelRatio = data.pixelRatio;\n        } else {\n          renderError = 'pixelRatio';\n          render = false;\n        }\n        if (data.sampleRate !== undefined) {\n          global.sampleRate = data.sampleRate;\n        } else {\n          renderError = 'sampleRate';\n          render = false;\n        }\n        if (data.audioBufferChannels !== undefined) {\n          global.audioBufferChannels = data.audioBufferChannels;\n        } else {\n          renderError = 'audioBufferChannels';\n          render = false;\n        }\n        if (data.transparency !== undefined) {\n          global.transparency = data.transparency;\n        } else {\n          renderError = 'transparency';\n          render = false;\n        }\n        if (data.audioBuffer !== undefined) {\n          global.audioBuffer = data.audioBuffer;\n        } else {\n          renderError = 'audioBuffer';\n          render = false;\n        }\n        if (data.drawHeatMapColors !== undefined) {\n          global.drawHeatMapColors = data.drawHeatMapColors;\n        } else {\n          renderError = 'drawHeatMapColors';\n          render = false;\n        }\n        if (data.preEmphasisFilterFactor !== undefined) {\n          global.preEmphasisFilterFactor = data.preEmphasisFilterFactor;\n        } else {\n          renderError = 'preEmphasisFilterFactor';\n          render = false;\n        }\n        if (data.heatMapColorAnchors !== undefined) {\n          global.heatMapColorAnchors = data.heatMapColorAnchors;\n        } else {\n          renderError = 'heatMapColorAnchors';\n          render = false;\n        }\n        if (render) {\n          global.renderSpectrogram();\n        } else {\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': renderError + ' is undefined'\n            }\n          });\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to spectroDrawingWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(spectroDrawingWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }  //\n     /////////////////////\n};\n/**\n * A simple class that creates another thread\n * which does the ssffParserWorker work\n * @class ssffParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction ssffParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nssffParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    var ssffData = {};\n    var headID = 'SSFF -- (c) SHLRC\\n';\n    var machineID = 'Machine IBM-PC\\n';\n    var sepString = '-----------------\\n';\n    ssffData.fileExtension = '';\n    ssffData.sampleRate = -1;\n    ssffData.startTime = -1;\n    ssffData.origFreq = -1;\n    ssffData.Columns = [];\n    /**\n\t\t * Mock for atob btoa for web kit based browsers that don't support these in webworkers\n\t\t */\n    (function () {\n      var base64EncodeChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n      var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);\n      function base64encode(str) {\n        var out, i, len;\n        var c1, c2, c3;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          c1 = str.charCodeAt(i++) & 255;\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4);\n            out += '==';\n            break;\n          }\n          c2 = str.charCodeAt(i++);\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n            out += base64EncodeChars.charAt((c2 & 15) << 2);\n            out += '=';\n            break;\n          }\n          c3 = str.charCodeAt(i++);\n          out += base64EncodeChars.charAt(c1 >> 2);\n          out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n          out += base64EncodeChars.charAt((c2 & 15) << 2 | (c3 & 192) >> 6);\n          out += base64EncodeChars.charAt(c3 & 63);\n        }\n        return out;\n      }\n      function base64decode(str) {\n        var c1, c2, c3, c4;\n        var i, len, out;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          do {\n            c1 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c1 === -1);\n          if (c1 === -1) {\n            break;\n          }\n          do {\n            c2 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c2 === -1);\n          if (c2 === -1) {\n            break;\n          }\n          out += String.fromCharCode(c1 << 2 | (c2 & 48) >> 4);\n          do {\n            c3 = str.charCodeAt(i++) & 255;\n            if (c3 === 61) {\n              return out;\n            }\n            c3 = base64DecodeChars[c3];\n          } while (i < len && c3 === -1);\n          if (c3 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c2 & 15) << 4 | (c3 & 60) >> 2);\n          do {\n            c4 = str.charCodeAt(i++) & 255;\n            if (c4 === 61) {\n              return out;\n            }\n            c4 = base64DecodeChars[c4];\n          } while (i < len && c4 === -1);\n          if (c4 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c3 & 3) << 6 | c4);\n        }\n        return out;\n      }\n      //var scope = (typeof window !== 'undefined') ? window : global;\n      if (!global.btoa) {\n        global.btoa = base64encode;\n      }\n      if (!global.atob) {\n        global.atob = base64decode;\n      }\n    }());\n    /**\n\t\t *\n\t\t */\n    global.base64ToArrayBuffer = function (stringBase64) {\n      var binaryString = global.atob(stringBase64);\n      var len = binaryString.length;\n      var bytes = new Uint8Array(len);\n      for (var i = 0; i < len; i++) {\n        var ascii = binaryString.charCodeAt(i);\n        bytes[i] = ascii;\n      }\n      return bytes.buffer;\n    };\n    /**\n\t\t * round to n decimal digits after the comma\n\t\t * used to help display numbers with a given\n\t\t * precision\n\t\t */\n    global.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        return false;\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return k.substring(0, k.indexOf('.') + n + 1);\n    };\n    /**\n\t\t * helper function to convert string to Uint8Array\n\t\t * @param string\n\t\t */\n    global.stringToUint = function (string) {\n      var charList = string.split('');\n      var uintArray = [];\n      for (var i = 0; i < charList.length; i++) {\n        uintArray.push(charList[i].charCodeAt(0));\n      }\n      return new Uint8Array(uintArray);\n    };\n    /**\n\t\t *\n\t\t */\n    global.Uint8Concat = function (first, second) {\n      var firstLength = first.length;\n      var result = new Uint8Array(firstLength + second.length);\n      result.set(first);\n      result.set(second, firstLength);\n      return result;\n    };\n    /**\n\t\t * convert arraybuffer containing a ssff file\n\t\t * to a javascript object\n\t\t * @param buf arraybuffer containing ssff file\n\t\t * @param name is fileExtension\n\t\t * @returns ssff javascript object\n\t\t */\n    global.ssff2jso = function (buf, name) {\n      ssffData.fileExtension = name;\n      ssffData.Columns = [];\n      // console.log('SSFF loaded');\n      var uIntBuffView = new Uint8Array(buf);\n      var dataView = new DataView(buf);\n      // Causes \"RangeError: Maximum call stack size exceeded\"\n      // with some browsers (?)(Chrome/Chromium on Ubuntu)\n      //var buffStr = String.fromCharCode.apply(null, uIntBuffView);\n      var buffStr = '';\n      if ('TextDecoder' in this) {\n        var decoder = new TextDecoder('ASCII');\n        buffStr = decoder.decode(dataView);  //var headerStr = buffStr.split(sepString)[0];\n                                             //var dataStr = buffStr.split(sepString)[1];\n                                             //console.log(dataStr);\n      } else {\n        for (var j = 0; j < uIntBuffView.length; j++) {\n          buffStr = buffStr + String.fromCharCode(uIntBuffView[j]);\n        }\n      }\n      var newLsep = buffStr.split(/^/m);\n      //check if header has headID and machineID\n      if (newLsep[0] !== headID) {\n        // alert('SSFF parse error: first line != SSFF -- (c) SHLRC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: first line != SSFF -- (c) SHLRC in file with fileExtension ' + name\n          }\n        };\n      }\n      if (newLsep[1] !== machineID) {\n        // alert('SSFF parse error: machineID != Machine IBM-PC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: machineID != Machine IBM-PC in file with fileExtension ' + name\n          }\n        };\n      }\n      // search header for Record_Freq and Start_Time\n      ssffData.sampleRate = undefined;\n      ssffData.startTime = undefined;\n      var counter = 0;\n      while (newLsep[counter] !== sepString) {\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Record_Freq') {\n          // console.log(\"FOUND Record_Freq\")\n          ssffData.sampleRate = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Start_Time') {\n          // console.log(\"FOUND Start_Time\")\n          ssffData.startTime = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        counter += 1;\n      }\n      // check if found Record_Freq and Start_Time\n      if (ssffData.sampleRate === undefined || ssffData.startTime === undefined) {\n        // alert('SSFF parse error: Required fields Record_Freq or Start_Time not set!');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: Required fields Record_Freq or Start_Time not set in file with fileExtension ' + name\n          }\n        };\n      }\n      for (var i = 4; i < newLsep.length; i++) {\n        if (newLsep[i].split(/[ ,]+/)[0] === 'Original_Freq') {\n          ssffData.origFreq = parseFloat(newLsep[i].split(/[ ,]+/)[2].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[i] === sepString) {\n          break;\n        }\n        var lSpl = newLsep[i].split(/[ ]+/);\n        if (lSpl[0] === 'Column') {\n          ssffData.Columns.push({\n            'name': lSpl[1],\n            'ssffdatatype': lSpl[2],\n            'length': parseInt(lSpl[3].replace(/(\\r\\n|\\n|\\r)/gm, ''), 10),\n            'values': [],\n            '_minVal': Infinity,\n            '_maxVal': -Infinity\n          });\n        }\n      }\n      var curBinIdx = newLsep.slice(0, i + 1).join('').length;\n      var curBufferView, curBuffer, curLen, curMin, curMax;\n      while (curBinIdx < uIntBuffView.length) {\n        for (i = 0; i < ssffData.Columns.length; i++) {\n          //console.log(ssffData.Columns[i].length);\n          if (ssffData.Columns[i].ssffdatatype === 'DOUBLE') {\n            curLen = 8 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            // ugly hack in order to support PhantomJS < 2.0 testing\n            if (typeof Float64Array == 'undefined') {\n              Float64Array = Float32Array;\n            }\n            curBufferView = new Float64Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'FLOAT') {\n            curLen = 4 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Float32Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'SHORT') {\n            curLen = 2 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint16Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'BYTE') {\n            curLen = 1 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint8Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n          } else {\n            // alert('Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported');\n            return {\n              'status': {\n                'type': 'ERROR',\n                'message': 'Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported in file with fileExtension ' + name\n              }\n            };\n          }\n        }  //for\n      }\n      //while\n      return ssffData;\n    };\n    /**\n\t\t * convert javascript object of label file to\n\t\t * array buffer containing\n\t\t * @param ssff javascipt object\n\t\t * @returns ssff arraybuffer\n\t\t */\n    global.jso2ssff = function (jso) {\n      // create header\n      var headerStr = headID + machineID;\n      headerStr += 'Record_Freq ' + global.round(jso.sampleRate, 1) + '\\n';\n      headerStr += 'Start_Time ' + jso.startTime + '\\n';\n      jso.Columns.forEach(function (col) {\n        // console.log(col.name)\n        headerStr += 'Column ' + col.name + ' ' + col.ssffdatatype + ' ' + col.length + '\\n';\n      });\n      headerStr += 'Original_Freq DOUBLE ' + global.round(jso.origFreq, 1) + '\\n';\n      headerStr += sepString;\n      // preallocate data buffer\n      var bytePerTime = 0;\n      var failed = false;\n      jso.Columns.forEach(function (col) {\n        if (col.ssffdatatype === 'SHORT') {\n          bytePerTime += 2 * col.length;\n        } else {\n          failed = true;\n        }\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      var byteSizeOfDataBuffer = bytePerTime * jso.Columns[0].values.length;\n      var dataBuff = new ArrayBuffer(byteSizeOfDataBuffer);\n      var dataBuffView = new DataView(dataBuff);\n      // convert buffer to header\n      var ssffBufView = new Uint8Array(global.stringToUint(headerStr));\n      // loop through vals and append array of each column to ssffBufView\n      var byteOffSet = 0;\n      jso.Columns[0].values.forEach(function (curArray, curArrayIDX) {\n        jso.Columns.forEach(function (curCol) {\n          if (curCol.ssffdatatype === 'SHORT') {\n            curCol.values[curArrayIDX].forEach(function (val) {\n              dataBuffView.setInt16(byteOffSet, val, true);\n              byteOffSet += 2;\n            });\n          } else {\n            failed = true;\n          }\n        });\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      // concatenate header with data\n      var tmp = new Uint8Array(dataBuffView.buffer);\n      ssffBufView = new global.Uint8Concat(ssffBufView, tmp);\n      return {\n        'status': {\n          'type': 'SUCCESS',\n          'message': ''\n        },\n        'data': ssffBufView.buffer\n      };\n    };\n    /**\n\t\t * loop over ssff files in ssffArr and create a ssffJsoArr\n\t\t */\n    global.parseArr = function (ssffArr) {\n      var noError = true;\n      var resArr = [];\n      var ssffJso;\n      for (var i = 0; i < ssffArr.length; i++) {\n        ssffJso = {};\n        var arrBuff;\n        arrBuff = global.base64ToArrayBuffer(ssffArr[i].data);\n        ssffJso = global.ssff2jso(arrBuff, ssffArr[i].fileExtension);\n        if (ssffJso.status === undefined) {\n          resArr.push(JSON.parse(JSON.stringify(ssffJso)));  // YUCK... don't know if SIC but YUCK!!!\n        } else {\n          noError = false;\n          return ssffJso;\n        }\n      }\n      if (noError) {\n        return {\n          'status': {\n            'type': 'SUCCESS',\n            'message': ''\n          },\n          'data': resArr\n        };\n      } else {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Error in parseArr() with: ' + JSON.stringify(ssffArr)\n          }\n        };\n      }\n    };\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseArr':\n          global.postMessage(global.parseArr(e.data.ssffArr));\n          break;\n        case 'jso2ssff':\n          global.postMessage(global.jso2ssff(JSON.parse(e.data.jso)));\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to ssffParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to ssffParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = undefined;\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n      this.url = undefined;\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.mathHelperService\n * @description\n * # mathHelperService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('mathHelperService', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  //////////////////////\n  //////////////////////\n  // public API\n  /**\n\t\t * calculate the closest power of two that is\n\t\t * greater than the passed in number\n\t\t * @param num\n\t\t * @returns power of two value\n\t\t */\n  sServObj.calcClosestPowerOf2Gt = function (num) {\n    var curExp = 0;\n    while (Math.pow(2, curExp) < num) {\n      curExp = curExp + 1;\n    }\n    return Math.pow(2, curExp);\n  };\n  /**\n\t\t * round to n digits after decimal point\n\t\t * used to help display numbers with a given\n\t\t * precision\n\t\t * @param x number\n\t\t * @param n digits after decimal point\n\t\t * @returns rounded number\n\t\t */\n  sServObj.roundToNdigitsAfterDecPoint = function (x, n) {\n    if (n < 1 || n > 14) {\n      console.error('error in call of round function!!');\n    }\n    var e = Math.pow(10, n);\n    var k = (Math.round(x * e) / e).toString();\n    if (k.indexOf('.') === -1) {\n      k += '.';\n    }\n    k += e.toString().substring(1);\n    return parseFloat(k.substring(0, k.indexOf('.') + n + 1));\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').directive('modal', [\n  '$animate',\n  'modalService',\n  function ($animate, modalService) {\n    return {\n      restrict: 'E',\n      templateUrl: 'views/modal.html',\n      replace: true,\n      scope: {},\n      link: function (scope, element, attr) {\n        scope.templateUrl = '';\n        scope.modal = modalService;\n        scope.isOpen = false;\n        scope.force = false;\n        scope.dataIn = '';\n        scope.$watch('modal.isOpen', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.templateUrl = modalService.getTemplateUrl();\n            scope.dataIn = modalService.dataIn;\n            scope.force = modalService.force;\n            if (newValue) {\n              element[0].classList.add('emuwebapp-modal-open');\n            } else {\n              element[0].classList.remove('emuwebapp-modal-open');\n            }\n          }\n        });\n        scope.$watch('modal.templateUrl', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.templateUrl = newValue;\n            scope.dataIn = modalService.dataIn;\n            scope.force = modalService.force;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.modalService\n * @description\n * # modalService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('modalService', [\n  '$q',\n  'ArrayHelperService',\n  'viewState',\n  function modalService($q, ArrayHelperService, viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.isOpen = false;\n    sServObj.templateUrl = '';\n    sServObj.defer = undefined;\n    sServObj.deferChange = undefined;\n    sServObj.force = false;\n    sServObj.dataOut = undefined;\n    sServObj.dataIn = undefined;\n    sServObj.dataExport = undefined;\n    /**\n\t\t * open modal normally\n\t\t */\n    sServObj.open = function (template, param1, param2, force) {\n      if (param1 !== undefined) {\n        sServObj.dataIn = param1;\n        if (param1.y !== undefined) {\n          sServObj.dataIn.chartData = ArrayHelperService.convertArrayToXYjsoArray(param1.y);\n        }\n      }\n      if (param2 !== undefined) {\n        sServObj.dataExport = param2;\n      }\n      if (force !== undefined) {\n        // force user to do sth\n        sServObj.force = force;\n      }\n      sServObj.defer = $q.defer();\n      sServObj.templateUrl = template;\n      viewState.setState('modalShowing');\n      sServObj.isOpen = true;\n      return sServObj.defer.promise;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.changeModal = function (template, param1, param2, force) {\n      if (param1 !== undefined) {\n        sServObj.dataIn = param1;\n      }\n      if (param2 !== undefined) {\n        sServObj.dataExport = param2;\n      }\n      if (force !== undefined) {\n        // force user to do sth\n        sServObj.force = force;\n      }\n      sServObj.deferChange = $q.defer();\n      sServObj.templateUrl = template;\n      return sServObj.deferChange.promise;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.error = function (msg) {\n      sServObj.dataIn = msg;\n      sServObj.templateUrl = 'views/error.html';\n      viewState.setState('modalShowing');\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.close = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      if (viewState.hierarchyState.isShown()) {\n        viewState.hierarchyState.toggleHierarchy();\n      }\n      sServObj.defer.resolve(false);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.closeAndResolve = function (status) {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(status);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.confirm = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(true);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.select = function (idx) {\n      sServObj.closeAndResolve(idx);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.confirmContent = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(sServObj.dataOut);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getTemplateUrl = function () {\n      return sServObj.templateUrl;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('TabbedCtrl', [\n  '$scope',\n  '$timeout',\n  'ConfigProviderService',\n  'Validationservice',\n  'viewState',\n  'modalService',\n  function ($scope, $timeout, ConfigProviderService, Validationservice, viewState, modalService) {\n    $scope.cps = ConfigProviderService;\n    $scope.vs = viewState;\n    // all available tabs\n    $scope.tree = [\n      {\n        title: 'Perspectives Configuration',\n        url: 'views/config/perspectives.html'\n      },\n      {\n        title: 'Spectrogram Settings',\n        url: 'views/config/spectro.html'\n      },\n      {\n        title: 'Expert Settings',\n        url: 'views/config/expert.html'\n      }\n    ];\n    $scope.cps = ConfigProviderService;\n    $scope.modal = modalService;\n    $scope.schema = Validationservice.getSchema('emuwebappConfigSchema').data.properties;\n    $scope.modal.dataOut = angular.copy(ConfigProviderService.vals);\n    $scope.warning = '';\n    $scope.init = function () {\n      $scope.options = Object.keys(viewState.getWindowFunctions());\n      $scope.timeMode = Object.keys(viewState.getTimeModes());\n      $scope.comMode = Object.keys(viewState.getCommunicationModes());\n      $scope.signalTypes = Object.keys(viewState.getSignalTypes());\n      $scope.levelTypes = [];\n      angular.forEach(ConfigProviderService.curDbConfig.ssffTrackDefinitions, function (val, key) {\n        $scope.signalTypes.push(val.name);\n      });\n      angular.forEach(ConfigProviderService.curDbConfig.levelDefinitions, function (val, key) {\n        if (val.type === 'SEGMENT' || val.type === 'EVENT') {\n          $scope.levelTypes.push(val.name);\n        }\n      });\n      $scope.currentSignal = $scope.signalTypes[0];\n      if ($scope.levelTypes.length > 0) {\n        $scope.currentLevel = $scope.levelTypes[0];\n      }\n    };\n    $scope.onClickTab = function (node) {\n      if (node.url !== false) {\n        $scope.currentTabUrl = node.url;\n      }\n    };\n    $scope.getType = function (section, key) {\n      var val = undefined;\n      angular.forEach($scope.schema, function (schemaValue, schemaKey) {\n        if (schemaKey === section) {\n          angular.forEach(schemaValue.properties, function (value, configKey) {\n            if (configKey === key) {\n              val = value.type;\n            }\n          });\n        }\n      });\n      return val;\n    };\n    $scope.up = function (key, index, sequence) {\n      var p = $scope.modal.dataOut.perspectives[key];\n      if (index > 0) {\n        if (sequence === 0) {\n          var tmp = p.signalCanvases.order[index - 1];\n          p.signalCanvases.order[index - 1] = p.signalCanvases.order[index];\n          p.signalCanvases.order[index] = tmp;\n        } else if (sequence === 1) {\n          var tmp = p.levelCanvases.order[index - 1];\n          p.levelCanvases.order[index - 1] = p.levelCanvases.order[index];\n          p.levelCanvases.order[index] = tmp;\n        }\n      }\n    };\n    $scope.down = function (key, index, sequence) {\n      var p = $scope.modal.dataOut.perspectives[key];\n      if (sequence === 0) {\n        if (p.signalCanvases.order[index + 1] !== undefined) {\n          var tmp = p.signalCanvases.order[index + 1];\n          p.signalCanvases.order[index + 1] = p.signalCanvases.order[index];\n          p.signalCanvases.order[index] = tmp;\n        }\n      } else if (sequence === 1) {\n        if (p.levelCanvases.order[index + 1] !== undefined) {\n          var tmp = p.levelCanvases.order[index + 1];\n          p.levelCanvases.order[index + 1] = p.levelCanvases.order[index];\n          p.levelCanvases.order[index] = tmp;\n        }\n      }\n    };\n    $scope.del = function (key, index, sequence) {\n      var p = $scope.modal.dataOut.perspectives[key];\n      if (p.signalCanvases.assign !== undefined) {\n        var dependency = false;\n        var depWarn = '';\n        for (var x = 0; x < p.signalCanvases.assign.length; x++) {\n          if (p.signalCanvases.assign[x].signalCanvasName === p.signalCanvases.order[index]) {\n            dependency = true;\n            depWarn = p.signalCanvases.assign[x].signalCanvasName;\n          }\n          if (p.signalCanvases.assign[x].ssffTrackName === p.signalCanvases.order[index]) {\n            dependency = true;\n            depWarn = p.signalCanvases.assign[x].ssffTrackName;\n          }\n        }\n      }\n      if (!dependency) {\n        p.signalCanvases.order.splice(index, 1);\n      } else {\n        $scope.showWarning('Could not delete \"' + depWarn + '\" because of internal dependencies !');\n      }\n    };\n    $scope.showWarning = function (msg) {\n      $scope.warningSignal = true;\n      $scope.warning = msg;\n      $timeout(function () {\n        $scope.warningSignal = false;\n      }, 2000);\n    };\n    $scope.perspDelete = function (key) {\n      delete $scope.modal.dataOut.perspectives.splice(key, 1);\n    };\n    $scope.signalAdd = function (key, signal) {\n      var p = $scope.modal.dataOut.perspectives[key];\n      if (p.signalCanvases.order === undefined) {\n        p.signalCanvases.order = [];\n      }\n      if (p.signalCanvases.order.indexOf(signal) === -1) {\n        p.signalCanvases.order.push(signal);\n      } else {\n        $scope.showWarning('Signal \"' + level + '\" already existing');\n      }\n    };\n    $scope.levelAdd = function (key, level) {\n      var p = $scope.modal.dataOut.perspectives[key];\n      if (p.levelCanvases.order === undefined) {\n        p.levelCanvases.order = [];\n      }\n      if (p.levelCanvases.order.indexOf(level) === -1) {\n        p.levelCanvases.order.push(level);\n      } else {\n        $scope.showWarning('Level \"' + level + '\" already existing');\n      }\n    };\n    $scope.perspAdd = function () {\n      var obj = {\n          name: 'new Perspective',\n          signalCanvases: [],\n          levelCanvases: { order: [] },\n          twoDimCanvases: []\n        };\n      $scope.modal.dataOut.perspectives.splice($scope.modal.dataOut.perspectives.length, 0, obj);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    $scope.onClickTab($scope.tree[0]);\n    $scope.init();\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('TabbedHelpCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  function ($scope, ConfigProviderService, Iohandlerservice) {\n    $scope.cps = ConfigProviderService;\n    $scope.tree = [];\n    Iohandlerservice.httpGetPath('manual/index.json').then(function (resp) {\n      $scope.tree = resp.data;\n      console.log($scope.tree);\n      // load root element\n      $scope.onClickTab($scope.tree[0]);\n      // expand root element\n      $scope.tree[0].expanded = true;\n    });\n    $scope.onClickTab = function (node) {\n      node.expanded = !node.expanded;\n      if (node.url !== false) {\n        if (node.url.substr(node.url.lastIndexOf('.') + 1).toLowerCase() === 'md') {\n          $scope.isMDFile = true;\n          $scope.currentTabUrl = node.url;\n        } else {\n          $scope.isMDFile = false;\n          $scope.currentTabUrl = node.url;\n        }\n      }\n    };\n    $scope.hasChildren = function (node) {\n      if (node.nodes !== undefined) {\n        if (node.nodes.length > 0) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HierarchyManipulationService', [\n  '$q',\n  'HierarchyLayoutService',\n  'DataService',\n  'LevelService',\n  'ConfigProviderService',\n  'ArrayHelperService',\n  function HierarchyManipulationService($q, HierarchyLayoutService, DataService, LevelService, ConfigProviderService, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * Add a new link if it is valid and goes along the specfied path\n\t\t *\n\t\t * If the specified link is invalid but its reverse is valid,\n\t\t * the reverse is added.\n\t\t *\n\t\t * @param path The current path through the hierarchy\n\t\t * @param from ID of the source item\n\t\t * @param to ID of the target item\n\t\t *\n\t\t * @return the link object that was added ({fromID: x, toID: y})\n\t\t * @return null if no link was added\n\t\t */\n    sServObj.addLink = function (path, from, to) {\n      var validity = sServObj.checkLinkValidity(path, from, to);\n      if (validity.valid) {\n        var obj = {\n            fromID: from,\n            toID: to\n          };\n        DataService.insertLinkData(obj);\n        return obj;\n      } else {\n        console.debug('Not adding invalid link:', from, '->', to, ' (Error code:', validity.reason, ')');\n        if (validity.reason === 3) {\n          validity = sServObj.checkLinkValidity(path, to, from);\n          if (validity.valid) {\n            console.debug('Adding reverse link instead');\n            var obj = {\n                fromID: to,\n                toID: from\n              };\n            DataService.insertLinkData(obj);\n            return obj;\n          } else {\n            return null;\n          }\n        } else {\n          return null;\n        }\n      }\n    };\n    /**\n\t\t * Test whether a link to be added would be valid\n\t\t *\n\t\t * Requirements for validity:\n\t\t * - No cross-over links\n\t\t * - Meet limitations defined by DBconfig.linkDefinitions\n\t\t * -- Only along the hierarchy's direction\n\t\t * - Only within the currently selected (and visualised) path\n\t\t * - No multiply defined links\n\t\t *\n\t\t * @param path Currently selected path (form: [..., 'level2name', 'level1name'])\n\t\t * @param from ID of the source item\n\t\t * @param to ID of the target item\n\t\t *\n\t\t * @return object with state and reason properties\n\t\t * reason may be one of:\n\t\t * 0: no error\n\t\t * 1: from and to are the same\n\t\t * 2: link already exists\n\t\t * 3: link does not meet the requirements of DBconfig.linkDefinitions (no link between its levels)\n\t\t * 4: link does not meet the requirements of DBconfig.linkDefinitions (link type not satisified)\n\t\t * 5: link would cross another link\n\t\t **/\n    sServObj.checkLinkValidity = function (path, from, to) {\n      var result = {\n          valid: true,\n          reason: 0\n        };\n      var links = DataService.getLinkData();\n      // This case (from === to)  would also be caught below\n      // during linkDefinitions check. I treat it separately\n      // anyway because the current GUI implementation kindly\n      // facilitates this kind of error and I can therefore\n      // offer a 0.0000001 % increase in speed here :-)\n      if (from === to) {\n        result.valid = false;\n        result.reason = 1;\n        return result;\n      }\n      // Check whether link already exists\n      for (var i = 0; i < links.length; ++i) {\n        if (links[i].fromID === from && links[i].toID === to) {\n          result.valid = false;\n          result.reason = 2;\n          return result;\n        }\n      }\n      // Check whether link is within the currently selected\n      // path (which implies that the DBconfig.linkDefinitions\n      // are met, apart from the link type that is specified\n      // there\n      var superlevelName = LevelService.getLevelName(from);\n      var sublevelName = LevelService.getLevelName(to);\n      var superlevelIndex = path.indexOf(superlevelName);\n      if (path[superlevelIndex - 1] !== sublevelName) {\n        result.valid = false;\n        result.reason = 3;\n        return result;\n      }\n      // Check link type\n      var linkType;\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === sublevelName && ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName === superlevelName) {\n          linkType = ConfigProviderService.curDbConfig.linkDefinitions[i].type;\n        }\n      }\n      if (linkType === undefined) {\n        consle.debug('LIKELY A BUG: link to be added (', from, '->', to, ') has been found to be a part of the currently selected path but the link between the respective levels could not be found.');\n        result.valid = false;\n        result.reason = 3;\n        return result;\n      }\n      // Type can be one of 'MANY_TO_MANY', 'ONE_TO_MANY', 'ONE_TO_ONE'\n      // this is defined in schemaFiles/DBconfigFileSchema.json\n      //\n      // In case it is MANY_TO_MANY, the link is always valid\n      //\n      if (linkType === 'ONE_TO_MANY' || linkType === 'ONE_TO_ONE') {\n        var toElement = LevelService.getItemByID(to);\n        if (toElement._parents.length > 0) {\n          result.valid = false;\n          result.reason = 4;\n          return result;\n        }\n      }\n      if (linkType === 'ONE_TO_ONE') {\n        var fromElement = LevelService.getItemByID(from);\n        var children = HierarchyLayoutService.findChildren(fromElement, path);\n        if (children.length > 0) {\n          result.valid = false;\n          result.reason = 4;\n          return result;\n        }\n      }\n      //////\n      // Check for crossover links\n      //\n      // We'll try to find the first and last position in the sublevel\n      // where the supposed link's parent can have children.\n      //\n      // First, we'll check the preceding sibling of that parent node.\n      // Its last child node is the first one that can be a child of the\n      // supposed parent node.\n      // Note that if the sibling has no children, we have to skip it and\n      // check the next sibling.\n      //\n      // Next, we'll chek the siblings that come after the supposed\n      // parent node. Their first child is the last one that can be a\n      // child of the supposed parent.\n      //\n      var firstAllowedChildIndex = undefined;\n      var lastAllowedChildIndex = undefined;\n      var superlevel = LevelService.getLevelAndItem(from).level;\n      var sublevel = LevelService.getLevelAndItem(to).level;\n      var parentOrder = LevelService.getOrderById(superlevelName, from);\n      var childOrder = LevelService.getOrderById(sublevelName, to);\n      var siblingRelativeIndex = 0;\n      var sibling;\n      while (firstAllowedChildIndex === undefined) {\n        siblingRelativeIndex -= 1;\n        sibling = superlevel.items[parentOrder + siblingRelativeIndex];\n        if (sibling === undefined) {\n          firstAllowedChildIndex = 0;\n          break;\n        }\n        console.debug('found preceding sibling', sibling.id, sibling.labels[0]);\n        var children = HierarchyLayoutService.findChildren(sibling, path);\n        for (var i = 0; i < children.length; ++i) {\n          var index = LevelService.getOrderById(sublevelName, children[i].id);\n          if (firstAllowedChildIndex === undefined || index > firstAllowedChildIndex) {\n            firstAllowedChildIndex = index;\n          }\n        }\n      }\n      siblingRelativeIndex = 0;\n      while (lastAllowedChildIndex === undefined) {\n        siblingRelativeIndex += 1;\n        sibling = superlevel.items[parentOrder + siblingRelativeIndex];\n        if (sibling === undefined) {\n          lastAllowedChildIndex = sublevel.items.length - 1;\n          break;\n        }\n        console.debug('found successive sibling', sibling.id, sibling.labels[0]);\n        var children = HierarchyLayoutService.findChildren(sibling, path);\n        if (children.length === 0) {\n          continue;\n        }\n        for (var i = 0; i < children.length; ++i) {\n          var index = LevelService.getOrderById(sublevelName, children[i].id);\n          if (lastAllowedChildIndex === undefined || index < lastAllowedChildIndex) {\n            lastAllowedChildIndex = index;\n          }\n        }\n      }\n      console.debug('child must be within', firstAllowedChildIndex, lastAllowedChildIndex);\n      if (childOrder < firstAllowedChildIndex || childOrder > lastAllowedChildIndex) {\n        result.valid = false;\n        result.reason = 5;\n        return result;\n      }\n      // No error found - returning success object\n      return result;\n    };\n    return sServObj;\n  }\n]);\n/**\n * This service holds general helper functions that do not depend on any of the\n * EMU components.\n */\n'use strict';\nangular.module('emuwebApp').service('StandardFuncsService', function () {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t * Recursively looks at all properties of a given object and\n\t\t * removes any whose name starts with an underscore\n\t\t *\n\t\t * @param o The object to traverse\n\t\t * @returns nothing\n\t\t */\n  sServObj.traverseAndClean = function (o) {\n    for (var i in o) {\n      if (i.substr(0, 1) === '_') {\n        delete o[i];\n      }\n      if (o[i] !== null && typeof o[i] === 'object') {\n        // Go one step down in the object tree\n        sServObj.traverseAndClean(o[i]);\n      }\n    }\n  };\n  /**\n\t\t * Return a reversed copy of an array\n\t\t */\n  sServObj.reverseCopy = function (a) {\n    var r = angular.copy(a);\n    r.reverse();\n    return r;\n  };\n  return sServObj;\n});\n'use strict';\n/**\n * @ngdoc filter\n * @name emuwebApp.filter:startFromFilter\n * @function\n * @description\n * # startFromFilter\n * Filter in the emuwebApp.\n */\nangular.module('emuwebApp').filter('startFrom', function () {\n  return function (input, start) {\n    start = +start;\n    //parse to int\n    return input.slice(start);\n  };\n});\n'use strict';\n/**\n * @ngdoc function\n * @name emuwebApp.controller:ManualctrlCtrl\n * @description\n * # ManualctrlCtrl\n * Controller of the emuwebApp\n */\nangular.module('emuwebApp').controller('ManualCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  function ($scope, ConfigProviderService) {\n    $scope.listOfMarkdownFiles = [\n      {\n        title: 'Introduction',\n        url: 'manual/Introduction.md'\n      },\n      {\n        title: 'EMU-webApp-websocket-protocol',\n        url: 'manual/EMU-webApp-websocket-protocol.md'\n      },\n      {\n        title: 'Labeling articulatory data',\n        url: 'manual/Labeling-articulatory-data.md'\n      }\n    ];\n    $scope.curMdFile = $scope.listOfMarkdownFiles[0];\n    $scope.setCurrentMdFile = function (mdFile) {\n      $scope.curMdFile = mdFile;\n    };\n    $scope.isCurrentMdFile = function (tabUrl) {\n      console.log(tabUrl);\n      console.log($scope.curMdFile.url);\n      if (tabUrl === $scope.curMdFile.url) {\n        return {\n          'background-color': ConfigProviderService.design.color.white,\n          'color': ConfigProviderService.design.color.black,\n          'font-weight': '500'\n        };\n      }\n      return {\n        'background-color': ConfigProviderService.design.color.blue,\n        'color': ConfigProviderService.design.color.white,\n        'font-weight': '400'\n      };\n    };\n  }\n]);"]}