{"version":3,"file":"emuwebApp.min.js","sources":["emuwebApp.min.js"],"names":["ArrayBuffer","prototype","subarray","offset","length","sub","subView","Int8Array","thisView","this","i","angular","module","config","$locationProvider","html5Mode","service","viewState","sServObj","vals","curDbConfig","embeddedVals","audioGetUrl","labelGetUrl","labelType","fromUrlParams","setVals","data","$","isEmptyObject","forEach","Object","keys","key1","isArray","itm","push","key2","undefined","console","error","getSsffTrackConfig","name","res","ssffTrackDefinitions","tr","getLimsOfTrack","trackName","perspectives","curPerspectiveIdx","signalCanvases","contourLims","cL","ssffTrackName","getContourColorsOfTrack","contourColors","cC","getAssignment","signalName","assign","a","signalCanvasName","getLevelDefinition","levelName","levelDefinitions","ld","controller","$scope","$rootScope","$modal","$log","$compile","$timeout","$q","$window","$document","$location","HistoryService","Iohandlerservice","Soundhandlerservice","ConfigProviderService","fontScaleService","Ssffdataservice","LevelService","dialogService","Textgridparserservice","Espsparserservice","Binarydatamaniphelper","Wavparserservice","Ssffparserservice","Drawhelperservice","Validationservice","Appcachehandler","cps","hists","fontImage","levServ","vs","dials","ssffds","shs","dhs","wps","io","ach","connectBtnLabel","tmp","dbLoaded","is2dCancasesHidden","bundleList","curUserName","curBndl","lastclickedutt","filterText","windowWidth","outerWidth","demoDbName","firefox","navigator","userAgent","match","checkForNewVersion","element","bind","deleteEditArea","setWindowWidth","$digest","e","keyCode","keyMappings","shift","alt","addCurChangeObjToUndoStack","window","onbeforeunload","main","autoConnect","$on","resetToInitState","searchObject","search","loadFilesForEmbeddedApp","httpGetPath","then","showDropZone","substr","lastIndexOf","getsubmenuOpen","togglesubmenuOpen","colors","transitionTime","somethingInProgressTxt","resp","EMUwebAppConfig","validRes","validateJSO","catchMouseForKeyBinding","somethingInProgress","parseWavArrBuf","messWavParser","wavJSO","curViewPort","sS","eS","Data","resetSelect","data2","parseLabelFile","parseMess","annot","setData","lNames","levelDefs","levels","l","type","attributeDefinitions","setCurLevelAttrDefs","levelCanvases","order","setState","errMess","open","status","message","JSON","stringify","loadDefaultConfig","loadSchemas","replies","setSchemas","httpGetDefaultConfig","success","handleDefaultConfigLoaded","header","wsH","initConnect","serverUrl","defaultServerUrl","handleConnectedToWSserver","setspectroSettings","spectrogramSettings","N","rangeFrom","rangeTo","dynamicRange","drawHeatMapColors","preEmphasisFilterFactor","heatMapColorAnchors","setTransitionTime","comMode","getProtocol","protocol","version","getDoUserManagement","doUsrData","innerHandleConnectedToWSserver","getDBconfigFile","getBundleList","bdata","menuBundleClick","bndl","movesAwayFromLastSave","messModal","menuBundleSaveBtnClick","getBundle","bundleData","arrBuff","base64ToArrayBuffer","mediaFile","selectS","selectE","curClickSegments","curClickLevelName","curClickLevelType","asyncParseSsffArr","ssffFiles","ssffJso","annotation","getPermission","defer","formants","el","getAnnotationAndSaveBndl","asyncJso2ssff","messParser","encoding","arrayBufferToBase64","reject","promise","info","getData","saveBundle","resolve","uttIsDisabled","getEnlarge","index","len","large","getenlarge","getBndlColor","curColor","background-color","color","cursorInTextField","setcursorInTextField","cursorOutOfTextField","openSubmenu","insertLevelSegBtnClick","newName","level","items","id","getNewId","sampleStart","sampleDur","labels","value","labelCanvasConfig","newSegmentName","getCurAttrDef","leveldef","insertLevel","addObjToUndoStack","action","log","insertLevelPointBtnClick","samplePoint","Math","round","newEventName","renameSelLevelBtnClick","getcurClickLevelName","downloadTextGridBtnClick","asyncToTextGrid","openExport","spectSettingsBtnClick","connectBtnClick","url","openDemoDBbtnClick","nameOfDB","err","aboutBtnClick","showHierarchyBtnClick","clearBtnClick","modalText","isConnected","disconnectWarning","closeConnect","$broadcast","cmdZoomAll","setViewPort","cmdZoomIn","zoomViewPort","cmdZoomOut","cmdZoomLeft","shiftViewPort","cmdZoomRight","cmdZoomSel","cmdPlayView","playFromTo","animatePlayHead","cmdPlaySel","cmdPlayAll","changePerspective","persp","newIdx","setRightsubmenuOpen","getRightsubmenuOpen","getPerspectiveColor","cl","newfiles","wav","grid","dropText","dropDefault","handleLocalFiles","$parent","reader","FileReader","readAsArrayBuffer","onloadend","evt","target","readyState","DONE","result","currentTarget","readAsText","extension","asyncParseTextGrid","traverseFileTreeChrome","item","path","isFile","file","toUpperCase","other","isDirectory","dirReader","createReader","readEntries","entries","traverseFileTreeFirefox","size","directive","$animate","templateUrl","restrict","scope","idx","link","attr","drawLevelDetails","levelDetails","fontSize","font","fontPxSize","curAttrDef","ctx","canvas","getContext","clearRect","width","height","sDist","posS","posE","horizontalText","getSampleDist","scaleY","offsetHeight","getTextImageTwoLines","fontType","labelColor","drawImage","curID","getcurMouseSegment","getcurClickSegments","mTxtImgWidth","getTextImage","getLastImageWidth","zeroTxtImgWidth","endBoundaryColor","fillStyle","startBoundaryColor","curEvt","curLabVal","lab","getPos","fillRect","tW","tX","labelCenter","hlY","strokeStyle","beginPath","moveTo","lineTo","stroke","toString","horizontalSubText1","horizontalSubText2","hst2","perc","drawLevelMarkup","selectedLevelColor","drawMovingBoundaryLine","drawCurViewPortSelected","xOffset","segMId","isFirst","getcurMouseisFirst","isLast","getcurMouseisLast","clickedSegs","levelId","cs","selectedSegmentColor","getcurMouseLevelName","selectedBoundaryColor","getcurMouseLevelType","find","levelCanvasContainer","levelDef","backgroundCanvas","background","levelColor","$watch","newValue","oldValue","changeCurAttrDef","attrDefName","setCurAttrDef","hasClass","setEditing","addClass","finishedAnim","removeClass","getAttrDefBtnColor","updateView","setcurMouseSegment","replace","changeAttrDef","alert","attrs","drawPlayHead","markupCanvas","playHeadAnimationInfos","posCur","curS","selectedAreaColor","drawVpOsciMarkup","reset","drawViewPortTimes","canvasLength","redraw","allPeakVals","calculatePeaks","osciPeaks","freshRedrawDrawOsciOnCanvas","currentBundleName","drawPreview","initialized","selectedBorderColor","closePath","border","newVal","oldVal","ctxMarkup","submenuOpen","pcmpp","pcmperpixel","canvas0","drawSpectMarkup","markupCtx","canvas1","drawMinMaxAndName","spectroSettings","killSpectroRenderingThread","context","primeWorker","terminate","setupEvent","imageData","createImageData","addEventListener","event","myStep","Uint8ClampedArray","img","set","putImageData","drawSpectro","buffer","startSpectroRenderingThread","Worker","spectroWorker","parseData","Float32Array","windowLength","postMessage","alpha","freq","freqLow","start","end","dynRangeInDB","pixelRatio","devicePixelRatio","sampleRate","SampleRate","streamChannels","NumChannels","transparency","stream","URL","webkitURL","exportData","exportName","cancel","close","getBlob","Blob","export","SaveToDisk","createObjectURL","updateHistoryService","fileURL","fileName","save","document","createElement","setAttribute","href","innerHTML","style","display","body","appendChild","click","download","createEvent","initEvent","dispatchEvent","revokeObjectURL","factory","myWindow","BARTLETT","BARTLETTHANN","BLACKMAN","COSINE","GAUSS","HAMMING","HANN","LANCZOS","RECTANGULAR","TRIANGULAR","curLevelAttrDefs","initialize","dragBarActive","dragBarHeight","endFreezeSample","timelineSize","editing","saving","rightSubmenuOpen","curMousePosSample","curMouseLevelName","curMouseLevelType","curPreselColumnSample","curCorrectionToolNr","curClickLevelIndex","TransitionTime","movingBoundary","movingBoundarySample","focusInTextField","curTaskPercCompl","mouseInEmuWebApp","states","noDBorFilesloaded","permittedActions","loadingSaving","labeling","modalShowing","prevState","curState","actionName","indexOf","b","nameOrObj","updatePlayHead","timestamp","player","isPlaying","requestAnimationFrame","samplesPassed","floor","$apply","startS","endS","select","getViewPort","rfrom","rto","dyn","win","hm","preEmph","hmColorAnchors","parseInt","setWindowFunction","getSelect","selectDependent","selectLevel","next","Levelserv","curLev","now","getLevelDetails","setcurClickLevel","idxOfNow","selectBoundary","getWindowFunctions","getdragBarActive","setdragBarActive","getdragBarHeight","setdragBarHeight","w","s","time","setsubmenuOpen","setenlarge","getTransitionTime","levelID","levelType","levelIndex","setcurClickLevelName","setcurClickLevelType","getcurClickLevelType","getcurClickLevelIndex","getcurClickNeighbours","curClickNeighbours","setcurMouseLevelName","setcurMouseLevelType","segment","neighbour","x","curMouseSegment","curMouseX","curMouseNeighbours","curMouseisFirst","curMouseisLast","getcurMouseNeighbours","selectSegmentsInSelection","levelData","min","Infinity","max","itemInSel","getItemsInSelection","setcurClickSegmentMultiple","itemsInRange","rangeStart","rangeEnd","t","setcurClickSegment","left","right","entry","empty","front","back","sort","sortbyid","getselectedRange","getfirstClickSegment","getselected","isEditing","n","getcursorInTextField","isSavingAllowed","setSavingAllowed","countSelected","getCurrentSample","getCurrentPercent","sample","getSamplesPerPixelVal","parseFloat","originalEvent","pow","k","substring","getViewPortStartTime","getViewPortEndTime","getSelectedStartTime","getSelectedEndTime","sSample","eSample","oldStart","oldEnd","abs","zoomIn","newStartS","newEndS","curMouseMoveSegmentStart","seg","d","isLastSeg","getItemDetails","getLastItem","d1","d2","shiftRight","curAttrDefName","newAttrDefName","ad","curAttrDefIndex","getCurAttrIndex","getX","offsetX","layerX","clientWidth","getY","offsetY","layerY","clientHeight","setLastClick","curMouseSampleNrInView","lastEventClick","getClosestItem","current","nearest","setlasteditArea","setlasteditAreaElem","parent","$index","lastPCM","setLastRightClick","setLastDblClick","openEditArea","setLastMove","doChange","lastEventMove","lastNeighboursMove","getItemNeighboursFromLevel","preventDefault","restrictions","editItemName","moveLine","samplesPerPixel","moveBy","zoomEventMove","ceil","lastItem","getItemFromLevelById","mbutton","buttons","which","editItemSize","shiftKey","moveBoundary","updateCurChangeObj","movedBy","moveEvent","altKey","moveSegment","LinkService","AnagestService","applyKeyCodeUp","code","stopPropagation","esc","createNewItemAtSelection","domElement","getlasteditArea","str","val","definitions","legalLabels","css","applyKeyCode","editingElement","getlastID","attrIndex","renameLabel","zoomAll","zoomOut","shiftViewPortLeft","shiftViewPortRight","zoomSel","playEntireFile","playback","playAllInView","playSelected","selectFirstContourCorrectionTool","correctionTool","selectSecondContourCorrectionTool","selectThirdContourCorrectionTool","selectFourthContourCorrectionTool","selectNoContourCorrectionTool","levelUp","levelDown","snapBoundaryToNearestTopBoundary","mouseSeg","neighbor","minDist","snapBoundary","position","snapBoundaryToNearestBottomBoundary","snapBoundaryToNearestZeroCrossing","dist","calcDistanceToNearestZeroCrossing","levelname","expandSelSegmentsRight","changeTime","addTimeValue","addTimeMode","expandSegment","rightSide","expandSelSegmentsLeft","shrinkSelSegmentsLeft","shrinkSelSegmentsRight","toggleSideBarLeft","activeButtons","openMenu","toggleSideBarRight","selPrevItem","idLeft","idRight","selNextItem","selNextPrevItem","addItem","getlasteditAreaElem","insSeg","insertSegment","ret","ids","segName","anagestConfig","insPoint","insertEvent","alreadyExists","pointName","insertAnagestEvents","undo","redo","deletePreselBoundary","deleteItem","deletedSegment","deleteSegments","clickSeg","deleteItemBoundary","deleteBoundary","deletedPoint","deleteEvent","metaKey","ctrlKey","safeApply","fn","phase","$root","$$phase","off","delete","elem","elemHeight","deleteButton","children","saveButton","deleteSingleLevel","hide","saveSingleLevel","show","enlarge","asyncParseJSO","startPCM","$http","Websockethandler","prom","get","respType","responseType","getProm","logOnUser","pwd","string","annotates","fileType","asyncParseEsps","setPlayerSrc","buf","base64String","src","resetPlayerSrcFromTo","endSample","bytePerSample","BitsPerSample","origArrBuf","dv","DataView","setUint32","newData","Uint8Array","byteLength","pause","play","atts","handleUpdate","assTrackName","ass","col","getColumnOfTrack","columnName","sRaSt","getSampleRateAndStartTimeOfTrack","minMaxLims","drawValues","startTime","sR","sT","minVal","maxVal","_minVal","_maxVal","startTimeVP","endTimeVP","colStartSampleNr","colEndSampleNr","nrOfSamples","curSampleArrs","values","slice","y","curSampleInCol","curSampleInColTime","contourVal","contourNr","minContourIdx","maxContourIdx","contColors","selectedContourColor","leftBorder","leftVal","curArr","curArrIdx","arc","PI","rightBorder","rightVal","txt","crossHairsColor","Date","$observe","worker","ssffArray","cmd","ssffArr","jso","switchMarkupContext","leave","ssffTrackname","drawCrossHairs","setSelectDrag","curMouseSample","dragStartSample","dragEndSample","bundleName","mouseX","curMouseTime","curMouseSampleTime","fill","copy","updateObj","sampleBlockIdx","sampleIdx","key","getScale","scale","measureText","getScaleWidth","str1","str2","scaleX","drawFrame","prevPeak","h","prevH","prevX","prevY","osciColor","relData","samplePerPx","numberOfChannels","peaks","minPeak","maxPeak","apply","Array","call","curPxIdx","avrVal","c","sum","p","peak","hDbS","sNr","drawSampleNrs","strokeText","fillText","drawZeroLine","zeroLineColor","vendor","setLineDash","zeroLineY","drawTimeAndSamples","space","offsetWidth","mouseEvt","unit","trackname","mouseY","mouseFreq","s1","s2","verticalText","smallFontSize","th","trackNameImg","labelTxtImg","sTime","eTime","applyChange","changeObj","applyOldVal","cur","renameLevel","newname","deleteLevel","deleteBoundaryInvers","deleteSegmentsInvers","insertLinksTo","deletedLinks","deleteLinksTo","insertSegmentInvers","parentID","childIDs","undoStack","redoStack","curChangeObj","dataObj","dataKey","String","obj","tmpObj","oldChangeObj","pop","getNrOfPossibleUndos","getCurrentStack","buffLength","textGrid","rand","random","new","newHash","lastTextWidth","spaceTop","ctxOriginal","text","restore","text2","alignLeft","esps","loginData","username","password","errorMsg","tryLogin","Columns","calculateSamplePosInVP","colSampleNr","sampleTime","audioSample","getLabelIdx","labelIdx","maxItemID","lasteditArea","lasteditAreaElem","raiseId","amount","lowerId","curLevel","num","getLevelsByType","types","getOrderById","eid","getIdByOrder","details","getNextItem","foundItm","remove","clientOffset","offsetLeft","top","offsetTop","editText","zoom","createEditArea","createSelection","field","createTextRange","selRange","collapse","moveStart","moveEnd","setSelectionRange","selectionStart","selectionEnd","focus","label","labelid","textid","prepend","class","ng-model","autofocus","padding-top","overflow-x","overflow-y","insertItemDetails","labelname","duration","newElement","attrdefs","splice","updateSegItemInLevel","setPointDetails","firstid","lastid","sampleNr","maximum","spaceLower","spaceHigher","lvl","originalLevel","newLabelName","oldname","insertPoint","segments","lastNeighbours","timeRight","timeLeft","firstSegment","firstOrder","lastSegment","neighbours","deleteOrder","diff2","startOrder","diff","newLabel","startID","newStart","endID","pos","toDelete","last","retOrder","retEvt","oldName","toTop","neighTd","absDist","sampleTarget","absMinDist","thisTd","tIdx","orig","ln","origRight","origLeft","orderPoints","first","tempItem","allow","lastLength","distRight","distLeft","getAllLabelsOfLevel","j","insertLink","fromID","toID","links","deleteLink","linkIdx","toIDs","insertLinksFrom","fromIDs","deleteLinksFrom","uuid","wsonopen","connected","conPromise","wsonmessage","listener","fromJson","wsonerror","wsonclose","wasClean","sendRequest","request","callbackId","getCallbackId","callbacks","cb","callbackID","ws","send","toJson","tOutResp","serverTimeoutInterval","messageObj","hasOwnProperty","newUUID","WebSocket","onopen","onmessage","onerror","onclose","userName","serverInfos","Url","connectionError","tryConnection","stringBase64","binaryString","atob","bytes","ascii","charCodeAt","binary","fromCharCode","btoa","modalInstance","templatefile","argCtrl","passedIn","backdrop","keyboard","passedInTxt","passedInOpts","handleUpdatereadyEvent","appCache","swapCache","location","reload","applicationCache","update","getStrRep","options","selWindowInfo","windowLengths","modalVals","getColorOfAnchor","anchorNr","curStyle","saveSpectroSettings","confirm","ArrayHelperService","myData","convertArrayToXYjsoArray","filter","input","regex","patt","RegExp","toLowerCase","out","test","patt1","patt2","passedOutTxt","var","saveChanges","discardChanges","showMenu","showTwod","animation","transclude","showTwoDimCans","template","panes","bottomRightResizePane","addPane","pane","setBottomRightResizePane","dragBottomRightResizePaneTopResizer","dragBottomRightResizePaneLeftResizer","dragBottomRightResizePaneCornerResizer","handler","pane1","pane2","pane3","bottomRightResizePaneTopResizer","bottomRightResizePaneLeftResizer","bottomRightResizePaneCornerResizer","pane1Min","minSize","pane2Min","dragSplitPaneResizer","drag","after","ev","bounds","getBoundingClientRect","bottom","clientY","clientX","require","bgSplitterCtrl","typeclass","drawSsffTrackMarkup","HierarchyLayoutService","vertical","playing","selectedItem","cLAD","debug","selectVisibleNodes","render","centerNode","node","_x","_y","svg","transition","getOrientatedTransform","zoomListener","translate","transform","getOrientatedNodeTransform","getNodeText","getLevelName","getOrientatedTextAnchor","getOrientatedTextX","getOrientatedTextY","getPath","controlX","_fromX","controlY","_toY","_fromY","_toX","nodeOnClick","isCollapsing","_collapsed","currentDescendant","descendants","findChildren","concat","_collapsedParents","_collapsePosition","nodeOnRightClick","nodeOnMouseOver","timeInfoLevel","currentItem","timeInfoType","firstTimeItem","lastTimeItem","itemList","startSample","rootLevelItems","_visible","margin","d3","format","behavior","scaleExtent","on","append","nodes","calculateWeightsBottomUp","levelItems","ii","allLinks","parentElement","depthToX","depth","posInLevelToY","posInLevel","_depth","_posInLevel","_fromDepth","_fromPosInLevel","_toDepth","_toPosInLevel","dataSet","selectAll","newNodes","enter","oldNodes","exit","getOrientatedTextTransform","classed","linkSet","newLinks","oldLinks","insert","resizeHierarchy","drawEpgGrid","binValStrArr","gridWidth","gridHeight","sInterv","curFrame","elIdx","split","reverse","binStr","binStrIdx","setGlobalMinMaxVals","dD","twoDimCanvases","twoDimDrawingDefinitions","dots","trConf","xSsffTrack","xCol","globalMinX","globalMaxX","ySsffTrack","yCol","globalMinY","globalMaxY","drawDots","tw","xsRaSt","ysRaSt","curMousePosTime","degrees","rotate","allDots","xContourNr","yContourNr","startPoint","endPoint","f","connectLines","fromDot","toDot","dragEnterLeave","dropClass","handleDragOver","dropAllowed","dropFiles","dropParsingStarted","File","FileList","dt","dataTransfer","files","webkitGetAsEntry","dropErrorFileType","dropErrorAPI","dropNotAllowed","handleFilesonChange","loadedFiles","fileDialog","schemasJsos","names","proms","all","schemaArr","schemaName","schema","tv4","validate","rotated","paths","possible","possibleAsStr","selected","findPaths","arr","arrIdx","join","getSelIdx","selIdx","rotateHierarchy","getRotation","playSelection","getPlaying","isCurrentAttrDef","attrDef","setCurrentAttrDef","getAllAttrDefs","levDef","parentsFound","findParentLevels","childLevel","parents","linkDefinitions","sublevelName","superlevelName","layoutNonItemLevel","levelDepth","layoutItemLevel","selectedPath","firstChild","lastChild","findParents","_parents","_weight","itemWeight","startLevel","nodeID","currentLevel","li","it","foooooooo","sortTree","toggleChildren","_children","defaultPrevented","source","levelWidth","childCount","tree","root","newHeight","viewerWidth","maxLabelLength","svgGroup","nodeEnter","y0","x0","overCircle","outCircle","nodeUpdate","nodeExit","o","diagonal","_visited","layout","myLayout","viewerHeight","projection","baseSvg","convertToAbsValues","multiplyEachElement","interp2points","x1","y1","findMinMax","minOrMax","flattenArrayOfArray","arrOfArrs","merged","xyArray","verticalPosSsffTrackName","vTrackName","velocitySsffTrackName","vTr","vCol","flatColVals","flatVcolVals","gdat","NaN","vdat","ndat","cdat","startTimeSel","endTimeSel","selCol","selVCol","maxVerticalPos","maxVelBeforeMaxConstr","minVelBeforeMaxVel","interactiveFindThresholds","threshold","on20","minVelBetwMaxVel1maxConstr","minp","off20","maxVelAfterMaxConstr","minBetwMaxConstrMaxVelConstr","minVelAfterMaxVelAfterConstr","curLabel","gestureOnOffsetLabels","gdat0insPoint","gdat1insPoint","maxVelocityOnOffsetLabels","vdat0insPoint","vdat1insPoint","constrictionPlateauBeginEndLabels","ndat0insPoint","ndat1insPoint","maxConstrictionLabel","cdat0insPoint","linkLevelName","autoLinkLevelName","linkLevelDetails","linkLevelLabels","itemIdx","direction","description","thdat","thdir","xx","lx","xsh","loguk","higuk","vz","anavv","infos","thresholdIdx","thresholdValue","ap","linear","range","xAxis","axis","tickSize","tickSubdivide","yAxis","orient","lineFunc","line","interpolate","domain","x2","y2"],"mappings":"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","sourcesContent":["'use strict';\n//expand ArrayBuffer with subarray function\nArrayBuffer.prototype.subarray = function (offset, length) {\n  var sub = new ArrayBuffer(length);\n  var subView = new Int8Array(sub);\n  var thisView = new Int8Array(this);\n  for (var i = 0; i < length; i++) {\n    subView[i] = thisView[offset + i];\n  }\n  return sub;\n};\n'use strict';\nangular.module('emuwebApp', [\n  'ui',\n  'ui.bootstrap',\n  'ngAnimate'\n]).config([\n  '$locationProvider',\n  function ($locationProvider) {\n    // $routeProvider\n    //   .when('/', {\n    //     templateUrl: 'views/main.html'\n    //   })\n    //   .otherwise({\n    //     redirectTo: '/'\n    //   });\n    $locationProvider.html5Mode(true);\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ConfigProviderService', [\n  'viewState',\n  function (viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.vals = {};\n    sServObj.curDbConfig = {};\n    // embedded values -> if these are set this overrides the normal config  \n    sServObj.embeddedVals = {\n      audioGetUrl: '',\n      labelGetUrl: '',\n      labelType: '',\n      fromUrlParams: false\n    };\n    /**\n\t\t * depth of 2 = max\n\t\t */\n    sServObj.setVals = function (data) {\n      if ($.isEmptyObject(sServObj.vals)) {\n        sServObj.vals = data;\n      } else {\n        angular.forEach(Object.keys(data), function (key1) {\n          // if array... overwrite entire thing!\n          if (angular.isArray(sServObj.vals[key1])) {\n            //empty array\n            sServObj.vals[key1] = [];\n            angular.forEach(data[key1], function (itm) {\n              sServObj.vals[key1].push(itm);\n            });\n          } else {\n            angular.forEach(Object.keys(data[key1]), function (key2) {\n              if (sServObj.vals[key1][key2] !== undefined) {\n                sServObj.vals[key1][key2] = data[key1][key2];\n              } else {\n                console.error('BAD ENTRY IN CONFIG! Key1: ' + key1 + ' key2: ' + key2);\n              }\n            });\n          }\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSsffTrackConfig = function (name) {\n      var res;\n      if (sServObj.curDbConfig.ssffTrackDefinitions !== undefined) {\n        angular.forEach(sServObj.curDbConfig.ssffTrackDefinitions, function (tr) {\n          if (tr.name === name) {\n            res = tr;\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLimsOfTrack = function (trackName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourLims, function (cL) {\n        if (cL.ssffTrackName === trackName) {\n          res = cL;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getContourColorsOfTrack = function (trackName) {\n      var res;\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors, function (cC) {\n        if (cC.ssffTrackName === trackName) {\n          res = cC;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAssignment = function (signalName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign, function (a) {\n        if (a.signalCanvasName === signalName) {\n          res = a;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLevelDefinition = function (levelName) {\n      var res = {};\n      angular.forEach(sServObj.curDbConfig.levelDefinitions, function (ld) {\n        if (ld.name === levelName) {\n          res = ld;\n        }\n      });\n      return res;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('MainCtrl', [\n  '$scope',\n  '$rootScope',\n  '$modal',\n  '$log',\n  '$compile',\n  '$timeout',\n  '$q',\n  '$window',\n  '$document',\n  '$location',\n  'viewState',\n  'HistoryService',\n  'Iohandlerservice',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'fontScaleService',\n  'Ssffdataservice',\n  'LevelService',\n  'dialogService',\n  'Textgridparserservice',\n  'Espsparserservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Ssffparserservice',\n  'Drawhelperservice',\n  'Validationservice',\n  'Appcachehandler',\n  function ($scope, $rootScope, $modal, $log, $compile, $timeout, $q, $window, $document, $location, viewState, HistoryService, Iohandlerservice, Soundhandlerservice, ConfigProviderService, fontScaleService, Ssffdataservice, LevelService, dialogService, Textgridparserservice, Espsparserservice, Binarydatamaniphelper, Wavparserservice, Ssffparserservice, Drawhelperservice, Validationservice, Appcachehandler) {\n    // hook up services to use abbreviated forms\n    $scope.cps = ConfigProviderService;\n    $scope.hists = HistoryService;\n    $scope.fontImage = fontScaleService;\n    $scope.levServ = LevelService;\n    $scope.vs = viewState;\n    $scope.dials = dialogService;\n    $scope.ssffds = Ssffdataservice;\n    $scope.shs = Soundhandlerservice;\n    $scope.dhs = Drawhelperservice;\n    $scope.wps = Wavparserservice;\n    $scope.io = Iohandlerservice;\n    $scope.ach = Appcachehandler;\n    // init vars\n    $scope.connectBtnLabel = 'connect';\n    $scope.tmp = {};\n    $scope.dbLoaded = false;\n    $scope.is2dCancasesHidden = true;\n    //$scope.lastkeycode = 'N/A';\n    $scope.bundleList = [];\n    $scope.curUserName = '';\n    $scope.curBndl = {};\n    $scope.lastclickedutt = null;\n    $scope.filterText = '';\n    $scope.windowWidth = $window.outerWidth;\n    $scope.demoDbName = '';\n    $scope.firefox = navigator.userAgent.match(/Firefox/i) ? true : false;\n    // check for new version\n    $scope.ach.checkForNewVersion();\n    //////////////\n    // bindings\n    // bind window resize event\n    angular.element($window).bind('resize', function () {\n      LevelService.deleteEditArea();\n      viewState.setWindowWidth($window.outerWidth);\n      $scope.$digest();\n    });\n    // bind shift/alt keyups for history\n    angular.element($window).bind('keyup', function (e) {\n      if (e.keyCode === ConfigProviderService.vals.keyMappings.shift || e.keyCode === ConfigProviderService.vals.keyMappings.alt) {\n        HistoryService.addCurChangeObjToUndoStack();\n        $scope.$digest();\n      }\n    });\n    // Take care of preventing navigation out of app (only if something is loaded, not in embedded mode and not developing (auto connecting))\n    window.onbeforeunload = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl === '' && $scope.bundleList.length > 0 && !ConfigProviderService.vals.main.autoConnect) {\n        return 'Do you really wish to leave/reload the EMU-webApp? All unsaved changes will be lost...';\n      }\n    };\n    //////////////\n    // watches\n    // watch if embedded override (if attributes are set on emuwebapp tag)\n    // $scope.$watch('cps.embeddedVals.audioGetUrl', function (val) {\n    // \tif (val !== undefined && val !== '') {\n    // \t\t// check if both are set\n    // \t\t$scope.loadFilesForEmbeddedApp();\n    // \t}\n    // }, true);\n    //\n    //////////////\n    /////////////\n    // listens\n    // listen for connectionDisrupted event -> I don't like listens but in this case it might me the way to go...\n    $scope.$on('connectionDisrupted', function (event, args) {\n      $scope.resetToInitState();\n    });\n    //\n    ////////////\n    // check if URL parameters are set -> if so set embedded flags!\n    var searchObject = $location.search();\n    if (searchObject['audioGetUrl'] && searchObject['labelGetUrl'] && searchObject['labelType']) {\n      ConfigProviderService.embeddedVals.audioGetUrl = searchObject.audioGetUrl;\n      ConfigProviderService.embeddedVals.labelGetUrl = searchObject.labelGetUrl;\n      ConfigProviderService.embeddedVals.labelType = searchObject.labelType;\n      ConfigProviderService.embeddedVals.fromUrlParams = true;\n    }\n    ;\n    /**\n\t\t *\n\t\t */\n    $scope.loadFilesForEmbeddedApp = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl) {\n        Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.audioGetUrl, 'arraybuffer').then(function (data) {\n          viewState.showDropZone = false;\n          // set bundle name\n          var tmp = ConfigProviderService.embeddedVals.audioGetUrl;\n          $scope.curBndl.name = tmp.substr(0, tmp.lastIndexOf('.')).substr(tmp.lastIndexOf('/') + 1, tmp.length);\n          //hide menu\n          if (viewState.getsubmenuOpen()) {\n            viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n          }\n          viewState.somethingInProgressTxt = 'Loading DB config...';\n          // then get the DBconfigFile\n          Iohandlerservice.httpGetPath('configFiles/embedded_emuwebappConfig.json').then(function (resp) {\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n            // validate emuwebappConfigSchema\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              // turn of keybinding only on mouseover\n              if (ConfigProviderService.embeddedVals.fromUrlParams) {\n                ConfigProviderService.vals.main.catchMouseForKeyBinding = false;\n              }\n              ConfigProviderService.curDbConfig = resp.data;\n              // validate DBconfigFileSchema!\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // set wav file\n                viewState.somethingInProgress = true;\n                viewState.somethingInProgressTxt = 'Parsing WAV file...';\n                Wavparserservice.parseWavArrBuf(data.data).then(function (messWavParser) {\n                  var wavJSO = messWavParser;\n                  viewState.curViewPort.sS = 0;\n                  viewState.curViewPort.eS = wavJSO.Data.length;\n                  viewState.resetSelect();\n                  Soundhandlerservice.wavJSO = wavJSO;\n                  // get + parse file\n                  Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.labelGetUrl, 'utf-8').then(function (data2) {\n                    viewState.somethingInProgressTxt = 'Parsing ' + ConfigProviderService.embeddedVals.labelType + ' file...';\n                    Iohandlerservice.parseLabelFile(data2.data, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTextGrid', ConfigProviderService.embeddedVals.labelType).then(function (parseMess) {\n                      var annot = parseMess.data;\n                      LevelService.setData(annot);\n                      var lNames = [];\n                      var levelDefs = [];\n                      annot.levels.forEach(function (l) {\n                        lNames.push(l.name);\n                        levelDefs.push({\n                          'name': l.name,\n                          'type': l.type,\n                          'attributeDefinitions': {\n                            'name': l.name,\n                            'type': 'string'\n                          }\n                        });\n                      });\n                      // set level defs\n                      ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n                      viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                      ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n                      viewState.somethingInProgressTxt = 'Done!';\n                      viewState.somethingInProgress = false;\n                      viewState.setState('labeling');\n                    }, function (errMess) {\n                      dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message);\n                    });\n                  }, function (errMess) {\n                    dialogService.open('views/error.html', 'ModalCtrl', 'Could not get label file: ' + ConfigProviderService.embeddedVals.labelGetUrl + ' ERROR ' + JSON.stringify(errMess, null, 4));\n                  });\n                }, function (errMess) {\n                  dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message);\n                });\n              } else {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4));\n              }\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Could not get embedded_config.json: ' + errMess);\n          });\n        }, function (errMess) {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Could not get audio file:' + ConfigProviderService.embeddedVals.audioGetUrl + ' ERROR: ' + JSON.stringify(errMess, null, 4));\n        });\n      }\n    };\n    /**\n\t\t * init load of config files\n\t\t */\n    $scope.loadDefaultConfig = function () {\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading schema files';\n      // load schemas first\n      Validationservice.loadSchemas().then(function (replies) {\n        Validationservice.setSchemas(replies);\n        Iohandlerservice.httpGetDefaultConfig().success(function (data) {\n          viewState.somethingInProgressTxt = 'Validating emuwebappConfig';\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', data);\n          if (validRes === true) {\n            ConfigProviderService.setVals(data);\n            $scope.handleDefaultConfigLoaded();\n            // loadFilesForEmbeddedApp if these are set \n            $scope.loadFilesForEmbeddedApp();\n            viewState.somethingInProgress = false;\n          } else {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error validating emuwebappConfigSchema: ' + JSON.stringify(validRes, null, 4)).then(function () {\n              $scope.resetToInitState();\n            });\n          }\n        }).error(function (data, status, header, config) {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n            $scope.resetToInitState();\n          });\n        });\n      }, function (errMess) {\n        dialogService.open('views/error.html', 'ModalCtrl', 'Error loading schema file: ' + JSON.stringify(errMess, null, 4)).then(function () {\n          $scope.resetToInitState();\n        });\n      });\n    };\n    // call function on init\n    $scope.loadDefaultConfig();\n    /**\n\t\t * function called after default config was loaded\n\t\t */\n    $scope.handleDefaultConfigLoaded = function () {\n      if (!viewState.getsubmenuOpen()) {\n        viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n      }\n      if (ConfigProviderService.vals.main.autoConnect) {\n        Iohandlerservice.wsH.initConnect(ConfigProviderService.vals.main.serverUrl).then(function (message) {\n          if (message.type === 'error') {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.defaultServerUrl);\n          } else {\n            $scope.handleConnectedToWSserver();\n          }\n        });\n      }\n      // init loading of files for testing\n      viewState.setspectroSettings(ConfigProviderService.vals.spectrogramSettings.N, ConfigProviderService.vals.spectrogramSettings.rangeFrom, ConfigProviderService.vals.spectrogramSettings.rangeTo, ConfigProviderService.vals.spectrogramSettings.dynamicRange, ConfigProviderService.vals.spectrogramSettings.window, ConfigProviderService.vals.spectrogramSettings.drawHeatMapColors, ConfigProviderService.vals.spectrogramSettings.preEmphasisFilterFactor, ConfigProviderService.vals.spectrogramSettings.heatMapColorAnchors);\n      // setting transition values\n      viewState.setTransitionTime(ConfigProviderService.vals.colors.transitionTime / 1000);\n    };\n    /**\n\t\t * function is called after websocket connection\n\t\t * has been established. It executes the protocol\n\t\t * and loads the first bundle in the bundle list (= default behavior).\n\t\t */\n    $scope.handleConnectedToWSserver = function () {\n      // hide drop zone \n      viewState.showDropZone = false;\n      ConfigProviderService.vals.main.comMode = 'WS';\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Checking protocol...';\n      // Check if server speaks the same protocol\n      Iohandlerservice.getProtocol().then(function (res) {\n        if (res.protocol === 'EMU-webApp-websocket-protocol' && res.version === '0.0.1') {\n          viewState.somethingInProgressTxt = 'Checking user management...';\n          // then ask if server does user management\n          Iohandlerservice.getDoUserManagement().then(function (doUsrData) {\n            if (doUsrData === 'NO') {\n              $scope.innerHandleConnectedToWSserver();\n            } else {\n              // show user management error \n              dialogService.open('views/loginModal.html', 'LoginCtrl').then(function (res) {\n                if (res) {\n                  $scope.innerHandleConnectedToWSserver();\n                } else {\n                  $scope.resetToInitState();\n                }\n              });\n            }\n          });\n        } else {\n          // show protocol error and disconnect from server\n          dialogService.open('views/error.html', 'ModalCtrl', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl + '. It does not speak the same protocol as this client. Its protocol answer was: \"' + res.protocol + '\" with the version: \"' + res.version + '\"').then(function () {\n            $scope.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t * to avoid redundant code...\n\t\t */\n    $scope.innerHandleConnectedToWSserver = function () {\n      viewState.somethingInProgressTxt = 'Loading DB config...';\n      // then get the DBconfigFile\n      Iohandlerservice.getDBconfigFile().then(function (data) {\n        // first element of perspectives is default perspective\n        viewState.curPerspectiveIdx = 0;\n        ConfigProviderService.setVals(data.EMUwebAppConfig);\n        delete data.EMUwebAppConfig;\n        // delete to avoid duplicate\n        var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n        if (validRes === true) {\n          ConfigProviderService.curDbConfig = data;\n          viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n          validRes = Validationservice.validateJSO('DBconfigFileSchema', data);\n          if (validRes === true) {\n            // then get the DBconfigFile\n            viewState.somethingInProgressTxt = 'Loading bundle list...';\n            Iohandlerservice.getBundleList().then(function (bdata) {\n              validRes = Validationservice.validateJSO('bundleListSchema', bdata);\n              if (validRes === true) {\n                $scope.bundleList = bdata;\n                // then load first bundle in list\n                $scope.menuBundleClick($scope.bundleList[0]);\n              } else {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                  $scope.resetToInitState();\n                });\n              }\n            });\n          } else {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n              $scope.resetToInitState();\n            });\n          }\n        } else {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n            $scope.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t * Handle click on bundle in side menu. It is\n\t\t * also used as a general loadBundle method.\n\t\t * @param bndl object containing name attribute of currently loaded bundle\n\t\t */\n    $scope.menuBundleClick = function (bndl) {\n      // check if bndl has to be saved\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        if (bndl !== $scope.curBndl) {\n          $scope.lastclickedutt = bndl;\n          dialogService.open('views/saveChanges.html', 'ModalCtrl', bndl.name).then(function (messModal) {\n            if (messModal === 'saveChanges') {\n              // save current bundle\n              $scope.menuBundleSaveBtnClick().then(function () {\n                // load new bundle\n                $scope.menuBundleClick(bndl);\n              });\n            } else if (messModal === 'discardChanges') {\n              // reset history\n              HistoryService.resetToInitState();\n              // load new bundle\n              $scope.menuBundleClick(bndl);\n            }\n          });\n        }\n      } else {\n        if (bndl !== $scope.curBndl) {\n          // reset history\n          HistoryService.resetToInitState();\n          // set state\n          viewState.setState('loadingSaving');\n          viewState.somethingInProgress = true;\n          viewState.somethingInProgressTxt = 'Loading bundle: ' + bndl.name;\n          // empty ssff files\n          Ssffdataservice.data = [];\n          Iohandlerservice.getBundle(bndl.name, $scope.demoDbName).then(function (bundleData) {\n            // check if response from http request\n            if (bundleData.status === 200) {\n              bundleData = bundleData.data;\n            }\n            var arrBuff;\n            // set wav file\n            arrBuff = Binarydatamaniphelper.base64ToArrayBuffer(bundleData.mediaFile.data);\n            viewState.somethingInProgressTxt = 'Parsing WAV file...';\n            Wavparserservice.parseWavArrBuf(arrBuff).then(function (messWavParser) {\n              var wavJSO = messWavParser;\n              viewState.curViewPort.sS = 0;\n              viewState.curViewPort.eS = wavJSO.Data.length;\n              viewState.curViewPort.selectS = -1;\n              viewState.curViewPort.selectE = -1;\n              viewState.curClickSegments = [];\n              viewState.curClickLevelName = undefined;\n              viewState.curClickLevelType = undefined;\n              viewState.resetSelect();\n              // FOR DEVELOPMENT:\n              // viewState.curViewPort.sS = 52063;\n              // viewState.curViewPort.eS = 52100;\n              // viewState.curViewPort.selectS = 27575;\n              // viewState.curViewPort.selectE = 34538;\n              Soundhandlerservice.wavJSO = wavJSO;\n              // set all ssff files\n              viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n              Ssffparserservice.asyncParseSsffArr(bundleData.ssffFiles).then(function (ssffJso) {\n                Ssffdataservice.data = ssffJso.data;\n                var validRes = Validationservice.validateJSO('annotationFileSchema', bundleData.annotation);\n                if (validRes === true) {\n                  // set annotation\n                  LevelService.setData(bundleData.annotation);\n                  $scope.curBndl = bndl;\n                  viewState.setState('labeling');\n                  viewState.somethingInProgress = false;\n                  viewState.somethingInProgressTxt = 'Done!';  // FOR DEVELOPMENT:\n                                                               // $scope.menuBundleSaveBtnClick(); // for testing save button\n                                                               // $scope.showHierarchyBtnClick(); // for devel of showHierarchy modal\n                                                               // $scope.spectSettingsBtnClick(); // for testing spect settings dial\n                } else {\n                  dialogService.open('views/error.html', 'ModalCtrl', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                    $scope.resetToInitState();\n                  });\n                }\n              }, function (errMess) {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing SSFF file: ' + errMess.status.message).then(function () {\n                  $scope.resetToInitState();\n                });\n              });\n            }, function (errMess) {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message).then(function () {\n                $scope.resetToInitState();\n              });\n            });\n          }, function (errMess) {\n            // check for http vs websocket response\n            if (errMess.data) {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error loading bundle: ' + errMess.data).then(function () {\n                $scope.resetToInitState();\n              });\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error loading bundle: ' + errMess.status.message).then(function () {\n                $scope.resetToInitState();\n              });\n            }\n          });\n        }\n      }\n    };\n    /**\n\t\t * Handle save bundle button click. The function is also used\n\t\t * as a gerneral purpose save bundle function.\n\t\t * @return promise that is resolved after completion (rejected on error)\n\t\t */\n    $scope.menuBundleSaveBtnClick = function () {\n      // check if something has changed\n      // if (HistoryService.movesAwayFromLastSave !== 0) { // Commented out FOR DEVELOPMENT!\n      if (viewState.getPermission('saveBndlBtnClick')) {\n        var defer = $q.defer();\n        viewState.somethingInProgress = true;\n        viewState.setState('loadingSaving');\n        //create bundle json\n        var bundleData = {};\n        viewState.somethingInProgressTxt = 'Creating bundle json...';\n        bundleData.ssffFiles = [];\n        var formants = {};\n        // ssffFiles (only FORMANTS are allowed to be manipulated so only this track is sent back to server)\n        Ssffdataservice.data.forEach(function (el) {\n          if (el.ssffTrackName === 'FORMANTS') {\n            formants = el;\n          }\n        });\n        if (!$.isEmptyObject(formants)) {\n          Ssffparserservice.asyncJso2ssff(formants).then(function (messParser) {\n            bundleData.ssffFiles.push({\n              'ssffTrackName': formants.ssffTrackName,\n              'encoding': 'BASE64',\n              'data': Binarydatamaniphelper.arrayBufferToBase64(messParser.data)\n            });\n            $scope.getAnnotationAndSaveBndl(bundleData, defer);\n          }, function (errMess) {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error converting javascript object to SSFF file: ' + errMess.status.message);\n            defer.reject();\n          });\n        } else {\n          $scope.getAnnotationAndSaveBndl(bundleData, defer);\n        }\n        return defer.promise;  // } // Commented out FOR DEVELOPMENT!\n      } else {\n        $log.info('Action: menuBundleSaveBtnClick not allowed!');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getAnnotationAndSaveBndl = function (bundleData, defer) {\n      // annotation\n      bundleData.annotation = LevelService.getData();\n      viewState.somethingInProgressTxt = 'Saving bundle...';\n      Iohandlerservice.saveBundle(bundleData).then(function () {\n        viewState.somethingInProgressTxt = 'Done!';\n        viewState.somethingInProgress = false;\n        HistoryService.movesAwayFromLastSave = 0;\n        defer.resolve();\n        viewState.setState('labeling');\n      }, function (errMess) {\n        // console.log(mess);\n        dialogService.open('views/error.html', 'ModalCtrl', 'Error saving bundle: ' + errMess.status.message).then(function () {\n          $scope.resetToInitState();\n        });\n        defer.reject();\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.uttIsDisabled = function (bndl) {\n      if (bndl.name === $scope.curBndl.name) {\n        return false;\n      } else {\n        return true;\n      }\n    };\n    $scope.getEnlarge = function (index) {\n      var len = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length;\n      var large = 50;\n      if (viewState.getenlarge() == -1) {\n        return 'auto';\n      } else {\n        if (len === 1) {\n          return 'auto';\n        }\n        if (len === 2) {\n          if (viewState.getenlarge() == index) {\n            return '70%';\n          } else {\n            return '27%';\n          }\n        } else {\n          if (viewState.getenlarge() == index) {\n            return large + '%';\n          } else {\n            return (98 - large) / (len - 1) + '%';\n          }\n        }\n      }\n    };\n    /**\n\t\t * returns jso with css defining color dependent\n\t\t * on if changes have been made that have not been saved\n\t\t * @param bndl object containing name attribute of bundle item\n\t\t * requesting color\n\t\t * @returns color as jso object used by ng-style\n\t\t */\n    $scope.getBndlColor = function (bndl) {\n      var curColor;\n      if (HistoryService.movesAwayFromLastSave !== 0) {\n        curColor = {\n          'background-color': '#f00',\n          'color': 'white'\n        };\n      } else {\n        curColor = {\n          'background-color': '#999',\n          'color': 'black'\n        };\n      }\n      // console.log(bndl.name)\n      if (bndl.name === $scope.curBndl.name) {\n        return curColor;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openSubmenu = function () {\n      viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n    };\n    /////////////////////////////////////////\n    // handle button clicks\n    // top menu:\n    /**\n\t\t *\n\t\t */\n    $scope.insertLevelSegBtnClick = function () {\n      if (viewState.getPermission('addLevelSegBtnClick')) {\n        var length = 0;\n        if (LevelService.data.levels !== undefined) {\n          length = LevelService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [{\n                id: LevelService.getNewId(),\n                sampleStart: 0,\n                sampleDur: Soundhandlerservice.wavJSO.Data.length,\n                labels: [{\n                    name: newName,\n                    value: ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                  }]\n              }],\n            name: newName,\n            type: 'SEGMENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.insertLevelPointBtnClick = function () {\n      if (viewState.getPermission('addLevelPointBtnClick')) {\n        var length = 0;\n        if (LevelService.data.levels !== undefined) {\n          length = LevelService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [{\n                id: LevelService.getNewId(),\n                samplePoint: Math.round(Soundhandlerservice.wavJSO.Data.length / 2),\n                labels: []\n              }],\n            name: newName,\n            type: 'EVENT'\n          };\n        level.items[0].labels.push({\n          name: newName,\n          value: ConfigProviderService.vals.labelCanvasConfig.newEventName\n        });\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.renameSelLevelBtnClick = function () {\n      if (viewState.getPermission('renameSelLevelBtnClick')) {\n        if (viewState.getcurClickLevelName() !== undefined) {\n          dialogService.open('views/renameLevel.html', 'ModalCtrl', viewState.getcurClickLevelName());\n        } else {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Rename Error : Please choose a Level first !');\n        }\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadTextGridBtnClick = function () {\n      if (viewState.getPermission('downloadTextGridBtnClick')) {\n        Textgridparserservice.asyncToTextGrid().then(function (parseMess) {\n          dialogService.openExport('views/export.html', 'ExportCtrl', parseMess.data, $scope.curBndl.name + '.TextGrid');\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.spectSettingsBtnClick = function () {\n      if (viewState.getPermission('spectSettingsChange')) {\n        dialogService.open('views/spectSettings.html', 'spectSettingsCtrl', '');\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.connectBtnClick = function () {\n      if (viewState.getPermission('connectBtnClick')) {\n        dialogService.open('views/connectModal.html', 'WsconnectionCtrl').then(function (url) {\n          if (url) {\n            Iohandlerservice.wsH.initConnect(url).then(function (message) {\n              if (message.type === 'error') {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Could not connect to websocket server: ' + url);\n              } else {\n                $scope.handleConnectedToWSserver();\n              }\n            });\n          }\n        });\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openDemoDBbtnClick = function (nameOfDB) {\n      if (viewState.getPermission('openDemoBtnDBclick')) {\n        $scope.demoDbName = nameOfDB;\n        // hide drop zone \n        viewState.showDropZone = false;\n        viewState.somethingInProgress = true;\n        // alert(nameOfDB);\n        viewState.setState('loadingSaving');\n        ConfigProviderService.vals.main.comMode = 'DEMO';\n        viewState.somethingInProgressTxt = 'Loading DB config...';\n        Iohandlerservice.getDBconfigFile(nameOfDB).then(function (res) {\n          var data = res.data;\n          // first element of perspectives is default perspective\n          viewState.curPerspectiveIdx = 0;\n          ConfigProviderService.setVals(data.EMUwebAppConfig);\n          delete data.EMUwebAppConfig;\n          // delete to avoid duplicate\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n          if (validRes === true) {\n            ConfigProviderService.curDbConfig = data;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n            if (validRes === true) {\n              // then get the DBconfigFile\n              viewState.somethingInProgressTxt = 'Loading bundle list...';\n              Iohandlerservice.getBundleList(nameOfDB).then(function (res) {\n                var bdata = res.data;\n                validRes = Validationservice.validateJSO('bundleListSchema', bdata);\n                if (validRes === true) {\n                  $scope.bundleList = bdata;\n                  // then load first bundle in list\n                  $scope.menuBundleClick($scope.bundleList[0]);\n                } else {\n                  dialogService.open('views/error.html', 'ModalCtrl', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                    $scope.resetToInitState();\n                  });\n                }\n              }, function (err) {\n                dialogService.open('views/error.html', 'ModalCtrl', 'Error loading bundle list of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n                  $scope.resetToInitState();\n                });\n              });\n            } else {\n              dialogService.open('views/error.html', 'ModalCtrl', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                $scope.resetToInitState();\n              });\n            }\n          } else {\n            dialogService.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n              $scope.resetToInitState();\n            });\n          }\n        }, function (err) {\n          dialogService.open('views/error.html', 'ModalCtrl', 'Error loading DB config of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n            $scope.resetToInitState();\n          });\n        });\n      }  //else {\n         // \tconsole.log('action currently not allowed');\n         // }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.aboutBtnClick = function () {\n      dialogService.open('views/about.html', 'AboutCtrl');\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showHierarchyBtnClick = function () {\n      dialogService.open('views/showHierarchyModal.html', 'ShowhierarchyCtrl');\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.clearBtnClick = function () {\n      // viewState.setdragBarActive(false);\n      var modalText;\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.';\n      } else {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? You have NO unsaved changes so no changes will be lost.';\n      }\n      dialogService.open('views/confirmModal.html', 'ConfirmmodalCtrl', modalText).then(function (res) {\n        if (res) {\n          $scope.resetToInitState();\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.resetToInitState = function () {\n      if (Iohandlerservice.wsH.isConnected()) {\n        Iohandlerservice.wsH.disconnectWarning().then(function (resp) {\n          $log.info('Closing websocket connection to server');\n          Iohandlerservice.wsH.closeConnect();\n        });\n      }\n      $scope.curBndl = {};\n      $scope.bundleList = [];\n      Soundhandlerservice.wavJSO = {};\n      LevelService.data = {};\n      Ssffdataservice.data = [];\n      HistoryService.resetToInitState();\n      viewState.setState('noDBorFilesloaded');\n      $scope.$broadcast('resetToInitState');\n      viewState.somethingInProgress = false;\n      viewState.resetToInitState();\n      viewState.showDropZone = true;\n      $scope.loadDefaultConfig();\n    };\n    // bottom menu:\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomAll = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomIn = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(true);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomOut = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(false);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomLeft = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(false);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomRight = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(true);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomSel = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayView = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlaySel = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n        viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayAll = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n        viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n        console.log('action currently not allowed');\n      }\n    };\n    ///////////////////////////\n    // other\n    /**\n\t\t * function used to change perspective\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.changePerspective = function (persp) {\n      var newIdx;\n      for (var i = 0; i < ConfigProviderService.vals.perspectives.length; i++) {\n        if (persp.name === ConfigProviderService.vals.perspectives[i].name) {\n          newIdx = i;\n        }\n      }\n      viewState.curPerspectiveIdx = newIdx;\n      // close submenu\n      viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n    };\n    /**\n\t\t * function used by right side menu to get color of current perspecitve in ul\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.getPerspectiveColor = function (persp) {\n      var cl;\n      if (viewState.curPerspectiveIdx === -1 || persp.name === ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].name) {\n        cl = 'emuwebapp-curSelPerspLi';\n      } else {\n        cl = 'emuwebapp-perspLi';\n      }\n      return cl;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('FileCtrl', [\n  '$scope',\n  'Binarydatamaniphelper',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Validationservice',\n  function ($scope, Binarydatamaniphelper, Textgridparserservice, ConfigProviderService, Validationservice) {\n    $scope.newfiles = [];\n    $scope.wav = {};\n    $scope.grid = {};\n    $scope.curBndl = {};\n    $scope.resetToInitState = function () {\n      $scope.newfiles = [];\n      $scope.wav = {};\n      $scope.grid = {};\n      $scope.curBndl = {};\n      $scope.dropText = $scope.dropDefault;\n    };\n    $scope.$on('resetToInitState', function () {\n      $scope.resetToInitState();\n    });\n    $scope.handleLocalFiles = function () {\n      $scope.$parent.vs.showDropZone = false;\n      $scope.$parent.cps.vals.main.comMode = 'FileAPI';\n      $scope.$parent.vs.setState('loadingSaving');\n      // reset history\n      $scope.$parent.hists.resetToInitState();\n      $scope.$parent.vs.somethingInProgress = true;\n      $scope.$parent.vs.somethingInProgressTxt = 'Loading local File: ' + $scope.wav.name;\n      // empty ssff files\n      $scope.$parent.ssffds.data = [];\n      $scope.$parent.levServ.data = {};\n      //arrBuff = Binarydatamaniphelper.base64ToArrayBuffer(bundleData.mediaFile.data);\n      $scope.$parent.vs.somethingInProgressTxt = 'Parsing WAV file...';\n      var reader = new FileReader();\n      reader.readAsArrayBuffer($scope.wav);\n      reader.onloadend = function (evt) {\n        if (evt.target.readyState == FileReader.DONE) {\n          $scope.$parent.io.httpGetPath('configFiles/standalone_emuwebappConfig.json').then(function (resp) {\n            // first element of perspectives is default perspective\n            $scope.$parent.vs.curPerspectiveIdx = 0;\n            $scope.$parent.cps.setVals(resp.data.EMUwebAppConfig);\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              $scope.$parent.cps.curDbConfig = resp.data;\n              $scope.curBndl = {};\n              $scope.curBndl.name = $scope.wav.name.substr(0, $scope.wav.name.lastIndexOf('.'));\n              $scope.$parent.bundleList.push($scope.curBndl);\n              $scope.$parent.curBndl = $scope.curBndl;\n              // then get the DBconfigFile\n              var res;\n              if ($scope.firefox) {\n                res = evt.target.result;\n              } else {\n                res = evt.currentTarget.result;\n              }\n              $scope.$parent.wps.parseWavArrBuf(res).then(function (wavJSO) {\n                $scope.$parent.vs.curViewPort.sS = 0;\n                $scope.$parent.vs.curViewPort.eS = wavJSO.Data.length;\n                $scope.$parent.vs.resetSelect();\n                $scope.$parent.vs.curPerspectiveIdx = 0;\n                $scope.$parent.shs.wavJSO = wavJSO;\n                // parsing of Textgrid Data\n                if (!$.isEmptyObject($scope.grid)) {\n                  var reader = new FileReader();\n                  reader.readAsText($scope.grid);\n                  reader.onloadend = function (evt) {\n                    if (evt.target.readyState == FileReader.DONE) {\n                      var extension = $scope.wav.name.substr(0, $scope.wav.name.lastIndexOf('.'));\n                      Textgridparserservice.asyncParseTextGrid(evt.currentTarget.result, $scope.wav.name, extension).then(function (parseMess) {\n                        var annot = parseMess.data;\n                        $scope.$parent.levServ.setData(annot);\n                        // console.log(JSON.stringify(l, undefined, 2));\n                        var lNames = [];\n                        var levelDefs = [];\n                        annot.levels.forEach(function (l) {\n                          lNames.push(l.name);\n                          levelDefs.push({\n                            'name': l.name,\n                            'type': l.type,\n                            'attributeDefinitions': {\n                              'name': l.name,\n                              'type': 'string'\n                            }\n                          });\n                        });\n                        // set level defs\n                        $scope.$parent.cps.curDbConfig.levelDefinitions = levelDefs;\n                        $scope.$parent.vs.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                        $scope.$parent.cps.vals.perspectives[$scope.$parent.vs.curPerspectiveIdx].levelCanvases.order = lNames;\n                        $scope.$parent.vs.somethingInProgressTxt = 'Done!';\n                        $scope.$parent.vs.somethingInProgress = false;\n                        $scope.$parent.vs.setState('labeling');\n                      });\n                    }\n                  }, function (errMess) {\n                    $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error parsing textgrid file: ' + errMess.status.message);\n                  };\n                } else {\n                  $scope.$parent.vs.setState('labeling');\n                  $scope.$parent.vs.somethingInProgress = false;\n                  $scope.$parent.vs.somethingInProgressTxt = 'Done!';\n                }\n              });\n            } else {\n              $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error validating ConfigProviderService.vals (emuwebappConfig data) : ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error parsing wav file: ' + errMess.status.message);\n          });\n        }\n      };\n    };\n    $scope.traverseFileTreeChrome = function (item, path) {\n      path = path || '';\n      if (item.isFile) {\n        item.file(function (file) {\n          var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n          if (extension === 'WAV') {\n            $scope.wav = file;\n            $scope.handleLocalFiles();\n          } else if (extension === 'TEXTGRID') {\n            $scope.grid = file;\n          } else {\n            $scope.other = file;\n            $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + $scope.other.name).then(function (res) {\n              $scope.resetToInitState();\n              $scope.$parent.resetToInitState();\n            });\n          }\n        });\n      } else if (item.isDirectory) {\n        var dirReader = item.createReader();\n        dirReader.readEntries(function (entries) {\n          for (var i = 0; i < entries.length; i++) {\n            $scope.traverseFileTreeChrome(entries[i], path + item.name + '/');\n          }\n        });\n      }\n    };\n    $scope.traverseFileTreeFirefox = function (item, path) {\n      path = path || '';\n      if (item.size > 0) {\n        var extension = item.name.substr(item.name.lastIndexOf('.') + 1).toUpperCase();\n        if (extension === 'WAV') {\n          $scope.wav = item;\n          $scope.handleLocalFiles();\n        } else if (extension === 'TEXTGRID') {\n          $scope.grid = item;\n        } else {\n          $scope.other = item;\n          $scope.$parent.dials.open('views/error.html', 'ModalCtrl', 'Error: Unknown File Type for File ' + $scope.other.name).then(function (res) {\n            $scope.resetToInitState();\n            $scope.$parent.resetToInitState();\n          });\n        }\n      } else if (item.isDirectory) {\n        var dirReader = item.createReader();\n        dirReader.readEntries(function (entries) {\n          for (var i = 0; i < entries.length; i++) {\n            $scope.traverseFileTreeFirefox(entries[i], path + item.name + '/');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('level', [\n  '$animate',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'HistoryService',\n  'fontScaleService',\n  'dialogService',\n  'LevelService',\n  function ($animate, viewState, ConfigProviderService, Drawhelperservice, HistoryService, fontScaleService, dialogService, LevelService) {\n    return {\n      templateUrl: 'views/level.html',\n      restrict: 'E',\n      scope: {\n        level: '=',\n        idx: '='\n      },\n      link: function postLink(scope, element, attr) {\n        // select the needed DOM items from the template\n        var canvas = element.find('canvas');\n        scope.open = attr.open;\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.dials = dialogService;\n        var levelCanvasContainer = element.find('div');\n        scope.levelDef = ConfigProviderService.getLevelDefinition(scope.level.name);\n        // curAttrDef = scope.level.name;\n        scope.backgroundCanvas = { 'background': ConfigProviderService.vals.colors.levelColor };\n        // on broadcast msg from main ctrl openSubmenu refresh timeline\n        scope.$on('refreshTimeline', function () {\n          drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        });\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS || oldValue.windowWidth !== newValue.windowWidth) {\n            drawLevelDetails(scope.level, viewState, ConfigProviderService);\n            drawLevelMarkup(scope.level, viewState, ConfigProviderService);  //console.log('leveldraw update A');\n          } else {\n            //console.log('leveldraw update B');\n            drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMouseX', function (newValue, oldValue) {\n          // only repaint if mouse over current level\n          if (viewState.getcurMouseLevelName() === scope.level.name) {\n            //if (!oldValue || !newValue || newValue.id !== oldValue.id) {\n            //\tdrawLevelMarkup(scope.level, viewState, ConfigProviderService);\n            //} else {\n            drawLevelDetails(scope.level, viewState, ConfigProviderService);\n            drawLevelMarkup(scope.level, viewState, ConfigProviderService);  //}\n          }\n        }, true);\n        //\n        scope.$watch('vs.curClickLevelName', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n          }\n        }, true);\n        //\n        scope.$watch('vs.movingBoundarySample', function () {\n          drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        }, true);\n        //\n        scope.$watch('vs.movingBoundary', function () {\n          drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        }, true);\n        //\n        scope.$watch('hists.movesAwayFromLastSave', function () {\n          drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        }, true);\n        //\n        /////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.changeCurAttrDef = function (attrDefName, index) {\n          var curAttrDef = viewState.getCurAttrDef(scope.level.name);\n          if (curAttrDef !== attrDefName) {\n            // curAttrDef = attrDefName;\n            viewState.setCurAttrDef(scope.level.name, attrDefName, index);\n            if (!element.hasClass('emuwebapp-levelCanvasContainer-animate')) {\n              viewState.setEditing(false);\n              LevelService.deleteEditArea();\n              $animate.addClass(levelCanvasContainer, 'emuwebapp-levelCanvasContainer-animate', scope.finishedAnim);\n            }\n          }\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.finishedAnim = function () {\n          $animate.removeClass(levelCanvasContainer, 'emuwebapp-levelCanvasContainer-animate');\n          // redraw\n          drawLevelDetails(scope.level, viewState, ConfigProviderService);\n          drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.getAttrDefBtnColor = function (attrDefName) {\n          var curColor;\n          var curAttrDef = viewState.getCurAttrDef(scope.level.name);\n          if (attrDefName === curAttrDef) {\n            curColor = { 'background': '-webkit-radial-gradient(50% 50%, closest-corner, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 60%)' };\n          } else {\n            curColor = { 'background-color': 'white' };\n          }\n          return curColor;\n        };\n        scope.updateView = function () {\n          if ($.isEmptyObject(scope.cps)) {\n            console.log('undef viewState');\n            return;\n          }\n          drawLevelDetails(scope.level, scope.vs, scope.cps);\n        };\n        ///////////////\n        // bindings\n        // on mouse leave reset viewState.\n        element.bind('mouseleave', function () {\n          viewState.setcurMouseSegment(undefined, undefined, undefined);\n          drawLevelMarkup(scope.level, viewState, ConfigProviderService);\n        });\n        /**\n\t\t\t\t * draw level details\n\t\t\t\t * @param levelDetails\n\t\t\t\t * @param viewState\n\t\t\t\t * @param cps\n\t\t\t\t */\n        function drawLevelDetails(levelDetails, viewState, config) {\n          var fontSize = config.vals.font.fontPxSize;\n          var curAttrDef = viewState.getCurAttrDef(scope.level.name);\n          if ($.isEmptyObject(levelDetails)) {\n            console.log('undef levelDetails');\n            return;\n          }\n          if ($.isEmptyObject(viewState)) {\n            console.log('undef viewState');\n            return;\n          }\n          if ($.isEmptyObject(config)) {\n            console.log('undef config');\n            return;\n          }\n          if (!scope.open) {\n            fontSize -= 1;\n          }\n          var ctx = canvas[0].getContext('2d');\n          ctx.clearRect(0, 0, canvas[0].width, canvas[0].height);\n          //predef vars\n          var sDist, posS, posE, horizontalText;\n          sDist = viewState.getSampleDist(canvas[0].width);\n          // draw name of level and type\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          if (levelDetails.name === curAttrDef) {\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, levelDetails.name, '(' + levelDetails.type + ')', fontSize, config.vals.font.fontType, config.vals.colors.labelColor, true);\n          } else {\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, levelDetails.name + ':' + curAttrDef, '(' + levelDetails.type + ')', fontSize, config.vals.font.fontType, config.vals.colors.labelColor, true);\n          }\n          ctx.drawImage(horizontalText, 0, ctx.canvas.height / 2 - fontSize * scaleY);\n          var segMId = viewState.getcurMouseSegment();\n          var segCId = viewState.getcurClickSegments();\n          var levelId = viewState.getcurClickLevelName();\n          var curID = -1;\n          // calculate generic max with of single char (m char used)\n          var mTxtImg = fontScaleService.getTextImage(ctx, 'm', fontSize - 2, config.vals.font.fontType, config.vals.colors.labelColor);\n          var mTxtImgWidth = fontScaleService.getLastImageWidth();\n          // calculate generic max with of single digit (0 digit used)\n          var zeroTxtImg = fontScaleService.getTextImage(ctx, '0', fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n          var zeroTxtImgWidth = fontScaleService.getLastImageWidth();\n          if (levelDetails.type === 'SEGMENT') {\n            ctx.fillStyle = config.vals.colors.startBoundaryColor;\n            // draw segments\n            var e = levelDetails.items;\n            e.forEach(function (curEvt) {\n              ++curID;\n              if (curEvt.sampleStart >= viewState.curViewPort.sS && curEvt.sampleStart <= viewState.curViewPort.eS || curEvt.sampleStart + curEvt.sampleDur > viewState.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur < viewState.curViewPort.eS || curEvt.sampleStart < viewState.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur > viewState.curViewPort.eS) {\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                // draw segment start\n                //posS = Math.round(viewState.getPos(canvas[0].width, curEvt.sampleStart));\n                //posE = Math.round(viewState.getPos(canvas[0].width, curEvt.sampleStart + curEvt.sampleDur+1));\n                posS = viewState.getPos(canvas[0].width, curEvt.sampleStart);\n                posE = viewState.getPos(canvas[0].width, curEvt.sampleStart + curEvt.sampleDur + 1);\n                ctx.fillStyle = config.vals.colors.startBoundaryColor;\n                ctx.fillRect(posS, 0, 2, canvas[0].height / 2);\n                //draw segment end\n                ctx.fillStyle = config.vals.colors.endBoundaryColor;\n                ctx.fillRect(posE, canvas[0].height / 2, 2, canvas[0].height);\n                //check for enough space to stroke text\n                if (curLabVal !== undefined && posE - posS > mTxtImgWidth * curLabVal.length) {\n                  horizontalText = fontScaleService.getTextImage(ctx, curLabVal, fontSize - 2, config.vals.font.fontType, config.vals.colors.labelColor);\n                  var tW = fontScaleService.getLastImageWidth();\n                  var tX = posS + (posE - posS) / 2 - tW / 2;\n                  if (scope.open) {\n                    ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, tX, canvas[0].height / 2 - (fontSize - 2), horizontalText.width, horizontalText.height);\n                  } else {\n                    ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, tX, 0, horizontalText.width, horizontalText.height);\n                  }\n                }\n                // var hst1 = fontScaleService.getLastImageWidth();\n                // var tX1 = posS + (posE - posS) / 2 - hst1 / 2;\n                // var tX2 = posS + (posE - posS) / 2 - hst2 / 2;\n                //draw helper lines\n                if (scope.open) {\n                  var labelCenter = posS + (posE - posS) / 2;\n                  var hlY = canvas[0].height / 4;\n                  // start helper line\n                  ctx.strokeStyle = config.vals.colors.startBoundaryColor;\n                  ctx.beginPath();\n                  ctx.moveTo(posS, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY + 5);\n                  ctx.stroke();\n                  hlY = canvas[0].height / 4 * 3;\n                  // end helper line\n                  ctx.strokeStyle = config.vals.colors.endBoundaryColor;\n                  ctx.beginPath();\n                  ctx.moveTo(posE, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY - 5);\n                  ctx.stroke();\n                }\n                // if (posE - posS <= tW) {\n                // \tctx.strokeStyle = 'red';//config.vals.colors.startBoundaryColor;\n                // \tctx.beginPath();\n                // \tctx.moveTo(tX1 + hst1 / 2, canvas[0].height / 4 + 10);\n                // \tctx.lineTo(tX1 + hst1 / 2, canvas[0].height / 4 + 30);\n                // \tctx.stroke();\n                // }\n                // draw sampleStart numbers\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * curEvt.sampleStart.toString().length) {\n                  var horizontalSubText1 = fontScaleService.getTextImage(ctx, curEvt.sampleStart, fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n                  ctx.drawImage(horizontalSubText1, 0, 0, horizontalText.width, horizontalText.height, posS + 3, 0, horizontalText.width, horizontalText.height);\n                }\n                // draw sampleDur numbers.\n                //sStW = fontScaleService.getLastImageWidth();\n                //var sDtW = ctx.measureText('dur: ' + curEvt.sampleDur).width;\n                //ctx.fillStyle = config.vals.colors.endBoundaryColor;\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * (5 + curEvt.sampleDur.toString().length)) {\n                  var horizontalSubText2 = fontScaleService.getTextImage(ctx, 'dur: ' + curEvt.sampleDur, fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n                  var hst2 = fontScaleService.getLastImageWidth();\n                  ctx.drawImage(horizontalSubText2, 0, 0, horizontalText.width, horizontalText.height, posE - hst2, canvas[0].height / 4 * 3, horizontalText.width, horizontalText.height);  //ctx.fillText('dur: ' + curEvt.sampleDur, posE - sDtW, canvas[0].height - canvas[0].height / 12);\n                }\n              }\n            });\n          } else if (levelDetails.type === 'EVENT') {\n            ctx.fillStyle = config.vals.colors.startBoundaryColor;\n            // predef. vars\n            var perc;\n            levelDetails.items.forEach(function (curEvt) {\n              if (curEvt.samplePoint > viewState.curViewPort.sS && curEvt.samplePoint < viewState.curViewPort.eS) {\n                perc = Math.round(viewState.getPos(canvas[0].width, curEvt.samplePoint) + sDist / 2);\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                ctx.fillStyle = config.vals.colors.startBoundaryColor;\n                ctx.fillRect(perc, 0, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                ctx.fillRect(perc, canvas[0].height / 2 + canvas[0].height / 10, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                horizontalText = fontScaleService.getTextImage(ctx, curLabVal, fontSize - 2, config.vals.font.fontType, config.vals.colors.labelColor);\n                ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, perc - 5, canvas[0].height / 3, horizontalText.width, horizontalText.height);\n                horizontalText = fontScaleService.getTextImage(ctx, curEvt.samplePoint, fontSize - 4, config.vals.font.fontType, config.vals.colors.endBoundaryColor);\n                ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, perc + 5, 0, horizontalText.width, horizontalText.height);\n              }\n            });\n          }  // draw cursor/selected area\n        }\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        function drawLevelMarkup(levelDetails, viewState, config) {\n          var ctx = canvas[1].getContext('2d');\n          ctx.clearRect(0, 0, canvas[1].width, canvas[1].height);\n          if (levelDetails.name === viewState.getcurClickLevelName()) {\n            ctx.fillStyle = config.vals.colors.selectedLevelColor;\n            ctx.fillRect(0, 0, canvas[0].width, canvas[0].height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx);\n          var posS, posE, sDist, xOffset, curEvt;\n          posS = viewState.getPos(canvas[1].width, viewState.curViewPort.selectS);\n          posE = viewState.getPos(canvas[1].width, viewState.curViewPort.selectE);\n          sDist = viewState.getSampleDist(canvas[1].width);\n          var segMId = viewState.getcurMouseSegment();\n          var isFirst = viewState.getcurMouseisFirst();\n          var isLast = viewState.getcurMouseisLast();\n          var clickedSegs = viewState.getcurClickSegments();\n          var levelId = viewState.getcurClickLevelName();\n          if (clickedSegs !== undefined) {\n            // draw clicked on selected areas\n            if (levelDetails.name === levelId && clickedSegs.length > 0) {\n              clickedSegs.forEach(function (cs) {\n                if (cs !== undefined) {\n                  // check if segment or event level\n                  if (cs.sampleStart !== undefined) {\n                    posS = Math.round(viewState.getPos(canvas[0].width, cs.sampleStart));\n                    posE = Math.round(viewState.getPos(canvas[0].width, cs.sampleStart + cs.sampleDur + 1));\n                  } else {\n                    posS = Math.round(viewState.getPos(canvas[0].width, cs.samplePoint) + sDist / 2);\n                    posS = posS - 5;\n                    posE = posS + 10;\n                  }\n                  ctx.fillStyle = config.vals.colors.selectedSegmentColor;\n                  ctx.fillRect(posS, 0, posE - posS, canvas[0].height);\n                  ctx.fillStyle = config.vals.colors.startBoundaryColor;\n                }\n              });\n            }\n          }\n          // draw preselected boundary\n          curEvt = viewState.getcurMouseSegment();\n          if (curEvt !== undefined && segMId !== undefined && levelDetails.name === viewState.getcurMouseLevelName()) {\n            ctx.fillStyle = config.vals.colors.selectedBoundaryColor;\n            if (isFirst === true) {\n              // before first segment\n              if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = levelDetails.items[0];\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else if (isLast === true) {\n              // after last segment\n              if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = levelDetails.items[levelDetails.items.length - 1];\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.sampleStart + curEvt.sampleDur + 1));\n                // +1 because boundaries are drawn on sampleStart\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else {\n              // in the middle\n              if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              } else {\n                posS = Math.round(viewState.getPos(canvas[1].width, curEvt.samplePoint));\n                xOffset = sDist / 2;\n                ctx.fillRect(posS + xOffset, 0, 3, canvas[1].height);\n              }\n            }\n            ctx.fillStyle = config.vals.colors.startBoundaryColor;\n          }\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('osci', [\n  '$timeout',\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  function ($timeout, viewState, Soundhandlerservice, ConfigProviderService, Drawhelperservice) {\n    return {\n      templateUrl: 'views/osci.html',\n      replace: true,\n      restrict: 'E',\n      scope: {},\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.changeAttrDef = function () {\n            alert('sadf');\n          };\n        }\n      ],\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // assign attributes to scope\n        scope.order = attrs.order;\n        scope.trackName = attrs.trackName;\n        scope.cps = ConfigProviderService;\n        scope.viewState = viewState;\n        ///////////////\n        // watches\n        // on broadcast msg from main ctrl openSubmenu refresh timeline\n        scope.$on('refreshTimeline', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        });\n        //\n        scope.$watch('viewState.timelineSize', function () {\n          $timeout(scope.redraw, 10);\n        });\n        //\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          drawVpOsciMarkup(scope, ConfigProviderService, true);\n        }, true);\n        //\n        scope.$watch('viewState.playHeadAnimationInfos', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawPlayHead(scope, ConfigProviderService);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundarySample', function (newValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundary', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n                Drawhelperservice.osciPeaks = allPeakVals;\n                Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n              }\n              drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        /////////////////////////\n        scope.redraw = function () {\n          drawVpOsciMarkup(scope, ConfigProviderService, true);\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        function drawPlayHead(scope, config) {\n          var ctx = markupCanvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          var posS = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.sS);\n          var posCur = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.curS);\n          // console.log(viewState.playHeadAnimationInfos.curS)\n          ctx.fillStyle = ConfigProviderService.vals.colors.selectedAreaColor;\n          ctx.fillRect(posS, 0, posCur - posS, canvas.height);\n          //console.log(posS,posCur);\n          drawVpOsciMarkup(scope, config, false);\n        }\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        function drawVpOsciMarkup(scope, config, reset) {\n          var ctx = markupCanvas.getContext('2d');\n          if (reset) {\n            ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          Drawhelperservice.drawViewPortTimes(ctx, true);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx, true);\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('preview', [\n  'viewState',\n  'Soundhandlerservice',\n  'Drawhelperservice',\n  'ConfigProviderService',\n  function (viewState, Soundhandlerservice, Drawhelperservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/preview.html',\n      restrict: 'E',\n      scope: { currentBundleName: '@' },\n      link: function postLink(scope, element) {\n        // select the needed DOM elements from the template and init vals\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[1];\n        var initialized = false;\n        // hook up scope vars for watches\n        scope.vs = viewState;\n        scope.shs = Soundhandlerservice;\n        scope.backgroundCanvas = {\n          'background': '#eee',\n          'border': '1px solid gray',\n          'width': '100%',\n          'height': '100%'\n        };\n        /////////////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newVal, oldVal) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            if (oldVal.sS !== newVal.sS || oldVal.eS !== newVal.eS) {\n              drawPreview();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('currentBundleName', function () {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            initialized = false;\n            scope.backgroundCanvas = {\n              'background': ConfigProviderService.vals.colors.levelColor,\n              'border': '1px solid gray',\n              'width': '100%',\n              'height': '100%'\n            };\n            drawPreview();\n          }\n          //clear on empty bundle name\n          if (scope.currentBundleName === '') {\n            var ctx = canvas.getContext('2d');\n            var ctxMarkup = markupCanvas.getContext('2d');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctxMarkup.clearRect(0, 0, canvas.width, canvas.height);\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        function drawPreview() {\n          if (!initialized) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n            initialized = true;\n            drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          } else {\n            drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          }\n        }\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        function drawVpOsciMarkup(vs, canvas, config) {\n          var ctx = markupCanvas.getContext('2d');\n          var posS = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.sS;\n          var posE = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.eS;\n          ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          ctx.fillStyle = config.vals.colors.selectedAreaColor;\n          ctx.fillRect(posS, 0, posE - posS, markupCanvas.height);\n          ctx.strokeStyle = config.vals.colors.selectedBorderColor;\n          ctx.beginPath();\n          ctx.moveTo(posS, 0);\n          ctx.lineTo(posS, markupCanvas.height);\n          ctx.moveTo(posE, 0);\n          ctx.lineTo(posE, markupCanvas.height);\n          ctx.closePath();\n          ctx.stroke();\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('bundleListSideBar', [\n  '$animate',\n  'viewState',\n  function ($animate, viewState) {\n    return {\n      templateUrl: 'views/bundleListSideBar.html',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attr) {\n        ////////////////\n        //watches\n        scope.$watch('vs.submenuOpen', function () {\n          if (scope.vs.submenuOpen) {\n            $animate.removeClass(element, 'emuwebapp-shrinkWidthTo0px');\n            $animate.addClass(element, 'emuwebapp-expandWidthTo240px');\n          } else {\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        }, true);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('spectro', [\n  '$timeout',\n  'fontScaleService',\n  function ($timeout, fontScaleService) {\n    return {\n      templateUrl: 'views/spectro.html',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        scope.order = attrs.order;\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var canvas0 = element.find('canvas')[0];\n        var canvas1 = element.find('canvas')[canvasLength - 1];\n        // FFT default vars\n        var alpha = 0.16;\n        // default alpha for Window Function\n        var context = canvas0.getContext('2d');\n        var markupCtx = canvas1.getContext('2d');\n        var pcmperpixel = 0;\n        window.URL = window.URL || window.webkitURL;\n        var devicePixelRatio = window.devicePixelRatio || 1;\n        var spectroWorker = 'scripts/workers/spectroWorker.js';\n        var primeWorker = new Worker(spectroWorker);\n        var currentImage;\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.timelineSize', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.redraw, 5);\n            }\n          }\n        });\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                scope.redraw();\n              }\n              drawSpectMarkup(true);\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              markupCtx.clearRect(0, 0, canvas1.width, canvas1.height);\n              drawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // scope.redraw();\n              drawSpectMarkup(true);\n            }\n          }\n        }, true);\n        scope.$watch('vs.spectroSettings', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              setupEvent();\n              scope.redraw();\n            }\n          }\n        }, true);\n        ///////////////\n        // bindings\n        scope.redraw = function () {\n          pcmpp();\n          markupCtx.clearRect(0, 0, canvas1.width, canvas1.height);\n          drawSpectro(scope.shs.wavJSO.Data);\n        };\n        function pcmpp() {\n          pcmperpixel = (scope.vs.curViewPort.eS + 1 - scope.vs.curViewPort.sS) / canvas0.width;\n        }\n        function drawSpectMarkup(reset) {\n          if (reset) {\n            markupCtx.clearRect(0, 0, canvas1.width, canvas1.height);\n          }\n          // draw moving boundary line if moving\n          scope.dhs.drawMovingBoundaryLine(markupCtx);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(markupCtx, false);\n          // draw min max vals and name of track\n          scope.dhs.drawMinMaxAndName(markupCtx, '', scope.vs.spectroSettings.rangeFrom, scope.vs.spectroSettings.rangeTo, 2);\n        }\n        function killSpectroRenderingThread() {\n          context.fillStyle = scope.cps.vals.colors.levelColor;\n          context.fillRect(0, 0, canvas0.width, canvas0.height);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(markupCtx, false);\n          var horizontalText = fontScaleService.getTextImage(context, 'rendering...', scope.cps.vals.font.fontPxSize * 0.75, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          context.drawImage(horizontalText, 10, 50);\n          if (primeWorker !== null) {\n            primeWorker.terminate();\n            primeWorker = null;\n          }\n        }\n        function setupEvent() {\n          //pcmperpixel = Math.round((scope.vs.curViewPort.eS - scope.vs.curViewPort.sS) / canvas0.width);\n          pcmpp();\n          var imageData = context.createImageData(canvas0.width, canvas0.height);\n          primeWorker.addEventListener('message', function (event) {\n            if (pcmperpixel === event.data.myStep) {\n              var tmp = new Uint8ClampedArray(event.data.img);\n              imageData.data.set(tmp);\n              context.putImageData(imageData, 0, 0);\n              drawSpectMarkup();\n            }\n          });\n        }\n        function drawSpectro(buffer) {\n          killSpectroRenderingThread();\n          //markupCtx.clearRect(0, 0, canvas1.width, canvas1.height);\n          startSpectroRenderingThread(buffer);\n        }\n        function startSpectroRenderingThread(buffer) {\n          pcmpp();\n          primeWorker = new Worker(spectroWorker);\n          // var parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS + Math.round(pcmperpixel * 20 * scope.vs.spectroSettings.windowLength)));\n          var parseData;\n          if (scope.vs.curViewPort.sS >= scope.vs.spectroSettings.windowLength / 2) {\n            parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS - scope.vs.spectroSettings.windowLength / 2, scope.vs.curViewPort.eS + scope.vs.spectroSettings.windowLength));  // pass in half a window extra at the front and a full window extra at the back so everything can be drawn/calculated this also fixes alignment issue\n          } else {\n            parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS + scope.vs.spectroSettings.windowLength));  // tolerate window/2 alignment issue if at beginning of file\n          }\n          setupEvent();\n          primeWorker.postMessage({\n            'N': scope.vs.spectroSettings.windowLength,\n            'alpha': alpha,\n            'freq': scope.vs.spectroSettings.rangeTo,\n            'freqLow': scope.vs.spectroSettings.rangeFrom,\n            'start': scope.vs.curViewPort.sS,\n            'end': scope.vs.curViewPort.eS,\n            'myStep': pcmperpixel,\n            'window': scope.vs.spectroSettings.window,\n            'width': canvas0.width,\n            'height': canvas0.height,\n            'dynRangeInDB': scope.vs.spectroSettings.dynamicRange,\n            'pixelRatio': devicePixelRatio,\n            'sampleRate': scope.shs.wavJSO.SampleRate,\n            'streamChannels': scope.shs.wavJSO.NumChannels,\n            'transparency': scope.cps.vals.spectrogramSettings.transparency,\n            'stream': parseData.buffer,\n            'drawHeatMapColors': scope.vs.spectroSettings.drawHeatMapColors,\n            'preEmphasisFilterFactor': scope.vs.spectroSettings.preEmphasisFilterFactor,\n            'heatMapColorAnchors': scope.vs.spectroSettings.heatMapColorAnchors\n          }, [parseData.buffer]);\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ExportCtrl', [\n  '$scope',\n  'dialogService',\n  'exportData',\n  'exportName',\n  'viewState',\n  'HistoryService',\n  function ($scope, dialogService, exportData, exportName, viewState, HistoryService) {\n    $scope.exportData = exportData;\n    $scope.exportName = exportName;\n    $scope.firefox = navigator.userAgent.match(/Firefox/i) ? true : false;\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getBlob = function () {\n      return new Blob([$scope.exportData], { type: 'text/plain' });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.export = function () {\n      $scope.SaveToDisk(URL.createObjectURL($scope.getBlob()), $scope.exportName);\n      dialogService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.updateHistoryService = function () {\n      HistoryService.movesAwayFromLastSave = 0;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n    };\n    /**\n\t\t *  Save file to disk // Non-IE ONLY !!\n\t\t */\n    $scope.SaveToDisk = function (fileURL, fileName) {\n      var save = document.createElement('a');\n      if ($scope.firefox) {\n        save.setAttribute('download', fileName);\n        save.href = fileURL;\n        save.innerHTML = '';\n        save.style.display = 'none';\n        document.body.appendChild(save);\n        save.click();\n      } else {\n        save.href = fileURL;\n        save.target = '_blank';\n        save.download = fileName || 'unknown';\n        var event = document.createEvent('Event');\n        event.initEvent('click', true, true);\n        save.dispatchEvent(event);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n      }\n      $scope.updateHistoryService();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('viewState', [\n  '$rootScope',\n  '$timeout',\n  '$window',\n  'Soundhandlerservice',\n  function ($rootScope, $timeout, $window, Soundhandlerservice) {\n    //shared service object to be returned\n    var sServObj = {};\n    // window functions enum for spectro\n    var myWindow = {\n        BARTLETT: 1,\n        BARTLETTHANN: 2,\n        BLACKMAN: 3,\n        COSINE: 4,\n        GAUSS: 5,\n        HAMMING: 6,\n        HANN: 7,\n        LANCZOS: 8,\n        RECTANGULAR: 9,\n        TRIANGULAR: 10\n      };\n    // hold the current attribute definitions that are in view \n    sServObj.curLevelAttrDefs = [];\n    /**\n     * initialize all needed vars in viewState\n     */\n    sServObj.initialize = function () {\n      sServObj.curViewPort = {\n        sS: 0,\n        eS: 0,\n        selectS: -1,\n        selectE: -1,\n        dragBarActive: false,\n        dragBarHeight: -1,\n        windowWidth: undefined\n      };\n      sServObj.spectroSettings = {\n        windowLength: -1,\n        rangeFrom: -1,\n        rangeTo: -1,\n        dynamicRange: -1,\n        window: -1,\n        drawHeatMapColors: -1,\n        preEmphasisFilterFactor: -1\n      };\n      sServObj.playHeadAnimationInfos = {\n        sS: -1,\n        eS: -1,\n        curS: null,\n        endFreezeSample: -1\n      };\n      sServObj.timelineSize = -1;\n      sServObj.somethingInProgress = false;\n      sServObj.somethingInProgressTxt = '';\n      sServObj.curClickSegments = [];\n      sServObj.editing = false;\n      sServObj.cursorInTextField = false;\n      sServObj.saving = true;\n      sServObj.submenuOpen = false;\n      sServObj.rightSubmenuOpen = false;\n      sServObj.curMousePosSample = 0;\n      sServObj.curMouseLevelName = undefined;\n      sServObj.curMouseLevelType = undefined;\n      sServObj.curClickLevelName = undefined;\n      sServObj.curClickLevelType = undefined;\n      sServObj.curPreselColumnSample = 2;\n      sServObj.curCorrectionToolNr = undefined;\n      sServObj.curClickLevelIndex = undefined;\n      sServObj.start = null;\n      sServObj.TransitionTime = undefined;\n      sServObj.showDropZone = true;\n      sServObj.movingBoundary = false;\n      sServObj.movingBoundarySample = undefined;\n      sServObj.focusInTextField = false;\n      sServObj.curTaskPercCompl = 0;\n      sServObj.curPerspectiveIdx = -1;\n      sServObj.mouseInEmuWebApp = false;\n      // possible general states of state machine\n      sServObj.states = [];\n      sServObj.states.noDBorFilesloaded = {\n        'permittedActions': [\n          'connectBtnClick',\n          'openDemoBtnDBclick'\n        ]\n      };\n      sServObj.states.loadingSaving = { 'permittedActions': [] };\n      sServObj.states.labeling = {\n        'permittedActions': [\n          'zoom',\n          'playaudio',\n          'spectSettingsChange',\n          'addLevelSegBtnClick',\n          'addLevelPointBtnClick',\n          'renameSelLevelBtnClick',\n          'downloadTextGridBtnClick',\n          'spectSettingsChange',\n          'clearBtnClick',\n          'labelAction',\n          'toggleSideBars',\n          'saveBndlBtnClick',\n          'showHierarchyBtnClick'\n        ]\n      };\n      sServObj.states.modalShowing = sServObj.states.loadingSaving;\n      sServObj.prevState = sServObj.states.noDBorFilesloaded;\n      sServObj.curState = sServObj.states.noDBorFilesloaded;\n      sServObj.curLevelAttrDefs = [];\n    };\n    // initialize on init\n    sServObj.initialize();\n    /**\n     * function to ask permission in current labeler state\n     */\n    sServObj.getPermission = function (actionName) {\n      return sServObj.curState.permittedActions.indexOf(actionName) > -1;\n    };\n    /**\n     *\n     */\n    sServObj.setWindowWidth = function (b) {\n      this.curViewPort.windowWidth = b;\n    };\n    /**\n     * set state\n     */\n    sServObj.setState = function (nameOrObj) {\n      sServObj.prevState = sServObj.curState;\n      if (typeof nameOrObj === 'string') {\n        sServObj.curState = sServObj.states[nameOrObj];\n      } else {\n        sServObj.curState = nameOrObj;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.updatePlayHead = function (timestamp) {\n      // at first push animation !!!\n      if (Soundhandlerservice.player.isPlaying) {\n        $window.requestAnimationFrame(sServObj.updatePlayHead);\n      }\n      // do work in this animation round now\n      if (sServObj.start === null) {\n        sServObj.start = timestamp;\n      }\n      var samplesPassed = Math.floor(timestamp - sServObj.start) / 1000 * Soundhandlerservice.wavJSO.SampleRate;\n      sServObj.playHeadAnimationInfos.curS = Math.floor(sServObj.playHeadAnimationInfos.sS + samplesPassed);\n      if (Soundhandlerservice.player.isPlaying && sServObj.playHeadAnimationInfos.curS <= sServObj.playHeadAnimationInfos.eS) {\n        if (sServObj.playHeadAnimationInfos.curS !== -1) {\n          sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.curS;\n        }\n        $rootScope.$apply();\n      } else {\n        sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.endFreezeSample;\n        sServObj.playHeadAnimationInfos.sS = -1;\n        sServObj.playHeadAnimationInfos.eS = -1;\n        sServObj.playHeadAnimationInfos.curS = 0;\n        sServObj.start = null;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.animatePlayHead = function (startS, endS) {\n      sServObj.playHeadAnimationInfos.sS = startS;\n      sServObj.playHeadAnimationInfos.eS = endS;\n      sServObj.playHeadAnimationInfos.endFreezeSample = endS;\n      sServObj.playHeadAnimationInfos.curS = startS;\n      $window.requestAnimationFrame(sServObj.updatePlayHead);\n    };\n    /**\n     * set selected Area\n     * @param start of selected Area\n     * @param end of selected Area\n     */\n    sServObj.select = function (start, end) {\n      sServObj.curViewPort.selectS = start;\n      sServObj.curViewPort.selectE = end;  //$rootScope.$digest();\n    };\n    /**\n     * reset selected Area to default\n     * @param length of current pcm stream\n     */\n    sServObj.resetSelect = function () {\n      sServObj.curViewPort.selectS = -1;\n      sServObj.curViewPort.selectE = -1;\n    };\n    /**\n     * gets the current Viewport\n     */\n    sServObj.getViewPort = function () {\n      return sServObj.curViewPort;\n    };\n    /**\n     * setspectroSettings\n     */\n    sServObj.setspectroSettings = function (len, rfrom, rto, dyn, win, hm, preEmph, hmColorAnchors) {\n      sServObj.spectroSettings.windowLength = parseInt(len, 10);\n      sServObj.spectroSettings.rangeFrom = parseInt(rfrom, 10);\n      sServObj.spectroSettings.rangeTo = parseInt(rto, 10);\n      sServObj.spectroSettings.dynamicRange = parseInt(dyn, 10);\n      sServObj.setWindowFunction(win);\n      sServObj.spectroSettings.drawHeatMapColors = hm;\n      sServObj.spectroSettings.preEmphasisFilterFactor = preEmph;\n      sServObj.spectroSettings.heatMapColorAnchors = hmColorAnchors;\n    };\n    /**\n     * returns current selection as array\n     */\n    sServObj.getSelect = function () {\n      return [\n        sServObj.curViewPort.selectS,\n        sServObj.curViewPort.selectE\n      ];\n    };\n    /**\n     * set selected Area if new\n     * start value is smaler than actual and\n     * end value is greater than actual\n     * @param start of selected Area\n     * @param end of seleected Area\n     */\n    sServObj.selectDependent = function (start, end) {\n      if (start < this.curViewPort.selectS) {\n        this.curViewPort.selectS = start;\n      }\n      if (end > this.curViewPort.selectE) {\n        this.curViewPort.selectE = end;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.selectLevel = function (next, order, Levelserv) {\n      var curLev;\n      var now = sServObj.getcurClickLevelName();\n      if (now === undefined && !next) {\n        // select first if none prev. defined (up)\n        // viewState.setcurClickLevel(levelID, levelType, scope.$index, scope.this.level.items.length);\n        curLev = Levelserv.getLevelDetails(order[0]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, 0);\n        return;\n      } else if (now === undefined && next) {\n        // select last if none prev. defined (down)\n        curLev = Levelserv.getLevelDetails(order[order.length - 1]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.length - 1);\n        return;\n      }\n      var idxOfNow;\n      order.forEach(function (name, idx) {\n        if (name === now) {\n          idxOfNow = idx;\n        }\n      });\n      if (next) {\n        if (idxOfNow + 1 < order.length) {\n          curLev = Levelserv.getLevelDetails(order[idxOfNow + 1]);\n          // sServObj.setcurClickLevelName(order[idxOfNow + 1]);\n          sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.idxOfNow + 1);\n          sServObj.curClickSegments = [];\n          sServObj.selectBoundary();  //sServObj.resetSelect();\n        }\n      } else {\n        if (idxOfNow - 1 >= 0) {\n          curLev = Levelserv.getLevelDetails(order[idxOfNow - 1]);\n          // sServObj.setcurClickLevelName(order[idxOfNow - 1]);\n          sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.idxOfNow - 1);\n          sServObj.curClickSegments = [];\n          sServObj.selectBoundary();  //sServObj.resetSelect();\n        }\n      }\n    };\n    /**\n     * set the window Function for the Spectrogram\n     * @param name of Window Function\n     */\n    sServObj.setWindowFunction = function (name) {\n      switch (name) {\n      case 'BARTLETT':\n        sServObj.spectroSettings.window = myWindow.BARTLETT;\n        break;\n      case 'BARTLETTHANN':\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      case 'BLACKMAN':\n        sServObj.spectroSettings.window = myWindow.BLACKMAN;\n        break;\n      case 'COSINE':\n        sServObj.spectroSettings.window = myWindow.COSINE;\n        break;\n      case 'GAUSS':\n        sServObj.spectroSettings.window = myWindow.GAUSS;\n        break;\n      case 'HAMMING':\n        sServObj.spectroSettings.window = myWindow.HAMMING;\n        break;\n      case 'HANN':\n        sServObj.spectroSettings.window = myWindow.HANN;\n        break;\n      case 'LANCZOS':\n        sServObj.spectroSettings.window = myWindow.LANCZOS;\n        break;\n      case 'RECTANGULAR':\n        sServObj.spectroSettings.window = myWindow.RECTANGULAR;\n        break;\n      case 'TRIANGULAR':\n        sServObj.spectroSettings.window = myWindow.TRIANGULAR;\n        break;\n      default:\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      }\n    };\n    /**\n     * @returns myWindow object\n     */\n    sServObj.getWindowFunctions = function () {\n      return myWindow;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarActive = function () {\n      return this.curViewPort.dragBarActive;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarActive = function (b) {\n      this.curViewPort.dragBarActive = b;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarHeight = function () {\n      return this.curViewPort.dragBarHeight;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarHeight = function (b) {\n      this.curViewPort.dragBarHeight = b;\n    };\n    /**\n     * get pixel position in current viewport given the canvas width\n     * @param w is width of canvas\n     * @param s is current sample to convert to pixel value\n     */\n    sServObj.getPos = function (w, s) {\n      return w * (s - this.curViewPort.sS) / (this.curViewPort.eS - this.curViewPort.sS + 1);  // + 1 because of view (displays all samples in view)\n    };\n    /**\n     * calculate the pixel distance between two samples\n     * @param w is width of canvas\n     */\n    sServObj.getSampleDist = function (w) {\n      return this.getPos(w, this.curViewPort.sS + 1) - this.getPos(w, this.curViewPort.sS);\n    };\n    /**\n     * toggle boolean if left submenu is open\n     */\n    sServObj.togglesubmenuOpen = function (time) {\n      this.submenuOpen = !this.submenuOpen;\n      $timeout(function () {\n        $rootScope.$broadcast('refreshTimeline');\n      }, time, false);\n    };\n    /**\n     * get boolean if left submenu is open\n     */\n    sServObj.getsubmenuOpen = function () {\n      return this.submenuOpen;\n    };\n    /**\n     * set boolean if left submenu is open\n     */\n    sServObj.setsubmenuOpen = function (s) {\n      this.submenuOpen = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setenlarge = function (s) {\n      this.timelineSize = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getenlarge = function () {\n      return this.timelineSize;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getTransitionTime = function () {\n      return this.TransitionTime;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setTransitionTime = function (s) {\n      this.TransitionTime = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getRightsubmenuOpen = function () {\n      return this.rightSubmenuOpen;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setRightsubmenuOpen = function (s) {\n      this.rightSubmenuOpen = s;\n    };\n    /**\n     *\n     */\n    sServObj.setcurClickLevel = function (levelID, levelType, levelIndex) {\n      this.setcurClickLevelName(levelID, levelIndex);\n      this.setcurClickLevelType(levelType);\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelType = function (name) {\n      this.curClickLevelType = name;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelType = function () {\n      return this.curClickLevelType;\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelName = function (name, index) {\n      this.curClickLevelName = name;\n      this.curClickLevelIndex = index;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelName = function () {\n      return this.curClickLevelName;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelIndex = function () {\n      return this.curClickLevelIndex;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickNeighbours = function () {\n      return this.curClickNeighbours;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelName = function (name) {\n      this.curMouseLevelName = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelName = function () {\n      return this.curMouseLevelName;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelType = function (name) {\n      this.curMouseLevelType = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelType = function () {\n      return this.curMouseLevelType;\n    };\n    /**\n     * sets the current (mousemove) Segment\n     * @param name is name of segment\n     */\n    sServObj.setcurMouseSegment = function (segment, neighbour, x, isFirst, isLast) {\n      this.curMouseSegment = segment;\n      this.curMouseX = x;\n      this.curMouseNeighbours = neighbour;\n      this.curMouseisFirst = isFirst;\n      this.curMouseisLast = isLast;\n    };\n    /**\n     * gets the current (mousemove) Segment\n     */\n    sServObj.getcurMouseSegment = function () {\n      return this.curMouseSegment;\n    };\n    /**\n     * gets the current (mousemove) Segment\n     */\n    sServObj.getcurMouseisFirst = function () {\n      return this.curMouseisFirst;\n    };\n    /**\n     * gets the current (mousemove) Segment\n     */\n    sServObj.getcurMouseisLast = function () {\n      return this.curMouseisLast;\n    };\n    /**\n     * gets the current (mousemove) Segment\n     */\n    sServObj.getcurMouseNeighbours = function () {\n      return this.curMouseNeighbours;\n    };\n    /**\n     * selects all Segements on current level which are inside the selected viewport\n     */\n    sServObj.selectSegmentsInSelection = function (levelData) {\n      sServObj.curClickSegments = [];\n      var min = Infinity;\n      var max = -Infinity;\n      var itemInSel = this.getItemsInSelection(levelData);\n      angular.forEach(itemInSel, function (item) {\n        if (item.sampleStart < min) {\n          min = item.sampleStart;\n        }\n        if (item.sampleStart + item.sampleDur + 1 > max) {\n          max = item.sampleStart + item.sampleDur + 1;\n        }\n        sServObj.setcurClickSegmentMultiple(item);\n      });\n      sServObj.curViewPort.selectS = min;\n      sServObj.curViewPort.selectE = max;\n    };\n    /**\n     * get all items of current level which are inside the selected viewport\n     */\n    sServObj.getItemsInSelection = function (levelData) {\n      var itemsInRange = [];\n      var rangeStart = sServObj.curViewPort.selectS;\n      var rangeEnd = sServObj.curViewPort.selectE;\n      angular.forEach(levelData, function (t) {\n        if (t.name === sServObj.getcurClickLevelName()) {\n          angular.forEach(t.items, function (item) {\n            //SEGMENTS\n            if (item.sampleStart >= rangeStart && item.sampleStart + item.sampleDur <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n            //EVENTS\n            if (item.samplePoint >= rangeStart && item.samplePoint <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n          });\n        }\n      });\n      return itemsInRange;\n    };\n    /**\n     * sets the current (click) Segment\n     * @param segment\n     */\n    sServObj.setcurClickSegment = function (segment) {\n      if (segment !== null && segment !== undefined) {\n        sServObj.curClickSegments = [];\n        sServObj.curClickSegments.push(segment);\n        sServObj.selectBoundary();\n      } else {\n        sServObj.curClickSegments = [];\n      }\n    };\n    /**\n     * sets a multiple select (click) Segment\n     */\n    sServObj.selectBoundary = function () {\n      if (sServObj.curClickSegments.length > 0) {\n        var left, right;\n        if (sServObj.curClickSegments[0].sampleStart !== undefined) {\n          left = sServObj.curClickSegments[0].sampleStart;\n        } else {\n          left = sServObj.curClickSegments[0].samplePoint;\n        }\n        right = sServObj.curClickSegments[sServObj.curClickSegments.length - 1].sampleStart + sServObj.curClickSegments[sServObj.curClickSegments.length - 1].sampleDur || sServObj.curClickSegments[0].samplePoint;\n        sServObj.curClickSegments.forEach(function (entry) {\n          if (entry.sampleStart <= left) {\n            left = entry.sampleStart;\n          }\n          if (entry.sampleStart + entry.sampleDur >= right) {\n            right = entry.sampleStart + entry.sampleDur;\n          }\n        });\n        sServObj.select(left, right + 1);\n      }\n    };\n    /**\n     * sets a multiple select (click) Segment\n     * @param segment\n     */\n    sServObj.setcurClickSegmentMultiple = function (segment) {\n      var empty = true;\n      var start = segment.sampleStart;\n      var end = start + segment.sampleDur + 1;\n      sServObj.curClickSegments.forEach(function (entry) {\n        var front = entry.sampleStart === end ? true : false;\n        var back = entry.sampleStart + entry.sampleDur + 1 === start ? true : false;\n        if ((front || back) && sServObj.curClickSegments.indexOf(segment) === -1) {\n          sServObj.curClickSegments.push(segment);\n          empty = false;\n        }\n      });\n      if (empty) {\n        sServObj.curClickSegments = [];\n        sServObj.curClickSegments.push(segment);\n      } else {\n        sServObj.curClickSegments.sort(sServObj.sortbyid);\n      }\n    };\n    /**\n     *\n     */\n    sServObj.sortbyid = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.sampleStart > b.sampleStart) {\n        return 1;\n      }\n      if (a.sampleStart < b.sampleStart) {\n        return -1;\n      }\n      return 0;\n    };\n    /**\n     * gets the current (click) Segment\n     */\n    sServObj.getselectedRange = function () {\n      if (this.curClickSegments.length > 1) {\n        return {\n          start: this.curClickSegments[0].sampleStart,\n          end: this.curClickSegments[this.curClickSegments.length - 1].sampleStart + this.curClickSegments[this.curClickSegments.length - 1].sampleDur\n        };\n      } else if (this.curClickSegments.length === 1) {\n        if (this.curClickSegments[0].sampleStart !== undefined) {\n          return {\n            start: this.curClickSegments[0].sampleStart,\n            end: this.curClickSegments[0].sampleStart + this.curClickSegments[0].sampleDur\n          };\n        } else {\n          return {\n            start: this.curClickSegments[0].samplePoint,\n            end: this.curClickSegments[0].samplePoint\n          };\n        }\n      } else {\n        return {\n          start: -1,\n          end: -1\n        };\n      }\n    };\n    /**\n     * gets the current (click) Segments\n     */\n    sServObj.getcurClickSegments = function () {\n      return this.curClickSegments;\n    };\n    /**\n     * gets the first ! current (click) Segment\n     */\n    sServObj.getfirstClickSegment = function () {\n      if (sServObj.curClickSegments.length > 0) {\n        return sServObj.curClickSegments[0];\n      }\n    };\n    /**\n     *\n     */\n    sServObj.getselected = function () {\n      return this.curClickSegments;\n    };\n    /**\n     *\n     */\n    sServObj.isEditing = function () {\n      return this.editing;\n    };\n    /**\n     *\n     */\n    sServObj.setEditing = function (n) {\n      this.editing = n;\n    };\n    /**\n     *\n     */\n    sServObj.getcursorInTextField = function () {\n      return this.cursorInTextField;\n    };\n    /**\n     *\n     */\n    sServObj.setcursorInTextField = function (n) {\n      this.cursorInTextField = n;\n    };\n    /**\n     *\n     */\n    sServObj.isSavingAllowed = function () {\n      return this.saving;\n    };\n    /**\n     *\n     */\n    sServObj.setSavingAllowed = function (n) {\n      this.saving = n;\n    };\n    /**\n     *\n     */\n    sServObj.countSelected = function () {\n      return this.curClickSegments.length;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentSample = function (perc) {\n      return this.curViewPort.sS + (this.curViewPort.eS - this.curViewPort.sS) * perc;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentPercent = function (sample) {\n      return sample * (100 / (this.curViewPort.eS - this.curViewPort.sS) / 100);\n    };\n    /**\n     *\n     */\n    sServObj.getSamplesPerPixelVal = function (event) {\n      var start = parseFloat(this.curViewPort.sS);\n      var end = parseFloat(this.curViewPort.eS);\n      return (end - start) / event.originalEvent.target.width;\n    };\n    /**\n     * round to n decimal digits after the comma\n     * used to help display numbers with a given\n     * precision\n     */\n    sServObj.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        console.error('error in call of round function!!');\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return parseFloat(k.substring(0, k.indexOf('.') + n + 1));\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getViewPortStartTime = function () {\n      return this.curViewPort.sS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getViewPortEndTime = function () {\n      return this.curViewPort.eS * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getSelectedStartTime = function () {\n      return this.curViewPort.selectS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getSelectedEndTime = function () {\n      return this.curViewPort.selectE * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param sSample start sample of view\n     * @param sSample end sample of view\n     */\n    sServObj.setViewPort = function (sSample, eSample) {\n      var oldStart = this.curViewPort.sS;\n      var oldEnd = this.curViewPort.eS;\n      if (sSample !== undefined) {\n        this.curViewPort.sS = Math.round(sSample);\n      }\n      if (eSample !== undefined) {\n        this.curViewPort.eS = Math.round(eSample);\n      }\n      // check if moving left or right is not out of bounds -> prevent zooming on edge when moving left/right\n      if (oldStart > this.curViewPort.sS && oldEnd > this.curViewPort.eS) {\n        //moved left\n        if (this.curViewPort.sS < 0) {\n          this.curViewPort.sS = 0;\n          this.curViewPort.eS = oldEnd + Math.abs(this.curViewPort.sS);\n        }\n      }\n      if (oldStart < this.curViewPort.sS && oldEnd < this.curViewPort.eS) {\n        //moved right\n        if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n          this.curViewPort.sS = oldStart;\n          this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n        }\n      }\n      // check if in range\n      if (this.curViewPort.sS < 0) {\n        this.curViewPort.sS = 0;\n      }\n      if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n        this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n      }\n      // check if at least 4 samples are showing (fixed max zoom size)\n      if (this.curViewPort.eS - this.curViewPort.sS < 4) {\n        this.curViewPort.sS = oldStart;\n        this.curViewPort.eS = oldEnd;\n      }\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param zoomIn bool to specify zooming direction\n     * if set to true -> zoom in\n     * if set to false -> zoom out\n     */\n    sServObj.zoomViewPort = function (zoomIn, LevelService) {\n      var newStartS, newEndS, curMouseMoveSegmentStart;\n      var seg = this.getcurMouseSegment();\n      var d = this.curViewPort.eS - this.curViewPort.sS;\n      var isLastSeg = false;\n      if (seg !== undefined) {\n        if (this.getcurMouseisFirst()) {\n          // before first element\n          seg = LevelService.getItemDetails(sServObj.getcurMouseLevelName(), 0);\n        } else if (this.getcurMouseisLast()) {\n          seg = LevelService.getLastItem(sServObj.getcurMouseLevelName());\n          isLastSeg = true;\n        }\n        if (this.getcurMouseLevelType() === 'SEGMENT') {\n          if (isLastSeg) {\n            curMouseMoveSegmentStart = seg.sampleStart + seg.sampleDur;\n          } else {\n            curMouseMoveSegmentStart = seg.sampleStart;\n          }\n        } else {\n          curMouseMoveSegmentStart = seg.samplePoint;\n        }\n        var d1 = curMouseMoveSegmentStart - this.curViewPort.sS;\n        var d2 = this.curViewPort.eS - curMouseMoveSegmentStart;\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + d1 * 0.5;\n          newEndS = this.curViewPort.eS - d2 * 0.5;\n        } else {\n          newStartS = this.curViewPort.sS - d1 * 0.5;\n          newEndS = this.curViewPort.eS + d2 * 0.5;\n        }\n      } else {\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + ~~(d / 4);\n          newEndS = this.curViewPort.eS - ~~(d / 4);\n        } else {\n          newStartS = this.curViewPort.sS - ~~(d / 4);\n          newEndS = this.curViewPort.eS + ~~(d / 4);\n        }\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * moves view port to the right or to the left\n     * without changing the zoom\n     *\n     * @param shiftRight bool to specify direction\n     * if set to true -> shift right\n     * if set to false -> shift left\n     */\n    sServObj.shiftViewPort = function (shiftRight) {\n      // my.removeLabelDoubleClick();\n      var newStartS, newEndS;\n      if (shiftRight) {\n        newStartS = this.curViewPort.sS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      } else {\n        newStartS = this.curViewPort.sS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * sets all the curLevelAttrDefs array\n     * to hold the default attr. definitions\n     * which are the same as the level names\n     *\n     * @param levelDefs level definitions from the DBconfig\n     */\n    sServObj.setCurLevelAttrDefs = function (levelDefs) {\n      angular.forEach(levelDefs, function (ld) {\n        sServObj.curLevelAttrDefs.push({\n          'levelName': ld.name,\n          'curAttrDefName': ld.name\n        });\n      });\n    };\n    /**\n     * set the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @param newAttrDefName\n     */\n    sServObj.setCurAttrDef = function (levelName, newAttrDefName, index) {\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          ad.curAttrDefName = newAttrDefName;\n          ad.curAttrDefIndex = index;\n        }\n      });\n    };\n    /**\n     * get the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrDef = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          curAttrDef = ad.curAttrDefName;\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n     * get the current attribute definition index of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrIndex = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          if (ad.curAttrDefIndex === undefined) {\n            curAttrDef = 0;\n          } else {\n            curAttrDef = ad.curAttrDefIndex;\n          }\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n\t*\n\t*/\n    sServObj.getX = function (e) {\n      return (e.offsetX || e.originalEvent.layerX) * (e.originalEvent.target.width / e.originalEvent.target.clientWidth);\n    };\n    /**\n\t*\n\t*/\n    sServObj.getY = function (e) {\n      return (e.offsetY || e.originalEvent.layerY) * (e.originalEvent.target.height / e.originalEvent.target.clientHeight);\n    };\n    /**\n     *\n     */\n    sServObj.resetToInitState = function () {\n      sServObj.initialize();\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('trackmouseinlevel', [\n  'viewState',\n  'LevelService',\n  'ConfigProviderService',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, LevelService, ConfigProviderService, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: { level: '=' },\n      link: function (scope, element, attr) {\n        var lastEventClick;\n        var lastEventClickId;\n        var lastEventRightClick;\n        var lastEventRightClickId;\n        var lastEventMove;\n        var lastEventMoveId;\n        var lastNeighbours;\n        var lastNeighboursMove;\n        var lastPCM;\n        var curMouseSampleNrInView;\n        var levelID = scope.level.name;\n        var levelType = scope.level.type;\n        /////////////////////////////\n        // Bindings\n        //\n        element.bind('click', function (event) {\n          event.preventDefault();\n          setLastMove(event, true);\n          setLastClick(event);\n        });\n        //\n        element.bind('contextmenu', function (event) {\n          event.preventDefault();\n          setLastMove(event, true);\n          setLastRightClick(event);\n        });\n        //\n        element.bind('dblclick', function (event) {\n          setLastMove(event, true);\n          if (ConfigProviderService.vals.restrictions.editItemName) {\n            setLastDblClick(event);\n          } else {\n            setLastClick(event);\n          }\n        });\n        //\n        element.bind('mousemove', function (event) {\n          if (!viewState.getdragBarActive()) {\n            var moveLine = true;\n            var samplesPerPixel = viewState.getSamplesPerPixelVal(event);\n            curMouseSampleNrInView = viewState.getX(event) * samplesPerPixel;\n            var moveBy = curMouseSampleNrInView - lastPCM;\n            if (samplesPerPixel <= 1 && scope.this.level.items.length > 0) {\n              var zoomEventMove = LevelService.getClosestItem(curMouseSampleNrInView + viewState.curViewPort.sS, scope.this.level.name, Soundhandlerservice.wavJSO.Data.length);\n              // absolute movement in pcm below 1 pcm per pixel\n              if (scope.this.level.type === 'SEGMENT') {\n                if (zoomEventMove.isFirst === true && zoomEventMove.isLast === false) {\n                  // before first elem\n                  moveBy = Math.ceil(curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemDetails(scope.this.level.name, 0).sampleStart);\n                } else if (zoomEventMove.isFirst === false && zoomEventMove.isLast === true) {\n                  // after last elem\n                  var lastItem = LevelService.getLastItem(scope.this.level.name);\n                  moveBy = Math.ceil(curMouseSampleNrInView + viewState.curViewPort.sS - lastItem.sampleStart - lastItem.sampleDur);\n                } else {\n                  moveBy = Math.ceil(curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.this.level.name, zoomEventMove.nearest.id).sampleStart);\n                }\n              } else {\n                moveBy = Math.ceil(curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.this.level.name, zoomEventMove.nearest.id).samplePoint - 0.5);  // 0.5 to break between samples not on\n              }\n            } else {\n              // relative movement in pcm above 1 pcm per pixel\n              moveBy = Math.round(curMouseSampleNrInView - lastPCM);\n            }\n          }\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            //console.log('Left mouse button pressed');\n            break;\n          case 2:\n            //console.log('Middle mouse button pressed');\n            break;\n          case 3:\n            //console.log('Right mouse button pressed');\n            break;\n          default:\n            if (!viewState.getdragBarActive()) {\n              if (ConfigProviderService.vals.restrictions.editItemSize && event.shiftKey) {\n                LevelService.deleteEditArea();\n                if (viewState.getcurMouseSegment() !== undefined) {\n                  viewState.movingBoundary = true;\n                  if (scope.this.level.type === 'SEGMENT') {\n                    if (viewState.getcurMouseisFirst() || viewState.getcurMouseisLast()) {\n                      var seg, leftMost, rightB;\n                      // before first segment\n                      if (viewState.getcurMouseisFirst()) {\n                        seg = LevelService.getItemDetails(scope.this.level.name, 0);\n                        viewState.movingBoundarySample = seg.sampleStart + moveBy;\n                      } else if (viewState.getcurMouseisLast()) {\n                        seg = LevelService.getLastItem(scope.this.level.name);\n                        viewState.movingBoundarySample = seg.sampleStart + seg.sampleDur + moveBy;\n                      }\n                    } else {\n                      viewState.movingBoundarySample = viewState.getcurMouseSegment().sampleStart + moveBy;\n                      seg = viewState.getcurMouseSegment();\n                    }\n                    LevelService.moveBoundary(scope.this.level.name, seg.id, moveBy, viewState.getcurMouseisFirst(), viewState.getcurMouseisLast());\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEBOUNDARY',\n                      'name': scope.this.level.name,\n                      'id': seg.id,\n                      'movedBy': moveBy,\n                      'isFirst': viewState.getcurMouseisFirst(),\n                      'isLast': viewState.getcurMouseisLast()\n                    });\n                  } else {\n                    seg = viewState.getcurMouseSegment();\n                    viewState.movingBoundarySample = viewState.getcurMouseSegment().samplePoint + moveBy;\n                    LevelService.moveEvent(scope.this.level.name, seg.id, moveBy);\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEEVENT',\n                      'name': scope.this.level.name,\n                      'id': seg.id,\n                      'movedBy': moveBy\n                    });\n                  }\n                  lastPCM = curMouseSampleNrInView;\n                  viewState.selectBoundary();\n                  moveLine = false;\n                }\n              } else if (ConfigProviderService.vals.restrictions.editItemSize && event.altKey) {\n                LevelService.deleteEditArea();\n                if (scope.this.level.type == 'SEGMENT') {\n                  seg = viewState.getcurClickSegments();\n                  LevelService.moveSegment(scope.this.level.name, seg[0].id, seg.length, moveBy);\n                  HistoryService.updateCurChangeObj({\n                    'type': 'ANNOT',\n                    'action': 'MOVESEGMENT',\n                    'name': scope.this.level.name,\n                    'id': seg[0].id,\n                    'length': seg.length,\n                    'movedBy': moveBy\n                  });\n                  lastPCM = curMouseSampleNrInView;\n                  viewState.selectBoundary();\n                }\n              } else {\n                viewState.movingBoundary = false;\n              }\n            }\n            break;\n          }\n          if (!viewState.getdragBarActive()) {\n            setLastMove(event, moveLine);\n          }\n        });\n        //\n        element.bind('mousedown', function (event) {\n          viewState.movingBoundary = true;\n          setLastMove(event, true);\n        });\n        //\n        element.bind('mouseup', function (event) {\n          viewState.movingBoundary = false;\n          setLastMove(event, true);\n        });\n        //\n        element.bind('mouseout', function (event) {\n          viewState.movingBoundary = false;\n          setLastMove(event, true);\n        });\n        //\n        /////////////////////////\n        /**\n         *\n         */\n        function setLastClick(x) {\n          curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          lastEventClick = LevelService.getClosestItem(curMouseSampleNrInView + viewState.curViewPort.sS, scope.this.level.name, Soundhandlerservice.wavJSO.Data.length);\n          if (lastEventClick.current !== undefined && lastEventClick.nearest !== undefined) {\n            LevelService.setlasteditArea('_' + lastEventClick.current.id);\n            LevelService.setlasteditAreaElem(element.parent());\n            viewState.setcurClickLevel(levelID, levelType, scope.$index);\n            viewState.setcurClickSegment(lastEventClick.current);\n          }\n          lastPCM = curMouseSampleNrInView;\n          scope.$apply();\n        }\n        /**\n         *\n         */\n        function setLastRightClick(x) {\n          if (viewState.getcurClickLevelName() !== levelID) {\n            setLastClick(x);\n          }\n          curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          lastEventClick = LevelService.getClosestItem(curMouseSampleNrInView + viewState.curViewPort.sS, scope.this.level.name, Soundhandlerservice.wavJSO.Data.length);\n          if (lastEventClick.current !== undefined && lastEventClick.nearest !== undefined) {\n            viewState.setcurClickLevel(levelID, levelType, scope.$index);\n            viewState.setcurClickSegmentMultiple(lastEventClick.current);\n            viewState.selectBoundary();\n          }\n          lastPCM = curMouseSampleNrInView;\n          scope.$apply();\n        }\n        /**\n         *\n         */\n        function setLastDblClick(x) {\n          curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          lastEventClick = LevelService.getClosestItem(curMouseSampleNrInView + viewState.curViewPort.sS, scope.this.level.name, Soundhandlerservice.wavJSO.Data.length);\n          if (lastEventClick.current !== undefined && lastEventClick.nearest !== undefined) {\n            if (levelType === 'SEGMENT') {\n              if (lastEventClick.current.sampleStart >= viewState.curViewPort.sS) {\n                if (lastEventClick.current.sampleStart + lastEventClick.current.sampleDur <= viewState.curViewPort.eS) {\n                  viewState.setcurClickLevel(levelID, levelType, scope.$index);\n                  viewState.setcurClickSegment(lastEventClick.current);\n                  LevelService.setlasteditArea('_' + lastEventClick.current.id);\n                  LevelService.setlasteditAreaElem(element.parent());\n                  viewState.setEditing(true);\n                  LevelService.openEditArea(lastEventClick.current, element.parent(), levelType);\n                } else {\n                  console.log('Editing out of right bound !');\n                }\n              } else {\n                console.log('Editing out of left bound !');\n              }\n            } else {\n              viewState.setcurClickLevel(levelID, levelType, scope.$index);\n              viewState.setcurClickSegment(lastEventClick.current);\n              LevelService.setlasteditArea('_' + lastEventClick.current.id);\n              LevelService.setlasteditAreaElem(element.parent());\n              viewState.setEditing(true);\n              LevelService.openEditArea(lastEventClick.current, element.parent(), levelType);\n              viewState.setEditing(true);\n            }\n          }\n          lastPCM = curMouseSampleNrInView;\n          scope.$apply();\n        }\n        /**\n         *\n         */\n        function setLastMove(x, doChange) {\n          curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          lastEventMove = LevelService.getClosestItem(curMouseSampleNrInView + viewState.curViewPort.sS, scope.this.level.name, Soundhandlerservice.wavJSO.Data.length);\n          if (doChange) {\n            if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n              lastNeighboursMove = LevelService.getItemNeighboursFromLevel(scope.this.level.name, lastEventMove.nearest.id, lastEventMove.nearest.id);\n              viewState.setcurMouseSegment(lastEventMove.nearest, lastNeighboursMove, lastPCM, lastEventMove.isFirst, lastEventMove.isLast);\n            }\n          }\n          viewState.setcurMouseLevelName(levelID);\n          viewState.setcurMouseLevelType(levelType);\n          lastPCM = curMouseSampleNrInView;\n          scope.$apply();\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('handleglobalkeystrokes', [\n  '$timeout',\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'HistoryService',\n  'LevelService',\n  'LinkService',\n  'AnagestService',\n  function ($timeout, viewState, Soundhandlerservice, ConfigProviderService, HistoryService, LevelService, LinkService, AnagestService) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope) {\n        $(document).bind('keyup', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          if (viewState.isEditing() && !viewState.getcursorInTextField()) {\n            applyKeyCodeUp(code, e);\n          }\n        });\n        $(document).bind('keydown', function (e) {\n          if (!scope.firefox) {\n            var code = e.keyCode ? e.keyCode : e.which;\n            if (code == 8 || code == 9 || code == 27 || code == 37 || code == 38 || code == 39 || code == 40 || code == 32) {\n              applyKeyCode(code, e);\n            }\n          }\n        });\n        $(document).bind('keypress', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          applyKeyCode(code, e);\n        });\n        function applyKeyCodeUp(code, e) {\n          scope.$apply(function () {\n            e.preventDefault();\n            e.stopPropagation();\n            if (code !== ConfigProviderService.vals.keyMappings.esc && code !== ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              var str = domElement.val();\n              viewState.setSavingAllowed(true);\n              var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())];\n              // if it is defined then check if characters are ok\n              if (definitions.legalLabels !== undefined && str.length > 0) {\n                if (definitions.legalLabels.indexOf(str) < 0) {\n                  viewState.setSavingAllowed(false);\n                }\n              }\n              if (viewState.isSavingAllowed()) {\n                domElement.css({ 'background-color': 'rgba(255,255,0,1)' });\n              } else {\n                domElement.css({ 'background-color': 'rgba(255,0,0,1)' });\n              }\n            }\n          });\n        }\n        function applyKeyCode(code, e) {\n          scope.$apply(function () {\n            // check if mouse has to be in labeler for key mappings\n            if (ConfigProviderService.vals.main.catchMouseForKeyBinding) {\n              if (!viewState.mouseInEmuWebApp) {\n                return;\n              }\n            }\n            if (viewState.isEditing()) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              // preventing new line if saving not allowed\n              if (!viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())].legalLabels;\n                e.preventDefault();\n                e.stopPropagation();\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                scope.dials.open('views/error.html', 'ModalCtrl', 'Editing Error: Sorry, characters allowed on this Level are \"' + JSON.stringify(definitions) + '\"');\n              }\n              // save text on enter if saving is allowed\n              if (viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var editingElement = LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID());\n                var attrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n                HistoryService.addObjToUndoStack({\n                  'type': 'ANNOT',\n                  'action': 'RENAMELABEL',\n                  'name': viewState.getcurClickLevelName(),\n                  'id': LevelService.getlastID(),\n                  'attrIndex': attrIndex,\n                  'oldValue': editingElement.labels[attrIndex].value,\n                  'newValue': domElement.val()\n                });\n                LevelService.renameLabel(viewState.getcurClickLevelName(), LevelService.getlastID(), viewState.getCurAttrIndex(viewState.getcurClickLevelName()), $('.' + LevelService.getlasteditArea()).val());\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                viewState.setcurClickSegment(LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID()));\n              }\n              // escape from text if esc\n              if (code === ConfigProviderService.vals.keyMappings.esc) {\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n              }\n            } else if (viewState.getcursorInTextField() === false) {\n              LevelService.deleteEditArea();\n              // escape from open modal dialog\n              if (viewState.curState.permittedActions.length === 0 && code === ConfigProviderService.vals.keyMappings.esc) {\n                scope.dials.close();\n              }\n              // delegate keyboard keyMappings according to keyMappings of scope\n              // zoomAll\n              if (code === ConfigProviderService.vals.keyMappings.zoomAll) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n                } else {\n                }\n              }\n              // zoomIn\n              if (code === ConfigProviderService.vals.keyMappings.zoomIn) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(true, LevelService);\n                } else {\n                }\n              }\n              // zoomOut\n              if (code === ConfigProviderService.vals.keyMappings.zoomOut) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(false, LevelService);\n                } else {\n                }\n              }\n              // shiftViewPortLeft\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortLeft) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(false);\n                } else {\n                }\n              }\n              // shiftViewPortRight\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortRight) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(true);\n                } else {\n                }\n              }\n              // zoomSel\n              if (code === ConfigProviderService.vals.keyMappings.zoomSel) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                } else {\n                }\n              }\n              // playEntireFile\n              if (code === ConfigProviderService.vals.keyMappings.playEntireFile) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n                    viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n                  }\n                } else {\n                }\n              }\n              // playAllInView\n              if (code === ConfigProviderService.vals.keyMappings.playAllInView) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                    viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                  }\n                } else {\n                }\n              }\n              // playSelected\n              if (code === ConfigProviderService.vals.keyMappings.playSelected) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                    viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                  }\n                } else {\n                }\n              }\n              // selectFirstContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFirstContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 1;\n                  }\n                }\n              }\n              // selectSecondContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectSecondContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 2;\n                  }\n                }\n              }\n              // selectThirdContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectThirdContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 3;\n                  }\n                }\n              }\n              // selectFourthContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFourthContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 4;\n                  }\n                }\n              }\n              // selectNOContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectNoContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = undefined;\n                  }\n                }\n              }\n              // levelUp\n              if (code === ConfigProviderService.vals.keyMappings.levelUp) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n                }\n              }\n              // levelDown\n              if (code === ConfigProviderService.vals.keyMappings.levelDown) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(true, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass LevelService to prevent circular deps\n                }\n              }\n              // preselected boundary snap to top\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestTopBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseSegment();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(true, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist === false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary snap to bottom\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestBottomBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseSegment();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(false, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist == false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary to nearest zero crossing\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestZeroCrossing) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var dist;\n                    if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseSegment().sampleStart);\n                    } else {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseSegment().samplePoint);\n                    }\n                    if (dist !== 0) {\n                      var seg = viewState.getcurMouseSegment();\n                      var neigh = viewState.getcurMouseNeighbours();\n                      var levelname = viewState.getcurMouseLevelName();\n                      LevelService.moveBoundary(levelname, seg.id, dist, 0);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEBOUNDARY',\n                        'name': levelname,\n                        'id': seg.id,\n                        'movedBy': dist,\n                        'position': 0\n                      });\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // expand Segments\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickSegments(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'levelName': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickSegments(),\n                          'rightSide': true,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // expand Segment left\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickSegments(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'levelName': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickSegments(),\n                          'rightSide': false,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Left\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickSegments(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'levelName': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickSegments(),\n                          'rightSide': true,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Right\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickSegments(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'levelName': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickSegments(),\n                          'rightSide': false,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarLeft) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarRight) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n                  }\n                }\n              }\n              // select Segments in viewport selection\n              if (code === ConfigProviderService.vals.keyMappings.selectSegmentsInSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickLevelName() === undefined) {\n                    scope.dials.open('views/error.html', 'ModalCtrl', 'Selection Error : Please select a Level first');\n                  } else {\n                    viewState.selectSegmentsInSelection(LevelService.data.levels);\n                  }\n                }\n              }\n              // selPrevItem (arrow key left)\n              if (code === ConfigProviderService.vals.keyMappings.selPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickSegments().length > 0) {\n                    var idLeft = viewState.getcurClickSegments()[0].id;\n                    var idRight = viewState.getcurClickSegments()[viewState.getcurClickSegments().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.left !== undefined) {\n                      if (lastNeighboursMove.left.sampleStart !== undefined) {\n                        // check if in view\n                        if (lastNeighboursMove.left.sampleStart > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickSegmentMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickSegment(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      } else {\n                        // check if in view\n                        if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickSegmentMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickSegment(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // selNextItem (arrow key right)\n              if (code === ConfigProviderService.vals.keyMappings.selNextItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickSegments().length > 0) {\n                    var idLeft = viewState.getcurClickSegments()[0].id;\n                    var idRight = viewState.getcurClickSegments()[viewState.getcurClickSegments().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.right !== undefined) {\n                      // check if in view\n                      if (lastNeighboursMove.right.sampleStart + lastNeighboursMove.right.sampleDur < viewState.curViewPort.eS) {\n                        if (e.shiftKey) {\n                          // select multiple while shift\n                          viewState.setcurClickSegmentMultiple(lastNeighboursMove.right);\n                          LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          viewState.selectBoundary();\n                        } else {\n                          viewState.setcurClickSegment(lastNeighboursMove.right);\n                          LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                        }\n                      }\n                    } else {\n                    }\n                  }\n                }\n              }\n              // selNextPrevItem (tab key and tab+shift key)\n              if (code === ConfigProviderService.vals.keyMappings.selNextPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickSegments().length > 0) {\n                    var idLeft = viewState.getcurClickSegments()[0].id;\n                    var idRight = viewState.getcurClickSegments()[viewState.getcurClickSegments().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (e.shiftKey) {\n                      if (lastNeighboursMove.left !== undefined) {\n                        if (lastNeighboursMove.left.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.left.sampleStart + lastNeighboursMove.left.sampleDur > viewState.curViewPort.sS) {\n                            viewState.setcurClickSegment(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                            viewState.setcurClickSegment(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    } else {\n                      if (lastNeighboursMove.right !== undefined) {\n                        if (lastNeighboursMove.right.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.right.sampleStart < viewState.curViewPort.eS) {\n                            viewState.setcurClickSegment(lastNeighboursMove.right, lastNeighboursMove.right.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.right.samplePoint < viewState.curViewPort.eS) {\n                            viewState.setcurClickSegment(lastNeighboursMove.right, lastNeighboursMove.right.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // createNewItemAtSelection\n              if (code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.addItem) {\n                    if (viewState.getselectedRange().start === viewState.curViewPort.selectS && viewState.getselectedRange().end === viewState.curViewPort.selectE) {\n                      if (viewState.getcurClickSegments().length === 1) {\n                        // check if in view\n                        if (viewState.getselectedRange().start >= viewState.curViewPort.sS && viewState.getselectedRange().end <= viewState.curViewPort.eS) {\n                          viewState.setEditing(true);\n                          LevelService.openEditArea(viewState.getcurClickSegments()[0], LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                          scope.cursorInTextField();\n                        }\n                      } else {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Modify Error: Please select a single Segment.');\n                      }\n                    } else {\n                      if (viewState.curViewPort.selectE == -1 && viewState.curViewPort.selectS == -1) {\n                        scope.dials.open('views/error.html', 'ModalCtrl', 'Error : Please select a Segment or Point to modify it\\'s name. Or select a level plus a range in the viewport in order to insert a new Segment.');\n                      } else {\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var seg = LevelService.getClosestItem(viewState.curViewPort.selectS, viewState.getcurClickLevelName(), Soundhandlerservice.wavJSO.Data.length).current;\n                          if (seg.sampleStart === viewState.curViewPort.selectS && seg.sampleStart + seg.sampleDur + 1 === viewState.curViewPort.selectE) {\n                            viewState.setcurClickLevel(viewState.getcurClickLevelName(), viewState.getcurClickLevelType(), scope.$index);\n                            viewState.setcurClickSegment(seg.current);\n                            LevelService.setlasteditArea('_' + seg.id);\n                            viewState.setEditing(true);\n                            LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                            viewState.setEditing(true);\n                          } else {\n                            var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                            if (!insSeg.ret) {\n                              scope.dials.open('views/error.html', 'ModalCtrl', 'Error : You are not allowed to insert a Segment here.');\n                            } else {\n                              HistoryService.addObjToUndoStack({\n                                'type': 'ANNOT',\n                                'action': 'INSERTSEGMENTS',\n                                'name': viewState.getcurClickLevelName(),\n                                'start': viewState.curViewPort.selectS,\n                                'end': viewState.curViewPort.selectE,\n                                'ids': insSeg.ids,\n                                'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                              });\n                            }\n                          }\n                        } else {\n                          var levelDef = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n                          if (typeof levelDef.anagestConfig === 'undefined') {\n                            var insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, ConfigProviderService.vals.labelCanvasConfig.newEventName);\n                            if (insPoint.alreadyExists) {\n                              scope.dials.open('views/error.html', 'ModalCtrl', 'Error: You are not allowed to insert a Point here.');\n                            } else {\n                              HistoryService.addObjToUndoStack({\n                                'type': 'ANNOT',\n                                'action': 'INSERTEVENT',\n                                'name': viewState.getcurClickLevelName(),\n                                'start': viewState.curViewPort.selectS,\n                                'id': insPoint.id,\n                                'pointName': ConfigProviderService.vals.labelCanvasConfig.newEventName\n                              });\n                            }\n                          } else {\n                            AnagestService.insertAnagestEvents();\n                          }\n                        }\n                      }\n                    }\n                  } else {\n                  }\n                }\n              }\n              // undo\n              if (code === ConfigProviderService.vals.keyMappings.undo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.undo();\n                }\n              }\n              // redo\n              if (code === ConfigProviderService.vals.keyMappings.redo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.redo();\n                }\n              }\n              // deletePreselBoundary\n              if (code === ConfigProviderService.vals.keyMappings.deletePreselBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (!e.shiftKey) {\n                    if (ConfigProviderService.vals.restrictions.deleteItemBoundary) {\n                      var seg = viewState.getcurMouseSegment();\n                      var isFirst = viewState.getcurMouseisFirst();\n                      var isLast = viewState.getcurMouseisLast();\n                      var levelname = viewState.getcurMouseLevelName();\n                      var type = viewState.getcurMouseLevelType();\n                      if (seg !== undefined) {\n                        if (type === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteBoundary(levelname, seg.id, isFirst, isLast);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETEBOUNDARY',\n                            'name': levelname,\n                            'id': seg.id,\n                            'isFirst': isFirst,\n                            'isLast': isLast,\n                            'deletedSegment': deletedSegment\n                          });\n                          /* TODO RECALCULATE LINKS\n\t\t\t\t\t\t\tHistoryService.updateCurChangeObj({\n\t\t\t\t\t\t\t\t'type': 'ANNOT',\n\t\t\t\t\t\t\t\t'action': 'DELETELINKS',\n\t\t\t\t\t\t\t\t'name': levelname,\n\t\t\t\t\t\t\t\t'id': seg.id,\n\t\t\t\t\t\t\t\t'deletedLinks': deletedLinks\n\t\t\t\t\t\t\t});*/\n                          HistoryService.addCurChangeObjToUndoStack();\n                          // reset to undefined\n                          viewState.setcurMouseSegment(undefined, undefined, undefined);\n                          viewState.setcurClickSegment(deletedSegment.clickSeg);\n                        } else {\n                          var deletedPoint = LevelService.deleteEvent(levelname, seg.id);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETEEVENT',\n                            'name': levelname,\n                            'start': deletedPoint.samplePoint,\n                            'id': deletedPoint.id,\n                            'pointName': deletedPoint.labels[0].value\n                          });\n                          /* TODO RECALCULATE LINKS\n\t\t\t\t\t\t    HistoryService.updateCurChangeObj({\n\t\t\t\t\t\t\t  'type': 'ANNOT',\n\t\t\t\t\t\t\t  'action': 'DELETELINKS',\n\t\t\t\t\t\t\t  'name': levelname,\n\t\t\t\t\t\t\t  'id': seg.id,\n\t\t\t\t\t\t\t  'deletedLinks': deletedLinks\n\t\t\t\t\t\t    });*/\n                          HistoryService.addCurChangeObjToUndoStack();\n                          // reset to undefined\n                          viewState.setcurMouseSegment(undefined, undefined, undefined);\n                        }\n                      } else {\n                      }\n                    }\n                  } else {\n                    if (ConfigProviderService.vals.restrictions.deleteItem) {\n                      var seg = viewState.getcurClickSegments();\n                      if (seg !== undefined && seg.length > 0) {\n                        var levelname = viewState.getcurClickLevelName();\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteSegments(levelname, seg[0].id, seg.length);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETESEGMENTS',\n                            'name': levelname,\n                            'id': seg[0].id,\n                            'length': seg.length,\n                            'deletedSegment': deletedSegment\n                          });\n                          /* TODO RECALCULATE LINKS\n\t\t\t\t\t\t  HistoryService.updateCurChangeObj({\n\t\t\t\t\t\t\t'type': 'ANNOT',\n\t\t\t\t\t\t\t'action': 'DELETELINKS',\n\t\t\t\t\t\t\t'name': levelname,\n\t\t\t\t\t\t\t'id': seg.id,\n\t\t\t\t\t\t\t'deletedLinks': deletedLinks\n\t\t\t\t\t\t  });*/\n                          HistoryService.addCurChangeObjToUndoStack();\n                          viewState.setcurMouseSegment(undefined, undefined, undefined);\n                          viewState.setcurClickSegment(deletedSegment.clickSeg);\n                        } else {\n                          scope.dials.open('views/error.html', 'ModalCtrl', 'Delete Error: You can not delete Segments on Point Levels.');\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              if (!e.metaKey && !e.ctrlKey) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }\n          });\n        }\n        scope.safeApply = function (fn) {\n          var phase = this.$root.$$phase;\n          if (phase == '$apply' || phase == '$digest') {\n            if (fn && typeof fn === 'function') {\n              fn();\n            }\n          } else {\n            this.$apply(fn);\n          }\n        };\n        //remove binding on destroy\n        scope.$on('$destroy', function () {\n          $(window).off('keydown');\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('delete', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var name = scope.this.level.name;\n      element.bind('click', function () {\n        scope.vs.setcurClickLevelName(name, attr.delete);\n        scope.dials.open('views/deleteLevel.html', 'ModalCtrl', name);\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('resize', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element) {\n      var elem = element.parent().parent();\n      var elemHeight = 0;\n      var deleteButton = elem.find(element.parent().children()[0]);\n      var resizeButton = elem.find(element.parent().children()[1]);\n      var saveButton = elem.find(element.parent().children()[2]);\n      element.bind('click', function () {\n        if (scope.open) {\n          scope.open = false;\n          elemHeight = elem.css('height');\n          elem.css({ 'height': '30px' });\n          if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n            deleteButton.hide();\n          }\n          if (scope.cps.vals.activeButtons.saveSingleLevel) {\n            saveButton.hide();\n          }\n        } else {\n          scope.open = true;\n          elem.css({ 'height': elemHeight });\n          if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n            deleteButton.show();\n          }\n          if (scope.cps.vals.activeButtons.saveSingleLevel) {\n            saveButton.show();\n          }\n        }\n        scope.updateView();\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('enlarge', [\n  '$rootScope',\n  'viewState',\n  'ConfigProviderService',\n  function ($rootScope, viewState, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attrs) {\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          if (!$.isEmptyObject(ConfigProviderService.vals.perspectives)) {\n            if (!$.isEmptyObject(viewState.curPerspectiveIdx)) {\n              console.log(viewState.curPerspectiveIdx);\n              if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length === 1) {\n                element.hide();\n              } else {\n                element.show();\n              }\n            }\n          }\n        }, true);\n        var open = false;\n        element.bind('click', function () {\n          if (open) {\n            open = false;\n            viewState.setenlarge(-1);\n          } else {\n            open = true;\n            viewState.setenlarge(attrs.enlarge);\n          }\n          $rootScope.$apply();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('save', [\n  'dialogService',\n  'Espsparserservice',\n  function (dialogService, Espsparserservice) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        var name = scope.this.level.name;\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(name, attr.save);\n          Espsparserservice.asyncParseJSO(name).then(function (result) {\n            dialogService.openExport('views/export.html', 'ExportCtrl', result.data, name + '_esps.txt');\n          });\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('previewtrack', [\n  'viewState',\n  'Soundhandlerservice',\n  function (viewState, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element) {\n        var startPCM = -1;\n        ///////////////\n        // bindings\n        //\n        element.bind('click', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n            if (!viewState.isEditing()) {\n              scope.$apply(function () {\n                viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n              });\n            }\n          }\n        });\n        //\n        element.bind('mousedown', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n          }\n        });\n        //\n        element.bind('mousemove', function (x) {\n          var mbutton = 0;\n          if (x.buttons === undefined) {\n            mbutton = x.which;\n          } else {\n            mbutton = x.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            if (startPCM !== -1) {\n              var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n              startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n              if (!viewState.isEditing()) {\n                scope.$apply(function () {\n                  viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n                });\n              }\n            }\n            break;\n          }\n        });\n        //\n        element.bind('mouseup', function () {\n          startPCM = -1;\n        });\n        //\n        element.bind('mouseout', function () {\n          startPCM = -1;\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Iohandlerservice', [\n  '$rootScope',\n  '$http',\n  '$location',\n  '$q',\n  'HistoryService',\n  'viewState',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Espsparserservice',\n  'Ssffdataservice',\n  'Websockethandler',\n  function Iohandlerservice($rootScope, $http, $location, $q, HistoryService, viewState, Soundhandlerservice, Ssffparserservice, Wavparserservice, Textgridparserservice, ConfigProviderService, Espsparserservice, Ssffdataservice, Websockethandler) {\n    // shared service object\n    var sServObj = {};\n    // $http.defaults.useXDomain = true;\n    sServObj.wsH = Websockethandler;\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultConfig = function () {\n      var prom = $http.get('configFiles/default_emuwebappConfig.json');\n      return prom;\n    };\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetPath = function (path, respType) {\n      var prom = $http.get(path, { responseType: respType });\n      return prom;\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    /**\n\t\t *\n\t\t */\n    sServObj.getProtocol = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getProtocol not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getProtocol();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDoUserManagement = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDoUserManagement not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDoUserManagement();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.logOnUser = function (name, pwd) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of logOnUser not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.logOnUser(name, pwd);\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDBconfigFile = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDBconfigFile not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDBconfigFile();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_DBconfig.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundleList = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundleList not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundleList();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_bundleList.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundle = function (name, nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundle(name);\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + name + '_bndl.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.saveBundle = function (bundleData) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of saveBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.saveBundle(bundleData);\n      }\n      // else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n      // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n      // \tgetProm = $http.get('testData/testAeBundle.json'); // SIC SIC SIC HARDCODED -> name is ignored\n      // }\n      return getProm;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    /**\n\t\t * pass through to according parser\n\t\t */\n    sServObj.parseLabelFile = function (string, annotates, name, fileType) {\n      var prom;\n      if (fileType === 'ESPS') {\n        prom = Espsparserservice.asyncParseEsps(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedESPS');\n      } else if (fileType === 'TEXTGRID') {\n        prom = Textgridparserservice.asyncParseTextGrid(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTEXTGRID');\n      }\n      return prom;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Soundhandlerservice', [\n  '$document',\n  'Binarydatamaniphelper',\n  function Soundhandlerservice($document, Binarydatamaniphelper) {\n    // shared service object\n    var sServObj = {};\n    sServObj.wavJSO = {};\n    sServObj.player = $document[0].createElement('audio');\n    sServObj.player.isPlaying = false;\n    sServObj.setPlayerSrc = function (buf) {\n      var base64String = Binarydatamaniphelper.arrayBufferToBase64(buf);\n      this.player.src = 'data:audio/wav;base64,' + base64String;\n    };\n    sServObj.resetPlayerSrcFromTo = function (sampleStart, endSample) {\n      var bytePerSample = this.wavJSO.BitsPerSample / 8;\n      var header = this.wavJSO.origArrBuf.subarray(0, 44);\n      var data = this.wavJSO.origArrBuf.subarray(44, this.wavJSO.Data.length * bytePerSample);\n      var dv = new DataView(header);\n      dv.setUint32(40, (endSample - sampleStart) * bytePerSample, true);\n      // var Subchunk2Size = dv.getUint32(40, true);\n      // console.log(Subchunk2Size);\n      var newData = data.subarray(sampleStart * bytePerSample, (endSample - sampleStart) * bytePerSample);\n      var tmp = new Uint8Array(header.byteLength + newData.byteLength);\n      tmp.set(new Uint8Array(header), 0);\n      tmp.set(new Uint8Array(newData), header.byteLength);\n      var base64String = Binarydatamaniphelper.arrayBufferToBase64(tmp.buffer);\n      this.player.src = 'data:audio/wav;base64,' + base64String;\n    };\n    sServObj.playFromTo = function (sampleStart, endSample) {\n      this.resetPlayerSrcFromTo(sampleStart, endSample);\n      if (this.player.isPlaying) {\n        this.player.isPlaying = false;\n        this.player.pause();\n      } else {\n        this.player.isPlaying = true;\n        this.player.play();\n      }\n    };\n    sServObj.player.addEventListener('ended', function () {\n      this.isPlaying = false;\n    }, false);\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('drawssff', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'HistoryService',\n  'fontScaleService',\n  function (viewState, ConfigProviderService, Ssffdataservice, HistoryService, fontScaleService) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function postLink(scope, element, atts) {\n        var canvas = element[0];\n        var trackName;\n        var assTrackName = '';\n        var lastDraw = Date.now();\n        // add watch vars to scope\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.ssffds = Ssffdataservice;\n        ////////////////////\n        // observes\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          trackName = val;\n        });\n        ////////////////////\n        // watches\n        //watch viewPort change\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n            handleUpdate(newValue, oldValue);\n          }\n        }, true);\n        //watch perspective change\n        scope.$watch('vs.curPerspectiveIdx', function (newValue, oldValue) {\n          handleUpdate(newValue, oldValue);\n        }, true);\n        //watch vs.curCorrectionToolNr change\n        scope.$watch('vs.curCorrectionToolNr', function (newValue, oldValue) {\n          handleUpdate(newValue, oldValue);\n        }, true);\n        //watch hists.\n        scope.$watch('hists.movesAwayFromLastSave', function (newValue, oldValue) {\n          handleUpdate(newValue, oldValue);\n        }, true);\n        // watch ssffds.data change\n        scope.$watch('ssffds.data.length', function (newValue, oldValue) {\n          handleUpdate(newValue, oldValue);\n        }, true);\n        // watch vs.spectroSettings change\n        scope.$watch('vs.spectroSettings', function (newValue, oldValue) {\n          handleUpdate(newValue, oldValue);\n        }, true);\n        //\n        //////////////////////\n        /**\n         *\n         */\n        function handleUpdate() {\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          if (!$.isEmptyObject(Ssffdataservice.data)) {\n            if (Ssffdataservice.data.length !== 0) {\n              assTrackName = '';\n              // check assignments (= overlays)\n              ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign.forEach(function (ass, i) {\n                if (ass.signalCanvasName === trackName) {\n                  assTrackName = ass.ssffTrackName;\n                  var tr = ConfigProviderService.getSsffTrackConfig(ass.ssffTrackName);\n                  var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                  var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                  // draw values  \n                  drawValues(viewState, canvas, ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n                }\n              });\n              assTrackName = '';\n              // draw ssffTrack onto own canvas\n              if (trackName !== 'OSCI' && trackName !== 'SPEC') {\n                // console.log('#######here')\n                // console.log(trackName)\n                var tr = ConfigProviderService.getSsffTrackConfig(trackName);\n                var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                // draw values  \n                drawValues(viewState, canvas, ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n              }\n            }\n          } else {\n            var ctx = canvas.getContext('2d');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n          }\n        }\n        /**\n         * draw values onto canvas\n         */\n        function drawValues(viewState, canvas, config, col, sR, sT, minMaxLims) {\n          var ctx = canvas.getContext('2d');\n          // create a destination canvas. Here the altered image will be placed\n          // ctx.fillStyle = \"rgba(\" + transparentColor.r + \", \" + transparentColor.g + \", \" + transparentColor.b + \", 1.0)\";\n          // ctx.clearRect(0, 0, canvas.width, canvas.height);\n          var minVal, maxVal;\n          if (trackName === 'SPEC' && assTrackName === 'FORMANTS') {\n            minVal = viewState.spectroSettings.rangeFrom;\n            maxVal = viewState.spectroSettings.rangeTo;\n          } else {\n            minVal = col._minVal;\n            maxVal = col._maxVal;\n          }\n          var startTimeVP = viewState.getViewPortStartTime();\n          var endTimeVP = viewState.getViewPortEndTime();\n          var colStartSampleNr = Math.round(startTimeVP * sR + sT);\n          var colEndSampleNr = Math.round(endTimeVP * sR + sT);\n          var nrOfSamples = colEndSampleNr - colStartSampleNr;\n          // console.log('###################################');\n          // console.log(col.name);\n          // console.log(startTimeVP);\n          // console.log(endTimeVP);\n          var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n          if (nrOfSamples < canvas.width && nrOfSamples >= 2) {\n            var x, y, prevX, prevY, prevVal, curSampleInCol, curSampleInColTime;\n            ////////////////////////////////\n            // NEW VERSION\n            ////////////////////////////////\n            angular.forEach(curSampleArrs[0], function (contourVal, contourNr) {\n              // console.log(contourNr);\n              if ($.isEmptyObject(minMaxLims) || contourNr >= minMaxLims.minContourIdx && contourNr <= minMaxLims.maxContourIdx) {\n                // set color\n                if ($.isEmptyObject(minMaxLims)) {\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                } else {\n                  var l = minMaxLims.maxContourIdx - minMaxLims.minContourIdx + 1;\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                }\n                // overwrite color settings if they are preconfigured\n                var contColors = ConfigProviderService.getContourColorsOfTrack(assTrackName);\n                if (contColors !== undefined) {\n                  if (contColors.colors[contourNr] !== undefined) {\n                    ctx.strokeStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                    ctx.fillStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                  }\n                }\n                // mark selected\n                // console.log(viewState.curCorrectionToolNr);\n                if (viewState.curCorrectionToolNr - 1 === contourNr && trackName === 'SPEC' && assTrackName === 'FORMANTS') {\n                  ctx.strokeStyle = ConfigProviderService.vals.colors.selectedContourColor;\n                  ctx.fillStyle = ConfigProviderService.vals.colors.selectedContourColor;\n                }\n                ctx.beginPath();\n                // first line from sample not in view (left)\n                if (colStartSampleNr >= 1) {\n                  var leftBorder = col.values[colStartSampleNr - 1];\n                  var leftVal = leftBorder[contourNr];\n                  curSampleInCol = colStartSampleNr - 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (leftVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.moveTo(x, y);\n                }\n                angular.forEach(curSampleArrs, function (curArr, curArrIdx) {\n                  // console.log(curArr[contourNr]);\n                  curSampleInCol = colStartSampleNr + curArrIdx;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (curArr[contourNr] - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                  ctx.lineTo(x, y);\n                });\n                // last line from sample not in view (right)\n                if (colEndSampleNr < col.values.length - 1) {\n                  var rightBorder = col.values[colEndSampleNr + 1];\n                  var rightVal = rightBorder[contourNr];\n                  curSampleInCol = colEndSampleNr + 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (rightVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.lineTo(x, y);\n                }\n                ctx.stroke();  // ctx.fill();\n              }\n            });  ////////////////////////////////\n                 // OLD VERSION\n                 ////////////////////////////////\n                 // curSampleArrs.forEach(function (valRep, valIdx) {\n                 //   valRep.forEach(function (val, idx) {\n                 //     if ($.isEmptyObject(minMaxLims) || (idx >= minMaxLims.min && idx <= minMaxLims.max)) {\n                 //       curSampleInCol = colStartSampleNr + valIdx;\n                 //       curSampleInColTime = (1 / sR * curSampleInCol) + sT;\n                 //       x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                 //       y = canvas.height - ((val - minVal) / (maxVal - minVal) * canvas.height);\n                 //       // set color\n                 //       if ($.isEmptyObject(minMaxLims)) {\n                 //         ctx.strokeStyle = 'hsl(' + idx * (360 / valRep.length) + ',80%, 50%)';\n                 //         ctx.fillStyle = 'hsl(' + idx * (360 / valRep.length) + ',80%, 50%)';\n                 //       } else {\n                 //         var l = (minMaxLims.max - minMaxLims.min) + 1;\n                 //         ctx.strokeStyle = 'hsl(' + idx * (360 / l) + ',80%, 50%)';\n                 //         ctx.fillStyle = 'hsl(' + idx * (360 / l) + ',80%, 50%)';\n                 //       }\n                 //       // draw dot\n                 //       // if (val !== null) {\n                 //       //   ctx.beginPath();\n                 //       //   ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                 //       //   ctx.closePath();\n                 //       //   ctx.stroke();\n                 //       //   ctx.fill();\n                 //       // }\n                 //       if (valIdx !== 0) {\n                 //         curSampleInCol = colStartSampleNr + valIdx - 1;\n                 //         curSampleInColTime = (1 / sR * curSampleInCol) + sT;\n                 //         prevX = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                 //         prevY = canvas.height - ((curSampleArrs[valIdx - 1][idx] - minVal) / (maxVal - minVal) * canvas.height);\n                 //         // mark selected\n                 //         if (viewState.curCorrectionToolNr - 1 === idx && trackName === 'SPEC' && assTrackName === 'FORMANTS') {\n                 //           ctx.strokeStyle = 'white';\n                 //           ctx.fillStyle = 'white';\n                 //         }\n                 //         // draw line\n                 //         if (val !== null && prevVal !== null) {\n                 //           ctx.beginPath();\n                 //           ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                 //           ctx.moveTo(prevX, prevY);\n                 //           ctx.lineTo(x, y);\n                 //           ctx.stroke();\n                 //           ctx.fill();\n                 //         }\n                 //         prevVal = val;\n                 //         //check if last sample\n                 //         if (valIdx === curSampleArrs.length - 1) {\n                 //           if (colEndSampleNr !== col.values.length - 1) {\n                 //             // lines to right boarder samples not in view\n                 //             var rightBorder = col.values[colEndSampleNr + 1];\n                 //             val = rightBorder[idx];\n                 //             curSampleInCol = colEndSampleNr + 1;\n                 //             curSampleInColTime = (1 / sR * curSampleInCol) + sT;\n                 //             var nextX = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                 //             var nextY = canvas.height - ((val - minVal) / (maxVal - minVal) * canvas.height);\n                 //             // draw line\n                 //             ctx.beginPath();\n                 //             ctx.moveTo(x, y);\n                 //             ctx.lineTo(nextX, nextY);\n                 //             ctx.stroke();\n                 //             ctx.fill();\n                 //           }\n                 //         }\n                 //       } else {\n                 //         // lines to left boarder samples not in view\n                 //         if (colStartSampleNr !== 0) {\n                 //           var leftBorder = col.values[colStartSampleNr - 1];\n                 //           val = leftBorder[idx];\n                 //           curSampleInCol = colStartSampleNr - 1;\n                 //           curSampleInColTime = (1 / sR * curSampleInCol) + sT;\n                 //           prevX = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                 //           prevY = canvas.height - ((val - minVal) / (maxVal - minVal) * canvas.height);\n                 //           // mark selected\n                 //           if (viewState.curCorrectionToolNr - 1 === idx && trackName === 'SPEC' && assTrackName === 'FORMANTS') {\n                 //             ctx.strokeStyle = 'white';\n                 //             ctx.fillStyle = 'white';\n                 //           }\n                 //           // draw line\n                 //           ctx.beginPath();\n                 //           ctx.moveTo(prevX, prevY);\n                 //           ctx.lineTo(x, y);\n                 //           ctx.stroke();\n                 //           ctx.fill();\n                 //         }\n                 //       }\n                 //     }\n                 //   });\n                 // });\n          } else {\n            ctx.strokeStyle = 'red';\n            var txt;\n            // var tW;\n            var horizontalText;\n            if (nrOfSamples <= 2) {\n              horizontalText = fontScaleService.getTextImageTwoLines(ctx, 'Zoom out to', 'see contour(s)', ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor);\n              // ctx.fillStyle = ConfigProviderService.vals.colors.levelColor;\n              // ctx.fillRect(0, 0, canvas.width, canvas.height);\n              ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, canvas.width / 2 - horizontalText.width / 2, 25, horizontalText.width, horizontalText.height);\n            } else {\n              txt = 'Zoom in to see contour(s)';\n              horizontalText = fontScaleService.getTextImageTwoLines(ctx, 'Zoom in to', 'see contour(s)', ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor);\n              // ctx.fillStyle = ConfigProviderService.vals.colors.levelColor;\n              // ctx.fillRect(0, 0, canvas.width, canvas.height);              \n              ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, canvas.width / 2 - horizontalText.width / 2, 25, horizontalText.width, horizontalText.height);\n            }\n          }\n        }  //function\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffparserservice', [\n  '$q',\n  function Ssffparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new Worker('scripts/workers/ssffParserWorker.js');\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.addEventListener('message', function (e) {\n      if (e.data.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseSsffArr = function (ssffArray) {\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'parseArr',\n        'ssffArr': ssffArray\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * convert jso to ssff binary file using webworker\n\t\t * @param java script object of ssff file (internal rep)\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncJso2ssff = function (jso) {\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'jso2ssff',\n        'jso': JSON.stringify(jso)\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('mouseTrackAndCorrectionTool', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'Drawhelperservice',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, Drawhelperservice, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element, atts) {\n        var curMouseSample;\n        var dragStartSample;\n        var dragEndSample;\n        var canvas = element[0];\n        var ctx = canvas.getContext('2d');\n        // var elem = element[0];\n        var tr, col, sRaSt;\n        var trackName;\n        var bundleName;\n        /////////////////////////////\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        // bundleName needed to reset tr, col, sRaSt on bundle change\n        atts.$observe('bundleName', function (val) {\n          if (val) {\n            bundleName = val;\n            if (!$.isEmptyObject(Ssffdataservice.data)) {\n              if (Ssffdataservice.data.length !== 0) {\n                tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                if (tr !== undefined) {\n                  col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                }\n              }\n            }\n          }\n        });\n        /////////////////////////////\n        // Bindings\n        element.bind('mousedown', function (event) {\n          dragStartSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          dragEndSample = dragStartSample;\n          viewState.select(dragStartSample, dragStartSample);\n          //Drawhelperservice.drawViewPortTimes(ctx, true);\n          switchMarkupContext(event);\n          scope.$apply();\n        });\n        element.bind('mousemove', function (event) {\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          // perform mouse tracking\n          var mouseX = viewState.getX(event);\n          viewState.curMousePosSample = Math.round(viewState.curViewPort.sS + mouseX / element[0].width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n          switch (mbutton) {\n          case 0:\n            if (viewState.getPermission('labelAction')) {\n              switchMarkupContext(event);\n              if (!$.isEmptyObject(Ssffdataservice.data)) {\n                if (Ssffdataservice.data.length !== 0) {\n                  if (!viewState.getdragBarActive()) {\n                    if (viewState.curCorrectionToolNr !== undefined && !viewState.getdragBarActive() && !$.isEmptyObject(ConfigProviderService.getAssignment(trackName))) {\n                      // var col = Ssffdataservice.data[0].Columns[0];\n                      if (tr === undefined) {\n                        tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                        col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                        sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                      }\n                      var startTimeVP = viewState.getViewPortStartTime();\n                      var endTimeVP = viewState.getViewPortEndTime();\n                      var colStartSampleNr = Math.round(startTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var colEndSampleNr = Math.round(endTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n                      var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n                      // console.log(colStartSampleNr)\n                      var curMouseTime = startTimeVP + viewState.getX(event) / event.originalEvent.target.width * (endTimeVP - startTimeVP);\n                      var curMouseSample = Math.round((curMouseTime + sRaSt.startTime) * sRaSt.sampleRate) - 1;\n                      //-1 for in view correction\n                      var curMouseSampleTime = 1 / sRaSt.sampleRate * curMouseSample + sRaSt.startTime;\n                      if (curMouseSample - colStartSampleNr < 0 || curMouseSample - colStartSampleNr >= curSampleArrs.length) {\n                        console.log('early return');\n                        return;\n                      }\n                      viewState.curPreselColumnSample = curMouseSample - colStartSampleNr;\n                      var x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                      var y = canvas.height - curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                      // draw sample\n                      ctx.strokeStyle = 'black';\n                      ctx.fillStyle = 'black';\n                      ctx.beginPath();\n                      ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                      ctx.closePath();\n                      ctx.stroke();\n                      ctx.fill();\n                      if (event.shiftKey) {\n                        var oldValue = angular.copy(curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1]);\n                        var newValue = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        // SIC only using rangeTo\n                        curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        var updateObj = HistoryService.updateCurChangeObj({\n                            'type': 'SSFF',\n                            'trackName': tr.name,\n                            'sampleBlockIdx': colStartSampleNr + viewState.curPreselColumnSample,\n                            'sampleIdx': viewState.curCorrectionToolNr - 1,\n                            'oldValue': oldValue,\n                            'newValue': newValue\n                          });\n                        //draw updateObj as overlay\n                        for (var key in updateObj) {\n                          curMouseSampleTime = 1 / sRaSt.sampleRate * updateObj[key].sampleBlockIdx + sRaSt.startTime;\n                          x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                          y = canvas.height - updateObj[key].newValue / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                          // draw sample\n                          ctx.strokeStyle = 'red';\n                          ctx.fillStyle = 'red';\n                          // ctx.lineWidth = 4;\n                          ctx.beginPath();\n                          ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                          ctx.closePath();\n                          ctx.stroke();\n                          ctx.fill();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            break;\n          case 1:\n            if (!viewState.getdragBarActive()) {\n              setSelectDrag(event);\n            }\n            break;\n          }\n          scope.$apply();\n        });\n        element.bind('mouseup', function (event) {\n          if (!viewState.getdragBarActive()) {\n            setSelectDrag(event);\n            switchMarkupContext(event);\n          }\n        });\n        // on mouse leave clear markup canvas\n        element.bind('mouseleave', function (event) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // if (!$.isEmptyObject(Ssffdataservice.data)) {\n              // if (Ssffdataservice.data.length !== 0) {\n              if (!viewState.getdragBarActive()) {\n                if (viewState.getPermission('labelAction')) {\n                  switchMarkupContext(event, false);\n                }\n              }  // }\n                 // }\n            }\n          }\n        });\n        //\n        ////////////////////\n        function switchMarkupContext(event, leave) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          // draw current viewport selected\n          if (atts.ssffTrackname == 'OSCI') {\n            Drawhelperservice.drawViewPortTimes(ctx, true);\n            Drawhelperservice.drawCurViewPortSelected(ctx, true);\n          } else if (atts.ssffTrackname == 'SPEC') {\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, '', viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 2);\n          } else {\n            var tr = ConfigProviderService.getSsffTrackConfig(atts.ssffTrackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, atts.ssffTrackname, col._minVal, col._maxVal, 2);\n          }\n          // draw crossHairs\n          if (leave !== false && ConfigProviderService.vals.restrictions.drawCrossHairs) {\n            Drawhelperservice.drawCrossHairs(ctx, event, viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 'Hz', atts.ssffTrackname);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n        }\n        function setSelectDrag(event) {\n          curMouseSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          if (curMouseSample > dragStartSample) {\n            dragEndSample = curMouseSample;\n            viewState.select(dragStartSample, dragEndSample);\n          } else {\n            dragStartSample = curMouseSample;\n            viewState.select(dragStartSample, dragEndSample);\n          }\n          scope.$apply();\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Drawhelperservice', [\n  'viewState',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'fontScaleService',\n  'Ssffdataservice',\n  function Drawhelperservice(viewState, ConfigProviderService, Soundhandlerservice, fontScaleService, Ssffdataservice) {\n    //shared service object to be returned\n    var sServObj = {};\n    function getScale(ctx, str, scale) {\n      return ctx.measureText(str).width * scale;\n    }\n    function getScaleWidth(ctx, str1, str2, scaleX) {\n      if (str1.toString().length > str2.toString().length) {\n        return getScale(ctx, str1, scaleX);\n      } else {\n        return getScale(ctx, str2, scaleX);\n      }\n    }\n    /**\n\t\t * drawing method to draw single line between two\n\t\t * envelope points. Is used by drawOsciOnCanvas if\n\t\t * envelope drawing is done\n\t\t * @param index\n\t\t * @param value\n\t\t * @param max\n\t\t * @param prevPeak\n\t\t * @param canvas\n\t\t */\n    function drawFrame(viewState, index, value, max, prevPeak, canvas, config) {\n      var ctx = canvas.getContext('2d');\n      //cur\n      var w = 1;\n      var h = Math.round(value * (canvas.height / max));\n      //rel to max\n      var x = index * w;\n      var y = Math.round((canvas.height - h) / 2);\n      //prev\n      // var prevW = 1;\n      var prevH = Math.round(prevPeak * (canvas.height / max));\n      var prevX = (index - 1) * w;\n      var prevY = Math.round((canvas.height - prevH) / 2);\n      // if (posC >= x) {\n      // \tconsole.error('here...')\n      // \tctx.fillStyle = config.vals.colors.playProgressColor;\n      // \tctx.strokeStyle = config.vals.colors.playProgressColor;\n      // } else {\n      ctx.fillStyle = config.vals.colors.osciColor;\n      ctx.strokeStyle = config.vals.colors.osciColor;\n      // }\n      // ctx.beginPath();\n      ctx.moveTo(prevX, prevY);\n      ctx.lineTo(x, y);  // ctx.stroke();\n    }\n    sServObj.osciPeaks = [];\n    /**\n\t\t * get current peaks to be drawn\n\t\t * if drawing over sample exact -> samples\n\t\t * if multiple samples per pixel -> calculate envelope points\n\t\t */\n    sServObj.calculatePeaks = function (viewState, canvas, data) {\n      var samplePerPx = (viewState.curViewPort.eS + 1 - viewState.curViewPort.sS) / canvas.width;\n      // PCM Samples per new pixel + one to correct for subtraction\n      var numberOfChannels = 1;\n      // hardcode for now...\n      var peaks = [];\n      var minPeak = Infinity;\n      var maxPeak = -Infinity;\n      var relData;\n      if (samplePerPx <= 1) {\n        // check if view at start            \n        if (viewState.curViewPort.sS === 0) {\n          relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        } else {\n          relData = data.subarray(viewState.curViewPort.sS - 1, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        }\n        minPeak = Math.min.apply(Math, relData);\n        maxPeak = Math.max.apply(Math, relData);\n        peaks = Array.prototype.slice.call(relData);\n      } else {\n        relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        for (var curPxIdx = 0; curPxIdx < canvas.width; curPxIdx++) {\n          var avrVal = 0;\n          for (var c = 0; c < numberOfChannels; c++) {\n            var vals = relData.subarray(curPxIdx * samplePerPx, (curPxIdx + 1) * samplePerPx);\n            // var peak = -Infinity;\n            var sum = 0;\n            for (var p = 0, l = vals.length; p < l; p++) {\n              // if (vals[p] > peak) {\n              // \tpeak = vals[p];\n              // }\n              sum += vals[p];\n            }\n            avrVal += sum / vals.length;\n          }\n          peaks[curPxIdx] = avrVal;\n          if (avrVal > maxPeak) {\n            maxPeak = avrVal;\n          }\n        }\n      }\n      //else\n      return {\n        'peaks': peaks,\n        'minPeak': minPeak,\n        'maxPeak': maxPeak,\n        'samplePerPx': samplePerPx\n      };\n    };\n    /**\n\t\t * @param cps color provider service\n\t\t */\n    sServObj.freshRedrawDrawOsciOnCanvas = function (viewState, canvas, allPeakVals, buffer, config) {\n      var ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      //set font\n      // ctx.font = (this.params.fontPxSize + \"px\" + \" \" + this.params.fontType);\n      if (allPeakVals.peaks && allPeakVals.samplePerPx >= 1) {\n        ctx.beginPath();\n        allPeakVals.peaks.forEach(function (peak, index) {\n          if (index !== 0) {\n            drawFrame(viewState, index, peak, allPeakVals.maxPeak, allPeakVals.peaks[index - 1], canvas, config);\n          }\n        });\n        ctx.stroke();\n      } else if (allPeakVals.samplePerPx < 1) {\n        // console.log(\"at 0 over sample exact\")\n        var hDbS = 1 / allPeakVals.samplePerPx / 2;\n        // half distance between samples\n        var sNr = viewState.curViewPort.sS;\n        // over sample exact\n        ctx.strokeStyle = config.vals.colors.osciColor;\n        ctx.fillStyle = config.vals.colors.osciColor;\n        // ctx.beginPath();\n        var i;\n        if (viewState.curViewPort.sS === 0) {\n          ctx.moveTo(hDbS, (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.strokeText(sNr, i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        } else {\n          //draw lines\n          ctx.beginPath();\n          ctx.moveTo(-hDbS, canvas.height - (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx - hDbS, canvas.height - ((allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height + 3));\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.fillText(sNr, i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        }\n      }\n      if (config.vals.restrictions.drawZeroLine) {\n        // draw zero line\n        ctx.strokeStyle = config.vals.colors.zeroLineColor;\n        ctx.fillStyle = config.vals.colors.zeroLineColor;\n        // see if Chrome ->dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([2]);\n        }\n        if (allPeakVals.samplePerPx >= 1) {\n          ctx.beginPath();\n          ctx.moveTo(0, canvas.height / 2);\n          ctx.lineTo(canvas.width, canvas.height / 2);\n          ctx.stroke();\n          ctx.fillText('0', 5, canvas.height / 2 - 5, canvas.width);\n        } else {\n          var zeroLineY = canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height;\n          ctx.beginPath();\n          ctx.moveTo(0, zeroLineY);\n          ctx.lineTo(canvas.width, zeroLineY);\n          ctx.stroke();\n          ctx.fill();\n          ctx.fillText('0', 5, canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 5, canvas.width);\n        }\n        // see if Chrome ->dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([0]);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawMovingBoundaryLine\n\t\t */\n    sServObj.drawMovingBoundaryLine = function (ctx) {\n      var xOffset, sDist;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      if (viewState.movingBoundary) {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedBoundaryColor;\n        var p = Math.round(viewState.getPos(ctx.canvas.width, viewState.movingBoundarySample));\n        if (viewState.getcurMouseisLast()) {\n          ctx.fillRect(p + sDist, 0, 1, ctx.canvas.height);\n        } else {\n          ctx.fillRect(p + xOffset, 0, 1, ctx.canvas.height);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCurViewPortSelected\n\t\t */\n    sServObj.drawCurViewPortSelected = function (ctx, drawTimeAndSamples) {\n      var xOffset, sDist, space, horizontalText, scaleX;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'seg') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      var posS = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectS);\n      var posE = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectE);\n      if (posS === posE) {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedBorderColor;\n        ctx.fillRect(posS + xOffset, 0, 2, ctx.canvas.height);\n        if (drawTimeAndSamples) {\n          if (viewState.curViewPort.sS !== viewState.curViewPort.selectS && viewState.curViewPort.selectS !== -1) {\n            scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n            space = getScaleWidth(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posE + 5, 0, horizontalText.width, horizontalText.height);\n          }\n        }\n      } else {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedAreaColor;\n        ctx.fillRect(posS, 0, posE - posS, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.vals.colors.selectedBorderColor;\n        ctx.beginPath();\n        ctx.moveTo(posS, 0);\n        ctx.lineTo(posS, ctx.canvas.height);\n        ctx.moveTo(posE, 0);\n        ctx.lineTo(posE, ctx.canvas.height);\n        ctx.closePath();\n        ctx.stroke();\n        if (drawTimeAndSamples) {\n          // start values\n          scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          space = getScaleWidth(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posS - space - 5, 0, horizontalText.width, horizontalText.height);\n          // end values\n          horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectE, viewState.round(viewState.curViewPort.selectE / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posE + 5, 0, horizontalText.width, horizontalText.height);\n          // dur values\n          // check if space\n          space = getScale(ctx, viewState.round((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          if (posE - posS > space) {\n            var str1 = viewState.curViewPort.selectE - viewState.curViewPort.selectS - 1;\n            var str2 = viewState.round((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6);\n            space = getScaleWidth(ctx, str1, str2, scaleX);\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, str1, str2, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posS + (posE - posS) / 2 - space / 2, 0, horizontalText.width, horizontalText.height);\n          }\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCrossHairs\n\t\t */\n    sServObj.drawCrossHairs = function (ctx, mouseEvt, min, max, unit, trackname) {\n      if (ConfigProviderService.vals.restrictions.drawCrossHairs) {\n        // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.vals.colors.crossHairsColor;\n        ctx.fillStyle = ConfigProviderService.vals.colors.crossHairsColor;\n        // see if Chrome -> dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([2]);\n        }\n        // draw lines\n        var mouseX = viewState.getX(mouseEvt);\n        var mouseY = viewState.getY(mouseEvt);\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([0]);\n        }\n        // draw frequency / sample / time\n        ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n        var mouseFreq = viewState.round(max - mouseY / ctx.canvas.height * max, 2);\n        // SIC only uses max\n        var tW = ctx.measureText(mouseFreq + unit).width;\n        var s1 = Math.round(viewState.curViewPort.sS + mouseX / ctx.canvas.width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n        var s2 = viewState.round(viewState.getViewPortStartTime() + mouseX / ctx.canvas.width * (viewState.getViewPortEndTime() - viewState.getViewPortStartTime()), 6);\n        var horizontalText = fontScaleService.getTextImage(ctx, mouseFreq + unit, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n        var verticalText = fontScaleService.getTextImageTwoLines(ctx, s1, s2, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n        if (max !== undefined || min !== undefined) {\n          if (trackname == 'OSCI') {\n            // no horizontal values\t\t\n            ctx.beginPath();\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(5, mouseY + 5);\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(ctx.canvas.width, mouseY);\n            //ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else if (trackname == 'SPEC') {\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, mouseY, horizontalText.width, horizontalText.height);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, horizontalText.width, horizontalText.height);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else {\n            // draw min max an name of track\n            var tr = ConfigProviderService.getSsffTrackConfig(trackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            mouseFreq = viewState.round(col._maxVal - mouseY / ctx.canvas.height * col._maxVal, 2);\n            horizontalText = fontScaleService.getTextImage(ctx, mouseFreq, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, mouseY, horizontalText.width, horizontalText.height);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, horizontalText.width, horizontalText.height);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          }\n        }\n        ctx.drawImage(verticalText, 0, 0, verticalText.width, verticalText.height, mouseX + 5, 0, verticalText.width, verticalText.height);\n      }\n    };\n    /**\n\t\t * drawing method to drawMinMaxAndName\n\t\t * @param ctx is context to be drawn on\n\t\t * @param trackName name of track to be drawn in the center of the canvas (left aligned)\n\t\t * @param min value to be drawn at the bottom of the canvas (left aligned)\n\t\t * @param max value to be drawn at the top of the canvas (left aligned)\n\t\t * @param round value to round to for min/max values (== digits after comma)\n\t\t */\n    sServObj.drawMinMaxAndName = function (ctx, trackName, min, max, round) {\n      // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      ctx.strokeStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.fillStyle = ConfigProviderService.vals.colors.labelColor;\n      // var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var smallFontSize = ConfigProviderService.vals.font.fontPxSize * 3 / 4;\n      var th = smallFontSize * scaleY;\n      // draw corner pointers\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(0, ctx.canvas.height);\n      ctx.lineTo(5, ctx.canvas.height - 5);\n      ctx.stroke();\n      ctx.closePath();\n      // draw ssffTrackName\n      if (trackName !== '') {\n        ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n        var trackNameImg = fontScaleService.getTextImage(ctx, trackName, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n        ctx.drawImage(trackNameImg, 0, ctx.canvas.height / 2 - ConfigProviderService.vals.font.fontPxSize * scaleY / 2);\n      }\n      // draw min/max vals\n      if (max !== undefined) {\n        var labelTxtImg = fontScaleService.getTextImage(ctx, 'max: ' + viewState.round(max, round), smallFontSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.endBoundaryColor);\n        ctx.drawImage(labelTxtImg, 5, 5, labelTxtImg.width, labelTxtImg.height);\n      }\n      // draw min/max vals\n      if (min !== undefined) {\n        labelTxtImg = fontScaleService.getTextImage(ctx, 'min: ' + viewState.round(min, round), smallFontSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.endBoundaryColor);\n        ctx.drawImage(labelTxtImg, 5, ctx.canvas.height - th - 5, labelTxtImg.width, labelTxtImg.height);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.drawViewPortTimes = function (ctx) {\n      ctx.strokeStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.fillStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n      // lines to corners\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(ctx.canvas.width, 0);\n      ctx.lineTo(ctx.canvas.width - 5, 5);\n      ctx.closePath();\n      ctx.stroke();\n      var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var sTime;\n      var eTime;\n      var horizontalText;\n      var space;\n      if (viewState.curViewPort) {\n        //draw time and sample nr\n        sTime = viewState.round(viewState.curViewPort.sS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        eTime = viewState.round(viewState.curViewPort.eS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.sS, sTime, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n        // ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 0, 0, horizontalText.width, horizontalText.height);\n        ctx.drawImage(horizontalText, 5, 5);\n        space = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n        horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.eS, eTime, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n        ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - space - 5, 0, horizontalText.width, horizontalText.height);  //draw dot at edge of image\n                                                                                                                                                                         // var spaceW = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n                                                                                                                                                                         // var startPoint = (Math.PI / 180) * 0;\n                                                                                                                                                                         // var endPoint = (Math.PI / 180) * 360;\n                                                                                                                                                                         // ctx.beginPath();\n                                                                                                                                                                         // ctx.arc(spaceW, config.vals.font.fontPxSize * 2 * scaleY, 10, startPoint, endPoint, true);\n                                                                                                                                                                         // ctx.fill();\n                                                                                                                                                                         // ctx.closePath();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HistoryService', [\n  '$log',\n  'Ssffdataservice',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'viewState',\n  'Soundhandlerservice',\n  function HistoryService($log, Ssffdataservice, LevelService, LinkService, ConfigProviderService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    sServObj.movesAwayFromLastSave = 0;\n    //////////////////////////////////////////\n    // new dual stack implementation\n    //private\n    var undoStack = [];\n    var redoStack = [];\n    var curChangeObj = {};\n    // applyChanges should be called by undo redo functions\n    function applyChange(changeObj, applyOldVal) {\n      Object.keys(changeObj).forEach(function (key) {\n        var cur = changeObj[key];\n        if (cur.type === 'SSFF') {\n          if (applyOldVal) {\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.oldValue;\n          } else {\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.newValue;\n          }\n        } else if (cur.type === 'ANNOT') {\n          switch (cur.action) {\n          case 'MOVEBOUNDARY':\n            if (applyOldVal) {\n              LevelService.moveBoundary(cur.name, cur.id, -cur.movedBy, cur.isFirst, cur.isLast);\n            } else {\n              LevelService.moveBoundary(cur.name, cur.id, cur.movedBy, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'MOVESEGMENT':\n            if (applyOldVal) {\n              LevelService.moveSegment(cur.name, cur.id, cur.length, -cur.movedBy);\n            } else {\n              LevelService.moveSegment(cur.name, cur.id, cur.length, cur.movedBy);\n            }\n            break;\n          case 'MOVEEVENT':\n            if (applyOldVal) {\n              LevelService.moveEvent(cur.name, cur.id, -cur.movedBy);\n            } else {\n              LevelService.moveEvent(cur.name, cur.id, cur.movedBy);\n            }\n            break;\n          case 'RENAMELABEL':\n            if (applyOldVal) {\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.oldValue);\n            } else {\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.newValue);\n            }\n            break;\n          case 'RENAMELEVEL':\n            if (applyOldVal) {\n              LevelService.renameLevel(cur.newname, cur.name, cur.curPerspectiveIdx);\n            } else {\n              LevelService.renameLevel(cur.name, cur.newname, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETELEVEL':\n            if (applyOldVal) {\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            } else {\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETEBOUNDARY':\n            if (applyOldVal) {\n              LevelService.deleteBoundaryInvers(cur.name, cur.id, cur.isFirst, cur.isLast, cur.deletedSegment);\n            } else {\n              LevelService.deleteBoundary(cur.name, cur.id, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'DELETESEGMENTS':\n            if (applyOldVal) {\n              LevelService.deleteSegmentsInvers(cur.name, cur.id, cur.length, cur.deletedSegment);\n            } else {\n              LevelService.deleteSegments(cur.name, cur.id, cur.length);\n            }\n            break;\n          case 'DELETEEVENT':\n            if (applyOldVal) {\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            } else {\n              LevelService.deleteEvent(cur.name, cur.id);\n            }\n            break;\n          case 'DELETELINKSTO':\n            if (applyOldVal) {\n              LinkService.insertLinksTo(cur.deletedLinks);\n            } else {\n              LinkService.deleteLinksTo(cur.id);\n            }\n            break;\n          case 'INSERTLEVEL':\n            if (applyOldVal) {\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            } else {\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'INSERTSEGMENTS':\n            if (applyOldVal) {\n              LevelService.insertSegmentInvers(cur.name, cur.start, cur.end, cur.segName);\n            } else {\n              LevelService.insertSegment(cur.name, cur.start, cur.end, cur.segName, cur.ids);\n            }\n            break;\n          case 'INSERTEVENT':\n            if (applyOldVal) {\n              LevelService.deleteEvent(cur.name, cur.id);\n            } else {\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            }\n            break;\n          case 'INSERTLINKSTO':\n            if (applyOldVal) {\n              LinkService.deleteLinksTo(cur.parentID, cur.childIDs);\n            } else {\n              LinkService.insertLinksTo(cur.parentID, cur.childIDs);\n            }\n            break;\n          case 'EXPANDSEGMENTS':\n            if (applyOldVal) {\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.levelName, -cur.changeTime);\n            } else {\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.levelName, cur.changeTime);\n            }\n            break;\n          }\n        }\n      });\n    }\n    /////////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.updateCurChangeObj = function (dataObj) {\n      // console.log(dataObj);\n      var dataKey;\n      if (dataObj.type === 'SSFF') {\n        dataKey = String(dataObj.type + '#' + dataObj.trackName) + '#' + String(dataObj.sampleBlockIdx) + '#' + String(dataObj.sampleIdx);\n        // update curChangeObj\n        if (!curChangeObj[dataKey]) {\n          curChangeObj[dataKey] = dataObj;\n        } else {\n          dataObj.oldValue = curChangeObj[dataKey].oldValue;\n          curChangeObj[dataKey] = dataObj;\n        }\n      } else if (dataObj.type === 'ANNOT') {\n        switch (dataObj.action) {\n        case 'MOVEBOUNDARY':\n        case 'MOVEEVENT':\n        case 'MOVESEGMENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name + '#' + dataObj.id);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.movedBy += curChangeObj[dataKey].movedBy;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        case 'INSERTLINKSTO':\n        case 'DELETELINKSTO':\n        case 'DELETEBOUNDARY':\n        case 'DELETESEGMENTS':\n        case 'DELETEEVENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.oldValue = curChangeObj[dataKey].oldValue;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        }\n      }\n      return curChangeObj;\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addCurChangeObjToUndoStack = function () {\n      // empty redo stack\n      redoStack = [];\n      // add to undoStack\n      if (!$.isEmptyObject(curChangeObj)) {\n        undoStack.push(curChangeObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      $log.info(curChangeObj);\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addObjToUndoStack = function (obj) {\n      // empty redo stack\n      redoStack = [];\n      var tmpObj = {};\n      var dataKey = String(obj.type + '#' + obj.action + '#' + obj.name + '#' + obj.id);\n      tmpObj[dataKey] = angular.copy(obj);\n      // add to undoStack\n      if (!$.isEmptyObject(tmpObj)) {\n        undoStack.push(tmpObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // undo\n    sServObj.undo = function () {\n      if (undoStack.length > 0) {\n        // add to redo stack\n        var oldChangeObj = angular.copy(undoStack[undoStack.length - 1]);\n        redoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, true);\n        // remove old \n        undoStack.pop();\n        sServObj.movesAwayFromLastSave -= 1;\n      }\n    };\n    // redo\n    sServObj.redo = function () {\n      if (redoStack.length > 0) {\n        var oldChangeObj = angular.copy(redoStack[redoStack.length - 1]);\n        undoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, false);\n        redoStack.pop();\n        sServObj.movesAwayFromLastSave += 1;\n      }\n    };\n    // getNrOfPossibleUndos\n    sServObj.getNrOfPossibleUndos = function () {\n      return undoStack.length;\n    };\n    // return current History Stack\n    sServObj.getCurrentStack = function () {\n      return {\n        'undo': undoStack,\n        'redo': redoStack\n      };\n    };\n    // resetToInitState\n    sServObj.resetToInitState = function () {\n      undoStack = [];\n      redoStack = [];\n      curChangeObj = {};\n      sServObj.movesAwayFromLastSave = 0;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Wavparserservice', [\n  '$q',\n  function Wavparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new Worker('scripts/workers/wavParserWorker.js');\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.addEventListener('message', function (e) {\n      if (e.data.status.type === 'SUCCESS') {\n        defer.resolve(e.data.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse buffer containing wav file using webworker\n\t\t * @param buf\n\t\t * @returns promise\n\t\t */\n    sServObj.parseWavArrBuf = function (buf) {\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'parseBuf',\n        'buffer': buf\n      }, [buf]);\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Textgridparserservice', [\n  '$q',\n  'LevelService',\n  'viewState',\n  'Soundhandlerservice',\n  function Textgridparserservice($q, LevelService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new Worker('scripts/workers/textGridParserWorker.js');\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.addEventListener('message', function (e) {\n      if (e.data.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse level data to Textgrid File\n\t\t * @param level data\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncToTextGrid = function () {\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'toTextGrid',\n        'levels': LevelService.getData().levels,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'buffLength': Soundhandlerservice.wavJSO.Data.length\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseTextGrid = function (textGrid, annotates, name) {\n      console.log(textGrid, annotates, name);\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'parseTG',\n        'textGrid': textGrid,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('uuid', function () {\n  // shared service object\n  var sServObj = {};\n  function rand(s) {\n    var p = (Math.random().toString(16) + '000000000').substr(2, 8);\n    return s ? '-' + p.substr(0, 4) + '-' + p.substr(4, 4) : p;\n  }\n  //\n  sServObj.new = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  sServObj.newHash = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  //\n  sServObj.empty = function () {\n    return '00000000-0000-0000-0000-000000000000';\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('fontScaleService', function fontScaleService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.lastTextWidth = null;\n  sServObj.spaceTop = 0;\n  /**\n\t\t *\n\t\t */\n  sServObj.getTextImage = function (ctxOriginal, text, fontPxSize, fontType, color) {\n    var scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    var scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    fontPxSize = Math.floor(fontPxSize + 2 - scaleY / 2);\n    var img = document.createElement('canvas');\n    img.setAttribute('width', Math.round(scaleX * 200));\n    img.setAttribute('height', Math.round(scaleY * 100));\n    var ctx = img.getContext('2d');\n    ctx.save();\n    ctx.font = fontPxSize + 'px' + ' ' + fontType;\n    ctx.fillStyle = color;\n    ctx.scale(scaleX, scaleY);\n    ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n    sServObj.lastTextWidth = ctx.measureText(text).width * scaleX;\n    // draw frame to see size\n    ctx.restore();\n    // ctx.fillStyle = \"red\";\n    // ctx.strokeStyle = \"red\";\n    // ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // ctx.stroke();\n    return img;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.getLastImageWidth = function () {\n    return sServObj.lastTextWidth;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.getTextImageTwoLines = function (ctxOriginal, text, text2, fontPxSize, fontType, color, alignLeft) {\n    var scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    var scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    fontPxSize = Math.floor(fontPxSize + 2 - scaleY / 2);\n    var img = document.createElement('canvas');\n    img.setAttribute('width', Math.round(scaleX * 200));\n    img.setAttribute('height', Math.round(scaleY * 100));\n    var ctx = img.getContext('2d');\n    ctx.save();\n    ctx.font = fontPxSize + 'px' + ' ' + fontType;\n    ctx.fillStyle = color;\n    ctx.scale(scaleX, scaleY);\n    sServObj.lastTextWidth = ctx.measureText(text).width * scaleX;\n    if (alignLeft) {\n      ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n      ctx.fillText(text2, 0, 2 * fontPxSize + sServObj.spaceTop);\n    } else {\n      var a = ctx.measureText(text).width;\n      var b = ctx.measureText(text2).width;\n      // var c;\n      if (a > b) {\n        ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n        ctx.fillText(text2, a - b, 2 * fontPxSize + sServObj.spaceTop);\n      } else {\n        ctx.fillText(text, b - a, fontPxSize + sServObj.spaceTop);\n        ctx.fillText(text2, 0, 2 * fontPxSize + sServObj.spaceTop);\n      }\n    }\n    // draw frame to see size\n    ctx.restore();\n    // ctx.fillStyle = 'red';\n    // ctx.strokeStyle = 'red';\n    // ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // ctx.stroke();\n    return img;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Espsparserservice', [\n  '$q',\n  'LevelService',\n  'Soundhandlerservice',\n  function Espsparserservice($q, LevelService, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new Worker('scripts/workers/espsParserWorker.js');\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.addEventListener('message', function (e) {\n      if (e.data.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse ESPS file using webworker\n\t\t * @param esps\n\t\t * @param annotates\n\t\t * @param name\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseEsps = function (esps, annotates, name) {\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'parseESPS',\n        'esps': esps,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * parse JSO data to ESPS file using webworker\n\t\t * @param name\n\t\t * @param sampleRate\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseJSO = function (name) {\n      defer = $q.defer();\n      worker.postMessage({\n        'cmd': 'parseJSO',\n        'level': LevelService.getLevelDetails(name).level,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('LoginCtrl', [\n  '$scope',\n  '$rootScope',\n  '$http',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'dialogService',\n  function ($scope, $rootScope, $http, ConfigProviderService, Iohandlerservice, viewState, dialogService) {\n    $scope.loginData = {\n      'username': '',\n      'password': '',\n      'errorMsg': ''\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.tryLogin = function () {\n      Iohandlerservice.logOnUser($scope.loginData.username, $scope.loginData.password).then(function (res) {\n        if (res === 'LOGGEDON') {\n          dialogService.close(true);\n        } else {\n          $scope.loginData.errorMsg = 'ERROR: ' + res;\n        }\n      });\n    };\n    // FOR DEVELOPMENT\n    // $scope.tryLogin(); // for autologin uncomment and set username + password\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffdataservice', [\n  'viewState',\n  'Soundhandlerservice',\n  function Ssffdataservice(viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    sServObj.data = [];\n    /**\n\t\t *\n\t\t */\n    sServObj.getColumnOfTrack = function (trackName, columnName) {\n      var res;\n      sServObj.data.forEach(function (tr) {\n        if (tr.ssffTrackName === trackName) {\n          tr.Columns.forEach(function (col) {\n            if (col.name === columnName) {\n              res = col;\n            }\n          });\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      } else {\n        alert('could not getColumnOfTrack of trackname: ' + trackName);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSampleRateAndStartTimeOfTrack = function (trackName) {\n      var res = {};\n      sServObj.data.forEach(function (tr) {\n        if (tr.ssffTrackName === trackName) {\n          res.sampleRate = tr.sampleRate;\n          res.startTime = tr.startTime;\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      } else {\n        alert('could not getSampleRateAndStartTimeOfTrack of trackname: ' + trackName);\n      }\n    };\n    /**\n\t\t * calculates the closest audio sample of\n\t\t * the passed in column sample nr\n\t\t */\n    sServObj.calculateSamplePosInVP = function (colSampleNr, sampleRate, startTime) {\n      var sampleTime = colSampleNr / sampleRate + startTime;\n      var audioSample = Math.round(sampleTime * Soundhandlerservice.wavJSO.SampleRate);\n      return audioSample;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('LevelService', [\n  '$q',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'viewState',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  function LevelService($q, ConfigProviderService, Soundhandlerservice, viewState, Ssffdataservice, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.data = {};\n    // holding level data\n    sServObj.maxItemID = 0;\n    // max currently loaded level data Id\n    sServObj.lasteditArea = null;\n    // holding current edit area\n    sServObj.lasteditAreaElem = null;\n    // holding current edit area element\n    /**\n\t\t * search for the according label field in labels\n\t\t * and return its index\n\t\t *    @param attrDefName\n\t\t *    @param labels\n\t\t */\n    function getLabelIdx(attrDefName, labels) {\n      var labelIdx;\n      angular.forEach(labels, function (l, idx) {\n        if (l.name === attrDefName) {\n          labelIdx = idx;\n        }\n      });\n      return labelIdx;\n    }\n    ///////////////////////////////\n    // public api\n    sServObj.getData = function () {\n      return sServObj.data;\n    };\n    /**\n\t\t * sets annotation data and sets maxItemID by parsing id in elements\n\t\t */\n    sServObj.setData = function (data) {\n      angular.copy(data, sServObj.data);\n      angular.forEach(sServObj.data.levels, function (level) {\n        level.items.forEach(function (item) {\n          if (item.id > sServObj.maxItemID) {\n            sServObj.maxItemID = item.id;\n          }\n        });\n      });\n    };\n    /**\n\t\t * called externally by handlekeystrokes\n\t\t */\n    sServObj.getNewId = function () {\n      sServObj.maxItemID += 1;\n      return sServObj.maxItemID;\n    };\n    /**\n\t\t * called internally by functions\n\t\t */\n    sServObj.raiseId = function (amount) {\n      sServObj.maxItemID += amount;\n    };\n    /**\n\t\t * called internally by functions\n\t\t */\n    sServObj.lowerId = function (amount) {\n      sServObj.maxItemID -= amount;\n    };\n    /**\n\t\t * returns level details (level object and sorting id) by passing in level Name\n\t\t */\n    sServObj.getLevelDetails = function (name) {\n      var curLevel = null;\n      var id = null;\n      angular.forEach(sServObj.data.levels, function (level, num) {\n        if (level.name === name) {\n          curLevel = level;\n          id = num;\n        }\n      });\n      return {\n        level: curLevel,\n        id: id\n      };\n    };\n    /**\n\t\t * returns level details (level object and sorting id) by passing in level Name\n\t\t */\n    sServObj.getLevelsByType = function (types) {\n      var levels = [];\n      angular.forEach(sServObj.data.levels, function (level, num) {\n        var t = level.type;\n        if (types.indexOf(t) >= 0) {\n          levels.push(level);\n        }\n      });\n      return levels;\n    };\n    /**\n\t\t * gets element order by passing in elemtent id\n\t\t */\n    sServObj.getOrderById = function (name, eid) {\n      var ret = undefined;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (e, num) {\n            if (e.id === eid) {\n              ret = num;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets element id by passing in element order\n\t\t */\n    sServObj.getIdByOrder = function (name, order) {\n      var ret = null;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num == order) {\n              ret = element.id;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets item details by passing in levelName and item order\n\t\t */\n    sServObj.getItemDetails = function (name, order) {\n      var details = null;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num == order) {\n              details = element;\n            }\n          });\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * gets element details by passing in levelName and elemtent order\n\t\t */\n    sServObj.getLastItem = function (name) {\n      var details = null;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          details = level.items[level.items.length - 1];\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * get next Element in order\n\t\t */\n    sServObj.getNextItem = function (name, id) {\n      var details = null;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (element.id == id) {\n              details = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * gets item from leve by passing in levelName and item id\n\t\t *\n\t\t * @return item\n\t\t */\n    sServObj.getItemFromLevelById = function (levelName, id) {\n      var foundItm = null;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              foundItm = element;\n            }\n          });\n        }\n      });\n      return foundItm;\n    };\n    /**\n\t\t * Getter for last edit Area Element\n\t\t *   @return lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.getlasteditAreaElem = function () {\n      return sServObj.lasteditAreaElem;\n    };\n    /**\n\t\t * Setter for last edit Area Element\n\t\t *   @param lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.setlasteditAreaElem = function (e) {\n      sServObj.lasteditAreaElem = e;\n    };\n    /**\n\t\t * Setter for last edit Area\n\t\t *   @param lasteditAreaElem last edit Area\n\t\t */\n    sServObj.setlasteditArea = function (name) {\n      sServObj.lasteditArea = name;\n    };\n    /**\n\t\t * Getter for last edit Area\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlasteditArea = function () {\n      return sServObj.lasteditArea;\n    };\n    /**\n\t\t * Getter for id of last edited Element\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlastID = function () {\n      return sServObj.lasteditArea.substr(1);\n    };\n    /**\n\t\t * Remove currently open html textarea (if there is a textarea open)\n\t\t * and set viewState.editing to false.\n\t\t */\n    sServObj.deleteEditArea = function () {\n      if (null !== sServObj.getlasteditArea()) {\n        $('.' + sServObj.getlasteditArea()).remove();\n      }\n      viewState.editing = false;\n    };\n    /**\n\t\t * Calculate values (x,y,width,height) for textarea to open\n\t\t * depending on the current Level type, the current canvas\n\t\t * and the current clicked Element\n\t\t *   @param lastEventClick the current clicked Level Element\n\t\t *   @param element the current html Element to get canvas from\n\t\t *   @param type the current Level type\n\t\t */\n    sServObj.openEditArea = function (lastEventClick, element, type) {\n      var levelName = viewState.getcurClickLevelName();\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      // find labelIdx\n      var labelIdx = getLabelIdx(attrDefName, lastEventClick.labels);\n      var elem = element.find('canvas').context.getContext('2d');\n      var clientWidth = elem.canvas.clientWidth;\n      var clientOffset = elem.canvas.offsetLeft;\n      var top = elem.canvas.offsetTop;\n      var height = elem.canvas.clientHeight - 1;\n      var len = 10;\n      if (labelIdx !== undefined) {\n        if (lastEventClick.labels[labelIdx].value.length > 0) {\n          len = lastEventClick.labels[labelIdx].value.length * 7;\n        }\n      }\n      var editText = '';\n      if (lastEventClick.labels.length > 0) {\n        if (lastEventClick.labels[labelIdx] !== undefined) {\n          editText = lastEventClick.labels[labelIdx].value;\n        } else {\n          editText = '';\n        }\n      }\n      if (type === 'SEGMENT') {\n        var start = Math.floor(viewState.getPos(clientWidth, lastEventClick.sampleStart) + clientOffset);\n        var end = Math.ceil(viewState.getPos(clientWidth, lastEventClick.sampleStart + lastEventClick.sampleDur + 1) + clientOffset);\n        var width = end - start;\n        if (width < 2 * len) {\n          var zoom = viewState.curViewPort.eS - viewState.curViewPort.sS;\n          if (zoom <= 10) {\n            // if already zoomed in but text is still too long\n            sServObj.createEditArea(element, start, top, end - start, height, lastEventClick.labels[labelIdx].value, lastEventClick.id);\n          } else {\n            viewState.zoomViewPort(true, this);\n            sServObj.openEditArea(lastEventClick, element, type);\n            return;\n          }\n        }\n        sServObj.createEditArea(element, start, top, end - start, height, editText, lastEventClick.id);\n      } else {\n        var start = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset - len / 2;\n        var end = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset + len / 2;\n        var width = end - start;\n        if (width < 2 * len) {\n          width = 2 * len;\n        }\n        sServObj.createEditArea(element, start, top, width, height, editText, lastEventClick.id);\n      }\n      sServObj.createSelection(element.find('textarea')[0], 0, editText.length);\n    };\n    /**\n\t\t * Create a Text Selection in a html Textarea\n\t\t *   @param field the textarea element\n\t\t *   @param start the starting character position as int\n\t\t *   @param end the ending character position as int\n\t\t */\n    sServObj.createSelection = function (field, start, end) {\n      if (field.createTextRange) {\n        var selRange = field.createTextRange();\n        selRange.collapse(true);\n        selRange.moveStart('character', start);\n        selRange.moveEnd('character', end);\n        selRange.select();\n      } else if (field.setSelectionRange) {\n        field.setSelectionRange(start, end);\n      } else if (field.selectionStart) {\n        field.selectionStart = start;\n        field.selectionEnd = end;\n      }\n      field.focus();\n    };\n    /**\n\t\t * create a html textarea element at given\n\t\t *   @param x the x Position\n\t\t *   @param y the y Position\n\t\t *   @param width the Width\n\t\t *   @param height the Height\n\t\t *   @param label the Text Content of the Textarea\n\t\t *   @param labelid the id of the element\n\t\t */\n    sServObj.createEditArea = function (element, x, y, width, height, label, labelid) {\n      var textid = '_' + labelid;\n      element.prepend($('<textarea>').attr({\n        id: textid,\n        'class': textid + ' emuwebapp-labelEdit',\n        'ng-model': 'message',\n        'autofocus': 'true'\n      }).css({\n        'left': Math.round(x + 2) + 'px',\n        'top': Math.round(y) + 'px',\n        'width': Math.round(width) - 4 + 'px',\n        'height': Math.round(height) - 1 + 'px',\n        'padding-top': Math.round(height / 3 + 1) + 'px',\n        'overflow-x': 'hidden',\n        'overflow-y': 'hidden'\n      }).text(label));\n    };\n    /**\n\t\t * insert a new Item with id labelname start and duration at position on level\n\t\t */\n    sServObj.insertItemDetails = function (id, levelname, position, labelname, start, duration) {\n      var attrdefs = ConfigProviderService.getLevelDefinition(levelname).attributeDefinitions;\n      var curAttrDef = viewState.getCurAttrDef(levelname);\n      var newElement;\n      if (attrdefs === undefined) {\n        // ugly hack if attrdefs undefined\n        attrdefs = [];\n      }\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === levelname) {\n          if (level.type == 'SEGMENT') {\n            newElement = {\n              id: id,\n              sampleStart: start,\n              sampleDur: duration,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: levelname,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: ''\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          } else if (level.type == 'EVENT') {\n            newElement = {\n              id: id,\n              samplePoint: start,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: levelname,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: ''\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          }\n          level.items.splice(position, 0, newElement);\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updateSegItemInLevel = function (levelname, id, labelname, labelIdx, start, duration) {\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              if (start !== undefined) {\n                element.sampleStart = start;\n              }\n              if (duration !== undefined) {\n                element.sampleDur = duration;\n              }\n              if (labelname !== undefined) {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.setPointDetails = function (levelname, id, labelname, start) {\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              element.samplePoint = start;\n              element.labels[0].value = labelname;\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * gets item details by passing in levelName and item id's\n\t\t */\n    sServObj.getItemNeighboursFromLevel = function (levelName, firstid, lastid) {\n      var left = undefined;\n      var right = undefined;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (itm, num) {\n            if (itm.id == firstid) {\n              left = level.items[num - 1];\n            }\n            if (itm.id == lastid) {\n              right = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return {\n        left: left,\n        right: right\n      };\n    };\n    /**\n\t\t * get item details by passing in level, sampleNr and maximum pcm\n\t\t *\n\t\t * @param level\n\t\t * @param sampleNr\n\t\t * @param maximum \n\t\t * @returns object of the form {current: item, nearest: item, isFirst: boolean, isLast: boolean} where \n\t\t * - current is the actual item where the mouse is\n\t\t * - nearest is the item next to the current one depending on where the mouse is (ie if over 50% right element, under 50% left element)\n\t\t * - isFirst is true if the mouse is before the first item\n\t\t * - isLast is true if the mouse is after the last item\n\t\t *          \n\t\t */\n    sServObj.getClosestItem = function (sampleNr, levelname, maximum) {\n      var level = sServObj.getLevelDetails(levelname).level;\n      var current = undefined;\n      var nearest = undefined;\n      var isFirst = undefined;\n      var isLast = undefined;\n      if (level.items.length > 0) {\n        current = nearest = level.items[0];\n        isFirst = true;\n        isLast = false;\n        if (level.type === 'SEGMENT') {\n          angular.forEach(level.items, function (itm, index) {\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              // 0.5 sample correction\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                if (sampleNr - itm.sampleStart >= itm.sampleDur / 2) {\n                  if (level.items[index + 1] !== undefined) {\n                    current = level.items[index];\n                    nearest = level.items[index + 1];\n                    isLast = false;\n                  } else {\n                    isLast = true;\n                    current = nearest = level.items[level.items.length - 1];\n                  }\n                } else {\n                  isLast = false;\n                  current = nearest = level.items[index];\n                }\n              }\n              isFirst = false;\n            }\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                current = itm;\n              } else {\n                isLast = true;\n                current = nearest = level.items[level.items.length - 1];\n              }\n            }\n          });\n        } else {\n          var spaceLower = 0;\n          var spaceHigher = 0;\n          isFirst = false;\n          isLast = false;\n          angular.forEach(level.items, function (evt, index) {\n            if (index < level.items.length - 1) {\n              spaceHigher = evt.samplePoint + (level.items[index + 1].samplePoint - level.items[index].samplePoint) / 2;\n            } else {\n              spaceHigher = maximum;\n            }\n            if (index > 0) {\n              spaceLower = evt.samplePoint - (level.items[index].samplePoint - level.items[index - 1].samplePoint) / 2;\n            } else {\n              spaceLower = 0;\n            }\n            if (sampleNr <= spaceHigher && sampleNr >= spaceLower) {\n              current = nearest = evt;\n            }\n          });\n        }\n      }\n      return {\n        current: current,\n        nearest: nearest,\n        isFirst: isFirst,\n        isLast: isLast\n      };\n    };\n    /**\n\t\t * deletes a level by its name\n\t\t */\n    sServObj.deleteLevel = function (levelIndex, curPerspectiveIdx) {\n      var lvl = sServObj.data.levels[levelIndex];\n      sServObj.data.levels.splice(levelIndex, 1);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 1);\n      return lvl;\n    };\n    /**\n\t\t * adds a level by its name\n\t\t */\n    sServObj.insertLevel = function (originalLevel, levelIndex, curPerspectiveIdx) {\n      if (sServObj.data.levels !== undefined) {\n        sServObj.data.levels.splice(levelIndex, 0, originalLevel);\n        ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 0, originalLevel.name);\n      } else {\n        sServObj.data.levels = [];\n        sServObj.data.levels.splice(levelIndex, 0, originalLevel);\n        ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 0, originalLevel.name);\n      }\n    };\n    /**\n\t\t * rename the label of an element by passing in level name and id\n\t\t */\n    sServObj.renameLabel = function (levelName, id, attrIndex, newLabelName) {\n      sServObj.updateSegItemInLevel(levelName, id, newLabelName, attrIndex);\n    };\n    /**\n\t\t * rename the label of a level by passing in level name and id\n\t\t */\n    sServObj.renameLevel = function (oldname, newname, curPerspectiveIdx) {\n      //rename level name\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === oldname) {\n          level.name = newname;\n          // rename all first label names to match new \n          angular.forEach(level.items, function (item) {\n            item.labels[0].name = newname;\n          });\n        }\n      });\n      // update order name as well\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order[ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.indexOf(oldname)] = newname;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegmentsInvers = function (name, id, length, deletedSegment) {\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx;\n      var x, insertPoint;\n      insertPoint = 0;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          insertPoint = deletedSegment.order;\n          for (x in deletedSegment.segments) {\n            level.items.splice(insertPoint++, 0, deletedSegment.segments[x]);\n          }\n        }\n      });\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, deletedSegment.segments[0].id, deletedSegment.segments[deletedSegment.segments.length - 1].id);\n      if (lastNeighbours.left !== undefined && lastNeighbours.right === undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeRight);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.right.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeLeft, lastNeighbours.right.sampleDur - deletedSegment.timeLeft);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right === undefined) {\n      } else {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeLeft);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeRight, lastNeighbours.right.sampleDur - deletedSegment.timeRight);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegments = function (name, id, length) {\n      var firstSegment = sServObj.getItemFromLevelById(name, id);\n      var firstOrder = sServObj.getOrderById(name, id);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var timeLeft = 0;\n      var timeRight = 0;\n      var deleteOrder = null;\n      var deletedSegment = null;\n      var clickSeg = null;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      for (var i = firstOrder; i < firstOrder + length; i++) {\n        timeLeft += sServObj.getItemDetails(name, i).sampleDur + 1;\n      }\n      if (timeLeft % 2 == 0) {\n        timeLeft = timeLeft / 2;\n        timeRight = timeLeft;\n      } else {\n        timeLeft = Math.ceil(timeLeft / 2);\n        timeRight = timeLeft - 1;\n      }\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          angular.forEach(level.items, function (evt, order) {\n            if (evt.id == id) {\n              deleteOrder = order;\n              deletedSegment = level.items.splice(deleteOrder, length);\n            }\n          });\n        }\n      });\n      if (neighbours.left !== undefined && neighbours.right === undefined) {\n        sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      } else if (neighbours.left === undefined && neighbours.right !== undefined) {\n        sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeLeft, neighbours.right.sampleDur + timeLeft);\n        clickSeg = neighbours.right;\n      } else if (neighbours.left === undefined && neighbours.right === undefined) {\n        // nothing left to do level empty now\n        viewState.setcurMouseSegment(undefined, undefined, undefined);\n      } else {\n        sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeLeft);\n        sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeRight, neighbours.right.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      }\n      return {\n        order: deleteOrder,\n        segments: deletedSegment,\n        timeLeft: timeLeft,\n        timeRight: timeRight,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegmentInvers = function (name, start, end, newLabel) {\n      var ret = true;\n      var diff, diff2;\n      angular.forEach(sServObj.data.levels, function (t) {\n        if (t.name === name) {\n          if (start == end) {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              var diff = 0;\n              if (t.items[startOrder] !== undefined) {\n                diff = t.items[startOrder].sampleDur + 1;\n              }\n              if (t.items[startOrder - 1] !== undefined) {\n                // if not leftmost item\n                t.items[startOrder - 1].sampleDur += diff;\n              }\n              t.items.splice(startOrder, 1);\n            }\n          } else {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              if (t.items[startOrder + 1] === undefined) {\n                // if rightmost item\n                t.items.splice(startOrder - 1, 2);\n              } else if (t.items[startOrder - 1] === undefined) {\n                // if leftmost item\n                t.items.splice(startOrder, 2);\n              } else {\n                // in the middle\n                diff = t.items[startOrder].sampleDur + 1;\n                diff2 = t.items[startOrder + 1].sampleDur + 1;\n                t.items[startOrder - 1].sampleDur += diff + diff2;\n                t.items.splice(startOrder, 2);  //sServObj.lowerId(2);\t    \n              }\n            }\n          }\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegment = function (name, start, end, newLabel, ids) {\n      var ret = true;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          if (start == end) {\n            if (level.items.length == 0) {\n              // if on an empty level\n              return {\n                ret: false,\n                ids: ids\n              };\n            } else {\n              // if not on an empty level\n              if (ids === undefined) {\n                ids = [];\n                ids[0] = sServObj.getNewId();\n              }\n              var startID = -1;\n              if (start < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - start;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, diff - 1);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var newStart = level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur + 1;\n                sServObj.insertItemDetails(ids[0], name, level.items.length, newLabel, newStart, start - newStart);\n              } else {\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (evt.sampleStart == start) {\n                    ret = false;\n                  }\n                  if (evt.sampleStart + evt.sampleDur + 1 == start) {\n                    ret = false;\n                  }\n                });\n                if (ret) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, level.items[startID].sampleDur - diff - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          } else {\n            if (ids === undefined) {\n              ids = [];\n              ids[0] = sServObj.getNewId();\n              ids[1] = sServObj.getNewId();\n            }\n            if (level.items.length == 0) {\n              // if on an empty level\n              sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, end - start - 1);\n            } else {\n              // if not on an empty level\t\t\t\t\n              if (end < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - end - 1;\n                var diff2 = end - start - 1;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, end, diff);\n                sServObj.insertItemDetails(ids[1], name, 0, newLabel, start, diff2);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var diff = start - (level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) - 1;\n                var diff2 = end - start - 1;\n                var len = level.items.length;\n                sServObj.insertItemDetails(ids[0], name, len, newLabel, level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur, diff);\n                sServObj.insertItemDetails(ids[1], name, len + 1, newLabel, start, diff2);\n              } else {\n                // in the middle\t\t\t\n                var startID = -1;\n                var endID = -1;\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (end >= evt.sampleStart && end <= evt.sampleStart + evt.sampleDur) {\n                    endID = id;\n                  }\n                });\n                ret = startID === endID;\n                if (ret && startID !== -1) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  var diff2 = end - start - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, diff2);\n                  sServObj.insertItemDetails(ids[1], name, startID + 2, newLabel, end, level.items[startID].sampleDur - diff - 1 - diff2 - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          }\n        }\n      });\n      return {\n        ret: ret,\n        ids: ids\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertEvent = function (name, start, pointName, id) {\n      var ret = false;\n      var alreadyExists = false;\n      var pos = undefined;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name && level.type === 'EVENT') {\n          var last = level.items[0].samplePoint;\n          angular.forEach(level.items, function (evt, order) {\n            if (Math.floor(start) === Math.floor(evt.samplePoint)) {\n              alreadyExists = true;\n            }\n            if (start > evt.samplePoint) {\n              pos = order + 1;\n            }\n          });\n        }\n      });\n      if (!alreadyExists) {\n        if (id === undefined) {\n          id = sServObj.getNewId();\n        }\n        sServObj.insertItemDetails(id, name, pos, pointName, start);\n      }\n      return {\n        alreadyExists: alreadyExists,\n        id: id\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteEvent = function (name, id) {\n      var ret = false;\n      angular.forEach(sServObj.data.levels, function (t) {\n        if (t.name === name && t.type == 'EVENT') {\n          var last = 0;\n          angular.forEach(t.items, function (evt, order) {\n            if (!ret) {\n              if (id == evt.id) {\n                ret = evt;\n                t.items.splice(order, 1);\n              }\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *   delete a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundary = function (name, id, isFirst, isLast) {\n      var toDelete = sServObj.getItemFromLevelById(name, id);\n      var last = null;\n      var retOrder = null;\n      var retEvt = null;\n      var clickSeg = null;\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          last = level.items[0];\n          angular.forEach(level.items, function (evt, order) {\n            if (level.type === 'SEGMENT') {\n              if (toDelete.sampleStart == evt.sampleStart && toDelete.sampleDur == evt.sampleDur) {\n                if (order === 0 && isFirst) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[0];\n                } else if (order === level.items.length - 1 && isLast) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[level.items.length - 1];\n                } else {\n                  for (var i = 0; i < last.labels.length; i++) {\n                    last.labels[i].value += evt.labels[i].value;\n                  }\n                  last.sampleDur += evt.sampleDur + 1;\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = last;\n                }\n              }\n            }\n            last = evt;\n          });\n          if (clickSeg == null) {\n            clickSeg = level.items[0];\n          }\n        }\n      });\n      return {\n        order: retOrder,\n        event: retEvt,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *   restore a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundaryInvers = function (name, id, isFirst, isLast, deletedSegment) {\n      angular.forEach(sServObj.data.levels, function (level) {\n        if (level.name === name) {\n          level.items.splice(deletedSegment.order, 0, deletedSegment.event);\n          var oldName = deletedSegment.event.labels[0].value;\n          if (!isFirst && !isLast) {\n            oldName = level.items[deletedSegment.order - 1].labels[0].value.slice(0, level.items[deletedSegment.order - 1].labels[0].value.length - deletedSegment.event.labels[0].value.length);\n            level.items[deletedSegment.order - 1].labels[0].value = oldName;\n            level.items[deletedSegment.order - 1].sampleDur -= deletedSegment.event.sampleDur + 1;\n          }\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.snapBoundary = function (toTop, levelName, segment, neighbor, type) {\n      var neighTd;\n      var neighTdIdx;\n      var absMinDist = Infinity;\n      var absDist;\n      var minDist = undefined;\n      var sample;\n      var sampleTarget;\n      if (type == 'SEGMENT') {\n        sample = segment.sampleStart;\n      } else if (type == 'EVENT') {\n        sample = segment.samplePoint;\n      }\n      angular.forEach(sServObj.data.levels, function (thisTd, tIdx) {\n        if (thisTd.name === levelName) {\n          if (toTop) {\n            if (tIdx >= 1) {\n              neighTd = sServObj.data.levels[tIdx - 1];\n            } else {\n              return false;\n            }\n          } else {\n            if (tIdx < sServObj.data.levels.length - 1) {\n              neighTd = sServObj.data.levels[tIdx + 1];\n            } else {\n              return false;\n            }\n          }\n          neighTd.items.forEach(function (itm, order) {\n            if (neighTd.type == 'SEGMENT') {\n              sampleTarget = itm.sampleStart;\n            } else if (neighTd.type == 'EVENT') {\n              sampleTarget = itm.samplePoint;\n            }\n            absDist = Math.abs(sample - sampleTarget);\n            if (absDist < absMinDist) {\n              absMinDist = absDist;\n              minDist = sampleTarget - sample;\n            }\n          });\n        }\n      });\n      if (minDist !== undefined) {\n        if (type == 'SEGMENT') {\n          this.moveBoundary(levelName, segment.id, minDist, 0);\n        } else if (type == 'EVENT') {\n          this.moveEvent(levelName, segment.id, minDist);\n        }\n        return minDist;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t *  moves a boundary of a given segment\n\t\t *\n\t\t *  @param {string} name The name of the level in which the segment lies.\n\t\t *  @param {number} id The id of the segment.\n\t\t *  @param {number} changeTime The time to add or substract.\n\t\t *  @param {isFirst} if item is first\n\t\t *  @param {isLast} if item is last\n\t\t *\n\t\t */\n    sServObj.moveBoundary = function (levelName, id, changeTime, isFirst, isLast) {\n      var orig = sServObj.getItemFromLevelById(levelName, id);\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      var ln = sServObj.getItemNeighboursFromLevel(levelName, id, id);\n      if (isFirst) {\n        // before first item\n        var origRight = ln.right;\n        if (origRight !== undefined) {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        } else {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      } else if (isLast) {\n        // after last item\n        if (orig.sampleDur + changeTime >= 0 && orig.sampleDur + orig.sampleStart + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart, orig.sampleDur + changeTime);\n        }\n      } else {\n        if (ln.left === undefined) {\n          var origRight = ln.right;\n          if (origRight !== undefined) {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n              sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          } else {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          }\n        } else {\n          var origLeft = ln.left;\n          if (origLeft.sampleDur + changeTime >= 0 && orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0) {\n            sServObj.updateSegItemInLevel(levelName, ln.left.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveEvent = function (name, id, changeTime) {\n      var orig = sServObj.getItemFromLevelById(name, id);\n      if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n        sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n      }\n      //resort Points after moving\n      angular.forEach(sServObj.data.levels, function (t) {\n        if (t.name === name) {\n          t.items.sort(sServObj.orderPoints);\n        }\n      });\n    };\n    /**\n\t\t * reorder points on Event level after moving them. This is needed when Points are moved before or after each other\n\t\t *\n\t\t */\n    sServObj.orderPoints = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.samplePoint > b.samplePoint)\n        return 1;\n      if (a.samplePoint < b.samplePoint)\n        return -1;\n      return 0;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveSegment = function (name, id, length, changeTime) {\n      var firstOrder = sServObj.getOrderById(name, id);\n      var firstSegment = sServObj.getItemDetails(name, firstOrder);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        var right = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n        if (firstSegment.sampleStart + changeTime > 0 && lastNeighbours.right.sampleDur - changeTime >= 0) {\n          sServObj.updateSegItemInLevel(name, right.id, undefined, labelIdx, right.sampleStart + changeTime, right.sampleDur - changeTime);\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      } else if (lastNeighbours.right === undefined && lastNeighbours.left !== undefined) {\n        var left = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n        if (lastNeighbours.left.sampleDur + changeTime >= 0) {\n          if (lastSegment.sampleStart + lastSegment.sampleDur + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegItemInLevel(name, left.id, undefined, labelIdx, left.sampleStart, left.sampleDur + changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        }\n      } else if (lastNeighbours.right !== undefined && lastNeighbours.left !== undefined) {\n        var origLeft = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n        var origRight = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n        if (origLeft.sampleDur + changeTime >= 0 && origRight.sampleDur - changeTime >= 0) {\n          sServObj.updateSegItemInLevel(name, origLeft.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n          sServObj.updateSegItemInLevel(name, origRight.id, undefined, labelIdx, origRight.sampleStart + changeTime, origRight.sampleDur - changeTime);\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      } else if (lastNeighbours.right === undefined && lastNeighbours.left === undefined) {\n        var first = sServObj.getItemDetails(name, firstOrder);\n        var last = sServObj.getItemDetails(name, firstOrder + length - 1);\n        if (first.sampleStart + changeTime > 0 && last.sampleDur + last.sampleStart + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.expandSegment = function (rightSide, segments, name, changeTime) {\n      var startTime = 0;\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, segments[0].id, segments[segments.length - 1].id);\n      var segTime = changeTime * segments.length;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, segments[0].labels);\n      var tempItem;\n      var allow = true;\n      if (rightSide) {\n        // if expand or shrink on RIGHT side\n        if (neighbours.right === undefined) {\n          // last element\n          var lastLength = segments[segments.length - 1].sampleStart + segments[segments.length - 1].sampleDur + changeTime * segments.length;\n          if (lastLength <= Soundhandlerservice.wavJSO.Data.length) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.right.sampleDur - changeTime * segments.length > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n            sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart + startTime, neighbours.right.sampleDur - startTime);\n          }\n        }\n      } else {\n        // if expand or shrink on LEFT side\n        if (neighbours.left === undefined) {\n          // first element\n          var first = sServObj.getItemDetails(name, 0);\n          if (first.sampleStart + changeTime * (segments.length + 1) > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, tempItem.sampleStart - changeTime, labelIdx, tempItem.sampleDur + changeTime);\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.left.sampleDur - changeTime * segments.length > 0) {\n            startTime = 0;\n            angular.forEach(segments, function (seg, i) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              startTime = -(segments.length - i) * changeTime;\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n            });\n            sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur - segments.length * changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.calcDistanceToNearestZeroCrossing = function (sample) {\n      // walk right\n      var distRight;\n      for (var i = sample; i < Soundhandlerservice.wavJSO.Data.length - 1; i++) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i + 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i + 1] >= 0) {\n          distRight = i - sample;\n          break;\n        }\n      }\n      // walk left\n      var distLeft;\n      for (var i = sample; i > 1; i--) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i - 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i - 1] >= 0) {\n          distLeft = i - sample;\n          break;\n        }\n      }\n      var res;\n      if (Math.abs(distLeft) < Math.abs(distRight)) {\n        res = distLeft;\n      } else {\n        res = distRight + 1;\n      }\n      return res;\n    };\n    /**\n\t\t * get all labels (curAttr def applies) of a level and\n\t\t * return them as a flat array\n\t\t * @param levelName\n\t\t * @return array containing all labels (form==['x','y','z'])\n\t\t */\n    sServObj.getAllLabelsOfLevel = function (levelDetails) {\n      var curAttrDef = viewState.getCurAttrDef(levelDetails.level.name);\n      var labels = [];\n      for (var i = 0; i < levelDetails.level.items.length; i++) {\n        for (var j = 0; j < levelDetails.level.items[i].labels.length; j++) {\n          if (levelDetails.level.items[i].labels[j].name === curAttrDef) {\n            labels.push(levelDetails.level.items[i].labels[j].value);\n          }\n        }\n      }\n      return labels;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('LinkService', [\n  'LevelService',\n  function LinkService(LevelService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.data = LevelService.data;\n    /**\n\t\t * adds single links to sServObj.data.links \n\t\t * by pairing all childIds with the parent \n\t\t * id (form=={'fromID':fromID, 'toID':toID})\n\t\t */\n    sServObj.insertLink = function (fromID, toID) {\n      sServObj.data.links.push({\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * removes single link from sServObj.data.links \n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLink = function (fromID, toID) {\n      angular.forEach(sServObj.data.links, function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          sServObj.data.links.splice(linkIdx);\n        }\n        ;\n      });\n    };\n    /**\n\t\t * adds multiple links to sServObj.data.links \n\t\t * by pairing all childIds with the parent \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksTo = function (fromID, toIDs) {\n      angular.forEach(toIDs, function (toID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to children from sServObj.data.links \n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksTo = function (fromID, toIDs) {\n      angular.forEach(toIDs, function (toID) {\n        sServObj.deleteLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * adds multiple links to sServObj.data.links \n\t\t * by pairing all parentIds with the child \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksFrom = function (fromIDs, toID) {\n      angular.forEach(fromIDs, function (fromID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to parents from sServObj.data.links \n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksFrom = function (fromIDs, toID) {\n      angular.forEach(fromIDs, function (fromID) {\n        sServObj.deleteLink(fromID, toID);\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Websockethandler', [\n  '$q',\n  '$rootScope',\n  '$location',\n  '$timeout',\n  'HistoryService',\n  'Ssffparserservice',\n  'ConfigProviderService',\n  'viewState',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Espsparserservice',\n  'uuid',\n  'Binarydatamaniphelper',\n  'Ssffdataservice',\n  'dialogService',\n  function Websockethandler($q, $rootScope, $location, $timeout, HistoryService, Ssffparserservice, ConfigProviderService, viewState, Wavparserservice, Soundhandlerservice, Espsparserservice, uuid, Binarydatamaniphelper, Ssffdataservice, dialogService) {\n    // shared service object\n    var sServObj = {};\n    // Keep all pending requests here until they get responses\n    var callbacks = {};\n    // Create our websocket object with the address to the websocket\n    var ws = {};\n    // empty promise object to be resolved when connection is up\n    var conPromise = {};\n    var connected = false;\n    ////////////////////////////\n    // ws function\n    // broadcast on open\n    function wsonopen(message) {\n      connected = true;\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonmessage(message) {\n      listener(angular.fromJson(message.data));\n    }\n    function wsonerror(message) {\n      // console.log(message);\n      console.error('WEBSOCKET ERROR!!!!!');\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonclose(message) {\n      console.log(message);\n      if (!message.wasClean && connected) {\n        // show no clean disconnect error\n        dialogService.open('views/error.html', 'ModalCtrl', 'A non clean diconnect to the server occurred! This probably means that the server is down. Please check the server and reconnect!').then(function () {\n          $rootScope.$broadcast('connectionDisrupted');\n        });\n      }\n      connected = false;\n      console.log('WEBSOCKET closed!!!!!');\n    }\n    function sendRequest(request) {\n      var defer = $q.defer();\n      var callbackId = getCallbackId();\n      callbacks[callbackId] = {\n        time: new Date(),\n        cb: defer\n      };\n      request.callbackID = callbackId;\n      ws.send(angular.toJson(request));\n      // timeout request if not answered\n      $timeout(function () {\n        var tOutResp = {\n            'callbackID': callbackId,\n            'status': {\n              'type': 'ERROR:TIMEOUT',\n              'message': 'Sent request of type: ' + request.type + ' timed out after ' + ConfigProviderService.vals.main.serverTimeoutInterval + 'ms!  Please check the server...'\n            }\n          };\n        listener(tOutResp);\n      }, ConfigProviderService.vals.main.serverTimeoutInterval);\n      return defer.promise;\n    }\n    function listener(data) {\n      var messageObj = data;\n      // console.log(\"Received data from websocket: \", messageObj);\n      // If an object exists with callbackID in our callbacks object, resolve it\n      if (callbacks.hasOwnProperty(messageObj.callbackID)) {\n        // console.log(callbacks[messageObj.callbackID]);\n        // console.log('resolving callback: ' + messageObj.type + ' Nr.: ' + messageObj.callbackID);\n        switch (messageObj.type) {\n        case 'getESPSfile':\n          alert('espsfile');\n          //handleReceivedESPS(messageObj.fileName, messageObj.data);\n          break;\n        case 'getSSFFfile':\n          alert('ssfffile');\n          //handleReceivedSSFF(messageObj.fileName, messageObj.data);\n          break;\n        }\n        // resolve promise with data only\n        if (messageObj.status.type === 'SUCCESS') {\n          $rootScope.$apply(callbacks[messageObj.callbackID].cb.resolve(messageObj.data));\n        } else {\n          // show protocol error and disconnect from server\n          dialogService.open('views/error.html', 'ModalCtrl', 'Communication error with server! Error message is: ' + messageObj.status.message);\n        }\n        delete callbacks[messageObj.callbackID];\n      } else {\n        if (messageObj.status.type === 'ERROR:TIMEOUT') {\n        } else {\n          dialogService.open('views/error.html', 'ModalCtrl', 'What just happened? You should not be here...');\n        }\n      }\n    }\n    // This creates a new callback ID for a request\n    function getCallbackId() {\n      var newUUID = uuid.new();\n      return newUUID;\n    }\n    ///////////////////////////////////////////\n    // public api\n    sServObj.initConnect = function (url) {\n      var defer = $q.defer();\n      ws = new WebSocket(url);\n      ws.onopen = wsonopen;\n      ws.onmessage = wsonmessage;\n      ws.onerror = wsonerror;\n      ws.onclose = wsonclose;\n      conPromise = defer;\n      return defer.promise;\n    };\n    //\n    sServObj.isConnected = function () {\n      return connected;\n    };\n    // close connection with ws\n    sServObj.closeConnect = function () {\n      ws.onclose = function () {\n      };\n      ws.close();\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    // ws getProtocol\n    sServObj.getProtocol = function () {\n      var request = { type: 'GETPROTOCOL' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getProtocol\n    sServObj.getDoUserManagement = function () {\n      var request = { type: 'GETDOUSERMANAGEMENT' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws logOnUser\n    sServObj.logOnUser = function (name, pwd) {\n      var request = {\n          type: 'LOGONUSER',\n          userName: name,\n          pwd: pwd\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getConfigFile\n    sServObj.getDBconfigFile = function () {\n      var request = { type: 'GETGLOBALDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getBundleList\n    sServObj.getBundleList = function () {\n      var request = { type: 'GETBUNDLELIST' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  getBundle\n    sServObj.getBundle = function (name) {\n      var request = {\n          type: 'GETBUNDLE',\n          name: name\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  saveBundle\n    sServObj.saveBundle = function (bundleData) {\n      var request = {\n          type: 'SAVEBUNDLE',\n          data: bundleData\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  disconnecting\n    sServObj.disconnectWarning = function () {\n      var request = { type: 'DISCONNECTWARNING' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('WsconnectionCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'dialogService',\n  function ($scope, ConfigProviderService, Iohandlerservice, viewState, dialogService) {\n    $scope.serverInfos = {};\n    $scope.serverInfos.Url = ConfigProviderService.vals.main.serverUrl;\n    $scope.connectionError = '';\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    $scope.tryConnection = function () {\n      dialogService.close($scope.serverInfos.Url);\n    };\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Binarydatamaniphelper', function Binarydatamaniphelper() {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t *\n\t\t */\n  sServObj.base64ToArrayBuffer = function (stringBase64) {\n    var binaryString = window.atob(stringBase64);\n    var len = binaryString.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n      var ascii = binaryString.charCodeAt(i);\n      bytes[i] = ascii;\n    }\n    return bytes.buffer;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.arrayBufferToBase64 = function (buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  };\n  /**\n\t\t *\n\t\tsServObj.stringToArrayBuffer = function (str) {\n\t\t\tvar ab = new ArrayBuffer(str.length);\n\t\t\tvar view = new Uint8Array(ab);\n\t\t\tfor (var i = 0; i < str.length; ++i) {\n\t\t\t\tview[i] = str.charCodeAt(i);\n\t\t\t}\n\t\t\treturn ab;\n\t\t};\n\t\t */\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('dialogService', [\n  '$modal',\n  'viewState',\n  function dialogService($modal, viewState) {\n    // shared service object\n    var sServObj = {};\n    var modalInstance = {};\n    /**\n\t\t *\n\t\t */\n    sServObj.open = function (templatefile, argCtrl, passedIn) {\n      viewState.setState('modalShowing');\n      modalInstance = $modal.open({\n        backdrop: 'static',\n        keyboard: false,\n        templateUrl: templatefile,\n        controller: argCtrl,\n        resolve: {\n          passedInTxt: function () {\n            return passedIn;\n          },\n          passedInOpts: function () {\n            return passedIn;\n          }\n        }\n      });\n      return modalInstance.result;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.openExport = function (templatefile, argCtrl, data, txt) {\n      viewState.setState('modalShowing');\n      modalInstance = $modal.open({\n        backdrop: 'static',\n        keyboard: false,\n        templateUrl: templatefile,\n        controller: argCtrl,\n        resolve: {\n          exportData: function () {\n            return data;\n          },\n          exportName: function () {\n            return txt;\n          }\n        }\n      });\n      return modalInstance.result;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.close = function (res) {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      modalInstance.close(res);\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('WaitCtrl', [\n  '$scope',\n  'viewState',\n  function ($scope, viewState) {\n    $scope.vs = viewState;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Appcachehandler', [\n  '$http',\n  'dialogService',\n  function Appcachehandler($http, dialogService) {\n    // shared service object\n    var sServObj = {};\n    var appCache = window.applicationCache;\n    // var cacheProperties = {\n    // \tfilesDownloaded: 0,\n    // \ttotalFiles: 0\n    // };\n    // function getTotalFiles() {\n    // \t// First, reset the total file count and download count.\n    // \tcacheProperties.filesDownloaded = 0;\n    // \tcacheProperties.totalFiles = 0;\n    // \t$http.get('manifest.appcache').success(function (content) {\n    // \t\t// console.log(content);\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp(\n    // \t\t\t\t'(NETWORK|FALLBACK):' +\n    // \t\t\t\t'((?!(NETWORK|FALLBACK|CACHE):)[\\\\w\\\\W]*)',\n    // \t\t\t\t'gi'\n    // \t\t\t),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out all comments.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('#[^\\\\r\\\\n]*(\\\\r\\\\n?|\\\\n)', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out the cache manifest header and\n    // \t\t// trailing slashes.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('CACHE MANIFEST\\\\s*|\\\\s*$', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out extra line breaks and replace with\n    // \t\t// a hash sign that we can break on.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('[\\\\r\\\\n]+', 'g'),\n    // \t\t\t'#'\n    // \t\t);\n    // \t\t// Get the total number of files.\n    // \t\tvar totalFiles = content.split('#').length;\n    // \t\t// Store the total number of files. Here, we are\n    // \t\t// adding one for *THIS* file, which is cached\n    // \t\t// implicitly as it points to the manifest.\n    // \t\tcacheProperties.totalFiles = (totalFiles + 1);\n    // \t\t// console.log('##########################');\n    // \t\t// alert('INFO: appcache update of: ' + cacheProperties.totalFiles + ' files');\n    // \t});\n    // }\n    // function handleCheckingEvent(e) {\n    // \tconsole.log('###### handleCheckingEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleNoupdateEvent(e) {\n    // \tconsole.log('###### handleNoupdateEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleDownloadingEvent(e) {\n    // \tconsole.log('######## handleDownloadingEvent ##########');\n    // \tconsole.log(e);\n    // \tgetTotalFiles();\n    // }\n    // function handleProgressEvent(e) {\n    // \tconsole.log('###### handleProgressEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    // function handleCachedEvent(e) {\n    // \tconsole.log('###### handleCachedEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    function handleUpdatereadyEvent(e) {\n      console.log('###### handleUpdatereadyEvent ##########');\n      dialogService.open('views/confirmModal.html', 'ConfirmmodalCtrl', 'A new version of the EMU-WebApp is available and has already been downloaded and cached in your browser. Would you like to use it? CAUTION: A reload will delete all current changes... TIP: the next time you use the EMU-webApp you will automatically use the updated version)').then(function (res) {\n        if (res) {\n          appCache.swapCache();\n          window.location.reload();\n        }\n      });\n    }\n    // function handleObsoleteEvent(e) {\n    // \tconsole.log('###### handleObsoleteEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleErrorEvent(e) {\n    // \tconsole.log('###### handleErrorEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // // bind evts\n    // // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('checking', handleCheckingEvent, false);\n    // appCache.addEventListener('noupdate', handleNoupdateEvent, false);\n    // appCache.addEventListener('downloading', handleDownloadingEvent, false);\n    // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('cached', handleCachedEvent, false);\n    appCache.addEventListener('updateready', handleUpdatereadyEvent, false);\n    // appCache.addEventListener('obsolete', handleObsoleteEvent, false);\n    // appCache.addEventListener('error', handleErrorEvent, false);\n    // /////////////////////////////////////////////////\n    // // public api\n    sServObj.checkForNewVersion = function () {\n      // console.log('check for new version');\n      if (appCache.status !== 0 && appCache.status !== 3) {\n        // uncached == 0 & downloading == 3\n        console.log('INFO: appCache.status: ' + appCache.status);\n        appCache.update();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('AboutCtrl', [\n  '$scope',\n  'ConfigProviderService',\n  'dialogService',\n  function ($scope, ConfigProviderService, dialogService) {\n    $scope.cps = ConfigProviderService;\n    $scope.getStrRep = function (code) {\n      var str;\n      switch (code) {\n      case 8:\n        str = 'BACKSPACE';\n        break;\n      case 9:\n        str = 'TAB';\n        break;\n      case 13:\n        str = 'ENTER';\n        break;\n      case 16:\n        str = 'SHIFT';\n        break;\n      case 18:\n        str = 'ALT';\n        break;\n      case 32:\n        str = 'SPACE';\n        break;\n      case 37:\n        str = '\\u2190';\n        break;\n      case 39:\n        str = '\\u2192';\n        break;\n      case 38:\n        str = '\\u2191';\n        break;\n      case 40:\n        str = '\\u2193';\n        break;\n      case 42:\n        str = '+';\n        break;\n      case 43:\n        str = '+';\n        break;\n      case 45:\n        str = '-';\n        break;\n      case 95:\n        str = '-';\n        break;\n      default:\n        str = String.fromCharCode(code);\n      }\n      return str;\n    };\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('spectSettingsCtrl', [\n  '$scope',\n  'dialogService',\n  'viewState',\n  'LevelService',\n  function ($scope, dialogService, viewState, LevelService) {\n    $scope.vs = viewState;\n    $scope.options = Object.keys($scope.vs.getWindowFunctions());\n    $scope.selWindowInfo = {};\n    $scope.selWindowInfo.name = Object.keys($scope.vs.getWindowFunctions())[$scope.vs.spectroSettings.window - 1];\n    // console.log(Object.keys($scope.vs.getWindowFunctions())[$scope.vs.spectroSettings.window - 1]);\n    $scope.windowLengths = [\n      32,\n      64,\n      128,\n      256,\n      512,\n      1024,\n      2048\n    ];\n    $scope.modalVals = {\n      'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n      'rangeTo': $scope.vs.spectroSettings.rangeTo,\n      'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n      'windowLength': $scope.vs.spectroSettings.windowLength,\n      'window': $scope.vs.spectroSettings.window,\n      'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n      'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n      'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getColorOfAnchor = function (anchorNr) {\n      var curStyle = {\n          'background-color': 'rgb(' + $scope.modalVals.heatMapColorAnchors[anchorNr][0] + ',' + $scope.modalVals.heatMapColorAnchors[anchorNr][1] + ',' + $scope.modalVals.heatMapColorAnchors[anchorNr][2] + ')',\n          'width': '10px',\n          'height': '10px'\n        };\n      return curStyle;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveSpectroSettings = function () {\n      if ($scope.modalVals.dynamicRange % 1 === 0) {\n        if ($scope.modalVals.rangeFrom % 1 === 0) {\n          if ($scope.modalVals.rangeTo % 1 === 0) {\n            if ($scope.modalVals.rangeFrom >= 0) {\n              if ($scope.modalVals.rangeTo <= LevelService.data.sampleRate / 2) {\n                viewState.setspectroSettings($scope.modalVals.windowLength, $scope.modalVals.rangeFrom, $scope.modalVals.rangeTo, $scope.modalVals.dynamicRange, $scope.selWindowInfo.name, $scope.modalVals.drawHeatMapColors, $scope.modalVals.preEmphasisFilterFactor, $scope.modalVals.heatMapColorAnchors);\n                $scope.cancel();\n              } else {\n                $scope.error('View Range (Hz) upper boundary is a value bigger than ' + LevelService.data.sampleRate / 2);\n              }\n            } else {\n              $scope.error('View Range (Hz) lower boundary is a value below zero');\n            }\n          } else {\n            $scope.error('View Range (Hz) upper boundary has to be an Integer value.');\n          }\n        } else {\n          $scope.error('View Range (Hz) lower boundary has to be an Integer value.');\n        }\n      } else {\n        $scope.error('Dynamic Range has to be an Integer value.');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.error = function (errorMsg) {\n      dialogService.close();\n      dialogService.open('views/error.html', 'ModalCtrl', 'Sorry: ' + errorMsg);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ConfirmmodalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInTxt',\n  function ($scope, dialogService, passedInTxt) {\n    $scope.passedInTxt = passedInTxt;\n    $scope.confirm = function () {\n      dialogService.close(true);\n    };\n    $scope.cancel = function () {\n      dialogService.close(false);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('SelectThresholdModalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInOpts',\n  'ArrayHelperService',\n  function ($scope, dialogService, passedInOpts, ArrayHelperService) {\n    $scope.passedInOpts = passedInOpts;\n    $scope.myData = ArrayHelperService.convertArrayToXYjsoArray(passedInOpts.y);\n    $scope.select = function (idx) {\n      dialogService.close(idx);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('SelectLabelModalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInOpts',\n  'ArrayHelperService',\n  function ($scope, dialogService, passedInOpts, ArrayHelperService) {\n    $scope.passedInOpts = passedInOpts;\n    $scope.select = function (idx) {\n      dialogService.close(idx);\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').filter('regex', function () {\n  return function (input, regex) {\n    var patt = new RegExp(regex.toLowerCase());\n    var out = [];\n    for (var i = 0; i < input.length; i++) {\n      if (patt.test(input[i].name.toLowerCase())) {\n        out.push(input[i]);\n      }\n    }\n    return out;\n  };\n});\n'use strict';\nangular.module('emuwebApp').filter('levelsFilter', [\n  'ConfigProviderService',\n  'viewState',\n  function (ConfigProviderService, viewState) {\n    return function (input) {\n      if (input) {\n        var patt1 = new RegExp('SEGMENT');\n        var patt2 = new RegExp('EVENT');\n        var out = [];\n        var idx;\n        for (var i = 0; i < input.length; i++) {\n          if (patt1.test(input[i].type) || patt2.test(input[i].type)) {\n            if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases !== undefined) {\n              idx = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order.indexOf(input[i].name);\n              if (idx !== -1) {\n                out[idx] = input[i];\n              }\n            }\n          }\n        }\n        // console.log(out)\n        return out;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ModalCtrl', [\n  '$scope',\n  'dialogService',\n  'passedInTxt',\n  'viewState',\n  'LevelService',\n  'HistoryService',\n  function ($scope, dialogService, passedInTxt, viewState, LevelService, HistoryService) {\n    $scope.passedInTxt = passedInTxt;\n    $scope.passedOutTxt = { 'var': null };\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.saveChanges = function (name) {\n      dialogService.close('saveChanges');\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.discardChanges = function (name) {\n      dialogService.close('discardChanges');\n    };\n    /**\n\t\t *  Rename a level\n\t\t */\n    $scope.renameLevel = function () {\n      LevelService.renameLevel($scope.passedInTxt, $scope.passedOutTxt.var, viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'RENAMELEVEL',\n        'newname': $scope.passedOutTxt.var,\n        'name': $scope.passedInTxt,\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      dialogService.close();\n    };\n    /**\n\t\t *  Delete a complete level from LevelService\n\t\t */\n    $scope.deleteLevel = function () {\n      var lvl = LevelService.getLevelDetails(viewState.getcurClickLevelName());\n      LevelService.deleteLevel(viewState.getcurClickLevelIndex(), viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'DELETELEVEL',\n        'level': lvl.level,\n        'id': viewState.getcurClickLevelIndex(),\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      dialogService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showMenu', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showMenu, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, 'emuwebapp-expandWidthTo200px');\n          } else {\n            $animate.removeClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showTwod', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showTwod, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, '.slideIn2dCanvases');\n          } else {\n            $animate.removeClass(element, '.slideIn2dCanvases');\n          }\n        });\n      }\n    };\n  }\n]);\n// simple animation to add slideLeft class\nangular.module('emuwebApp').animation('.slideIn2dCanvases', function () {\n  return {\n    addClass: function (element, className) {\n      element.addClass('slide2dCanvases');\n    },\n    removeClass: function (element, className) {\n      element.removeClass('slide2dCanvases');\n    }\n  };\n});\nangular.module('emuwebApp').directive('bgSplitter', [\n  '$rootScope',\n  'viewState',\n  function ($rootScope, viewState) {\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      scope: { showTwoDimCans: '@' },\n      template: '<div class=\"emuwebapp-split-panes vertical\" ng-transclude></div>',\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.panes = [];\n          $scope.bottomRightResizePane;\n          this.addPane = function (pane) {\n            if ($scope.panes.length > 1)\n              throw 'splitters can only have two panes';\n            $scope.panes.push(pane);\n            return $scope.panes.length;\n          };\n          this.setBottomRightResizePane = function (pane) {\n            $scope.bottomRightResizePane = pane;\n          };\n        }\n      ],\n      link: function (scope, element, attrs) {\n        var dragBottomRightResizePaneTopResizer = false;\n        var dragBottomRightResizePaneLeftResizer = false;\n        var dragBottomRightResizePaneCornerResizer = false;\n        // create split pane view\n        var handler = angular.element('<div class=\"emuwebapp-split-handler\"><span></span></div>');\n        var pane1 = scope.panes[0];\n        var pane2 = scope.panes[1];\n        var pane3 = scope.bottomRightResizePane;\n        var bottomRightResizePaneTopResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneTopResizer\"></div>');\n        var bottomRightResizePaneLeftResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneLeftResizer\"></div>');\n        var bottomRightResizePaneCornerResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneCornerResizer\"></div>');\n        pane3.elem.prepend(bottomRightResizePaneLeftResizer);\n        pane3.elem.prepend(bottomRightResizePaneTopResizer);\n        pane3.elem.prepend(bottomRightResizePaneCornerResizer);\n        var pane1Min = pane1.minSize || 0;\n        var pane2Min = pane2.minSize || 0;\n        var dragSplitPaneResizer = false;\n        var drag = false;\n        pane1.elem.after(handler);\n        attrs.$observe('showTwoDimCans', function (val) {\n          if (val === 'false') {\n            scope.bottomRightResizePane.elem.hide();\n          } else {\n            scope.bottomRightResizePane.elem.show();\n          }\n        });\n        ////////////////////\n        // bindings\n        element.bind('mousemove', function (ev) {\n          if (!drag)\n            return;\n          var bounds = element[0].getBoundingClientRect();\n          var pos = 0;\n          if (dragSplitPaneResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            // perc = pos/height * 100;\n            // console.log(perc);\n            if (pos < pane1Min)\n              return;\n            if (height - pos < pane2Min)\n              return;\n            handler.css('top', pos + 'px');\n            pane1.elem.css('height', pos + 'px');\n            pane2.elem.css('top', pos + 'px');\n            viewState.setdragBarHeight(pos);\n          }\n          if (dragBottomRightResizePaneTopResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneLeftResizer) {\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneCornerResizer) {\n            // do height and top\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n            // do width and left\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n        });\n        handler.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragSplitPaneResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneTopResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneTopResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneLeftResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneLeftResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneCornerResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneCornerResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        angular.element(document).bind('mouseup', function (ev) {\n          drag = false;\n          dragSplitPaneResizer = false;\n          dragBottomRightResizePaneTopResizer = false;\n          dragBottomRightResizePaneLeftResizer = false;\n          dragBottomRightResizePaneCornerResizer = false;\n          viewState.setdragBarActive(false);\n          $rootScope.$digest();\n        });\n      }\n    };\n  }\n]).directive('bgPane', function () {\n  return {\n    restrict: 'E',\n    require: '^bgSplitter',\n    replace: true,\n    transclude: true,\n    scope: {\n      minSize: '=',\n      type: '@',\n      showTwoDimCans: '@'\n    },\n    template: '<div class=\"{{typeclass}}\" ng-transclude></div>',\n    link: function (scope, element, attrs, bgSplitterCtrl) {\n      var newElement;\n      if (scope.type !== 'emuwebapp-bottomRightResizePane') {\n        scope.elem = element;\n        scope.index = bgSplitterCtrl.addPane(scope);\n        scope.typeclass = 'split-pane' + scope.index;\n      } else {\n        // element.toggleClass('alert-box alert')\n        // var twoDimCans = angular.element('<div class=\"bottomRightResizePane\"></div>');\n        // var bottomRightResizePaneTopResizer = angular.element('<div class=\"bottomRightResizePaneTopResizer\"></div>');\n        // var bottomRightResizePaneLeftResizer = angular.element('<div class=\"bottomRightResizePaneLeftResizer\"></div>');\n        // var bottomRightResizePaneCornerResizer = angular.element('<div class=\"bottomRightResizePaneCornerResizer\"></div>');\n        // element.prepend(bottomRightResizePaneLeftResizer);\n        // element.prepend(bottomRightResizePaneTopResizer);\n        // element.prepend(bottomRightResizePaneCornerResizer);\n        // element.append(twoDimCans);\n        scope.elem = element;\n        scope.index = 3;\n        scope.typeclass = 'emuwebapp-bottomRightResizePane';\n        bgSplitterCtrl.setBottomRightResizePane(scope);\n      }\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('ssffTrack', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  function ($timeout, viewState, ConfigProviderService) {\n    return {\n      templateUrl: 'views/ssffTrack.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var ssffCanvas = element.find('canvas')[1];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // var context = canvas0.getContext('2d');\n        var markupCtx = markupCanvas.getContext('2d');\n        var trackName;\n        attrs.$observe('trackName', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        scope.order = attrs.order;\n        /////////////////////\n        // watches\n        // on broadcast msg from main ctrl openSubmenu refresh timeline\n        scope.$on('refreshTimeline', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        });\n        //\n        scope.$watch('vs.timelineSize', function () {\n          $timeout(scope.redraw, 10);\n        });\n        scope.$watch('vs.curViewPort', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        //\n        /////////////////////\n        scope.redraw = function () {\n          drawSsffTrackMarkup();\n        };\n        /**\n         *\n         */\n        function drawSsffTrackMarkup() {\n          if (!$.isEmptyObject(scope.ssffds.data)) {\n            if (scope.ssffds.data.length !== 0) {\n              markupCtx.clearRect(0, 0, markupCtx.canvas.width, markupCtx.canvas.height);\n              // draw moving boundary line if moving\n              scope.dhs.drawMovingBoundaryLine(markupCtx);\n              // draw current viewport selected\n              scope.dhs.drawCurViewPortSelected(markupCtx, false);\n              // draw min max an name of track\n              var tr = scope.cps.getSsffTrackConfig(trackName);\n              var col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n              scope.dhs.drawMinMaxAndName(markupCtx, trackName, col._minVal, col._maxVal, 2);\n            }\n          }\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('progressThing', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-progressThing\">{{vs.somethingInProgressTxt}}</div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the progressThing directive');\n        attrs.$observe('showThing', function (newVal) {\n          if (newVal === 'true') {\n            // $animate.removeClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.addClass(element, 'emuwebapp-expandHeightTo20px');\n          } else {\n            // $animate.addClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.addClass(element, 'emuwebapp-shrinkHeightTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuhierarchy', [\n  'viewState',\n  'LevelService',\n  'HierarchyLayoutService',\n  'Soundhandlerservice',\n  function (viewState, LevelService, HierarchyLayoutService, Soundhandlerservice) {\n    return {\n      template: '<div class=\"emuwebapp-hierarchy-container\"></div>',\n      restrict: 'E',\n      scope: {\n        path: '=',\n        vertical: '=',\n        playing: '='\n      },\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        //////////////////////\n        // private variables\n        scope.selectedItem;\n        //\n        //////////////////////\n        //////////////////////\n        // watches \n        scope.cLAD = viewState.curLevelAttrDefs;\n        scope.$watch('path', function (newValue) {\n          console.debug('Rendering due to path change: ', newValue);\n          scope.selectVisibleNodes();\n          scope.render();\n        }, false);\n        scope.$watch('vertical', function (newValue) {\n          console.debug('Rendering due to rotation: ', newValue);\n          scope.selectVisibleNodes();\n          scope.render();\n        }, false);\n        scope.$watch('cLAD', function (newValue) {\n          console.debug('Rendering due to attribute change: ', newValue);\n          scope.render();\n        }, true);\n        scope.$watch('playing', function (newValue) {\n          console.debug(newValue, scope.selectedItem);\n          if (typeof scope.selectedItem !== 'undefined' && newValue !== 0) {\n            scope.play(scope.selectedItem);\n          }\n        }, true);\n        //\n        //////////////////////\n        //////////////////////\n        // helper functions\n        /**\n\t * Function to center node when clicked/dropped so node doesn't get lost when\n\t * collapsing/moving with large amount of children.\n\t */\n        scope.centerNode = function (node) {\n          var x = -node._x + width / 2;\n          var y = -node._y + height / 2;\n          svg.transition().duration(duration).attr('transform', scope.getOrientatedTransform() + 'translate(' + x + ',' + y + ')');\n          zoomListener.translate([\n            x,\n            y\n          ]);\n        };\n        /**\n\t * The zoom function is called by the zoom listener, which listens for d3 zoom events and must be appended to the svg element\n\t */\n        scope.zoom = function () {\n          svg.attr('transform', scope.getOrientatedTransform());\n        };\n        scope.getOrientatedTransform = function () {\n          var transform = 'scale(' + zoomListener.scale() + ')';\n          transform += 'translate(' + zoomListener.translate() + ')';\n          if (scope.vertical) {\n            transform += 'scale(-1,1),rotate(90)';\n          } else {\n            transform += 'rotate(0)';\n          }\n          return transform;\n        };\n        scope.getOrientatedNodeTransform = function (d) {\n          // Parameter d is never used because this is independent from the node's position\n          if (scope.vertical) {\n            return 'scale(-1,1)rotate(90)';\n          } else {\n            return 'scale(1,1)rotate(0)';\n          }\n        };\n        scope.getNodeText = function (d) {\n          var level = viewState.getCurAttrDef(HierarchyLayoutService.getLevelName(d.id));\n          for (var i = 0; i < d.labels.length; ++i) {\n            if (d.labels[i].name === level) {\n              return d.labels[i].value;\n            }\n          }\n          console.debug('Likely a bug: Did not find the label selected for display', 'Selected level:', level, 'Node: ', d);\n          return 'NO VALUE';\n        };\n        scope.getOrientatedTextAnchor = function (d) {\n          if (scope.vertical) {\n            return 'middle';\n          } else {\n            return 'begin';\n          }\n        };\n        scope.getOrientatedTextX = function (d) {\n          if (scope.vertical) {\n            return 0;\n          } else {\n            return 10;\n          }\n        };\n        scope.getOrientatedTextY = function (d) {\n          if (scope.vertical) {\n            return '1.45em';\n          } else {\n            return '0.35em';\n          }\n        };\n        scope.getPath = function (d) {\n          var controlX = d._fromX;\n          var controlY = d._toY;\n          return 'M' + d._fromX + ' ' + d._fromY + 'Q' + controlX + ' ' + controlY + ' ' + d._toX + ' ' + d._toY;\n        };\n        scope.nodeOnClick = function (d) {\n          console.debug('Clicked node', d);\n          //scope.centerNode(d);\n          // (De-)Collapse sub-tree\n          var isCollapsing;\n          if (typeof d._collapsed === 'undefined' || d._collapsed === false) {\n            isCollapsing = true;\n          } else if (d._collapsed === true) {\n            isCollapsing = false;\n          } else {\n            console.debug('Likely a bug: the following node appears to be neither collapsed nor uncollapsed:', d);\n          }\n          d._collapsed = isCollapsing;\n          var currentDescendant;\n          var descendants = HierarchyLayoutService.findChildren(d, scope.path);\n          while (descendants.length > 0) {\n            currentDescendant = descendants.pop();\n            descendants = descendants.concat(HierarchyLayoutService.findChildren(currentDescendant, scope.path));\n            if (isCollapsing) {\n              if (typeof currentDescendant._collapsedParents === 'undefined') {\n                currentDescendant._collapsedParents = 1;\n              } else {\n                currentDescendant._collapsedParents += 1;\n              }\n            } else {\n              currentDescendant._collapsedParents -= 1;\n            }\n            currentDescendant._collapsePosition = [\n              d._x,\n              d._y\n            ];\n          }\n          scope.selectVisibleNodes();\n          scope.render();\n        };\n        scope.nodeOnRightClick = function (d) {\n          scope.play(d);\n        };\n        scope.nodeOnMouseOver = function (d) {\n          scope.selectedItem = d;\n          scope.render();\n        };\n        scope.play = function (d) {\n          var timeInfoLevel = scope.path[0];\n          if (typeof timeInfoLevel === 'undefined') {\n            console.debug('Likely a bug: There is no path selection. Not executing play():', d);\n            return;\n          }\n          var timeInfoType = LevelService.getLevelDetails(timeInfoLevel).level.type;\n          var firstTimeItem = null;\n          var lastTimeItem = null;\n          var itemList = [d];\n          var currentItem;\n          while (itemList.length > 0) {\n            currentItem = itemList.pop();\n            if (currentItem.labels[0].name === timeInfoLevel) {\n              if (lastTimeItem === null) {\n                lastTimeItem = currentItem;\n              }\n              firstTimeItem = currentItem;\n            }\n            itemList = itemList.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n          }\n          console.debug('Node info for playback: ', timeInfoType, d, firstTimeItem, lastTimeItem);\n          if (firstTimeItem === null) {\n            console.debug('No time information found for node, aborting playback', d);\n            return;\n          }\n          var startSample = 0;\n          var endSample = 0;\n          if (timeInfoType === 'EVENT') {\n            startSample = firstTimeItem.samplePoint;\n            endSample = lastTimeItem.samplePoint;\n          } else if (timeInfoType === 'SEGMENT') {\n            startSample = firstTimeItem.sampleStart;\n            endSample = lastTimeItem.sampleStart + lastTimeItem.sampleDur;\n          }\n          console.debug('Sample information for playback:', startSample, endSample);\n          Soundhandlerservice.playFromTo(startSample, endSample);\n        };\n        scope.selectVisibleNodes = function () {\n          // Try to set all nodes to invisible. Later we will search all\n          // paths and if we find one uncollasped path to a node, that\n          // node will be set visible.\n          var rootLevelItems = LevelService.getLevelDetails(scope.path[scope.path.length - 1]).level.items;\n          var items = [];\n          items = items.concat(rootLevelItems);\n          var currentItem;\n          while (items.length > 0) {\n            currentItem = items.pop();\n            items = items.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n            currentItem._visible = false;\n          }\n          // Now all nodes on the selected scope.path have been set invisible\n          items = [];\n          items = items.concat(rootLevelItems);\n          while (items.length > 0) {\n            currentItem = items.pop();\n            if (!currentItem._collapsed) {\n              items = items.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n            }\n            currentItem._visible = true;\n          }\n        };\n        //\n        /////////////////////////////\n        /////////////////////////////\n        // inital d3.js setup stuff\n        var margin = {\n            top: 0,\n            right: 0,\n            bottom: 0,\n            left: 0\n          }, width = parseInt(d3.select(element[0]).style('width'), 10), width = width - margin.left - margin.right, height = parseInt(d3.select(element[0]).style('height'), 10), height = height - margin.top - margin.bottom, barHeight = 20, percent = d3.format('%'), duration = 750;\n        // scaleExtent limits the amount of zooming possible\n        var zoomListener = d3.behavior.zoom().scaleExtent([\n            0.5,\n            10\n          ]).on('zoom', scope.zoom);\n        // Create the d3 element and position it based on margins\n        var svg = d3.select(element[0]).append('svg').attr('width', '100%').attr('height', '100%').style('background-color', 'darkgrey').call(zoomListener).on('dblclick.zoom', null).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')').append('g');\n        //\n        /////////////////////////////\n        /**\n         *\n         */\n        scope.render = function () {\n          // Set orientation\n          svg.transition().duration(duration).attr('transform', scope.getOrientatedTransform());\n          /////\n          // Compute the new tree layout (first nodes and then links)\n          //\n          var nodes = [];\n          // At the moment I have two different approaches to calculating the layout of a hierarchy\n          //\n          // The first is simpler and is used by first calling layoutNonItemLevel() for the bottom-most level (the one with time information)\n          // and then calling layoutItemLevel() for all other levels. Unfortunately, it will in some cases render multiple nodes to the same\n          // position (happens when they share the same set of children).\n          //\n          // The second one looks simpler in this file, because it is completely done in one function. But that function is actually quite\n          // complex.\n          //\n          // It might be desirable to find some sort of collision detection for the first approach (which is commented out below)\n          //\n          /////\n          // This is the aforementioned second approach\n          HierarchyLayoutService.calculateWeightsBottomUp(scope.path);\n          //\n          /////\n          for (var i = 0; i < scope.path.length; ++i) {\n            /////\n            // This is the aformentioned first approach\n            /*\n\t\t\tif (i === 0) {\n\t\t\t\tHierarchyLayoutService.layoutNonItemLevel(scope.path[0], scope.path.length);\n\t\t\t} else {\n\t\t\t\tHierarchyLayoutService.layoutItemLevel(scope.path[i], scope.path.length-i);\n\t\t\t}\n\t\t\t*/\n            //////\n            // Add all nodes that are not collapsed\n            var levelItems = LevelService.getLevelDetails(scope.path[i]).level.items;\n            for (var ii = 0; ii < levelItems.length; ++ii) {\n              if (levelItems[ii]._visible) {\n                nodes.push(levelItems[ii]);\n              }\n            }  // Add all nodes, no matter whether they are collapsed or not\n               //nodes = nodes.concat(LevelService.getLevelDetails(scope.path[i]).level.items);\n          }\n          // Now layout links\n          //\n          // We must only draw links that are part of the currently selected path.\n          // We must therefore filter the links.\n          //\n          // We must also filter out links that are collapsed\n          //\n          // What follows below is a probably very low-performance approach to filtering\n          //\n          var links = [];\n          var allLinks = LevelService.getData().links;\n          for (var l = 0; l < allLinks.length; ++l) {\n            for (var i = 0; i < scope.path.length - 1; ++i) {\n              var element = LevelService.getItemFromLevelById(scope.path[i], allLinks[l].toID);\n              var parentElement = LevelService.getItemFromLevelById(scope.path[i + 1], allLinks[l].fromID);\n              if (element === null) {\n                continue;\n              }\n              if (parentElement === null) {\n                continue;\n              }\n              if (!element._visible)\n                continue;\n              if (parentElement._collapsed || !parentElement._visible)\n                continue;\n              links.push(allLinks[l]);\n            }\n          }\n          // Transform relative coordinates (_posInLevel and _depth) to actual coordinates (_x and _y)\n          var offsetX = 25;\n          var depthToX = function (depth) {\n            var size = scope.vertical ? height : width;\n            return offsetX + depth / scope.path.length * size;\n          };\n          var posInLevelToY = function (posInLevel) {\n            var size = scope.vertical ? width : height;\n            return posInLevel * size;\n          };\n          nodes.forEach(function (d) {\n            d._x = depthToX(d._depth);\n            d._y = posInLevelToY(d._posInLevel);\n          });\n          links.forEach(function (d) {\n            d._fromX = depthToX(d._fromDepth);\n            d._fromY = posInLevelToY(d._fromPosInLevel);\n            d._toX = depthToX(d._toDepth);\n            d._toY = posInLevelToY(d._toPosInLevel);\n          });\n          //////\n          // Now that all actual coordinates have been calculated, we\n          // update our SVG using d3js data joins\n          //\n          // For an introduction to the concept see\n          // http://bost.ocks.org/mike/join/\n          //\n          //\n          // Define the data set to be visualised\n          var dataSet = svg.selectAll('g.emuhierarchy-node').data(nodes, function (d) {\n              return d.id;\n            });\n          var newNodes = dataSet.enter();\n          var oldNodes = dataSet.exit();\n          //\n          // Add nodes that were previously not part of the svg.\n          //\n          // Any node will consist of an svg group (\"g\"), a circle, a\n          // text and a second, invisible circle for mouseover handling.\n          //\n          // Note that properties that can be changed after the node is \n          // added will be set further below\n          newNodes = newNodes.append('g').attr('class', 'emuhierarchy-node').attr('pointer-events', 'mouseover').on('click', scope.nodeOnClick).on('mouseover', scope.nodeOnMouseOver).on('contextmenu', scope.play);\n          ;\n          newNodes.append('circle').attr('class', 'emuhierarchy-nodeCircle').attr('r', 0).transition().duration(duration).attr('r', 4.5);\n          ;\n          newNodes.append('text').attr('class', 'emuhierarchy-nodeText');\n          ;\n          // Make sure that nodes that appear due to their ancestry being uncollapsed do not fly in from the origin\n          // (as do all other nodes)\n          newNodes.attr('transform', function (d) {\n            if (typeof d._collapsePosition !== 'undefined') {\n              var x = d._collapsePosition[0];\n              var y = d._collapsePosition[1];\n              delete d._collapsePosition;\n              return 'translate(' + x + ',' + y + ')' + scope.getOrientatedNodeTransform();\n            }\n          });\n          /*\n\n\t\t// phantom node to give us mouseover in a radius around it\n\t\tnewNodes.append('circle')\n\t\t\t.attr('class', 'emuhierarchy-ghostCircle')\n\t\t\t.attr('r', 30)\n\t\t\t.attr('opacity', 0.2) // change this to zero to hide the target area\n\t\t\t.style('fill', 'red')\n\t\t\t.attr('pointer-events', 'mouseover')\n\t\t\t.on('mouseover', function (node) {\n\t\t\t\tconsole.debug(node);\n\t\t\t\toverCircle(node);\n\t\t\t})\n\t\t\t.on('mouseout', function (node) {\n\t\t\t\toutCircle(node);\n\t\t\t});\n\n\t\t*/\n          //\n          // Remove nodes that shall no longer be part of the svg\n          // Transition exiting nodes to the origin\n          oldNodes = oldNodes.transition().duration(duration).attr('transform', function (d) {\n            if (d._collapsePosition) {\n              var x = d._collapsePosition[0];\n              var y = d._collapsePosition[1];\n              delete d._collapsePosition;\n              return 'translate(' + x + ',' + y + ')';\n            } else {\n              return 'translate(' + 0 + ',' + 0 + ')';\n            }\n          }).remove();\n          oldNodes.select('text').style('fill-opacity', 0);\n          //\n          // Set or update properties that are subject to change after\n          // the node is added.\n          dataSet.select('text').attr('x', scope.getOrientatedTextX).attr('y', scope.getOrientatedTextY).attr('text-anchor', scope.getOrientatedTextAnchor).attr('transform', scope.getOrientatedTextTransform).text(scope.getNodeText);\n          ;\n          // Change the circle fill depending on whether it has children and is collapsed\n          dataSet.select('circle.emuhierarchy-nodeCircle').classed('collapsed', function (d) {\n            return d._collapsed;\n          }).classed('selected', function (d) {\n            if (typeof scope.selectedItem === 'undefined') {\n              return false;\n            }\n            return d.id === scope.selectedItem.id;\n          });\n          //.attr('r', 4.5)\n          //.style('fill', function (d) {\n          //\treturn d._children ? 'lightsteelblue' : '#fff';\n          //})\n          ;\n          // Transition nodes to their new position\n          dataSet.transition().duration(duration).attr('transform', function (d) {\n            return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n          });\n          //\n          //\n          // Now we turn to visualising links\n          var linkSet = svg.selectAll('path.emuhierarchy-link').data(links, function (d) {\n              // Form unique link ID\n              return 's' + d.fromID + 't' + d.toID;\n            });\n          var newLinks = linkSet.enter();\n          var oldLinks = linkSet.exit();\n          newLinks.insert('path', 'g').attr('class', 'emuhierarchy-link').style('opacity', 0).transition().duration(duration).style('opacity', 1);\n          ;\n          oldLinks.transition().duration(duration).style('opacity', 0).remove();\n          // Transition links to their new position.\n          linkSet.transition().duration(duration).attr('d', scope.getPath).style('opacity', 1);\n          ;\n        };\n        /**\n         * SIC... not being called\n         */\n        scope.resizeHierarchy = function () {\n          console.log('###############');\n          console.log(width);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('epg', [\n  'viewState',\n  function (viewState) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the epg directive');\n        var canvas = element.find('canvas')[0];\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  drawEpgGrid(scope);\n                }\n              }\n            }\n          }\n        }, true);\n        scope.$watch('vs.curMousePosSample', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                drawEpgGrid(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        ////////////////////\n        /**\n\t\t\t\t * drawing method to drawEpgGrid\n\t\t\t\t */\n        function drawEpgGrid(scope) {\n          tr = scope.cps.getSsffTrackConfig('EPG');\n          // SIC SIC SIC hardcoded for now although it might stay that way because it only is allowed to draw epg data anyway\n          col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n          sRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(tr.name);\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.fillStyle = 'green';\n          ctx.strokeStyle = scope.cps.vals.colors.osciColor;\n          ctx.font = scope.cps.vals.font.fontPxSize + 'px' + ' ' + scope.cps.vals.font.fontType;\n          var gridWidth = canvas.width / 8;\n          var gridHeight = canvas.height / 8;\n          var sInterv = 1 / sRaSt.sampleRate - sRaSt.startTime;\n          var curFrame = Math.round(scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate / sInterv);\n          var binValStrArr;\n          angular.forEach(col.values[curFrame], function (el, elIdx) {\n            binValStrArr = el.toString(2).split('').reverse();\n            while (binValStrArr.length < 8) {\n              binValStrArr.push('0');\n            }\n            binValStrArr.forEach(function (binStr, binStrIdx) {\n              if (binStr === '1') {\n                ctx.fillStyle = 'grey';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              } else {\n                ctx.fillStyle = 'white';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              }\n            });\n          });\n          // draw labels\n          var horizontalText = scope.fontImage.getTextImageTwoLines(ctx, 'EPG', 'Frame:' + curFrame, scope.cps.vals.font.fontPxSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, 0, horizontalText.width, horizontalText.height);\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dots', [\n  'viewState',\n  function (viewState) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        var canvas = element.find('canvas')[0];\n        var globalMinX = Infinity;\n        var globalMaxX = -Infinity;\n        var globalMinY = Infinity;\n        var globalMaxY = -Infinity;\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        //\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                drawDots(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  drawDots(scope);\n                }\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMousePosSample', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                drawDots(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curPerspectiveIdx', function () {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        //////////////////\n        function setGlobalMinMaxVals() {\n          // body...\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          }\n        }\n        function getScale(ctx, str, scale) {\n          return ctx.measureText(str).width * scale;\n        }\n        function getScaleWidth(ctx, str1, str2, scaleX) {\n          if (str1.toString().length > str2.toString().length) {\n            return getScale(ctx, str1, scaleX);\n          } else {\n            return getScale(ctx, str2, scaleX);\n          }\n        }\n        /**\n\t\t\t\t * drawing method to drawDots\n\t\t\t\t */\n        function drawDots() {\n          if (globalMinX === Infinity) {\n            setGlobalMinMaxVals();\n          }\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          //////////////////////////////\n          // markup to improve visualization \n          var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          // draw corner pointers\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.lineTo(5, 5);\n          ctx.moveTo(0, canvas.height);\n          ctx.lineTo(5, canvas.height - 5);\n          ctx.moveTo(canvas.width, canvas.height);\n          ctx.lineTo(canvas.width - 5, canvas.height - 5);\n          ctx.stroke();\n          ctx.closePath();\n          var smallFontSize = scope.cps.vals.font.fontPxSize * 3 / 4;\n          // ymax\n          var labelTxtImg = scope.fontImage.getTextImage(ctx, 'yMax: ' + scope.vs.round(globalMaxY, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          ctx.drawImage(labelTxtImg, 5, 5, labelTxtImg.width, labelTxtImg.height);\n          // xmin + y min\n          labelTxtImg = scope.fontImage.getTextImageTwoLines(ctx, 'yMin: ' + scope.vs.round(globalMinY, 2), 'xMin: ' + scope.vs.round(globalMinX, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor, true);\n          ctx.drawImage(labelTxtImg, 5, canvas.height - smallFontSize * scaleY * 2 - 5, labelTxtImg.width, labelTxtImg.height);\n          // xmax\n          var tw = ctx.measureText('xMax: ' + scope.vs.round(globalMaxX, 5)).width * scaleX;\n          // SIC why 5???\n          labelTxtImg = scope.fontImage.getTextImage(ctx, 'xMax: ' + scope.vs.round(globalMaxX, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          ctx.drawImage(labelTxtImg, canvas.width - tw - 5, canvas.height - smallFontSize * scaleY - 5, labelTxtImg.width, labelTxtImg.height);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          // frame nr\n          var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].xSsffTrack);\n          // use first track for sample numbers\n          var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].ySsffTrack);\n          var sInterv = 1 / xsRaSt.sampleRate;\n          var curMousePosTime = scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate;\n          var curFrame;\n          if (xsRaSt.startTime === 1 / xsRaSt.sampleRate / 2) {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate);\n          } else {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate + (xsRaSt.startTime - 1 / xsRaSt.sampleRate / 2) * xsRaSt.sampleRate);\n          }\n          // check if due to math.round curFrame > col.length\n          var trConf = scope.cps.getSsffTrackConfig(dD.dots[0].xSsffTrack);\n          var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n          if (curFrame > xCol.values.length - 1) {\n            curFrame = xCol.values.length - 1;\n          }\n          tw = ctx.measureText('frame: ' + curFrame).width * scaleX;\n          labelTxtImg = scope.fontImage.getTextImage(ctx, 'frame: ' + curFrame, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          var degrees = 90;\n          ctx.save();\n          ctx.rotate(degrees * Math.PI / 180);\n          ctx.drawImage(labelTxtImg, canvas.width / 2 - tw / 2, -canvas.height);\n          ctx.restore();\n          //////////////////////////////\n          // draw dots\n          var allDots = [];\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // check if x and why have the same amount of cols\n            if (xCol.values.length !== yCol.values.length) {\n              alert('columns do not have same length or length of one not 1');\n              return;\n            }\n            var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].xSsffTrack);\n            var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].ySsffTrack);\n            // check if sampleRate and startTime is the same\n            if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n              alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n              return;\n            }\n            var x = (xCol.values[curFrame][dD.dots[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var y = canvas.height - (yCol.values[curFrame][dD.dots[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            var startPoint = Math.PI / 180 * 0;\n            var endPoint = Math.PI / 180 * 360;\n            ctx.strokeStyle = dD.dots[i].color;\n            ctx.beginPath();\n            ctx.arc(x, y, 20, startPoint, endPoint, true);\n            ctx.stroke();\n            ctx.closePath();\n            ctx.beginPath();\n            ctx.arc(x, y, 2, startPoint, endPoint, true);\n            ctx.fill();\n            ctx.closePath();\n            // draw labels\n            var labelTxtImg = scope.fontImage.getTextImage(ctx, dD.dots[i].name, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor);\n            ctx.drawImage(labelTxtImg, x, y - 5, labelTxtImg.width, labelTxtImg.height);\n            // append to all dots\n            allDots.push({\n              'name': dD.dots[i].name,\n              'x': x,\n              'y': y\n            });\n          }\n          var f, t;\n          dD.connectLines.forEach(function (c) {\n            allDots.forEach(function (d) {\n              if (d.name === c.fromDot) {\n                f = d;\n              }\n              if (d.name === c.toDot) {\n                t = d;\n              }\n            });\n            // draw line\n            ctx.strokeStyle = c.color;\n            ctx.beginPath();\n            ctx.moveTo(f.x, f.y);\n            ctx.lineTo(t.x, t.y);\n            ctx.stroke();\n            ctx.closePath();\n          });\n        }\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZone', [\n  '$animate',\n  function ($animate) {\n    return {\n      templateUrl: 'views/myDropZone.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attr) {\n        scope.dropDefault = 'Drop your files here or click here to open a file';\n        scope.dropErrorFileType = 'Error: Could not parse file. The following file types are supported: .WAV .TEXTGRID';\n        scope.dropErrorAPI = 'Sorry ! The File APIs are not fully supported in your browser.';\n        scope.dropNotAllowed = 'File is not allowed';\n        scope.dropAllowed = 'Drop files to start loading';\n        scope.dropParsingStarted = 'Parsing started';\n        scope.dropText = scope.dropDefault;\n        scope.dropClass = '';\n        function dragEnterLeave(evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropDefault;\n            scope.dropClass = '';\n          });\n        }\n        function handleDragOver(evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropAllowed;\n            scope.dropClass = 'over';\n          });\n        }\n        function dropFiles(evt) {\n          evt.stopPropagation();\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropParsingStarted;\n            scope.dropClass = '';\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\n              scope.dropText = scope.dropParsingStarted;\n              scope.dropClass = 'over';\n              if (evt.originalEvent !== undefined) {\n                if (scope.firefox) {\n                  var dt = evt.originalEvent.dataTransfer;\n                  var files = dt.files;\n                  var count = files.length;\n                  for (var i = 0; i < files.length; i++) {\n                    scope.traverseFileTreeFirefox(files[i]);\n                  }\n                } else {\n                  var items = evt.originalEvent.dataTransfer.items;\n                  for (var i = 0; i < items.length; i++) {\n                    var item = items[i].webkitGetAsEntry();\n                    if (item) {\n                      scope.traverseFileTreeChrome(item);\n                    }\n                  }\n                }\n              } else {\n                scope.dropText = scope.dropErrorFileType;\n                scope.dropClass = '';\n              }\n            } else {\n              scope.$parent.dials.open('views/error.html', 'ModalCtrl', scope.dropErrorAPI);\n              scope.dropText = $scope.dropDefault;\n            }\n          });\n        }\n        element.bind('drop', function (event) {\n          dropFiles(event);\n        });\n        element.bind('dragover', function (event) {\n          handleDragOver(event);\n        });\n        element.bind('dragenter', function (event) {\n          dragEnterLeave(event);\n        });\n        element.bind('dragleave', function (event) {\n          dragEnterLeave(event);\n        });\n        element.bind('click', function (event) {\n          element.context.children[0].children[1].click();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZoneInput', [\n  '$animate',\n  function ($animate) {\n    return {\n      templateUrl: 'views/myDropZoneInput.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attr) {\n        scope.handler = false;\n        function handleFilesonChange() {\n          scope.handler = true;\n          var loadedFiles = element.context.children.fileDialog;\n          if (scope.firefox) {\n            for (var i = 0; i < loadedFiles.files.length; i++) {\n              var file = loadedFiles.files[i];\n              var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n              if (extension === 'WAV' && file.type.match('audio/x-wav')) {\n                scope.wav = file;\n                scope.handleLocalFiles();\n              } else if (extension === 'TEXTGRID') {\n                scope.grid = file;\n              } else {\n                scope.other = file;\n              }\n            }\n          } else {\n            for (var i = 0; i < loadedFiles.files.length; i++) {\n              var file = loadedFiles.files[i];\n              var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n              if (extension === 'WAV' && file.type.match('audio/wav')) {\n                scope.wav = file;\n                scope.handleLocalFiles();\n              } else if (extension === 'TEXTGRID') {\n                scope.grid = file;\n              } else {\n                scope.other = file;\n              }\n            }\n          }\n        }\n        element.bind('change', function (event) {\n          handleFilesonChange(event);\n        });\n        element.bind('click', function (event) {\n          var elem = angular.element('input');\n          if (elem[1] !== undefined) {\n            elem[1].click();\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuwebapp', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/emuwebapp.html',\n      restrict: 'E',\n      scope: {\n        audioGetUrl: '@',\n        labelGetUrl: '@',\n        labelType: '@'\n      },\n      link: function postLink(scope, element, attrs) {\n        ////////////////////////\n        // Bindings\n        element.bind('mouseenter', function (event) {\n          viewState.mouseInEmuWebApp = true;\n        });\n        element.bind('mouseleave', function (event) {\n          viewState.mouseInEmuWebApp = false;\n        });\n        ///////////////////////\n        // observe attrs\n        attrs.$observe('audioGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.audioGetUrl = val;\n          }\n        });\n        attrs.$observe('labelGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelGetUrl = val;\n          }\n        });\n        attrs.$observe('labelType', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelType = val;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Validationservice', [\n  '$http',\n  '$q',\n  function Validationservice($http, $q) {\n    //shared service object to be returned\n    var sServObj = {};\n    var schemasJsos = [];\n    var names = [\n        'annotationFileSchema',\n        'emuwebappConfigSchema',\n        'DBconfigFileSchema',\n        'bundleListSchema'\n      ];\n    /**\n\t\t *\n\t\t */\n    sServObj.loadSchemas = function () {\n      var proms = [];\n      angular.forEach(names, function (n) {\n        proms.push($http.get('schemaFiles/' + n + '.json'));\n      });\n      return $q.all(proms);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setSchemas = function (schemaArr) {\n      angular.forEach(schemaArr, function (s) {\n        schemasJsos.push({\n          name: s.config.url,\n          data: s.data\n        });\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.validateJSO = function (schemaName, jso) {\n      var schema;\n      angular.forEach(schemasJsos, function (s) {\n        if (s.name === 'schemaFiles/' + schemaName + '.json') {\n          schema = s;\n        }\n      });\n      if (schema !== undefined && tv4.validate(jso, schema.data)) {\n        return true;\n      } else {\n        if (schema === undefined) {\n          return 'Schema: ' + schemaName + ' is currently undefined! This is probably due to a misnamed schema file on the server...';\n        } else {\n          return tv4.error;\n        }\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ShowhierarchyCtrl', [\n  '$scope',\n  'viewState',\n  'dialogService',\n  'ConfigProviderService',\n  'LevelService',\n  'HierarchyLayoutService',\n  function ($scope, viewState, dialogService, ConfigProviderService, LevelService, HierarchyLayoutService) {\n    // Scope data\n    var rotated = false;\n    var playing = 0;\n    $scope.paths = {\n      possible: [],\n      possibleAsStr: [],\n      selected: ''\n    };\n    // Find non-ITEM levels to start calculating possible paths through the hierarchy of levels\n    angular.forEach(ConfigProviderService.curDbConfig.levelDefinitions, function (l) {\n      if (l.type !== 'ITEM') {\n        $scope.paths.possible = $scope.paths.possible.concat(HierarchyLayoutService.findPaths(l.name));\n      }\n    });\n    // convert array paths to strings\n    angular.forEach($scope.paths.possible, function (arr, arrIdx) {\n      if (arrIdx === 0) {\n        // select first possible path on load\n        $scope.paths.selected = arr.join(' \\u2190 ');\n      }\n      $scope.paths.possibleAsStr.push(arr.join(' \\u2190 '));\n    });\n    //////////////\n    // watches\n    //\n    //////////////\n    /**\n\t\t * Returns index of the currently selected path (within the $scope.paths.possible array)\n\t\t */\n    $scope.getSelIdx = function () {\n      var selIdx = $scope.paths.possibleAsStr.indexOf($scope.paths.selected);\n      return selIdx;\n    };\n    $scope.rotateHierarchy = function () {\n      rotated = !rotated;\n    };\n    $scope.getRotation = function () {\n      return rotated;\n    };\n    $scope.playSelection = function () {\n      ++playing;\n    };\n    $scope.getPlaying = function () {\n      return playing;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.isCurrentAttrDef = function (levelName, attrDef) {\n      if (viewState.getCurAttrDef(levelName) === attrDef) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t * set current attribute definition\n\t\t * just delegates same fuction call to viewState\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @param attrDef name of attribute definition\n\t\t */\n    $scope.setCurrentAttrDef = function (levelName, attrDef) {\n      viewState.setCurAttrDef(levelName, attrDef);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getAllAttrDefs = function (levelName) {\n      var levDef = ConfigProviderService.getLevelDefinition(levelName);\n      return levDef.attributeDefinitions;\n    };\n    /**\n\t\t * cancel dialog i.e. close\n\t\t */\n    $scope.cancel = function () {\n      dialogService.close();\n    };\n  }\n]);\n'use strict';\n/**\n * This service aims to provide functions for laying out the hierarchy of a\n * bundle (ie, calculating the positions of the nodes). The actual drawing is\n * done in a directive, the manipulation of the hierarchy is done in another\n * service.\n *\n * While the DBConfig allows for a complex network of levels, the visualisation\n * is always limited to one straight path of levels. Set this path via the\n * public function setPath(p).\n *\n * A selection menu shall be offered comprising all possible paths through the\n * hierarchy.\n */\nangular.module('emuwebApp').service('HierarchyLayoutService', [\n  'ConfigProviderService',\n  'LevelService',\n  function (ConfigProviderService, LevelService) {\n    // shared service object\n    var sServObj = {};\n    ////////////////////////////////////////////\n    // private vars and functions\n    var svgGroup;\n    var parentsFound;\n    //\n    /////////////////////\n    /////////////////////\n    // public API\n    /**\n\t\t * Find all parent levels of a given level by iterating through the\n\t\t * current database's linkDefinitions.\n\t\t *\n\t\t * @param childLevel The name of the level whose parents to find\n\t\t * @returns An array of names of childLevel's parent levels\n\t\t */\n    sServObj.findParentLevels = function (childLevel) {\n      var parents = [];\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === childLevel) {\n          parents.push(ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName);\n        }\n      }\n      return parents;\n    };\n    /**\n\t\t * Calculate the position of nodes within a non-item level (ie, one with time information)\n\t\t *\n\t\t * The nodes are positioned at a regular distance to each other.\n\t\t * The first node will be at position -0.5, the last at somewhat\n\t\t * below 0.5.\n\t\t *\n\t\t * It is taken for granted that the order of the nodes within\n\t\t * the array is coherent with the time information.\n\t\t */\n    sServObj.layoutNonItemLevel = function (name, levelDepth) {\n      var nodes = LevelService.getLevelDetails(name).level.items;\n      for (var i = 0; i < nodes.length; ++i) {\n        nodes[i]._posInLevel = i / nodes.length + 0.01;\n        //- 0.5;\n        nodes[i]._depth = levelDepth;\n        // Additionally, calculate link positions\n        var links = LevelService.getData().links;\n        for (var l = 0; l < links.length; ++l) {\n          if (links[l].toID === nodes[i].id) {\n            links[l]._toPosInLevel = nodes[i]._posInLevel;\n            links[l]._toDepth = nodes[i]._depth;\n          }\n        }\n      }\n    };\n    /**\n\t\t * Calculate the position of nodes within an item level (ie, one without time information)\n\t\t * \n\t\t * This is done by looking at the position of the first and the\n\t\t * last child of each node and centering the node in-between\n\t\t */\n    sServObj.layoutItemLevel = function (name, levelDepth) {\n      var nodes = LevelService.getLevelDetails(name).level.items;\n      for (var i = 0; i < nodes.length; ++i) {\n        // Find first and last child of nodes[i]\n        var children = sServObj.findChildren(nodes[i], selectedPath);\n        if (children.length === 0) {\n          nodes[i]._posInLevel = null;\n        }\n        // FIXME if this function was actually used, the following would of course fail if children was an empty array\n        var firstChild = children[0];\n        var lastChild = children[children.length - 1];\n        nodes[i]._posInLevel = firstChild._posInLevel + (lastChild._posInLevel - firstChild._posInLevel) / 2;\n        nodes[i]._depth = levelDepth;\n        // Additionally, calculate link positions\n        var links = LevelService.getData().links;\n        for (var l = 0; l < links.length; ++l) {\n          if (links[l].toID === nodes[i].id) {\n            links[l]._toPosInLevel = nodes[i]._posInLevel;\n            links[l]._toDepth = nodes[i]._depth;\n          }\n          if (links[l].fromID === nodes[i].id) {\n            links[l]._fromPosInLevel = nodes[i]._posInLevel;\n            links[l]._fromDepth = nodes[i]._depth;\n          }\n        }\n      }\n    };\n    /**\n\t\t * This function aims to find and store the parents of every node\n\t\t */\n    sServObj.findParents = function (selectedPath) {\n      var i, ii, c;\n      if (parentsFound) {\n        return;\n      } else {\n        parentsFound = true;\n      }\n      /////\n      // Iterate throug levels top-down\n      for (i = selectedPath.length - 1; i >= 0; --i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]).level;\n        // Iterate through the current level's items\n        // And save them as _parents in their children\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var children = sServObj.findChildren(level.items[ii], selectedPath);\n          //console.debug('label', level.items[ii].labels[0].value, 'number of children: ', children.length);\n          for (c = 0; c < children.length; ++c) {\n            if (typeof children[c]._parents === 'undefined') {\n              children[c]._parents = [];\n            }\n            children[c]._parents.push(level.items[ii]);\n          }\n        }\n      }\n    };\n    /**\n\t\t * Calculate the weights (size within their level) of all nodes bottom-up\n\t\t * This is most likely rather slow and definitely needs tweaking\n\t\t */\n    sServObj.calculateWeightsBottomUp = function (selectedPath) {\n      var i, ii, iii;\n      sServObj.findParents(selectedPath);\n      // Iterate through levels bottom-up\n      for (i = 0; i < selectedPath.length; ++i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]).level;\n        level._weight = 0;\n        //////\n        // Iterate through items to calculate their _weight and the level's _weight\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var itemWeight = level.items[ii]._weight;\n          if (typeof itemWeight === 'undefined') {\n            itemWeight = 1;\n            level.items[ii]._weight = 1;\n          }\n          // This would create tidier drawings but depends on knowledge of each node's parents \n          if (typeof level.items[ii]._parents !== 'undefined') {\n          }\n          level._weight += itemWeight;\n        }\n        /////\n        // Iterate through items again to calculate their _posInLevel and _depth.\n        // This is done in a new for loop because it depends on the correctness of level._weight\n        var posInLevel = 0;\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._posInLevel = (posInLevel + level.items[ii]._weight / 2) / level._weight;\n          posInLevel += level.items[ii]._weight;\n          level.items[ii]._depth = selectedPath.length - i - 1;\n          //////\n          // Additionally, calculate link positions\n          var links = LevelService.getData().links;\n          for (var l = 0; l < links.length; ++l) {\n            if (links[l].toID === level.items[ii].id) {\n              links[l]._toPosInLevel = level.items[ii]._posInLevel;\n              links[l]._toDepth = level.items[ii]._depth;\n            }\n            if (links[l].fromID === level.items[ii].id) {\n              links[l]._fromPosInLevel = level.items[ii]._posInLevel;\n              links[l]._fromDepth = level.items[ii]._depth;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t * Recursively find all paths through the hierarchy of levels.\n\t\t * This is done bottom-up because there is no explicit root element in the levelDefinitions.\n\t\t *\n\t\t * @param startLevel The name of the level from which to start\n\t\t * @param path An array of levels' names that form a path to startLevel (optional; shouldn't be an empty array)\n\t\t */\n    sServObj.findPaths = function (startLevel, path) {\n      if (typeof path === 'undefined') {\n        var path = [startLevel];\n      } else {\n        path = path.concat([startLevel]);\n      }\n      // Find all parents of startLevel\n      var parents = this.findParentLevels(startLevel);\n      // If we have no more parents, we're at the end of the\n      // path and thus returning it\n      if (parents.length === 0) {\n        return [path];\n      }\n      // If, on the other hand, there are parents, we start\n      // recursion to find all paths\n      var paths = [];\n      for (var i = 0; i < parents.length; ++i) {\n        paths = paths.concat(sServObj.findPaths(parents[i], path));\n      }\n      return paths;\n    };\n    /**\n\t\t * SIC this should probably be moved to the LevelService as it might\n\t\t * be useful for other parts of the webApp\n\t\t */\n    sServObj.getLevelName = function (nodeID) {\n      var levelName = null;\n      for (var i = 0; i < LevelService.getData().levels.length; ++i) {\n        for (var ii = 0; ii < LevelService.getData().levels[i].items.length; ++ii) {\n          if (LevelService.getData().levels[i].items[ii].id === nodeID) {\n            levelName = LevelService.getData().levels[i].name;\n            break;\n          }\n        }\n      }\n      return levelName;\n    };\n    /**\n\t\t * Find all children of a node d that are part of the currently selected\n\t\t * path through the hierarchy\n\t\t *\n\t\t * @return an array of children nodes\n\t\t * @return empty array if there are no children (previously would return null due to a d3 dependency that no longer exists)\n\t\t */\n    sServObj.findChildren = function (d, selectedPath) {\n      var children = [];\n      // Find the level that d is a part of\n      // Return empty array if that fails (which shouldn't happen at all)\n      var currentLevel = sServObj.getLevelName(d.id);\n      if (currentLevel === null) {\n        console.log('Likely a bug: failed to find a node\\'s level', d);\n        return [];\n      }\n      // Find the child level\n      var childLevel = null;\n      for (var i = 0; i < selectedPath.length - 1; ++i) {\n        if (selectedPath[i + 1] === currentLevel) {\n          childLevel = selectedPath[i];\n          break;\n        }\n      }\n      if (childLevel === null) {\n        return [];\n      }\n      // Iterate over links to find children\n      for (var li = 0; li < LevelService.getData().links.length; ++li) {\n        if (LevelService.getData().links[li].fromID === d.id) {\n          // Iterate over levels to find the object corresponding to d.id\n          for (var l = 0; l < LevelService.getData().levels.length; ++l) {\n            if (LevelService.getData().levels[l].name !== childLevel) {\n              continue;\n            }\n            for (var it = 0; it < LevelService.getData().levels[l].items.length; ++it) {\n              if (LevelService.getData().levels[l].items[it].id === LevelService.getData().links[li].toID) {\n                children.push(LevelService.getData().levels[l].items[it]);\n              }\n            }\n          }\n        }\n      }\n      return children;\n    };\n    return sServObj;\n  }\n]);\n/*##########################################\n##########################################\n##########################################\n########  THE REMAINDER IS ONLY LEFT TO ##\n########  USE SOME IDEAS – IT IS NEVER  ##\n########  CALLED                        ##\n##########################################\n##########################################\n##########################################\n*/\n/**\n\t\t * @todo documentation\n\t\t * for the time being: this function is no fun to read because it is based on a d3 example and contains a lot of sub-functions.\n\t\t * you'd better wait until I have polished it to a certain degree.\n\t\t */\n//sServObj.oldDrawHierarchy = function () {\nvar foooooooo = function () {\n  // Make sure that any private properties that have been added during a previous call of this function are removed\n  for (var x = 0; x < LevelService.getData().levels.length; ++x) {\n    for (var y = 0; y < LevelService.getData().levels[x].items.length; ++y) {\n      delete LevelService.getData().levels[x].items[y]._visited;\n      delete LevelService.getData().levels[x].items[y]._parents;\n      delete LevelService.getData().levels[x].items[y]._weight;\n    }\n  }\n  // Calculate total nodes, max label length\n  var totalNodes = 0;\n  var maxLabelLength = 0;\n  // variables for drag/drop\n  var selectedNode = null;\n  var draggingNode = null;\n  // panning variables\n  var panSpeed = 200;\n  var panBoundary = 20;\n  // Within 20px from edges will pan when dragging.\n  // Misc. variables\n  var i = 0;\n  var tree = d3.layout.myLayout().size([\n      viewerHeight,\n      viewerWidth\n    ]);\n  tree = tree.children(sServObj.findChildren);\n  // define a d3 diagonal projection for use by the node paths later on.\n  var diagonal = d3.svg.diagonal().projection(function (d) {\n      return [\n        d.y,\n        d.x\n      ];\n    });\n  // A recursive helper function for performing some setup by walking through all nodes\n  function visit(parent, visitFn, childrenFn) {\n    if (!parent)\n      return;\n    visitFn(parent);\n    var children = childrenFn(parent);\n    if (children) {\n      var count = children.length;\n      for (var i = 0; i < count; i++) {\n        visit(children[i], visitFn, childrenFn);\n      }\n    }\n  }\n  // Call visit function to establish maxLabelLength\n  /*visit(LevelService.getData(), function(d) {\n\t\t\t\ttotalNodes++;\n\t\t\t\tmaxLabelLength = Math.max(d.name.length, maxLabelLength);\n\n\t\t\t}, function(d) {\n\t\t\t\treturn d.children && d.children.length > 0 ? d.children : null;\n\t\t\t});*/\n  maxLabelLength = 15;\n  // sort the tree according to the node names\n  function sortTree() {\n  }\n  // Sort the tree initially incase the JSON isn't in a sorted order.\n  sortTree();\n  // TODO: Pan function, can be better implemented.\n  function pan(domNode, direction) {\n    var speed = panSpeed;\n    if (panTimer) {\n      clearTimeout(panTimer);\n      translateCoords = d3.transform(svgGroup.attr('transform'));\n      if (direction == 'left' || direction == 'right') {\n        translateX = direction == 'left' ? translateCoords.translate[0] + speed : translateCoords.translate[0] - speed;\n        translateY = translateCoords.translate[1];\n      } else if (direction == 'up' || direction == 'down') {\n        translateX = translateCoords.translate[0];\n        translateY = direction == 'up' ? translateCoords.translate[1] + speed : translateCoords.translate[1] - speed;\n      }\n      scaleX = translateCoords.scale[0];\n      scaleY = translateCoords.scale[1];\n      var scale = zoomListener.scale();\n      svgGroup.transition().attr('transform', 'translate(' + translateX + ',' + translateY + ')scale(' + scale + ')');\n      d3.select(domNode).select('g.node').attr('transform', 'translate(' + translateX + ',' + translateY + ')');\n      zoomListener.scale(zoomListener.scale());\n      zoomListener.translate([\n        translateX,\n        translateY\n      ]);\n      panTimer = setTimeout(function () {\n        pan(domNode, speed, direction);\n      }, 50);\n    }\n  }\n  function initiateDrag(d, domNode) {\n    draggingNode = d;\n    d3.select(domNode).select('.ghostCircle').attr('pointer-events', 'none');\n    d3.selectAll('.ghostCircle').attr('class', 'ghostCircle show');\n    d3.select(domNode).attr('class', 'node activeDrag');\n    svgGroup.selectAll('g.node').sort(function (a, b) {\n      // select the parent and sort the path's\n      if (a.id != draggingNode.id)\n        return 1;  // a is not the hovered element, send \"a\" to the back\n      else\n        return -1;  // a is the hovered element, bring \"a\" to the front\n    });\n    // if nodes has children, remove the links and nodes\n    if (nodes.length > 1) {\n      // remove link paths\n      links = tree.links(nodes);\n      nodePaths = svgGroup.selectAll('path.link').data(links, function (d) {\n        return d.target.id;\n      }).remove();\n      // remove child nodes\n      nodesExit = svgGroup.selectAll('g.node').data(nodes, function (d) {\n        return d.id;\n      }).filter(function (d, i) {\n        if (d.id == draggingNode.id) {\n          return false;\n        }\n        return true;\n      }).remove();\n    }\n    // remove parent link\n    parentLink = tree.links(tree.nodes(draggingNode.parent));\n    svgGroup.selectAll('path.link').filter(function (d, i) {\n      if (d.target.id == draggingNode.id) {\n        return true;\n      }\n      return false;\n    }).remove();\n    dragStarted = null;\n  }\n  // define the baseSvg, attaching a class for styling and the zoomListener\n  d3.select('#emuwebapp-tree-container svg').remove();\n  var baseSvg = d3.select('#emuwebapp-tree-container').append('svg').attr('width', viewerWidth).attr('height', viewerHeight).attr('class', 'overlay').call(zoomListener);\n  // Define the drag listeners for drag/drop behaviour of nodes.\n  /*var dragListener = d3.behavior.drag()\n\t\t\t\t.on(\"dragstart\", function(d) {\n\t\t\t\t\tif (d == root) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdragStarted = true;\n\t\t\t\t\tnodes = tree.nodes(d);\n\t\t\t\t\td3.event.sourceEvent.stopPropagation();\n\t\t\t\t\t// it's important that we suppress the mouseover event on the node being dragged. Otherwise it will absorb the mouseover event and the underlying node will not detect it d3.select(sServObj).attr('pointer-events', 'none');\n\t\t\t\t})\n\t\t\t\t.on(\"drag\", function(d) {\n\t\t\t\t\tif (d == root) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (dragStarted) {\n\t\t\t\t\t\tdomNode = sServObj;\n\t\t\t\t\t\tinitiateDrag(d, domNode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get coords of mouseEvent relative to svg container to allow for panning\n\t\t\t\t\trelCoords = d3.mouse($('svg').get(0));\n\t\t\t\t\tif (relCoords[0] < panBoundary) {\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'left');\n\t\t\t\t\t} else if (relCoords[0] > ($('svg').width() - panBoundary)) {\n\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'right');\n\t\t\t\t\t} else if (relCoords[1] < panBoundary) {\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'up');\n\t\t\t\t\t} else if (relCoords[1] > ($('svg').height() - panBoundary)) {\n\t\t\t\t\t\tpanTimer = true;\n\t\t\t\t\t\tpan(sServObj, 'down');\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tclearTimeout(panTimer);\n\t\t\t\t\t\t} catch (e) {\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\td.x0 += d3.event.dy;\n\t\t\t\t\td.y0 += d3.event.dx;\n\t\t\t\t\tvar node = d3.select(sServObj);\n\t\t\t\t\tnode.attr(\"transform\", \"translate(\" + d.y0 + \",\" + d.x0 + \")\");\n\t\t\t\t\tupdateTempConnector();\n\t\t\t\t}).on(\"dragend\", function(d) {\n\t\t\t\t\tif (d == root) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdomNode = sServObj;\n\t\t\t\t\tif (selectedNode) {\n\t\t\t\t\t\t// now remove the element from the parent, and insert it into the new elements children\n\t\t\t\t\t\tvar index = draggingNode.parent.children.indexOf(draggingNode);\n\t\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\t\tdraggingNode.parent.children.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof selectedNode.children !== 'undefined' || typeof selectedNode._children !== 'undefined') {\n\t\t\t\t\t\t\tif (typeof selectedNode.children !== 'undefined') {\n\t\t\t\t\t\t\t\tselectedNode.children.push(draggingNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselectedNode._children.push(draggingNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselectedNode.children = [];\n\t\t\t\t\t\t\tselectedNode.children.push(draggingNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Make sure that the node being added to is expanded so user can see added node is correctly moved\n\t\t\t\t\t\texpand(selectedNode);\n\t\t\t\t\t\tsortTree();\n\t\t\t\t\t\tendDrag();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendDrag();\n\t\t\t\t\t}\n\t\t\t\t});\n/*\n\t\t\tfunction endDrag() {\n\t\t\t\tselectedNode = null;\n\t\t\t\td3.selectAll('.ghostCircle').attr('class', 'ghostCircle');\n\t\t\t\td3.select(domNode).attr('class', 'node');\n\t\t\t\t// now restore the mouseover event or we won't be able to drag a 2nd time\n\t\t\t\td3.select(domNode).select('.ghostCircle').attr('pointer-events', '');\n\t\t\t\tupdateTempConnector();\n\t\t\t\tif (draggingNode !== null) {\n\t\t\t\t\tupdate(root);\n\t\t\t\t\tcenterNode(draggingNode);\n\t\t\t\t\tdraggingNode = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Helper functions for collapsing and expanding nodes.\n\n\t\t\tfunction collapse(d) {\n\t\t\t\tif (d.children) {\n\t\t\t\t\td._children = d.children;\n\t\t\t\t\td._children.forEach(collapse);\n\t\t\t\t\td.children = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction expand(d) {\n\t\t\t\tif (d._children) {\n\t\t\t\t\td.children = d._children;\n\t\t\t\t\td.children.forEach(expand);\n\t\t\t\t\td._children = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar overCircle = function(d) {\n\t\t\t\tselectedNode = d;\n\t\t\t\tupdateTempConnector();\n\t\t\t};\n\t\t\tvar outCircle = function(d) {\n\t\t\t\tselectedNode = null;\n\t\t\t\tupdateTempConnector();\n\t\t\t};\n\n\t\t\t// Function to update the temporary connector indicating dragging affiliation\n\t\t\tvar updateTempConnector = function() {\n\t\t\t\tvar data = [];\n\t\t\t\tif (draggingNode !== null && selectedNode !== null) {\n\t\t\t\t\t// have to flip the source coordinates since we did sServObj for the existing connectors on the original tree\n\t\t\t\t\tdata = [{\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\tx: selectedNode.y0,\n\t\t\t\t\t\t\ty: selectedNode.x0\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttarget: {\n\t\t\t\t\t\t\tx: draggingNode.y0,\n\t\t\t\t\t\t\ty: draggingNode.x0\n\t\t\t\t\t\t}\n\t\t\t\t\t}];\n\t\t\t\t}\n\t\t\t\tvar link = svgGroup.selectAll(\".templink\").data(data);\n\n\t\t\t\tlink.enter().append(\"path\")\n\t\t\t\t\t.attr(\"class\", \"templink\")\n\t\t\t\t\t.attr(\"d\", d3.svg.diagonal())\n\t\t\t\t\t.attr('pointer-events', 'none');\n\n\t\t\t\tlink.attr(\"d\", d3.svg.diagonal());\n\n\t\t\t\tlink.exit().remove();\n\t\t\t};*/\n  // Toggle children function\n  function toggleChildren(d) {\n    if (d.children) {\n      d._children = d.children;\n      d.children = null;\n    } else if (d._children) {\n      d.children = d._children;\n      d._children = null;\n    }\n    return d;\n  }\n  // Toggle children on click.\n  function click(d) {\n    if (d3.event.defaultPrevented)\n      return;\n    // click suppressed\n    d = toggleChildren(d);\n    update(d);\n    centerNode(d);\n  }\n  function update(source) {\n    //\n    // Compute the new height, function counts total children of root node and sets tree height accordingly.\n    // sServObj prevents the layout looking squashed when new nodes are made visible or looking sparse when nodes are removed\n    // sServObj makes the layout more consistent.\n    var levelWidth = [1];\n    var childCount = function (level, n) {\n      //if (n.children && n.children.length > 0) {\n      var children = tree.children()(n);\n      if (children && children.length > 0) {\n        if (levelWidth.length <= level + 1)\n          levelWidth.push(0);\n        levelWidth[level + 1] += children.length;\n        children.forEach(function (d) {\n          childCount(level + 1, d);\n        });\n      }\n    };\n    childCount(0, root);\n    var newHeight = d3.max(levelWidth) * 25;\n    // 25 pixels per line\n    tree = tree.size([\n      newHeight,\n      viewerWidth\n    ]);\n    // Compute the new tree layout.\n    var nodes = tree.nodes(root).reverse(), links = tree.links(nodes);\n    sServObj.calculateWeightsBottomUp();\n    // Set widths between levels based on maxLabelLength.\n    nodes.forEach(function (d) {\n      d.y = d.depth * (maxLabelLength * 10);  //maxLabelLength * 10px\n                                              // alternatively to keep a fixed scale one can set a fixed depth per level\n                                              // Normalize for fixed-depth by commenting out below line\n                                              // d.y = (d.depth * 500); //500px per level.\n                                              //console.debug(d);\n                                              //d.x = 20* d._weight / d._levelWeight;\n                                              //level.items[ii].x = 20*  level.items[ii]._weight / level._weight;\n    });\n    // Update the nodes…\n    var node = svgGroup.selectAll('g.node').data(nodes, function (d) {\n        return d.id || (d.id = ++i);\n      });\n    // Enter any new nodes at the parent's previous position.\n    var nodeEnter = node.enter().append('g').attr('class', 'node').attr('transform', function (d) {\n        return 'translate(' + source.y0 + ',' + source.x0 + ')';\n      }).on('click', click);\n    nodeEnter.append('circle').attr('class', 'nodeCircle').attr('r', 0).style('fill', function (d) {\n      return d._children ? 'lightsteelblue' : '#fff';\n    });\n    nodeEnter.append('text').attr('x', function (d) {\n      return d.children || d._children ? -10 : 10;\n    }).attr('dy', '.35em').attr('class', 'nodeText').attr('text-anchor', function (d) {\n      return d.children || d._children ? 'end' : 'start';\n    }).text(function (d) {\n      var text = d.labels[0].value;\n      for (var i = 1; i < d.labels.length; ++i) {\n        text += ' / ' + d.labels[i].name + ': ' + d.labels[i].value;\n      }\n      return text;\n    }).style('fill-opacity', 0);\n    // phantom node to give us mouseover in a radius around it\n    nodeEnter.append('circle').attr('class', 'ghostCircle').attr('r', 30).attr('opacity', 0.2).style('fill', 'red').attr('pointer-events', 'mouseover').on('mouseover', function (node) {\n      overCircle(node);\n    }).on('mouseout', function (node) {\n      outCircle(node);\n    });\n    // Update the text to reflect whether node has children or not.\n    node.select('text').attr('transform', function (d) {\n      if (rotated) {\n        return 'scale(1, -1)';  // SIC SIC SIC ... not working\n      } else {\n        return 'scale(1, 1)';\n      }\n    }).attr('x', 10).attr('text-anchor', 'start').text(function (d) {\n      var text = d.labels[0].value;\n      for (var i = 1; i < d.labels.length; ++i) {\n        text += ' / ' + d.labels[i].name + ': ' + d.labels[i].value;\n      }\n      return text;\n    });\n    // Change the circle fill depending on whether it has children and is collapsed\n    node.select('circle.nodeCircle').attr('r', 4.5).style('fill', function (d) {\n      return d._children ? 'lightsteelblue' : '#fff';\n    });\n    // Transition nodes to their new position.\n    var nodeUpdate = node.transition().duration(duration).attr('transform', function (d) {\n        return 'translate(' + d.y + ',' + d.x + ')';\n      });\n    // Fade the text in\n    nodeUpdate.select('text').style('fill-opacity', 1);\n    // Transition exiting nodes to the parent's new position.\n    var nodeExit = node.exit().transition().duration(duration).attr('transform', function (d) {\n        return 'translate(' + source.y + ',' + source.x + ')';\n      }).remove();\n    nodeExit.select('circle').attr('r', 0);\n    nodeExit.select('text').style('fill-opacity', 0);\n    // Update the links…\n    var link = svgGroup.selectAll('path.link').data(links, function (d) {\n        //return d.target.id;\n        return 's' + d.source.id + 't' + d.target.id;\n      });\n    // Enter any new links at the parent's previous position.\n    link.enter().insert('path', 'g').attr('class', 'link').attr('d', function (d) {\n      var o = {\n          x: source.x0,\n          y: source.y0\n        };\n      return diagonal({\n        source: o,\n        target: o\n      });\n    });\n    // Transition links to their new position.\n    link.transition().duration(duration).attr('d', diagonal);\n    // Transition exiting nodes to the parent's new position.\n    link.exit().transition().duration(duration).attr('d', function (d) {\n      var o = {\n          x: source.x,\n          y: source.y\n        };\n      return diagonal({\n        source: o,\n        target: o\n      });\n    }).remove();\n    // Stash the old positions for transition.\n    nodes.forEach(function (d) {\n      d.x0 = d.x;\n      d.y0 = d.y;\n    });\n    // check for rotation if so rotate\n    if (rotated) {\n    }\n  }\n  // Append a group which holds all nodes and which the zoom Listener can act upon.\n  svgGroup = baseSvg.append('g');\n  // Define the root\n  // I presume that the root level of the currently selected path only has one item,\n  // which will be defined as the hierarchy's root item\n  root = LevelService.getLevelDetails(selectedPath[selectedPath.length - 1]).level.items[0];\n  //root = LevelService.getData().levels[0].items[0];\n  root.x0 = viewerHeight / 2;\n  root.y0 = 0;\n  // Layout the tree initially and center on the root node.\n  update(root);\n  centerNode(root);\n};\n'use strict';\nangular.module('emuwebApp').service('ArrayHelperService', [\n  '$q',\n  'dialogService',\n  function ArrayHelperService($q, dialogService) {\n    // shared service object\n    var sServObj = {};\n    var defer;\n    // defer promise obj\n    /**\n\t\t * convert values of array to max values\n\t\t *\n\t\t * @param arr array to convert\n\t\t * @returns array containing Math.abs() values\n\t\t */\n    sServObj.convertToAbsValues = function (arr) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = Math.abs(arr[i]);\n      }\n      return arr;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.multiplyEachElement = function (arr, val) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = arr[i] * val;\n      }\n      return arr;\n    };\n    /**\n\t\t * find value between two points\n\t\t * by linearly interpolating them\n\t\t */\n    sServObj.interp2points = function (x0, y0, x1, y1, x) {\n      return y0 + (y1 - y0) * ((x - x0) / (x1 - x0));\n    };\n    /**\n\t\t * find min or maximum value in array\n\t\t *\n\t\t * @param arr array to search in\n\t\t * @param minOrMax string value either 'min' or 'max'\n\t\t * @returns object with attributes val and idx\n\t\t */\n    sServObj.findMinMax = function (arr, minOrMax) {\n      var val, idx;\n      if (minOrMax === 'min') {\n        val = Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] < val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      } else if (minOrMax === 'max') {\n        val = -Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] > val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      }\n      return {\n        'val': val,\n        'idx': idx\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.flattenArrayOfArray = function (arrOfArrs) {\n      var merged = [];\n      merged = merged.concat.apply(merged, arrOfArrs);\n      return merged;\n    };\n    /**\n\t\t * convert array to an array that contains\n\t\t * objects of the form {x: i, y:y[i]}\n\t\t */\n    sServObj.convertArrayToXYjsoArray = function (y) {\n      var xyArray = [];\n      for (var i = 0; i < y.length; i++) {\n        xyArray.push({\n          x: i,\n          y: y[i]\n        });\n      }\n      return xyArray;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('AnagestService', [\n  '$q',\n  '$log',\n  'viewState',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  'dialogService',\n  'HistoryService',\n  function AnagestService($q, $log, viewState, LevelService, LinkService, ConfigProviderService, Ssffdataservice, ArrayHelperService, dialogService, HistoryService) {\n    // shared service object\n    var sServObj = {};\n    // defer object \n    var defer;\n    /**\n\t\t *\n\t\t */\n    sServObj.insertAnagestEvents = function () {\n      var defer = $q.defer();\n      // precheck if there are items in selection\n      var itemInSel = viewState.getItemsInSelection(LevelService.data.levels);\n      if (itemInSel.length !== 0) {\n        dialogService.open('views/error.html', 'ModalCtrl', 'There are already events in the selected area! This is not permitted...').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // vertical position signal\n      var trackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.verticalPosSsffTrackName;\n      var tr = ConfigProviderService.getSsffTrackConfig(trackName);\n      var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n      var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n      // velocity signal\n      var vTrackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.velocitySsffTrackName;\n      var vTr = ConfigProviderService.getSsffTrackConfig(vTrackName);\n      var vCol = Ssffdataservice.getColumnOfTrack(vTr.name, vTr.columnName);\n      var vSRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(vTr.name);\n      if (col.length !== 1 || vCol.length !== 1) {\n        dialogService.open('views/error.html', 'ModalCtrl', 'UPS... the column length of of one of the tracks is != 1 this means something is badly configured in the DB!!!').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // flatten columns\n      var flatColVals = ArrayHelperService.flattenArrayOfArray(col.values);\n      var flatVcolVals = ArrayHelperService.flattenArrayOfArray(vCol.values);\n      /////////////////////////////////////////\n      var gdat = [\n          NaN,\n          NaN\n        ];\n      var vdat = [\n          NaN,\n          NaN\n        ];\n      var ndat = [\n          NaN,\n          NaN\n        ];\n      var cdat = [\n          NaN,\n          NaN\n        ];\n      // easiest way to handle non-tangential signals (and has no effect on tangential signals)\n      flatVcolVals = ArrayHelperService.convertToAbsValues(flatVcolVals);\n      // selected column samples\n      var startTimeSel = viewState.getSelectedStartTime();\n      var endTimeSel = viewState.getSelectedEndTime();\n      var colStartSampleNr = Math.round(startTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var colEndSampleNr = Math.round(endTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n      var selCol = flatColVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      var selVCol = flatVcolVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      ;\n      // maxConstr\n      var maxVerticalPos = ArrayHelperService.findMinMax(selCol, 'max');\n      cdat[0] = maxVerticalPos.idx;\n      // max vel before max constriction\n      var maxVelBeforeMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(0, cdat[0] + 1), 'max');\n      vdat[0] = maxVelBeforeMaxConstr.idx;\n      // min vel before max vel\n      var minVelBeforeMaxVel = ArrayHelperService.findMinMax(selVCol.slice(0, vdat[0] + 1), 'min');\n      // gesture onset\n      $log.info('Looking for gesture onset');\n      sServObj.interactiveFindThresholds(selVCol.slice(0, vdat[0] + 1), minVelBeforeMaxVel.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for gesture onset').then(function (resp) {\n        // keyboard;\n        var on20 = resp;\n        gdat[0] = on20;\n        // min vel between max vel 1 and max constriction\n        var minVelBetwMaxVel1maxConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[0], cdat[0] + 1), 'min');\n        var minp = minVelBetwMaxVel1maxConstr.idx + vdat[0];\n        // nucleus onset\n        $log.info('Looking for nucleus onset');\n        sServObj.interactiveFindThresholds(selVCol.slice(vdat[0], minp + 1), minVelBetwMaxVel1maxConstr.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for nucleus onset').then(function (resp) {\n          var off20 = resp;\n          ndat[0] = off20 + vdat[0];\n          // max vel after max constriction\n          var maxVelAfterMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0]), 'max');\n          // max vel before max constriction\n          vdat[1] = maxVelAfterMaxConstr.idx + cdat[0];\n          // minimum between max constriction and max vel after constriction\n          var minBetwMaxConstrMaxVelConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0], vdat[1] + 1), 'min');\n          minp = minBetwMaxConstrMaxVelConstr.idx + cdat[0];\n          // nucleus offset\n          $log.info('Looking for nucleus offset');\n          sServObj.interactiveFindThresholds(selVCol.slice(minp, vdat[1] + 1), minBetwMaxConstrMaxVelConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for nucleus offset').then(function (resp) {\n            var on20 = resp;\n            ndat[1] = on20 + minp;\n            // minimum velocity after max vel after constriction\n            var minVelAfterMaxVelAfterConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[1]), 'min');\n            minp = minVelAfterMaxVelAfterConstr.idx + vdat[1];\n            // gesture offset\n            $log.info('Looking for gesture offset');\n            sServObj.interactiveFindThresholds(selVCol.slice(vdat[1], minp + 1), minVelAfterMaxVelAfterConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for gesture offset').then(function (resp) {\n              var off20 = resp;\n              gdat[1] = off20 + vdat[1];\n              // insert points\n              // var insPoint;\n              var curLabel;\n              // console.log(gdat)\n              gdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              gdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[0];\n              var gdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[0],\n                'id': gdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[1];\n              var gdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[1],\n                'id': gdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(vdat);\n              vdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              vdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[0];\n              var vdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[0],\n                'id': vdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[1];\n              var vdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[1],\n                'id': vdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(ndat);\n              ndat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[0], sRaSt.sampleRate, sRaSt.startTime);\n              ndat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[0];\n              var ndat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[0],\n                'id': ndat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[1];\n              var ndat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[1],\n                'id': ndat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(cdat);\n              cdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + cdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxConstrictionLabel;\n              var cdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), cdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': cdat[0],\n                'id': cdat0insPoint.id,\n                'pointName': curLabel\n              });\n              var linkLevelName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.autoLinkLevelName;\n              var linkLevelDetails = LevelService.getLevelDetails(linkLevelName);\n              var linkLevelLabels = LevelService.getAllLabelsOfLevel(linkLevelDetails);\n              dialogService.open('views/SelectLabelModal.html', 'SelectLabelModalCtrl', linkLevelLabels).then(function (itemIdx) {\n                var childIDs = [\n                    gdat0insPoint.id,\n                    gdat1insPoint.id,\n                    vdat0insPoint.id,\n                    vdat1insPoint.id,\n                    ndat0insPoint.id,\n                    ndat1insPoint.id,\n                    cdat0insPoint.id\n                  ];\n                LinkService.insertLinksTo(linkLevelDetails.level.items[itemIdx].id, childIDs);\n                HistoryService.updateCurChangeObj({\n                  'type': 'ANNOT',\n                  'action': 'INSERTLINKSTO',\n                  'name': linkLevelDetails.level.name,\n                  'parentID': linkLevelDetails.level.items[itemIdx].id,\n                  'childIDs': childIDs\n                });\n                HistoryService.addCurChangeObjToUndoStack();\n              });\n              defer.resolve();\n            });\n          });\n        });\n      }, function () {\n        console.error('rejected duuuude!!!!');\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * find threshold in array (an adapted reimplementation of findth.m by\n\t\t * Phil Hoole Version 17.6.2006)\n\t\t *\n\t\t * @param x\n\t\t * @param minVal\n\t\t * @param maxVal\n\t\t * @param threshold\n\t\t * @param direction\n\t\t * @param descriptions describes the task\n\t\t * @returns promise that resolves to threshold value\n\t\t */\n    sServObj.interactiveFindThresholds = function (x, minVal, maxVal, threshold, direction, description) {\n      // console.log('interactiveFindThresholds');\n      var thdat = minVal + (maxVal - minVal) * threshold;\n      var thdir = direction;\n      thdat = thdat * thdir;\n      var xx = ArrayHelperService.multiplyEachElement(x, thdir);\n      // handle positive/neg.\n      var lx = xx.length;\n      var xsh = xx.slice(1, lx);\n      var loguk = 0;\n      var higuk = lx - 1;\n      // console.log(lx);\n      // console.log(xx);\n      // console.log(xsh);\n      // console.log(loguk);\n      // console.log(higuk);\n      // vz=find((xsh>=thdat)&(xx(1:(lx-1))<thdat));\n      var vz = [];\n      for (var i = 0; i < xx.length; i++) {\n        if (xsh[i] >= thdat && xx[i] < thdat) {\n          vz.push(i);\n        }\n      }\n      // anavv=find(vz>=loguk & vz<=higuk);\n      var anavv = [];\n      for (var i = 0; i < vz.length; i++) {\n        if (vz[i] >= loguk && vz[i] <= higuk) {\n          anavv.push(i);\n        }\n      }\n      if (anavv.length > 1) {\n        defer = $q.defer();\n        var infos = {};\n        infos.description = description;\n        infos.options = [];\n        infos.y = xx;\n        infos.minVal = minVal;\n        infos.maxVal = maxVal;\n        infos.threshold = threshold;\n        for (var i = 0; i < vz.length; i++) {\n          infos.options.push({\n            'thresholdIdx': vz[i],\n            'thresholdValue': xx[i]\n          });\n        }\n        dialogService.open('views/SelectThresholdModal.html', 'SelectThresholdModalCtrl', infos).then(function (resp) {\n          var ap = vz[anavv[resp]];\n          // console.log('-----')\n          // console.log(xx[ap])\n          // console.log(xx[ap + 1])\n          // console.log(ap);\n          // console.log(ap + 1);\n          ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n          defer.resolve(ap);\n        });\n        return defer.promise;\n      } else if (anavv.length === 0) {\n        defer = $q.defer();\n        dialogService.open('views/error.html', 'ModalCtrl', 'Could not find any values that step over the threshold!!').then(function () {\n          defer.reject('Could not find any values that step over the threshold!!');\n        });\n        return defer.promise;\n      } else {\n        defer = $q.defer();\n        var ap = vz[anavv[0]];\n        ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n        defer.resolve(ap);\n        return defer.promise;\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc directive\n * @name emuWebAppApp.directive:lineChart\n * @description\n * # lineChart\n */\nangular.module('emuwebApp').directive('lineChart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      threshold: '='\n    },\n    link: function postLink(scope, element, attrs) {\n      //////////////////////\n      // watches \n      scope.$watch('data', function () {\n        scope.render(scope.data);\n      }, true);\n      //////////////////////\n      //Set margins, width, and height\n      var margin = {\n          top: 20,\n          right: 20,\n          bottom: 20,\n          left: 40\n        }, width = 400 - margin.left - margin.right, height = 200 - margin.top - margin.bottom;\n      //Create the d3 element and position it based on margins\n      var svg = d3.select(element[0]).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      //Create the scales we need for the graph\n      var x = d3.scale.linear().range([\n          0,\n          width\n        ]);\n      var y = d3.scale.linear().range([\n          height,\n          0\n        ]);\n      //Create the axes we need for the graph\n      var xAxis = d3.svg.axis().scale(x).tickSize(5).tickSubdivide(true);\n      var yAxis = d3.svg.axis().scale(y).orient('left');\n      // line drawing function\n      var lineFunc = d3.svg.line().x(function (d) {\n          return x(d.x);\n        }).y(function (d) {\n          return y(d.y);\n        }).interpolate('linear');\n      /**\n\t\t\t\t *\n\t\t\t\t */\n      scope.render = function (data) {\n        //Set our scale's domains\n        // x.domain(data.map(function (d) {\n        // \treturn d.name;\n        // }));\n        // y.domain([0, d3.max(data, function (d) {\n        // \treturn d.count;\n        // })]);\n        x.domain([\n          d3.min(data, function (d) {\n            return d.x;\n          }),\n          d3.max(data, function (d) {\n            return d.x;\n          })\n        ]);\n        y.domain([\n          d3.min(data, function (d) {\n            return d.y;\n          }),\n          d3.max(data, function (d) {\n            return d.y;\n          })\n        ]);\n        //Remove the axes so we can draw updated ones\n        svg.selectAll('g.axis').remove();\n        //Render X axis\n        svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);\n        //Render Y axis\n        svg.append('g').attr('class', 'y axis').call(yAxis);\n        // Render path\n        var lines = svg.append('svg:path').attr('d', lineFunc(data)).attr('stroke', 'red').attr('stroke-width', 1).attr('fill', 'none');\n        // draw threshold SIC SIC SIC... not working yet!\n        svg.append('svg:line').attr('x1', 5).attr('y1', 5).attr('x2', 200).attr('y2', 200).attr('class', 'label-line');\n        var verticalLine = svg.append('line').attr({\n            'x1': x(scope.threshold),\n            'y1': 0,\n            'x2': x(scope.threshold),\n            'y2': height\n          }).attr('stroke', 'steelblue').attr('class', 'verticalLine');  //Create or update the bar data\n                                                                         // var bars = svg.selectAll('.bar').data(data);\n                                                                         // bars.enter()\n                                                                         // \t.append('rect')\n                                                                         // \t.attr('class', 'bar')\n                                                                         // \t.attr('x', function (d) {\n                                                                         // \t\treturn x(d.name);\n                                                                         // \t})\n                                                                         // \t.attr('width', x.rangeBand());\n                                                                         //Animate bars\n                                                                         // bars\n                                                                         // \t.transition()\n                                                                         // \t.duration(1000)\n                                                                         // \t.attr('height', function (d) {\n                                                                         // \t\treturn height - y(d.count);\n                                                                         // \t})\n                                                                         // \t.attr('y', function (d) {\n                                                                         // \t\treturn y(d.count);\n                                                                         // \t})\n      };\n    }\n  };\n});"]}