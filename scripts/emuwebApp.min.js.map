{"version":3,"file":"emuwebApp.min.js","sources":["emuwebApp.min.js"],"names":["wavParserWorker","Worker","window","this","url","getWorkerURL","worker","espsParserWorker","textGridParserWorker","spectroDrawingWorker","ssffParserWorker","ArrayBuffer","prototype","subarray","offset","length","sub","subView","Int8Array","thisView","i","angular","module","config","$locationProvider","html5Mode","service","viewState","sServObj","vals","curDbConfig","embeddedVals","audioGetUrl","labelGetUrl","labelType","fromUrlParams","setVals","data","$","isEmptyObject","forEach","Object","keys","key1","isArray","itm","push","key2","undefined","console","error","getSsffTrackConfig","name","res","ssffTrackDefinitions","tr","getLimsOfTrack","trackName","perspectives","curPerspectiveIdx","signalCanvases","contourLims","cL","ssffTrackName","getContourColorsOfTrack","contourColors","cC","getAssignment","signalName","assign","a","signalCanvasName","getLevelDefinition","levelName","levelDefinitions","ld","setPerspectivesOrder","curPerspective","levelCanvases","order","getStrRep","code","str","String","fromCharCode","controller","$scope","$rootScope","$log","$compile","$timeout","$q","$window","$document","$location","HistoryService","Iohandlerservice","Soundhandlerservice","ConfigProviderService","fontScaleService","Ssffdataservice","LevelService","Textgridparserservice","Espsparserservice","Binarydatamaniphelper","Wavparserservice","Ssffparserservice","Drawhelperservice","Validationservice","Appcachehandler","loadedMetaDataService","dbObjLoadSaveService","appStateService","DataService","modalService","cps","hists","fontImage","levServ","dataServ","vs","ssffds","shs","dhs","wps","io","ach","lmds","connectBtnLabel","tmp","dbLoaded","is2dCancasesHidden","windowWidth","outerWidth","checkForNewVersion","element","bind","deleteEditArea","setWindowWidth","$digest","e","keyCode","keyMappings","shift","alt","addCurChangeObjToUndoStack","onbeforeunload","getBundleList","main","autoConnect","$on","resetToInitState","loadDefaultConfig","searchObject","search","loadFilesForEmbeddedApp","activeButtons","openDemoDB","httpGetPath","then","showDropZone","setCurBndlName","substr","lastIndexOf","getsubmenuOpen","togglesubmenuOpen","colors","transitionTime","somethingInProgressTxt","resp","EMUwebAppConfig","validRes","validateJSO","catchMouseForKeyBinding","somethingInProgress","parseWavArrBuf","messWavParser","wavJSO","curViewPort","sS","eS","Data","resetSelect","data2","parseLabelFile","parseMess","annot","setData","lNames","levelDefs","levels","l","type","attributeDefinitions","setCurLevelAttrDefs","setState","errMess","open","status","message","JSON","stringify","loadSchemas","replies","setSchemas","httpGetDefaultConfig","success","handleDefaultConfigLoaded","header","getCurBndlName","wsH","initConnect","serverUrl","handleConnectedToWSserver","setspectroSettings","spectrogramSettings","windowSizeInSecs","rangeFrom","rangeTo","dynamicRange","drawHeatMapColors","preEmphasisFilterFactor","heatMapColorAnchors","setTransitionTime","comMode","getProtocol","protocol","version","getDoUserManagement","doUsrData","innerHandleConnectedToWSserver","getDBconfigFile","bdata","setBundleList","loadBundle","toggleCollapseSession","ses","uniqSessionList","collapsed","getEnlarge","index","len","large","getenlarge","cursorInTextField","setcursorInTextField","cursorOutOfTextField","openSubmenu","addLevelSegBtnClick","getPermission","newName","level","items","id","getNewId","sampleStart","sampleDur","labels","value","labelCanvasConfig","newSegmentName","getCurAttrDef","leveldef","insertLevel","addObjToUndoStack","action","addLevelPointBtnClick","samplePoint","Math","round","newEventName","renameSelLevelBtnClick","getcurClickLevelName","downloadTextGridBtnClick","asyncToTextGrid","getCurBndl","downloadAnnotationBtnClick","toJson","getData","spectSettingsBtnClick","connectBtnClick","openDemoDBbtnClick","nameOfDB","setDemoDbName","err","aboutBtnClick","showHierarchyBtnClick","hierarchyShown","toggleHierarchy","showEditDBconfigBtnClick","currentConfig","currentVals","log","dbconfig","clearBtnClick","modalText","movesAwayFromLastSave","cmdZoomAll","setViewPort","cmdZoomIn","zoomViewPort","cmdZoomOut","cmdZoomLeft","shiftViewPort","cmdZoomRight","cmdZoomSel","selectS","selectE","cmdPlayView","playFromTo","animatePlayHead","cmdPlaySel","cmdPlayAll","changePerspective","persp","newIdx","setRightsubmenuOpen","getRightsubmenuOpen","getPerspectiveColor","cl","directive","$animate","templateUrl","restrict","scope","idx","link","attr","canvas","find","modal","levelCanvasContainer","levelDef","backgroundCanvas","background","levelColor","$watch","redraw","newValue","oldValue","drawLevelDetails","drawLevelMarkup","getcurMouseLevelName","changeCurAttrDef","attrDefName","curAttrDef","setCurAttrDef","hasClass","setEditing","addClass","removeClass","getAttrDefBtnColor","curColor","background-color","updateView","setcurMouseItem","fontSize","font","fontPxSize","ctx","getContext","clearRect","width","height","sDist","posS","posE","horizontalText","getSampleDist","scaleY","offsetHeight","getTextImageTwoLines","fontType","labelColor","drawImage","curID","getcurMouseItem","getcurClickItems","mTxtImgWidth","getTextImage","getLastImageWidth","zeroTxtImgWidth","endBoundaryColor","fillStyle","startBoundaryColor","curEvt","curLabVal","lab","getPos","fillRect","tW","tX","labelCenter","hlY","strokeStyle","beginPath","moveTo","lineTo","stroke","toString","horizontalSubText1","horizontalSubText2","hst2","perc","selectedLevelColor","drawMovingBoundaryLine","drawCurViewPortSelected","xOffset","segMId","isFirst","getcurMouseisFirst","isLast","getcurMouseisLast","clickedSegs","levelId","cs","selectedSegmentColor","selectedBoundaryColor","getcurMouseLevelType","replace","changeAttrDef","attrs","canvasLength","markupCanvas","drawVpOsciMarkup","drawPlayHead","allPeakVals","calculatePeaks","osciPeaks","freshRedrawDrawOsciOnCanvas","playHeadAnimationInfos","posCur","curS","selectedAreaColor","reset","drawViewPortTimes","currentBundleName","initialized","border","newVal","oldVal","drawPreview","ctxMarkup","selectedBorderColor","closePath","mathHelperService","canvas0","canvas1","context","markupCtx","alpha","devicePixelRatio","primeWorker","clearAndDrawSpectMarkup","setupEvent","drawSpectro","buffer","killSpectroRenderingThread","startSpectroRenderingThread","calcSamplesPerPxl","drawSpectMarkup","drawMinMaxAndName","spectroSettings","kill","imageData","createImageData","says","event","samplesPerPxl","Uint8ClampedArray","img","set","putImageData","parseData","fftN","calcClosestPowerOf2Gt","SampleRate","Float32Array","tell","upperFreq","lowerFreq","imgWidth","imgHeight","dynRangeInDB","pixelRatio","sampleRate","transparency","audioBuffer","audioBufferChannels","NumChannels","browserDetector","firefox","isBrowser","Firefox","getBlob","blob","Blob","dataExport","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","exportData","updateHistoryService","export","objURL","URL","webkitURL","createObjectURL","SaveToDisk","dataIn","close","fileURL","fileName","save","document","createElement","setAttribute","href","innerHTML","style","display","body","appendChild","click","target","download","createEvent","initEvent","dispatchEvent","revokeObjectURL","factory","myWindow","BARTLETT","BARTLETTHANN","BLACKMAN","COSINE","GAUSS","HAMMING","HANN","LANCZOS","RECTANGULAR","TRIANGULAR","curLevelAttrDefs","initialize","dragBarActive","dragBarHeight","endFreezeSample","timelineSize","historyActionTxt","editing","saving","hierarchyRotated","submenuOpen","rightSubmenuOpen","curClickItems","curMousePosSample","curMouseLevelName","curMouseLevelType","curClickLevelName","curClickLevelType","lastPcm","curPreselColumnSample","curCorrectionToolNr","curClickLevelIndex","start","TransitionTime","movingBoundary","movingBoundarySample","focusInTextField","curTaskPercCompl","mouseInEmuWebApp","lastKeyCode","states","noDBorFilesloaded","permittedActions","loadingSaving","labeling","modalShowing","prevState","curState","actionName","indexOf","b","nameOrObj","updatePlayHead","timestamp","player","isPlaying","requestAnimationFrame","samplesPassed","floor","$apply","startS","endS","select","end","getViewPort","rfrom","rto","dyn","win","hm","preEmph","hmColorAnchors","parseInt","setWindowFunction","getSelect","selectDependent","selectLevel","next","Levelserv","curLev","now","getLevelDetails","setcurClickLevel","idxOfNow","selectBoundary","getWindowFunctions","getdragBarActive","setdragBarActive","getdragBarHeight","setdragBarHeight","w","s","setsubmenuOpen","setenlarge","getTransitionTime","levelID","levelType","levelIndex","setcurClickLevelName","setcurClickLevelType","getcurClickLevelType","getcurClickLevelIndex","getcurClickNeighbours","curClickNeighbours","setcurMouseLevelName","setcurMouseLevelType","item","neighbour","x","curMouseItem","curMouseX","curMouseNeighbours","curMouseisFirst","curMouseisLast","getcurMouseNeighbours","selectItemsInSelection","levelData","min","Infinity","max","itemInSel","getItemsInSelection","setcurClickItemMultiple","itemsInRange","rangeStart","rangeEnd","t","setcurClickItem","left","right","entry","empty","front","back","sort","sortbyid","getselectedRange","getselected","isEditing","n","getLasPcm","setLastPcm","isHierarchyRotated","rotateHierarchy","getcursorInTextField","isSavingAllowed","setSavingAllowed","countSelected","getCurrentSample","getCurrentPercent","sample","getSamplesPerPixelVal","parseFloat","originalEvent","pow","k","substring","getViewPortStartTime","getViewPortEndTime","getSelectedStartTime","getSelectedEndTime","sSample","eSample","oldStart","oldEnd","abs","zoomIn","newStartS","newEndS","curMouseMoveItemStart","seg","d","isLastSeg","getItemDetails","getLastItem","d1","d2","shiftRight","curAttrDefName","newAttrDefName","ad","curAttrDefIndex","getCurAttrIndex","setlastKeyCode","getX","offsetX","layerX","clientWidth","getY","offsetY","layerY","clientHeight","getColorOfAnchor","val","anchorNr","curStyle","lastEventClick","lastEventMove","lastNeighboursMove","lastPCM","curMouseSampleNrInView","preventDefault","setLastMove","setLastClick","setLastRightClick","restrictions","editItemName","setLastDblClick","moveLine","samplesPerPixel","moveBy","zoomEventMove","getClosestItem","ceil","lastItem","getItemFromLevelById","nearest","mbutton","buttons","which","editItemSize","shiftKey","moveBoundary","updateCurChangeObj","movedBy","moveEvent","altKey","moveSegment","current","setlasteditArea","setlasteditAreaElem","parent","$index","openEditArea","doChange","getItemNeighboursFromLevel","LinkService","AnagestService","applyKeyCodeUp","applyKeyCode","esc","createNewItemAtSelection","domElement","getlasteditArea","curAttrIndex","lvlDefs","definitions","legalLabels","css","stopPropagation","editingElement","getlastID","attrIndex","renameLabel","force","showHierarhy","rotateHierarhy","zoomAll","zoomOut","zoomSel","shiftViewPortLeft","shiftViewPortRight","playEntireFile","playback","playAllInView","playSelected","selectFirstContourCorrectionTool","correctionTool","selectSecondContourCorrectionTool","selectThirdContourCorrectionTool","selectFourthContourCorrectionTool","selectNoContourCorrectionTool","levelUp","levelDown","snapBoundaryToNearestTopBoundary","mouseSeg","neighbor","minDist","snapBoundary","position","snapBoundaryToNearestBottomBoundary","snapBoundaryToNearestZeroCrossing","dist","calcDistanceToNearestZeroCrossing","levelname","expandSelSegmentsRight","changeTime","addTimeValue","addTimeMode","expandSegment","rightSide","expandSelSegmentsLeft","shrinkSelSegmentsLeft","shrinkSelSegmentsRight","toggleSideBarLeft","openMenu","toggleSideBarRight","selPrevItem","idLeft","idRight","selNextItem","selNextPrevItem","addItem","getlasteditAreaElem","insSeg","insertSegment","ret","ids","segName","anagestConfig","insPoint","insertEvent","alreadyExists","pointName","insertAnagestEvents","undo","redo","deletePreselBoundary","cseg","deleteItem","deletedSegment","deleteSegments","deletedLinks","deleteLinkSegment","segments","clickSeg","deleteItemBoundary","deleteBoundary","deleteLinkBoundary","neighbourId","deletedPoint","deleteEvent","metaKey","ctrlKey","safeApply","fn","phase","$root","$$phase","off","delete","elem","elemHeight","deleteButton","children","saveButton","deleteSingleLevel","hide","saveSingleLevel","show","enlarge","asyncParseJSO","result","isOpen","slideDuration","slideToggleDuration","stop","slideToggle","newIsOpenVal","oldIsOpenVal","startPCM","$http","Websockethandler","DragnDropDataService","prom","get","path","respType","responseType","getProm","alert","logOnUser","pwd","getBundle","session","saveBundle","bundleData","string","annotates","fileType","asyncParseEsps","asyncParseTextGrid","setPlayerSrc","buf","base64String","arrayBufferToBase64","src","resetPlayerSrcFromTo","endSample","bytePerSample","BitsPerSample","origArrBuf","dv","DataView","setUint32","newData","Uint8Array","byteLength","pause","play","addEventListener","atts","ssffTrackname","assTrackName","lastDraw","Date","$observe","handleUpdate","ass","col","getColumnOfTrack","columnName","sRaSt","getSampleRateAndStartTimeOfTrack","minMaxLims","drawValues","startTime","sR","sT","minVal","maxVal","_minVal","_maxVal","startTimeVP","endTimeVP","colStartSampleNr","colEndSampleNr","nrOfSamples","curSampleArrs","values","slice","y","curSampleInCol","curSampleInColTime","contourVal","contourNr","minContourIdx","maxContourIdx","contColors","selectedContourColor","leftBorder","leftVal","curArr","curArrIdx","arc","PI","rightBorder","rightVal","txt","crossHairsColor","defer","resolve","reject","asyncParseSsffArr","ssffArray","cmd","ssffArr","promise","asyncJso2ssff","jso","curMouseSample","dragStartSample","dragEndSample","bundleName","switchMarkupContext","mouseX","curMouseTime","curMouseSampleTime","fill","copy","updateObj","sampleBlockIdx","sampleIdx","key","setSelectDrag","leave","drawCrossHairs","getScale","scale","measureText","getScaleWidth","str1","str2","scaleX","drawFrame","prevPeak","h","prevH","prevX","prevY","osciColor","relData","samplePerPx","numberOfChannels","peaks","minPeak","maxPeak","apply","Array","call","curPxIdx","avrVal","c","sum","p","peak","hDbS","sNr","drawSampleNrs","strokeText","fillText","drawZeroLine","zeroLineColor","navigator","vendor","setLineDash","zeroLineY","drawTimeAndSamples","space","offsetWidth","mouseEvt","unit","trackname","mouseY","mouseFreq","s1","s2","verticalText","smallFontSize","th","trackNameImg","labelTxtImg","sTime","eTime","applyChange","changeObj","applyOldVal","cur","renameLevel","newname","deleteLevel","deleteBoundaryInvers","deleteSegmentsInvers","insertLinksTo","deleteLinksTo","deleteLinkBoundaryInvers","deleteLinkSegmentInvers","insertSegmentInvers","parentID","childIDs","undoStack","redoStack","curChangeObj","dataObj","dataKey","info","obj","tmpObj","oldChangeObj","pop","getNrOfPossibleUndos","getCurrentStack","buffLength","textGrid","rand","random","new","newHash","isMobile","Android","userAgent","match","BlackBerry","iOS","Opera","Windows","any","Chrome","InternetExplorer","PhantomJS","isMobileDevice","isDesktopDevice","lastTextWidth","spaceTop","ctxOriginal","text","color","restore","text2","alignLeft","esps","loginData","username","password","errorMsg","tryLogin","confirm","cancel","getFile","std","f","fileExtension","file","Columns","calculateSamplePosInVP","colSampleNr","sampleTime","audioSample","maxItemID","setLevelData","getLevelData","getLevelDataAt","insertLevelDataAt","newLevel","splice","deleteLevelDataAt","getLinkData","links","setLinkData","insertLinkData","newLink","deleteLinkDataAt","insertLinkDataAt","changeLinkDataAt","fromNewID","toNewID","fromID","toID","raiseId","amount","lowerId","getLabelIdx","labelIdx","lasteditArea","lasteditAreaElem","curLevel","num","getLevelsByType","types","getOrderById","eid","getIdByOrder","details","getNextItem","foundItm","getItemsFromLevelByIdAndLength","foundItms","lastID","j","segment","remove","clientOffset","offsetLeft","top","offsetTop","editText","zoom","createEditAreaElement","createSelection","field","createTextRange","selRange","collapse","moveStart","moveEnd","setSelectionRange","selectionStart","selectionEnd","focus","label","labelid","textid","prepend","class","ng-model","autofocus","padding-top","overflow-x","overflow-y","insertItemDetails","labelname","duration","newElement","attrdefs","updateSegItemInLevel","setPointDetails","firstid","lastid","sampleNr","maximum","spaceLower","spaceHigher","evt","lvl","originalLevel","newLabelName","oldname","insertPoint","lastNeighbours","timeRight","timeLeft","firstSegment","firstOrder","lastSegment","neighbours","deleteOrder","diff2","startOrder","diff","newLabel","startID","newStart","endID","pos","last","toDelete","retOrder","retEvt","oldName","toTop","neighTd","absDist","sampleTarget","absMinDist","thisTd","tIdx","orig","ln","origRight","origLeft","isLinked","orderPoints","first","tempItem","allow","lastLength","distRight","distLeft","getAllLabelsOfLevel","levelDetails","getLevelName","nodeID","insertLink","insertLinkAt","deleteLink","linkIdx","linkExists","hasParents","ID","hasChildren","toIDs","insertLinksFrom","fromIDs","deleteLinksFrom","getLinksTo","linkOrder","getLinksFrom","changeLinkTo","changeLinkFrom","linksTo","linksFrom","found","deleted","neighbourID","ord","uuid","wsonopen","connected","conPromise","wsonmessage","listener","fromJson","wsonerror","wsonclose","wasClean","$broadcast","sendRequest","request","callbackId","getCallbackId","callbacks","time","cb","callbackID","ws","send","tOutResp","serverTimeoutInterval","messageObj","hasOwnProperty","closeConnect","newUUID","WebSocket","onopen","onmessage","onerror","onclose","isConnected","userName","disconnectWarning","getDoEditDBConfig","editDBConfig","subtype","base64ToArrayBuffer","stringBase64","binaryString","atob","bytes","ascii","charCodeAt","binary","btoa","appCache","applicationCache","handleUpdatereadyEvent","swapCache","location","reload","update","options","selWindowInfo","errorID","upperBoundary","modalVals","_fftN","_windowSizeInSamples","calcWindowSizeInSamples","calcFftN","calcWindowSizeVals","cssError","id2","htmlError","saveSpectroSettings","checkSpectroSettings","isNaN","filter","input","regex","patt","RegExp","toLowerCase","out","test","patt1","patt2","ArrayHelperService","saveChanges","discardChanges","showMenu","showTwod","animation","transclude","showTwoDimCans","template","panes","bottomRightResizePane","addPane","pane","setBottomRightResizePane","dragBottomRightResizePaneTopResizer","dragBottomRightResizePaneLeftResizer","dragBottomRightResizePaneCornerResizer","handler","pane1","pane2","pane3","bottomRightResizePaneTopResizer","bottomRightResizePaneLeftResizer","bottomRightResizePaneCornerResizer","pane1Min","minSize","pane2Min","dragSplitPaneResizer","drag","after","ev","bounds","getBoundingClientRect","bottom","clientY","clientX","require","bgSplitterCtrl","typeclass","drawSsffTrackMarkup","el","dragIcon","generateURL","getURL","isActive","classList","add","dataTransfer","setDragImage","effectAllowed","removeAttribute","HierarchyLayoutService","vertical","playing","selectedItem","debug","selectVisibleNodes","render","centerNode","node","_x","_y","svg","transition","getOrientatedTransform","zoomListener","translate","transform","getOrientatedNodeTransform","getNodeText","getOrientatedTextAnchor","getOrientatedTextX","getOrientatedTextY","getPath","_fromX","_fromY","_toY","_toX","nodeOnClick","isCollapsing","_collapsed","currentDescendant","descendants","findChildren","concat","_collapsedParents","_collapsePosition","nodeOnRightClick","nodeOnMouseOver","timeInfoLevel","currentItem","timeInfoType","firstTimeItem","lastTimeItem","itemList","startSample","rootLevelItems","_visible","d3","behavior","scaleExtent","on","nodes","calculateWeightsBottomUp","levelItems","ii","allLinks","parentElement","depthToX","depth","size","posInLevelToY","posInLevel","_depth","_posInLevel","_fromDepth","_fromPosInLevel","_toDepth","_toPosInLevel","dataSet","selectAll","newNodes","enter","oldNodes","exit","getOrientatedTextTransform","classed","linkSet","newLinks","oldLinks","insert","resizeHierarchy","drawEpgGrid","binValStrArr","gridWidth","gridHeight","sInterv","curFrame","elIdx","split","reverse","binStr","binStrIdx","globalMinX","globalMaxX","globalMinY","globalMaxY","drawDots","setGlobalMinMaxVals","dD","twoDimCanvases","twoDimDrawingDefinitions","dots","trConf","xSsffTrack","xCol","ySsffTrack","yCol","staticDots","sD","xCoordinates","xVal","xIdx","yCoordinates","tw","xsRaSt","ysRaSt","curMousePosTime","degrees","rotate","allDots","xContourNr","yContourNr","startPoint","endPoint","connectLines","fromDot","toDot","labelX","xNameCoordinate","labelY","yNameCoordinate","connect","DragnDropService","dropTextDefault","dropTextErrorFileType","dropTextErrorAPI","dropAllowed","dropParsingWaiting","dropParsingWaitingAnnot","dropFirefoxWarning","dropText","dropClass","dropClassDefault","dropClassOver","dropClassError","count","handles","bundles","bundleNames","updateQueueLength","quantity","enqueueFileAddition","identifier","toUpperCase","extension","bundle","startRendering","maxDroppedBundles","loadFiles","files","reader","isFile","isDirectory","getAsEntry","webkitGetAsEntry","getAsFile","File","warn","createReader","readEntries","entries","dropFiles","FileReader","FileList","dragEnterLeave","handleDragOver","acceptGrid","acceptWav","acceptBoth","acceptFile","handleFilesonChange","loadedFiles","fileDialog","$parent","schemasJsos","names","uri","proms","all","schemaArr","tv4","addSchema","getSchema","schemaName","schema","validate","paths","possible","possibleAsStr","selected","findPaths","arr","arrIdx","join","getSelIdx","selIdx","getRotation","playSelection","getPlaying","isCurrentAttrDef","attrDef","setCurrentAttrDef","getAllAttrDefs","levDef","traverse","o","parentsFound","findParentLevels","childLevel","parents","linkDefinitions","sublevelName","superlevelName","findParents","selectedPath","_parents","_weight","itemWeight","startLevel","currentLevel","li","it","convertToAbsValues","multiplyEachElement","interp2points","x0","y0","x1","y1","findMinMax","minOrMax","flattenArrayOfArray","arrOfArrs","merged","convertArrayToXYjsoArray","xyArray","verticalPosSsffTrackName","vTrackName","velocitySsffTrackName","vTr","vCol","flatColVals","flatVcolVals","gdat","NaN","vdat","ndat","cdat","startTimeSel","endTimeSel","selCol","selVCol","maxVerticalPos","maxVelBeforeMaxConstr","minVelBeforeMaxVel","interactiveFindThresholds","threshold","on20","minVelBetwMaxVel1maxConstr","minp","off20","maxVelAfterMaxConstr","minBetwMaxConstrMaxVelConstr","minVelAfterMaxVelAfterConstr","curLabel","gestureOnOffsetLabels","gdat0insPoint","gdat1insPoint","maxVelocityOnOffsetLabels","vdat0insPoint","vdat1insPoint","constrictionPlateauBeginEndLabels","ndat0insPoint","ndat1insPoint","maxConstrictionLabel","cdat0insPoint","linkLevelName","autoLinkLevelName","linkLevelDetails","linkLevelLabels","itemIdx","direction","description","thdat","thdir","xx","lx","xsh","loguk","higuk","vz","anavv","infos","thresholdIdx","thresholdValue","ap","convertedBundles","sessionDefault","setDefaultSession","getDefaultSession","drandropBundles","bundleList","sessionName","setDragnDropData","convertDragnDropData","handleLocalFiles","wav","annotation","getDragnDropData","generateDrop","reader2","readAsArrayBuffer","onloadend","readyState","DONE","currentTarget","mediaFile","ssffFiles","readAsText","ab","curClickSegments","setCurBndl","margin","linear","range","xAxis","axis","tickSize","tickSubdivide","yAxis","orient","lineFunc","line","interpolate","domain","x2","y2","counter","cssDone","cssNotDone","cssActive","font-size","que","getClass","genUniqSessionList","bndlList","fistSes","sList","bndl","genRendOptBndlList","rendOptBndlList","curBndl","demoDbName","bList","getRendOptBndlList","getDemoDbName","getSessionCollapseState","dolss","filterText","pageSize","currentPage","numberOfPages","sessionLength","uttIsDisabled","getBndlColor","isSessionDefined","messModal","arrBuff","ssffJso","formants","messParser","encoding","getAnnotationAndSaveBndl","finishedEditing","comment","getWorkerScript","js","workerInit","global","ab2str","unis","wav2jso","curBinIdx","curBuffer","curBufferView","wavRep","ChunkID","Uint32Array","ChunkSize","Format","Subchunk1ID","Subchunk1Size","Uint16Array","AudioFormat","ByteRate","BlockAlign","Subchunk2ID","Subchunk2Size","Int16Array","parserRes","postMessage","urlObj","terminate","msg","toJSO","labelJSO","headEndIdx","lines","prevLineArr","idCounter","curLineArr","toESPS","espsStr","retVal","l1","l2","localID","testForGapsInLabelJSO","findTimeOfMinSample","findTimeOfMaxSample","myFile","myName","VU_STR","$0","$1","re","tT","tN","eT","inHeader","labs","eSt","eEt","toTextGrid","tG","nl","levelNr","curVal","evtNr","executed","TWO_PI","totalMax","N","wFunction","myFFT","pixelHeight","internalalpha","maxPsd","HzStep","paint","sin","cos","ceilingFreqFftIdx","floorFreqFftIdx","resultImgArr","toLinearLevel","dbLevel","log10","arg","magnitude","real","imag","sqrt","FFT","m","applyWindowFuncAndPreemph","applyPreEmph","wFunctionBartlett","wFunctionBartlettHann","wFunctionBlackman","wFunctionCosine","wFunctionGauss","wFunctionHamming","wFunctionHann","wFunctionLanczos","wFunctionRectangular","wFunctionTriangular","a0","a1","a2","E","curSample","prevSample","fft","n1","n2","t1","t2","convertToHeatmap","minval","maxval","maxIndex","v","i1","i2","rgb1","rgb2","r","g","drawVerticalLineOfSpectogram","rgb","px","py","psd","psdLog","scaledVal","hmVals","calcMagnitudeSpectrum","windowSizeInSamples","low","renderSpectrogram","renderError","ssffData","headID","machineID","sepString","origFreq","base64encode","c1","c2","c3","base64EncodeChars","charAt","base64decode","c4","base64DecodeChars","stringToUint","charList","uintArray","Uint8Concat","second","firstLength","ssff2jso","uIntBuffView","buffStr","newLsep","lSpl","ssffdatatype","curLen","curMin","curMax","Float64Array","jso2ssff","headerStr","bytePerTime","failed","byteSizeOfDataBuffer","dataBuff","dataBuffView","ssffBufView","byteOffSet","curArray","curArrayIDX","curCol","setInt16","parseArr","noError","resArr","parse","curExp","getTemplateUrl","deferChange","dataOut","param1","param2","chartData","changeModal","closeAndResolve","confirmContent","valid","levelDefinitionProperties","linkDefinitionProperties","spectroDefinitionProperties","signalSelect","levelSelect","twoDimSelect","addSignalSelect","addLevelSelect","addTwoDimSelect","response","tabs","title","currentTab","setup","dbconfigFileSchema","webappFileSchema","properties","resetSelections","onClickTab","tab","td","isActiveTab","tabUrl","classDefinition","typeOfDefinition","added","saveDefinition","addDefinition","keyAttribute","deleteDefinition","subKeyAttribute"],"mappings":"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","sourcesContent":["'use strict';\n//expand ArrayBuffer with subarray function\nArrayBuffer.prototype.subarray = function (offset, length) {\n  var sub = new ArrayBuffer(length);\n  var subView = new Int8Array(sub);\n  var thisView = new Int8Array(this);\n  for (var i = 0; i < length; i++) {\n    subView[i] = thisView[offset + i];\n  }\n  return sub;\n};\n'use strict';\nangular.module('emuwebApp', [\n  'ui',\n  'ui.sortable',\n  'ngAnimate',\n  'angular.filter'\n]).config([\n  '$locationProvider',\n  function ($locationProvider) {\n    $locationProvider.html5Mode(true);\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ConfigProviderService', [\n  'viewState',\n  function (viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.vals = {};\n    sServObj.curDbConfig = {};\n    // embedded values -> if these are set this overrides the normal config  \n    sServObj.embeddedVals = {\n      audioGetUrl: '',\n      labelGetUrl: '',\n      labelType: '',\n      fromUrlParams: false\n    };\n    /**\n\t\t * depth of 2 = max\n\t\t */\n    sServObj.setVals = function (data) {\n      if ($.isEmptyObject(sServObj.vals)) {\n        sServObj.vals = data;\n      } else {\n        angular.forEach(Object.keys(data), function (key1) {\n          // if array... overwrite entire thing!\n          if (angular.isArray(sServObj.vals[key1])) {\n            //empty array\n            sServObj.vals[key1] = [];\n            angular.forEach(data[key1], function (itm) {\n              sServObj.vals[key1].push(itm);\n            });\n          } else {\n            angular.forEach(Object.keys(data[key1]), function (key2) {\n              if (sServObj.vals[key1][key2] !== undefined) {\n                sServObj.vals[key1][key2] = data[key1][key2];\n              } else {\n                console.error('BAD ENTRY IN CONFIG! Key1: ' + key1 + ' key2: ' + key2);\n              }\n            });\n          }\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSsffTrackConfig = function (name) {\n      var res;\n      if (sServObj.curDbConfig.ssffTrackDefinitions !== undefined) {\n        angular.forEach(sServObj.curDbConfig.ssffTrackDefinitions, function (tr) {\n          if (tr.name === name) {\n            res = tr;\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLimsOfTrack = function (trackName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourLims, function (cL) {\n        if (cL.ssffTrackName === trackName) {\n          res = cL;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getContourColorsOfTrack = function (trackName) {\n      var res;\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors, function (cC) {\n        if (cC.ssffTrackName === trackName) {\n          res = cC;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAssignment = function (signalName) {\n      var res = {};\n      angular.forEach(sServObj.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign, function (a) {\n        if (a.signalCanvasName === signalName) {\n          res = a;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getLevelDefinition = function (levelName) {\n      var res = {};\n      angular.forEach(sServObj.curDbConfig.levelDefinitions, function (ld) {\n        if (ld.name === levelName) {\n          res = ld;\n        }\n      });\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setPerspectivesOrder = function (curPerspective, levelName) {\n      if (sServObj.vals !== undefined) {\n        if (sServObj.vals.perspectives !== undefined) {\n          if (sServObj.vals.perspectives[curPerspective] !== undefined) {\n            if (sServObj.vals.perspectives[curPerspective].levelCanvases !== undefined) {\n              sServObj.vals.perspectives[curPerspective].levelCanvases.order = levelName;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t *  replace ascii codes from config with strings\n\t\t */\n    sServObj.getStrRep = function (code) {\n      var str;\n      switch (code) {\n      case 8:\n        str = 'BACKSPACE';\n        break;\n      case 9:\n        str = 'TAB';\n        break;\n      case 13:\n        str = 'ENTER';\n        break;\n      case 16:\n        str = 'SHIFT';\n        break;\n      case 18:\n        str = 'ALT';\n        break;\n      case 32:\n        str = 'SPACE';\n        break;\n      case 37:\n        str = '\\u2190';\n        break;\n      case 39:\n        str = '\\u2192';\n        break;\n      case 38:\n        str = '\\u2191';\n        break;\n      case 40:\n        str = '\\u2193';\n        break;\n      case 42:\n        str = '+';\n        break;\n      case 43:\n        str = '+';\n        break;\n      case 45:\n        str = '-';\n        break;\n      case 95:\n        str = '-';\n        break;\n      default:\n        str = String.fromCharCode(code);\n      }\n      return str;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('MainController', [\n  '$scope',\n  '$rootScope',\n  '$log',\n  '$compile',\n  '$timeout',\n  '$q',\n  '$window',\n  '$document',\n  '$location',\n  'viewState',\n  'HistoryService',\n  'Iohandlerservice',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'fontScaleService',\n  'Ssffdataservice',\n  'LevelService',\n  'Textgridparserservice',\n  'Espsparserservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Ssffparserservice',\n  'Drawhelperservice',\n  'Validationservice',\n  'Appcachehandler',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'appStateService',\n  'DataService',\n  'modalService',\n  function ($scope, $rootScope, $log, $compile, $timeout, $q, $window, $document, $location, viewState, HistoryService, Iohandlerservice, Soundhandlerservice, ConfigProviderService, fontScaleService, Ssffdataservice, LevelService, Textgridparserservice, Espsparserservice, Binarydatamaniphelper, Wavparserservice, Ssffparserservice, Drawhelperservice, Validationservice, Appcachehandler, loadedMetaDataService, dbObjLoadSaveService, appStateService, DataService, modalService) {\n    // hook up services to use abbreviated forms\n    $scope.cps = ConfigProviderService;\n    $scope.hists = HistoryService;\n    $scope.fontImage = fontScaleService;\n    $scope.levServ = LevelService;\n    $scope.dataServ = DataService;\n    $scope.vs = viewState;\n    $scope.ssffds = Ssffdataservice;\n    $scope.shs = Soundhandlerservice;\n    $scope.dhs = Drawhelperservice;\n    $scope.wps = Wavparserservice;\n    $scope.io = Iohandlerservice;\n    $scope.ach = Appcachehandler;\n    $scope.lmds = loadedMetaDataService;\n    // init vars\n    $scope.connectBtnLabel = 'connect';\n    $scope.tmp = {};\n    $scope.dbLoaded = false;\n    $scope.is2dCancasesHidden = true;\n    $scope.windowWidth = $window.outerWidth;\n    // check for new version\n    $scope.ach.checkForNewVersion();\n    //////////////\n    // bindings\n    // bind window resize event\n    angular.element($window).bind('resize', function () {\n      LevelService.deleteEditArea();\n      viewState.setWindowWidth($window.outerWidth);\n      $scope.$digest();\n    });\n    // bind shift/alt keyups for history\n    angular.element($window).bind('keyup', function (e) {\n      if (e.keyCode === ConfigProviderService.vals.keyMappings.shift || e.keyCode === ConfigProviderService.vals.keyMappings.alt) {\n        HistoryService.addCurChangeObjToUndoStack();\n        $scope.$digest();\n      }\n    });\n    // Take care of preventing navigation out of app (only if something is loaded, not in embedded mode and not developing (auto connecting))\n    window.onbeforeunload = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl === '' && loadedMetaDataService.getBundleList().length > 0 && !ConfigProviderService.vals.main.autoConnect) {\n        return 'Do you really wish to leave/reload the EMU-webApp? All unsaved changes will be lost...';\n      }\n    };\n    //////////////\n    // watches\n    // watch if embedded override (if attributes are set on emuwebapp tag)\n    // $scope.$watch('cps.embeddedVals.audioGetUrl', function (val) {\n    // \tif (val !== undefined && val !== '') {\n    // \t\t// check if both are set\n    // \t\t$scope.loadFilesForEmbeddedApp();\n    // \t}\n    // }, true);\n    //\n    //////////////\n    /////////////\n    // listens\n    // listen for connectionDisrupted event -> I don't like listens but in this case it might me the way to go...\n    $scope.$on('connectionDisrupted', function (event, args) {\n      appStateService.resetToInitState();\n    });\n    // listen for resetToInitState\n    $scope.$on('resetToInitState', function () {\n      $scope.loadDefaultConfig();\n    });\n    //\n    ////////////\n    // check if URL parameters are set -> if so set embedded flags!\n    var searchObject = $location.search();\n    if (searchObject['audioGetUrl'] && searchObject['labelGetUrl'] && searchObject['labelType']) {\n      ConfigProviderService.embeddedVals.audioGetUrl = searchObject.audioGetUrl;\n      ConfigProviderService.embeddedVals.labelGetUrl = searchObject.labelGetUrl;\n      ConfigProviderService.embeddedVals.labelType = searchObject.labelType;\n      ConfigProviderService.embeddedVals.fromUrlParams = true;\n    }\n    ;\n    /**\n\t\t *\n\t\t */\n    $scope.loadFilesForEmbeddedApp = function () {\n      if (ConfigProviderService.embeddedVals.audioGetUrl) {\n        ConfigProviderService.vals.activeButtons.openDemoDB = false;\n        Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.audioGetUrl, 'arraybuffer').then(function (data) {\n          viewState.showDropZone = false;\n          // set bundle name\n          var tmp = ConfigProviderService.embeddedVals.audioGetUrl;\n          loadedMetaDataService.setCurBndlName(tmp.substr(0, tmp.lastIndexOf('.')).substr(tmp.lastIndexOf('/') + 1, tmp.length));\n          //hide menu\n          if (viewState.getsubmenuOpen()) {\n            viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n          }\n          viewState.somethingInProgressTxt = 'Loading DB config...';\n          // then get the DBconfigFile\n          Iohandlerservice.httpGetPath('configFiles/embedded_emuwebappConfig.json').then(function (resp) {\n            // first element of perspectives is default perspective\n            viewState.curPerspectiveIdx = 0;\n            ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n            // validate emuwebappConfigSchema\n            delete resp.data.EMUwebAppConfig;\n            // delete to avoid duplicate\n            var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n            if (validRes === true) {\n              // turn of keybinding only on mouseover\n              if (ConfigProviderService.embeddedVals.fromUrlParams) {\n                ConfigProviderService.vals.main.catchMouseForKeyBinding = false;\n              }\n              ConfigProviderService.curDbConfig = resp.data;\n              // validate DBconfigFileSchema!\n              validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n              if (validRes === true) {\n                // set wav file\n                viewState.somethingInProgress = true;\n                viewState.somethingInProgressTxt = 'Parsing WAV file...';\n                Wavparserservice.parseWavArrBuf(data.data).then(function (messWavParser) {\n                  var wavJSO = messWavParser;\n                  viewState.curViewPort.sS = 0;\n                  viewState.curViewPort.eS = wavJSO.Data.length;\n                  viewState.resetSelect();\n                  Soundhandlerservice.wavJSO = wavJSO;\n                  // get + parse file\n                  Iohandlerservice.httpGetPath(ConfigProviderService.embeddedVals.labelGetUrl, 'utf-8').then(function (data2) {\n                    viewState.somethingInProgressTxt = 'Parsing ' + ConfigProviderService.embeddedVals.labelType + ' file...';\n                    Iohandlerservice.parseLabelFile(data2.data, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTextGrid', ConfigProviderService.embeddedVals.labelType).then(function (parseMess) {\n                      var annot = parseMess;\n                      DataService.setData(annot);\n                      var lNames = [];\n                      var levelDefs = [];\n                      annot.levels.forEach(function (l) {\n                        lNames.push(l.name);\n                        levelDefs.push({\n                          'name': l.name,\n                          'type': l.type,\n                          'attributeDefinitions': {\n                            'name': l.name,\n                            'type': 'string'\n                          }\n                        });\n                      });\n                      // set level defs\n                      ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n                      viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n                      ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\n                      viewState.somethingInProgressTxt = 'Done!';\n                      viewState.somethingInProgress = false;\n                      viewState.setState('labeling');\n                    }, function (errMess) {\n                      modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message);\n                    });\n                  }, function (errMess) {\n                    modalService.open('views/error.html', 'Could not get label file: ' + ConfigProviderService.embeddedVals.labelGetUrl + ' ERROR ' + JSON.stringify(errMess, null, 4));\n                  });\n                }, function (errMess) {\n                  modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message);\n                });\n              } else {\n                modalService.open('views/error.html', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4));\n              }\n            } else {\n              modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4));\n            }\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Could not get embedded_config.json: ' + errMess);\n          });\n        }, function (errMess) {\n          modalService.open('views/error.html', 'Could not get audio file:' + ConfigProviderService.embeddedVals.audioGetUrl + ' ERROR: ' + JSON.stringify(errMess, null, 4));\n        });\n      }\n    };\n    /**\n\t\t * init load of config files\n\t\t */\n    $scope.loadDefaultConfig = function () {\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading schema files';\n      // load schemas first\n      Validationservice.loadSchemas().then(function (replies) {\n        Validationservice.setSchemas(replies);\n        Iohandlerservice.httpGetDefaultConfig().success(function (data) {\n          viewState.somethingInProgressTxt = 'Validating emuwebappConfig';\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', data);\n          if (validRes === true) {\n            ConfigProviderService.setVals(data);\n            $scope.handleDefaultConfigLoaded();\n            // loadFilesForEmbeddedApp if these are set \n            $scope.loadFilesForEmbeddedApp();\n            viewState.somethingInProgress = false;\n          } else {\n            modalService.open('views/error.html', 'Error validating emuwebappConfigSchema: ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        }).error(function (data, status, header, config) {\n          modalService.open('views/error.html', 'Could not get defaultConfig for EMU-webApp: ' + ' status: ' + status + ' header: ' + header + ' config ' + config).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }, function (errMess) {\n        modalService.open('views/error.html', 'Error loading schema file: ' + JSON.stringify(errMess, null, 4)).then(function () {\n          appStateService.resetToInitState();\n        });\n      });\n    };\n    // call function on init\n    $scope.loadDefaultConfig();\n    $scope.getCurBndlName = function () {\n      return loadedMetaDataService.getCurBndlName();\n    };\n    /**\n\t\t * function called after default config was loaded\n\t\t */\n    $scope.handleDefaultConfigLoaded = function () {\n      if (!viewState.getsubmenuOpen()) {\n        viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n      }\n      if (ConfigProviderService.vals.main.autoConnect) {\n        Iohandlerservice.wsH.initConnect(ConfigProviderService.vals.main.serverUrl).then(function (message) {\n          if (message.type === 'error') {\n            modalService.open('views/error.html', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl);\n          } else {\n            $scope.handleConnectedToWSserver();\n          }\n        });\n      }\n      // init loading of files for testing\n      viewState.setspectroSettings(ConfigProviderService.vals.spectrogramSettings.windowSizeInSecs, ConfigProviderService.vals.spectrogramSettings.rangeFrom, ConfigProviderService.vals.spectrogramSettings.rangeTo, ConfigProviderService.vals.spectrogramSettings.dynamicRange, ConfigProviderService.vals.spectrogramSettings.window, ConfigProviderService.vals.spectrogramSettings.drawHeatMapColors, ConfigProviderService.vals.spectrogramSettings.preEmphasisFilterFactor, ConfigProviderService.vals.spectrogramSettings.heatMapColorAnchors);\n      // setting transition values\n      viewState.setTransitionTime(ConfigProviderService.vals.colors.transitionTime / 1000);\n    };\n    /**\n\t\t * function is called after websocket connection\n\t\t * has been established. It executes the protocol\n\t\t * and loads the first bundle in the bundle list (= default behavior).\n\t\t */\n    $scope.handleConnectedToWSserver = function () {\n      // hide drop zone \n      viewState.showDropZone = false;\n      ConfigProviderService.vals.main.comMode = 'WS';\n      ConfigProviderService.vals.activeButtons.openDemoDB = false;\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Checking protocol...';\n      // Check if server speaks the same protocol\n      Iohandlerservice.getProtocol().then(function (res) {\n        if (res.protocol === 'EMU-webApp-websocket-protocol' && res.version === '0.0.2') {\n          viewState.somethingInProgressTxt = 'Checking user management...';\n          // then ask if server does user management\n          Iohandlerservice.getDoUserManagement().then(function (doUsrData) {\n            if (doUsrData === 'NO') {\n              $scope.innerHandleConnectedToWSserver();\n            } else {\n              // show user management error \n              modalService.open('views/loginModal.html').then(function (res) {\n                if (res) {\n                  $scope.innerHandleConnectedToWSserver();\n                } else {\n                  appStateService.resetToInitState();\n                }\n              });\n            }\n          });\n        } else {\n          // show protocol error and disconnect from server\n          modalService.open('views/error.html', 'Could not connect to websocket server: ' + ConfigProviderService.vals.main.serverUrl + '. It does not speak the same protocol as this client. Its protocol answer was: \"' + res.protocol + '\" with the version: \"' + res.version + '\"').then(function () {\n            appStateService.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t * to avoid redundant code...\n\t\t */\n    $scope.innerHandleConnectedToWSserver = function () {\n      viewState.somethingInProgressTxt = 'Loading DB config...';\n      // then get the DBconfigFile\n      Iohandlerservice.getDBconfigFile().then(function (data) {\n        // first element of perspectives is default perspective\n        viewState.curPerspectiveIdx = 0;\n        ConfigProviderService.setVals(data.EMUwebAppConfig);\n        // FOR DEVELOPMENT\n        //$scope.showEditDBconfigBtnClick();\n        delete data.EMUwebAppConfig;\n        // delete to avoid duplicate\n        var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n        if (validRes === true) {\n          ConfigProviderService.curDbConfig = data;\n          viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n          validRes = Validationservice.validateJSO('DBconfigFileSchema', data);\n          if (validRes === true) {\n            // then get the DBconfigFile\n            viewState.somethingInProgressTxt = 'Loading bundle list...';\n            Iohandlerservice.getBundleList().then(function (bdata) {\n              validRes = loadedMetaDataService.setBundleList(bdata);\n              if (validRes === true) {\n                // then load first bundle in list\n                dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);\n              } else {\n                modalService.open('views/error.html', 'Error validating bundleList: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                  appStateService.resetToInitState();\n                });\n              }\n            });\n          } else {\n            modalService.open('views/error.html', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        } else {\n          modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n            appStateService.resetToInitState();\n          });\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.toggleCollapseSession = function (ses) {\n      $scope.uniqSessionList[ses].collapsed = !$scope.uniqSessionList[ses].collapsed;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getEnlarge = function (index) {\n      var len = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length;\n      var large = 50;\n      if (viewState.getenlarge() == -1) {\n        return 'auto';\n      } else {\n        if (len === 1) {\n          return 'auto';\n        }\n        if (len === 2) {\n          if (viewState.getenlarge() == index) {\n            return '70%';\n          } else {\n            return '27%';\n          }\n        } else {\n          if (viewState.getenlarge() == index) {\n            return large + '%';\n          } else {\n            return (95 - large) / (len - 1) + '%';\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openSubmenu = function () {\n      viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n    };\n    /////////////////////////////////////////\n    // handle button clicks\n    // top menu:\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelSegBtnClick = function () {\n      if (viewState.getPermission('addLevelSegBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [{\n                id: DataService.getNewId(),\n                sampleStart: 0,\n                sampleDur: Soundhandlerservice.wavJSO.Data.length,\n                labels: [{\n                    name: newName,\n                    value: ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                  }]\n              }],\n            name: newName,\n            type: 'SEGMENT'\n          };\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.addLevelPointBtnClick = function () {\n      if (viewState.getPermission('addLevelPointBtnClick')) {\n        var length = 0;\n        if (DataService.data.levels !== undefined) {\n          length = DataService.data.levels.length;\n        }\n        var newName = 'levelNr' + length;\n        var level = {\n            items: [{\n                id: DataService.getNewId(),\n                samplePoint: Math.round(Soundhandlerservice.wavJSO.Data.length / 2),\n                labels: []\n              }],\n            name: newName,\n            type: 'EVENT'\n          };\n        level.items[0].labels.push({\n          name: newName,\n          value: ConfigProviderService.vals.labelCanvasConfig.newEventName\n        });\n        if (viewState.getCurAttrDef(newName) === undefined) {\n          var leveldef = {\n              name: newName,\n              type: 'EVENT',\n              attributeDefinitions: {\n                name: newName,\n                type: 'string'\n              }\n            };\n          viewState.setCurLevelAttrDefs(leveldef);\n        }\n        LevelService.insertLevel(level, length, viewState.curPerspectiveIdx);\n        //  Add to history\n        HistoryService.addObjToUndoStack({\n          'type': 'ANNOT',\n          'action': 'INSERTLEVEL',\n          'level': level,\n          'id': length,\n          'curPerspectiveIdx': viewState.curPerspectiveIdx\n        });\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.renameSelLevelBtnClick = function () {\n      if (viewState.getPermission('renameSelLevelBtnClick')) {\n        if (viewState.getcurClickLevelName() !== undefined) {\n          modalService.open('views/renameLevel.html', viewState.getcurClickLevelName());\n        } else {\n          modalService.open('views/error.html', 'Rename Error : Please choose a Level first !');\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadTextGridBtnClick = function () {\n      if (viewState.getPermission('downloadTextGridBtnClick')) {\n        Textgridparserservice.asyncToTextGrid().then(function (parseMess) {\n          modalService.open('views/export.html', loadedMetaDataService.getCurBndl().name + '.TextGrid', parseMess);\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.downloadAnnotationBtnClick = function () {\n      if (viewState.getPermission('downloadAnnotationBtnClick')) {\n        modalService.open('views/export.html', loadedMetaDataService.getCurBndl().name + '_annot.json', angular.toJson(DataService.getData(), true));\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.spectSettingsBtnClick = function () {\n      if (viewState.getPermission('spectSettingsChange')) {\n        modalService.open('views/spectSettings.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.connectBtnClick = function () {\n      if (viewState.getPermission('connectBtnClick')) {\n        modalService.open('views/connectModal.html').then(function (url) {\n          if (url) {\n            Iohandlerservice.wsH.initConnect(url).then(function (message) {\n              if (message.type === 'error') {\n                modalService.open('views/error.html', 'Could not connect to websocket server: ' + url);\n              } else {\n                $scope.handleConnectedToWSserver();\n              }\n            });\n          }\n        });\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.openDemoDBbtnClick = function (nameOfDB) {\n      if (viewState.getPermission('openDemoBtnDBclick')) {\n        ConfigProviderService.vals.activeButtons.openDemoDB = false;\n        loadedMetaDataService.setDemoDbName(nameOfDB);\n        // hide drop zone \n        viewState.showDropZone = false;\n        viewState.somethingInProgress = true;\n        // alert(nameOfDB);\n        viewState.setState('loadingSaving');\n        ConfigProviderService.vals.main.comMode = 'DEMO';\n        viewState.somethingInProgressTxt = 'Loading DB config...';\n        Iohandlerservice.getDBconfigFile(nameOfDB).then(function (res) {\n          var data = res.data;\n          // first element of perspectives is default perspective\n          viewState.curPerspectiveIdx = 0;\n          ConfigProviderService.setVals(data.EMUwebAppConfig);\n          delete data.EMUwebAppConfig;\n          // delete to avoid duplicate\n          var validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n          if (validRes === true) {\n            ConfigProviderService.curDbConfig = data;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            validRes = Validationservice.validateJSO('DBconfigFileSchema', ConfigProviderService.curDbConfig);\n            if (validRes === true) {\n              // then get the DBconfigFile\n              viewState.somethingInProgressTxt = 'Loading bundle list...';\n              Iohandlerservice.getBundleList(nameOfDB).then(function (res) {\n                var bdata = res.data;\n                // validRes = Validationservice.validateJSO('bundleListSchema', bdata);\n                // if (validRes === true) {\n                loadedMetaDataService.setBundleList(bdata);\n                // then load first bundle in list\n                dbObjLoadSaveService.loadBundle(loadedMetaDataService.getBundleList()[0]);\n              }, function (err) {\n                modalService.open('views/error.html', 'Error loading bundle list of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n                  appStateService.resetToInitState();\n                });\n              });\n            } else {\n              modalService.open('views/error.html', 'Error validating DBconfig: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          } else {\n            modalService.open('views/error.html', 'Error validating ConfigProviderService.vals (emuwebappConfig data) after applying changes of newly loaded config (most likely due to wrong entry...): ' + JSON.stringify(validRes, null, 4)).then(function () {\n              appStateService.resetToInitState();\n            });\n          }\n        }, function (err) {\n          modalService.open('views/error.html', 'Error loading DB config of ' + nameOfDB + ': ' + err.data + ' STATUS: ' + err.status).then(function () {\n            appStateService.resetToInitState();\n          });\n        });\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.aboutBtnClick = function () {\n      modalService.open('views/about.html');\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showHierarchyBtnClick = function () {\n      if (!viewState.hierarchyShown) {\n        viewState.toggleHierarchy();\n        modalService.open('views/showHierarchyModal.html');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.showEditDBconfigBtnClick = function () {\n      var currentConfig = $scope.cps.curDbConfig;\n      var currentVals = $scope.cps.vals;\n      modalService.open('views/editDBconfigModal.html').then(function (res) {\n        if (res) {\n          // todo save and transfer curDbConfig & vals\n          console.log(angular.toJson({\n            dbconfig: $scope.cps.curDbConfig,\n            vals: $scope.cps.vals\n          }));\n        } else {\n          $scope.cps.curDbConfig = currentConfig;\n          $scope.cps.vals = currentVals;\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.clearBtnClick = function () {\n      // viewState.setdragBarActive(false);\n      var modalText;\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? CAUTION: YOU HAVE UNSAVED CHANGES! These will be lost if you confirm.';\n      } else {\n        modalText = 'Do you wish to clear all loaded data and if connected disconnect from the server? You have NO unsaved changes so no changes will be lost.';\n      }\n      modalService.open('views/confirmModal.html', modalText).then(function (res) {\n        if (res) {\n          appStateService.resetToInitState();\n        }\n      });\n    };\n    // bottom menu:\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomAll = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomIn = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(true);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomOut = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.zoomViewPort(false);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomLeft = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(false);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomRight = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.shiftViewPort(true);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdZoomSel = function () {\n      if (viewState.getPermission('zoom')) {\n        LevelService.deleteEditArea();\n        viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayView = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlaySel = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n        viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n      } else {\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cmdPlayAll = function () {\n      if (viewState.getPermission('playaudio')) {\n        Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n        viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n      } else {\n      }\n    };\n    ///////////////////////////\n    // other\n    /**\n\t\t * function used to change perspective\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.changePerspective = function (persp) {\n      var newIdx;\n      for (var i = 0; i < ConfigProviderService.vals.perspectives.length; i++) {\n        if (persp.name === ConfigProviderService.vals.perspectives[i].name) {\n          newIdx = i;\n        }\n      }\n      viewState.curPerspectiveIdx = newIdx;\n      // close submenu\n      viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n    };\n    /**\n\t\t * function used by right side menu to get color of current perspecitve in ul\n\t\t * @param persp json object of current perspective containing name attribute\n\t\t */\n    $scope.getPerspectiveColor = function (persp) {\n      var cl;\n      if (viewState.curPerspectiveIdx === -1 || persp.name === ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].name) {\n        cl = 'emuwebapp-curSelPerspLi';\n      } else {\n        cl = 'emuwebapp-perspLi';\n      }\n      return cl;\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('level', [\n  '$timeout',\n  '$animate',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'HistoryService',\n  'fontScaleService',\n  'modalService',\n  'LevelService',\n  function ($timeout, $animate, viewState, ConfigProviderService, Drawhelperservice, HistoryService, fontScaleService, modalService, LevelService) {\n    return {\n      templateUrl: 'views/level.html',\n      restrict: 'E',\n      scope: {\n        level: '=',\n        idx: '='\n      },\n      link: function postLink(scope, element, attr) {\n        // select the needed DOM items from the template\n        var canvas = element.find('canvas');\n        scope.open = attr.open;\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.cps = ConfigProviderService;\n        scope.modal = modalService;\n        var levelCanvasContainer = element.find('div');\n        scope.levelDef = ConfigProviderService.getLevelDefinition(scope.level.name);\n        scope.backgroundCanvas = { 'background': ConfigProviderService.vals.colors.levelColor };\n        scope.$watch('vs.submenuOpen', function (newValue, oldValue) {\n          $timeout(scope.redraw, scope.cps.vals.colors.transitionTime);\n        });\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS || oldValue.windowWidth !== newValue.windowWidth) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();\n          } else {\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMouseX', function (newValue, oldValue) {\n          // only repaint if mouse over current level\n          if (scope.vs.getcurMouseLevelName() === scope.level.name) {\n            scope.drawLevelDetails();\n            scope.drawLevelMarkup();  //}\n          }\n        }, true);\n        //\n        scope.$watch('vs.curClickLevelName', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.drawLevelMarkup();\n          }\n        }, true);\n        //\n        scope.$watch('vs.movingBoundarySample', function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('vs.movingBoundary', function () {\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        scope.$watch('hists.movesAwayFromLastSave', function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        }, true);\n        //\n        /////////////////\n        scope.redraw = function () {\n          scope.drawLevelDetails();\n          scope.drawLevelMarkup();\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.changeCurAttrDef = function (attrDefName, index) {\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if (curAttrDef !== attrDefName) {\n            // curAttrDef = attrDefName;\n            scope.vs.setCurAttrDef(scope.level.name, attrDefName, index);\n            if (!element.hasClass('emuwebapp-levelCanvasContainer-animate')) {\n              scope.vs.setEditing(false);\n              LevelService.deleteEditArea();\n              $animate.addClass(levelCanvasContainer, 'emuwebapp-levelCanvasContainer-animate').then(function () {\n                $animate.removeClass(levelCanvasContainer, 'emuwebapp-levelCanvasContainer-animate');\n                // redraw\n                scope.drawLevelDetails();\n                scope.drawLevelMarkup();\n              });\n            }\n          }\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.getAttrDefBtnColor = function (attrDefName) {\n          var curColor;\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if (attrDefName === curAttrDef) {\n            curColor = { 'background': '-webkit-radial-gradient(50% 50%, closest-corner, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 60%)' };\n          } else {\n            curColor = { 'background-color': 'white' };\n          }\n          return curColor;\n        };\n        scope.updateView = function () {\n          if ($.isEmptyObject(scope.cps)) {\n            return;\n          }\n          scope.drawLevelDetails();\n        };\n        ///////////////\n        // bindings\n        // on mouse leave reset viewState.\n        element.bind('mouseleave', function () {\n          scope.vs.setcurMouseItem(undefined, undefined, undefined);\n          scope.drawLevelMarkup();\n        });\n        /**\n\t\t\t\t * draw level details\n\t\t\t\t * @param levelDetails\n\t\t\t\t */\n        scope.drawLevelDetails = function () {\n          var fontSize = scope.cps.vals.font.fontPxSize;\n          var curAttrDef = scope.vs.getCurAttrDef(scope.level.name);\n          if ($.isEmptyObject(scope.level)) {\n            console.log('undef levelDetails');\n            return;\n          }\n          if ($.isEmptyObject(scope.vs)) {\n            console.log('undef viewState');\n            return;\n          }\n          if ($.isEmptyObject(scope.cps)) {\n            console.log('undef config');\n            return;\n          }\n          if (!scope.open) {\n            fontSize -= 1;\n          }\n          var ctx = canvas[0].getContext('2d');\n          ctx.clearRect(0, 0, canvas[0].width, canvas[0].height);\n          //predef vars\n          var sDist, posS, posE, horizontalText;\n          sDist = scope.vs.getSampleDist(canvas[0].width);\n          // draw name of level and type\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          if (scope.level.name === curAttrDef) {\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, scope.level.name, '(' + scope.level.type + ')', fontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          } else {\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, scope.level.name + ':' + curAttrDef, '(' + scope.level.type + ')', fontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          }\n          ctx.drawImage(horizontalText, 0, ctx.canvas.height / 2 - fontSize * scaleY);\n          var segMId = scope.vs.getcurMouseItem();\n          var segCId = scope.vs.getcurClickItems();\n          var levelId = scope.vs.getcurClickLevelName();\n          var curID = -1;\n          // calculate generic max with of single char (m char used)\n          var mTxtImg = fontScaleService.getTextImage(ctx, 'm', fontSize - 2, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor);\n          var mTxtImgWidth = fontScaleService.getLastImageWidth();\n          // calculate generic max with of single digit (0 digit used)\n          var zeroTxtImg = fontScaleService.getTextImage(ctx, '0', fontSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          var zeroTxtImgWidth = fontScaleService.getLastImageWidth();\n          if (scope.level.type === 'SEGMENT') {\n            ctx.fillStyle = scope.cps.vals.colors.startBoundaryColor;\n            // draw segments\n            var e = scope.level.items;\n            e.forEach(function (curEvt) {\n              ++curID;\n              if (curEvt.sampleStart >= scope.vs.curViewPort.sS && curEvt.sampleStart <= scope.vs.curViewPort.eS || curEvt.sampleStart + curEvt.sampleDur > scope.vs.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur < scope.vs.curViewPort.eS || curEvt.sampleStart < scope.vs.curViewPort.sS && curEvt.sampleStart + curEvt.sampleDur > scope.vs.curViewPort.eS) {\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                // draw segment start\n                posS = scope.vs.getPos(canvas[0].width, curEvt.sampleStart);\n                posE = scope.vs.getPos(canvas[0].width, curEvt.sampleStart + curEvt.sampleDur + 1);\n                ctx.fillStyle = scope.cps.vals.colors.startBoundaryColor;\n                ctx.fillRect(posS, 0, 2, canvas[0].height / 2);\n                //draw segment end\n                ctx.fillStyle = scope.cps.vals.colors.endBoundaryColor;\n                ctx.fillRect(posE, canvas[0].height / 2, 2, canvas[0].height);\n                //check for enough space to stroke text\n                if (curLabVal !== undefined && posE - posS > mTxtImgWidth * curLabVal.length) {\n                  horizontalText = fontScaleService.getTextImage(ctx, curLabVal, fontSize - 2, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor);\n                  var tW = fontScaleService.getLastImageWidth();\n                  var tX = posS + (posE - posS) / 2 - tW / 2;\n                  if (scope.open) {\n                    ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, tX, canvas[0].height / 2 - (fontSize - 2), horizontalText.width, horizontalText.height);\n                  } else {\n                    ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, tX, 0, horizontalText.width, horizontalText.height);\n                  }\n                }\n                //draw helper lines\n                if (scope.open && curLabVal !== undefined && curLabVal.length !== 0) {\n                  // only draw if label is not empty\n                  var labelCenter = posS + (posE - posS) / 2;\n                  var hlY = canvas[0].height / 4;\n                  // start helper line\n                  ctx.strokeStyle = scope.cps.vals.colors.startBoundaryColor;\n                  ctx.beginPath();\n                  ctx.moveTo(posS, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY + 5);\n                  ctx.stroke();\n                  hlY = canvas[0].height / 4 * 3;\n                  // end helper line\n                  ctx.strokeStyle = scope.cps.vals.colors.endBoundaryColor;\n                  ctx.beginPath();\n                  ctx.moveTo(posE, hlY);\n                  ctx.lineTo(labelCenter, hlY);\n                  ctx.lineTo(labelCenter, hlY - 5);\n                  ctx.stroke();\n                }\n                // draw sampleStart numbers\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * curEvt.sampleStart.toString().length) {\n                  var horizontalSubText1 = fontScaleService.getTextImage(ctx, curEvt.sampleStart, fontSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n                  ctx.drawImage(horizontalSubText1, 0, 0, horizontalText.width, horizontalText.height, posS + 3, 0, horizontalText.width, horizontalText.height);\n                }\n                // draw sampleDur numbers.\n                //check for enough space to stroke text\n                if (posE - posS > zeroTxtImgWidth * (5 + curEvt.sampleDur.toString().length)) {\n                  var horizontalSubText2 = fontScaleService.getTextImage(ctx, 'dur: ' + curEvt.sampleDur, fontSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n                  var hst2 = fontScaleService.getLastImageWidth();\n                  ctx.drawImage(horizontalSubText2, 0, 0, horizontalText.width, horizontalText.height, posE - hst2, canvas[0].height / 4 * 3, horizontalText.width, horizontalText.height);\n                }\n              }\n            });\n          } else if (scope.level.type === 'EVENT') {\n            ctx.fillStyle = scope.cps.vals.colors.startBoundaryColor;\n            // predef. vars\n            var perc;\n            scope.level.items.forEach(function (curEvt) {\n              if (curEvt.samplePoint > scope.vs.curViewPort.sS && curEvt.samplePoint < scope.vs.curViewPort.eS) {\n                perc = Math.round(scope.vs.getPos(canvas[0].width, curEvt.samplePoint) + sDist / 2);\n                // get label\n                var curLabVal;\n                curEvt.labels.forEach(function (lab) {\n                  if (lab.name === curAttrDef) {\n                    curLabVal = lab.value;\n                  }\n                });\n                ctx.fillStyle = scope.cps.vals.colors.startBoundaryColor;\n                ctx.fillRect(perc, 0, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                ctx.fillRect(perc, canvas[0].height / 2 + canvas[0].height / 10, 1, canvas[0].height / 2 - canvas[0].height / 10);\n                horizontalText = fontScaleService.getTextImage(ctx, curLabVal, fontSize - 2, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor);\n                ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, perc - 5, canvas[0].height / 3, horizontalText.width, horizontalText.height);\n                horizontalText = fontScaleService.getTextImage(ctx, curEvt.samplePoint, fontSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n                ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, perc + 5, 0, horizontalText.width, horizontalText.height);\n              }\n            });\n          }  // draw cursor/selected area\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawLevelMarkup = function () {\n          var ctx = canvas[1].getContext('2d');\n          ctx.clearRect(0, 0, canvas[1].width, canvas[1].height);\n          if (scope.level.name === scope.vs.getcurClickLevelName()) {\n            ctx.fillStyle = scope.cps.vals.colors.selectedLevelColor;\n            ctx.fillRect(0, 0, canvas[0].width, canvas[0].height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx);\n          var posS, posE, sDist, xOffset, curEvt;\n          posS = scope.vs.getPos(canvas[1].width, scope.vs.curViewPort.selectS);\n          posE = scope.vs.getPos(canvas[1].width, scope.vs.curViewPort.selectE);\n          sDist = scope.vs.getSampleDist(canvas[1].width);\n          var segMId = scope.vs.getcurMouseItem();\n          var isFirst = scope.vs.getcurMouseisFirst();\n          var isLast = scope.vs.getcurMouseisLast();\n          var clickedSegs = scope.vs.getcurClickItems();\n          var levelId = scope.vs.getcurClickLevelName();\n          if (clickedSegs !== undefined) {\n            // draw clicked on selected areas\n            if (scope.level.name === levelId && clickedSegs.length > 0) {\n              clickedSegs.forEach(function (cs) {\n                if (cs !== undefined) {\n                  // check if segment or event level\n                  if (cs.sampleStart !== undefined) {\n                    posS = Math.round(scope.vs.getPos(canvas[0].width, cs.sampleStart));\n                    posE = Math.round(scope.vs.getPos(canvas[0].width, cs.sampleStart + cs.sampleDur + 1));\n                  } else {\n                    posS = Math.round(scope.vs.getPos(canvas[0].width, cs.samplePoint) + sDist / 2);\n                    posS = posS - 5;\n                    posE = posS + 10;\n                  }\n                  ctx.fillStyle = scope.cps.vals.colors.selectedSegmentColor;\n                  ctx.fillRect(posS, 0, posE - posS, canvas[0].height);\n                  ctx.fillStyle = scope.cps.vals.colors.startBoundaryColor;\n                }\n              });\n            }\n          }\n          // draw preselected boundary\n          curEvt = scope.vs.getcurMouseItem();\n          if (scope.level.items.length > 0 && curEvt !== undefined && segMId !== undefined && scope.level.name === scope.vs.getcurMouseLevelName()) {\n            ctx.fillStyle = scope.cps.vals.colors.selectedBoundaryColor;\n            if (isFirst === true) {\n              // before first segment\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = scope.level.items[0];\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else if (isLast === true) {\n              // after last segment\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                curEvt = scope.level.items[scope.level.items.length - 1];\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart + curEvt.sampleDur + 1));\n                // +1 because boundaries are drawn on sampleStart\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              }\n            } else {\n              // in the middle\n              if (scope.vs.getcurMouseLevelType() === 'SEGMENT') {\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.sampleStart));\n                ctx.fillRect(posS, 0, 3, canvas[1].height);\n              } else {\n                posS = Math.round(scope.vs.getPos(canvas[1].width, curEvt.samplePoint));\n                xOffset = sDist / 2;\n                ctx.fillRect(posS + xOffset, 0, 3, canvas[1].height);\n              }\n            }\n            ctx.fillStyle = scope.cps.vals.colors.startBoundaryColor;\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('osci', [\n  '$timeout',\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  function ($timeout, viewState, Soundhandlerservice, ConfigProviderService, Drawhelperservice) {\n    return {\n      templateUrl: 'views/osci.html',\n      replace: true,\n      restrict: 'E',\n      scope: {},\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.changeAttrDef = function () {\n          };\n        }\n      ],\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // assign attributes to scope\n        scope.order = attrs.order;\n        scope.trackName = attrs.trackName;\n        scope.cps = ConfigProviderService;\n        scope.viewState = viewState;\n        ///////////////\n        // watches\n        //\n        scope.$watch('viewState.submenuOpen', function () {\n          $timeout(scope.redraw, scope.cps.vals.colors.transitionTime);\n        });\n        //\n        scope.$watch('viewState.timelineSize', function () {\n          $timeout(scope.redraw, scope.cps.vals.colors.transitionTime);\n        });\n        //\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n        }, true);\n        //\n        scope.$watch('viewState.playHeadAnimationInfos', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawPlayHead(scope, ConfigProviderService);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundarySample', function (newValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.movingBoundary', function () {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        scope.$watch('viewState.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n                Drawhelperservice.osciPeaks = allPeakVals;\n                Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n              }\n              scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n            }\n          }\n        }, true);\n        //\n        /////////////////////////\n        scope.redraw = function () {\n          scope.drawVpOsciMarkup(scope, ConfigProviderService, true);\n        };\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPlayHead = function (scope, config) {\n          var ctx = markupCanvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          var posS = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.sS);\n          var posCur = viewState.getPos(markupCanvas.width, viewState.playHeadAnimationInfos.curS);\n          ctx.fillStyle = ConfigProviderService.vals.colors.selectedAreaColor;\n          ctx.fillRect(posS, 0, posCur - posS, canvas.height);\n          scope.drawVpOsciMarkup(scope, config, false);\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (scope, config, reset) {\n          var ctx = markupCanvas.getContext('2d');\n          if (reset) {\n            ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n          Drawhelperservice.drawViewPortTimes(ctx, true);\n          // draw current viewport selected\n          Drawhelperservice.drawCurViewPortSelected(ctx, true);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('preview', [\n  'viewState',\n  'Soundhandlerservice',\n  'Drawhelperservice',\n  'ConfigProviderService',\n  function (viewState, Soundhandlerservice, Drawhelperservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/preview.html',\n      restrict: 'E',\n      scope: { currentBundleName: '@' },\n      link: function postLink(scope, element) {\n        // select the needed DOM elements from the template and init vals\n        var canvas = element.find('canvas')[0];\n        var markupCanvas = element.find('canvas')[1];\n        var initialized = false;\n        // hook up scope vars for watches\n        scope.vs = viewState;\n        scope.shs = Soundhandlerservice;\n        scope.backgroundCanvas = {\n          'background': '#eee',\n          'border': '1px solid gray',\n          'width': '100%',\n          'height': '100%'\n        };\n        /////////////////////\n        // watches\n        //\n        scope.$watch('vs.curViewPort', function (newVal, oldVal) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            if (oldVal.sS !== newVal.sS || oldVal.eS !== newVal.eS) {\n              scope.drawPreview();\n            }\n          }\n        }, true);\n        //\n        scope.$watch('currentBundleName', function () {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            initialized = false;\n            scope.backgroundCanvas = {\n              'background': ConfigProviderService.vals.colors.levelColor,\n              'border': '1px solid gray',\n              'width': '100%',\n              'height': '100%'\n            };\n            scope.drawPreview();\n          }\n          //clear on empty bundle name\n          if (scope.currentBundleName === '') {\n            var ctx = canvas.getContext('2d');\n            var ctxMarkup = markupCanvas.getContext('2d');\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctxMarkup.clearRect(0, 0, canvas.width, canvas.height);\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n\t\t\t\t *\n\t\t\t\t */\n        scope.drawPreview = function () {\n          if (!initialized) {\n            var allPeakVals = Drawhelperservice.calculatePeaks(viewState, canvas, Soundhandlerservice.wavJSO.Data);\n            Drawhelperservice.osciPeaks = allPeakVals;\n            Drawhelperservice.freshRedrawDrawOsciOnCanvas(viewState, canvas, Drawhelperservice.osciPeaks, Soundhandlerservice.wavJSO.Data, ConfigProviderService);\n            initialized = true;\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          } else {\n            scope.drawVpOsciMarkup(viewState, canvas, ConfigProviderService);\n          }\n        };\n        /**\n\t\t\t\t * draws markup of osci according to\n\t\t\t\t * the information that is specified in\n\t\t\t\t * the viewport\n\t\t\t\t */\n        scope.drawVpOsciMarkup = function (vs, canvas, config) {\n          var ctx = markupCanvas.getContext('2d');\n          var posS = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.sS;\n          var posE = markupCanvas.width / Soundhandlerservice.wavJSO.Data.length * vs.curViewPort.eS;\n          ctx.clearRect(0, 0, markupCanvas.width, markupCanvas.height);\n          ctx.fillStyle = config.vals.colors.selectedAreaColor;\n          ctx.fillRect(posS, 0, posE - posS, markupCanvas.height);\n          ctx.strokeStyle = config.vals.colors.selectedBorderColor;\n          ctx.beginPath();\n          ctx.moveTo(posS, 0);\n          ctx.lineTo(posS, markupCanvas.height);\n          ctx.moveTo(posE, 0);\n          ctx.lineTo(posE, markupCanvas.height);\n          ctx.closePath();\n          ctx.stroke();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('bundleListSideBar', function () {\n  return {\n    templateUrl: 'views/bundleListSideBar.html',\n    restrict: 'E',\n    replace: true,\n    scope: {},\n    link: function postLink(scope, element, attr) {\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('spectro', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  'Drawhelperservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  'mathHelperService',\n  function ($timeout, viewState, ConfigProviderService, Drawhelperservice, fontScaleService, Soundhandlerservice, mathHelperService) {\n    return {\n      templateUrl: 'views/spectro.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.shs = Soundhandlerservice;\n        scope.order = attrs.order;\n        scope.vs = viewState;\n        scope.cps = ConfigProviderService;\n        scope.dhs = Drawhelperservice;\n        scope.trackName = attrs.trackName;\n        // select the needed DOM elements from the template\n        scope.canvas0 = element.find('canvas')[0];\n        scope.canvas1 = element.find('canvas')[element.find('canvas').length - 1];\n        scope.context = scope.canvas0.getContext('2d');\n        scope.markupCtx = scope.canvas1.getContext('2d');\n        // FFT default vars\n        // default alpha for Window Function\n        scope.alpha = 0.16;\n        scope.devicePixelRatio = window.devicePixelRatio || 1;\n        // Spectro Worker \n        scope.primeWorker = new spectroDrawingWorker();\n        ///////////////\n        // watches\n        //\n        scope.$watch('vs.timelineSize', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.clearAndDrawSpectMarkup, scope.cps.vals.colors.transitionTime);\n            }\n          }\n        });\n        //\n        scope.$watch('vs.submenuOpen', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              $timeout(scope.clearAndDrawSpectMarkup, scope.cps.vals.colors.transitionTime);\n            }\n          }\n        });\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // check for changed zoom\n              if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                scope.redraw();\n              }\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              // scope.redraw();\n              scope.clearAndDrawSpectMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.spectroSettings', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.setupEvent();\n              scope.redraw();\n            }\n          }\n        }, true);\n        ///////////////\n        // bindings\n        scope.redraw = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectro(scope.shs.wavJSO.Data);\n        };\n        scope.drawSpectro = function (buffer) {\n          scope.killSpectroRenderingThread();\n          scope.startSpectroRenderingThread(buffer);\n        };\n        scope.calcSamplesPerPxl = function () {\n          return (scope.vs.curViewPort.eS + 1 - scope.vs.curViewPort.sS) / scope.canvas0.width;\n        };\n        scope.clearAndDrawSpectMarkup = function () {\n          scope.markupCtx.clearRect(0, 0, scope.canvas1.width, scope.canvas1.height);\n          scope.drawSpectMarkup();\n        };\n        scope.drawSpectMarkup = function () {\n          // draw moving boundary line if moving\n          scope.dhs.drawMovingBoundaryLine(scope.markupCtx);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          // draw min max vals and name of track\n          scope.dhs.drawMinMaxAndName(scope.markupCtx, '', scope.vs.spectroSettings.rangeFrom, scope.vs.spectroSettings.rangeTo, 2);\n        };\n        scope.killSpectroRenderingThread = function () {\n          scope.context.fillStyle = scope.cps.vals.colors.levelColor;\n          scope.context.fillRect(0, 0, scope.canvas0.width, scope.canvas0.height);\n          // draw current viewport selected\n          scope.dhs.drawCurViewPortSelected(scope.markupCtx, false);\n          var horizontalText = fontScaleService.getTextImage(scope.context, 'rendering...', scope.cps.vals.font.fontPxSize * 0.75, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          scope.context.drawImage(horizontalText, 10, 50);\n          if (scope.primeWorker !== null) {\n            scope.primeWorker.kill();\n            scope.primeWorker = null;\n          }\n        };\n        scope.setupEvent = function () {\n          var imageData = scope.context.createImageData(scope.canvas0.width, scope.canvas0.height);\n          scope.primeWorker.says(function (event) {\n            if (event.status === undefined) {\n              if (scope.calcSamplesPerPxl() === event.samplesPerPxl) {\n                var tmp = new Uint8ClampedArray(event.img);\n                imageData.data.set(tmp);\n                scope.context.putImageData(imageData, 0, 0);\n                scope.drawSpectMarkup();\n              }\n            } else {\n              console.error('Error rendering spectrogram:', event.status.message);\n            }\n          });\n        };\n        scope.startSpectroRenderingThread = function (buffer) {\n          if (buffer.length > 0) {\n            scope.primeWorker = new spectroDrawingWorker();\n            var parseData;\n            var fftN = mathHelperService.calcClosestPowerOf2Gt(scope.shs.wavJSO.SampleRate * scope.vs.spectroSettings.windowSizeInSecs);\n            // fftN must be greater than 512 (leads to better resolution of spectrogram)\n            if (fftN < 512) {\n              fftN = 512;\n            }\n            if (scope.vs.curViewPort.sS >= fftN / 2) {\n              // pass in half a window extra at the front and a full window extra at the back so everything can be drawn/calculated this also fixes alignment issue\n              parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS - fftN / 2, scope.vs.curViewPort.eS + fftN));\n            } else {\n              // tolerate window/2 alignment issue if at beginning of file\n              parseData = new Float32Array(buffer.subarray(scope.vs.curViewPort.sS, scope.vs.curViewPort.eS + fftN));\n            }\n            scope.setupEvent();\n            scope.primeWorker.tell({\n              'windowSizeInSecs': scope.vs.spectroSettings.windowSizeInSecs,\n              'fftN': fftN,\n              'alpha': scope.alpha,\n              'upperFreq': scope.vs.spectroSettings.rangeTo,\n              'lowerFreq': scope.vs.spectroSettings.rangeFrom,\n              'samplesPerPxl': scope.calcSamplesPerPxl(),\n              'window': scope.vs.spectroSettings.window,\n              'imgWidth': scope.canvas0.width,\n              'imgHeight': scope.canvas0.height,\n              'dynRangeInDB': scope.vs.spectroSettings.dynamicRange,\n              'pixelRatio': scope.devicePixelRatio,\n              'sampleRate': scope.shs.wavJSO.SampleRate,\n              'transparency': scope.cps.vals.spectrogramSettings.transparency,\n              'audioBuffer': parseData.buffer,\n              'audioBufferChannels': scope.shs.wavJSO.NumChannels,\n              'drawHeatMapColors': scope.vs.spectroSettings.drawHeatMapColors,\n              'preEmphasisFilterFactor': scope.vs.spectroSettings.preEmphasisFilterFactor,\n              'heatMapColorAnchors': scope.vs.spectroSettings.heatMapColorAnchors\n            }, [parseData.buffer]);\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ExportCtrl', [\n  '$scope',\n  'modalService',\n  'browserDetector',\n  'viewState',\n  'HistoryService',\n  function ($scope, modalService, browserDetector, viewState, HistoryService) {\n    $scope.firefox = browserDetector.isBrowser.Firefox();\n    /**\n\t\t *\n\t\t */\n    $scope.getBlob = function () {\n      var blob;\n      try {\n        blob = new Blob([modalService.dataExport], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append($scope.exportData);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.updateHistoryService = function () {\n      HistoryService.movesAwayFromLastSave = 0;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.export = function () {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL($scope.getBlob());\n      } else {\n        objURL = URL.createObjectURL($scope.getBlob());\n      }\n      $scope.SaveToDisk(objURL, modalService.dataIn);\n      modalService.close();\n    };\n    /**\n\t\t *  Save file to disk // Non-IE ONLY !!\n\t\t */\n    $scope.SaveToDisk = function (fileURL, fileName) {\n      var save = document.createElement('a');\n      if ($scope.firefox) {\n        save.setAttribute('download', fileName);\n        save.href = fileURL;\n        save.innerHTML = '';\n        save.style.display = 'none';\n        document.body.appendChild(save);\n        save.click();\n      } else {\n        save.href = fileURL;\n        save.target = '_blank';\n        save.download = fileName || 'unknown';\n        var event = document.createEvent('Event');\n        event.initEvent('click', true, true);\n        save.dispatchEvent(event);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n      }\n      $scope.updateHistoryService();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('viewState', [\n  '$rootScope',\n  '$timeout',\n  '$window',\n  'Soundhandlerservice',\n  function ($rootScope, $timeout, $window, Soundhandlerservice) {\n    //shared service object to be returned\n    var sServObj = {};\n    // window functions enum for spectro\n    var myWindow = {\n        BARTLETT: 1,\n        BARTLETTHANN: 2,\n        BLACKMAN: 3,\n        COSINE: 4,\n        GAUSS: 5,\n        HAMMING: 6,\n        HANN: 7,\n        LANCZOS: 8,\n        RECTANGULAR: 9,\n        TRIANGULAR: 10\n      };\n    // hold the current attribute definitions that are in view \n    sServObj.curLevelAttrDefs = [];\n    /**\n     * initialize all needed vars in viewState\n     */\n    sServObj.initialize = function () {\n      sServObj.curViewPort = {\n        sS: 0,\n        eS: 0,\n        selectS: -1,\n        selectE: -1,\n        dragBarActive: false,\n        dragBarHeight: -1,\n        windowWidth: undefined\n      };\n      sServObj.spectroSettings = {\n        windowSizeInSecs: -1,\n        rangeFrom: -1,\n        rangeTo: -1,\n        dynamicRange: -1,\n        window: -1,\n        drawHeatMapColors: -1,\n        preEmphasisFilterFactor: -1\n      };\n      sServObj.playHeadAnimationInfos = {\n        sS: -1,\n        eS: -1,\n        curS: null,\n        endFreezeSample: -1\n      };\n      sServObj.timelineSize = -1;\n      sServObj.somethingInProgress = false;\n      sServObj.somethingInProgressTxt = '';\n      sServObj.historyActionTxt = '';\n      sServObj.editing = false;\n      sServObj.cursorInTextField = false;\n      sServObj.saving = true;\n      sServObj.hierarchyRotated = false;\n      sServObj.hierarchyShown = false;\n      sServObj.submenuOpen = false;\n      sServObj.rightSubmenuOpen = false;\n      sServObj.curClickItems = [];\n      sServObj.curMousePosSample = 0;\n      sServObj.curMouseLevelName = undefined;\n      sServObj.curMouseLevelType = undefined;\n      sServObj.curClickLevelName = undefined;\n      sServObj.curClickLevelType = undefined;\n      sServObj.lastPcm = undefined;\n      sServObj.curPreselColumnSample = 2;\n      sServObj.curCorrectionToolNr = undefined;\n      sServObj.curClickLevelIndex = undefined;\n      sServObj.start = null;\n      sServObj.TransitionTime = undefined;\n      sServObj.showDropZone = true;\n      sServObj.movingBoundary = false;\n      sServObj.movingBoundarySample = undefined;\n      sServObj.focusInTextField = false;\n      sServObj.curTaskPercCompl = 0;\n      sServObj.curPerspectiveIdx = -1;\n      sServObj.mouseInEmuWebApp = false;\n      sServObj.lastKeyCode = undefined;\n      // possible general states of state machine\n      sServObj.states = [];\n      sServObj.states.noDBorFilesloaded = {\n        'permittedActions': [\n          'connectBtnClick',\n          'openDemoBtnDBclick'\n        ]\n      };\n      sServObj.states.loadingSaving = { 'permittedActions': [] };\n      sServObj.states.labeling = {\n        'permittedActions': [\n          'zoom',\n          'playaudio',\n          'spectSettingsChange',\n          'addLevelSegBtnClick',\n          'addLevelPointBtnClick',\n          'renameSelLevelBtnClick',\n          'downloadTextGridBtnClick',\n          'downloadAnnotationBtnClick',\n          'spectSettingsChange',\n          'clearBtnClick',\n          'labelAction',\n          'toggleSideBars',\n          'saveBndlBtnClick',\n          'showHierarchyBtnClick',\n          'editDBconfigBtnClick'\n        ]\n      };\n      sServObj.states.modalShowing = sServObj.states.loadingSaving;\n      sServObj.prevState = sServObj.states.noDBorFilesloaded;\n      sServObj.curState = sServObj.states.noDBorFilesloaded;\n      sServObj.curLevelAttrDefs = [];\n    };\n    // initialize on init\n    sServObj.initialize();\n    /**\n     * function to ask permission in current labeler state\n     */\n    sServObj.getPermission = function (actionName) {\n      return sServObj.curState.permittedActions.indexOf(actionName) > -1;\n    };\n    /**\n     *\n     */\n    sServObj.setWindowWidth = function (b) {\n      this.curViewPort.windowWidth = b;\n    };\n    /**\n     * set state\n     */\n    sServObj.setState = function (nameOrObj) {\n      sServObj.prevState = sServObj.curState;\n      if (typeof nameOrObj === 'string') {\n        sServObj.curState = sServObj.states[nameOrObj];\n      } else {\n        sServObj.curState = nameOrObj;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.updatePlayHead = function (timestamp) {\n      // at first push animation !!!\n      if (Soundhandlerservice.player.isPlaying) {\n        $window.requestAnimationFrame(sServObj.updatePlayHead);\n      }\n      // do work in this animation round now\n      if (sServObj.start === null) {\n        sServObj.start = timestamp;\n      }\n      var samplesPassed = Math.floor(timestamp - sServObj.start) / 1000 * Soundhandlerservice.wavJSO.SampleRate;\n      sServObj.playHeadAnimationInfos.curS = Math.floor(sServObj.playHeadAnimationInfos.sS + samplesPassed);\n      if (Soundhandlerservice.player.isPlaying && sServObj.playHeadAnimationInfos.curS <= sServObj.playHeadAnimationInfos.eS) {\n        if (sServObj.playHeadAnimationInfos.curS !== -1) {\n          sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.curS;\n        }\n        $rootScope.$apply();\n      } else {\n        sServObj.curMousePosSample = sServObj.playHeadAnimationInfos.endFreezeSample;\n        sServObj.playHeadAnimationInfos.sS = -1;\n        sServObj.playHeadAnimationInfos.eS = -1;\n        sServObj.playHeadAnimationInfos.curS = 0;\n        sServObj.start = null;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.animatePlayHead = function (startS, endS) {\n      sServObj.playHeadAnimationInfos.sS = startS;\n      sServObj.playHeadAnimationInfos.eS = endS;\n      sServObj.playHeadAnimationInfos.endFreezeSample = endS;\n      sServObj.playHeadAnimationInfos.curS = startS;\n      $window.requestAnimationFrame(sServObj.updatePlayHead);\n    };\n    /**\n     * set selected Area\n     * @param start of selected Area\n     * @param end of selected Area\n     */\n    sServObj.select = function (start, end) {\n      sServObj.curViewPort.selectS = start;\n      sServObj.curViewPort.selectE = end;  //$rootScope.$digest();\n    };\n    /**\n     * reset selected Area to default\n     * @param length of current pcm stream\n     */\n    sServObj.resetSelect = function () {\n      sServObj.curViewPort.selectS = -1;\n      sServObj.curViewPort.selectE = -1;\n    };\n    /**\n     * gets the current Viewport\n     */\n    sServObj.getViewPort = function () {\n      return sServObj.curViewPort;\n    };\n    /**\n     * setspectroSettings\n     */\n    sServObj.setspectroSettings = function (len, rfrom, rto, dyn, win, hm, preEmph, hmColorAnchors) {\n      sServObj.spectroSettings.windowSizeInSecs = len;\n      sServObj.spectroSettings.rangeFrom = parseInt(rfrom, 10);\n      sServObj.spectroSettings.rangeTo = parseInt(rto, 10);\n      sServObj.spectroSettings.dynamicRange = parseInt(dyn, 10);\n      sServObj.setWindowFunction(win);\n      sServObj.spectroSettings.drawHeatMapColors = hm;\n      sServObj.spectroSettings.preEmphasisFilterFactor = preEmph;\n      sServObj.spectroSettings.heatMapColorAnchors = hmColorAnchors;\n    };\n    /**\n     * returns current selection as array\n     */\n    sServObj.getSelect = function () {\n      return [\n        sServObj.curViewPort.selectS,\n        sServObj.curViewPort.selectE\n      ];\n    };\n    /**\n     * set selected Area if new\n     * start value is smaler than actual and\n     * end value is greater than actual\n     * @param start of selected Area\n     * @param end of seleected Area\n     */\n    sServObj.selectDependent = function (start, end) {\n      if (start < this.curViewPort.selectS) {\n        this.curViewPort.selectS = start;\n      }\n      if (end > this.curViewPort.selectE) {\n        this.curViewPort.selectE = end;\n      }\n    };\n    /**\n     *\n     */\n    sServObj.selectLevel = function (next, order, Levelserv) {\n      var curLev;\n      var now = sServObj.getcurClickLevelName();\n      if (now === undefined && !next) {\n        // select first if none prev. defined (up)\n        // viewState.setcurClickLevel(levelID, levelType, scope.$index, scope.this.level.items.length);\n        curLev = Levelserv.getLevelDetails(order[0]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, 0);\n        return;\n      } else if (now === undefined && next) {\n        // select last if none prev. defined (down)\n        curLev = Levelserv.getLevelDetails(order[order.length - 1]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.length - 1);\n        return;\n      }\n      var idxOfNow;\n      order.forEach(function (name, idx) {\n        if (name === now) {\n          idxOfNow = idx;\n        }\n      });\n      if (idxOfNow === undefined) {\n        curLev = Levelserv.getLevelDetails(order[0]);\n        // sServObj.setcurClickLevelName(order[idxOfNow + 1]);\n        sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, 0);\n        sServObj.curClickItems = [];\n        sServObj.selectBoundary();\n      } else {\n        if (next) {\n          if (idxOfNow + 1 < order.length) {\n            curLev = Levelserv.getLevelDetails(order[idxOfNow + 1]);\n            // sServObj.setcurClickLevelName(order[idxOfNow + 1]);\n            sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.idxOfNow + 1);\n            sServObj.curClickItems = [];\n            sServObj.selectBoundary();  //sServObj.resetSelect();\n          }\n        } else {\n          if (idxOfNow - 1 >= 0) {\n            curLev = Levelserv.getLevelDetails(order[idxOfNow - 1]);\n            // sServObj.setcurClickLevelName(order[idxOfNow - 1]);\n            sServObj.setcurClickLevel(curLev.level.name, curLev.level.type, order.idxOfNow - 1);\n            sServObj.curClickItems = [];\n            sServObj.selectBoundary();  //sServObj.resetSelect();\n          }\n        }\n      }\n    };\n    /**\n     * set the window Function for the Spectrogram\n     * @param name of Window Function\n     */\n    sServObj.setWindowFunction = function (name) {\n      switch (name) {\n      case 'BARTLETT':\n        sServObj.spectroSettings.window = myWindow.BARTLETT;\n        break;\n      case 'BARTLETTHANN':\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      case 'BLACKMAN':\n        sServObj.spectroSettings.window = myWindow.BLACKMAN;\n        break;\n      case 'COSINE':\n        sServObj.spectroSettings.window = myWindow.COSINE;\n        break;\n      case 'GAUSS':\n        sServObj.spectroSettings.window = myWindow.GAUSS;\n        break;\n      case 'HAMMING':\n        sServObj.spectroSettings.window = myWindow.HAMMING;\n        break;\n      case 'HANN':\n        sServObj.spectroSettings.window = myWindow.HANN;\n        break;\n      case 'LANCZOS':\n        sServObj.spectroSettings.window = myWindow.LANCZOS;\n        break;\n      case 'RECTANGULAR':\n        sServObj.spectroSettings.window = myWindow.RECTANGULAR;\n        break;\n      case 'TRIANGULAR':\n        sServObj.spectroSettings.window = myWindow.TRIANGULAR;\n        break;\n      default:\n        sServObj.spectroSettings.window = myWindow.BARTLETTHANN;\n        break;\n      }\n    };\n    /**\n     * @returns myWindow object\n     */\n    sServObj.getWindowFunctions = function () {\n      return myWindow;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarActive = function () {\n      return this.curViewPort.dragBarActive;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarActive = function (b) {\n      this.curViewPort.dragBarActive = b;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.getdragBarHeight = function () {\n      return this.curViewPort.dragBarHeight;\n    };\n    /**\n     * set if user is dragging dragbar\n     */\n    sServObj.setdragBarHeight = function (b) {\n      this.curViewPort.dragBarHeight = b;\n    };\n    /**\n     * get pixel position in current viewport given the canvas width\n     * @param w is width of canvas\n     * @param s is current sample to convert to pixel value\n     */\n    sServObj.getPos = function (w, s) {\n      return w * (s - this.curViewPort.sS) / (this.curViewPort.eS - this.curViewPort.sS + 1);  // + 1 because of view (displays all samples in view)\n    };\n    /**\n     * calculate the pixel distance between two samples\n     * @param w is width of canvas\n     */\n    sServObj.getSampleDist = function (w) {\n      return this.getPos(w, this.curViewPort.sS + 1) - this.getPos(w, this.curViewPort.sS);\n    };\n    /**\n     * toggle boolean if left submenu is open\n     */\n    sServObj.togglesubmenuOpen = function (time) {\n      this.submenuOpen = !this.submenuOpen;\n    };\n    /**\n     * get boolean if left submenu is open\n     */\n    sServObj.getsubmenuOpen = function () {\n      return this.submenuOpen;\n    };\n    /**\n     * set boolean if left submenu is open\n     */\n    sServObj.setsubmenuOpen = function (s) {\n      this.submenuOpen = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setenlarge = function (s) {\n      this.timelineSize = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getenlarge = function () {\n      return this.timelineSize;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getTransitionTime = function () {\n      return this.TransitionTime;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setTransitionTime = function (s) {\n      this.TransitionTime = s;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.getRightsubmenuOpen = function () {\n      return this.rightSubmenuOpen;\n    };\n    /**\n     * get the height of the osci\n     */\n    sServObj.setRightsubmenuOpen = function (s) {\n      this.rightSubmenuOpen = s;\n    };\n    /**\n     *\n     */\n    sServObj.setcurClickLevel = function (levelID, levelType, levelIndex) {\n      this.setcurClickLevelName(levelID, levelIndex);\n      this.setcurClickLevelType(levelType);\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelType = function (name) {\n      this.curClickLevelType = name;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelType = function () {\n      return this.curClickLevelType;\n    };\n    /**\n     * sets the current (clicked) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurClickLevelName = function (name, index) {\n      this.curClickLevelName = name;\n      this.curClickLevelIndex = index;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelName = function () {\n      return this.curClickLevelName;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickLevelIndex = function () {\n      return this.curClickLevelIndex;\n    };\n    /**\n     * gets the current (clicked) Level Name\n     */\n    sServObj.getcurClickNeighbours = function () {\n      return this.curClickNeighbours;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelName = function (name) {\n      this.curMouseLevelName = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelName = function () {\n      return this.curMouseLevelName;\n    };\n    /**\n     * sets the current (mousemove) Level Name\n     * @param name is name of level\n     */\n    sServObj.setcurMouseLevelType = function (name) {\n      this.curMouseLevelType = name;\n    };\n    /**\n     * gets the current (mousemove) Level Name\n     */\n    sServObj.getcurMouseLevelType = function () {\n      return this.curMouseLevelType;\n    };\n    /**\n     * sets the current (mousemove) Item\n     * @param item Object representing the current mouse item\n     * @param neighbour Objects of left and right neighbours of the current mouse item\n     * @param x current horizontal mouse pointer position\n     * @param isFirst true if item is the first item on current level\n     * @param isLast true if item is last item on current level\n     */\n    sServObj.setcurMouseItem = function (item, neighbour, x, isFirst, isLast) {\n      this.curMouseItem = item;\n      this.curMouseX = x;\n      this.curMouseNeighbours = neighbour;\n      this.curMouseisFirst = isFirst;\n      this.curMouseisLast = isLast;\n    };\n    /**\n     * Getter for current Mouse Item\n     * @return Object representing the current mouse item\n     */\n    sServObj.getcurMouseItem = function () {\n      return this.curMouseItem;\n    };\n    /**\n     * Getter for isFirst\n     * @return true if item is first item on level\n     */\n    sServObj.getcurMouseisFirst = function () {\n      return this.curMouseisFirst;\n    };\n    /**\n     * Getter for isLast\n     * @return true if item is last item on level\n     */\n    sServObj.getcurMouseisLast = function () {\n      return this.curMouseisLast;\n    };\n    /**\n     * Getter for current Mouse Item Neighbours (left and right)\n     * @return Object representing the current mouse item neighbours\n     */\n    sServObj.getcurMouseNeighbours = function () {\n      return this.curMouseNeighbours;\n    };\n    /**\n     * selects all Segements on current level which are inside the selected viewport\n     * @param levelData current level Object\n     */\n    sServObj.selectItemsInSelection = function (levelData) {\n      sServObj.curClickItems = [];\n      var min = Infinity;\n      var max = -Infinity;\n      var itemInSel = this.getItemsInSelection(levelData);\n      angular.forEach(itemInSel, function (item) {\n        if (item.sampleStart < min) {\n          min = item.sampleStart;\n        }\n        if (item.sampleStart + item.sampleDur + 1 > max) {\n          max = item.sampleStart + item.sampleDur + 1;\n        }\n        sServObj.setcurClickItemMultiple(item);\n      });\n      sServObj.curViewPort.selectS = min;\n      sServObj.curViewPort.selectE = max;\n    };\n    /**\n     * get all items of current level which are inside the selected viewport\n     */\n    sServObj.getItemsInSelection = function (levelData) {\n      var itemsInRange = [];\n      var rangeStart = sServObj.curViewPort.selectS;\n      var rangeEnd = sServObj.curViewPort.selectE;\n      angular.forEach(levelData, function (t) {\n        if (t.name === sServObj.getcurClickLevelName()) {\n          angular.forEach(t.items, function (item) {\n            if (item.sampleStart >= rangeStart && item.sampleStart + item.sampleDur <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n            if (item.samplePoint >= rangeStart && item.samplePoint <= rangeEnd) {\n              itemsInRange.push(item);\n            }\n          });\n        }\n      });\n      return itemsInRange;\n    };\n    /**\n     * Setter for the current (click) Item\n     * @param item Object representing the currently clicked item\n     */\n    sServObj.setcurClickItem = function (item) {\n      if (item !== null && item !== undefined) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n        sServObj.selectBoundary();\n      } else {\n        sServObj.curClickItems = [];\n      }\n    };\n    /**\n     * Selects the current Boundary\n     */\n    sServObj.selectBoundary = function () {\n      if (sServObj.curClickItems.length > 0) {\n        var left, right;\n        if (sServObj.curClickItems[0].sampleStart !== undefined) {\n          left = sServObj.curClickItems[0].sampleStart;\n        } else {\n          left = sServObj.curClickItems[0].samplePoint;\n        }\n        right = sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleStart + sServObj.curClickItems[sServObj.curClickItems.length - 1].sampleDur || sServObj.curClickItems[0].samplePoint;\n        sServObj.curClickItems.forEach(function (entry) {\n          if (entry.sampleStart <= left) {\n            left = entry.sampleStart;\n          }\n          if (entry.sampleStart + entry.sampleDur >= right) {\n            right = entry.sampleStart + entry.sampleDur;\n          }\n        });\n        sServObj.select(left, right + 1);\n      }\n    };\n    /**\n     * adds a item the currently selected items if left or right of current selected items\n     * @param item representing the Object to be added to selection\n     */\n    sServObj.setcurClickItemMultiple = function (item) {\n      var empty = true;\n      var start = item.sampleStart;\n      var end = start + item.sampleDur + 1;\n      sServObj.curClickItems.forEach(function (entry) {\n        var front = entry.sampleStart === end ? true : false;\n        var back = entry.sampleStart + entry.sampleDur + 1 === start ? true : false;\n        if ((front || back) && sServObj.curClickItems.indexOf(item) === -1) {\n          sServObj.curClickItems.push(item);\n          empty = false;\n        }\n      });\n      if (empty) {\n        sServObj.curClickItems = [];\n        sServObj.curClickItems.push(item);\n      } else {\n        sServObj.curClickItems.sort(sServObj.sortbyid);\n      }\n    };\n    /**\n     *\n     */\n    sServObj.sortbyid = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.sampleStart > b.sampleStart) {\n        return 1;\n      }\n      if (a.sampleStart < b.sampleStart) {\n        return -1;\n      }\n      return 0;\n    };\n    /**\n     * Getter for the current selected range in samples\n     * if nothing is selected returns -1\n     * @return Object with Start and End values in samples\n     */\n    sServObj.getselectedRange = function () {\n      if (this.curClickItems.length > 1) {\n        return {\n          start: this.curClickItems[0].sampleStart,\n          end: this.curClickItems[this.curClickItems.length - 1].sampleStart + this.curClickItems[this.curClickItems.length - 1].sampleDur\n        };\n      } else if (this.curClickItems.length === 1) {\n        if (this.curClickItems[0].sampleStart !== undefined) {\n          return {\n            start: this.curClickItems[0].sampleStart,\n            end: this.curClickItems[0].sampleStart + this.curClickItems[0].sampleDur\n          };\n        } else {\n          return {\n            start: this.curClickItems[0].samplePoint,\n            end: this.curClickItems[0].samplePoint\n          };\n        }\n      } else {\n        return {\n          start: -1,\n          end: -1\n        };\n      }\n    };\n    /**\n     * Getter for the currently (clicked) items\n     */\n    sServObj.getcurClickItems = function () {\n      return this.curClickItems;\n    };\n    /**\n     *\n     */\n    sServObj.getselected = function () {\n      return this.curClickItems;\n    };\n    /**\n     *\n     */\n    sServObj.isEditing = function () {\n      return this.editing;\n    };\n    /**\n     *\n     */\n    sServObj.setEditing = function (n) {\n      this.editing = n;\n    };\n    /**\n     *\n     */\n    sServObj.getLasPcm = function () {\n      return this.lastPcm;\n    };\n    /**\n     *\n     */\n    sServObj.setLastPcm = function (n) {\n      this.lastPcm = n;\n    };\n    /**\n     *\n     */\n    sServObj.isHierarchyRotated = function () {\n      return sServObj.hierarchyRotated;\n    };\n    /**\n     *\n     */\n    sServObj.rotateHierarchy = function () {\n      sServObj.hierarchyRotated = !sServObj.hierarchyRotated;\n    };\n    /**\n     *\n     */\n    sServObj.toggleHierarchy = function () {\n      sServObj.hierarchyShown = !sServObj.hierarchyShown;\n    };\n    /**\n     *\n     */\n    sServObj.getcursorInTextField = function () {\n      return this.cursorInTextField;\n    };\n    /**\n     *\n     */\n    sServObj.setcursorInTextField = function (n) {\n      this.cursorInTextField = n;\n    };\n    /**\n     *\n     */\n    sServObj.isSavingAllowed = function () {\n      return this.saving;\n    };\n    /**\n     *\n     */\n    sServObj.setSavingAllowed = function (n) {\n      this.saving = n;\n    };\n    /**\n     *\n     */\n    sServObj.countSelected = function () {\n      return this.curClickItems.length;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentSample = function (perc) {\n      return this.curViewPort.sS + (this.curViewPort.eS - this.curViewPort.sS) * perc;\n    };\n    /**\n     *\n     */\n    sServObj.getCurrentPercent = function (sample) {\n      return sample * (100 / (this.curViewPort.eS - this.curViewPort.sS) / 100);\n    };\n    /**\n     *\n     */\n    sServObj.getSamplesPerPixelVal = function (event) {\n      var start = parseFloat(this.curViewPort.sS);\n      var end = parseFloat(this.curViewPort.eS);\n      return (end - start) / event.originalEvent.target.width;\n    };\n    /**\n     * round to n decimal digits after the comma\n     * used to help display numbers with a given\n     * precision\n     */\n    sServObj.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        console.error('error in call of round function!!');\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return parseFloat(k.substring(0, k.indexOf('.') + n + 1));\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getViewPortStartTime = function () {\n      return this.curViewPort.sS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getViewPortEndTime = function () {\n      return this.curViewPort.eS * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns start in secs\n     */\n    sServObj.getSelectedStartTime = function () {\n      return this.curViewPort.selectS * 1 / Soundhandlerservice.wavJSO.SampleRate - 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * calcs and returns end time in secs\n     */\n    sServObj.getSelectedEndTime = function () {\n      return this.curViewPort.selectE * 1 / Soundhandlerservice.wavJSO.SampleRate + 0.5 / Soundhandlerservice.wavJSO.SampleRate;\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param sSample start sample of view\n     * @param sSample end sample of view\n     */\n    sServObj.setViewPort = function (sSample, eSample) {\n      var oldStart = this.curViewPort.sS;\n      var oldEnd = this.curViewPort.eS;\n      if (sSample !== undefined) {\n        this.curViewPort.sS = Math.round(sSample);\n      }\n      if (eSample !== undefined) {\n        this.curViewPort.eS = Math.round(eSample);\n      }\n      // check if moving left or right is not out of bounds -> prevent zooming on edge when moving left/right\n      if (oldStart > this.curViewPort.sS && oldEnd > this.curViewPort.eS) {\n        //moved left\n        if (this.curViewPort.sS < 0) {\n          this.curViewPort.sS = 0;\n          this.curViewPort.eS = oldEnd + Math.abs(this.curViewPort.sS);\n        }\n      }\n      if (oldStart < this.curViewPort.sS && oldEnd < this.curViewPort.eS) {\n        //moved right\n        if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n          this.curViewPort.sS = oldStart;\n          this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n        }\n      }\n      // check if in range\n      if (this.curViewPort.sS < 0) {\n        this.curViewPort.sS = 0;\n      }\n      if (this.curViewPort.eS > Soundhandlerservice.wavJSO.Data.length) {\n        this.curViewPort.eS = Soundhandlerservice.wavJSO.Data.length;\n      }\n      // check if at least 4 samples are showing (fixed max zoom size)\n      if (this.curViewPort.eS - this.curViewPort.sS < 4) {\n        this.curViewPort.sS = oldStart;\n        this.curViewPort.eS = oldEnd;\n      }\n    };\n    /**\n     * set view port to start and end sample\n     * (with several out-of-bounds like checks)\n     *\n     * @param zoomIn bool to specify zooming direction\n     * if set to true -> zoom in\n     * if set to false -> zoom out\n     */\n    sServObj.zoomViewPort = function (zoomIn, LevelService) {\n      var newStartS, newEndS, curMouseMoveItemStart;\n      var seg = this.getcurMouseItem();\n      var d = this.curViewPort.eS - this.curViewPort.sS;\n      var isLastSeg = false;\n      if (seg !== undefined) {\n        if (this.getcurMouseisFirst()) {\n          // before first element\n          seg = LevelService.getItemDetails(sServObj.getcurMouseLevelName(), 0);\n        } else if (this.getcurMouseisLast()) {\n          seg = LevelService.getLastItem(sServObj.getcurMouseLevelName());\n          isLastSeg = true;\n        }\n        if (this.getcurMouseLevelType() === 'SEGMENT') {\n          if (isLastSeg) {\n            curMouseMoveItemStart = seg.sampleStart + seg.sampleDur;\n          } else {\n            curMouseMoveItemStart = seg.sampleStart;\n          }\n        } else {\n          curMouseMoveItemStart = seg.samplePoint;\n        }\n        var d1 = curMouseMoveItemStart - this.curViewPort.sS;\n        var d2 = this.curViewPort.eS - curMouseMoveItemStart;\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + d1 * 0.5;\n          newEndS = this.curViewPort.eS - d2 * 0.5;\n        } else {\n          newStartS = this.curViewPort.sS - d1 * 0.5;\n          newEndS = this.curViewPort.eS + d2 * 0.5;\n        }\n      } else {\n        if (zoomIn) {\n          newStartS = this.curViewPort.sS + ~~(d / 4);\n          newEndS = this.curViewPort.eS - ~~(d / 4);\n        } else {\n          newStartS = this.curViewPort.sS - ~~(d / 4);\n          newEndS = this.curViewPort.eS + ~~(d / 4);\n        }\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * moves view port to the right or to the left\n     * without changing the zoom\n     *\n     * @param shiftRight bool to specify direction\n     * if set to true -> shift right\n     * if set to false -> shift left\n     */\n    sServObj.shiftViewPort = function (shiftRight) {\n      // my.removeLabelDoubleClick();\n      var newStartS, newEndS;\n      if (shiftRight) {\n        newStartS = this.curViewPort.sS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS + ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      } else {\n        newStartS = this.curViewPort.sS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n        newEndS = this.curViewPort.eS - ~~((this.curViewPort.eS - this.curViewPort.sS) / 4);\n      }\n      this.setViewPort(newStartS, newEndS);\n    };\n    /**\n     * sets all the curLevelAttrDefs array\n     * to hold the default attr. definitions\n     * which are the same as the level names\n     *\n     * @param levelDefs level definitions from the DBconfig\n     */\n    sServObj.setCurLevelAttrDefs = function (levelDefs) {\n      angular.forEach(levelDefs, function (ld) {\n        sServObj.curLevelAttrDefs.push({\n          'levelName': ld.name,\n          'curAttrDefName': ld.name\n        });\n      });\n    };\n    /**\n     * set the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @param newAttrDefName\n     */\n    sServObj.setCurAttrDef = function (levelName, newAttrDefName, index) {\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          ad.curAttrDefName = newAttrDefName;\n          ad.curAttrDefIndex = index;\n        }\n      });\n    };\n    /**\n     * get the current attribute definition name of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrDef = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          curAttrDef = ad.curAttrDefName;\n        }\n      });\n      return curAttrDef;\n    };\n    /**\n     * get the current attribute definition index of the\n     * given levelName\n     *\n     * @param levelName name of level\n     * @returns attrDefName\n     */\n    sServObj.getCurAttrIndex = function (levelName) {\n      var curAttrDef;\n      angular.forEach(sServObj.curLevelAttrDefs, function (ad) {\n        if (ad.levelName === levelName) {\n          if (ad.curAttrDefIndex === undefined) {\n            curAttrDef = 0;\n          } else {\n            curAttrDef = ad.curAttrDefIndex;\n          }\n        }\n      });\n      return curAttrDef;\n    };\n    sServObj.setlastKeyCode = function (e) {\n      this.lastKeyCode = e;\n    };\n    /**\n\t*\n\t*/\n    sServObj.getX = function (e) {\n      return (e.offsetX || e.originalEvent.layerX) * (e.originalEvent.target.width / e.originalEvent.target.clientWidth);\n    };\n    /**\n\t*\n\t*/\n    sServObj.getY = function (e) {\n      return (e.offsetY || e.originalEvent.layerY) * (e.originalEvent.target.height / e.originalEvent.target.clientHeight);\n    };\n    /**\n     *\n     */\n    sServObj.resetToInitState = function () {\n      sServObj.initialize();\n    };\n    /**\n     *\n     */\n    sServObj.getColorOfAnchor = function (val, anchorNr) {\n      var curStyle = {\n          'background-color': 'rgb(' + val[anchorNr][0] + ',' + val[anchorNr][1] + ',' + val[anchorNr][2] + ')',\n          'width': '10px',\n          'height': '10px'\n        };\n      return curStyle;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('trackMouseInLevel', [\n  'viewState',\n  'LevelService',\n  'ConfigProviderService',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, LevelService, ConfigProviderService, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      replace: true,\n      scope: {\n        levelName: '=',\n        levelType: '='\n      },\n      link: function (scope, element, attr) {\n        scope.lastEventClick = undefined;\n        scope.lastEventMove = undefined;\n        scope.lastNeighboursMove = undefined;\n        scope.lastPCM = undefined;\n        scope.curMouseSampleNrInView = undefined;\n        /////////////////////////////\n        // Bindings\n        //\n        element.bind('click', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastClick(event);\n        });\n        //\n        element.bind('contextmenu', function (event) {\n          event.preventDefault();\n          scope.setLastMove(event, true);\n          scope.setLastRightClick(event);\n        });\n        //\n        element.bind('dblclick', function (event) {\n          scope.setLastMove(event, true);\n          if (ConfigProviderService.vals.restrictions.editItemName) {\n            scope.setLastDblClick(event);\n          } else {\n            scope.setLastClick(event);\n          }\n        });\n        //\n        element.bind('mousemove', function (event) {\n          if (!viewState.getdragBarActive()) {\n            var moveLine = true;\n            var samplesPerPixel = viewState.getSamplesPerPixelVal(event);\n            scope.curMouseSampleNrInView = viewState.getX(event) * samplesPerPixel;\n            var moveBy = scope.curMouseSampleNrInView - scope.lastPCM;\n            if (samplesPerPixel <= 1) {\n              var zoomEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n              // absolute movement in pcm below 1 pcm per pixel\n              if (scope.levelType === 'SEGMENT') {\n                if (zoomEventMove.isFirst === true && zoomEventMove.isLast === false) {\n                  // before first elem\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemDetails(scope.levelName, 0).sampleStart);\n                } else if (zoomEventMove.isFirst === false && zoomEventMove.isLast === true) {\n                  // after last elem\n                  var lastItem = LevelService.getLastItem(scope.levelName);\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - lastItem.sampleStart - lastItem.sampleDur);\n                } else {\n                  moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).sampleStart);\n                }\n              } else {\n                moveBy = Math.ceil(scope.curMouseSampleNrInView + viewState.curViewPort.sS - LevelService.getItemFromLevelById(scope.levelName, zoomEventMove.nearest.id).samplePoint - 0.5);  // 0.5 to break between samples not on\n              }\n            } else {\n              // relative movement in pcm above 1 pcm per pixel\n              moveBy = Math.round(scope.curMouseSampleNrInView - scope.lastPCM);\n            }\n          }\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            //console.log('Left mouse button pressed');\n            break;\n          case 2:\n            //console.log('Middle mouse button pressed');\n            break;\n          case 3:\n            //console.log('Right mouse button pressed');\n            break;\n          default:\n            if (!viewState.getdragBarActive()) {\n              if (ConfigProviderService.vals.restrictions.editItemSize && event.shiftKey) {\n                LevelService.deleteEditArea();\n                var curMouseItem = viewState.getcurMouseItem();\n                if (curMouseItem !== undefined) {\n                  viewState.movingBoundary = true;\n                  if (scope.levelType === 'SEGMENT') {\n                    if (viewState.getcurMouseisFirst() || viewState.getcurMouseisLast()) {\n                      var seg, leftMost, rightB;\n                      // before first segment\n                      if (viewState.getcurMouseisFirst()) {\n                        seg = LevelService.getItemDetails(scope.levelName, 0);\n                        viewState.movingBoundarySample = seg.sampleStart + moveBy;\n                      } else if (viewState.getcurMouseisLast()) {\n                        seg = LevelService.getLastItem(scope.levelName);\n                        viewState.movingBoundarySample = seg.sampleStart + seg.sampleDur + moveBy;\n                      }\n                    } else {\n                      viewState.movingBoundarySample = curMouseItem.sampleStart + moveBy;\n                      seg = curMouseItem;\n                    }\n                    LevelService.moveBoundary(scope.levelName, seg.id, moveBy, viewState.getcurMouseisFirst(), viewState.getcurMouseisLast());\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEBOUNDARY',\n                      'name': scope.levelName,\n                      'id': seg.id,\n                      'movedBy': moveBy,\n                      'isFirst': viewState.getcurMouseisFirst(),\n                      'isLast': viewState.getcurMouseisLast()\n                    });\n                  } else {\n                    seg = curMouseItem;\n                    viewState.movingBoundarySample = curMouseItem.samplePoint + moveBy;\n                    LevelService.moveEvent(scope.levelName, seg.id, moveBy);\n                    HistoryService.updateCurChangeObj({\n                      'type': 'ANNOT',\n                      'action': 'MOVEEVENT',\n                      'name': scope.levelName,\n                      'id': seg.id,\n                      'movedBy': moveBy\n                    });\n                  }\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                  moveLine = false;\n                }\n              } else if (ConfigProviderService.vals.restrictions.editItemSize && event.altKey) {\n                LevelService.deleteEditArea();\n                if (scope.levelType == 'SEGMENT') {\n                  seg = viewState.getcurClickItems();\n                  LevelService.moveSegment(scope.levelName, seg[0].id, seg.length, moveBy);\n                  HistoryService.updateCurChangeObj({\n                    'type': 'ANNOT',\n                    'action': 'MOVESEGMENT',\n                    'name': scope.levelName,\n                    'id': seg[0].id,\n                    'length': seg.length,\n                    'movedBy': moveBy\n                  });\n                  scope.lastPCM = scope.curMouseSampleNrInView;\n                  viewState.setLastPcm(scope.lastPCM);\n                  viewState.selectBoundary();\n                }\n              } else {\n                viewState.movingBoundary = false;\n              }\n            }\n            break;\n          }\n          if (!viewState.getdragBarActive()) {\n            scope.setLastMove(event, moveLine);\n          }\n        });\n        //\n        element.bind('mousedown', function (event) {\n          viewState.movingBoundary = true;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseup', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        element.bind('mouseout', function (event) {\n          viewState.movingBoundary = false;\n          scope.setLastMove(event, true);\n        });\n        //\n        /////////////////////////\n        /**\n         *\n         */\n        scope.setLastClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          viewState.setEditing(false);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n            LevelService.setlasteditAreaElem(element.parent());\n            viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n            viewState.setcurClickItem(scope.lastEventClick.current);\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastRightClick = function (x) {\n          if (viewState.getcurClickLevelName() !== scope.levelName) {\n            scope.setLastClick(x);\n          }\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          LevelService.deleteEditArea();\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n            viewState.setcurClickItemMultiple(scope.lastEventClick.current);\n            viewState.selectBoundary();\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastDblClick = function (x) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventClick = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (scope.lastEventClick.current !== undefined && scope.lastEventClick.nearest !== undefined) {\n            if (scope.levelType === 'SEGMENT') {\n              if (scope.lastEventClick.current.sampleStart >= viewState.curViewPort.sS) {\n                if (scope.lastEventClick.current.sampleStart + scope.lastEventClick.current.sampleDur <= viewState.curViewPort.eS) {\n                  viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n                  viewState.setcurClickItem(scope.lastEventClick.current);\n                  LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n                  LevelService.setlasteditAreaElem(element.parent());\n                  viewState.setEditing(true);\n                  LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n                } else {\n                  console.log('Editing out of right bound !');\n                }\n              } else {\n                console.log('Editing out of left bound !');\n              }\n            } else {\n              viewState.setcurClickLevel(scope.levelName, scope.levelType, scope.$index);\n              viewState.setcurClickItem(scope.lastEventClick.current);\n              LevelService.setlasteditArea('_' + scope.lastEventClick.current.id);\n              LevelService.setlasteditAreaElem(element.parent());\n              viewState.setEditing(true);\n              LevelService.openEditArea(scope.lastEventClick.current, element.parent(), scope.levelType);\n              viewState.setEditing(true);\n            }\n          }\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n        /**\n         *\n         */\n        scope.setLastMove = function (x, doChange) {\n          scope.curMouseSampleNrInView = viewState.getX(x) * viewState.getSamplesPerPixelVal(x);\n          scope.lastEventMove = LevelService.getClosestItem(scope.curMouseSampleNrInView + viewState.curViewPort.sS, scope.levelName, Soundhandlerservice.wavJSO.Data.length);\n          if (doChange) {\n            if (scope.lastEventMove.current !== undefined && scope.lastEventMove.nearest !== undefined) {\n              scope.lastNeighboursMove = LevelService.getItemNeighboursFromLevel(scope.levelName, scope.lastEventMove.nearest.id, scope.lastEventMove.nearest.id);\n              viewState.setcurMouseItem(scope.lastEventMove.nearest, scope.lastNeighboursMove, scope.lastPCM, scope.lastEventMove.isFirst, scope.lastEventMove.isLast);\n            }\n          }\n          viewState.setcurMouseLevelName(scope.levelName);\n          viewState.setcurMouseLevelType(scope.levelType);\n          scope.lastPCM = scope.curMouseSampleNrInView;\n          viewState.setLastPcm(scope.lastPCM);\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('handleglobalkeystrokes', [\n  '$timeout',\n  'viewState',\n  'modalService',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  'HistoryService',\n  'LevelService',\n  'DataService',\n  'LinkService',\n  'AnagestService',\n  function ($timeout, viewState, modalService, Soundhandlerservice, ConfigProviderService, HistoryService, LevelService, DataService, LinkService, AnagestService) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element) {\n        $(document).bind('keyup', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          if (viewState.isEditing() && !viewState.getcursorInTextField()) {\n            scope.applyKeyCodeUp(code, e);\n          }\n        });\n        $(document).bind('keydown', function (e) {\n          if (!scope.firefox) {\n            var code = e.keyCode ? e.keyCode : e.which;\n            if (code == 8 || code == 9 || code == 27 || code == 37 || code == 38 || code == 39 || code == 40 || code == 32) {\n              scope.applyKeyCode(code, e);\n            }\n          }\n        });\n        $(document).bind('keypress', function (e) {\n          var code = e.keyCode ? e.keyCode : e.which;\n          scope.applyKeyCode(code, e);\n        });\n        scope.applyKeyCodeUp = function (code, e) {\n          scope.$apply(function () {\n            if (code !== ConfigProviderService.vals.keyMappings.esc && code !== ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              var str = domElement.val();\n              viewState.setSavingAllowed(true);\n              var curAttrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n              var lvlDefs = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n              var definitions = {};\n              if (lvlDefs.attributeDefinitions !== undefined && lvlDefs.attributeDefinitions.length > 0) {\n                definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[curAttrIndex];\n              }\n              // if it is defined then check if characters are ok\n              if (definitions.legalLabels !== undefined && str.length > 0) {\n                if (definitions.legalLabels.indexOf(str) < 0) {\n                  viewState.setSavingAllowed(false);\n                }\n              }\n              if (viewState.isSavingAllowed()) {\n                domElement.css({ 'background-color': 'rgba(255,255,0,1)' });\n              } else {\n                domElement.css({ 'background-color': 'rgba(255,0,0,1)' });\n              }\n            }\n          });\n        };\n        scope.applyKeyCode = function (code, e) {\n          scope.$apply(function () {\n            // check if mouse has to be in labeler for key mappings\n            if (ConfigProviderService.vals.main.catchMouseForKeyBinding) {\n              if (!viewState.mouseInEmuWebApp) {\n                return;\n              }\n            }\n            viewState.setlastKeyCode(code);\n            if (viewState.isEditing()) {\n              var domElement = $('.' + LevelService.getlasteditArea());\n              // preventing new line if saving not allowed\n              if (!viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var definitions = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).attributeDefinitions[viewState.getCurAttrIndex(viewState.getcurClickLevelName())].legalLabels;\n                e.preventDefault();\n                e.stopPropagation();\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                modalService.open('views/error.html', 'Editing Error: Sorry, characters allowed on this Level are \"' + JSON.stringify(definitions) + '\"');\n              }\n              // save text on enter if saving is allowed\n              if (viewState.isSavingAllowed() && code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                var editingElement = LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID());\n                var attrIndex = viewState.getCurAttrIndex(viewState.getcurClickLevelName());\n                var oldValue = '';\n                if (editingElement.labels[attrIndex] !== undefined) {\n                  oldValue = editingElement.labels[attrIndex].value;\n                }\n                LevelService.renameLabel(viewState.getcurClickLevelName(), LevelService.getlastID(), viewState.getCurAttrIndex(viewState.getcurClickLevelName()), domElement.val());\n                HistoryService.addObjToUndoStack({\n                  'type': 'ANNOT',\n                  'action': 'RENAMELABEL',\n                  'name': viewState.getcurClickLevelName(),\n                  'id': LevelService.getlastID(),\n                  'attrIndex': attrIndex,\n                  'oldValue': oldValue,\n                  'newValue': domElement.val()\n                });\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n                viewState.setcurClickItem(LevelService.getItemFromLevelById(viewState.getcurClickLevelName(), LevelService.getlastID()));\n              }\n              // escape from text if esc\n              if (code === ConfigProviderService.vals.keyMappings.esc) {\n                LevelService.deleteEditArea();\n                viewState.setEditing(false);\n              }\n            } else if (viewState.getcursorInTextField() === false) {\n              LevelService.deleteEditArea();\n              // escape from open modal dialog\n              if (viewState.curState.permittedActions.length === 0 && code === ConfigProviderService.vals.keyMappings.esc && modalService.force === false) {\n                if (viewState.hierarchyShown) {\n                  modalService.close();\n                }\n              }\n              // delegate keyboard keyMappings according to keyMappings of scope\n              // showHierarhy\n              if (code === ConfigProviderService.vals.keyMappings.showHierarhy) {\n                if (viewState.curState !== viewState.states.noDBorFilesloaded) {\n                  if (viewState.hierarchyShown) {\n                    modalService.close();\n                  } else {\n                    viewState.toggleHierarchy();\n                    modalService.open('views/showHierarchyModal.html');\n                  }\n                }\n              }\n              // rotateHierarhy\n              if (code === ConfigProviderService.vals.keyMappings.rotateHierarhy) {\n                viewState.rotateHierarchy();\n              }\n              // zoomAll\n              if (code === ConfigProviderService.vals.keyMappings.zoomAll) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(0, Soundhandlerservice.wavJSO.Data.length);\n                } else {\n                }\n              }\n              // zoomIn\n              if (code === ConfigProviderService.vals.keyMappings.zoomIn) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(true, LevelService);\n                } else {\n                }\n              }\n              // zoomOut\n              if (code === ConfigProviderService.vals.keyMappings.zoomOut) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.zoomViewPort(false, LevelService);\n                } else {\n                }\n              }\n              // zoomSel\n              if (code === ConfigProviderService.vals.keyMappings.zoomSel) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.setViewPort(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                } else {\n                }\n              }\n              // shiftViewPortLeft\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortLeft) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(false);\n                } else {\n                }\n              }\n              // shiftViewPortRight\n              if (code === ConfigProviderService.vals.keyMappings.shiftViewPortRight) {\n                if (viewState.getPermission('zoom')) {\n                  viewState.shiftViewPort(true);\n                } else {\n                }\n              }\n              // playEntireFile\n              if (code === ConfigProviderService.vals.keyMappings.playEntireFile) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(0, Soundhandlerservice.wavJSO.Data.length);\n                    viewState.animatePlayHead(0, Soundhandlerservice.wavJSO.Data.length);\n                  }\n                } else {\n                }\n              }\n              // playAllInView\n              if (code === ConfigProviderService.vals.keyMappings.playAllInView) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                    viewState.animatePlayHead(viewState.curViewPort.sS, viewState.curViewPort.eS);\n                  }\n                } else {\n                }\n              }\n              // playSelected\n              if (code === ConfigProviderService.vals.keyMappings.playSelected) {\n                if (viewState.getPermission('playaudio')) {\n                  if (ConfigProviderService.vals.restrictions.playback) {\n                    Soundhandlerservice.playFromTo(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                    viewState.animatePlayHead(viewState.curViewPort.selectS, viewState.curViewPort.selectE);\n                  }\n                } else {\n                }\n              }\n              // selectFirstContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFirstContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 1;\n                  }\n                }\n              }\n              // selectSecondContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectSecondContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 2;\n                  }\n                }\n              }\n              // selectThirdContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectThirdContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 3;\n                  }\n                }\n              }\n              // selectFourthContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectFourthContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = 4;\n                  }\n                }\n              }\n              // selectNOContourCorrectionTool\n              if (code === ConfigProviderService.vals.keyMappings.selectNoContourCorrectionTool) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.correctionTool) {\n                    viewState.curCorrectionToolNr = undefined;\n                  }\n                }\n              }\n              // levelUp\n              if (code === ConfigProviderService.vals.keyMappings.levelUp) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(false, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass in LevelService to prevent circular deps\n                }\n              }\n              // levelDown\n              if (code === ConfigProviderService.vals.keyMappings.levelDown) {\n                if (viewState.getPermission('labelAction')) {\n                  viewState.selectLevel(true, ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order, LevelService);  // pass LevelService to prevent circular deps\n                }\n              }\n              // preselected boundary snap to top\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestTopBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(true, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist === false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary snap to bottom\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestBottomBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var mouseSeg = viewState.getcurMouseItem();\n                    var levelName = viewState.getcurMouseLevelName();\n                    var levelType = viewState.getcurMouseLevelType();\n                    var neighbor = viewState.getcurMouseNeighbours();\n                    var minDist = LevelService.snapBoundary(false, levelName, mouseSeg, neighbor, levelType);\n                    if (minDist == false) {\n                    } else {\n                      if (levelType === 'EVENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEEVENT',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist\n                        });\n                      } else if (levelType === 'SEGMENT') {\n                        HistoryService.updateCurChangeObj({\n                          'type': 'ANNOT',\n                          'action': 'MOVEBOUNDARY',\n                          'name': levelName,\n                          'id': mouseSeg.id,\n                          'movedBy': minDist,\n                          'position': 0\n                        });\n                      }\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // preselected boundary to nearest zero crossing\n              if (code === ConfigProviderService.vals.keyMappings.snapBoundaryToNearestZeroCrossing) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    var dist;\n                    if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().sampleStart);\n                    } else {\n                      dist = LevelService.calcDistanceToNearestZeroCrossing(viewState.getcurMouseItem().samplePoint);\n                    }\n                    if (dist !== 0) {\n                      var seg = viewState.getcurMouseItem();\n                      var neigh = viewState.getcurMouseNeighbours();\n                      var levelname = viewState.getcurMouseLevelName();\n                      LevelService.moveBoundary(levelname, seg.id, dist, 0);\n                      HistoryService.updateCurChangeObj({\n                        'type': 'ANNOT',\n                        'action': 'MOVEBOUNDARY',\n                        'name': levelname,\n                        'id': seg.id,\n                        'movedBy': dist,\n                        'position': 0\n                      });\n                      HistoryService.addCurChangeObjToUndoStack();\n                    }\n                  }\n                }\n              }\n              // expand Segments\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // expand Segment left\n              if (code === ConfigProviderService.vals.keyMappings.expandSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Left\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsLeft) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(true, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': true,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // shrink Segments Right\n              if (code === ConfigProviderService.vals.keyMappings.shrinkSelSegmentsRight) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.editItemSize) {\n                    if (viewState.getcurClickLevelName() === undefined) {\n                      modalService.open('views/error.html', 'Expand Segments Error: Please select a Level first');\n                    } else {\n                      if (viewState.getselected().length === 0) {\n                        modalService.open('views/error.html', 'Expand Segments Error: Please select one or more Segments first');\n                      } else {\n                        if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'absolute') {\n                          var changeTime = parseInt(ConfigProviderService.vals.labelCanvasConfig.addTimeValue, 10);\n                        } else if (ConfigProviderService.vals.labelCanvasConfig.addTimeMode === 'relative') {\n                          var changeTime = ConfigProviderService.vals.labelCanvasConfig.addTimeValue * (Soundhandlerservice.wavJSO.Data.length / 100);\n                        } else {\n                          modalService.open('views/error.html', 'Expand Segements Error: Error in Configuration (Value labelCanvasConfig.addTimeMode)');\n                        }\n                        LevelService.expandSegment(false, viewState.getcurClickItems(), viewState.getcurClickLevelName(), -changeTime);\n                        HistoryService.addObjToUndoStack({\n                          'type': 'ANNOT',\n                          'action': 'EXPANDSEGMENTS',\n                          'name': viewState.getcurClickLevelName(),\n                          'item': viewState.getcurClickItems(),\n                          'rightSide': false,\n                          'changeTime': -changeTime\n                        });\n                        viewState.selectBoundary();\n                      }\n                    }\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarLeft) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.togglesubmenuOpen(ConfigProviderService.vals.colors.transitionTime);\n                  }\n                }\n              }\n              // toggleSideBars\n              if (code === ConfigProviderService.vals.keyMappings.toggleSideBarRight) {\n                if (viewState.getPermission('toggleSideBars')) {\n                  // check if menu button in showing -> if not -> no submenu open\n                  if (ConfigProviderService.vals.activeButtons.openMenu) {\n                    viewState.setRightsubmenuOpen(!viewState.getRightsubmenuOpen());\n                  }\n                }\n              }\n              // select Segments in viewport selection\n              if (code === ConfigProviderService.vals.keyMappings.selectItemsInSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickLevelName() === undefined) {\n                    modalService.open('views/error.html', 'Selection Error : Please select a Level first');\n                  } else {\n                    viewState.selectItemsInSelection(DataService.data.levels);\n                  }\n                }\n              }\n              // selPrevItem (arrow key left)\n              if (code === ConfigProviderService.vals.keyMappings.selPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.left !== undefined) {\n                      if (lastNeighboursMove.left.sampleStart !== undefined) {\n                        // check if in view\n                        if (lastNeighboursMove.left.sampleStart > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      } else {\n                        // check if in view\n                        if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                          if (e.shiftKey) {\n                            // select multiple while shift\n                            viewState.setcurClickItemMultiple(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                            viewState.selectBoundary();\n                          } else {\n                            viewState.setcurClickItem(lastNeighboursMove.left);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // selNextItem (arrow key right)\n              if (code === ConfigProviderService.vals.keyMappings.selNextItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (lastNeighboursMove.right !== undefined) {\n                      // check if in view\n                      if (lastNeighboursMove.right.sampleStart + lastNeighboursMove.right.sampleDur < viewState.curViewPort.eS) {\n                        if (e.shiftKey) {\n                          // select multiple while shift\n                          viewState.setcurClickItemMultiple(lastNeighboursMove.right);\n                          LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          viewState.selectBoundary();\n                        } else {\n                          viewState.setcurClickItem(lastNeighboursMove.right);\n                          LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                        }\n                      }\n                    } else {\n                    }\n                  }\n                }\n              }\n              // selNextPrevItem (tab key and tab+shift key)\n              if (code === ConfigProviderService.vals.keyMappings.selNextPrevItem) {\n                if (viewState.getPermission('labelAction')) {\n                  if (viewState.getcurClickItems().length > 0) {\n                    var idLeft = viewState.getcurClickItems()[0].id;\n                    var idRight = viewState.getcurClickItems()[viewState.getcurClickItems().length - 1].id;\n                    var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(viewState.getcurClickLevelName(), idLeft, idRight);\n                    if (e.shiftKey) {\n                      if (lastNeighboursMove.left !== undefined) {\n                        if (lastNeighboursMove.left.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.left.sampleStart + lastNeighboursMove.left.sampleDur > viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.left.samplePoint > viewState.curViewPort.sS) {\n                            viewState.setcurClickItem(lastNeighboursMove.left, lastNeighboursMove.left.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.left.id);\n                          }\n                        }\n                      }\n                    } else {\n                      if (lastNeighboursMove.right !== undefined) {\n                        if (lastNeighboursMove.right.sampleStart !== undefined) {\n                          // check if in view\n                          if (lastNeighboursMove.right.sampleStart < viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right, lastNeighboursMove.right.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        } else {\n                          // check if in view\n                          if (lastNeighboursMove.right.samplePoint < viewState.curViewPort.eS) {\n                            viewState.setcurClickItem(lastNeighboursMove.right, lastNeighboursMove.right.id);\n                            LevelService.setlasteditArea('_' + lastNeighboursMove.right.id);\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              // createNewItemAtSelection\n              if (code === ConfigProviderService.vals.keyMappings.createNewItemAtSelection) {\n                if (viewState.getPermission('labelAction')) {\n                  if (ConfigProviderService.vals.restrictions.addItem) {\n                    if (viewState.getselectedRange().start === viewState.curViewPort.selectS && viewState.getselectedRange().end === viewState.curViewPort.selectE) {\n                      if (viewState.getcurClickItems().length === 1) {\n                        // check if in view\n                        if (viewState.getselectedRange().start >= viewState.curViewPort.sS && viewState.getselectedRange().end <= viewState.curViewPort.eS) {\n                          viewState.setEditing(true);\n                          LevelService.openEditArea(viewState.getcurClickItems()[0], LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                          scope.cursorInTextField();\n                        }\n                      } else {\n                        modalService.open('views/error.html', 'Modify Error: Please select a single Segment.');\n                      }\n                    } else {\n                      if (viewState.curViewPort.selectE == -1 && viewState.curViewPort.selectS == -1) {\n                        modalService.open('views/error.html', 'Error : Please select a Segment or Point to modify it\\'s name. Or select a level plus a range in the viewport in order to insert a new Segment.');\n                      } else {\n                        var seg = LevelService.getClosestItem(viewState.curViewPort.selectS, viewState.getcurClickLevelName(), Soundhandlerservice.wavJSO.Data.length).current;\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          if (seg === undefined) {\n                            var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                            if (!insSeg.ret) {\n                              modalService.open('views/error.html', 'Error : You are not allowed to insert a Segment here.');\n                            } else {\n                              HistoryService.addObjToUndoStack({\n                                'type': 'ANNOT',\n                                'action': 'INSERTSEGMENTS',\n                                'name': viewState.getcurClickLevelName(),\n                                'start': viewState.curViewPort.selectS,\n                                'end': viewState.curViewPort.selectE,\n                                'ids': insSeg.ids,\n                                'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                              });\n                            }\n                          } else {\n                            if (seg.sampleStart === viewState.curViewPort.selectS && seg.sampleStart + seg.sampleDur + 1 === viewState.curViewPort.selectE) {\n                              viewState.setcurClickLevel(viewState.getcurClickLevelName(), viewState.getcurClickLevelType(), scope.$index);\n                              viewState.setcurClickItem(seg.current);\n                              LevelService.setlasteditArea('_' + seg.id);\n                              LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                              viewState.setEditing(true);\n                            } else {\n                              var insSeg = LevelService.insertSegment(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, viewState.curViewPort.selectE, ConfigProviderService.vals.labelCanvasConfig.newSegmentName);\n                              if (!insSeg.ret) {\n                                modalService.open('views/error.html', 'Error : You are not allowed to insert a Segment here.');\n                              } else {\n                                HistoryService.addObjToUndoStack({\n                                  'type': 'ANNOT',\n                                  'action': 'INSERTSEGMENTS',\n                                  'name': viewState.getcurClickLevelName(),\n                                  'start': viewState.curViewPort.selectS,\n                                  'end': viewState.curViewPort.selectE,\n                                  'ids': insSeg.ids,\n                                  'segName': ConfigProviderService.vals.labelCanvasConfig.newSegmentName\n                                });\n                              }\n                            }\n                          }\n                        } else {\n                          var levelDef = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName());\n                          if (typeof levelDef.anagestConfig === 'undefined') {\n                            var insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), viewState.curViewPort.selectS, ConfigProviderService.vals.labelCanvasConfig.newEventName);\n                            if (insPoint.alreadyExists) {\n                              viewState.setcurClickLevel(viewState.getcurClickLevelName(), viewState.getcurClickLevelType(), scope.$index);\n                              viewState.setcurClickItem(seg.current);\n                              LevelService.setlasteditArea('_' + seg.id);\n                              LevelService.openEditArea(seg, LevelService.getlasteditAreaElem(), viewState.getcurClickLevelType());\n                              viewState.setEditing(true);\n                            } else {\n                              HistoryService.addObjToUndoStack({\n                                'type': 'ANNOT',\n                                'action': 'INSERTEVENT',\n                                'name': viewState.getcurClickLevelName(),\n                                'start': viewState.curViewPort.selectS,\n                                'id': insPoint.id,\n                                'pointName': ConfigProviderService.vals.labelCanvasConfig.newEventName\n                              });\n                            }\n                          } else {\n                            AnagestService.insertAnagestEvents();\n                          }\n                        }\n                      }\n                    }\n                  } else {\n                  }\n                }\n              }\n              // undo\n              if (code === ConfigProviderService.vals.keyMappings.undo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.undo();\n                }\n              }\n              // redo\n              if (code === ConfigProviderService.vals.keyMappings.redo) {\n                if (viewState.getPermission('labelAction')) {\n                  HistoryService.redo();\n                }\n              }\n              // deletePreselBoundary\n              if (code === ConfigProviderService.vals.keyMappings.deletePreselBoundary) {\n                if (viewState.getPermission('labelAction')) {\n                  e.preventDefault();\n                  var seg = viewState.getcurMouseItem();\n                  var cseg = viewState.getcurClickItems();\n                  var isFirst = viewState.getcurMouseisFirst();\n                  var isLast = viewState.getcurMouseisLast();\n                  var levelname = viewState.getcurMouseLevelName();\n                  var type = viewState.getcurMouseLevelType();\n                  if (!e.shiftKey) {\n                    if (ConfigProviderService.vals.restrictions.deleteItemBoundary) {\n                      if (seg !== undefined) {\n                        var neighbour = LevelService.getItemNeighboursFromLevel(levelname, seg.id, seg.id);\n                        if (type === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteBoundary(levelname, seg.id, isFirst, isLast);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETEBOUNDARY',\n                            'name': levelname,\n                            'id': seg.id,\n                            'isFirst': isFirst,\n                            'isLast': isLast,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks;\n                          if (neighbour.left !== undefined) {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, neighbour.left.id);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': neighbour.left.id,\n                              'deletedLinks': deletedLinks\n                            });\n                          } else {\n                            deletedLinks = LinkService.deleteLinkBoundary(seg.id, -1);\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETELINKBOUNDARY',\n                              'name': levelname,\n                              'id': seg.id,\n                              'neighbourId': -1,\n                              'deletedLinks': deletedLinks\n                            });\n                          }\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          var deletedPoint = LevelService.deleteEvent(levelname, seg.id);\n                          if (deletedPoint !== false) {\n                            HistoryService.updateCurChangeObj({\n                              'type': 'ANNOT',\n                              'action': 'DELETEEVENT',\n                              'name': levelname,\n                              'start': deletedPoint.samplePoint,\n                              'id': deletedPoint.id,\n                              'pointName': deletedPoint.labels[0].value\n                            });\n                            HistoryService.addCurChangeObjToUndoStack();\n                            var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                            if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                              var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                              viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                            }\n                          } else {\n                            viewState.setcurMouseItem(undefined, undefined, undefined, undefined, undefined);\n                          }\n                        }\n                      }\n                    }\n                  } else {\n                    if (ConfigProviderService.vals.restrictions.deleteItem) {\n                      if (cseg !== undefined && cseg.length > 0) {\n                        if (viewState.getcurClickLevelType() === 'SEGMENT') {\n                          var deletedSegment = LevelService.deleteSegments(levelname, cseg[0].id, cseg.length);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETESEGMENTS',\n                            'name': levelname,\n                            'id': cseg[0].id,\n                            'length': cseg.length,\n                            'deletedSegment': deletedSegment\n                          });\n                          var deletedLinks = LinkService.deleteLinkSegment(cseg);\n                          HistoryService.updateCurChangeObj({\n                            'type': 'ANNOT',\n                            'action': 'DELETELINKSEGMENT',\n                            'name': levelname,\n                            'segments': cseg,\n                            'deletedLinks': deletedLinks\n                          });\n                          HistoryService.addCurChangeObjToUndoStack();\n                          var lastEventMove = LevelService.getClosestItem(viewState.getLasPcm() + viewState.curViewPort.sS, levelname, Soundhandlerservice.wavJSO.Data.length);\n                          if (lastEventMove.current !== undefined && lastEventMove.nearest !== undefined) {\n                            var lastNeighboursMove = LevelService.getItemNeighboursFromLevel(levelName, lastEventMove.nearest.id, lastEventMove.nearest.id);\n                            viewState.setcurMouseItem(lastEventMove.nearest, lastNeighboursMove, viewState.getLasPcm(), lastEventMove.isFirst, lastEventMove.isLast);\n                          }\n                          viewState.setcurClickItem(deletedSegment.clickSeg);\n                        } else {\n                          modalService.open('views/error.html', 'Delete Error: You can not delete Segments on Point Levels.');\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              if (!e.metaKey && !e.ctrlKey) {\n                e.preventDefault();\n                e.stopPropagation();\n              }\n            }\n          });\n        };\n        scope.safeApply = function (fn) {\n          var phase = this.$root.$$phase;\n          if (phase == '$apply' || phase == '$digest') {\n            if (fn && typeof fn === 'function') {\n              fn();\n            }\n          } else {\n            this.$apply(fn);\n          }\n        };\n        //remove binding on destroy\n        scope.$on('$destroy', function () {\n          $(window).off('keydown');\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('delete', [\n  'modalService',\n  function (modalService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        var name = scope.level.name;\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(name, attr.delete);\n          modalService.open('views/deleteLevel.html', name);\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('resize', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element) {\n      var elem = element.parent().parent();\n      var elemHeight = 0;\n      var deleteButton = elem.find(element.parent().children()[0]);\n      var resizeButton = elem.find(element.parent().children()[1]);\n      var saveButton = elem.find(element.parent().children()[2]);\n      element.bind('click', function () {\n        if (scope.open) {\n          scope.open = false;\n          elemHeight = elem.css('height');\n          elem.css({ 'height': '30px' });\n          if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n            deleteButton.hide();\n          }\n          if (scope.cps.vals.activeButtons.saveSingleLevel) {\n            saveButton.hide();\n          }\n        } else {\n          scope.open = true;\n          elem.css({ 'height': elemHeight });\n          if (scope.cps.vals.activeButtons.deleteSingleLevel) {\n            deleteButton.show();\n          }\n          if (scope.cps.vals.activeButtons.saveSingleLevel) {\n            saveButton.show();\n          }\n        }\n        scope.updateView();\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('enlarge', [\n  '$rootScope',\n  'viewState',\n  'ConfigProviderService',\n  function ($rootScope, viewState, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attrs) {\n        scope.$watch('viewState.curPerspectiveIdx', function () {\n          if (!$.isEmptyObject(ConfigProviderService.vals.perspectives)) {\n            if (!$.isEmptyObject(viewState.curPerspectiveIdx)) {\n              if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.order.length === 1) {\n                element.hide();\n              } else {\n                element.show();\n              }\n            }\n          }\n        }, true);\n        var open = false;\n        element.bind('click', function () {\n          if (open) {\n            open = false;\n            viewState.setenlarge(-1);\n          } else {\n            open = true;\n            viewState.setenlarge(attrs.enlarge);\n          }\n          $rootScope.$apply();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('save', [\n  'modalService',\n  'Espsparserservice',\n  function (modalService, Espsparserservice) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attr) {\n        var name = scope.level.name;\n        element.bind('click', function () {\n          scope.vs.setcurClickLevelName(name, attr.save);\n          Espsparserservice.asyncParseJSO(name).then(function (result) {\n            modalService.open('views/export.html', name + '_esps.txt', result);\n          });\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('slideToggle', function () {\n  return {\n    restrict: 'A',\n    scope: { isOpen: '=slideToggle' },\n    link: function (scope, element, attr) {\n      var slideDuration = parseInt(attr.slideToggleDuration, 10) || 200;\n      // trigger a slideToggle at initialization\n      if (scope.isOpen) {\n      } else {\n        element.stop().slideToggle(0);\n      }\n      // Watch for when the value bound to isOpen changes\n      // When it changes trigger a slideToggle\n      scope.$watch('isOpen', function (newIsOpenVal, oldIsOpenVal) {\n        if (newIsOpenVal !== oldIsOpenVal) {\n          element.stop().slideToggle(slideDuration);\n        }\n      });\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('previewtrack', [\n  'viewState',\n  'Soundhandlerservice',\n  function (viewState, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element) {\n        var startPCM = -1;\n        ///////////////\n        // bindings\n        //\n        element.bind('click', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n            if (!viewState.isEditing()) {\n              scope.$apply(function () {\n                viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n              });\n            }\n          }\n        });\n        //\n        element.bind('mousedown', function (x) {\n          if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n            startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n          }\n        });\n        //\n        element.bind('mousemove', function (x) {\n          var mbutton = 0;\n          if (x.buttons === undefined) {\n            mbutton = x.which;\n          } else {\n            mbutton = x.buttons;\n          }\n          switch (mbutton) {\n          case 1:\n            if (startPCM !== -1) {\n              var width = viewState.curViewPort.eS - viewState.curViewPort.sS;\n              startPCM = viewState.getX(x) * (Soundhandlerservice.wavJSO.Data.length / x.originalEvent.target.width);\n              if (!viewState.isEditing()) {\n                scope.$apply(function () {\n                  viewState.setViewPort(startPCM - width / 2, startPCM + width / 2);\n                });\n              }\n            }\n            break;\n          }\n        });\n        //\n        element.bind('mouseup', function () {\n          startPCM = -1;\n        });\n        //\n        element.bind('mouseout', function () {\n          startPCM = -1;\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Iohandlerservice', [\n  '$rootScope',\n  '$http',\n  '$location',\n  '$q',\n  'HistoryService',\n  'viewState',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'ConfigProviderService',\n  'Espsparserservice',\n  'Ssffdataservice',\n  'Websockethandler',\n  'DragnDropDataService',\n  function Iohandlerservice($rootScope, $http, $location, $q, HistoryService, viewState, Soundhandlerservice, Ssffparserservice, Wavparserservice, Textgridparserservice, ConfigProviderService, Espsparserservice, Ssffdataservice, Websockethandler, DragnDropDataService) {\n    // shared service object\n    var sServObj = {};\n    // $http.defaults.useXDomain = true;\n    sServObj.wsH = Websockethandler;\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetDefaultConfig = function () {\n      var prom = $http.get('configFiles/default_emuwebappConfig.json');\n      return prom;\n    };\n    /**\n\t\t * default config is always loaded from same origin\n\t\t */\n    sServObj.httpGetPath = function (path, respType) {\n      var prom = $http.get(path, { responseType: respType });\n      return prom;\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    /**\n\t\t *\n\t\t */\n    sServObj.getProtocol = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getProtocol not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getProtocol();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDoUserManagement = function () {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDoUserManagement not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDoUserManagement();\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.logOnUser = function (name, pwd) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of logOnUser not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.logOnUser(name, pwd);\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getDBconfigFile = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getDBconfigFile not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getDBconfigFile();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_DBconfig.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundleList = function (nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundleList not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundleList();\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + nameOfDB + '_bundleList.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBundle = function (name, session, nameOfDB) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of getBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'embedded') {\n        getProm = DragnDropDataService.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.getBundle(name, session);\n      } else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n        // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n        getProm = $http.get('demoDBs/' + nameOfDB + '/' + name + '_bndl.json');\n      }\n      return getProm;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.saveBundle = function (bundleData) {\n      var getProm;\n      if (ConfigProviderService.vals.main.comMode === 'CORS') {\n        alert('CORS version of saveBundle not implemented');\n      } else if (ConfigProviderService.vals.main.comMode === 'WS') {\n        getProm = Websockethandler.saveBundle(bundleData);\n      }\n      // else if (ConfigProviderService.vals.main.comMode === 'DEMO') {\n      // getProm = $http.get('testData/newAE/SES0000/' + name + '/' + name + '.json');\n      // \tgetProm = $http.get('testData/testAeBundle.json'); // SIC SIC SIC HARDCODED -> name is ignored\n      // }\n      return getProm;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    /**\n\t\t * pass through to according parser\n\t\t */\n    sServObj.parseLabelFile = function (string, annotates, name, fileType) {\n      var prom;\n      if (fileType === 'ESPS') {\n        prom = Espsparserservice.asyncParseEsps(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedESPS');\n      } else if (fileType === 'TEXTGRID') {\n        prom = Textgridparserservice.asyncParseTextGrid(string, ConfigProviderService.embeddedVals.labelGetUrl, 'embeddedTEXTGRID');\n      }\n      return prom;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Soundhandlerservice', [\n  '$document',\n  'Binarydatamaniphelper',\n  function Soundhandlerservice($document, Binarydatamaniphelper) {\n    // shared service object\n    var sServObj = {};\n    sServObj.wavJSO = {};\n    sServObj.player = $document[0].createElement('audio');\n    sServObj.player.isPlaying = false;\n    sServObj.setPlayerSrc = function (buf) {\n      var base64String = Binarydatamaniphelper.arrayBufferToBase64(buf);\n      this.player.src = 'data:audio/wav;base64,' + base64String;\n    };\n    sServObj.resetPlayerSrcFromTo = function (sampleStart, endSample) {\n      var bytePerSample = sServObj.wavJSO.BitsPerSample / 8;\n      var header = sServObj.wavJSO.origArrBuf.subarray(0, 44);\n      var data = sServObj.wavJSO.origArrBuf.subarray(44, sServObj.wavJSO.Data.length * bytePerSample);\n      var dv = new DataView(header);\n      dv.setUint32(40, (endSample - sampleStart) * bytePerSample, true);\n      // var Subchunk2Size = dv.getUint32(40, true);\n      // console.log(Subchunk2Size);\n      var newData = data.subarray(sampleStart * bytePerSample, (endSample - sampleStart) * bytePerSample);\n      var tmp = new Uint8Array(header.byteLength + newData.byteLength);\n      tmp.set(new Uint8Array(header), 0);\n      tmp.set(new Uint8Array(newData), header.byteLength);\n      var base64String = Binarydatamaniphelper.arrayBufferToBase64(tmp.buffer);\n      sServObj.player.src = 'data:audio/wav;base64,' + base64String;\n    };\n    sServObj.playFromTo = function (sampleStart, endSample) {\n      this.resetPlayerSrcFromTo(sampleStart, endSample);\n      if (this.player.isPlaying) {\n        this.player.isPlaying = false;\n        this.player.pause();\n      } else {\n        this.player.isPlaying = true;\n        this.player.play();\n      }\n    };\n    sServObj.player.addEventListener('ended', function () {\n      this.isPlaying = false;\n    }, false);\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('drawssff', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'HistoryService',\n  'fontScaleService',\n  function (viewState, ConfigProviderService, Ssffdataservice, HistoryService, fontScaleService) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function postLink(scope, element, atts) {\n        scope.trackName = atts.ssffTrackname;\n        scope.assTrackName = '';\n        scope.lastDraw = Date.now();\n        // add watch vars to scope\n        scope.vs = viewState;\n        scope.hists = HistoryService;\n        scope.ssffds = Ssffdataservice;\n        ////////////////////\n        // observes\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          scope.trackName = val;\n        });\n        ////////////////////\n        // watches\n        //watch viewPort change\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n            scope.handleUpdate();\n          }\n          if (oldValue.windowWidth !== newValue.windowWidth) {\n            scope.handleUpdate();\n          }\n        }, true);\n        //watch perspective change\n        scope.$watch('vs.curPerspectiveIdx', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch vs.curCorrectionToolNr change\n        scope.$watch('vs.curCorrectionToolNr', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //watch hists.\n        scope.$watch('hists.movesAwayFromLastSave', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch ssffds.data change\n        scope.$watch('ssffds.data.length', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        // watch vs.spectroSettings change\n        scope.$watch('vs.spectroSettings', function (newValue, oldValue) {\n          scope.handleUpdate();\n        }, true);\n        //\n        //////////////////////\n        /**\n         *\n         */\n        scope.handleUpdate = function () {\n          var ctx = element[0].getContext('2d');\n          ctx.clearRect(0, 0, element[0].width, element[0].height);\n          if (!$.isEmptyObject(Ssffdataservice.data)) {\n            if (Ssffdataservice.data.length !== 0) {\n              scope.assTrackName = '';\n              // check assignments (= overlays)\n              ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.assign.forEach(function (ass, i) {\n                if (ass.signalCanvasName === scope.trackName) {\n                  scope.assTrackName = ass.ssffTrackName;\n                  var tr = ConfigProviderService.getSsffTrackConfig(ass.ssffTrackName);\n                  var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                  var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                  // draw values  \n                  scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n                }\n              });\n              scope.assTrackName = '';\n              // draw ssffTrack onto own canvas\n              if (scope.trackName !== 'OSCI' && scope.trackName !== 'SPEC') {\n                var tr = ConfigProviderService.getSsffTrackConfig(scope.trackName);\n                var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                var minMaxLims = ConfigProviderService.getLimsOfTrack(tr.name);\n                // draw values  \n                scope.drawValues(viewState, element[0], ConfigProviderService, col, sRaSt.sampleRate, sRaSt.startTime, minMaxLims);\n              }\n            }\n          } else {\n            ctx.clearRect(0, 0, element[0].width, element[0].height);\n          }\n        };\n        /**\n         * draw values onto canvas\n         */\n        scope.drawValues = function (viewState, canvas, config, col, sR, sT, minMaxLims) {\n          var ctx = canvas.getContext('2d');\n          var minVal, maxVal;\n          if (scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n            minVal = viewState.spectroSettings.rangeFrom;\n            maxVal = viewState.spectroSettings.rangeTo;\n          } else {\n            minVal = col._minVal;\n            maxVal = col._maxVal;\n          }\n          var startTimeVP = viewState.getViewPortStartTime();\n          var endTimeVP = viewState.getViewPortEndTime();\n          var colStartSampleNr = Math.round(startTimeVP * sR + sT);\n          var colEndSampleNr = Math.round(endTimeVP * sR + sT);\n          var nrOfSamples = colEndSampleNr - colStartSampleNr;\n          var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n          if (nrOfSamples < canvas.width && nrOfSamples >= 2) {\n            var x, y, prevX, prevY, prevVal, curSampleInCol, curSampleInColTime;\n            ////////////////////////////////\n            // NEW VERSION\n            ////////////////////////////////\n            angular.forEach(curSampleArrs[0], function (contourVal, contourNr) {\n              // console.log(contourNr);\n              if ($.isEmptyObject(minMaxLims) || contourNr >= minMaxLims.minContourIdx && contourNr <= minMaxLims.maxContourIdx) {\n                // set color\n                if ($.isEmptyObject(minMaxLims)) {\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / curSampleArrs[0].length) + ',80%, 50%)';\n                } else {\n                  var l = minMaxLims.maxContourIdx - minMaxLims.minContourIdx + 1;\n                  ctx.strokeStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                  ctx.fillStyle = 'hsl(' + contourNr * (360 / l) + ',80%, 50%)';\n                }\n                // overwrite color settings if they are preconfigured\n                var contColors = ConfigProviderService.getContourColorsOfTrack(scope.assTrackName);\n                if (contColors !== undefined) {\n                  if (contColors.colors[contourNr] !== undefined) {\n                    ctx.strokeStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                    ctx.fillStyle = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].signalCanvases.contourColors[0].colors[contourNr];\n                  }\n                }\n                // mark selected\n                // console.log(viewState.curCorrectionToolNr);\n                if (viewState.curCorrectionToolNr - 1 === contourNr && scope.trackName === 'SPEC' && scope.assTrackName === 'FORMANTS') {\n                  ctx.strokeStyle = ConfigProviderService.vals.colors.selectedContourColor;\n                  ctx.fillStyle = ConfigProviderService.vals.colors.selectedContourColor;\n                }\n                ctx.beginPath();\n                // first line from sample not in view (left)\n                if (colStartSampleNr >= 1) {\n                  var leftBorder = col.values[colStartSampleNr - 1];\n                  var leftVal = leftBorder[contourNr];\n                  curSampleInCol = colStartSampleNr - 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (leftVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.moveTo(x, y);\n                }\n                angular.forEach(curSampleArrs, function (curArr, curArrIdx) {\n                  // console.log(curArr[contourNr]);\n                  curSampleInCol = colStartSampleNr + curArrIdx;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (curArr[contourNr] - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                  ctx.lineTo(x, y);\n                });\n                // last line from sample not in view (right)\n                if (colEndSampleNr < col.values.length - 1) {\n                  var rightBorder = col.values[colEndSampleNr + 1];\n                  var rightVal = rightBorder[contourNr];\n                  curSampleInCol = colEndSampleNr + 1;\n                  curSampleInColTime = 1 / sR * curSampleInCol + sT;\n                  x = (curSampleInColTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                  y = canvas.height - (rightVal - minVal) / (maxVal - minVal) * canvas.height;\n                  ctx.lineTo(x, y);\n                }\n                ctx.stroke();  // ctx.fill();\n              }\n            });\n          } else {\n            ctx.strokeStyle = 'red';\n            var txt;\n            // var tW;\n            var horizontalText;\n            if (nrOfSamples <= 2) {\n              horizontalText = fontScaleService.getTextImageTwoLines(ctx, 'Zoom out to', 'see contour(s)', ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor);\n              // ctx.fillStyle = ConfigProviderService.vals.colors.levelColor;\n              // ctx.fillRect(0, 0, canvas.width, canvas.height);\n              ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, canvas.width / 2 - horizontalText.width / 2, 25, horizontalText.width, horizontalText.height);\n            } else {\n              txt = 'Zoom in to see contour(s)';\n              horizontalText = fontScaleService.getTextImageTwoLines(ctx, 'Zoom in to', 'see contour(s)', ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor);\n              // ctx.fillStyle = ConfigProviderService.vals.colors.levelColor;\n              // ctx.fillRect(0, 0, canvas.width, canvas.height);              \n              ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, canvas.width / 2 - horizontalText.width / 2, 25, horizontalText.width, horizontalText.height);\n            }\n          }\n        }  //function\n;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffparserservice', [\n  '$q',\n  function Ssffparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new ssffParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e);\n      } else {\n        defer.reject(e);\n      }\n    }, false);\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseSsffArr = function (ssffArray) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseArr',\n        'ssffArr': ssffArray\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    /**\n\t\t * convert jso to ssff binary file using webworker\n\t\t * @param java script object of ssff file (internal rep)\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncJso2ssff = function (jso) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'jso2ssff',\n        'jso': JSON.stringify(jso)\n      });\n      // Send data to our worker.\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('mouseTrackAndCorrectionTool', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'Drawhelperservice',\n  'HistoryService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, Drawhelperservice, HistoryService, Soundhandlerservice) {\n    return {\n      restrict: 'A',\n      scope: {},\n      link: function (scope, element, atts) {\n        var curMouseSample;\n        var dragStartSample;\n        var dragEndSample;\n        var canvas = element[0];\n        var ctx = canvas.getContext('2d');\n        // var elem = element[0];\n        var tr, col, sRaSt;\n        var trackName;\n        var bundleName;\n        /////////////////////////////\n        // observe attribute\n        atts.$observe('ssffTrackname', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        // bundleName needed to reset tr, col, sRaSt on bundle change\n        atts.$observe('bundleName', function (val) {\n          if (val) {\n            bundleName = val;\n            if (!$.isEmptyObject(Ssffdataservice.data)) {\n              if (Ssffdataservice.data.length !== 0) {\n                tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                if (tr !== undefined) {\n                  col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                  sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                }\n              }\n            }\n          }\n        });\n        /////////////////////////////\n        // Bindings\n        element.bind('mousedown', function (event) {\n          dragStartSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          dragEndSample = dragStartSample;\n          viewState.select(dragStartSample, dragStartSample);\n          //Drawhelperservice.drawViewPortTimes(ctx, true);\n          scope.switchMarkupContext(event);\n          scope.$apply();\n        });\n        element.bind('mousemove', function (event) {\n          var mbutton = 0;\n          if (event.buttons === undefined) {\n            mbutton = event.which;\n          } else {\n            mbutton = event.buttons;\n          }\n          // perform mouse tracking\n          var mouseX = viewState.getX(event);\n          viewState.curMousePosSample = Math.round(viewState.curViewPort.sS + mouseX / element[0].width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n          switch (mbutton) {\n          case 0:\n            if (viewState.getPermission('labelAction')) {\n              scope.switchMarkupContext(event);\n              if (!$.isEmptyObject(Ssffdataservice.data)) {\n                if (Ssffdataservice.data.length !== 0) {\n                  if (!viewState.getdragBarActive()) {\n                    if (viewState.curCorrectionToolNr !== undefined && !viewState.getdragBarActive() && !$.isEmptyObject(ConfigProviderService.getAssignment(trackName))) {\n                      // var col = Ssffdataservice.data[0].Columns[0];\n                      if (tr === undefined) {\n                        tr = ConfigProviderService.getSsffTrackConfig('FORMANTS');\n                      }\n                      col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n                      sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n                      var startTimeVP = viewState.getViewPortStartTime();\n                      var endTimeVP = viewState.getViewPortEndTime();\n                      var colStartSampleNr = Math.round(startTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var colEndSampleNr = Math.round(endTimeVP * sRaSt.sampleRate + sRaSt.startTime);\n                      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n                      var curSampleArrs = col.values.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n                      var curMouseTime = startTimeVP + viewState.getX(event) / event.originalEvent.target.width * (endTimeVP - startTimeVP);\n                      var curMouseSample = Math.round((curMouseTime + sRaSt.startTime) * sRaSt.sampleRate) - 1;\n                      //-1 for in view correction\n                      var curMouseSampleTime = 1 / sRaSt.sampleRate * curMouseSample + sRaSt.startTime;\n                      if (curMouseSample - colStartSampleNr < 0 || curMouseSample - colStartSampleNr >= curSampleArrs.length) {\n                        console.log('early return');\n                        return;\n                      }\n                      viewState.curPreselColumnSample = curMouseSample - colStartSampleNr;\n                      var x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                      var y = canvas.height - curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                      // draw sample\n                      ctx.strokeStyle = 'black';\n                      ctx.fillStyle = 'black';\n                      ctx.beginPath();\n                      ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                      ctx.closePath();\n                      ctx.stroke();\n                      ctx.fill();\n                      if (event.shiftKey) {\n                        var oldValue = angular.copy(curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1]);\n                        var newValue = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        // SIC only using rangeTo\n                        curSampleArrs[viewState.curPreselColumnSample][viewState.curCorrectionToolNr - 1] = viewState.spectroSettings.rangeTo - viewState.getY(event) / event.originalEvent.target.height * viewState.spectroSettings.rangeTo;\n                        var updateObj = HistoryService.updateCurChangeObj({\n                            'type': 'SSFF',\n                            'trackName': tr.name,\n                            'sampleBlockIdx': colStartSampleNr + viewState.curPreselColumnSample,\n                            'sampleIdx': viewState.curCorrectionToolNr - 1,\n                            'oldValue': oldValue,\n                            'newValue': newValue\n                          });\n                        //draw updateObj as overlay\n                        for (var key in updateObj) {\n                          curMouseSampleTime = 1 / sRaSt.sampleRate * updateObj[key].sampleBlockIdx + sRaSt.startTime;\n                          x = (curMouseSampleTime - startTimeVP) / (endTimeVP - startTimeVP) * canvas.width;\n                          y = canvas.height - updateObj[key].newValue / (viewState.spectroSettings.rangeTo - viewState.spectroSettings.rangeFrom) * canvas.height;\n                          // draw sample\n                          ctx.strokeStyle = 'red';\n                          ctx.fillStyle = 'red';\n                          // ctx.lineWidth = 4;\n                          ctx.beginPath();\n                          ctx.arc(x, y - 1, 2, 0, 2 * Math.PI, false);\n                          ctx.closePath();\n                          ctx.stroke();\n                          ctx.fill();\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            break;\n          case 1:\n            if (!viewState.getdragBarActive()) {\n              scope.setSelectDrag(event);\n            }\n            break;\n          }\n          scope.$apply();\n        });\n        element.bind('mouseup', function (event) {\n          if (!viewState.getdragBarActive()) {\n            scope.setSelectDrag(event);\n            scope.switchMarkupContext(event);\n          }\n        });\n        // on mouse leave clear markup canvas\n        element.bind('mouseleave', function (event) {\n          if (!$.isEmptyObject(Soundhandlerservice)) {\n            if (!$.isEmptyObject(Soundhandlerservice.wavJSO)) {\n              if (!viewState.getdragBarActive()) {\n                if (viewState.getPermission('labelAction')) {\n                  scope.switchMarkupContext(event, false);\n                }\n              }\n            }\n          }\n        });\n        //\n        ////////////////////\n        scope.switchMarkupContext = function (event, leave) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          // draw current viewport selected\n          if (atts.ssffTrackname == 'OSCI') {\n            Drawhelperservice.drawViewPortTimes(ctx, true);\n            Drawhelperservice.drawCurViewPortSelected(ctx, true);\n          } else if (atts.ssffTrackname == 'SPEC') {\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, '', viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 2);\n          } else {\n            var tr = ConfigProviderService.getSsffTrackConfig(atts.ssffTrackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            Drawhelperservice.drawCurViewPortSelected(ctx, false);\n            Drawhelperservice.drawMinMaxAndName(ctx, atts.ssffTrackname, col._minVal, col._maxVal, 2);\n          }\n          // draw crossHairs\n          if (leave !== false && ConfigProviderService.vals.restrictions.drawCrossHairs) {\n            Drawhelperservice.drawCrossHairs(ctx, event, viewState.spectroSettings.rangeFrom, viewState.spectroSettings.rangeTo, 'Hz', atts.ssffTrackname);\n          }\n          // draw moving boundary line if moving\n          Drawhelperservice.drawMovingBoundaryLine(ctx);\n        };\n        scope.setSelectDrag = function (event) {\n          curMouseSample = Math.round(viewState.getX(event) * viewState.getSamplesPerPixelVal(event) + viewState.curViewPort.sS);\n          if (curMouseSample > dragStartSample) {\n            dragEndSample = curMouseSample;\n            viewState.select(dragStartSample, dragEndSample);\n          } else {\n            dragStartSample = curMouseSample;\n            viewState.select(dragStartSample, dragEndSample);\n          }\n          scope.$apply();\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Drawhelperservice', [\n  'viewState',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'fontScaleService',\n  'Ssffdataservice',\n  function Drawhelperservice(viewState, ConfigProviderService, Soundhandlerservice, fontScaleService, Ssffdataservice) {\n    //shared service object to be returned\n    var sServObj = {};\n    function getScale(ctx, str, scale) {\n      return ctx.measureText(str).width * scale;\n    }\n    function getScaleWidth(ctx, str1, str2, scaleX) {\n      if (str1.toString().length > str2.toString().length) {\n        return getScale(ctx, str1, scaleX);\n      } else {\n        return getScale(ctx, str2, scaleX);\n      }\n    }\n    /**\n\t\t * drawing method to draw single line between two\n\t\t * envelope points. Is used by drawOsciOnCanvas if\n\t\t * envelope drawing is done\n\t\t * @param index\n\t\t * @param value\n\t\t * @param max\n\t\t * @param prevPeak\n\t\t * @param canvas\n\t\t */\n    function drawFrame(viewState, index, value, max, prevPeak, canvas, config) {\n      var ctx = canvas.getContext('2d');\n      //cur\n      var w = 1;\n      var h = Math.round(value * (canvas.height / max));\n      //rel to max\n      var x = index * w;\n      var y = Math.round((canvas.height - h) / 2);\n      //prev\n      // var prevW = 1;\n      var prevH = Math.round(prevPeak * (canvas.height / max));\n      var prevX = (index - 1) * w;\n      var prevY = Math.round((canvas.height - prevH) / 2);\n      // if (posC >= x) {\n      // \tconsole.error('here...')\n      // \tctx.fillStyle = config.vals.colors.playProgressColor;\n      // \tctx.strokeStyle = config.vals.colors.playProgressColor;\n      // } else {\n      ctx.fillStyle = config.vals.colors.osciColor;\n      ctx.strokeStyle = config.vals.colors.osciColor;\n      // }\n      // ctx.beginPath();\n      ctx.moveTo(prevX, prevY);\n      ctx.lineTo(x, y);  // ctx.stroke();\n    }\n    sServObj.osciPeaks = [];\n    /**\n\t\t * get current peaks to be drawn\n\t\t * if drawing over sample exact -> samples\n\t\t * if multiple samples per pixel -> calculate envelope points\n\t\t */\n    sServObj.calculatePeaks = function (viewState, canvas, data) {\n      var samplePerPx = (viewState.curViewPort.eS + 1 - viewState.curViewPort.sS) / canvas.width;\n      // PCM Samples per new pixel + one to correct for subtraction\n      var numberOfChannels = 1;\n      // hardcode for now...\n      var peaks = [];\n      var minPeak = Infinity;\n      var maxPeak = -Infinity;\n      var relData;\n      if (samplePerPx <= 1) {\n        // check if view at start            \n        if (viewState.curViewPort.sS === 0) {\n          relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        } else {\n          relData = data.subarray(viewState.curViewPort.sS - 1, viewState.curViewPort.eS + 2);  // +2 to compensate for length\n        }\n        minPeak = Math.min.apply(Math, relData);\n        maxPeak = Math.max.apply(Math, relData);\n        peaks = Array.prototype.slice.call(relData);\n      } else {\n        relData = data.subarray(viewState.curViewPort.sS, viewState.curViewPort.eS);\n        for (var curPxIdx = 0; curPxIdx < canvas.width; curPxIdx++) {\n          var avrVal = 0;\n          for (var c = 0; c < numberOfChannels; c++) {\n            var vals = relData.subarray(curPxIdx * samplePerPx, (curPxIdx + 1) * samplePerPx);\n            // var peak = -Infinity;\n            var sum = 0;\n            for (var p = 0, l = vals.length; p < l; p++) {\n              // if (vals[p] > peak) {\n              // \tpeak = vals[p];\n              // }\n              sum += vals[p];\n            }\n            avrVal += sum / vals.length;\n          }\n          peaks[curPxIdx] = avrVal;\n          if (avrVal > maxPeak) {\n            maxPeak = avrVal;\n          }\n        }\n      }\n      //else\n      return {\n        'peaks': peaks,\n        'minPeak': minPeak,\n        'maxPeak': maxPeak,\n        'samplePerPx': samplePerPx\n      };\n    };\n    /**\n\t\t * @param cps color provider service\n\t\t */\n    sServObj.freshRedrawDrawOsciOnCanvas = function (viewState, canvas, allPeakVals, buffer, config) {\n      var ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      //set font\n      // ctx.font = (this.params.fontPxSize + \"px\" + \" \" + this.params.fontType);\n      if (allPeakVals.peaks && allPeakVals.samplePerPx >= 1) {\n        ctx.beginPath();\n        allPeakVals.peaks.forEach(function (peak, index) {\n          if (index !== 0) {\n            drawFrame(viewState, index, peak, allPeakVals.maxPeak, allPeakVals.peaks[index - 1], canvas, config);\n          }\n        });\n        ctx.stroke();\n      } else if (allPeakVals.samplePerPx < 1) {\n        // console.log(\"at 0 over sample exact\")\n        var hDbS = 1 / allPeakVals.samplePerPx / 2;\n        // half distance between samples\n        var sNr = viewState.curViewPort.sS;\n        // over sample exact\n        ctx.strokeStyle = config.vals.colors.osciColor;\n        ctx.fillStyle = config.vals.colors.osciColor;\n        // ctx.beginPath();\n        var i;\n        if (viewState.curViewPort.sS === 0) {\n          ctx.moveTo(hDbS, (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 0; i < allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.strokeText(sNr, i / allPeakVals.samplePerPx + hDbS, (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        } else {\n          //draw lines\n          ctx.beginPath();\n          ctx.moveTo(-hDbS, canvas.height - (allPeakVals.peaks[0] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height);\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.lineTo(i / allPeakVals.samplePerPx - hDbS, canvas.height - ((allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height + 3));\n          }\n          ctx.stroke();\n          // draw sample dots\n          for (i = 1; i <= allPeakVals.peaks.length; i++) {\n            ctx.beginPath();\n            ctx.arc(i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 3, 4, 0, 2 * Math.PI, false);\n            ctx.stroke();\n            ctx.fill();\n            if (config.vals.restrictions.drawSampleNrs) {\n              ctx.fillText(sNr, i / allPeakVals.samplePerPx - hDbS, canvas.height - (allPeakVals.peaks[i] - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 10);\n              sNr = sNr + 1;\n            }\n          }\n        }\n      }\n      if (config.vals.restrictions.drawZeroLine) {\n        // draw zero line\n        ctx.strokeStyle = config.vals.colors.zeroLineColor;\n        ctx.fillStyle = config.vals.colors.zeroLineColor;\n        // see if Chrome ->dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([2]);\n        }\n        if (allPeakVals.samplePerPx >= 1) {\n          ctx.beginPath();\n          ctx.moveTo(0, canvas.height / 2);\n          ctx.lineTo(canvas.width, canvas.height / 2);\n          ctx.stroke();\n          ctx.fillText('0', 5, canvas.height / 2 - 5, canvas.width);\n        } else {\n          var zeroLineY = canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height;\n          ctx.beginPath();\n          ctx.moveTo(0, zeroLineY);\n          ctx.lineTo(canvas.width, zeroLineY);\n          ctx.stroke();\n          ctx.fill();\n          ctx.fillText('0', 5, canvas.height - (0 - allPeakVals.minPeak) / (allPeakVals.maxPeak - allPeakVals.minPeak) * canvas.height - 5, canvas.width);\n        }\n        // see if Chrome ->dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([0]);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawMovingBoundaryLine\n\t\t */\n    sServObj.drawMovingBoundaryLine = function (ctx) {\n      var xOffset, sDist;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'SEGMENT') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      if (viewState.movingBoundary) {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedBoundaryColor;\n        var p = Math.round(viewState.getPos(ctx.canvas.width, viewState.movingBoundarySample));\n        if (viewState.getcurMouseisLast()) {\n          ctx.fillRect(p + sDist, 0, 1, ctx.canvas.height);\n        } else {\n          ctx.fillRect(p + xOffset, 0, 1, ctx.canvas.height);\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCurViewPortSelected\n\t\t */\n    sServObj.drawCurViewPortSelected = function (ctx, drawTimeAndSamples) {\n      var xOffset, sDist, space, horizontalText, scaleX;\n      sDist = viewState.getSampleDist(ctx.canvas.width);\n      // calc. offset dependant on type of level of mousemove  -> default is sample exact\n      if (viewState.getcurMouseLevelType() === 'seg') {\n        xOffset = 0;\n      } else {\n        xOffset = sDist / 2;\n      }\n      var posS = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectS);\n      var posE = viewState.getPos(ctx.canvas.width, viewState.curViewPort.selectE);\n      if (posS === posE) {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedBorderColor;\n        ctx.fillRect(posS + xOffset, 0, 2, ctx.canvas.height);\n        if (drawTimeAndSamples) {\n          if (viewState.curViewPort.sS !== viewState.curViewPort.selectS && viewState.curViewPort.selectS !== -1) {\n            scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n            space = getScaleWidth(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posE + 5, 0, horizontalText.width, horizontalText.height);\n          }\n        }\n      } else {\n        ctx.fillStyle = ConfigProviderService.vals.colors.selectedAreaColor;\n        ctx.fillRect(posS, 0, posE - posS, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.vals.colors.selectedBorderColor;\n        ctx.beginPath();\n        ctx.moveTo(posS, 0);\n        ctx.lineTo(posS, ctx.canvas.height);\n        ctx.moveTo(posE, 0);\n        ctx.lineTo(posE, ctx.canvas.height);\n        ctx.closePath();\n        ctx.stroke();\n        if (drawTimeAndSamples) {\n          // start values\n          scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          space = getScaleWidth(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectS, viewState.round(viewState.curViewPort.selectS / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posS - space - 5, 0, horizontalText.width, horizontalText.height);\n          // end values\n          horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.selectE, viewState.round(viewState.curViewPort.selectE / Soundhandlerservice.wavJSO.SampleRate, 6), ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posE + 5, 0, horizontalText.width, horizontalText.height);\n          // dur values\n          // check if space\n          space = getScale(ctx, viewState.round((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6), scaleX);\n          if (posE - posS > space) {\n            var str1 = viewState.curViewPort.selectE - viewState.curViewPort.selectS - 1;\n            var str2 = viewState.round((viewState.curViewPort.selectE - viewState.curViewPort.selectS) / Soundhandlerservice.wavJSO.SampleRate, 6);\n            space = getScaleWidth(ctx, str1, str2, scaleX);\n            horizontalText = fontScaleService.getTextImageTwoLines(ctx, str1, str2, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, posS + (posE - posS) / 2 - space / 2, 0, horizontalText.width, horizontalText.height);\n          }\n        }\n      }\n    };\n    /**\n\t\t * drawing method to drawCrossHairs\n\t\t */\n    sServObj.drawCrossHairs = function (ctx, mouseEvt, min, max, unit, trackname) {\n      if (ConfigProviderService.vals.restrictions.drawCrossHairs) {\n        // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n        ctx.strokeStyle = ConfigProviderService.vals.colors.crossHairsColor;\n        ctx.fillStyle = ConfigProviderService.vals.colors.crossHairsColor;\n        // see if Chrome -> dashed line\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([2]);\n        }\n        // draw lines\n        var mouseX = viewState.getX(mouseEvt);\n        var mouseY = viewState.getY(mouseEvt);\n        if (navigator.vendor === 'Google Inc.') {\n          ctx.setLineDash([0]);\n        }\n        // draw frequency / sample / time\n        ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n        var mouseFreq = viewState.round(max - mouseY / ctx.canvas.height * max, 2);\n        // SIC only uses max\n        var tW = ctx.measureText(mouseFreq + unit).width;\n        var s1 = Math.round(viewState.curViewPort.sS + mouseX / ctx.canvas.width * (viewState.curViewPort.eS - viewState.curViewPort.sS));\n        var s2 = viewState.round(viewState.getViewPortStartTime() + mouseX / ctx.canvas.width * (viewState.getViewPortEndTime() - viewState.getViewPortStartTime()), 6);\n        var horizontalText = fontScaleService.getTextImage(ctx, mouseFreq + unit, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n        var verticalText = fontScaleService.getTextImageTwoLines(ctx, s1, s2, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n        if (max !== undefined || min !== undefined) {\n          if (trackname == 'OSCI') {\n            // no horizontal values\t\t\n            ctx.beginPath();\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(5, mouseY + 5);\n            //ctx.moveTo(0, mouseY);\n            //ctx.lineTo(ctx.canvas.width, mouseY);\n            //ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else if (trackname == 'SPEC') {\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, mouseY, horizontalText.width, horizontalText.height);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, horizontalText.width, horizontalText.height);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          } else {\n            // draw min max an name of track\n            var tr = ConfigProviderService.getSsffTrackConfig(trackname);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            mouseFreq = viewState.round(col._maxVal - mouseY / ctx.canvas.height * col._maxVal, 2);\n            horizontalText = fontScaleService.getTextImage(ctx, mouseFreq, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.crossHairsColor, true);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, mouseY, horizontalText.width, horizontalText.height);\n            ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - 5 - tW * (ctx.canvas.width / ctx.canvas.offsetWidth), mouseY, horizontalText.width, horizontalText.height);\n            ctx.beginPath();\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(5, mouseY + 5);\n            ctx.moveTo(0, mouseY);\n            ctx.lineTo(ctx.canvas.width, mouseY);\n            ctx.lineTo(ctx.canvas.width - 5, mouseY + 5);\n            ctx.moveTo(mouseX, 0);\n            ctx.lineTo(mouseX, ctx.canvas.height);\n            ctx.stroke();\n          }\n        }\n        ctx.drawImage(verticalText, 0, 0, verticalText.width, verticalText.height, mouseX + 5, 0, verticalText.width, verticalText.height);\n      }\n    };\n    /**\n\t\t * drawing method to drawMinMaxAndName\n\t\t * @param ctx is context to be drawn on\n\t\t * @param trackName name of track to be drawn in the center of the canvas (left aligned)\n\t\t * @param min value to be drawn at the bottom of the canvas (left aligned)\n\t\t * @param max value to be drawn at the top of the canvas (left aligned)\n\t\t * @param round value to round to for min/max values (== digits after comma)\n\t\t */\n    sServObj.drawMinMaxAndName = function (ctx, trackName, min, max, round) {\n      // ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      ctx.strokeStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.fillStyle = ConfigProviderService.vals.colors.labelColor;\n      // var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var smallFontSize = ConfigProviderService.vals.font.fontPxSize * 3 / 4;\n      var th = smallFontSize * scaleY;\n      // draw corner pointers\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(0, ctx.canvas.height);\n      ctx.lineTo(5, ctx.canvas.height - 5);\n      ctx.stroke();\n      ctx.closePath();\n      // draw trackName\n      if (trackName !== '') {\n        ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n        var trackNameImg = fontScaleService.getTextImage(ctx, trackName, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n        ctx.drawImage(trackNameImg, 0, ctx.canvas.height / 2 - ConfigProviderService.vals.font.fontPxSize * scaleY / 2);\n      }\n      // draw min/max vals\n      if (max !== undefined) {\n        var labelTxtImg = fontScaleService.getTextImage(ctx, 'max: ' + viewState.round(max, round), smallFontSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.endBoundaryColor);\n        ctx.drawImage(labelTxtImg, 5, 5, labelTxtImg.width, labelTxtImg.height);\n      }\n      // draw min/max vals\n      if (min !== undefined) {\n        labelTxtImg = fontScaleService.getTextImage(ctx, 'min: ' + viewState.round(min, round), smallFontSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.endBoundaryColor);\n        ctx.drawImage(labelTxtImg, 5, ctx.canvas.height - th - 5, labelTxtImg.width, labelTxtImg.height);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.drawViewPortTimes = function (ctx) {\n      ctx.strokeStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.fillStyle = ConfigProviderService.vals.colors.labelColor;\n      ctx.font = ConfigProviderService.vals.font.fontPxSize + 'px' + ' ' + ConfigProviderService.vals.font.fontType;\n      // lines to corners\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(5, 5);\n      ctx.moveTo(ctx.canvas.width, 0);\n      ctx.lineTo(ctx.canvas.width - 5, 5);\n      ctx.closePath();\n      ctx.stroke();\n      var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n      var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n      var sTime;\n      var eTime;\n      var horizontalText;\n      var space;\n      if (viewState.curViewPort) {\n        //draw time and sample nr\n        sTime = viewState.round(viewState.curViewPort.sS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        eTime = viewState.round(viewState.curViewPort.eS / Soundhandlerservice.wavJSO.SampleRate, 6);\n        horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.sS, sTime, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, true);\n        // ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 0, 0, horizontalText.width, horizontalText.height);\n        ctx.drawImage(horizontalText, 5, 5);\n        space = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n        horizontalText = fontScaleService.getTextImageTwoLines(ctx, viewState.curViewPort.eS, eTime, ConfigProviderService.vals.font.fontPxSize, ConfigProviderService.vals.font.fontType, ConfigProviderService.vals.colors.labelColor, false);\n        ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, ctx.canvas.width - space - 5, 0, horizontalText.width, horizontalText.height);  //draw dot at edge of image\n                                                                                                                                                                         // var spaceW = getScaleWidth(ctx, viewState.curViewPort.eS, eTime, scaleX);\n                                                                                                                                                                         // var startPoint = (Math.PI / 180) * 0;\n                                                                                                                                                                         // var endPoint = (Math.PI / 180) * 360;\n                                                                                                                                                                         // ctx.beginPath();\n                                                                                                                                                                         // ctx.arc(spaceW, config.vals.font.fontPxSize * 2 * scaleY, 10, startPoint, endPoint, true);\n                                                                                                                                                                         // ctx.fill();\n                                                                                                                                                                         // ctx.closePath();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('HistoryService', [\n  '$log',\n  'Ssffdataservice',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'viewState',\n  'Soundhandlerservice',\n  function HistoryService($log, Ssffdataservice, LevelService, LinkService, ConfigProviderService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    sServObj.movesAwayFromLastSave = 0;\n    //////////////////////////////////////////\n    // new dual stack implementation\n    // private\n    var undoStack = [];\n    var redoStack = [];\n    var curChangeObj = {};\n    // applyChanges should be called by undo redo functions\n    function applyChange(changeObj, applyOldVal) {\n      Object.keys(changeObj).forEach(function (key) {\n        var cur = changeObj[key];\n        if (cur.type === 'SSFF') {\n          if (applyOldVal) {\n            viewState.historyActionTxt = 'UNDO: SSFF manipulation';\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.oldValue;\n          } else {\n            viewState.historyActionTxt = 'REDO: SSFF manipulation';\n            var tr = ConfigProviderService.getSsffTrackConfig(cur.trackName);\n            var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n            col.values[cur.sampleBlockIdx][cur.sampleIdx] = cur.newValue;\n          }\n        } else if (cur.type === 'ANNOT') {\n          switch (cur.action) {\n          case 'MOVEBOUNDARY':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: MOVEBOUNDARY';\n              LevelService.moveBoundary(cur.name, cur.id, -cur.movedBy, cur.isFirst, cur.isLast);\n            } else {\n              viewState.historyActionTxt = 'REDO: MOVEBOUNDARY';\n              LevelService.moveBoundary(cur.name, cur.id, cur.movedBy, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'MOVESEGMENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: MOVESEGMENT';\n              LevelService.moveSegment(cur.name, cur.id, cur.length, -cur.movedBy);\n            } else {\n              viewState.historyActionTxt = 'REDO: MOVESEGMENT';\n              LevelService.moveSegment(cur.name, cur.id, cur.length, cur.movedBy);\n            }\n            break;\n          case 'MOVEEVENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: MOVEEVENT';\n              LevelService.moveEvent(cur.name, cur.id, -cur.movedBy);\n            } else {\n              viewState.historyActionTxt = 'REDO: MOVEEVENT';\n              LevelService.moveEvent(cur.name, cur.id, cur.movedBy);\n            }\n            break;\n          case 'RENAMELABEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: RENAMELABEL';\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.oldValue);\n            } else {\n              viewState.historyActionTxt = 'REDO: RENAMELABEL';\n              LevelService.renameLabel(cur.name, cur.id, cur.attrIndex, cur.newValue);\n            }\n            break;\n          case 'RENAMELEVEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: RENAMELEVEL';\n              LevelService.renameLevel(cur.newname, cur.name, cur.curPerspectiveIdx);\n            } else {\n              viewState.historyActionTxt = 'REDO: RENAMELEVEL';\n              LevelService.renameLevel(cur.name, cur.newname, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETELEVEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELEVEL';\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELEVEL';\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'DELETEBOUNDARY':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETEBOUNDARY';\n              LevelService.deleteBoundaryInvers(cur.name, cur.id, cur.isFirst, cur.isLast, cur.deletedSegment);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETEBOUNDARY';\n              LevelService.deleteBoundary(cur.name, cur.id, cur.isFirst, cur.isLast);\n            }\n            break;\n          case 'DELETESEGMENTS':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETESEGMENTS';\n              LevelService.deleteSegmentsInvers(cur.name, cur.id, cur.length, cur.deletedSegment);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETESEGMENTS';\n              LevelService.deleteSegments(cur.name, cur.id, cur.length);\n            }\n            break;\n          case 'DELETEEVENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETEEVENT';\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETEEVENT';\n              LevelService.deleteEvent(cur.name, cur.id);\n            }\n            break;\n          case 'DELETELINKSTO':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELINKSTO';\n              LinkService.insertLinksTo(cur.deletedLinks);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELINKSTO';\n              LinkService.deleteLinksTo(cur.id);\n            }\n            break;\n          case 'DELETELINKBOUNDARY':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELINKBOUNDARY';\n              LinkService.deleteLinkBoundaryInvers(cur.deletedLinks);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELINKBOUNDARY';\n              LinkService.deleteLinkBoundary(cur.id, cur.neighbourId);\n            }\n            break;\n          case 'DELETELINKSEGMENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: DELETELINKSEGMENT';\n              LinkService.deleteLinkSegmentInvers(cur.deletedLinks);\n            } else {\n              viewState.historyActionTxt = 'REDO: DELETELINKSEGMENT';\n              LinkService.deleteLinkSegment(cur.segments);\n            }\n            break;\n          case 'INSERTLEVEL':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTLEVEL';\n              LevelService.deleteLevel(cur.id, cur.curPerspectiveIdx);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTLEVEL';\n              LevelService.insertLevel(cur.level, cur.id, cur.curPerspectiveIdx);\n            }\n            break;\n          case 'INSERTSEGMENTS':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTSEGMENTS';\n              LevelService.insertSegmentInvers(cur.name, cur.start, cur.end, cur.segName);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTSEGMENTS';\n              LevelService.insertSegment(cur.name, cur.start, cur.end, cur.segName, cur.ids);\n            }\n            break;\n          case 'INSERTEVENT':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTEVENT';\n              LevelService.deleteEvent(cur.name, cur.id);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTEVENT';\n              LevelService.insertEvent(cur.name, cur.start, cur.pointName, cur.id);\n            }\n            break;\n          case 'INSERTLINKSTO':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: INSERTLINKSTO';\n              LinkService.deleteLinksTo(cur.parentID, cur.childIDs);\n            } else {\n              viewState.historyActionTxt = 'REDO: INSERTLINKSTO';\n              LinkService.insertLinksTo(cur.parentID, cur.childIDs);\n            }\n            break;\n          case 'EXPANDSEGMENTS':\n            if (applyOldVal) {\n              viewState.historyActionTxt = 'UNDO: EXPANDSEGMENTS';\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, -cur.changeTime);\n            } else {\n              viewState.historyActionTxt = 'REDO: EXPANDSEGMENTS';\n              LevelService.expandSegment(cur.rightSide, cur.item, cur.name, cur.changeTime);\n            }\n            break;\n          }\n        }\n      });\n    }\n    /////////////////////////////////////\n    // public API\n    /**\n\t\t *\n\t\t */\n    sServObj.updateCurChangeObj = function (dataObj) {\n      // console.log(dataObj);\n      var dataKey;\n      if (dataObj.type === 'SSFF') {\n        dataKey = String(dataObj.type + '#' + dataObj.trackName) + '#' + String(dataObj.sampleBlockIdx) + '#' + String(dataObj.sampleIdx);\n        // update curChangeObj\n        if (!curChangeObj[dataKey]) {\n          curChangeObj[dataKey] = dataObj;\n        } else {\n          dataObj.oldValue = curChangeObj[dataKey].oldValue;\n          curChangeObj[dataKey] = dataObj;\n        }\n      } else if (dataObj.type === 'ANNOT') {\n        switch (dataObj.action) {\n        case 'MOVEBOUNDARY':\n        case 'MOVEEVENT':\n        case 'MOVESEGMENT':\n        case 'INSERTEVENT':\n        case 'DELETEEVENT':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name + '#' + dataObj.id);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.movedBy += curChangeObj[dataKey].movedBy;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        case 'INSERTLINKSTO':\n        case 'DELETELINKSTO':\n        case 'DELETELINKBOUNDARY':\n        case 'DELETELINKSEGMENT':\n        case 'DELETEBOUNDARY':\n        case 'DELETESEGMENTS':\n          dataKey = String(dataObj.type + '#' + dataObj.action + '#' + dataObj.name);\n          if (!curChangeObj[dataKey]) {\n            curChangeObj[dataKey] = dataObj;\n          } else {\n            dataObj.oldValue = curChangeObj[dataKey].oldValue;\n            curChangeObj[dataKey] = dataObj;\n          }\n          break;\n        }\n      }\n      return curChangeObj;\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addCurChangeObjToUndoStack = function () {\n      // empty redo stack\n      redoStack = [];\n      // add to undoStack\n      if (!$.isEmptyObject(curChangeObj)) {\n        undoStack.push(curChangeObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      $log.info(curChangeObj);\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // addCurChangeObjToUndoStack\n    sServObj.addObjToUndoStack = function (obj) {\n      // empty redo stack\n      redoStack = [];\n      var tmpObj = {};\n      var dataKey = String(obj.type + '#' + obj.action + '#' + obj.name + '#' + obj.id);\n      tmpObj[dataKey] = angular.copy(obj);\n      // add to undoStack\n      if (!$.isEmptyObject(tmpObj)) {\n        undoStack.push(tmpObj);\n        sServObj.movesAwayFromLastSave += 1;\n      }\n      // reset curChangeObj\n      curChangeObj = {};\n    };\n    // undo\n    sServObj.undo = function () {\n      if (undoStack.length > 0) {\n        // add to redo stack\n        var oldChangeObj = angular.copy(undoStack[undoStack.length - 1]);\n        redoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, true);\n        // remove old \n        undoStack.pop();\n        sServObj.movesAwayFromLastSave -= 1;\n      }\n    };\n    // redo\n    sServObj.redo = function () {\n      if (redoStack.length > 0) {\n        var oldChangeObj = angular.copy(redoStack[redoStack.length - 1]);\n        undoStack.push(oldChangeObj);\n        applyChange(oldChangeObj, false);\n        redoStack.pop();\n        sServObj.movesAwayFromLastSave += 1;\n      }\n    };\n    // getNrOfPossibleUndos\n    sServObj.getNrOfPossibleUndos = function () {\n      return undoStack.length;\n    };\n    // return current History Stack\n    sServObj.getCurrentStack = function () {\n      return {\n        'undo': undoStack,\n        'redo': redoStack\n      };\n    };\n    // resetToInitState\n    sServObj.resetToInitState = function () {\n      undoStack = [];\n      redoStack = [];\n      curChangeObj = {};\n      sServObj.movesAwayFromLastSave = 0;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Wavparserservice', [\n  '$q',\n  function Wavparserservice($q) {\n    // shared service object\n    var sServObj = {};\n    var worker = new wavParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e);\n      }\n    });\n    /**\n\t\t * parse buffer containing wav file using webworker\n\t\t * @param buf\n\t\t * @returns promise\n\t\t */\n    sServObj.parseWavArrBuf = function (buf) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseBuf',\n        'buffer': buf\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Textgridparserservice', [\n  '$q',\n  'DataService',\n  'viewState',\n  'Soundhandlerservice',\n  function Textgridparserservice($q, DataService, viewState, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new textGridParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse level data to Textgrid File\n\t\t * @param level data\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncToTextGrid = function () {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'toTextGrid',\n        'levels': DataService.getData().levels,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'buffLength': Soundhandlerservice.wavJSO.Data.length\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse array of ssff file using webworker\n\t\t * @param array of ssff files encoded as base64 stings\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseTextGrid = function (textGrid, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseTG',\n        'textGrid': textGrid,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').factory('uuid', function () {\n  // shared service object\n  var sServObj = {};\n  function rand(s) {\n    var p = (Math.random().toString(16) + '000000000').substr(2, 8);\n    return s ? '-' + p.substr(0, 4) + '-' + p.substr(4, 4) : p;\n  }\n  //\n  sServObj.new = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  sServObj.newHash = function () {\n    return rand() + rand(true) + rand(true) + rand();\n  };\n  //\n  sServObj.empty = function () {\n    return '00000000-0000-0000-0000-000000000000';\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').factory('browserDetector', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  sServObj.isMobile = {\n    Android: function () {\n      return navigator.userAgent.match(/Android/i);\n    },\n    BlackBerry: function () {\n      return navigator.userAgent.match(/BlackBerry/i);\n    },\n    iOS: function () {\n      return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera Mini/i);\n    },\n    Windows: function () {\n      return navigator.userAgent.match(/IEMobile/i);\n    },\n    any: function () {\n      return sServObj.isMobile.Android() || sServObj.isMobile.BlackBerry() || sServObj.isMobile.iOS() || sServObj.isMobile.Opera() || sServObj.isMobile.Windows();\n    }\n  };\n  sServObj.isBrowser = {\n    Firefox: function () {\n      return navigator.userAgent.match(/Firefox/i);\n    },\n    Chrome: function () {\n      return navigator.userAgent.match(/Chrome/i);\n    },\n    InternetExplorer: function () {\n      return navigator.userAgent.match(/MSIE/i);\n    },\n    Opera: function () {\n      return navigator.userAgent.match(/Opera/i);\n    },\n    PhantomJS: function () {\n      return navigator.userAgent.match(/PhantomJS/i);\n    },\n    any: function () {\n      return sServObj.isBrowser.Firefox() || sServObj.isBrowser.Chrome() || sServObj.isBrowser.InternetExplorer() || sServObj.isBrowser.Opera() || sServObj.isBrowser.PhantomJS();\n    }\n  };\n  sServObj.isMobileDevice = function () {\n    var data = sServObj.isMobile.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  sServObj.isDesktopDevice = function () {\n    var data = sServObj.isBrowser.any();\n    if (data === null) {\n      return false;\n    } else {\n      if (data.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('fontScaleService', function fontScaleService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.lastTextWidth = null;\n  sServObj.spaceTop = 0;\n  /**\n\t\t *\n\t\t */\n  sServObj.getTextImage = function (ctxOriginal, text, fontPxSize, fontType, color) {\n    var scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    var scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    fontPxSize = Math.floor(fontPxSize + 2 - scaleY / 2);\n    var img = document.createElement('canvas');\n    img.setAttribute('width', Math.round(scaleX * 200));\n    img.setAttribute('height', Math.round(scaleY * 100));\n    var ctx = img.getContext('2d');\n    ctx.save();\n    ctx.font = fontPxSize + 'px' + ' ' + fontType;\n    ctx.fillStyle = color;\n    ctx.scale(scaleX, scaleY);\n    ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n    sServObj.lastTextWidth = ctx.measureText(text).width * scaleX;\n    // draw frame to see size\n    ctx.restore();\n    // ctx.fillStyle = \"red\";\n    // ctx.strokeStyle = \"red\";\n    // ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // ctx.stroke();\n    return img;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.getLastImageWidth = function () {\n    return sServObj.lastTextWidth;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.getTextImageTwoLines = function (ctxOriginal, text, text2, fontPxSize, fontType, color, alignLeft) {\n    var scaleY = ctxOriginal.canvas.height / ctxOriginal.canvas.offsetHeight;\n    var scaleX = ctxOriginal.canvas.width / ctxOriginal.canvas.offsetWidth;\n    fontPxSize = Math.floor(fontPxSize + 2 - scaleY / 2);\n    var img = document.createElement('canvas');\n    img.setAttribute('width', Math.round(scaleX * 200));\n    img.setAttribute('height', Math.round(scaleY * 100));\n    var ctx = img.getContext('2d');\n    ctx.save();\n    ctx.font = fontPxSize + 'px' + ' ' + fontType;\n    ctx.fillStyle = color;\n    ctx.scale(scaleX, scaleY);\n    sServObj.lastTextWidth = ctx.measureText(text).width * scaleX;\n    if (alignLeft) {\n      ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n      ctx.fillText(text2, 0, 2 * fontPxSize + sServObj.spaceTop);\n    } else {\n      var a = ctx.measureText(text).width;\n      var b = ctx.measureText(text2).width;\n      // var c;\n      if (a > b) {\n        ctx.fillText(text, 0, fontPxSize + sServObj.spaceTop);\n        ctx.fillText(text2, a - b, 2 * fontPxSize + sServObj.spaceTop);\n      } else {\n        ctx.fillText(text, b - a, fontPxSize + sServObj.spaceTop);\n        ctx.fillText(text2, 0, 2 * fontPxSize + sServObj.spaceTop);\n      }\n    }\n    // draw frame to see size\n    ctx.restore();\n    // ctx.fillStyle = 'red';\n    // ctx.strokeStyle = 'red';\n    // ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    // ctx.stroke();\n    return img;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Espsparserservice', [\n  '$q',\n  'LevelService',\n  'Soundhandlerservice',\n  function Espsparserservice($q, LevelService, Soundhandlerservice) {\n    // shared service object\n    var sServObj = {};\n    var worker = new espsParserWorker();\n    var defer;\n    // add event listener to worker to respond to messages\n    worker.says(function (e) {\n      if (e.status.type === 'SUCCESS') {\n        defer.resolve(e.data);\n      } else {\n        defer.reject(e.data);\n      }\n    }, false);\n    /**\n\t\t * parse ESPS file using webworker\n\t\t * @param esps\n\t\t * @param annotates\n\t\t * @param name\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseEsps = function (esps, annotates, name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseESPS',\n        'esps': esps,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate,\n        'annotates': annotates,\n        'name': name\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * parse JSO data to ESPS file using webworker\n\t\t * @param name\n\t\t * @param sampleRate\n\t\t * @returns promise\n\t\t */\n    sServObj.asyncParseJSO = function (name) {\n      defer = $q.defer();\n      worker.tell({\n        'cmd': 'parseJSO',\n        'level': LevelService.getLevelDetails(name).level,\n        'sampleRate': Soundhandlerservice.wavJSO.SampleRate\n      });\n      return defer.promise;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('LoginCtrl', [\n  '$scope',\n  '$rootScope',\n  '$http',\n  'ConfigProviderService',\n  'Iohandlerservice',\n  'viewState',\n  'modalService',\n  function ($scope, $rootScope, $http, ConfigProviderService, Iohandlerservice, viewState, modalService) {\n    $scope.loginData = {\n      'username': '',\n      'password': '',\n      'errorMsg': ''\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.tryLogin = function () {\n      Iohandlerservice.logOnUser($scope.loginData.username, $scope.loginData.password).then(function (res) {\n        if (res === 'LOGGEDON') {\n          modalService.confirm();\n        } else {\n          $scope.loginData.errorMsg = 'ERROR: ' + res;\n        }\n      });\n    };\n    // FOR DEVELOPMENT\n    // $scope.tryLogin(); // for autologin uncomment and set username + password\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cancel = function () {\n      modalService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Ssffdataservice', [\n  'viewState',\n  'Soundhandlerservice',\n  'ConfigProviderService',\n  function Ssffdataservice(viewState, Soundhandlerservice, ConfigProviderService) {\n    // shared service object\n    var sServObj = {};\n    // stores files referred to by ssffTrackDefinitions\n    sServObj.data = [];\n    /////////////////////\n    // public API\n    /**\n\t\t * Search through ssffTrackDefinitions to find correct\n\t\t * file. Then search thought data and return file.\n\t\t * @param trackName name of track to get file for\n\t\t */\n    sServObj.getFile = function (trackName) {\n      var res;\n      if (ConfigProviderService.curDbConfig.ssffTrackDefinitions !== undefined) {\n        ConfigProviderService.curDbConfig.ssffTrackDefinitions.forEach(function (std) {\n          if (std.name === trackName) {\n            sServObj.data.forEach(function (f) {\n              if (f.fileExtension === std.fileExtension) {\n                res = f;\n              }\n            });\n          }\n        });\n      }\n      return res;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getColumnOfTrack = function (trackName, columnName) {\n      var res;\n      var file = sServObj.getFile(trackName);\n      if (file !== undefined) {\n        file.Columns.forEach(function (col) {\n          if (col.name === columnName) {\n            res = col;\n          }\n        });\n        return res;\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSampleRateAndStartTimeOfTrack = function (trackName) {\n      var res = {};\n      var file = sServObj.getFile(trackName);\n      if (file !== undefined) {\n        res.sampleRate = file.sampleRate;\n        res.startTime = file.startTime;\n        return res;\n      }\n    };\n    /**\n\t\t * calculates the closest audio sample of\n\t\t * the passed in column sample nr\n\t\t */\n    sServObj.calculateSamplePosInVP = function (colSampleNr, sampleRate, startTime) {\n      var sampleTime = colSampleNr / sampleRate + startTime;\n      var audioSample = Math.round(sampleTime * Soundhandlerservice.wavJSO.SampleRate);\n      return audioSample;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DataService', function DataService() {\n  // shared service object\n  var sServObj = {};\n  sServObj.data = {};\n  sServObj.maxItemID = 0;\n  ///////////////////////////////\n  // public api\n  /**\n\t\t * returns all the data\n\t\t * @return the data\n\t\t */\n  sServObj.getData = function () {\n    return sServObj.data;\n  };\n  /**\n\t\t * sets all the level data\n\t\t * @param data containing all level data\n\t\t */\n  sServObj.setLevelData = function (data) {\n    sServObj.data.levels = data;\n  };\n  /**\n\t\t * returns all the level data\n\t\t * @return data containing all level data\n\t\t */\n  sServObj.getLevelData = function () {\n    return sServObj.data.levels;\n  };\n  /**\n\t\t * returns a specific level at given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.getLevelDataAt = function (position) {\n    return sServObj.data.levels[position];\n  };\n  /**\n\t\t * inserts a single level into level data at a given position\n\t\t * @param position of the level in the level array\n\t\t * @param newLevel the new level to insert\n\t\t */\n  sServObj.insertLevelDataAt = function (position, newLevel) {\n    sServObj.data.levels.splice(position, 0, newLevel);\n  };\n  /**\n\t\t * deletes a single level from level data at a given position\n\t\t * @param position of the level in the level array\n\t\t */\n  sServObj.deleteLevelDataAt = function (position) {\n    sServObj.data.levels.splice(position, 1);\n  };\n  /**\n\t\t * returns all the link data\n\t\t * @return the data\n\t\t */\n  sServObj.getLinkData = function () {\n    return sServObj.data.links;\n  };\n  /**\n\t\t * sets all the link data\n\t\t * @param data containing all link data\n\t\t */\n  sServObj.setLinkData = function (data) {\n    sServObj.data.links = data;\n  };\n  /**\n\t\t * inserts a single link into link data by pushing it\n\t\t * on to the array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkData = function (newLink) {\n    sServObj.data.links.push(newLink);\n  };\n  /**\n\t\t * deletes a single link from link data at a given position\n\t\t * @param position of the link in the link array\n\t\t */\n  sServObj.deleteLinkDataAt = function (position) {\n    sServObj.data.links.splice(position, 1);\n  };\n  /**\n\t\t * inserts a single link into link data at a given position\n\t\t * @param position of the link in the link array\n\t\t * @param newLink the new link to insert\n\t\t */\n  sServObj.insertLinkDataAt = function (position, newLink) {\n    sServObj.data.links.splice(position, 0, newLink);\n  };\n  /**\n\t\t * changes a single link at a given position with new data\n\t\t * @param position of the link in the link array\n\t\t * @param fromNewID the new fromID of the link\n\t\t * @param toNewID the new toID of the link\n\t\t */\n  sServObj.changeLinkDataAt = function (position, fromNewID, toNewID) {\n    sServObj.data.links[position].fromID = fromNewID;\n    sServObj.data.links[position].toID = toNewID;\n  };\n  /**\n\t\t * sets annotation data and sets maxItemID \n\t\t * by parsing id in elements\n\t\t * should be used to fill links and levels\t\t \n\t\t * @param the data\n\t\t */\n  sServObj.setData = function (data) {\n    angular.copy(data, sServObj.data);\n    angular.forEach(sServObj.data.levels, function (level) {\n      level.items.forEach(function (item) {\n        if (item.id > sServObj.maxItemID) {\n          sServObj.maxItemID = item.id;\n        }\n      });\n    });\n  };\n  /**\n\t\t * called externally by functions\n\t\t */\n  sServObj.getNewId = function () {\n    sServObj.maxItemID += 1;\n    return sServObj.maxItemID;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.raiseId = function (amount) {\n    sServObj.maxItemID += amount;\n  };\n  /**\n\t\t * called internally by functions\n\t\t */\n  sServObj.lowerId = function (amount) {\n    sServObj.maxItemID -= amount;\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('LevelService', [\n  '$q',\n  'DataService',\n  'LinkService',\n  'ConfigProviderService',\n  'Soundhandlerservice',\n  'viewState',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  function LevelService($q, DataService, LinkService, ConfigProviderService, Soundhandlerservice, viewState, Ssffdataservice, ArrayHelperService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.lasteditArea = null;\n    // holding current edit area\n    sServObj.lasteditAreaElem = null;\n    // holding current edit area element\n    /**\n\t\t * search for the according label field in labels\n\t\t * and return its index\n\t\t *    @param attrDefName\n\t\t *    @param labels\n\t\t */\n    function getLabelIdx(attrDefName, labels) {\n      var labelIdx;\n      angular.forEach(labels, function (l, idx) {\n        if (l.name === attrDefName) {\n          labelIdx = idx;\n        }\n      });\n      return labelIdx;\n    }\n    /**\n\t\t * returns level details (level object and sorting id) by passing in level Name\n\t\t */\n    sServObj.getLevelDetails = function (name) {\n      var curLevel = null;\n      var id = null;\n      angular.forEach(DataService.getLevelData(), function (level, num) {\n        if (level.name === name) {\n          curLevel = level;\n          id = num;\n        }\n      });\n      return {\n        level: curLevel,\n        id: id\n      };\n    };\n    /**\n\t\t * returns level details (level object and sorting id) by passing in level Name\n\t\t */\n    sServObj.getLevelsByType = function (types) {\n      var levels = [];\n      angular.forEach(DataService.getLevelData(), function (level, num) {\n        var t = level.type;\n        if (types.indexOf(t) >= 0) {\n          levels.push(level);\n        }\n      });\n      return levels;\n    };\n    /**\n\t\t * gets element order by passing in elemtent id\n\t\t */\n    sServObj.getOrderById = function (name, eid) {\n      var ret = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (e, num) {\n            if (e.id === eid) {\n              ret = num;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets element id by passing in element order\n\t\t */\n    sServObj.getIdByOrder = function (name, order) {\n      var ret = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num == order) {\n              ret = element.id;\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * gets item details by passing in levelName and item order\n\t\t */\n    sServObj.getItemDetails = function (name, order) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (num == order) {\n              details = element;\n            }\n          });\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * gets element details by passing in levelName and elemtent order\n\t\t */\n    sServObj.getLastItem = function (name) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          details = level.items[level.items.length - 1];\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * get next Element in order\n\t\t */\n    sServObj.getNextItem = function (name, id) {\n      var details = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.forEach(function (element, num) {\n            if (element.id == id) {\n              details = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return details;\n    };\n    /**\n\t\t * gets item from leve by passing in levelName and item id\n\t\t *\n\t\t * @return item\n\t\t */\n    sServObj.getItemFromLevelById = function (levelName, id) {\n      var foundItm = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              foundItm = element;\n            }\n          });\n        }\n      });\n      return foundItm;\n    };\n    /**\n\t\t * gets item from leve by passing in levelName and item id\n\t\t *\n\t\t * @return item\n\t\t */\n    sServObj.getItemsFromLevelByIdAndLength = function (levelName, id, length) {\n      var foundItms = [];\n      var lastID = id;\n      for (var j = 0; j < length; j++) {\n        var segment = sServObj.getItemFromLevelById(levelName, lastID);\n        lastID = sServObj.getNextItem(levelName, segment.id);\n        foundItms.push(segment);\n      }\n      return foundItms;\n    };\n    /**\n\t\t * Getter for last edit Area Element\n\t\t *   @return lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.getlasteditAreaElem = function () {\n      return sServObj.lasteditAreaElem;\n    };\n    /**\n\t\t * Setter for last edit Area Element\n\t\t *   @param lasteditAreaElem last edit Area Element\n\t\t */\n    sServObj.setlasteditAreaElem = function (e) {\n      sServObj.lasteditAreaElem = e;\n    };\n    /**\n\t\t * Setter for last edit Area\n\t\t *   @param lasteditAreaElem last edit Area\n\t\t */\n    sServObj.setlasteditArea = function (name) {\n      sServObj.lasteditArea = name;\n    };\n    /**\n\t\t * Getter for last edit Area\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlasteditArea = function () {\n      return sServObj.lasteditArea;\n    };\n    /**\n\t\t * Getter for id of last edited Element\n\t\t *   @return lasteditAreaElem last edit Area\n\t\t */\n    sServObj.getlastID = function () {\n      return sServObj.lasteditArea.substr(1);\n    };\n    /**\n\t\t * Remove currently open html textarea (if there is a textarea open)\n\t\t * and set viewState.editing to false.\n\t\t */\n    sServObj.deleteEditArea = function () {\n      if (null !== sServObj.getlasteditArea()) {\n        $('.' + sServObj.getlasteditArea()).remove();\n      }\n      viewState.editing = false;\n    };\n    /**\n\t\t * Calculate values (x,y,width,height) for textarea to open\n\t\t * depending on the current Level type, the current canvas\n\t\t * and the current clicked Element\n\t\t *   @param lastEventClick the current clicked Level Element\n\t\t *   @param element the current html Element to get canvas from\n\t\t *   @param type the current Level type\n\t\t */\n    sServObj.openEditArea = function (lastEventClick, element, type) {\n      var levelName = viewState.getcurClickLevelName();\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      // find labelIdx\n      var labelIdx = getLabelIdx(attrDefName, lastEventClick.labels);\n      var elem = element.find('canvas').context.getContext('2d');\n      var clientWidth = elem.canvas.clientWidth;\n      var clientOffset = elem.canvas.offsetLeft;\n      var top = elem.canvas.offsetTop;\n      var height = elem.canvas.clientHeight - 1;\n      var len = 10;\n      if (labelIdx !== undefined) {\n        if (lastEventClick.labels[labelIdx].value.length > 0) {\n          len = lastEventClick.labels[labelIdx].value.length * 7;\n        }\n      }\n      var editText = '';\n      if (lastEventClick.labels.length > 0) {\n        if (lastEventClick.labels[labelIdx] !== undefined) {\n          editText = lastEventClick.labels[labelIdx].value;\n        } else {\n          editText = '';\n        }\n      }\n      if (type === 'SEGMENT') {\n        var start = Math.floor(viewState.getPos(clientWidth, lastEventClick.sampleStart) + clientOffset);\n        var end = Math.ceil(viewState.getPos(clientWidth, lastEventClick.sampleStart + lastEventClick.sampleDur + 1) + clientOffset);\n        var width = end - start;\n        if (width < 2 * len) {\n          var zoom = viewState.curViewPort.eS - viewState.curViewPort.sS;\n          if (zoom <= 10) {\n            // if already zoomed in but text is still too long\n            sServObj.createEditAreaElement(element, start, top, end - start, height, lastEventClick.labels[labelIdx].value, lastEventClick.id);\n          } else {\n            viewState.zoomViewPort(true, this);\n            sServObj.openEditArea(lastEventClick, element, type);\n            return;\n          }\n        }\n        sServObj.createEditAreaElement(element, start, top, end - start, height, editText, lastEventClick.id);\n      } else {\n        var start = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset - len / 2;\n        var end = viewState.getPos(clientWidth, lastEventClick.samplePoint) + clientOffset + len / 2;\n        var width = end - start;\n        if (width < 2 * len) {\n          width = 2 * len;\n        }\n        sServObj.createEditAreaElement(element, start, top, width, height, editText, lastEventClick.id);\n      }\n      sServObj.createSelection(element.find('textarea')[0], 0, editText.length);\n    };\n    /**\n\t\t * Create a Text Selection in a html Textarea\n\t\t *   @param field the textarea element\n\t\t *   @param start the starting character position as int\n\t\t *   @param end the ending character position as int\n\t\t */\n    sServObj.createSelection = function (field, start, end) {\n      if (field.createTextRange) {\n        var selRange = field.createTextRange();\n        selRange.collapse(true);\n        selRange.moveStart('character', start);\n        selRange.moveEnd('character', end);\n        selRange.select();\n      } else if (field.setSelectionRange) {\n        field.setSelectionRange(start, end);\n      } else if (field.selectionStart) {\n        field.selectionStart = start;\n        field.selectionEnd = end;\n      }\n      field.focus();\n    };\n    /**\n\t\t * create a html textarea element at given\n\t\t *   @param x the x Position\n\t\t *   @param y the y Position\n\t\t *   @param width the Width\n\t\t *   @param height the Height\n\t\t *   @param label the Text Content of the Textarea\n\t\t *   @param labelid the id of the element\n\t\t */\n    sServObj.createEditAreaElement = function (element, x, y, width, height, label, labelid) {\n      var textid = '_' + labelid;\n      element.prepend($('<textarea>').attr({\n        id: textid,\n        'class': textid + ' emuwebapp-labelEdit',\n        'ng-model': 'message',\n        'autofocus': 'true'\n      }).css({\n        'left': Math.round(x + 2) + 'px',\n        'top': Math.round(y) + 'px',\n        'width': Math.round(width) - 4 + 'px',\n        'height': Math.round(height) - 1 + 'px',\n        'padding-top': Math.round(height / 3 + 1) + 'px',\n        'overflow-x': 'hidden',\n        'overflow-y': 'hidden'\n      }).text(label));\n    };\n    /**\n\t\t * insert a new Item with id labelname start and duration at position on level\n\t\t */\n    sServObj.insertItemDetails = function (id, levelname, position, labelname, start, duration) {\n      var attrdefs = ConfigProviderService.getLevelDefinition(levelname).attributeDefinitions;\n      var curAttrDef = viewState.getCurAttrDef(levelname);\n      var newElement;\n      if (attrdefs === undefined) {\n        // ugly hack if attrdefs undefined\n        attrdefs = [];\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          if (level.type == 'SEGMENT') {\n            newElement = {\n              id: id,\n              sampleStart: start,\n              sampleDur: duration,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          } else if (level.type == 'EVENT') {\n            newElement = {\n              id: id,\n              samplePoint: start,\n              labels: []\n            };\n            if (attrdefs.length > 0) {\n              for (var i = 0; i < attrdefs.length; i++) {\n                if (attrdefs[i].name === curAttrDef) {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                } else {\n                  newElement.labels.push({\n                    name: attrdefs[i].name,\n                    value: labelname\n                  });\n                }\n              }\n            } else {\n              newElement.labels.push({\n                name: levelname,\n                value: labelname\n              });\n            }\n          }\n          level.items.splice(position, 0, newElement);\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.updateSegItemInLevel = function (levelname, id, labelname, labelIdx, start, duration) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              if (start !== undefined) {\n                element.sampleStart = start;\n              }\n              if (duration !== undefined) {\n                element.sampleDur = duration;\n              }\n              if (labelname !== undefined) {\n                element.labels[labelIdx].value = labelname;\n              }\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * sets element details by passing in levelName and elemtent id\n\t\t */\n    sServObj.setPointDetails = function (levelname, id, labelname, start) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelname) {\n          level.items.forEach(function (element) {\n            if (element.id == id) {\n              element.samplePoint = start;\n              element.labels[0].value = labelname;\n            }\n          });\n        }\n      });\n    };\n    /**\n\t\t * gets item details by passing in levelName and item id's\n\t\t */\n    sServObj.getItemNeighboursFromLevel = function (levelName, firstid, lastid) {\n      var left = undefined;\n      var right = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === levelName) {\n          level.items.forEach(function (itm, num) {\n            if (itm.id == firstid) {\n              left = level.items[num - 1];\n            }\n            if (itm.id == lastid) {\n              right = level.items[num + 1];\n            }\n          });\n        }\n      });\n      return {\n        left: left,\n        right: right\n      };\n    };\n    /**\n\t\t * get item details by passing in level, sampleNr and maximum pcm\n\t\t *\n\t\t * @param level\n\t\t * @param sampleNr\n\t\t * @param maximum \n\t\t * @returns object of the form {current: item, nearest: item, isFirst: boolean, isLast: boolean} where \n\t\t * - current is the actual item where the mouse is\n\t\t * - nearest is the item next to the current one depending on where the mouse is (ie if over 50% right element, under 50% left element)\n\t\t * - isFirst is true if the mouse is before the first item\n\t\t * - isLast is true if the mouse is after the last item\n\t\t *          \n\t\t */\n    sServObj.getClosestItem = function (sampleNr, levelname, maximum) {\n      var level = sServObj.getLevelDetails(levelname).level;\n      var current = undefined;\n      var nearest = undefined;\n      var isFirst = undefined;\n      var isLast = undefined;\n      if (level.items.length > 0) {\n        current = nearest = level.items[0];\n        isFirst = true;\n        isLast = false;\n        if (level.type === 'SEGMENT') {\n          angular.forEach(level.items, function (itm, index) {\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              // 0.5 sample correction\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                if (sampleNr - itm.sampleStart >= itm.sampleDur / 2) {\n                  if (level.items[index + 1] !== undefined) {\n                    current = level.items[index];\n                    nearest = level.items[index + 1];\n                    isLast = false;\n                  } else {\n                    isLast = true;\n                    current = nearest = level.items[level.items.length - 1];\n                  }\n                } else {\n                  isLast = false;\n                  current = nearest = level.items[index];\n                }\n              }\n              isFirst = false;\n            }\n            if (sampleNr >= itm.sampleStart - 0.5) {\n              if (sampleNr <= itm.sampleStart + itm.sampleDur + 0.5) {\n                // 0.5 sample correction\n                current = itm;\n              } else {\n                isLast = true;\n                current = nearest = level.items[level.items.length - 1];\n              }\n            }\n          });\n        } else {\n          var spaceLower = 0;\n          var spaceHigher = 0;\n          isFirst = false;\n          isLast = false;\n          angular.forEach(level.items, function (evt, index) {\n            if (index < level.items.length - 1) {\n              spaceHigher = evt.samplePoint + (level.items[index + 1].samplePoint - level.items[index].samplePoint) / 2;\n            } else {\n              spaceHigher = maximum;\n            }\n            if (index > 0) {\n              spaceLower = evt.samplePoint - (level.items[index].samplePoint - level.items[index - 1].samplePoint) / 2;\n            } else {\n              spaceLower = 0;\n            }\n            if (sampleNr <= spaceHigher && sampleNr >= spaceLower) {\n              current = nearest = evt;\n            }\n          });\n        }\n      }\n      return {\n        current: current,\n        nearest: nearest,\n        isFirst: isFirst,\n        isLast: isLast\n      };\n    };\n    /**\n\t\t * deletes a level by its name\n\t\t */\n    sServObj.deleteLevel = function (levelIndex, curPerspectiveIdx) {\n      var lvl = DataService.getLevelDataAt(levelIndex);\n      DataService.deleteLevelDataAt(levelIndex);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 1);\n      return lvl;\n    };\n    /**\n\t\t * adds a level by its name\n\t\t */\n    sServObj.insertLevel = function (originalLevel, levelIndex, curPerspectiveIdx) {\n      if (DataService.getLevelData() === undefined) {\n        DataService.setLevelData([]);\n      }\n      DataService.insertLevelDataAt(levelIndex, originalLevel);\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.splice(levelIndex, 0, originalLevel.name);\n    };\n    /**\n\t\t * rename the label of an element by passing in level name and id\n\t\t */\n    sServObj.renameLabel = function (levelName, id, attrIndex, newLabelName) {\n      sServObj.updateSegItemInLevel(levelName, id, newLabelName, attrIndex);\n    };\n    /**\n\t\t * rename the label of a level by passing in level name and id\n\t\t */\n    sServObj.renameLevel = function (oldname, newname, curPerspectiveIdx) {\n      //rename level name\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === oldname) {\n          level.name = newname;\n          // rename all first label names to match new \n          angular.forEach(level.items, function (item) {\n            item.labels[0].name = newname;\n          });\n        }\n      });\n      // update order name as well\n      ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order[ConfigProviderService.vals.perspectives[curPerspectiveIdx].levelCanvases.order.indexOf(oldname)] = newname;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegmentsInvers = function (name, id, length, deletedSegment) {\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx;\n      var x, insertPoint;\n      insertPoint = 0;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          insertPoint = deletedSegment.order;\n          for (x in deletedSegment.segments) {\n            level.items.splice(insertPoint++, 0, deletedSegment.segments[x]);\n          }\n        }\n      });\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, deletedSegment.segments[0].id, deletedSegment.segments[deletedSegment.segments.length - 1].id);\n      if (lastNeighbours.left !== undefined && lastNeighbours.right === undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeRight);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.right.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeLeft, lastNeighbours.right.sampleDur - deletedSegment.timeLeft);\n      } else if (lastNeighbours.left === undefined && lastNeighbours.right === undefined) {\n      } else {\n        labelIdx = getLabelIdx(attrDefName, lastNeighbours.left.labels);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.left.id, lastNeighbours.left.labels[labelIdx].value, labelIdx, lastNeighbours.left.sampleStart, lastNeighbours.left.sampleDur - deletedSegment.timeLeft);\n        sServObj.updateSegItemInLevel(name, lastNeighbours.right.id, lastNeighbours.right.labels[labelIdx].value, labelIdx, lastNeighbours.right.sampleStart + deletedSegment.timeRight, lastNeighbours.right.sampleDur - deletedSegment.timeRight);\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteSegments = function (name, id, length) {\n      var firstSegment = sServObj.getItemFromLevelById(name, id);\n      var firstOrder = sServObj.getOrderById(name, id);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var timeLeft = 0;\n      var timeRight = 0;\n      var deleteOrder = null;\n      var deletedSegment = null;\n      var clickSeg = null;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      for (var i = firstOrder; i < firstOrder + length; i++) {\n        timeLeft += sServObj.getItemDetails(name, i).sampleDur + 1;\n      }\n      if (timeLeft % 2 == 0) {\n        timeLeft = timeLeft / 2;\n        timeRight = timeLeft;\n      } else {\n        timeLeft = Math.ceil(timeLeft / 2);\n        timeRight = timeLeft - 1;\n      }\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          angular.forEach(level.items, function (evt, order) {\n            if (evt.id == id) {\n              deleteOrder = order;\n              deletedSegment = level.items.splice(deleteOrder, length);\n            }\n          });\n        }\n      });\n      if (neighbours.left !== undefined && neighbours.right === undefined) {\n        sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      } else if (neighbours.left === undefined && neighbours.right !== undefined) {\n        sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeLeft, neighbours.right.sampleDur + timeLeft);\n        clickSeg = neighbours.right;\n      } else if (neighbours.left === undefined && neighbours.right === undefined) {\n        // nothing left to do level empty now\n        viewState.setcurMouseItem(undefined, undefined, undefined);\n      } else {\n        sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur + timeLeft);\n        sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart - timeRight, neighbours.right.sampleDur + timeRight);\n        clickSeg = neighbours.left;\n      }\n      return {\n        order: deleteOrder,\n        segments: deletedSegment,\n        timeLeft: timeLeft,\n        timeRight: timeRight,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegmentInvers = function (name, start, end, newLabel) {\n      var ret = true;\n      var diff, diff2;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name) {\n          if (start == end) {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              var diff = 0;\n              if (t.items[startOrder] !== undefined) {\n                diff = t.items[startOrder].sampleDur + 1;\n              }\n              if (t.items[startOrder - 1] !== undefined) {\n                // if not leftmost item\n                t.items[startOrder - 1].sampleDur += diff;\n              }\n              t.items.splice(startOrder, 1);\n            }\n          } else {\n            var startOrder = -1;\n            angular.forEach(t.items, function (evt, order) {\n              if (start == evt.sampleStart) {\n                startOrder = order;\n                ret = true;\n              }\n            });\n            if (ret) {\n              if (t.items[startOrder + 1] === undefined) {\n                // if rightmost item\n                t.items.splice(startOrder - 1, 2);\n              } else if (t.items[startOrder - 1] === undefined) {\n                // if leftmost item\n                t.items.splice(startOrder, 2);\n              } else {\n                // in the middle\n                diff = t.items[startOrder].sampleDur + 1;\n                diff2 = t.items[startOrder + 1].sampleDur + 1;\n                t.items[startOrder - 1].sampleDur += diff + diff2;\n                t.items.splice(startOrder, 2);\n              }\n            }\n          }\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertSegment = function (name, start, end, newLabel, ids) {\n      var ret = true;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          if (start == end) {\n            if (level.items.length == 0) {\n              // if on an empty level\n              return {\n                ret: false,\n                ids: ids\n              };\n            } else {\n              // if not on an empty level\n              if (ids === undefined) {\n                ids = [];\n                ids[0] = DataService.getNewId();\n              }\n              var startID = -1;\n              if (start < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - start;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, diff - 1);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var newStart = level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur + 1;\n                sServObj.insertItemDetails(ids[0], name, level.items.length, newLabel, newStart, start - newStart);\n              } else {\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (evt.sampleStart == start) {\n                    ret = false;\n                  }\n                  if (evt.sampleStart + evt.sampleDur + 1 == start) {\n                    ret = false;\n                  }\n                });\n                if (ret) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, level.items[startID].sampleDur - diff - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          } else {\n            if (ids === undefined) {\n              ids = [];\n              ids[0] = DataService.getNewId();\n              ids[1] = DataService.getNewId();\n            }\n            if (level.items.length == 0) {\n              // if on an empty level\n              sServObj.insertItemDetails(ids[0], name, 0, newLabel, start, end - start - 1);\n            } else {\n              // if not on an empty level\t\t\t\t\n              if (end < level.items[0].sampleStart) {\n                // before first segment\n                var diff = level.items[0].sampleStart - end - 1;\n                var diff2 = end - start - 1;\n                sServObj.insertItemDetails(ids[0], name, 0, newLabel, end, diff);\n                sServObj.insertItemDetails(ids[1], name, 0, newLabel, start, diff2);\n              } else if (start > level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) {\n                // after last segment\n                var diff = start - (level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur) - 1;\n                var diff2 = end - start - 1;\n                var len = level.items.length;\n                sServObj.insertItemDetails(ids[0], name, len, newLabel, level.items[level.items.length - 1].sampleStart + level.items[level.items.length - 1].sampleDur, diff);\n                sServObj.insertItemDetails(ids[1], name, len + 1, newLabel, start, diff2);\n              } else {\n                // in the middle\t\t\t\n                var startID = -1;\n                var endID = -1;\n                angular.forEach(level.items, function (evt, id) {\n                  if (start >= evt.sampleStart && start <= evt.sampleStart + evt.sampleDur) {\n                    startID = id;\n                  }\n                  if (end >= evt.sampleStart && end <= evt.sampleStart + evt.sampleDur) {\n                    endID = id;\n                  }\n                });\n                ret = startID === endID;\n                if (ret && startID !== -1) {\n                  var diff = start - level.items[startID].sampleStart - 1;\n                  var diff2 = end - start - 1;\n                  sServObj.insertItemDetails(ids[0], name, startID + 1, newLabel, start, diff2);\n                  sServObj.insertItemDetails(ids[1], name, startID + 2, newLabel, end, level.items[startID].sampleDur - diff - 1 - diff2 - 1);\n                  level.items[startID].sampleDur = diff;\n                }\n              }\n            }\n          }\n        }\n      });\n      return {\n        ret: ret,\n        ids: ids\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.insertEvent = function (name, start, pointName, id) {\n      var ret = false;\n      var alreadyExists = false;\n      var pos = undefined;\n      var last = undefined;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name && level.type === 'EVENT') {\n          if (level.items.length > 0) {\n            last = level.items[0].samplePoint;\n          } else {\n            last = 0;\n          }\n          angular.forEach(level.items, function (evt, order) {\n            if (Math.floor(start) === Math.floor(evt.samplePoint)) {\n              alreadyExists = true;\n            }\n            if (start > evt.samplePoint) {\n              pos = order + 1;\n            }\n          });\n        }\n      });\n      if (!alreadyExists) {\n        if (id === undefined) {\n          id = DataService.getNewId();\n        }\n        sServObj.insertItemDetails(id, name, pos, pointName, start);\n      }\n      return {\n        alreadyExists: alreadyExists,\n        id: id\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.deleteEvent = function (name, id) {\n      var ret = false;\n      angular.forEach(DataService.getLevelData(), function (t) {\n        if (t.name === name && t.type == 'EVENT') {\n          var last = 0;\n          angular.forEach(t.items, function (evt, order) {\n            if (!ret) {\n              if (id == evt.id) {\n                ret = evt;\n                t.items.splice(order, 1);\n              }\n            }\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t *   delete a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundary = function (name, id, isFirst, isLast) {\n      var toDelete = sServObj.getItemFromLevelById(name, id);\n      var last = null;\n      var retOrder = null;\n      var retEvt = null;\n      var clickSeg = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          last = level.items[0];\n          angular.forEach(level.items, function (evt, order) {\n            if (level.type === 'SEGMENT') {\n              if (toDelete.sampleStart == evt.sampleStart && toDelete.sampleDur == evt.sampleDur) {\n                if (order === 0 && isFirst) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[0];\n                } else if (order === level.items.length - 1 && isLast) {\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = level.items[level.items.length - 1];\n                } else {\n                  for (var i = 0; i < last.labels.length; i++) {\n                    last.labels[i].value += evt.labels[i].value;\n                  }\n                  last.sampleDur += evt.sampleDur + 1;\n                  level.items.splice(order, 1);\n                  retOrder = order;\n                  retEvt = evt;\n                  clickSeg = last;\n                }\n              }\n            }\n            last = evt;\n          });\n          if (clickSeg == null) {\n            clickSeg = level.items[0];\n          }\n        }\n      });\n      return {\n        order: retOrder,\n        event: retEvt,\n        clickSeg: clickSeg\n      };\n    };\n    /**\n\t\t *   restore a single boundary between items\n\t\t *   @param toDelete\n\t\t *   @param name\n\t\t *   @param levelType\n\t\t */\n    sServObj.deleteBoundaryInvers = function (name, id, isFirst, isLast, deletedSegment) {\n      angular.forEach(DataService.getLevelData(), function (level) {\n        if (level.name === name) {\n          level.items.splice(deletedSegment.order, 0, deletedSegment.event);\n          var oldName = deletedSegment.event.labels[0].value;\n          if (!isFirst && !isLast) {\n            oldName = level.items[deletedSegment.order - 1].labels[0].value.slice(0, level.items[deletedSegment.order - 1].labels[0].value.length - deletedSegment.event.labels[0].value.length);\n            level.items[deletedSegment.order - 1].labels[0].value = oldName;\n            level.items[deletedSegment.order - 1].sampleDur -= deletedSegment.event.sampleDur + 1;\n          }\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.snapBoundary = function (toTop, levelName, segment, neighbor, type) {\n      var neighTd;\n      var neighTdIdx;\n      var absMinDist = Infinity;\n      var absDist;\n      var minDist = undefined;\n      var sample;\n      var sampleTarget;\n      if (type == 'SEGMENT') {\n        sample = segment.sampleStart;\n      } else if (type == 'EVENT') {\n        sample = segment.samplePoint;\n      }\n      angular.forEach(DataService.getLevelData(), function (thisTd, tIdx) {\n        if (thisTd.name === levelName) {\n          if (toTop) {\n            if (tIdx >= 1) {\n              neighTd = DataService.getLevelData()[tIdx - 1];\n            } else {\n              return false;\n            }\n          } else {\n            if (tIdx < DataService.getLevelData().length - 1) {\n              neighTd = DataService.getLevelData()[tIdx + 1];\n            } else {\n              return false;\n            }\n          }\n          neighTd.items.forEach(function (itm, order) {\n            if (neighTd.type == 'SEGMENT') {\n              sampleTarget = itm.sampleStart;\n            } else if (neighTd.type == 'EVENT') {\n              sampleTarget = itm.samplePoint;\n            }\n            absDist = Math.abs(sample - sampleTarget);\n            if (absDist < absMinDist) {\n              absMinDist = absDist;\n              minDist = sampleTarget - sample;\n            }\n          });\n        }\n      });\n      if (minDist !== undefined) {\n        if (type == 'SEGMENT') {\n          this.moveBoundary(levelName, segment.id, minDist, 0);\n        } else if (type == 'EVENT') {\n          this.moveEvent(levelName, segment.id, minDist);\n        }\n        return minDist;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t *  moves a boundary of a given segment\n\t\t *\n\t\t *  @param {string} name The name of the level in which the segment lies.\n\t\t *  @param {number} id The id of the segment.\n\t\t *  @param {number} changeTime The time to add or substract.\n\t\t *  @param {isFirst} if item is first\n\t\t *  @param {isLast} if item is last\n\t\t *\n\t\t */\n    sServObj.moveBoundary = function (levelName, id, changeTime, isFirst, isLast) {\n      var orig = sServObj.getItemFromLevelById(levelName, id);\n      var attrDefName = viewState.getCurAttrDef(levelName);\n      var labelIdx = getLabelIdx(attrDefName, orig.labels);\n      var ln = sServObj.getItemNeighboursFromLevel(levelName, id, id);\n      if (isFirst) {\n        // before first item\n        var origRight = ln.right;\n        if (origRight !== undefined) {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        } else {\n          if (orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      } else if (isLast) {\n        // after last item\n        if (orig.sampleDur + changeTime >= 0 && orig.sampleDur + orig.sampleStart + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart, orig.sampleDur + changeTime);\n        }\n      } else {\n        if (ln.left === undefined) {\n          var origRight = ln.right;\n          if (origRight !== undefined) {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + changeTime < origRight.sampleStart) {\n              sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          } else {\n            if (orig.sampleStart + changeTime >= 0 && orig.sampleStart + orig.sampleDur + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n            }\n          }\n        } else {\n          var origLeft = ln.left;\n          if (origLeft.sampleDur + changeTime >= 0 && orig.sampleStart + changeTime >= 0 && orig.sampleDur - changeTime >= 0) {\n            sServObj.updateSegItemInLevel(levelName, ln.left.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n            sServObj.updateSegItemInLevel(levelName, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur - changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveEvent = function (name, id, changeTime) {\n      var orig = sServObj.getItemFromLevelById(name, id);\n      if (LinkService.isLinked(id)) {\n        var neighbour = sServObj.getItemNeighboursFromLevel(name, id, id);\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          // if within audio\n          if (neighbour.left !== undefined && neighbour.right !== undefined) {\n            // if between two events\n            // console.log('between two events')\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint && orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n              sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n            }\n          } else if (neighbour.left === undefined && neighbour.right === undefined) {\n            // if only event\n            // console.log('only element')\n            sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n          } else if (neighbour.left === undefined && neighbour.right !== undefined) {\n            // if first event\n            // console.log('first event')\n            if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime < neighbour.right.samplePoint) {\n              sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n            }\n          } else if (neighbour.left !== undefined && neighbour.right === undefined) {\n            // if last event\n            // console.log('last event')\n            if (orig.samplePoint + changeTime > neighbour.left.samplePoint && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n              sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n            }\n          }\n        }\n      } else {\n        // console.log('unlinked event')\n        if (orig.samplePoint + changeTime > 0 && orig.samplePoint + changeTime <= Soundhandlerservice.wavJSO.Data.length) {\n          sServObj.setPointDetails(name, orig.id, orig.labels[0].value, orig.samplePoint + changeTime);\n        }\n        //resort Points after moving\n        angular.forEach(DataService.getLevelData(), function (t) {\n          if (t.name === name) {\n            t.items.sort(sServObj.orderPoints);\n          }\n        });\n      }\n    };\n    /**\n\t\t * reorder points on Event level after moving them. This is needed when Points are moved before or after each other\n\t\t *\n\t\t */\n    sServObj.orderPoints = function (a, b) {\n      //Compare \"a\" and \"b\" in some fashion, and return -1, 0, or 1\n      if (a.samplePoint > b.samplePoint)\n        return 1;\n      if (a.samplePoint < b.samplePoint)\n        return -1;\n      return 0;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.moveSegment = function (name, id, length, changeTime) {\n      var firstOrder = sServObj.getOrderById(name, id);\n      var firstSegment = sServObj.getItemDetails(name, firstOrder);\n      var lastSegment = sServObj.getItemDetails(name, firstOrder + length - 1);\n      var lastNeighbours = sServObj.getItemNeighboursFromLevel(name, firstSegment.id, lastSegment.id);\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, firstSegment.labels);\n      if (lastNeighbours.left === undefined && lastNeighbours.right !== undefined) {\n        var right = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n        if (firstSegment.sampleStart + changeTime > 0 && lastNeighbours.right.sampleDur - changeTime >= 0) {\n          sServObj.updateSegItemInLevel(name, right.id, undefined, labelIdx, right.sampleStart + changeTime, right.sampleDur - changeTime);\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      } else if (lastNeighbours.right === undefined && lastNeighbours.left !== undefined) {\n        var left = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n        if (lastNeighbours.left.sampleDur + changeTime >= 0) {\n          if (lastSegment.sampleStart + lastSegment.sampleDur + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n            sServObj.updateSegItemInLevel(name, left.id, undefined, labelIdx, left.sampleStart, left.sampleDur + changeTime);\n            for (var i = firstOrder; i < firstOrder + length; i++) {\n              var orig = sServObj.getItemDetails(name, i);\n              sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n            }\n          }\n        }\n      } else if (lastNeighbours.right !== undefined && lastNeighbours.left !== undefined) {\n        var origLeft = sServObj.getItemFromLevelById(name, lastNeighbours.left.id);\n        var origRight = sServObj.getItemFromLevelById(name, lastNeighbours.right.id);\n        if (origLeft.sampleDur + changeTime >= 0 && origRight.sampleDur - changeTime >= 0) {\n          sServObj.updateSegItemInLevel(name, origLeft.id, undefined, labelIdx, origLeft.sampleStart, origLeft.sampleDur + changeTime);\n          sServObj.updateSegItemInLevel(name, origRight.id, undefined, labelIdx, origRight.sampleStart + changeTime, origRight.sampleDur - changeTime);\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      } else if (lastNeighbours.right === undefined && lastNeighbours.left === undefined) {\n        var first = sServObj.getItemDetails(name, firstOrder);\n        var last = sServObj.getItemDetails(name, firstOrder + length - 1);\n        if (first.sampleStart + changeTime > 0 && last.sampleDur + last.sampleStart + changeTime < Soundhandlerservice.wavJSO.Data.length) {\n          for (var i = firstOrder; i < firstOrder + length; i++) {\n            var orig = sServObj.getItemDetails(name, i);\n            sServObj.updateSegItemInLevel(name, orig.id, undefined, labelIdx, orig.sampleStart + changeTime, orig.sampleDur);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.expandSegment = function (rightSide, segments, name, changeTime) {\n      var startTime = 0;\n      var neighbours = sServObj.getItemNeighboursFromLevel(name, segments[0].id, segments[segments.length - 1].id);\n      var segTime = changeTime * segments.length;\n      var attrDefName = viewState.getCurAttrDef(name);\n      var labelIdx = getLabelIdx(attrDefName, segments[0].labels);\n      var tempItem;\n      var allow = true;\n      if (rightSide) {\n        // if expand or shrink on RIGHT side\n        if (neighbours.right === undefined) {\n          // last element\n          var lastLength = segments[segments.length - 1].sampleStart + segments[segments.length - 1].sampleDur + changeTime * segments.length;\n          if (lastLength <= Soundhandlerservice.wavJSO.Data.length) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.right.sampleDur - changeTime * segments.length > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n              startTime += changeTime;\n            });\n            sServObj.updateSegItemInLevel(name, neighbours.right.id, undefined, labelIdx, neighbours.right.sampleStart + startTime, neighbours.right.sampleDur - startTime);\n          }\n        }\n      } else {\n        // if expand or shrink on LEFT side\n        if (neighbours.left === undefined) {\n          // first element\n          var first = sServObj.getItemDetails(name, 0);\n          if (first.sampleStart + changeTime * (segments.length + 1) > 0) {\n            angular.forEach(segments, function (seg) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, tempItem.sampleStart - changeTime, labelIdx, tempItem.sampleDur + changeTime);\n            });\n          }\n        } else {\n          angular.forEach(segments, function (seg) {\n            if (seg.sampleDur + 1 + changeTime < 0) {\n              allow = false;\n            }\n          });\n          if (allow && neighbours.left.sampleDur - changeTime * segments.length > 0) {\n            startTime = 0;\n            angular.forEach(segments, function (seg, i) {\n              tempItem = sServObj.getItemFromLevelById(name, seg.id);\n              startTime = -(segments.length - i) * changeTime;\n              sServObj.updateSegItemInLevel(name, tempItem.id, undefined, labelIdx, tempItem.sampleStart + startTime, tempItem.sampleDur + changeTime);\n            });\n            sServObj.updateSegItemInLevel(name, neighbours.left.id, undefined, labelIdx, neighbours.left.sampleStart, neighbours.left.sampleDur - segments.length * changeTime);\n          }\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.calcDistanceToNearestZeroCrossing = function (sample) {\n      // walk right\n      var distRight = Infinity;\n      var distLeft = Infinity;\n      for (var i = sample; i < Soundhandlerservice.wavJSO.Data.length - 1; i++) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i + 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i + 1] >= 0) {\n          distRight = i - sample;\n          break;\n        }\n      }\n      // walk left\n      for (var i = sample; i > 1; i--) {\n        if (Soundhandlerservice.wavJSO.Data[i] >= 0 && Soundhandlerservice.wavJSO.Data[i - 1] < 0 || Soundhandlerservice.wavJSO.Data[i] < 0 && Soundhandlerservice.wavJSO.Data[i - 1] >= 0) {\n          distLeft = i - sample;\n          break;\n        }\n      }\n      var res;\n      if (Math.abs(distLeft) < Math.abs(distRight)) {\n        res = distLeft;\n      } else {\n        res = distRight + 1;\n      }\n      return res;\n    };\n    /**\n\t\t * get all labels (curAttr def applies) of a level and\n\t\t * return them as a flat array\n\t\t * @param levelName\n\t\t * @return array containing all labels (form==['x','y','z'])\n\t\t */\n    sServObj.getAllLabelsOfLevel = function (levelDetails) {\n      var curAttrDef = viewState.getCurAttrDef(levelDetails.level.name);\n      var labels = [];\n      for (var i = 0; i < levelDetails.level.items.length; i++) {\n        for (var j = 0; j < levelDetails.level.items[i].labels.length; j++) {\n          if (levelDetails.level.items[i].labels[j].name === curAttrDef) {\n            labels.push(levelDetails.level.items[i].labels[j].value);\n          }\n        }\n      }\n      return labels;\n    };\n    /**\n\t\t * returns level name of a given node id\n\t\t */\n    sServObj.getLevelName = function (nodeID) {\n      var levelName = null;\n      angular.forEach(DataService.getLevelData(), function (level) {\n        angular.forEach(level.items, function (item) {\n          if (item.id === nodeID) {\n            levelName = level.name;\n          }\n        });\n      });\n      return levelName;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('LinkService', [\n  'DataService',\n  function LinkService(DataService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * adds single links by pairing all childIds \n\t\t * with the parent id (form=={'fromID':fromID, 'toID':toID})\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t */\n    sServObj.insertLink = function (fromID, toID) {\n      DataService.insertLinkData({\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * adds single links to DataService\n\t\t * by pairing all childIds with the parent \n\t\t * at a given position\n\t\t * @param fromID father node\n\t\t * @param toID child node\n\t\t * @param order position of the node pair\n\t\t */\n    sServObj.insertLinkAt = function (fromID, toID, order) {\n      DataService.insertLinkDataAt(order, {\n        'fromID': fromID,\n        'toID': toID\n      });\n    };\n    /**\n\t\t * removes single link from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLink = function (fromID, toID) {\n      var ret = -1;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.deleteLinkDataAt(linkIdx);\n          ret = linkIdx;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given link exists \n\t\t * that matches the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.linkExists = function (fromID, toID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === fromID && link.toID === toID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasParents = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.toID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.hasChildren = function (ID) {\n      var ret = false;\n      angular.forEach(DataService.getLinkData(), function (link, linkIdx) {\n        if (link.fromID === ID) {\n          ret = true;\n        }\n        ;\n      });\n      return ret;\n    };\n    /**\n\t\t * checks if a given node has parents or children\n\t\t * @param ID node to check\n\t\t */\n    sServObj.isLinked = function (ID) {\n      return sServObj.hasChildren(ID) || sServObj.hasParents(ID);\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all childIds with the parent \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksTo = function (fromID, toIDs) {\n      angular.forEach(toIDs, function (toID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to children from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksTo = function (fromID, toIDs) {\n      var ret = [];\n      angular.forEach(toIDs, function (toID) {\n        sServObj.deleteLink(fromID, toID);\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n      });\n      return ret;\n    };\n    /**\n\t\t * adds multiple links to DataService\n\t\t * by pairing all parentIds with the child \n\t\t * id (form=={'fromID':fromID, 'toID':childId})\n\t\t */\n    sServObj.insertLinksFrom = function (fromIDs, toID) {\n      angular.forEach(fromIDs, function (fromID) {\n        sServObj.insertLink(fromID, toID);\n      });\n    };\n    /**\n\t\t * removes multiple links to parents from DataService\n\t\t * that match the form {'fromID':fromID, 'toID':toID}\n\t\t */\n    sServObj.deleteLinksFrom = function (fromIDs, toID) {\n      var ret = [];\n      angular.forEach(fromIDs, function (fromID) {\n        ret.push({\n          fromID: fromID,\n          toID: toID\n        });\n        sServObj.deleteLink(fromID, toID);\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksTo = function (toID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.toID === toID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * returns all links\n\t\t * that match the form {'toID':toID}\n\t\t */\n    sServObj.getLinksFrom = function (fromID) {\n      var ret = [];\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID) {\n          ret.push({\n            link: link,\n            order: linkOrder\n          });\n        }\n      });\n      return ret;\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID}) \n\t\t * to (to=={'fromID':fromID, 'toID':toNewID}) \n\t\t */\n    sServObj.changeLinkTo = function (fromID, toID, toNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromID, toNewID);\n        }\n      });\n    };\n    /**\n\t\t * change a Link (form=={'fromID':fromID, 'toID':toID}) \n\t\t * to (to=={'fromID':fromID, 'toID':toNewID}) \n\t\t */\n    sServObj.changeLinkFrom = function (fromID, toID, fromNewID) {\n      angular.forEach(DataService.getLinkData(), function (link, linkOrder) {\n        if (link.fromID === fromID && link.toID === toID) {\n          DataService.changeLinkDataAt(linkOrder, fromNewID, toID);\n        }\n      });\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkSegment = function (segments) {\n      var linksTo = [];\n      var linksFrom = [];\n      angular.forEach(segments, function (segment) {\n        angular.forEach(sServObj.getLinksTo(segment.id), function (found) {\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n        angular.forEach(sServObj.getLinksFrom(segment.id), function (found) {\n          linksFrom.push({\n            fromID: found.link.fromID,\n            toID: found.link.toID\n          });\n          sServObj.deleteLink(found.link.fromID, found.link.toID);\n        });\n      });\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkSegmentInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        sServObj.insertLink(found.fromID, found.toID);\n      });\n    };\n    /**\n\t\t * reorganizes multiple links from and to ID \n\t\t * if a boundary between two items is deleted \n\t\t */\n    sServObj.deleteLinkBoundary = function (ID, neighbourID) {\n      var linksTo = [];\n      var linksFrom = [];\n      var ord = 0;\n      if (neighbourID > 0) {\n        // if not first item\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          if (sServObj.linkExists(found.link.fromID, neighbourID)) {\n            ord = sServObj.deleteLink(found.link.fromID, ID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkTo(found.link.fromID, ID, neighbourID);\n            linksTo.push({\n              fromID: found.link.fromID,\n              toID: ID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          if (sServObj.linkExists(neighbourID, found.link.toID)) {\n            ord = sServObj.deleteLink(ID, found.link.toID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: true,\n              order: ord,\n              neighbourID: 0\n            });\n          } else {\n            sServObj.changeLinkFrom(ID, found.link.toID, neighbourID);\n            linksFrom.push({\n              fromID: ID,\n              toID: found.link.toID,\n              deleted: false,\n              order: ord,\n              neighbourID: neighbourID\n            });\n          }\n        });\n      } else {\n        angular.forEach(sServObj.getLinksTo(ID), function (found) {\n          ord = sServObj.deleteLink(found.link.fromID, ID);\n          linksTo.push({\n            fromID: found.link.fromID,\n            toID: ID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n        angular.forEach(sServObj.getLinksFrom(ID), function (found) {\n          ord = sServObj.deleteLink(ID, found.link.toID);\n          linksFrom.push({\n            fromID: ID,\n            toID: found.link.toID,\n            deleted: true,\n            order: ord,\n            neighbourID: 0\n          });\n        });\n      }\n      return {\n        linksTo: linksTo,\n        linksFrom: linksFrom\n      };\n    };\n    /**\n\t\t * removes multiple links from and to ID \n\t\t */\n    sServObj.deleteLinkBoundaryInvers = function (deleted) {\n      angular.forEach(deleted.linksTo, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkTo(found.fromID, found.neighbourID, found.toID);\n        }\n      });\n      angular.forEach(deleted.linksFrom, function (found) {\n        if (found.deleted) {\n          sServObj.insertLinkAt(found.fromID, found.toID, found.order);\n        } else {\n          sServObj.changeLinkFrom(found.neighbourID, found.toID, found.fromID);\n        }\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Websockethandler', [\n  '$q',\n  '$rootScope',\n  '$location',\n  '$timeout',\n  'HistoryService',\n  'Ssffparserservice',\n  'ConfigProviderService',\n  'viewState',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Espsparserservice',\n  'uuid',\n  'Binarydatamaniphelper',\n  'Ssffdataservice',\n  'modalService',\n  function Websockethandler($q, $rootScope, $location, $timeout, HistoryService, Ssffparserservice, ConfigProviderService, viewState, Wavparserservice, Soundhandlerservice, Espsparserservice, uuid, Binarydatamaniphelper, Ssffdataservice, modalService) {\n    // shared service object\n    var sServObj = {};\n    // Keep all pending requests here until they get responses\n    var callbacks = {};\n    // Create our websocket object with the address to the websocket\n    sServObj.ws = {};\n    // empty promise object to be resolved when connection is up\n    var conPromise = {};\n    var connected = false;\n    ////////////////////////////\n    // ws function\n    // broadcast on open\n    function wsonopen(message) {\n      connected = true;\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonmessage(message) {\n      listener(angular.fromJson(message.data));\n    }\n    function wsonerror(message) {\n      console.error('WEBSOCKET ERROR!!!!!');\n      $rootScope.$apply(conPromise.resolve(message));\n    }\n    function wsonclose(message) {\n      if (!message.wasClean && connected) {\n        modalService.open('views/error.html', 'A non clean disconnect to the server occurred! This probably means that the server is down. Please check the server and reconnect!').then(function () {\n          $rootScope.$broadcast('connectionDisrupted');\n        });\n      }\n      connected = false;\n      console.log('WEBSOCKET closed!!!!!');\n    }\n    function sendRequest(request) {\n      var defer = $q.defer();\n      var callbackId = getCallbackId();\n      callbacks[callbackId] = {\n        time: new Date(),\n        cb: defer\n      };\n      request.callbackID = callbackId;\n      sServObj.ws.send(angular.toJson(request));\n      // timeout request if not answered\n      $timeout(function () {\n        var tOutResp = {\n            'callbackID': callbackId,\n            'status': {\n              'type': 'ERROR:TIMEOUT',\n              'message': 'Sent request of type: ' + request.type + ' timed out after ' + ConfigProviderService.vals.main.serverTimeoutInterval + 'ms!  Please check the server...'\n            }\n          };\n        listener(tOutResp);\n      }, ConfigProviderService.vals.main.serverTimeoutInterval);\n      return defer.promise;\n    }\n    function listener(data) {\n      var messageObj = data;\n      // console.log(\"Received data from websocket: \", messageObj);\n      // If an object exists with callbackID in our callbacks object, resolve it\n      if (callbacks.hasOwnProperty(messageObj.callbackID)) {\n        // console.log(callbacks[messageObj.callbackID]);\n        // console.log('resolving callback: ' + messageObj.type + ' Nr.: ' + messageObj.callbackID);\n        switch (messageObj.type) {\n        case 'getESPSfile':\n          alert('espsfile');\n          //handleReceivedESPS(messageObj.fileName, messageObj.data);\n          break;\n        case 'getSSFFfile':\n          alert('ssfffile');\n          //handleReceivedSSFF(messageObj.fileName, messageObj.data);\n          break;\n        }\n        // resolve promise with data only\n        if (messageObj.status.type === 'SUCCESS') {\n          $rootScope.$apply(callbacks[messageObj.callbackID].cb.resolve(messageObj.data));\n        } else {\n          // show protocol error and disconnect from server\n          sServObj.closeConnect();\n          $rootScope.$broadcast('resetToInitState');\n          $rootScope.$apply(modalService.open('views/error.html', 'Communication error with server! Error message is: ' + messageObj.status.message));\n        }\n        delete callbacks[messageObj.callbackID];\n      } else {\n        if (messageObj.status.type === 'ERROR:TIMEOUT') {\n        } else {\n          modalService.open('views/error.html', 'What just happened? You should not be here...');\n        }\n      }\n    }\n    // This creates a new callback ID for a request\n    function getCallbackId() {\n      var newUUID = uuid.new();\n      return newUUID;\n    }\n    ///////////////////////////////////////////\n    // public api\n    sServObj.initConnect = function (url) {\n      var defer = $q.defer();\n      sServObj.ws = new WebSocket(url);\n      sServObj.ws.onopen = wsonopen;\n      sServObj.ws.onmessage = wsonmessage;\n      sServObj.ws.onerror = wsonerror;\n      sServObj.ws.onclose = wsonclose;\n      conPromise = defer;\n      return defer.promise;\n    };\n    //\n    sServObj.isConnected = function () {\n      return connected;\n    };\n    // close connection with ws\n    sServObj.closeConnect = function () {\n      if (sServObj.isConnected()) {\n        sServObj.ws.onclose = function () {\n        };\n        sServObj.ws.close();\n      } else {\n        console.log('WEBSOCKET ERROR: was not connected!');\n      }\n    };\n    ////////////////////////////\n    // EMU-webApp protocol begins here\n    //\n    // ws getProtocol\n    sServObj.getProtocol = function () {\n      var request = { type: 'GETPROTOCOL' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getProtocol\n    sServObj.getDoUserManagement = function () {\n      var request = { type: 'GETDOUSERMANAGEMENT' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws logOnUser\n    sServObj.logOnUser = function (name, pwd) {\n      var request = {\n          type: 'LOGONUSER',\n          userName: name,\n          pwd: pwd\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getConfigFile\n    sServObj.getDBconfigFile = function () {\n      var request = { type: 'GETGLOBALDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws getBundleList\n    sServObj.getBundleList = function () {\n      var request = { type: 'GETBUNDLELIST' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  getBundle\n    sServObj.getBundle = function (name, session) {\n      var request = {\n          type: 'GETBUNDLE',\n          name: name,\n          session: session\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  saveBundle\n    sServObj.saveBundle = function (bundleData) {\n      var request = {\n          type: 'SAVEBUNDLE',\n          data: bundleData\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  disconnecting\n    sServObj.disconnectWarning = function () {\n      var request = { type: 'DISCONNECTWARNING' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  GetDoEditDBConfig\n    sServObj.getDoEditDBConfig = function () {\n      var request = { type: 'GETDOEDITDBCONFIG' };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    // ws  editDBConfig with subtype and data\n    sServObj.editDBConfig = function (subtype, data) {\n      var request = {\n          type: 'EDITDBCONFIG',\n          subtype: subtype,\n          data: data\n        };\n      // Storing in a variable for clarity on what sendRequest returns\n      var promise = sendRequest(request);\n      return promise;\n    };\n    //\n    // EMU-webApp protocol ends here\n    ////////////////////////////\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Binarydatamaniphelper', function Binarydatamaniphelper() {\n  // shared service object\n  var sServObj = {};\n  /**\n\t\t *\n\t\t */\n  sServObj.base64ToArrayBuffer = function (stringBase64) {\n    var binaryString = window.atob(stringBase64);\n    var len = binaryString.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n      var ascii = binaryString.charCodeAt(i);\n      bytes[i] = ascii;\n    }\n    return bytes.buffer;\n  };\n  /**\n\t\t *\n\t\t */\n  sServObj.arrayBufferToBase64 = function (buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  };\n  /**\n\t\t *\n\t\tsServObj.stringToArrayBuffer = function (str) {\n\t\t\tvar ab = new ArrayBuffer(str.length);\n\t\t\tvar view = new Uint8Array(ab);\n\t\t\tfor (var i = 0; i < str.length; ++i) {\n\t\t\t\tview[i] = str.charCodeAt(i);\n\t\t\t}\n\t\t\treturn ab;\n\t\t};\n\t\t */\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').service('Appcachehandler', [\n  '$http',\n  'modalService',\n  function Appcachehandler($http, modalService) {\n    // shared service object\n    var sServObj = {};\n    var appCache = window.applicationCache;\n    // var cacheProperties = {\n    // \tfilesDownloaded: 0,\n    // \ttotalFiles: 0\n    // };\n    // function getTotalFiles() {\n    // \t// First, reset the total file count and download count.\n    // \tcacheProperties.filesDownloaded = 0;\n    // \tcacheProperties.totalFiles = 0;\n    // \t$http.get('manifest.appcache').success(function (content) {\n    // \t\t// console.log(content);\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp(\n    // \t\t\t\t'(NETWORK|FALLBACK):' +\n    // \t\t\t\t'((?!(NETWORK|FALLBACK|CACHE):)[\\\\w\\\\W]*)',\n    // \t\t\t\t'gi'\n    // \t\t\t),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out all comments.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('#[^\\\\r\\\\n]*(\\\\r\\\\n?|\\\\n)', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out the cache manifest header and\n    // \t\t// trailing slashes.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('CACHE MANIFEST\\\\s*|\\\\s*$', 'g'),\n    // \t\t\t''\n    // \t\t);\n    // \t\t// Strip out extra line breaks and replace with\n    // \t\t// a hash sign that we can break on.\n    // \t\tcontent = content.replace(\n    // \t\t\tnew RegExp('[\\\\r\\\\n]+', 'g'),\n    // \t\t\t'#'\n    // \t\t);\n    // \t\t// Get the total number of files.\n    // \t\tvar totalFiles = content.split('#').length;\n    // \t\t// Store the total number of files. Here, we are\n    // \t\t// adding one for *THIS* file, which is cached\n    // \t\t// implicitly as it points to the manifest.\n    // \t\tcacheProperties.totalFiles = (totalFiles + 1);\n    // \t\t// console.log('##########################');\n    // \t\t// alert('INFO: appcache update of: ' + cacheProperties.totalFiles + ' files');\n    // \t});\n    // }\n    // function handleCheckingEvent(e) {\n    // \tconsole.log('###### handleCheckingEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleNoupdateEvent(e) {\n    // \tconsole.log('###### handleNoupdateEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleDownloadingEvent(e) {\n    // \tconsole.log('######## handleDownloadingEvent ##########');\n    // \tconsole.log(e);\n    // \tgetTotalFiles();\n    // }\n    // function handleProgressEvent(e) {\n    // \tconsole.log('###### handleProgressEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    // function handleCachedEvent(e) {\n    // \tconsole.log('###### handleCachedEvent ##########');\n    // \tconsole.log(e);\n    // }\n    /**\n\t\t *\n\t\t */\n    sServObj.handleUpdatereadyEvent = function () {\n      modalService.open('views/confirmModal.html', 'A new version of the EMU-WebApp is available and has already been downloaded and cached in your browser. Would you like to use it? CAUTION: A reload will delete all current changes... TIP: the next time you use the EMU-webApp you will automatically use the updated version)').then(function (res) {\n        if (res) {\n          appCache.swapCache();\n          window.location.reload();\n        }\n      });\n    };\n    // function handleObsoleteEvent(e) {\n    // \tconsole.log('###### handleObsoleteEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // function handleErrorEvent(e) {\n    // \tconsole.log('###### handleErrorEvent ##########');\n    // \tconsole.log(e);\n    // }\n    // // bind evts\n    // // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('checking', handleCheckingEvent, false);\n    // appCache.addEventListener('noupdate', handleNoupdateEvent, false);\n    // appCache.addEventListener('downloading', handleDownloadingEvent, false);\n    // appCache.addEventListener('progress', handleProgressEvent, false);\n    // appCache.addEventListener('cached', handleCachedEvent, false);\n    appCache.addEventListener('updateready', sServObj.handleUpdatereadyEvent, false);\n    // appCache.addEventListener('obsolete', handleObsoleteEvent, false);\n    // appCache.addEventListener('error', handleErrorEvent, false);\n    // /////////////////////////////////////////////////\n    // // public api\n    sServObj.checkForNewVersion = function () {\n      // console.log('check for new version');\n      if (appCache.status !== 0 && appCache.status !== 3) {\n        // uncached == 0 & downloading == 3\n        console.log('INFO: appCache.status: ' + appCache.status);\n        appCache.update();\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('spectSettingsCtrl', [\n  '$scope',\n  'modalService',\n  'viewState',\n  'DataService',\n  'mathHelperService',\n  'Soundhandlerservice',\n  function ($scope, modalService, viewState, DataService, mathHelperService, Soundhandlerservice) {\n    $scope.vs = viewState;\n    $scope.options = Object.keys($scope.vs.getWindowFunctions());\n    $scope.selWindowInfo = {};\n    $scope.selWindowInfo.name = Object.keys($scope.vs.getWindowFunctions())[$scope.vs.spectroSettings.window - 1];\n    $scope.errorID = [];\n    $scope.upperBoundary = '';\n    $scope.modalVals = {\n      'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n      'rangeTo': $scope.vs.spectroSettings.rangeTo,\n      'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n      'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n      'window': $scope.vs.spectroSettings.window,\n      'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n      'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n      'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n      '_fftN': 512,\n      '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    //////////////////////////\n    // window size functions\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeInSamples = function () {\n      $scope.modalVals._windowSizeInSamples = Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcFftN = function () {\n      var fftN = mathHelperService.calcClosestPowerOf2Gt($scope.modalVals._windowSizeInSamples);\n      // fftN must be greater than 512 (leads to better resolution of spectrogram)\n      if (fftN < 512) {\n        fftN = 512;\n      }\n      $scope.modalVals._fftN = fftN;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.calcWindowSizeVals = function () {\n      $scope.calcWindowSizeInSamples();\n      $scope.calcFftN();\n    };\n    //\n    ////////////////////\n    /**\n\t\t *\n\t\t */\n    $scope.reset = function () {\n      $scope.errorID = [];\n      $scope.modalVals = {\n        'rangeFrom': $scope.vs.spectroSettings.rangeFrom,\n        'rangeTo': $scope.vs.spectroSettings.rangeTo,\n        'dynamicRange': $scope.vs.spectroSettings.dynamicRange,\n        'windowSizeInSecs': $scope.vs.spectroSettings.windowSizeInSecs,\n        'window': $scope.vs.spectroSettings.window,\n        'drawHeatMapColors': $scope.vs.spectroSettings.drawHeatMapColors,\n        'preEmphasisFilterFactor': $scope.vs.spectroSettings.preEmphasisFilterFactor,\n        'heatMapColorAnchors': viewState.spectroSettings.heatMapColorAnchors,\n        '_fftN': 512,\n        '_windowSizeInSamples': Soundhandlerservice.wavJSO.SampleRate * $scope.vs.spectroSettings.windowSizeInSecs\n      };\n      modalService.close();\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cssError = function (id, id2) {\n      if ($scope.errorID[id]) {\n        return { 'background': '#f00' };\n      }\n      if (id2 !== undefined) {\n        if ($scope.errorID[id2]) {\n          return { 'background': '#f00' };\n        }\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.htmlError = function (id) {\n      return $scope.errorID[id];\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveSpectroSettings = function () {\n      var error = false;\n      $scope.errorID.forEach(function (entry) {\n        if (entry === true) {\n          error = true;\n        }\n      });\n      if (!error) {\n        viewState.setspectroSettings($scope.modalVals.windowSizeInSecs, $scope.modalVals.rangeFrom, $scope.modalVals.rangeTo, $scope.modalVals.dynamicRange, $scope.selWindowInfo.name, $scope.modalVals.drawHeatMapColors, $scope.modalVals.preEmphasisFilterFactor, $scope.modalVals.heatMapColorAnchors);\n        $scope.reset();\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.checkSpectroSettings = function () {\n      if ($scope.modalVals.heatMapColorAnchors[0][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[0][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[0][2] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[1][2] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][0] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][1] % 1 !== 0 || $scope.modalVals.heatMapColorAnchors[2][2] % 1 !== 0) {\n        $scope.errorID[8] = true;\n      } else {\n        $scope.errorID[8] = false;\n      }\n      if (isNaN($scope.modalVals.preEmphasisFilterFactor * Soundhandlerservice.wavJSO.SampleRate)) {\n        $scope.errorID[7] = true;\n      } else {\n        $scope.errorID[7] = false;\n      }\n      if (isNaN(Soundhandlerservice.wavJSO.SampleRate * $scope.modalVals.windowSizeInSecs)) {\n        $scope.errorID[6] = true;\n      } else {\n        $scope.errorID[6] = false;\n      }\n      if ($scope.modalVals.dynamicRange % 1 !== 0) {\n        $scope.errorID[5] = true;\n      } else {\n        $scope.errorID[5] = false;\n      }\n      if ($scope.modalVals.rangeFrom % 1 !== 0) {\n        $scope.errorID[4] = true;\n      } else {\n        $scope.errorID[4] = false;\n      }\n      if ($scope.modalVals.rangeTo % 1 !== 0) {\n        $scope.errorID[3] = true;\n      } else {\n        $scope.errorID[3] = false;\n      }\n      if ($scope.modalVals.rangeFrom < 0) {\n        $scope.errorID[2] = true;\n      } else {\n        $scope.errorID[2] = false;\n      }\n      $scope.upperBoundary = DataService.data.sampleRate / 2;\n      if ($scope.modalVals.rangeTo > $scope.upperBoundary) {\n        $scope.errorID[1] = true;\n      } else {\n        $scope.errorID[1] = false;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').filter('regex', function () {\n  return function (input, regex) {\n    var patt = new RegExp(regex.toLowerCase());\n    var out = [];\n    for (var i = 0; i < input.length; i++) {\n      if (patt.test(input[i].name.toLowerCase())) {\n        out.push(input[i]);\n      }\n    }\n    return out;\n  };\n});\n'use strict';\nangular.module('emuwebApp').filter('levelsFilter', [\n  'ConfigProviderService',\n  'viewState',\n  function (ConfigProviderService, viewState) {\n    return function (input) {\n      if (input) {\n        var patt1 = new RegExp('SEGMENT');\n        var patt2 = new RegExp('EVENT');\n        var out = [];\n        var idx;\n        for (var i = 0; i < input.length; i++) {\n          if (patt1.test(input[i].type) || patt2.test(input[i].type)) {\n            if (ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases !== undefined) {\n              idx = ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order.indexOf(input[i].name);\n              if (idx !== -1) {\n                out[idx] = input[i];\n              }\n            }\n          }\n        }\n        // console.log(out)\n        return out;\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ModalCtrl', [\n  '$scope',\n  'ArrayHelperService',\n  'modalService',\n  'viewState',\n  'LevelService',\n  'HistoryService',\n  'ConfigProviderService',\n  function ($scope, ArrayHelperService, modalService, viewState, LevelService, HistoryService, ConfigProviderService) {\n    $scope.cps = ConfigProviderService;\n    $scope.data = undefined;\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.saveChanges = function (name) {\n      modalService.close();\n    };\n    /**\n\t\t *  Save changes made on SSFF\n\t\t */\n    $scope.discardChanges = function (name) {\n      modalService.close();\n    };\n    /**\n\t\t *  Rename a level\n\t\t */\n    $scope.renameLevel = function () {\n      LevelService.renameLevel(modalService.dataIn, $scope.data, viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'RENAMELEVEL',\n        'newname': $scope.data,\n        'name': modalService.dataIn,\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      modalService.close();\n    };\n    /**\n\t\t *  Delete a complete level from LevelService\n\t\t */\n    $scope.deleteLevel = function () {\n      var lvl = LevelService.getLevelDetails(viewState.getcurClickLevelName());\n      LevelService.deleteLevel(viewState.getcurClickLevelIndex(), viewState.curPerspectiveIdx);\n      HistoryService.addObjToUndoStack({\n        'type': 'ANNOT',\n        'action': 'DELETELEVEL',\n        'level': lvl.level,\n        'id': viewState.getcurClickLevelIndex(),\n        'curPerspectiveIdx': viewState.curPerspectiveIdx\n      });\n      modalService.close();\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showMenu', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showMenu, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, 'emuwebapp-expandWidthTo200px');\n          } else {\n            $animate.removeClass(element, 'emuwebapp-expandWidthTo200px');\n            $animate.addClass(element, 'emuwebapp-shrinkWidthTo0px');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('showTwod', [\n  '$animate',\n  function ($animate) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.$watch(attrs.showTwod, function (newVal) {\n          if (newVal) {\n            $animate.addClass(element, '.slideIn2dCanvases');\n          } else {\n            $animate.removeClass(element, '.slideIn2dCanvases');\n          }\n        });\n      }\n    };\n  }\n]);\n// simple animation to add slideLeft class\nangular.module('emuwebApp').animation('.slideIn2dCanvases', function () {\n  return {\n    addClass: function (element, className) {\n      element.addClass('slide2dCanvases');\n    },\n    removeClass: function (element, className) {\n      element.removeClass('slide2dCanvases');\n    }\n  };\n});\nangular.module('emuwebApp').directive('bgSplitter', [\n  '$rootScope',\n  'viewState',\n  function ($rootScope, viewState) {\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      scope: { showTwoDimCans: '@' },\n      template: '<div class=\"emuwebapp-split-panes vertical\" ng-transclude></div>',\n      controller: [\n        '$scope',\n        function ($scope) {\n          $scope.panes = [];\n          $scope.bottomRightResizePane;\n          this.addPane = function (pane) {\n            if ($scope.panes.length > 1)\n              throw 'splitters can only have two panes';\n            $scope.panes.push(pane);\n            return $scope.panes.length;\n          };\n          this.setBottomRightResizePane = function (pane) {\n            $scope.bottomRightResizePane = pane;\n          };\n        }\n      ],\n      link: function (scope, element, attrs) {\n        var dragBottomRightResizePaneTopResizer = false;\n        var dragBottomRightResizePaneLeftResizer = false;\n        var dragBottomRightResizePaneCornerResizer = false;\n        // create split pane view\n        var handler = angular.element('<div id=\"emuwebapp-split-handler\" class=\"emuwebapp-split-handler\"><span></span></div>');\n        var pane1 = scope.panes[0];\n        var pane2 = scope.panes[1];\n        var pane3 = scope.bottomRightResizePane;\n        var bottomRightResizePaneTopResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneTopResizer\"></div>');\n        var bottomRightResizePaneLeftResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneLeftResizer\"></div>');\n        var bottomRightResizePaneCornerResizer = angular.element('<div class=\"emuwebapp-bottomRightResizePaneCornerResizer\"></div>');\n        pane3.elem.prepend(bottomRightResizePaneLeftResizer);\n        pane3.elem.prepend(bottomRightResizePaneTopResizer);\n        pane3.elem.prepend(bottomRightResizePaneCornerResizer);\n        var pane1Min = pane1.minSize || 0;\n        var pane2Min = pane2.minSize || 0;\n        var dragSplitPaneResizer = false;\n        var drag = false;\n        pane1.elem.after(handler);\n        attrs.$observe('showTwoDimCans', function (val) {\n          if (val === 'false') {\n            scope.bottomRightResizePane.elem.hide();\n          } else {\n            scope.bottomRightResizePane.elem.show();\n          }\n        });\n        ////////////////////\n        // bindings\n        element.bind('mousemove', function (ev) {\n          if (!drag)\n            return;\n          var bounds = element[0].getBoundingClientRect();\n          var pos = 0;\n          if (dragSplitPaneResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            // perc = pos/height * 100;\n            // console.log(perc);\n            if (pos < pane1Min)\n              return;\n            if (height - pos < pane2Min)\n              return;\n            handler.css('top', pos + 'px');\n            pane1.elem.css('height', pos + 'px');\n            pane2.elem.css('top', pos + 'px');\n            viewState.setdragBarHeight(pos);\n          }\n          if (dragBottomRightResizePaneTopResizer) {\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneLeftResizer) {\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n          if (dragBottomRightResizePaneCornerResizer) {\n            // do height and top\n            var height = bounds.bottom - bounds.top;\n            pos = ev.clientY - bounds.top;\n            if (pos <= 10 || height - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('top', pos + 'px');\n            var tmp = height - pos;\n            pane3.elem.css('height', tmp + 'px');\n            // do width and left\n            var width = bounds.right - bounds.left;\n            pos = ev.clientX - bounds.left;\n            if (pos <= 10 || width - pos <= 10) {\n              return;\n            }\n            pane3.elem.css('left', pos + 'px');\n            var tmp = width - pos;\n            pane3.elem.css('width', tmp + 'px');\n          }\n        });\n        handler.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragSplitPaneResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneTopResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneTopResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneLeftResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneLeftResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        bottomRightResizePaneCornerResizer.bind('mousedown', function (ev) {\n          ev.preventDefault();\n          drag = true;\n          dragBottomRightResizePaneCornerResizer = true;\n          viewState.setdragBarActive(true);\n          $rootScope.$digest();\n        });\n        angular.element(document).bind('mouseup', function (ev) {\n          drag = false;\n          dragSplitPaneResizer = false;\n          dragBottomRightResizePaneTopResizer = false;\n          dragBottomRightResizePaneLeftResizer = false;\n          dragBottomRightResizePaneCornerResizer = false;\n          viewState.setdragBarActive(false);\n          $rootScope.$digest();\n        });\n      }\n    };\n  }\n]).directive('bgPane', function () {\n  return {\n    restrict: 'E',\n    require: '^bgSplitter',\n    replace: true,\n    transclude: true,\n    scope: {\n      minSize: '=',\n      type: '@',\n      showTwoDimCans: '@'\n    },\n    template: '<div class=\"{{typeclass}}\" ng-transclude></div>',\n    link: function (scope, element, attrs, bgSplitterCtrl) {\n      var newElement;\n      if (scope.type !== 'emuwebapp-bottomRightResizePane') {\n        scope.elem = element;\n        scope.index = bgSplitterCtrl.addPane(scope);\n        scope.typeclass = 'split-pane' + scope.index;\n      } else {\n        scope.elem = element;\n        scope.index = 3;\n        scope.typeclass = 'emuwebapp-bottomRightResizePane';\n        bgSplitterCtrl.setBottomRightResizePane(scope);\n      }\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('ssffTrack', [\n  '$timeout',\n  'viewState',\n  'ConfigProviderService',\n  function ($timeout, viewState, ConfigProviderService) {\n    return {\n      templateUrl: 'views/ssffTrack.html',\n      restrict: 'E',\n      link: function postLink(scope, element, attrs) {\n        // select the needed DOM elements from the template\n        var canvasLength = element.find('canvas').length;\n        var ssffCanvas = element.find('canvas')[1];\n        var markupCanvas = element.find('canvas')[canvasLength - 1];\n        // var context = canvas0.getContext('2d');\n        var markupCtx = markupCanvas.getContext('2d');\n        var trackName;\n        attrs.$observe('trackName', function (val) {\n          if (val) {\n            trackName = val;\n          }\n        });\n        scope.order = attrs.order;\n        /////////////////////\n        // watches\n        //\n        scope.$watch('vs.submenuOpen', function () {\n          $timeout(scope.drawSsffTrackMarkup, scope.cps.vals.colors.transitionTime);\n        });\n        //\n        scope.$watch('vs.timelineSize', function () {\n          $timeout(scope.drawSsffTrackMarkup, scope.cps.vals.colors.transitionTime);\n        });\n        scope.$watch('vs.curViewPort', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundary', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        scope.$watch('vs.movingBoundarySample', function () {\n          if (!$.isEmptyObject(scope.shs)) {\n            if (!$.isEmptyObject(scope.shs.wavJSO)) {\n              scope.drawSsffTrackMarkup();\n            }\n          }\n        }, true);\n        //\n        /////////////////////\n        /**\n         *\n         */\n        scope.drawSsffTrackMarkup = function () {\n          if (!$.isEmptyObject(scope.ssffds.data)) {\n            if (scope.ssffds.data.length !== 0) {\n              markupCtx.clearRect(0, 0, markupCtx.canvas.width, markupCtx.canvas.height);\n              // draw moving boundary line if moving\n              scope.dhs.drawMovingBoundaryLine(markupCtx);\n              // draw current viewport selected\n              scope.dhs.drawCurViewPortSelected(markupCtx, false);\n              // draw min max an name of track\n              var tr = scope.cps.getSsffTrackConfig(trackName);\n              var col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n              scope.dhs.drawMinMaxAndName(markupCtx, trackName, col._minVal, col._maxVal, 2);\n            }\n          }\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('progressThing', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-progressThing\">{{vs.somethingInProgressTxt}}</div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the progressThing directive');\n        attrs.$observe('showThing', function (newVal) {\n          if (newVal === 'true') {\n            // $animate.removeClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.removeClass(element, 'emuwebapp-animationStopped');\n            $animate.addClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.addClass(element, 'emuwebapp-animationRunning');\n          } else {\n            // $animate.addClass(element, 'hideProgressThing');\n            $animate.removeClass(element, 'emuwebapp-expandHeightTo20px');\n            $animate.removeClass(element, 'emuwebapp-animationRunning');\n            $animate.addClass(element, 'emuwebapp-shrinkHeightTo0px');\n            $animate.addClass(element, 'emuwebapp-animationStopped');\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('historyActionPopup', [\n  '$animate',\n  function ($animate) {\n    return {\n      template: '<div class=\"emuwebapp-historyActionPopup\"> <div class=\"emuwebapp-historyActionModal\">{{vs.historyActionTxt}}</div></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        ////////////////\n        //watches\n        scope.$watch('vs.historyActionTxt', function () {\n          if (scope.vs.historyActionTxt !== '') {\n            $animate.addClass(element, 'emuwebapp-historyActionPopupThere').then(function () {\n              scope.vs.historyActionTxt = '';\n              $animate.removeClass(element, 'emuwebapp-historyActionPopupThere');\n              scope.$apply();\n            });\n          }\n        }, true);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dragout', [\n  'DataService',\n  'loadedMetaDataService',\n  'browserDetector',\n  'ConfigProviderService',\n  function (DataService, loadedMetaDataService, browserDetector, ConfigProviderService) {\n    return {\n      restrict: 'A',\n      replace: true,\n      scope: { name: '@' },\n      link: function (scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        var el = element[0];\n        var dragIcon = document.createElement('img');\n        dragIcon.src = 'img/exportBtn.png';\n        var dataString = '';\n        scope.generateURL = function () {\n          return scope.getURL(angular.toJson(DataService.getData(), true));\n        };\n        scope.isActive = function () {\n          return attrs.name === loadedMetaDataService.getCurBndl().name && scope.cps.vals.main.comMode === 'embedded';\n        };\n        scope.getURL = function (data) {\n          var objURL;\n          if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n            objURL = webkitURL.createObjectURL(scope.getBlob(data));\n          } else {\n            objURL = URL.createObjectURL(scope.getBlob(data));\n          }\n          return objURL;\n        };\n        scope.getBlob = function (data) {\n          var blob;\n          try {\n            blob = new Blob([data], { type: 'text/plain' });\n          } catch (e) {\n            // Backwards-compatibility\n            window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n            blob = new BlobBuilder();\n            blob.append(data);\n            blob = blob.getBlob();\n          }\n          return blob;\n        };\n        el.addEventListener('dragstart', function (e) {\n          if (scope.isActive()) {\n            this.classList.add('drag');\n            var url = scope.generateURL();\n            if (browserDetector.isBrowser.Firefox() || browserDetector.isBrowser.Chrome()) {\n              e.dataTransfer.setDragImage(dragIcon, -10, -10);\n              e.dataTransfer.effectAllowed = 'move';\n              e.dataTransfer.setData('DownloadURL', 'application/json:' + attrs.name + '_annot.json:' + url);\n            }\n          } else {\n            console.log('dropping inactive bundles is not allowed');\n          }\n          return false;\n        }, false);\n        el.addEventListener('dragend', function (e) {\n          if (scope.isActive()) {\n            this.classList.remove('drag');\n          }\n          return false;\n        }, false);\n        el.addEventListener('mousedown', function (e) {\n          if (scope.isActive()) {\n            el.setAttribute('draggable', true);\n          } else {\n            el.setAttribute('draggable', false);\n            el.removeAttribute('dragable');\n          }\n        }, false);\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuhierarchy', [\n  'viewState',\n  'DataService',\n  'LevelService',\n  'HierarchyLayoutService',\n  'Soundhandlerservice',\n  function (viewState, DataService, LevelService, HierarchyLayoutService, Soundhandlerservice) {\n    return {\n      template: '<div class=\"emuwebapp-hierarchy-container\"></div>',\n      restrict: 'E',\n      scope: {\n        path: '=',\n        vertical: '=',\n        playing: '='\n      },\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        //////////////////////\n        // private variables\n        scope.selectedItem;\n        //\n        //////////////////////\n        //////////////////////\n        // watches \n        scope.$watch('path', function (newValue) {\n          if (newValue !== undefined) {\n            console.debug('Rendering due to path change: ', newValue);\n            scope.selectVisibleNodes();\n            scope.render();\n          }\n        }, false);\n        scope.$watch('vertical', function (newValue) {\n          if (newValue !== undefined) {\n            console.debug('Rendering due to rotation: ', newValue);\n            scope.selectVisibleNodes();\n            scope.render();\n          }\n        }, false);\n        scope.$watch('viewState.curLevelAttrDefs', function (newValue) {\n          if (newValue !== undefined) {\n            console.debug('Rendering due to attribute change: ', newValue);\n            scope.render();\n          }\n        }, true);\n        scope.$watch('playing', function (newValue) {\n          if (newValue !== undefined) {\n            console.debug('Play() triggered', newValue, scope.selectedItem);\n            if (typeof scope.selectedItem !== 'undefined' && newValue !== 0) {\n              scope.play(scope.selectedItem);\n            }\n          }\n        }, true);\n        //\n        //////////////////////\n        //////////////////////\n        // helper functions\n        /**\n\t * Function to center node when clicked/dropped so node doesn't get lost when\n\t * collapsing/moving with large amount of children.\n\t */\n        scope.centerNode = function (node) {\n          var x = -node._x + scope.width / 2;\n          var y = -node._y + scope.height / 2;\n          svg.transition().duration(scope.duration).attr('transform', scope.getOrientatedTransform() + 'translate(' + x + ',' + y + ')');\n          zoomListener.translate([\n            x,\n            y\n          ]);\n        };\n        /**\n\t * The zoom function is called by the zoom listener, which listens for d3 zoom events and must be appended to the svg element\n\t */\n        scope.zoom = function () {\n          svg.attr('transform', scope.getOrientatedTransform());\n        };\n        scope.getOrientatedTransform = function () {\n          var transform = 'scale(' + zoomListener.scale() + ')';\n          transform += 'translate(' + zoomListener.translate() + ')';\n          if (scope.vertical) {\n            transform += 'scale(-1,1),rotate(90)';\n          } else {\n            transform += 'rotate(0)';\n          }\n          return transform;\n        };\n        scope.getOrientatedNodeTransform = function (d) {\n          // Parameter d is never used because this is independent from the node's position\n          if (scope.vertical) {\n            return 'scale(-1,1)rotate(90)';\n          } else {\n            return 'scale(1,1)rotate(0)';\n          }\n        };\n        scope.getNodeText = function (d) {\n          var level = viewState.getCurAttrDef(LevelService.getLevelName(d.id));\n          for (var i = 0; i < d.labels.length; ++i) {\n            if (d.labels[i].name === level) {\n              return d.labels[i].value;\n            }\n          }\n          console.debug('Likely a bug: Did not find the label selected for display', 'Selected level:', level, 'Node: ', d);\n          return 'NO VALUE';\n        };\n        scope.getOrientatedTextAnchor = function (d) {\n          if (scope.vertical) {\n            return 'middle';\n          } else {\n            return 'begin';\n          }\n        };\n        scope.getOrientatedTextX = function (d) {\n          if (scope.vertical) {\n            return 0;\n          } else {\n            return 10;\n          }\n        };\n        scope.getOrientatedTextY = function (d) {\n          if (scope.vertical) {\n            return '1.45em';\n          } else {\n            return '0.35em';\n          }\n        };\n        scope.getPath = function (d) {\n          return 'M' + d._fromX + ' ' + d._fromY + 'Q' + d._fromX + ' ' + d._toY + ' ' + d._toX + ' ' + d._toY;\n        };\n        scope.nodeOnClick = function (d) {\n          console.debug('Clicked node', d);\n          //scope.centerNode(d);\n          // (De-)Collapse sub-tree\n          var isCollapsing;\n          if (typeof d._collapsed === 'undefined' || d._collapsed === false) {\n            isCollapsing = true;\n          } else if (d._collapsed === true) {\n            isCollapsing = false;\n          } else {\n            console.debug('Likely a bug: the following node appears to be neither collapsed nor uncollapsed:', d);\n          }\n          d._collapsed = isCollapsing;\n          var currentDescendant;\n          var descendants = HierarchyLayoutService.findChildren(d, scope.path);\n          while (descendants.length > 0) {\n            currentDescendant = descendants.pop();\n            descendants = descendants.concat(HierarchyLayoutService.findChildren(currentDescendant, scope.path));\n            if (isCollapsing) {\n              if (typeof currentDescendant._collapsedParents === 'undefined') {\n                currentDescendant._collapsedParents = 1;\n              } else {\n                currentDescendant._collapsedParents += 1;\n              }\n            } else {\n              currentDescendant._collapsedParents -= 1;\n            }\n            currentDescendant._collapsePosition = [\n              d._x,\n              d._y\n            ];\n          }\n          scope.selectVisibleNodes();\n          scope.render();\n        };\n        scope.nodeOnRightClick = function (d) {\n          scope.play(d);\n        };\n        scope.nodeOnMouseOver = function (d) {\n          scope.selectedItem = d;\n          scope.render();\n        };\n        scope.play = function (d) {\n          var timeInfoLevel = scope.path[0];\n          if (typeof timeInfoLevel === 'undefined') {\n            console.debug('Likely a bug: There is no path selection. Not executing play():', d);\n            return;\n          }\n          var timeInfoType = LevelService.getLevelDetails(timeInfoLevel).level.type;\n          var firstTimeItem = null;\n          var lastTimeItem = null;\n          var itemList = [d];\n          var currentItem;\n          while (itemList.length > 0) {\n            currentItem = itemList.pop();\n            if (currentItem.labels[0].name === timeInfoLevel) {\n              if (lastTimeItem === null) {\n                lastTimeItem = currentItem;\n              }\n              firstTimeItem = currentItem;\n            }\n            itemList = itemList.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n          }\n          console.debug('Node info for playback: ', timeInfoType, d, firstTimeItem, lastTimeItem);\n          if (firstTimeItem === null) {\n            console.debug('No time information found for node, aborting playback', d);\n            return;\n          }\n          var startSample = 0;\n          var endSample = 0;\n          if (timeInfoType === 'EVENT') {\n            startSample = firstTimeItem.samplePoint;\n            endSample = lastTimeItem.samplePoint;\n          } else if (timeInfoType === 'SEGMENT') {\n            startSample = firstTimeItem.sampleStart;\n            endSample = lastTimeItem.sampleStart + lastTimeItem.sampleDur;\n          }\n          console.debug('Sample information for playback:', startSample, endSample);\n          Soundhandlerservice.playFromTo(startSample, endSample);\n        };\n        scope.selectVisibleNodes = function () {\n          // Try to set all nodes to invisible. Later we will search all\n          // paths and if we find one uncollasped path to a node, that\n          // node will be set visible.\n          if (scope.path !== undefined && scope.path.length > 0) {\n            var rootLevelItems = LevelService.getLevelDetails(scope.path[scope.path.length - 1]).level.items;\n            var items = [];\n            items = items.concat(rootLevelItems);\n            var currentItem;\n            while (items.length > 0) {\n              currentItem = items.pop();\n              items = items.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n              currentItem._visible = false;\n            }\n            // Now all nodes on the selected scope.path have been set invisible\n            items = [];\n            items = items.concat(rootLevelItems);\n            while (items.length > 0) {\n              currentItem = items.pop();\n              if (!currentItem._collapsed) {\n                items = items.concat(HierarchyLayoutService.findChildren(currentItem, scope.path));\n              }\n              currentItem._visible = true;\n            }\n          }\n        };\n        //\n        /////////////////////////////\n        /////////////////////////////\n        // inital d3.js setup stuff\n        /*var margin = {\n            top: 0,\n            right: 0,\n            bottom: 0,\n            left: 0\n          },\n          barHeight = 20,\n          percent = d3.format('%'),\n\t  duration = 750;\n\t*/\n        scope.element = element;\n        scope.width = 0;\n        scope.height = 0;\n        scope.duration = 750;\n        // scaleExtent limits the amount of zooming possible\n        var zoomListener = d3.behavior.zoom().scaleExtent([\n            0.5,\n            10\n          ]).on('zoom', scope.zoom);\n        // Create the d3 element and position it based on margins\n        var svg = d3.select(element[0]).append('svg').attr('width', '100%').attr('height', '100%').call(zoomListener).on('dblclick.zoom', null).append('g').append('g');\n        scope.element = element;\n        //\n        /////////////////////////////\n        /**\n         *\n         */\n        scope.render = function () {\n          ////\n          // Get current width and height of SVG\n          scope.width = parseInt(d3.select(scope.element[0]).style('width'), 10);\n          scope.height = parseInt(d3.select(scope.element[0]).style('height'), 10);\n          // Set orientation\n          svg.transition().duration(scope.duration).attr('transform', scope.getOrientatedTransform());\n          /////\n          // Compute the new tree layout (first nodes and then links)\n          //\n          var nodes = [];\n          // At the moment I have two different approaches to calculating the layout of a hierarchy\n          //\n          // The first is simpler and is used by first calling layoutNonItemLevel() for the bottom-most level (the one with time information)\n          // and then calling layoutItemLevel() for all other levels. Unfortunately, it will in some cases render multiple nodes to the same\n          // position (happens when they share the same set of children).\n          //\n          // The second one looks simpler in this file, because it is completely done in one function. But that function is actually quite\n          // complex.\n          //\n          // It might be desirable to find some sort of collision detection for the first approach (which is commented out below)\n          //\n          /////\n          // This is the aforementioned second approach\n          HierarchyLayoutService.calculateWeightsBottomUp(scope.path);\n          //\n          /////\n          for (var i = 0; i < scope.path.length; ++i) {\n            /////\n            // This is the aformentioned first approach\n            /*\n\t\t\tif (i === 0) {\n\t\t\t\tHierarchyLayoutService.layoutNonItemLevel(scope.path[0], scope.path.length);\n\t\t\t} else {\n\t\t\t\tHierarchyLayoutService.layoutItemLevel(scope.path[i], scope.path.length-i);\n\t\t\t}\n\t\t\t*/\n            //////\n            // Add all nodes that are not collapsed\n            var levelItems = LevelService.getLevelDetails(scope.path[i]).level.items;\n            for (var ii = 0; ii < levelItems.length; ++ii) {\n              if (levelItems[ii]._visible) {\n                nodes.push(levelItems[ii]);\n              }\n            }  // Add all nodes, no matter whether they are collapsed or not\n               //nodes = nodes.concat(LevelService.getLevelDetails(scope.path[i]).level.items);\n          }\n          // Now layout links\n          //\n          // We must only draw links that are part of the currently selected path.\n          // We must therefore filter the links.\n          //\n          // We must also filter out links that are collapsed\n          //\n          // What follows below is a probably very low-performance approach to filtering\n          //\n          var links = [];\n          var allLinks = DataService.getData().links;\n          for (var l = 0; l < allLinks.length; ++l) {\n            for (var i = 0; i < scope.path.length - 1; ++i) {\n              var element = LevelService.getItemFromLevelById(scope.path[i], allLinks[l].toID);\n              var parentElement = LevelService.getItemFromLevelById(scope.path[i + 1], allLinks[l].fromID);\n              if (element === null) {\n                continue;\n              }\n              if (parentElement === null) {\n                continue;\n              }\n              if (!element._visible)\n                continue;\n              if (parentElement._collapsed || !parentElement._visible)\n                continue;\n              links.push(allLinks[l]);\n            }\n          }\n          // Transform relative coordinates (_posInLevel and _depth) to actual coordinates (_x and _y)\n          var offsetX = 25;\n          var depthToX = function (depth) {\n            var size = scope.vertical ? scope.height : scope.width;\n            return offsetX + depth / scope.path.length * size;\n          };\n          var posInLevelToY = function (posInLevel) {\n            var size = scope.vertical ? scope.width : scope.height;\n            return posInLevel * size;\n          };\n          nodes.forEach(function (d) {\n            d._x = depthToX(d._depth);\n            d._y = posInLevelToY(d._posInLevel);\n          });\n          links.forEach(function (d) {\n            d._fromX = depthToX(d._fromDepth);\n            d._fromY = posInLevelToY(d._fromPosInLevel);\n            d._toX = depthToX(d._toDepth);\n            d._toY = posInLevelToY(d._toPosInLevel);\n          });\n          //////\n          // Now that all actual coordinates have been calculated, we\n          // update our SVG using d3js data joins\n          //\n          // For an introduction to the concept see\n          // http://bost.ocks.org/mike/join/\n          //\n          //\n          // Define the data set to be visualised\n          var dataSet = svg.selectAll('g.emuhierarchy-node').data(nodes, function (d) {\n              return d.id;\n            });\n          var newNodes = dataSet.enter();\n          var oldNodes = dataSet.exit();\n          //\n          // Add nodes that were previously not part of the svg.\n          //\n          // Any node will consist of an svg group (\"g\"), a circle, a\n          // text and a second, invisible circle for mouseover handling.\n          //\n          // Note that properties that can be changed after the node is \n          // added will be set further below\n          newNodes = newNodes.append('g').attr('class', 'emuhierarchy-node').attr('pointer-events', 'mouseover').on('click', scope.nodeOnClick).on('mouseover', scope.nodeOnMouseOver).on('contextmenu', scope.play);\n          ;\n          newNodes.append('circle').attr('class', 'emuhierarchy-nodeCircle').attr('r', 0).transition().duration(scope.duration).attr('r', 4.5);\n          ;\n          newNodes.append('text').attr('class', 'emuhierarchy-nodeText');\n          ;\n          // Make sure that nodes that appear due to their ancestry being uncollapsed do not fly in from the origin\n          // (as do all other nodes)\n          newNodes.attr('transform', function (d) {\n            if (typeof d._collapsePosition !== 'undefined') {\n              var x = d._collapsePosition[0];\n              var y = d._collapsePosition[1];\n              delete d._collapsePosition;\n              return 'translate(' + x + ',' + y + ')' + scope.getOrientatedNodeTransform();\n            }\n          });\n          /*\n\n\t\t// phantom node to give us mouseover in a radius around it\n\t\tnewNodes.append('circle')\n\t\t\t.attr('class', 'emuhierarchy-ghostCircle')\n\t\t\t.attr('r', 30)\n\t\t\t.attr('opacity', 0.2) // change this to zero to hide the target area\n\t\t\t.style('fill', 'red')\n\t\t\t.attr('pointer-events', 'mouseover')\n\t\t\t.on('mouseover', function (node) {\n\t\t\t\tconsole.debug(node);\n\t\t\t\toverCircle(node);\n\t\t\t})\n\t\t\t.on('mouseout', function (node) {\n\t\t\t\toutCircle(node);\n\t\t\t});\n\n\t\t*/\n          //\n          // Remove nodes that shall no longer be part of the svg\n          // Transition exiting nodes to the origin\n          oldNodes = oldNodes.transition().duration(scope.duration).attr('transform', function (d) {\n            if (d._collapsePosition) {\n              var x = d._collapsePosition[0];\n              var y = d._collapsePosition[1];\n              delete d._collapsePosition;\n              return 'translate(' + x + ',' + y + ')';\n            } else {\n              return 'translate(' + 0 + ',' + 0 + ')';\n            }\n          }).remove();\n          oldNodes.select('text').style('fill-opacity', 0);\n          //\n          // Set or update properties that are subject to change after\n          // the node is added.\n          dataSet.select('text').attr('x', scope.getOrientatedTextX).attr('y', scope.getOrientatedTextY).attr('text-anchor', scope.getOrientatedTextAnchor).attr('transform', scope.getOrientatedTextTransform).text(scope.getNodeText);\n          ;\n          // Change the circle fill depending on whether it has children and is collapsed\n          dataSet.select('circle.emuhierarchy-nodeCircle').classed('collapsed', function (d) {\n            return d._collapsed;\n          }).classed('selected', function (d) {\n            if (typeof scope.selectedItem === 'undefined') {\n              return false;\n            }\n            return d.id === scope.selectedItem.id;\n          });\n          //.attr('r', 4.5)\n          //.style('fill', function (d) {\n          //\treturn d._children ? 'lightsteelblue' : '#fff';\n          //})\n          ;\n          // Transition nodes to their new position\n          dataSet.transition().duration(scope.duration).attr('transform', function (d) {\n            return 'translate(' + d._x + ',' + d._y + ')' + scope.getOrientatedNodeTransform();\n          });\n          //\n          //\n          // Now we turn to visualising links\n          var linkSet = svg.selectAll('path.emuhierarchy-link').data(links, function (d) {\n              // Form unique link ID\n              return 's' + d.fromID + 't' + d.toID;\n            });\n          var newLinks = linkSet.enter();\n          var oldLinks = linkSet.exit();\n          newLinks.insert('path', 'g').attr('class', 'emuhierarchy-link').style('opacity', 0).transition().duration(scope.duration).style('opacity', 1);\n          ;\n          oldLinks.transition().duration(scope.duration).style('opacity', 0).remove();\n          // Transition links to their new position.\n          linkSet.transition().duration(scope.duration).attr('d', scope.getPath).style('opacity', 1);\n          ;\n        };\n        /**\n         * SIC... not being called\n         */\n        scope.resizeHierarchy = function () {\n          console.log('###############');\n          console.log(scope.width);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('epg', [\n  'viewState',\n  function (viewState) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      link: function postLink(scope, element, attrs) {\n        // element.text('this is the epg directive');\n        var canvas = element.find('canvas')[0];\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawEpgGrid(scope);\n                }\n              }\n            }\n          }\n        }, true);\n        scope.$watch('vs.curMousePosSample', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawEpgGrid(scope);\n              }\n            }\n          }\n        }, true);\n        //\n        ////////////////////\n        /**\n\t\t\t\t * drawing method to drawEpgGrid\n\t\t\t\t */\n        scope.drawEpgGrid = function (scope) {\n          var ctx = canvas.getContext('2d');\n          tr = scope.cps.getSsffTrackConfig('EPG');\n          // SIC SIC SIC hardcoded for now although it might stay that way because it only is allowed to draw epg data anyway\n          col = scope.ssffds.getColumnOfTrack(tr.name, tr.columnName);\n          sRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(tr.name);\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.fillStyle = 'green';\n          ctx.strokeStyle = scope.cps.vals.colors.osciColor;\n          ctx.font = scope.cps.vals.font.fontPxSize + 'px' + ' ' + scope.cps.vals.font.fontType;\n          var gridWidth = canvas.width / 8;\n          var gridHeight = canvas.height / 8;\n          var sInterv = 1 / sRaSt.sampleRate - sRaSt.startTime;\n          var curFrame = Math.round(scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate / sInterv);\n          var binValStrArr;\n          angular.forEach(col.values[curFrame], function (el, elIdx) {\n            binValStrArr = el.toString(2).split('').reverse();\n            while (binValStrArr.length < 8) {\n              binValStrArr.push('0');\n            }\n            binValStrArr.forEach(function (binStr, binStrIdx) {\n              if (binStr === '1') {\n                ctx.fillStyle = 'grey';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              } else {\n                ctx.fillStyle = 'white';\n                ctx.fillRect(binStrIdx * gridWidth + 5, gridHeight * elIdx + 5, gridWidth - 10, gridHeight - 10);\n              }\n            });\n          });\n          // draw labels\n          var horizontalText = scope.fontImage.getTextImageTwoLines(ctx, 'EPG', 'Frame:' + curFrame, scope.cps.vals.font.fontPxSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor, true);\n          ctx.drawImage(horizontalText, 0, 0, horizontalText.width, horizontalText.height, 5, 0, horizontalText.width, horizontalText.height);\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('dots', [\n  'viewState',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'fontScaleService',\n  'Soundhandlerservice',\n  function (viewState, ConfigProviderService, Ssffdataservice, fontScaleService, Soundhandlerservice) {\n    return {\n      template: '<div class=\"emuwebapp-twoDimCanvasContainer\"><canvas width=\"512\" height=\"512\"></canvas></div>',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.cps = ConfigProviderService;\n        scope.ssffds = Ssffdataservice;\n        scope.vs = viewState;\n        scope.fontImage = fontScaleService;\n        scope.shs = Soundhandlerservice;\n        var canvas = element.find('canvas')[0];\n        var globalMinX = Infinity;\n        var globalMaxX = -Infinity;\n        var globalMinY = Infinity;\n        var globalMaxY = -Infinity;\n        var tr, col, sRaSt;\n        ////////////////////\n        // watches\n        //\n        scope.$watch('ssffds.data.length', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curViewPort', function (newValue, oldValue) {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                if (oldValue.sS !== newValue.sS || oldValue.eS !== newValue.eS) {\n                  scope.drawDots();\n                }\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curMousePosSample', function () {\n          if (!$.isEmptyObject(scope.cps.vals)) {\n            if (!$.isEmptyObject(scope.ssffds.data)) {\n              if (scope.ssffds.data.length !== 0) {\n                scope.drawDots();\n              }\n            }\n          }\n        }, true);\n        //\n        scope.$watch('vs.curPerspectiveIdx', function () {\n          globalMinX = Infinity;\n          globalMaxX = -Infinity;\n          globalMinY = Infinity;\n          globalMaxY = -Infinity;\n        }, true);\n        //\n        //////////////////\n        scope.setGlobalMinMaxVals = function () {\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (xCol._minVal < globalMinX) {\n              globalMinX = xCol._minVal;\n            }\n            if (xCol._maxVal > globalMaxX) {\n              globalMaxX = xCol._maxVal;\n            }\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            if (yCol._minVal < globalMinY) {\n              globalMinY = yCol._minVal;\n            }\n            if (yCol._maxVal > globalMaxY) {\n              globalMaxY = yCol._maxVal;\n            }\n          }\n          // also check staticDots\n          dD.staticDots.forEach(function (sD) {\n            sD.xCoordinates.forEach(function (xVal, xIdx) {\n              // check x\n              if (xVal < globalMinX) {\n                globalMinX = xVal;\n              }\n              if (xVal > globalMaxX) {\n                globalMaxX = xVal;\n              }\n              // check y\n              if (sD.yCoordinates[xIdx] < globalMinY) {\n                globalMinY = sD.yCoordinates[xIdx];\n              }\n              if (sD.yCoordinates[xIdx] > globalMaxY) {\n                globalMaxY = sD.yCoordinates[xIdx];\n              }\n            });\n          });\n        };\n        /**\n\t\t\t\t * drawing method to drawDots\n\t\t\t\t */\n        scope.drawDots = function () {\n          if (globalMinX === Infinity) {\n            scope.setGlobalMinMaxVals();\n          }\n          var ctx = canvas.getContext('2d');\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          //////////////////////////////\n          // markup to improve visualization \n          var scaleX = ctx.canvas.width / ctx.canvas.offsetWidth;\n          var scaleY = ctx.canvas.height / ctx.canvas.offsetHeight;\n          // draw corner pointers\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.lineTo(5, 5);\n          ctx.moveTo(0, canvas.height);\n          ctx.lineTo(5, canvas.height - 5);\n          ctx.moveTo(canvas.width, canvas.height);\n          ctx.lineTo(canvas.width - 5, canvas.height - 5);\n          ctx.stroke();\n          ctx.closePath();\n          var smallFontSize = scope.cps.vals.font.fontPxSize * 3 / 4;\n          // ymax\n          var labelTxtImg = scope.fontImage.getTextImage(ctx, 'yMax: ' + scope.vs.round(globalMaxY, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          ctx.drawImage(labelTxtImg, 5, 5, labelTxtImg.width, labelTxtImg.height);\n          // xmin + y min\n          labelTxtImg = scope.fontImage.getTextImageTwoLines(ctx, 'yMin: ' + scope.vs.round(globalMinY, 2), 'xMin: ' + scope.vs.round(globalMinX, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor, true);\n          ctx.drawImage(labelTxtImg, 5, canvas.height - smallFontSize * scaleY * 2 - 5, labelTxtImg.width, labelTxtImg.height);\n          // xmax\n          var tw = ctx.measureText('xMax: ' + scope.vs.round(globalMaxX, 5)).width * scaleX;\n          // SIC why 5???\n          labelTxtImg = scope.fontImage.getTextImage(ctx, 'xMax: ' + scope.vs.round(globalMaxX, 2), smallFontSize, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          ctx.drawImage(labelTxtImg, canvas.width - tw - 5, canvas.height - smallFontSize * scaleY - 5, labelTxtImg.width, labelTxtImg.height);\n          var dD = scope.cps.vals.perspectives[scope.vs.curPerspectiveIdx].twoDimCanvases.twoDimDrawingDefinitions[0];\n          // SIC SIC SIC hardcoded\n          // frame nr\n          var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].xSsffTrack);\n          // use first track for sample numbers\n          var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[0].ySsffTrack);\n          var sInterv = 1 / xsRaSt.sampleRate;\n          var curMousePosTime = scope.vs.curMousePosSample / scope.shs.wavJSO.SampleRate;\n          var curFrame;\n          if (xsRaSt.startTime === 1 / xsRaSt.sampleRate / 2) {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate);\n          } else {\n            curFrame = Math.round(curMousePosTime * xsRaSt.sampleRate + (xsRaSt.startTime - 1 / xsRaSt.sampleRate / 2) * xsRaSt.sampleRate);\n          }\n          // check if due to math.round curFrame > col.length\n          var trConf = scope.cps.getSsffTrackConfig(dD.dots[0].xSsffTrack);\n          var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n          if (curFrame > xCol.values.length - 1) {\n            curFrame = xCol.values.length - 1;\n          }\n          tw = ctx.measureText('frame: ' + curFrame).width * scaleX;\n          labelTxtImg = scope.fontImage.getTextImage(ctx, 'frame: ' + curFrame, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.endBoundaryColor);\n          var degrees = 90;\n          ctx.save();\n          ctx.rotate(degrees * Math.PI / 180);\n          ctx.drawImage(labelTxtImg, canvas.width / 2 - tw / 2, -canvas.height);\n          ctx.restore();\n          //////////////////////////////\n          // draw dots\n          var allDots = [];\n          for (var i = 0; i < dD.dots.length; i++) {\n            // get xCol\n            var trConf = scope.cps.getSsffTrackConfig(dD.dots[i].xSsffTrack);\n            var xCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // get yCol\n            trConf = scope.cps.getSsffTrackConfig(dD.dots[i].ySsffTrack);\n            var yCol = scope.ssffds.getColumnOfTrack(trConf.name, trConf.columnName);\n            // check if x and why have the same amount of cols\n            if (xCol.values.length !== yCol.values.length) {\n              alert('columns do not have same length or length of one not 1');\n              return;\n            }\n            var xsRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].xSsffTrack);\n            var ysRaSt = scope.ssffds.getSampleRateAndStartTimeOfTrack(dD.dots[i].ySsffTrack);\n            // check if sampleRate and startTime is the same\n            if (xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample) {\n              alert('xsRaSt.sampleRate !== ysRaSt.sampleRate || xsRaSt.startSample !== ysRaSt.startSample');\n              return;\n            }\n            var x = (xCol.values[curFrame][dD.dots[i].xContourNr] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var y = canvas.height - (yCol.values[curFrame][dD.dots[i].yContourNr] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            var startPoint = Math.PI / 180 * 0;\n            var endPoint = Math.PI / 180 * 360;\n            ctx.strokeStyle = dD.dots[i].color;\n            ctx.beginPath();\n            ctx.arc(x, y, 20, startPoint, endPoint, true);\n            ctx.stroke();\n            ctx.closePath();\n            ctx.beginPath();\n            ctx.arc(x, y, 2, startPoint, endPoint, true);\n            ctx.fill();\n            ctx.closePath();\n            // draw labels\n            var labelTxtImg = scope.fontImage.getTextImage(ctx, dD.dots[i].name, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, scope.cps.vals.colors.labelColor);\n            ctx.drawImage(labelTxtImg, x, y - 5, labelTxtImg.width, labelTxtImg.height);\n            // append to all dots\n            allDots.push({\n              'name': dD.dots[i].name,\n              'x': x,\n              'y': y\n            });\n          }\n          //////////////////////////\n          // draw connect lines\n          var f, t;\n          dD.connectLines.forEach(function (c) {\n            allDots.forEach(function (d) {\n              if (d.name === c.fromDot) {\n                f = d;\n              }\n              if (d.name === c.toDot) {\n                t = d;\n              }\n            });\n            // draw line\n            ctx.strokeStyle = c.color;\n            ctx.beginPath();\n            ctx.moveTo(f.x, f.y);\n            ctx.lineTo(t.x, t.y);\n            ctx.stroke();\n            ctx.closePath();\n          });\n          //////////////////////////\n          // draw static dots\n          var startPoint = Math.PI / 180 * 0;\n          var endPoint = Math.PI / 180 * 360;\n          dD.staticDots.forEach(function (sD) {\n            ctx.strokeStyle = sD.color;\n            ctx.fillStyle = sD.color;\n            // draw name\n            var labelX = (sD.xNameCoordinate - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n            var labelY = canvas.height - (sD.yNameCoordinate - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n            var labelTxtImg = scope.fontImage.getTextImage(ctx, sD.name, scope.cps.vals.font.fontPxSize - 4, scope.cps.vals.font.fontType, sD.color);\n            ctx.drawImage(labelTxtImg, labelX, labelY, labelTxtImg.width, labelTxtImg.height);\n            sD.xCoordinates.forEach(function (xVal, xIdx) {\n              var x = (xVal - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n              var y = canvas.height - (sD.yCoordinates[xIdx] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n              // draw dot\n              ctx.beginPath();\n              ctx.arc(x, y, 2, startPoint, endPoint, true);\n              ctx.fill();\n              ctx.closePath();\n              // draw connection\n              if (sD.connect && xIdx >= 1) {\n                var prevX = (sD.xCoordinates[xIdx - 1] - globalMinX) / (globalMaxX - globalMinX) * canvas.width;\n                var prevY = canvas.height - (sD.yCoordinates[xIdx - 1] - globalMinY) / (globalMaxY - globalMinY) * canvas.height;\n                ctx.beginPath();\n                ctx.moveTo(prevX, prevY);\n                ctx.lineTo(x, y);\n                ctx.stroke();\n                ctx.closePath();\n              }\n            });\n          });\n        };\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZone', [\n  '$animate',\n  '$compile',\n  'DragnDropService',\n  'browserDetector',\n  'appStateService',\n  'modalService',\n  function ($animate, $compile, DragnDropService, browserDetector, appStateService, modalService) {\n    return {\n      templateUrl: 'views/myDropZone.html',\n      restrict: 'E',\n      replace: true,\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        /* --------- Messages -------- */\n        scope.dropTextDefault = 'Drop your files here or click here to open a file';\n        scope.dropTextErrorFileType = 'Error: Could not parse file. The following file types are supported: .WAV .TEXTGRID';\n        scope.dropTextErrorAPI = 'Sorry ! The File APIs are not fully supported in your browser.';\n        scope.dropAllowed = 'Drop file(s) to start loading !';\n        scope.dropParsingWaiting = '.TextGrid loaded! Please load .WAV file in order to start!';\n        scope.dropParsingWaitingAnnot = 'Annotation file loaded! Please load .WAV file in order to start!';\n        scope.dropFirefoxWarning = 'Sorry ! Firefox does not support dropping folders ! please drop single or multiple files !';\n        scope.dropText = scope.dropTextDefault;\n        scope.dropClass = '';\n        scope.dropClassDefault = '';\n        scope.dropClassOver = 'over';\n        scope.dropClassError = 'error';\n        scope.count = 0;\n        scope.handles = [];\n        scope.bundles = [];\n        scope.bundleNames = [];\n        scope.updateQueueLength = function (quantity) {\n          scope.count += quantity;\n        };\n        scope.enqueueFileAddition = function (file) {\n          var identifier = file.name.substring(file.name.lastIndexOf('_') + 1, file.name.lastIndexOf('.')).toUpperCase();\n          var extension = file.name.substr(file.name.lastIndexOf('.') + 1).toUpperCase();\n          var bundle = '';\n          if (identifier === 'ANNOT') {\n            bundle = file.name.substr(0, file.name.lastIndexOf('_'));\n          } else {\n            bundle = file.name.substr(0, file.name.lastIndexOf('.'));\n          }\n          var j = scope.bundleNames.indexOf(bundle);\n          if (j === -1) {\n            scope.bundleNames.push(bundle);\n            j = scope.bundleNames.indexOf(bundle);\n            scope.bundles[j] = [];\n            scope.bundles[j][0] = bundle;\n          }\n          if (extension === 'WAV') {\n            scope.bundles[j][1] = file;\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropTextDefault;\n            scope.startRendering();\n          } else if (extension === 'TEXTGRID') {\n            scope.bundles[j][2] = {};\n            scope.bundles[j][2].file = file;\n            scope.bundles[j][2].type = 'textgrid';\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWaiting;\n          } else if (extension === 'JSON' && identifier === 'ANNOT') {\n            scope.bundles[j][2] = {};\n            scope.bundles[j][2].file = file;\n            scope.bundles[j][2].type = 'annotation';\n            scope.handles.push(file);\n            scope.dropClass = scope.dropClassDefault;\n            scope.dropText = scope.dropParsingWaitingAnnot;\n          } else {\n            if (browserDetector.isBrowser.Firefox()) {\n              if (file.size === 0) {\n                scope.dropClass = scope.dropClassError;\n                scope.dropText = scope.dropFirefoxWarning;\n              } else {\n                scope.dropClass = scope.dropClassError;\n                scope.dropText = scope.dropTextErrorFileType;\n              }\n            } else {\n              scope.dropClass = scope.dropClassError;\n              scope.dropText = scope.dropTextErrorFileType;\n            }\n            scope.handles = [];\n            scope.bundles = [];\n            scope.bundleNames = [];\n            scope.count = 0;\n          }\n          if (!browserDetector.isBrowser.Firefox()) {\n            scope.$digest();\n          }\n        };\n        scope.startRendering = function () {\n          // If all the files we expect have shown up, then flush the queue.\n          if (scope.count === scope.handles.length) {\n            if (DragnDropService.setData(scope.bundles) === false) {\n              modalService.open('views/error.html', 'Sorry you dropped too many bundles (' + scope.handles.length + '). The maximum currently allowed is: ' + DragnDropService.maxDroppedBundles).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n            scope.handles = [];\n            scope.bundles = [];\n            scope.bundleNames = [];\n            scope.count = 0;\n          }\n        };\n        scope.loadFiles = function (files) {\n          scope.updateQueueLength(files.length);\n          for (var i = 0; i < files.length; i++) {\n            var file = files[i];\n            if (file.name === '.DS_Store') {\n              scope.updateQueueLength(-1);\n            } else {\n              var entry, reader;\n              if (file.isFile || file.isDirectory) {\n                entry = file;\n              } else if (file.getAsEntry) {\n                entry = file.getAsEntry();\n              } else if (file.webkitGetAsEntry) {\n                entry = file.webkitGetAsEntry();\n              } else if (typeof file.getAsFile === 'function') {\n                scope.enqueueFileAddition(file.getAsFile());\n                continue;\n              } else if (File && file instanceof File) {\n                scope.enqueueFileAddition(file);\n                continue;\n              } else {\n                scope.updateQueueLength(-1);\n                continue;\n              }\n              if (!entry) {\n                updateQueueLength(-1);\n              } else if (entry.isFile) {\n                entry.file(function (file) {\n                  scope.enqueueFileAddition(file);\n                }, function (err) {\n                  console.warn(err);\n                });\n              } else if (entry.isDirectory) {\n                reader = entry.createReader();\n                reader.readEntries(function (entries) {\n                  scope.loadFiles(entries);\n                  scope.updateQueueLength(-1);\n                }, function (err) {\n                  console.warn(err);\n                });\n              }\n            }\n          }\n        };\n        scope.dropFiles = function (evt) {\n          evt.stopPropagation();\n          evt.preventDefault();\n          scope.$apply(function () {\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\n              if (evt.originalEvent !== undefined) {\n                if (browserDetector.isBrowser.Firefox()) {\n                  var items = evt.originalEvent.dataTransfer.files;\n                } else {\n                  var items = evt.originalEvent.dataTransfer.items;\n                }\n                scope.loadFiles(items);\n              }\n            } else {\n              // no browser support for FileAPI\n              modalService.open('views/error.html', scope.dropTextErrorAPI).then(function (res) {\n                scope.dropText = scope.dropTextDefault;\n                scope.dropClass = scope.dropClassDefault;\n                appStateService.resetToInitState();\n              });\n            }\n          });\n        };\n        scope.dragEnterLeave = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropTextDefault;\n            scope.dropClass = scope.dropClassDefault;\n          });\n        };\n        scope.handleDragOver = function (evt) {\n          evt.preventDefault();\n          scope.$apply(function () {\n            scope.dropText = scope.dropAllowed;\n            scope.dropClass = scope.dropClassOver;\n          });\n        };\n        element.bind('drop', function (event) {\n          scope.dropFiles(event);\n        });\n        element.bind('dragover', function (event) {\n          scope.handleDragOver(event);\n        });\n        element.bind('dragenter', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('dragleave', function (event) {\n          scope.dragEnterLeave(event);\n        });\n        element.bind('click', function (event) {\n          element.context.children[1].children[0].click();\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('myDropZoneInput', [\n  '$animate',\n  'browserDetector',\n  'appStateService',\n  function ($animate, browserDetector, appStateService) {\n    return {\n      templateUrl: 'views/myDropZoneInput.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attr) {\n        scope.acceptGrid = '.TextGrid';\n        scope.acceptWav = 'audio/wav';\n        scope.acceptBoth = scope.acceptWav + ',' + scope.acceptGrid;\n        scope.acceptFile = scope.acceptBoth;\n        scope.handleFilesonChange = function () {\n          var loadedFiles = element.context.children.fileDialog;\n          scope.$parent.loadFiles(loadedFiles.files);\n        };\n        element.bind('change', function (event) {\n          scope.handleFilesonChange(event);\n        });\n        element.bind('click', function (event) {\n          var elem = angular.element('input');\n          if (elem[1] !== undefined) {\n            elem[1].click();\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').directive('emuwebapp', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/emuwebapp.html',\n      restrict: 'E',\n      scope: {\n        audioGetUrl: '@',\n        labelGetUrl: '@',\n        labelType: '@'\n      },\n      link: function postLink(scope, element, attrs) {\n        ////////////////////////\n        // Bindings\n        element.bind('mouseenter', function (event) {\n          viewState.mouseInEmuWebApp = true;\n        });\n        element.bind('mouseleave', function (event) {\n          viewState.mouseInEmuWebApp = false;\n        });\n        ///////////////////////\n        // observe attrs\n        attrs.$observe('audioGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.audioGetUrl = val;\n          }\n        });\n        attrs.$observe('labelGetUrl', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelGetUrl = val;\n          }\n        });\n        attrs.$observe('labelType', function (val) {\n          if (val !== undefined && val !== '') {\n            ConfigProviderService.embeddedVals.labelType = val;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('Validationservice', [\n  '$http',\n  '$q',\n  function Validationservice($http, $q) {\n    //shared service object to be returned\n    var sServObj = {};\n    var schemasJsos = [];\n    var names = [\n        'annotationFileSchema',\n        'emuwebappConfigSchema',\n        'DBconfigFileSchema',\n        'bundleListSchema',\n        'bundleSchema'\n      ];\n    /**\n\t\t *\n\t\t */\n    sServObj.loadSchemas = function () {\n      var proms = [];\n      var uri;\n      angular.forEach(names, function (n) {\n        uri = 'schemaFiles/' + n + '.json';\n        proms.push($http.get(uri));\n      });\n      return $q.all(proms);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.setSchemas = function (schemaArr) {\n      angular.forEach(schemaArr, function (s) {\n        schemasJsos.push({\n          name: s.config.url,\n          data: s.data\n        });\n        // add annotationFileSchema to tv4 for de-referencing $ref\n        if (s.config.url === 'schemaFiles/annotationFileSchema.json') {\n          tv4.addSchema(s.config.url, s.data);\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSchema = function (schemaName) {\n      var schema = undefined;\n      angular.forEach(schemasJsos, function (s) {\n        if (s.name === 'schemaFiles/' + schemaName + '.json') {\n          schema = s;\n        }\n      });\n      return schema;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.validateJSO = function (schemaName, jso) {\n      var schema = sServObj.getSchema(schemaName);\n      if (schema !== undefined && tv4.validate(jso, schema.data)) {\n        return true;\n      } else {\n        if (schema === undefined) {\n          return 'Schema: ' + schemaName + ' is currently undefined! This is probably due to a misnamed schema file on the server...';\n        } else {\n          return tv4.error;\n        }\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('ShowhierarchyCtrl', [\n  '$scope',\n  'DataService',\n  'viewState',\n  'modalService',\n  'ConfigProviderService',\n  'LevelService',\n  'HierarchyLayoutService',\n  function ($scope, DataService, viewState, modalService, ConfigProviderService, LevelService, HierarchyLayoutService) {\n    // Scope data\n    var playing = 0;\n    $scope.paths = {\n      possible: [],\n      possibleAsStr: [],\n      selected: ''\n    };\n    // Find non-ITEM levels to start calculating possible paths through the hierarchy of levels\n    angular.forEach(ConfigProviderService.curDbConfig.levelDefinitions, function (l) {\n      if (l.type !== 'ITEM') {\n        $scope.paths.possible = $scope.paths.possible.concat(HierarchyLayoutService.findPaths(l.name));\n      }\n    });\n    // convert array paths to strings\n    angular.forEach($scope.paths.possible, function (arr, arrIdx) {\n      if (arrIdx === 0) {\n        // select first possible path on load\n        $scope.paths.selected = arr.join(' \\u2190 ');\n      }\n      $scope.paths.possibleAsStr.push(arr.join(' \\u2190 '));\n    });\n    //////////////\n    // watches\n    //\n    //////////////\n    /**\n\t\t * Returns index of the currently selected path (within the $scope.paths.possible array)\n\t\t */\n    $scope.getSelIdx = function () {\n      var selIdx = $scope.paths.possibleAsStr.indexOf($scope.paths.selected);\n      return selIdx;\n    };\n    $scope.rotateHierarchy = function () {\n      viewState.rotateHierarchy();\n    };\n    $scope.getRotation = function () {\n      return viewState.isHierarchyRotated();\n    };\n    $scope.playSelection = function () {\n      ++playing;\n    };\n    $scope.getPlaying = function () {\n      return playing;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.isCurrentAttrDef = function (levelName, attrDef) {\n      if (viewState.getCurAttrDef(levelName) === attrDef) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n    /**\n\t\t * set current attribute definition\n\t\t * just delegates same fuction call to viewState\n\t\t *\n\t\t * @param levelName name of level\n\t\t * @param attrDef name of attribute definition\n\t\t */\n    $scope.setCurrentAttrDef = function (levelName, attrDef) {\n      viewState.setCurAttrDef(levelName, attrDef);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.getAllAttrDefs = function (levelName) {\n      var levDef = ConfigProviderService.getLevelDefinition(levelName);\n      return levDef.attributeDefinitions;\n    };\n    /**\n\t\t * cancel dialog i.e. close\n\t\t */\n    $scope.cancel = function () {\n      var traverse = function (o) {\n        for (var i in o) {\n          if (i.substr(0, 1) === '_') {\n            delete o[i];\n          }\n          if (o[i] !== null && typeof o[i] === 'object') {\n            //going one step down in the object tree\n            traverse(o[i]);\n          }\n        }\n      };\n      traverse(DataService.getData());\n      modalService.close();\n    };\n  }\n]);\n'use strict';\n/**\n * This service aims to provide functions for laying out the hierarchy of a\n * bundle (ie, calculating the positions of the nodes). The actual drawing is\n * done in a directive, the manipulation of the hierarchy is done in another\n * service.\n *\n * While the DBConfig allows for a complex network of levels, the visualisation\n * is always limited to one straight path of levels. Set this path via the\n * public function setPath(p).\n *\n * A selection menu shall be offered comprising all possible paths through the\n * hierarchy.\n */\nangular.module('emuwebApp').service('HierarchyLayoutService', [\n  'ConfigProviderService',\n  'LevelService',\n  'DataService',\n  function (ConfigProviderService, LevelService, DataService) {\n    // shared service object\n    var sServObj = {};\n    ////////////////////////////////////////////\n    // private vars and functions\n    var svgGroup;\n    var parentsFound;\n    //\n    /////////////////////\n    /////////////////////\n    // public API\n    /**\n\t\t * Find all parent levels of a given level by iterating through the\n\t\t * current database's linkDefinitions.\n\t\t *\n\t\t * @param childLevel The name of the level whose parents to find\n\t\t * @returns An array of names of childLevel's parent levels\n\t\t */\n    sServObj.findParentLevels = function (childLevel) {\n      var parents = [];\n      for (var i = 0; i < ConfigProviderService.curDbConfig.linkDefinitions.length; ++i) {\n        if (ConfigProviderService.curDbConfig.linkDefinitions[i].sublevelName === childLevel) {\n          parents.push(ConfigProviderService.curDbConfig.linkDefinitions[i].superlevelName);\n        }\n      }\n      return parents;\n    };\n    /**\n\t\t * Calculate the position of nodes within a non-item level (ie, one with time information)\n\t\t *\n\t\t * The nodes are positioned at a regular distance to each other.\n\t\t * The first node will be at position -0.5, the last at somewhat\n\t\t * below 0.5.\n\t\t *\n\t\t * It is taken for granted that the order of the nodes within\n\t\t * the array is coherent with the time information.\n\n\t\tsServObj.layoutNonItemLevel = function (name, levelDepth) {\n\t\t\tvar nodes = LevelService.getLevelDetails(name).level.items;\n\t\t\tfor (var i=0; i<nodes.length; ++i) {\n\t\t\t\tnodes[i]._posInLevel = i / nodes.length + 0.01 ;//- 0.5;\n\t\t\t\tnodes[i]._depth = levelDepth;\n\n\t\t\t\t// Additionally, calculate link positions\n\t\t\t\tvar links = DataService.getData().links;\n\t\t\t\tfor (var l=0; l<links.length; ++l) {\n\t\t\t\t\tif (links[l].toID === nodes[i].id) {\n\t\t\t\t\t\tlinks[l]._toPosInLevel = nodes[i]._posInLevel;\n\t\t\t\t\t\tlinks[l]._toDepth = nodes[i]._depth;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t */\n    /**\n\t\t * Calculate the position of nodes within an item level (ie, one without time information)\n\t\t * \n\t\t * This is done by looking at the position of the first and the\n\t\t * last child of each node and centering the node in-between\n\n\t\tsServObj.layoutItemLevel = function (name, levelDepth) {\n\t\t\tvar nodes = LevelService.getLevelDetails(name).level.items;\n\t\t\tfor (var i=0; i<nodes.length; ++i) {\n\t\t\t\t// Find first and last child of nodes[i]\n\t\t\t\tvar children = sServObj.findChildren (nodes[i], selectedPath);\n\t\t\t\tif (children.length === 0) {\n\t\t\t\t\tnodes[i]._posInLevel = null;\n\t\t\t\t}\n\t\t\t\t// FIXME if this function was actually used, the following would of course fail if children was an empty array\n\t\t\t\tvar firstChild = children[0];\n\t\t\t\tvar lastChild = children[children.length-1];\n\n\t\t\t\tnodes[i]._posInLevel = firstChild._posInLevel + (lastChild._posInLevel - firstChild._posInLevel)/2;\n\t\t\t\tnodes[i]._depth = levelDepth;\n\t\t\t\t\n\t\t\t\t// Additionally, calculate link positions\n\t\t\t\tvar links = DataService.getData().links;\n\t\t\t\tfor (var l=0; l<links.length; ++l) {\n\t\t\t\t\tif (links[l].toID === nodes[i].id) {\n\t\t\t\t\t\tlinks[l]._toPosInLevel = nodes[i]._posInLevel;\n\t\t\t\t\t\tlinks[l]._toDepth = nodes[i]._depth;\n\t\t\t\t\t}\n\t\t\t\t\tif (links[l].fromID === nodes[i].id) {\n\t\t\t\t\t\tlinks[l]._fromPosInLevel = nodes[i]._posInLevel;\n\t\t\t\t\t\tlinks[l]._fromDepth = nodes[i]._depth;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t */\n    /**\n\t\t * This function aims to find and store the parents of every node\n\t\t */\n    sServObj.findParents = function (selectedPath) {\n      var i, ii, c;\n      if (parentsFound) {\n        return;\n      } else {\n        parentsFound = true;\n      }\n      /////\n      // Iterate throug levels top-down\n      for (i = selectedPath.length - 1; i >= 0; --i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]).level;\n        // Iterate through the current level's items\n        // And save them as _parents in their children\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var children = sServObj.findChildren(level.items[ii], selectedPath);\n          //console.debug('label', level.items[ii].labels[0].value, 'number of children: ', children.length);\n          for (c = 0; c < children.length; ++c) {\n            if (typeof children[c]._parents === 'undefined') {\n              children[c]._parents = [];\n            }\n            children[c]._parents.push(level.items[ii]);\n          }\n        }\n      }\n    };\n    /**\n\t\t * Calculate the weights (size within their level) of all nodes bottom-up\n\t\t * This is most likely rather slow and definitely needs tweaking\n\t\t */\n    sServObj.calculateWeightsBottomUp = function (selectedPath) {\n      var i, ii, iii;\n      sServObj.findParents(selectedPath);\n      // Iterate through levels bottom-up\n      for (i = 0; i < selectedPath.length; ++i) {\n        var level = LevelService.getLevelDetails(selectedPath[i]).level;\n        level._weight = 0;\n        //////\n        // Iterate through items to calculate their _weight and the level's _weight\n        for (ii = 0; ii < level.items.length; ++ii) {\n          var itemWeight = level.items[ii]._weight;\n          if (typeof itemWeight === 'undefined') {\n            itemWeight = 1;\n            level.items[ii]._weight = 1;\n          }\n          // This would create tidier drawings but depends on knowledge of each node's parents \n          if (typeof level.items[ii]._parents !== 'undefined') {\n          }\n          level._weight += itemWeight;\n        }\n        /////\n        // Iterate through items again to calculate their _posInLevel and _depth.\n        // This is done in a new for loop because it depends on the correctness of level._weight\n        var posInLevel = 0;\n        for (ii = 0; ii < level.items.length; ++ii) {\n          level.items[ii]._posInLevel = (posInLevel + level.items[ii]._weight / 2) / level._weight;\n          posInLevel += level.items[ii]._weight;\n          level.items[ii]._depth = selectedPath.length - i - 1;\n          //////\n          // Additionally, calculate link positions\n          var links = DataService.getData().links;\n          for (var l = 0; l < links.length; ++l) {\n            if (links[l].toID === level.items[ii].id) {\n              links[l]._toPosInLevel = level.items[ii]._posInLevel;\n              links[l]._toDepth = level.items[ii]._depth;\n            }\n            if (links[l].fromID === level.items[ii].id) {\n              links[l]._fromPosInLevel = level.items[ii]._posInLevel;\n              links[l]._fromDepth = level.items[ii]._depth;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t\t * Recursively find all paths through the hierarchy of levels.\n\t\t * This is done bottom-up because there is no explicit root element in the levelDefinitions.\n\t\t *\n\t\t * @param startLevel The name of the level from which to start\n\t\t * @param path An array of levels' names that form a path to startLevel (optional; shouldn't be an empty array)\n\t\t */\n    sServObj.findPaths = function (startLevel, path) {\n      if (typeof path === 'undefined') {\n        var path = [startLevel];\n      } else {\n        path = path.concat([startLevel]);\n      }\n      // Find all parents of startLevel\n      var parents = this.findParentLevels(startLevel);\n      // If we have no more parents, we're at the end of the\n      // path and thus returning it\n      if (parents.length === 0) {\n        return [path];\n      }\n      // If, on the other hand, there are parents, we start\n      // recursion to find all paths\n      var paths = [];\n      for (var i = 0; i < parents.length; ++i) {\n        paths = paths.concat(sServObj.findPaths(parents[i], path));\n      }\n      return paths;\n    };\n    /**\n\t\t * Find all children of a node d that are part of the currently selected\n\t\t * path through the hierarchy\n\t\t *\n\t\t * @return an array of children nodes\n\t\t * @return empty array if there are no children (previously would return null due to a d3 dependency that no longer exists)\n\t\t */\n    sServObj.findChildren = function (d, selectedPath) {\n      var children = [];\n      // Find the level that d is a part of\n      // Return empty array if that fails (which shouldn't happen at all)\n      var currentLevel = LevelService.getLevelName(d.id);\n      if (currentLevel === null) {\n        console.log('Likely a bug: failed to find a node\\'s level', d);\n        return [];\n      }\n      // Find the child level\n      var childLevel = null;\n      for (var i = 0; i < selectedPath.length - 1; ++i) {\n        if (selectedPath[i + 1] === currentLevel) {\n          childLevel = selectedPath[i];\n          break;\n        }\n      }\n      if (childLevel === null) {\n        return [];\n      }\n      // Iterate over links to find children\n      for (var li = 0; li < DataService.getData().links.length; ++li) {\n        if (DataService.getData().links[li].fromID === d.id) {\n          // Iterate over levels to find the object corresponding to d.id\n          for (var l = 0; l < DataService.getData().levels.length; ++l) {\n            if (DataService.getData().levels[l].name !== childLevel) {\n              continue;\n            }\n            for (var it = 0; it < DataService.getData().levels[l].items.length; ++it) {\n              if (DataService.getData().levels[l].items[it].id === DataService.getData().links[li].toID) {\n                children.push(DataService.getData().levels[l].items[it]);\n              }\n            }\n          }\n        }\n      }\n      return children;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('ArrayHelperService', [\n  '$q',\n  function ArrayHelperService($q) {\n    // shared service object\n    var sServObj = {};\n    var defer;\n    // defer promise obj\n    /**\n\t\t * convert values of array to max values\n\t\t *\n\t\t * @param arr array to convert\n\t\t * @returns array containing Math.abs() values\n\t\t */\n    sServObj.convertToAbsValues = function (arr) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = Math.abs(arr[i]);\n      }\n      return arr;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.multiplyEachElement = function (arr, val) {\n      for (var i = 0; i < arr.length; i++) {\n        arr[i] = arr[i] * val;\n      }\n      return arr;\n    };\n    /**\n\t\t * find value between two points\n\t\t * by linearly interpolating them\n\t\t */\n    sServObj.interp2points = function (x0, y0, x1, y1, x) {\n      return y0 + (y1 - y0) * ((x - x0) / (x1 - x0));\n    };\n    /**\n\t\t * find min or maximum value in array\n\t\t *\n\t\t * @param arr array to search in\n\t\t * @param minOrMax string value either 'min' or 'max'\n\t\t * @returns object with attributes val and idx\n\t\t */\n    sServObj.findMinMax = function (arr, minOrMax) {\n      var val, idx;\n      if (minOrMax === 'min') {\n        val = Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] < val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      } else if (minOrMax === 'max') {\n        val = -Infinity;\n        for (var i = 0; i < arr.length; i++) {\n          if (arr[i] > val) {\n            val = arr[i];\n            idx = i;\n          }\n        }\n      }\n      return {\n        'val': val,\n        'idx': idx\n      };\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.flattenArrayOfArray = function (arrOfArrs) {\n      var merged = [];\n      merged = merged.concat.apply(merged, arrOfArrs);\n      return merged;\n    };\n    /**\n\t\t * convert array to an array that contains\n\t\t * objects of the form {x: i, y:y[i]}\n\t\t */\n    sServObj.convertArrayToXYjsoArray = function (y) {\n      var xyArray = [];\n      for (var i = 0; i < y.length; i++) {\n        xyArray.push({\n          x: i,\n          y: y[i]\n        });\n      }\n      return xyArray;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('AnagestService', [\n  '$q',\n  '$log',\n  'viewState',\n  'LevelService',\n  'LinkService',\n  'ConfigProviderService',\n  'Ssffdataservice',\n  'ArrayHelperService',\n  'modalService',\n  'HistoryService',\n  'DataService',\n  function AnagestService($q, $log, viewState, LevelService, LinkService, ConfigProviderService, Ssffdataservice, ArrayHelperService, modalService, HistoryService, DataService) {\n    // shared service object\n    var sServObj = {};\n    // defer object \n    var defer;\n    /**\n\t\t *\n\t\t */\n    sServObj.insertAnagestEvents = function () {\n      var defer = $q.defer();\n      // precheck if there are items in selection\n      var itemInSel = viewState.getItemsInSelection(DataService.data.levels);\n      if (itemInSel.length !== 0) {\n        modalService.open('views/error.html', 'There are already events in the selected area! This is not permitted...').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // vertical position signal\n      var trackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.verticalPosSsffTrackName;\n      var tr = ConfigProviderService.getSsffTrackConfig(trackName);\n      var col = Ssffdataservice.getColumnOfTrack(tr.name, tr.columnName);\n      var sRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(tr.name);\n      // velocity signal\n      var vTrackName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.velocitySsffTrackName;\n      var vTr = ConfigProviderService.getSsffTrackConfig(vTrackName);\n      var vCol = Ssffdataservice.getColumnOfTrack(vTr.name, vTr.columnName);\n      var vSRaSt = Ssffdataservice.getSampleRateAndStartTimeOfTrack(vTr.name);\n      if (col.length !== 1 || vCol.length !== 1) {\n        modalService.open('views/error.html', 'UPS... the column length of of one of the tracks is != 1 this means something is badly configured in the DB!!!').then(function () {\n          defer.reject();\n        });\n        return defer;\n      }\n      // flatten columns\n      var flatColVals = ArrayHelperService.flattenArrayOfArray(col.values);\n      var flatVcolVals = ArrayHelperService.flattenArrayOfArray(vCol.values);\n      /////////////////////////////////////////\n      var gdat = [\n          NaN,\n          NaN\n        ];\n      var vdat = [\n          NaN,\n          NaN\n        ];\n      var ndat = [\n          NaN,\n          NaN\n        ];\n      var cdat = [\n          NaN,\n          NaN\n        ];\n      // easiest way to handle non-tangential signals (and has no effect on tangential signals)\n      flatVcolVals = ArrayHelperService.convertToAbsValues(flatVcolVals);\n      // selected column samples\n      var startTimeSel = viewState.getSelectedStartTime();\n      var endTimeSel = viewState.getSelectedEndTime();\n      var colStartSampleNr = Math.round(startTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var colEndSampleNr = Math.round(endTimeSel * sRaSt.sampleRate + sRaSt.startTime);\n      var nrOfSamples = colEndSampleNr - colStartSampleNr;\n      var selCol = flatColVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      var selVCol = flatVcolVals.slice(colStartSampleNr, colStartSampleNr + nrOfSamples);\n      // maxConstr\n      var maxVerticalPos = ArrayHelperService.findMinMax(selCol, 'max');\n      cdat[0] = maxVerticalPos.idx;\n      // max vel before max constriction\n      var maxVelBeforeMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(0, cdat[0] + 1), 'max');\n      vdat[0] = maxVelBeforeMaxConstr.idx;\n      // min vel before max vel\n      var minVelBeforeMaxVel = ArrayHelperService.findMinMax(selVCol.slice(0, vdat[0] + 1), 'min');\n      // gesture onset\n      $log.info('Looking for gesture onset');\n      sServObj.interactiveFindThresholds(selVCol.slice(0, vdat[0] + 1), minVelBeforeMaxVel.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for gesture onset').then(function (resp) {\n        // keyboard;\n        var on20 = resp;\n        gdat[0] = on20;\n        // min vel between max vel 1 and max constriction\n        var minVelBetwMaxVel1maxConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[0], cdat[0] + 1), 'min');\n        var minp = minVelBetwMaxVel1maxConstr.idx + vdat[0];\n        // nucleus onset\n        $log.info('Looking for nucleus onset');\n        sServObj.interactiveFindThresholds(selVCol.slice(vdat[0], minp + 1), minVelBetwMaxVel1maxConstr.val, maxVelBeforeMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for nucleus onset').then(function (resp) {\n          var off20 = resp;\n          ndat[0] = off20 + vdat[0];\n          // max vel after max constriction\n          var maxVelAfterMaxConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0]), 'max');\n          // max vel before max constriction\n          vdat[1] = maxVelAfterMaxConstr.idx + cdat[0];\n          // minimum between max constriction and max vel after constriction\n          var minBetwMaxConstrMaxVelConstr = ArrayHelperService.findMinMax(selVCol.slice(cdat[0], vdat[1] + 1), 'min');\n          minp = minBetwMaxConstrMaxVelConstr.idx + cdat[0];\n          // nucleus offset\n          $log.info('Looking for nucleus offset');\n          sServObj.interactiveFindThresholds(selVCol.slice(minp, vdat[1] + 1), minBetwMaxConstrMaxVelConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, 1, 'Looking for nucleus offset').then(function (resp) {\n            var on20 = resp;\n            ndat[1] = on20 + minp;\n            // minimum velocity after max vel after constriction\n            var minVelAfterMaxVelAfterConstr = ArrayHelperService.findMinMax(selVCol.slice(vdat[1]), 'min');\n            minp = minVelAfterMaxVelAfterConstr.idx + vdat[1];\n            // gesture offset\n            $log.info('Looking for gesture offset');\n            sServObj.interactiveFindThresholds(selVCol.slice(vdat[1], minp + 1), minVelAfterMaxVelAfterConstr.val, maxVelAfterMaxConstr.val, ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.threshold, -1, 'Looking for gesture offset').then(function (resp) {\n              var off20 = resp;\n              gdat[1] = off20 + vdat[1];\n              // insert points\n              // var insPoint;\n              var curLabel;\n              // console.log(gdat)\n              gdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              gdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + gdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[0];\n              var gdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[0],\n                'id': gdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.gestureOnOffsetLabels[1];\n              var gdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), gdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': gdat[1],\n                'id': gdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(vdat);\n              vdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              vdat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + vdat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[0];\n              var vdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[0],\n                'id': vdat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxVelocityOnOffsetLabels[1];\n              var vdat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), vdat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': vdat[1],\n                'id': vdat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(ndat);\n              ndat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[0], sRaSt.sampleRate, sRaSt.startTime);\n              ndat[1] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + ndat[1], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[0];\n              var ndat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[0],\n                'id': ndat0insPoint.id,\n                'pointName': curLabel\n              });\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.constrictionPlateauBeginEndLabels[1];\n              var ndat1insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), ndat[1], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': ndat[1],\n                'id': ndat1insPoint.id,\n                'pointName': curLabel\n              });\n              // console.log(cdat);\n              cdat[0] = Ssffdataservice.calculateSamplePosInVP(colStartSampleNr + cdat[0], sRaSt.sampleRate, sRaSt.startTime);\n              curLabel = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.maxConstrictionLabel;\n              var cdat0insPoint = LevelService.insertEvent(viewState.getcurClickLevelName(), cdat[0], curLabel);\n              HistoryService.updateCurChangeObj({\n                'type': 'ANNOT',\n                'action': 'INSERTEVENT',\n                'name': viewState.getcurClickLevelName(),\n                'start': cdat[0],\n                'id': cdat0insPoint.id,\n                'pointName': curLabel\n              });\n              var linkLevelName = ConfigProviderService.getLevelDefinition(viewState.getcurClickLevelName()).anagestConfig.autoLinkLevelName;\n              var linkLevelDetails = LevelService.getLevelDetails(linkLevelName);\n              var linkLevelLabels = LevelService.getAllLabelsOfLevel(linkLevelDetails);\n              modalService.open('views/SelectLabelModal.html', linkLevelLabels, undefined, true).then(function (itemIdx) {\n                if (itemIdx !== false) {\n                  var childIDs = [\n                      gdat0insPoint.id,\n                      gdat1insPoint.id,\n                      vdat0insPoint.id,\n                      vdat1insPoint.id,\n                      ndat0insPoint.id,\n                      ndat1insPoint.id,\n                      cdat0insPoint.id\n                    ];\n                  LinkService.insertLinksTo(linkLevelDetails.level.items[itemIdx].id, childIDs);\n                  HistoryService.updateCurChangeObj({\n                    'type': 'ANNOT',\n                    'action': 'INSERTLINKSTO',\n                    'name': linkLevelDetails.level.name,\n                    'parentID': linkLevelDetails.level.items[itemIdx].id,\n                    'childIDs': childIDs\n                  });\n                  HistoryService.addCurChangeObjToUndoStack();\n                }\n              });\n              defer.resolve();\n            });\n          });\n        });\n      }, function () {\n      });\n      return defer.promise;\n    };\n    /**\n\t\t * find threshold in array (an adapted reimplementation of findth.m by\n\t\t * Phil Hoole Version 17.6.2006)\n\t\t *\n\t\t * @param x\n\t\t * @param minVal\n\t\t * @param maxVal\n\t\t * @param threshold\n\t\t * @param direction\n\t\t * @param descriptions describes the task\n\t\t * @returns promise that resolves to threshold value\n\t\t */\n    sServObj.interactiveFindThresholds = function (x, minVal, maxVal, threshold, direction, description) {\n      // console.log('interactiveFindThresholds');\n      var thdat = minVal + (maxVal - minVal) * threshold;\n      var thdir = direction;\n      thdat = thdat * thdir;\n      var xx = ArrayHelperService.multiplyEachElement(x, thdir);\n      // handle positive/neg.\n      var lx = xx.length;\n      var xsh = xx.slice(1, lx);\n      var loguk = 0;\n      var higuk = lx - 1;\n      // vz=find((xsh>=thdat)&(xx(1:(lx-1))<thdat));\n      var vz = [];\n      for (var i = 0; i < xx.length; i++) {\n        if (xsh[i] >= thdat && xx[i] < thdat) {\n          vz.push(i);\n        }\n      }\n      // anavv=find(vz>=loguk & vz<=higuk);\n      var anavv = [];\n      for (var i = 0; i < vz.length; i++) {\n        if (vz[i] >= loguk && vz[i] <= higuk) {\n          anavv.push(i);\n        }\n      }\n      if (anavv.length > 1) {\n        defer = $q.defer();\n        var infos = {};\n        infos.description = description;\n        infos.options = [];\n        infos.y = xx;\n        infos.minVal = minVal;\n        infos.maxVal = maxVal;\n        infos.threshold = threshold;\n        for (var i = 0; i < vz.length; i++) {\n          infos.options.push({\n            'thresholdIdx': vz[i],\n            'thresholdValue': xx[i]\n          });\n        }\n        modalService.open('views/SelectThresholdModal.html', infos, undefined, true).then(function (resp) {\n          console.log(resp);\n          var ap = vz[anavv[resp]];\n          ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n          defer.resolve(ap);\n        });\n        return defer.promise;\n      } else if (anavv.length === 0) {\n        defer = $q.defer();\n        modalService.open('views/error.html', 'Could not find any values that step over the threshold!!').then(function () {\n          defer.reject('Could not find any values that step over the threshold!!');\n        });\n        return defer.promise;\n      } else {\n        defer = $q.defer();\n        var ap = vz[anavv[0]];\n        ap = ArrayHelperService.interp2points(xx[ap], ap, xx[ap + 1], ap + 1, thdat);\n        defer.resolve(ap);\n        return defer.promise;\n      }\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DragnDropDataService', [\n  '$q',\n  'ConfigProviderService',\n  function DragnDropDataService($q, ConfigProviderService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.convertedBundles = [];\n    sServObj.sessionDefault = '';\n    ///////////////////////////////\n    // public api\n    sServObj.getBundle = function (name, session) {\n      var defer = $q.defer();\n      var ret = {};\n      angular.forEach(sServObj.convertedBundles, function (bundle, i) {\n        if (bundle.name === name) {\n          defer.resolve({\n            status: 200,\n            data: bundle\n          });\n        }\n      });\n      return defer.promise;\n    };\n    sServObj.resetToInitState = function () {\n      sServObj.convertedBundles = [];\n      sServObj.sessionDefault = '';\n    };\n    sServObj.setDefaultSession = function (name) {\n      sServObj.sessionDefault = name;\n    };\n    sServObj.getDefaultSession = function () {\n      return sServObj.sessionDefault;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').service('DragnDropService', [\n  '$q',\n  '$rootScope',\n  'appStateService',\n  'modalService',\n  'DataService',\n  'Validationservice',\n  'ConfigProviderService',\n  'DragnDropDataService',\n  'Iohandlerservice',\n  'viewState',\n  'Soundhandlerservice',\n  'Binarydatamaniphelper',\n  'browserDetector',\n  'Wavparserservice',\n  'Textgridparserservice',\n  'loadedMetaDataService',\n  function DragnDropService($q, $rootScope, appStateService, modalService, DataService, Validationservice, ConfigProviderService, DragnDropDataService, Iohandlerservice, viewState, Soundhandlerservice, Binarydatamaniphelper, browserDetector, Wavparserservice, Textgridparserservice, loadedMetaDataService) {\n    // shared service object\n    var sServObj = {};\n    sServObj.drandropBundles = [];\n    sServObj.bundleList = [];\n    sServObj.sessionName = 'File(s)';\n    sServObj.maxDroppedBundles = 10;\n    ///////////////////////////////\n    // public api\n    ///////////////////\n    // drag n drop data \n    sServObj.setData = function (bundles) {\n      var prom = [];\n      var count = 0;\n      angular.forEach(bundles, function (bundle, i) {\n        sServObj.setDragnDropData(bundle[0], i, 'wav', bundle[1]);\n        sServObj.setDragnDropData(bundle[0], i, 'annotation', bundle[2]);\n        count = i;\n      });\n      if (count <= sServObj.maxDroppedBundles) {\n        sServObj.convertDragnDropData(sServObj.drandropBundles, 0).then(function () {\n          loadedMetaDataService.setBundleList(sServObj.bundleList);\n          loadedMetaDataService.setCurBndlName(sServObj.bundleList[DragnDropDataService.sessionDefault]);\n          loadedMetaDataService.setDemoDbName(sServObj.bundleList[DragnDropDataService.sessionDefault]);\n          sServObj.handleLocalFiles();\n          return true;\n        });\n      } else {\n        return false;\n      }\n    };\n    sServObj.resetToInitState = function () {\n      sServObj.drandropBundles = [];\n      sServObj.bundleList = [];\n    };\n    /**\n\t\t * setter sServObj.drandropBundles\n\t\t */\n    sServObj.setDragnDropData = function (bundle, i, type, data) {\n      if (sServObj.drandropBundles[i] === undefined) {\n        sServObj.drandropBundles[i] = {};\n        DragnDropDataService.convertedBundles[i] = {};\n        DragnDropDataService.convertedBundles[i].name = bundle;\n        sServObj.bundleList.push({\n          name: bundle,\n          session: sServObj.sessionName\n        });\n        DragnDropDataService.setDefaultSession(i);\n      }\n      if (type === 'wav') {\n        sServObj.drandropBundles[i].wav = data;\n      } else if (type === 'annotation') {\n        sServObj.drandropBundles[i].annotation = data;\n      }\n    };\n    /**\n\t\t * getter sServObj.drandropBundles\n\t\t */\n    sServObj.getDragnDropData = function (bundle, type) {\n      if (type === 'wav') {\n        return sServObj.drandropBundles[bundle].wav;\n      } else if (type === 'annotation') {\n        return sServObj.drandropBundles[bundle].annotation;\n      } else {\n        return false;\n      }\n    };\n    sServObj.generateDrop = function (data) {\n      var objURL;\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        objURL = webkitURL.createObjectURL(sServObj.getBlob(data));\n      } else {\n        objURL = URL.createObjectURL(sServObj.getBlob(data));\n      }\n      return objURL;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getBlob = function (data) {\n      var blob;\n      try {\n        blob = new Blob([data], { type: 'text/plain' });\n      } catch (e) {\n        // Backwards-compatibility\n        window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n        blob = new BlobBuilder();\n        blob.append(data);\n        blob = blob.getBlob();\n      }\n      return blob;\n    };\n    sServObj.convertDragnDropData = function (bundles, i) {\n      var defer = $q.defer();\n      var data = sServObj.drandropBundles[i];\n      var reader = new FileReader();\n      var reader2 = new FileReader();\n      var res;\n      if (bundles.length > i) {\n        if (data.wav !== undefined) {\n          reader.readAsArrayBuffer(data.wav);\n          reader.onloadend = function (evt) {\n            if (evt.target.readyState == FileReader.DONE) {\n              if (browserDetector.isBrowser.Firefox()) {\n                res = evt.target.result;\n              } else {\n                res = evt.currentTarget.result;\n              }\n              Wavparserservice.parseWavArrBuf(res).then(function (wavJSO) {\n                DragnDropDataService.convertedBundles[i].mediaFile = {};\n                Soundhandlerservice.wavJSO = wavJSO;\n                DragnDropDataService.convertedBundles[i].mediaFile.data = Binarydatamaniphelper.arrayBufferToBase64(wavJSO.origArrBuf);\n                DragnDropDataService.convertedBundles[i].ssffFiles = {};\n                var bundle = data.wav.name.substr(0, data.wav.name.lastIndexOf('.'));\n                if (data.annotation === undefined) {\n                  DragnDropDataService.convertedBundles[i].annotation = {\n                    levels: [],\n                    links: [],\n                    sampleRate: wavJSO.SampleRate,\n                    annotates: bundle,\n                    name: bundle\n                  };\n                  sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                    defer.resolve();\n                  });\n                } else {\n                  if (data.annotation.type === 'textgrid') {\n                    reader2.readAsText(data.annotation.file);\n                    reader2.onloadend = function (evt) {\n                      if (evt.target.readyState == FileReader.DONE) {\n                        Textgridparserservice.asyncParseTextGrid(evt.currentTarget.result, data.wav.name, bundle).then(function (parseMess) {\n                          DragnDropDataService.convertedBundles[i].annotation = parseMess;\n                          sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                            defer.resolve();\n                          });\n                        });\n                      }\n                    };\n                  } else if (data.annotation.type === 'annotation') {\n                    reader2.readAsText(data.annotation.file);\n                    reader2.onloadend = function (evt) {\n                      if (evt.target.readyState == FileReader.DONE) {\n                        console.log(evt.currentTarget.result);\n                        DragnDropDataService.convertedBundles[i].annotation = evt.currentTarget.result;\n                        sServObj.convertDragnDropData(bundles, i + 1).then(function () {\n                          defer.resolve();\n                        });\n                      }\n                    };\n                  }\n                }\n              });\n            }\n          };\n        }\n      } else {\n        defer.resolve();\n        return defer.promise;\n      }\n      return defer.promise;\n    };\n    /**\n\t\t * handling local file drops after loading them\n\t\t */\n    sServObj.handleLocalFiles = function () {\n      var validRes;\n      var wav = DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].mediaFile.data;\n      var ab = Binarydatamaniphelper.base64ToArrayBuffer(wav);\n      var annotation = DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault].annotation;\n      viewState.showDropZone = false;\n      viewState.setState('loadingSaving');\n      // reset history\n      viewState.somethingInProgress = true;\n      viewState.somethingInProgressTxt = 'Loading local File: ' + wav.name;\n      Iohandlerservice.httpGetPath('configFiles/standalone_emuwebappConfig.json').then(function (resp) {\n        // first element of perspectives is default perspective\n        viewState.curPerspectiveIdx = 0;\n        ConfigProviderService.setVals(resp.data.EMUwebAppConfig);\n        delete resp.data.EMUwebAppConfig;\n        // delete to avoid duplicate\n        validRes = Validationservice.validateJSO('emuwebappConfigSchema', ConfigProviderService.vals);\n        if (validRes === true) {\n          ConfigProviderService.curDbConfig = resp.data;\n          viewState.somethingInProgressTxt = 'Parsing WAV file...';\n          Wavparserservice.parseWavArrBuf(ab).then(function (messWavParser) {\n            var wavJSO = messWavParser;\n            viewState.curViewPort.sS = 0;\n            viewState.curViewPort.eS = wavJSO.Data.length;\n            viewState.curViewPort.selectS = -1;\n            viewState.curViewPort.selectE = -1;\n            viewState.curClickSegments = [];\n            viewState.curClickLevelName = undefined;\n            viewState.curClickLevelType = undefined;\n            loadedMetaDataService.setCurBndl(DragnDropDataService.convertedBundles[DragnDropDataService.sessionDefault]);\n            viewState.resetSelect();\n            viewState.curPerspectiveIdx = 0;\n            var annot = annotation;\n            DataService.setData(annotation);\n            var lNames = [];\n            var levelDefs = [];\n            annotation.levels.forEach(function (l) {\n              lNames.push(l.name);\n              levelDefs.push({\n                'name': l.name,\n                'type': l.type,\n                'attributeDefinitions': {\n                  'name': l.name,\n                  'type': 'string'\n                }\n              });\n            });\n            // set level defs\n            ConfigProviderService.curDbConfig.levelDefinitions = levelDefs;\n            viewState.setCurLevelAttrDefs(ConfigProviderService.curDbConfig.levelDefinitions);\n            ConfigProviderService.setPerspectivesOrder(viewState.curPerspectiveIdx, lNames);\n            //ConfigProviderService.vals.perspectives[viewState.curPerspectiveIdx].levelCanvases.order = lNames;\t\t\t\t\t\t\t\n            Soundhandlerservice.wavJSO = wavJSO;\n            // set all ssff files\n            viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n            var validRes = Validationservice.validateJSO('annotationFileSchema', annotation);\n            if (validRes === true) {\n              DataService.setData(annotation);\n              viewState.setState('labeling');\n              viewState.somethingInProgress = false;\n              viewState.somethingInProgressTxt = 'Done!';\n            } else {\n              modalService.open('views/error.html', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                sServObj.resetToInitState();\n                appStateService.resetToInitState();\n              });\n            }\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Error parsing wav file: ' + errMess).then(function () {\n              sServObj.resetToInitState();\n              appStateService.resetToInitState();\n            });\n          });\n        }\n      });\n      viewState.somethingInProgress = false;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc directive\n * @name emuWebAppApp.directive:lineChart\n * @description\n * # lineChart\n */\nangular.module('emuwebApp').directive('lineChart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      threshold: '='\n    },\n    link: function postLink(scope, element, attrs) {\n      //////////////////////\n      // watches \n      scope.$watch('data', function () {\n        scope.render(scope.data);\n      }, true);\n      //////////////////////\n      //Set margins, width, and height\n      var margin = {\n          top: 20,\n          right: 20,\n          bottom: 20,\n          left: 40\n        }, width = 400 - margin.left - margin.right, height = 200 - margin.top - margin.bottom;\n      //Create the d3 element and position it based on margins\n      var svg = d3.select(element[0]).append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      //Create the scales we need for the graph\n      var x = d3.scale.linear().range([\n          0,\n          width\n        ]);\n      var y = d3.scale.linear().range([\n          height,\n          0\n        ]);\n      //Create the axes we need for the graph\n      var xAxis = d3.svg.axis().scale(x).tickSize(5).tickSubdivide(true);\n      var yAxis = d3.svg.axis().scale(y).orient('left');\n      // line drawing function\n      var lineFunc = d3.svg.line().x(function (d) {\n          return x(d.x);\n        }).y(function (d) {\n          return y(d.y);\n        }).interpolate('linear');\n      /**\n\t\t\t\t *\n\t\t\t\t */\n      scope.render = function (data) {\n        //Set our scale's domains\n        // x.domain(data.map(function (d) {\n        // \treturn d.name;\n        // }));\n        // y.domain([0, d3.max(data, function (d) {\n        // \treturn d.count;\n        // })]);\n        x.domain([\n          d3.min(data, function (d) {\n            return d.x;\n          }),\n          d3.max(data, function (d) {\n            return d.x;\n          })\n        ]);\n        y.domain([\n          d3.min(data, function (d) {\n            return d.y;\n          }),\n          d3.max(data, function (d) {\n            return d.y;\n          })\n        ]);\n        //Remove the axes so we can draw updated ones\n        svg.selectAll('g.axis').remove();\n        //Render X axis\n        svg.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + height + ')').call(xAxis);\n        //Render Y axis\n        svg.append('g').attr('class', 'y axis').call(yAxis);\n        // Render path\n        var lines = svg.append('svg:path').attr('d', lineFunc(data)).attr('stroke', 'red').attr('stroke-width', 1).attr('fill', 'none');\n        // draw threshold SIC SIC SIC... not working yet!\n        svg.append('svg:line').attr('x1', 5).attr('y1', 5).attr('x2', 200).attr('y2', 200).attr('class', 'label-line');\n        var verticalLine = svg.append('line').attr({\n            'x1': x(scope.threshold),\n            'y1': 0,\n            'x2': x(scope.threshold),\n            'y2': height\n          }).attr('stroke', 'steelblue').attr('class', 'verticalLine');  //Create or update the bar data\n                                                                         // var bars = svg.selectAll('.bar').data(data);\n                                                                         // bars.enter()\n                                                                         // \t.append('rect')\n                                                                         // \t.attr('class', 'bar')\n                                                                         // \t.attr('x', function (d) {\n                                                                         // \t\treturn x(d.name);\n                                                                         // \t})\n                                                                         // \t.attr('width', x.rangeBand());\n                                                                         //Animate bars\n                                                                         // bars\n                                                                         // \t.transition()\n                                                                         // \t.duration(1000)\n                                                                         // \t.attr('height', function (d) {\n                                                                         // \t\treturn height - y(d.count);\n                                                                         // \t})\n                                                                         // \t.attr('y', function (d) {\n                                                                         // \t\treturn y(d.count);\n                                                                         // \t})\n      };\n    }\n  };\n});\n'use strict';\nangular.module('emuwebApp').directive('tutorial', [\n  'viewState',\n  'Iohandlerservice',\n  'ConfigProviderService',\n  function (viewState, Iohandlerservice, ConfigProviderService) {\n    return {\n      templateUrl: 'views/tutorial.html',\n      restrict: 'E',\n      scope: {},\n      link: function postLink(scope, element, attrs) {\n        scope.counter = 0;\n        scope.css = [];\n        scope.vs = viewState;\n        scope.cps = ConfigProviderService;\n        scope.cssDone = { color: '#222' };\n        scope.cssNotDone = { color: '#ddd' };\n        scope.cssActive = {\n          color: 'red',\n          'font-size': '18px'\n        };\n        scope.que = [];\n        scope.$watch('vs.lastKeyCode', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            if (newValue === scope.que[scope.counter]) {\n              ++scope.counter;\n            }\n          }\n          console.log(newValue);\n        });\n        scope.getClass = function (i) {\n          if (i == scope.counter) {\n            return scope.cssActive;\n          } else if (i < scope.counter) {\n            return scope.cssDone;\n          } else {\n            return scope.cssNotDone;\n          }\n        };\n        scope.getStrRep = function (id, code) {\n          scope.que[id] = code;\n          return ConfigProviderService.getStrRep(code);\n        };\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.loadedMetaDataService\n * @description\n * # loadedMetaDataService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('loadedMetaDataService', [\n  'Validationservice',\n  function loadedMetaDataService(Validationservice) {\n    // shared service object\n    var sServObj = {};\n    //////////////////////\n    // private vars\n    var uniqSessionList = [];\n    var bundleList = [];\n    var curBndl = {};\n    var demoDbName = '';\n    var drandropBundles = [];\n    var rendOptBndlList = {};\n    // render optimized bundle list\n    //////////////////////\n    // private functions\n    function genUniqSessionList(bndlList) {\n      var sList = [];\n      var fistSes;\n      bndlList.forEach(function (bndl, idx) {\n        sList[bndl.session] = { 'collapsed': true };\n        if (idx === 0) {\n          fistSes = bndl.session;\n        }\n      });\n      // open fist session up \n      sList[fistSes].collapsed = false;\n      return sList;\n    }\n    function genRendOptBndlList(bndlList) {\n      bndlList.forEach(function (bndl, idx) {\n        if (rendOptBndlList[bndl.session] === undefined) {\n          rendOptBndlList[bndl.session] = [];\n        }\n        rendOptBndlList[bndl.session].push(bndl);\n      });\n      return rendOptBndlList;\n    }\n    //////////////////////\n    //////////////////////\n    // public API\n    ///////////////\n    // bundleList\n    /**\n\t\t * setter for bundleList\n\t\t * @returns validation result for bundle list\n\t\t */\n    sServObj.setBundleList = function (bList) {\n      // validate\n      var validRes = Validationservice.validateJSO('bundleListSchema', bList);\n      if (validRes === true) {\n        // set\n        bundleList = bList;\n        // generate uniqSessionList\n        uniqSessionList = genUniqSessionList(bundleList);\n        // generate render optimized bundlList\n        rendOptBndlList = genRendOptBndlList(bundleList);\n      }\n      return validRes;\n    };\n    /**\n\t\t * getter for bundleList\n\t\t */\n    sServObj.getBundleList = function () {\n      return bundleList;\n    };\n    /**\n\t\t * getter for rendOptBndlList\n\t\t */\n    sServObj.getRendOptBndlList = function () {\n      return rendOptBndlList;\n    };\n    ///////////\n    // curBndl \n    /**\n\t\t * getter curBndl\n\t\t */\n    sServObj.getCurBndl = function () {\n      return curBndl;\n    };\n    /**\n\t\t * setter curBndl\n\t\t */\n    sServObj.setCurBndl = function (bndl) {\n      curBndl = bndl;\n    };\n    /**\n\t\t * getter curBndl name\n\t\t */\n    sServObj.getCurBndlName = function () {\n      return curBndl.name;\n    };\n    /**\n\t\t * setter curBndl name\n\t\t */\n    sServObj.setCurBndlName = function (name) {\n      curBndl.name = name;\n    };\n    //////////////\n    // demoDbName\n    /**\n\t\t * setter demoDbName\n\t\t */\n    sServObj.setDemoDbName = function (name) {\n      demoDbName = name;\n    };\n    /**\n\t\t * getter demoDbName\n\t\t */\n    sServObj.getDemoDbName = function () {\n      return demoDbName;\n    };\n    ///////////////////\n    // uniqSessionList\n    /**\n\t\t *\n\t\t */\n    sServObj.toggleCollapseSession = function (session) {\n      uniqSessionList[session].collapsed = !uniqSessionList[session].collapsed;\n      // close all other sessions\n      Object.keys(uniqSessionList).forEach(function (key) {\n        if (key !== session) {\n          uniqSessionList[key].collapsed = true;\n        }\n      });\n    };\n    /**\n\t\t *\n\t\t */\n    // sServObj.updateCollapseSessionState = function (text) {\n    // \tangular.forEach(sServObj.getBundleList(), function (bundle) {\n    // \t\tif (bundle.name.indexOf(text)) {\n    // \t\t\tuniqSessionList[bundle.session].collapsed = false;\n    // \t\t} else {\n    // \t\t\tuniqSessionList[bundle.session].collapsed = true;\n    // \t\t}\n    // \t});\n    // };\n    /**\n\t\t *\n\t\t */\n    sServObj.getSessionCollapseState = function (session) {\n      return uniqSessionList[session].collapsed;\n    };\n    ///////////////////\n    // other functions\n    /**\n\t\t * reset all private vals to init state\n\t\t */\n    sServObj.resetToInitState = function () {\n      uniqSessionList = [];\n      bundleList = [];\n      curBndl = {};\n      rendOptBndlList = {};\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc function\n * @name emuwebApp.controller:BundlelistsidebarctrlCtrl\n * @description\n * # bundleListSideBarCtrl\n * Controller of the bundleListSideBar\n */\nangular.module('emuwebApp').controller('bundleListSideBarCtrl', [\n  '$scope',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'dbObjLoadSaveService',\n  'ConfigProviderService',\n  function ($scope, viewState, HistoryService, loadedMetaDataService, dbObjLoadSaveService, ConfigProviderService) {\n    $scope.vs = viewState;\n    $scope.lmds = loadedMetaDataService;\n    $scope.dolss = dbObjLoadSaveService;\n    $scope.cps = ConfigProviderService;\n    $scope.filterText = '';\n    $scope.pageSize = 500;\n    $scope.currentPage = 0;\n    $scope.numberOfPages = function (sessionLength) {\n      return Math.ceil(sessionLength / $scope.pageSize);\n    };\n    /**\n\t\t * returns false if bndl is current bndl\n\t\t */\n    $scope.uttIsDisabled = function (bndl) {\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return false;\n      } else {\n        return true;\n      }\n    };\n    /**\n\t\t * returns jso with css defining color dependent\n\t\t * on if changes have been made that have not been saved\n\t\t * @param bndl object containing name attribute of bundle item\n\t\t * requesting color\n\t\t * @returns color as jso object used by ng-style\n\t\t */\n    $scope.getBndlColor = function (bndl) {\n      var curColor;\n      if (HistoryService.movesAwayFromLastSave !== 0) {\n        curColor = {\n          'background-color': '#f00',\n          'color': 'white'\n        };\n      } else {\n        curColor = {\n          'background-color': '#999',\n          'color': 'black'\n        };\n      }\n      // console.log(bndl.name)\n      if (bndl.name === loadedMetaDataService.getCurBndl().name) {\n        return curColor;\n      }\n    };\n    /**\n\t\t * checks if name is undefined\n\t\t * @return bool\n\t\t */\n    $scope.isSessionDefined = function (ses) {\n      if (ses === 'undefined') {\n        return false;\n      } else {\n        return true;\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.dbObjLoadSaveService\n * @description\n * # dbObjLoadSaveService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('dbObjLoadSaveService', [\n  '$log',\n  '$q',\n  'DataService',\n  'viewState',\n  'HistoryService',\n  'loadedMetaDataService',\n  'Ssffdataservice',\n  'Iohandlerservice',\n  'Binarydatamaniphelper',\n  'Wavparserservice',\n  'Soundhandlerservice',\n  'Ssffparserservice',\n  'Validationservice',\n  'LevelService',\n  'modalService',\n  'ConfigProviderService',\n  'appStateService',\n  function dbObjLoadSaveService($log, $q, DataService, viewState, HistoryService, loadedMetaDataService, Ssffdataservice, Iohandlerservice, Binarydatamaniphelper, Wavparserservice, Soundhandlerservice, Ssffparserservice, Validationservice, LevelService, modalService, ConfigProviderService, appStateService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t * general loadBundle method.\n\t\t * @param bndl object containing name attribute of currently loaded bundle\n\t\t */\n    sServObj.loadBundle = function (bndl) {\n      // check if bndl has to be saved\n      if (HistoryService.movesAwayFromLastSave !== 0 && ConfigProviderService.vals.main.comMode !== 'DEMO') {\n        var curBndl = loadedMetaDataService.getCurBndl();\n        if (bndl !== curBndl) {\n          // $scope.lastclickedutt = bndl;\n          modalService.open('views/saveChanges.html', curBndl.session + ':' + curBndl.name).then(function (messModal) {\n            if (messModal === 'saveChanges') {\n              // save current bundle\n              sServObj.saveBundle().then(function () {\n                // load new bundle\n                sServObj.loadBundle(bndl);\n              });\n            } else if (messModal === 'discardChanges') {\n              // reset history\n              HistoryService.resetToInitState();\n              // load new bundle\n              sServObj.loadBundle(bndl);\n            }\n          });\n        }\n      } else {\n        if (bndl !== loadedMetaDataService.getCurBndl()) {\n          // reset history\n          HistoryService.resetToInitState();\n          // set state\n          viewState.setState('loadingSaving');\n          viewState.somethingInProgress = true;\n          viewState.somethingInProgressTxt = 'Loading bundle: ' + bndl.name;\n          // empty ssff files\n          Ssffdataservice.data = [];\n          Iohandlerservice.getBundle(bndl.name, bndl.session, loadedMetaDataService.getDemoDbName()).then(function (bundleData) {\n            // check if response from http request\n            if (bundleData.status === 200) {\n              bundleData = bundleData.data;\n            }\n            // validate bundle\n            var validRes = Validationservice.validateJSO('bundleSchema', bundleData);\n            if (validRes === true) {\n              var arrBuff;\n              // set wav file\n              arrBuff = Binarydatamaniphelper.base64ToArrayBuffer(bundleData.mediaFile.data);\n              viewState.somethingInProgressTxt = 'Parsing WAV file...';\n              Wavparserservice.parseWavArrBuf(arrBuff).then(function (messWavParser) {\n                var wavJSO = messWavParser;\n                viewState.curViewPort.sS = 0;\n                viewState.curViewPort.eS = wavJSO.Data.length;\n                viewState.curViewPort.selectS = -1;\n                viewState.curViewPort.selectE = -1;\n                viewState.curClickSegments = [];\n                viewState.curClickLevelName = undefined;\n                viewState.curClickLevelType = undefined;\n                viewState.resetSelect();\n                // FOR DEVELOPMENT:\n                // viewState.curViewPort.sS = 52063;\n                // viewState.curViewPort.eS = 52100;\n                // viewState.curViewPort.selectS = 27575;\n                // viewState.curViewPort.selectE = 34538;\n                Soundhandlerservice.wavJSO = wavJSO;\n                // set all ssff files\n                viewState.somethingInProgressTxt = 'Parsing SSFF files...';\n                Ssffparserservice.asyncParseSsffArr(bundleData.ssffFiles).then(function (ssffJso) {\n                  Ssffdataservice.data = ssffJso.data;\n                  // set annotation\n                  DataService.setData(bundleData.annotation);\n                  loadedMetaDataService.setCurBndl(bndl);\n                  viewState.setState('labeling');\n                  viewState.somethingInProgress = false;\n                  viewState.somethingInProgressTxt = 'Done!';  // FOR DEVELOPMENT:\n                                                               // sServObj.saveBundle(); // for testing save function\n                                                               // $scope.menuBundleSaveBtnClick(); // for testing save button\n                                                               // $scope.showHierarchyBtnClick(); // for devel of showHierarchy modal\n                                                               // $scope.spectSettingsBtnClick(); // for testing spect settings dial\n                }, function (errMess) {\n                  modalService.open('views/error.html', 'Error parsing SSFF file: ' + errMess.status.message).then(function () {\n                    appStateService.resetToInitState();\n                  });\n                });\n              }, function (errMess) {\n                modalService.open('views/error.html', 'Error parsing wav file: ' + errMess.status.message).then(function () {\n                  appStateService.resetToInitState();\n                });\n              });\n            } else {\n              modalService.open('views/error.html', 'Error validating annotation file: ' + JSON.stringify(validRes, null, 4)).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          }, function (errMess) {\n            // check for http vs websocket response\n            if (errMess.data) {\n              modalService.open('views/error.html', 'Error loading bundle: ' + errMess.data).then(function () {\n                appStateService.resetToInitState();\n              });\n            } else {\n              modalService.open('views/error.html', 'Error loading bundle: ' + errMess.status.message).then(function () {\n                appStateService.resetToInitState();\n              });\n            }\n          });\n        }\n      }\n    };\n    /**\n\t\t * general purpose save bundle function.\n\t\t * @return promise that is resolved after completion (rejected on error)\n\t\t */\n    sServObj.saveBundle = function () {\n      // check if something has changed\n      // if (HistoryService.movesAwayFromLastSave !== 0) {\n      if (viewState.getPermission('saveBndlBtnClick')) {\n        var defer = $q.defer();\n        viewState.somethingInProgress = true;\n        viewState.setState('loadingSaving');\n        //create bundle json\n        var bundleData = {};\n        viewState.somethingInProgressTxt = 'Creating bundle json...';\n        bundleData.ssffFiles = [];\n        var formants = {};\n        // ssffFiles (only FORMANTS are allowed to be manipulated so only this track is sent back to server)\n        var formants = Ssffdataservice.getFile('FORMANTS');\n        if (formants !== undefined) {\n          Ssffparserservice.asyncJso2ssff(formants).then(function (messParser) {\n            bundleData.ssffFiles.push({\n              'fileExtension': formants.fileExtension,\n              'encoding': 'BASE64',\n              'data': Binarydatamaniphelper.arrayBufferToBase64(messParser.data)\n            });\n            sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n          }, function (errMess) {\n            modalService.open('views/error.html', 'Error converting javascript object to SSFF file: ' + errMess.status.message);\n            defer.reject();\n          });\n        } else {\n          sServObj.getAnnotationAndSaveBndl(bundleData, defer);\n        }\n        return defer.promise;  // }\n      } else {\n        $log.info('Action: menuBundleSaveBtnClick not allowed!');\n      }\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getAnnotationAndSaveBndl = function (bundleData, defer) {\n      // annotation\n      bundleData.annotation = DataService.getData();\n      var curBndl = loadedMetaDataService.getCurBndl();\n      // add session if available\n      if (typeof curBndl.session !== 'undefined') {\n        bundleData.session = curBndl.session;\n      }\n      // add finishedEditing if available\n      if (typeof curBndl.finishedEditing !== 'undefined') {\n        bundleData.finishedEditing = curBndl.finishedEditing;\n      }\n      // add comment if available\n      if (typeof curBndl.comment !== 'undefined') {\n        bundleData.comment = curBndl.comment;\n      }\n      viewState.somethingInProgressTxt = 'Saving bundle...';\n      Iohandlerservice.saveBundle(bundleData).then(function () {\n        viewState.somethingInProgressTxt = 'Done!';\n        viewState.somethingInProgress = false;\n        HistoryService.movesAwayFromLastSave = 0;\n        defer.resolve();\n        viewState.setState('labeling');\n      }, function (errMess) {\n        // console.log(mess);\n        modalService.open('views/error.html', 'Error saving bundle: ' + errMess.status.message).then(function () {\n          appStateService.resetToInitState();\n        });\n        defer.reject();\n      });\n    };\n    return sServObj;\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.appStateService\n * @description\n * # appStateService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('appStateService', [\n  '$log',\n  '$rootScope',\n  'DragnDropDataService',\n  'viewState',\n  'Iohandlerservice',\n  'loadedMetaDataService',\n  'Soundhandlerservice',\n  'DataService',\n  'Ssffdataservice',\n  'HistoryService',\n  function appStateService($log, $rootScope, DragnDropDataService, viewState, Iohandlerservice, loadedMetaDataService, Soundhandlerservice, DataService, Ssffdataservice, HistoryService) {\n    // shared service object\n    var sServObj = {};\n    /**\n\t\t *\n\t\t */\n    sServObj.resetToInitState = function () {\n      if (Iohandlerservice.wsH.isConnected()) {\n        Iohandlerservice.wsH.disconnectWarning().then(function (resp) {\n          $log.info('Closing websocket connection to server');\n          Iohandlerservice.wsH.closeConnect();\n        });\n      }\n      // $scope.curBndl = {};\n      loadedMetaDataService.resetToInitState();\n      Soundhandlerservice.wavJSO = {};\n      DataService.setData({});\n      DragnDropDataService.resetToInitState();\n      Ssffdataservice.data = [];\n      HistoryService.resetToInitState();\n      viewState.setState('noDBorFilesloaded');\n      viewState.somethingInProgress = false;\n      viewState.resetToInitState();\n      HistoryService.resetToInitState();\n      viewState.showDropZone = true;\n      $rootScope.$broadcast('resetToInitState');  //$scope.loadDefaultConfig();\n    };\n    return sServObj;\n  }\n]);\n/**\n * A simple class that creates another thread\n * which does the wavParserWorker work\n * @class wavParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction wavParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nwavParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.ab2str = function (ab) {\n      var unis = [];\n      for (var i = 0; i < ab.length; i++) {\n        unis.push(ab[i]);\n      }\n      return String.fromCharCode.apply(null, unis);\n    };\n    global.wav2jso = function (buf) {\n      var wavRep = {};\n      // var uIntBuffView = new Uint8Array(buf);\n      var curBinIdx, curBuffer, curBufferView;\n      // var dv = new DataView(buf);\n      // var ChunkSize = dv.getUint32(4)\n      // console.log(ChunkSize)\n      // ChunkId == RIFF CHECK\n      curBinIdx = 0;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.ChunkID = global.ab2str(curBufferView);\n      if (wavRep.ChunkID !== 'RIFF') {\n        // console.error('Wav read error: ChunkID not RIFF. Got ' + wavRep.ChunkID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: ChunkID not RIFF but ' + wavRep.ChunkID\n          }\n        };\n      }\n      // ChunkSize\n      curBinIdx = 4;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ChunkSize = curBufferView[0];\n      // console.log(chunkSize)\n      // Format == WAVE CHECK\n      curBinIdx = 8;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Format = global.ab2str(curBufferView);\n      if (wavRep.Format !== 'WAVE') {\n        // console.error('Wav read error: Format not WAVE. Got ' + wavRep.Format);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Format not WAVE but ' + wavRep.Format\n          }\n        };\n      }\n      // Subchunk1ID == \"fmt \" CHECK\n      curBinIdx = 12;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk1ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk1ID !== 'fmt ') {\n        // console.error('Wav read error: Subchunk1ID not fmt. Got ' + wavRep.Subchunk1ID);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1ID not fmt  but ' + wavRep.Subchunk1ID\n          }\n        };\n      }\n      // Subchunk1Size == 16 CHECK\n      curBinIdx = 16;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk1Size = curBufferView[0];\n      if (wavRep.Subchunk1Size !== 16) {\n        // console.error('Wav read error: Subchunk1Size not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk1Size not 16 but ' + wavRep.Subchunk1Size\n          }\n        };\n      }\n      // AudioFormat == 1  CHECK\n      curBinIdx = 20;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.AudioFormat = curBufferView[0];\n      if (wavRep.AudioFormat !== 1) {\n        // console.error('Wav read error: AudioFormat not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: AudioFormat not 1 but ' + wavRep.AudioFormat\n          }\n        };\n      }\n      // NumChannels == 1  CHECK\n      curBinIdx = 22;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.NumChannels = curBufferView[0];\n      // console.error('Wav read error: NumChannels not 1');\n      if (wavRep.NumChannels !== 1) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: NumChannels not 1 but ' + wavRep.NumChannels\n          }\n        };\n      }\n      // SampleRate \n      curBinIdx = 24;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.SampleRate = curBufferView[0];\n      // ByteRate\n      curBinIdx = 28;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.ByteRate = curBufferView[0];\n      // BlockAlign\n      curBinIdx = 32;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BlockAlign = curBufferView[0];\n      // console.error(blockAlign);\n      // BitsPerSample\n      curBinIdx = 34;\n      curBuffer = buf.subarray(curBinIdx, 2);\n      curBufferView = new Uint16Array(curBuffer);\n      wavRep.BitsPerSample = curBufferView[0];\n      if (wavRep.BitsPerSample !== 16) {\n        // console.error('Wav read error: NumChannels not 1');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: BitsPerSample not 16 but ' + wavRep.BitsPerSample\n          }\n        };\n      }\n      // Subchunk2ID\n      curBinIdx = 36;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint8Array(curBuffer);\n      wavRep.Subchunk2ID = global.ab2str(curBufferView);\n      if (wavRep.Subchunk2ID !== 'data') {\n        // console.error('Wav read error: BitsPerSample not 16');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Wav read error: Subchunk2ID not data but ' + wavRep.Subchunk2ID\n          }\n        };\n      }\n      // Subchunk2Size\n      curBinIdx = 40;\n      curBuffer = buf.subarray(curBinIdx, 4);\n      curBufferView = new Uint32Array(curBuffer);\n      wavRep.Subchunk2Size = curBufferView[0];\n      // Data\n      curBinIdx = 44;\n      curBuffer = buf.subarray(curBinIdx, wavRep.Subchunk2Size);\n      curBufferView = new Int16Array(curBuffer);\n      wavRep.Data = curBufferView;\n      // console.log(wavRep);\n      // finally append original array buffer\n      wavRep.origArrBuf = buf;\n      return wavRep;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseBuf':\n          var parserRes = global.wav2jso(e.data.buffer);\n          if (parserRes.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': parserRes\n            });\n          } else {\n            global.postMessage(parserRes);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to wavParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to wavParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the espsParserWorker work\n * @class espsParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction espsParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nespsParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.toJSO = function (string, annotates, name, sampleRate) {\n      var labelJSO = {};\n      labelJSO.name = name;\n      labelJSO.annotates = annotates;\n      labelJSO.sampleRate = sampleRate;\n      labelJSO.levels = [];\n      // var ext = '_' + filePath.split('.')[filePath.split('.').length - 1];\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace all blanks with single whitespace\n      string = string.replace(/[ \\t]+/g, ' ');\n      var lines = string.split('\\n');\n      // find header end\n      var headEndIdx;\n      for (var i = 0; i < lines.length; i++) {\n        if (lines[i] === '#') {\n          headEndIdx = i;\n          break;\n        }\n      }\n      //init empty labelJSO\n      labelJSO.levels[0] = {};\n      labelJSO.levels[0].name = name;\n      labelJSO.levels[0].items = [];\n      var idCounter = 1;\n      // set level type\n      var prevLineArr;\n      var curLineArr = lines[headEndIdx + 1].split(/\\s+/);\n      if (curLineArr[curLineArr.length - 1] !== 'H#') {\n        labelJSO.levels[0].type = 'EVENT';\n      } else {\n        labelJSO.levels[0].type = 'SEGMENT';\n      }\n      if (labelJSO.levels[0].type === 'EVENT') {\n        for (i = headEndIdx + 1; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            samplePoint: Math.floor(curLineArr[1] * sampleRate)\n          });\n          idCounter += 1;\n        }\n      } else {\n        // take care of H# by not doing anything :-)\n        idCounter += 1;\n        for (i = headEndIdx + 2; i < lines.length - 1; i++) {\n          curLineArr = lines[i].split(/\\s+/);\n          prevLineArr = lines[i - 1].split(/\\s+/);\n          labelJSO.levels[0].items.push({\n            id: idCounter,\n            labels: [{\n                name: name,\n                value: curLineArr[curLineArr.length - 1]\n              }],\n            sampleStart: Math.floor(prevLineArr[1] * sampleRate),\n            sampleDur: Math.floor(curLineArr[1] * sampleRate) - Math.floor(prevLineArr[1] * sampleRate) - 1\n          });\n          idCounter += 1;\n        }\n      }\n      return labelJSO;\n    };\n    /**\n\t * SIC! This function probably has to be fixed...\n\t */\n    global.toESPS = function (data, name, sampleRate) {\n      var espsStr = '';\n      // construct header\n      espsStr += 'signal ' + name + '\\n';\n      espsStr += 'nfields 1\\n';\n      espsStr += '#\\n';\n      var curLabel;\n      for (var j = 0; j < data.length; j++) {\n        //angular.forEach(data, function (i, idx) {\n        if (data[j].labels[0].value === '' && j === 0) {\n          curLabel = 'H#';\n        } else {\n          curLabel = data[j].labels[0].value;\n        }\n        espsStr += '\\t' + String((data[j].sampleStart + data[j].sampleDur) / sampleRate) + '\\t125\\t' + curLabel + '\\n';\n      }\n      //});\n      // console.log(espsStr);\n      return espsStr;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseESPS':\n          retVal = global.toJSO(e.data.esps, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'parseJSO':\n          retVal = global.toESPS(e.data.level.items, e.data.level.name, e.data.sampleRate);\n          if (retVal.type === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to espsParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to espsParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n/**\n * A simple class that creates another thread\n * which does the textGridParserWorker work\n * @class textGridParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction textGridParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\ntextGridParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    global.l1 = 'File type = \"ooTextFile\"';\n    global.l2 = 'Object class = \"TextGrid\"';\n    global.localID = 0;\n    /**\n\t * test to see if all the segments in seg levels\n\t * are \"snapped\" -> sampleStart+dur+1 = sampleStart of next Segment\n\t */\n    global.testForGapsInLabelJSO = function (labelJSO) {\n      var counter = 0;\n      for (var i = 0; i < labelJSO.levels.length; i++) {\n        if (labelJSO.levels[i].type === 'SEGMENT') {\n          for (var j = 0; j < labelJSO.levels[i].items.length - 1; j++) {\n            if (labelJSO.levels[i].items[j].sampleStart + labelJSO.levels[i].items[j].sampleDur + 1 !== labelJSO.levels[i].items[j + 1].sampleStart) {\n              counter = counter + 1;\n            }\n          }\n        }\n      }\n    };\n    /**\n\t *\n\t */\n    global.findTimeOfMinSample = function () {\n      return 0;  // maybe needed at some point...\n    };\n    /**\n\t *\n\t */\n    global.findTimeOfMaxSample = function (buffLength, sampleRate) {\n      return buffLength / sampleRate;\n    };\n    /**\n\t * parse a textgrid string to the specified json format\n\t *\n\t * @param string TextGrid file string to be parsed\n\t * @returns a label java script object\n\t */\n    global.toJSO = function (string, myFile, myName, sampleRate) {\n      var VU_STR = '123abcABCCBAcba321';\n      // very unlikly string\n      // remove all empty lines from string\n      string = string.replace(/([ \\t]*\\r?\\n)+/g, '\\n');\n      // replace blanks in quates with VU_STR to preserve blanks in labels\n      string = string.replace(/(\"[^\\n]*\")/g, function ($0, $1) {\n        var res = $1.replace(/\\s+/g, VU_STR);\n        return res;\n      });\n      // remove remaining blanks\n      string = string.replace(/[\\t ]+/g, '');\n      // convert VU_STR back to blanks\n      var re = new RegExp(VU_STR, 'g');\n      string = string.replace(re, ' ');\n      var lines = string.split('\\n');\n      var tT, tN, eT, lab;\n      var inHeader = true;\n      var labs = [];\n      //meta info for labelJSO\n      var labelJSO = {\n          name: myName,\n          annotates: myFile,\n          sampleRate: sampleRate,\n          levels: [],\n          links: []\n        };\n      if (lines[0].replace(/\\s+/g, '') === global.l1.replace(/\\s+/g, '') && lines[1].replace(/\\s+/g, '') === global.l2.replace(/\\s+/g, '')) {\n        for (var i = 2; i < lines.length; i++) {\n          var cL = lines[i];\n          if (cL === 'item[]:') {\n            inHeader = false;\n            continue;\n          }\n          if (inHeader) {\n            continue;\n          }\n          if (cL.indexOf('item[') === 0) {\n            // get level name\n            tN = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            // get level type\n            if (lines[i + 1].split(/=/)[1] === '\"IntervalTier\"') {\n              tT = 'SEGMENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else if (lines[i + 1].split(/=/)[1] === '\"TextTier\"') {\n              tT = 'EVENT';\n              // adding new level\n              labelJSO.levels.push({\n                name: tN,\n                type: tT,\n                items: []\n              });\n            } else {\n            }\n          }\n          if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'SEGMENT' && cL.indexOf('intervals') === 0 && cL.indexOf('intervals:') !== 0) {\n            // parse seg levels event\n            var eSt = Math.floor(lines[i + 1].split(/=/)[1] * sampleRate) + 1;\n            // correct to zero for first sample\n            if (eSt === 1) {\n              eSt = 0;\n            }\n            var eEt = Math.floor(lines[i + 2].split(/=/)[1] * sampleRate);\n            lab = lines[i + 3].split(/=/)[1].replace(/\"/g, '');\n            var labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              sampleStart: eSt,\n              sampleDur: eEt - eSt + 1,\n              labels: labs\n            });\n            ++global.localID;\n          } else if (labelJSO.levels.length > 0 && labelJSO.levels[labelJSO.levels.length - 1].type === 'EVENT' && cL.indexOf('points') === 0 && cL.indexOf('points:') !== 0) {\n            // parse point level event\n            eT = lines[i + 1].split(/=/)[1] * sampleRate;\n            lab = lines[i + 2].split(/=/)[1].replace(/\"/g, '');\n            labs = [];\n            labs.push({\n              name: labelJSO.levels[labelJSO.levels.length - 1].name,\n              value: lab\n            });\n            labelJSO.levels[labelJSO.levels.length - 1].items.push({\n              id: global.localID,\n              samplePoint: Math.round(eT),\n              labels: labs\n            });\n            ++global.localID;\n          }\n        }\n        // console.log(JSON.stringify(labelJSO, undefined, 2));\n        global.testForGapsInLabelJSO(labelJSO);\n        return labelJSO;\n      } else {\n        // alert('bad header in TextGrid file!!! The header has to be: ', global.l1, '\\n', global.l2);\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'bad header in TextGrid file!!! The header has to be: ' + global.l1 + '\\n' + global.l2\n          }\n        };\n      }\n    };\n    /**\n\t * converts the internal levels format returned from levelHandler.getLevels\n\t * to a string containing a TextGrid file\n\t */\n    global.toTextGrid = function (levelData, buffLength, sampleRate) {\n      var tG = '';\n      var nl = '\\n';\n      var t = '\\t';\n      // writing header infos\n      tG = tG + global.l1 + nl + global.l2 + nl + nl;\n      tG = tG + 'xmin = ' + global.findTimeOfMinSample() + nl;\n      tG = tG + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n      tG = tG + 'levels? <exists>' + nl;\n      tG = tG + 'size = ' + levelData.length + nl;\n      tG = tG + 'item []:' + nl;\n      //var levelNr = 0;\n      for (var levelNr = 0; levelNr < levelData.length; levelNr++) {\n        //angular.forEach(levelData, function (curLevel) {\n        //write level items\n        //levelNr = levelNr + 1;\n        var curLevel = levelData[levelNr];\n        tG = tG + t + 'item [' + levelNr + ']:' + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'class = \"IntervalTier\"' + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'class = \"TextTier\"' + nl;\n        }\n        tG = tG + t + t + 'name = \"' + curLevel.name + '\"' + nl;\n        tG = tG + t + t + 'xmin = ' + global.findTimeOfMinSample() + nl;\n        tG = tG + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n        if (curLevel.type === 'SEGMENT') {\n          tG = tG + t + t + 'intervals: size = ' + curLevel.items.length + nl;\n        } else if (curLevel.type === 'EVENT') {\n          tG = tG + t + t + 'points: size = ' + curLevel.items.length + nl;\n        }\n        var curVal;\n        for (var j = 0; j < curLevel.items.length; j++) {\n          var evtNr = j + 1;\n          if (curLevel.type === 'SEGMENT') {\n            tG = tG + t + t + t + 'intervals [' + evtNr + ']:' + nl;\n            if (curLevel.items[j].sampleStart !== 0) {\n              curVal = curLevel.items[j].sampleStart / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmin = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmin = ' + 0 + nl;\n            }\n            if (j < curLevel.items.length - 1) {\n              curVal = (curLevel.items[j].sampleStart + curLevel.items[j].sampleDur) / sampleRate + 1 / sampleRate / 2;\n              tG = tG + t + t + t + t + 'xmax = ' + curVal + nl;\n            } else {\n              tG = tG + t + t + t + t + 'xmax = ' + global.findTimeOfMaxSample(buffLength, sampleRate) + nl;\n            }\n            tG = tG + t + t + t + t + 'text = \"' + curLevel.items[j].labels[0].value + '\"' + nl;\n          } else if (curLevel.type === 'EVENT') {\n            tG = tG + t + t + t + 'points[' + evtNr + ']:' + nl;\n            tG = tG + t + t + t + t + 'time = ' + curLevel.items[j].sampleStart / sampleRate + nl;\n            tG = tG + t + t + t + t + 'mark = \"' + curLevel.items[j].label + '\"' + nl;\n          }\n        }\n      }\n      return tG;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var retVal;\n        switch (e.data.cmd) {\n        case 'parseTG':\n          retVal = global.toJSO(e.data.textGrid, e.data.annotates, e.data.name, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        case 'toTextGrid':\n          retVal = global.toTextGrid(e.data.levels, e.data.buffLength, e.data.sampleRate);\n          if (retVal.status === undefined) {\n            global.postMessage({\n              'status': {\n                'type': 'SUCCESS',\n                'message': ''\n              },\n              'data': retVal\n            });\n          } else {\n            global.postMessage(retVal);\n          }\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to textGridParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to textGridParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      URL.revokeObjectURL(this.url);\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n//'use strict';\n/**\n * A simple class that creates another thread\n * which does the spectroDrawingWorker work\n * @class spectroDrawingWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction spectroDrawingWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nspectroDrawingWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    /**\n\t\t * A handy web worker to draw a spectrom (and calculate a fft)\n\t\t *\n\t\t * @version 1.2\n\t\t * @author Georg Raess <georg.raess@campus.lmu.de>\n\t\t * @link http://www.phonetik.uni-muenchen.de/\n\t\t *\n\t\t */\n    ///////////////////////////////////\n    // start: global vars\n    global.executed = false;\n    global.PI = 3.141592653589793;\n    // value : Math.PI\n    global.TWO_PI = 6.283185307179586;\n    // value : 2 * Math.PI\n    global.totalMax = 0;\n    global.dynRangeInDB = 50;\n    global.myWindow = {\n      BARTLETT: 1,\n      BARTLETTHANN: 2,\n      BLACKMAN: 3,\n      COSINE: 4,\n      GAUSS: 5,\n      HAMMING: 6,\n      HANN: 7,\n      LANCZOS: 8,\n      RECTANGULAR: 9,\n      TRIANGULAR: 10\n    };\n    global.imgWidth = 0;\n    global.imgHeight = 0;\n    global.upperFreq = 0;\n    global.lowerFreq = 0;\n    global.pixelRatio = 1;\n    global.heatMapColorAnchors = [\n      [\n        255,\n        0,\n        0\n      ],\n      [\n        0,\n        255,\n        0\n      ],\n      [\n        0,\n        0,\n        0\n      ]\n    ];\n    global.samplesPerPxl = 0;\n    global.sampleRate = 0;\n    global.preEmphasisFilterFactor = 0.97;\n    global.transparency = 0;\n    global.drawHeatMapColors = false;\n    global.N = 0;\n    global.windowSizeInSecs = 0.01;\n    global.audioBuffer = undefined;\n    global.audioBufferChannels = 0;\n    global.wFunction = 0;\n    global.myFFT = undefined;\n    global.pixelHeight = 1;\n    global.internalalpha = 1;\n    global.maxPsd = 0;\n    global.HzStep = 0;\n    global.paint = [];\n    global.sin = undefined;\n    global.cos = undefined;\n    global.ceilingFreqFftIdx = 0;\n    global.floorFreqFftIdx = 0;\n    global.resultImgArr = undefined;\n    // end: global vars\n    //////////////////////////////////\n    /////////////////////////////////\n    // start: math helper functions\n    // used by FFT\n    global.toLinearLevel = function (dbLevel) {\n      return Math.pow(10, dbLevel / 10);\n    };\n    // calculate decadic logarithm\n    global.log10 = function (arg) {\n      return Math.log(arg) / 2.302585092994046;  // Math.log(x) / Math.LN10\n    };\n    // calculate magintude\n    global.magnitude = function (real, imag) {\n      return Math.sqrt(real * real + imag * imag);\n    };\n    // end: math helper functions\n    ////////////////////////////////\n    ///////////////////////////////////////////////////\n    // start: FFT class (incl. fft() function itself)\n    global.FFT = function () {\n      var m, i, x;\n      var n = global.N;\n      m = parseInt(Math.log(n) / 0.6931471805599453, 10);\n      if (n !== 1 << m) {\n        // Make sure n is a power of 2\n        console.log('ERROR : FFT length must be power of 2');\n      }\n      if (global.cos === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes\n        global.cos = new Float32Array(n / 2);\n        // precompute cos table\n        for (x = 0; x < n / 2; x++) {\n          global.cos[x] = Math.cos(-2 * global.PI * x / n);\n        }\n      }\n      if (global.sin === undefined || n !== global.N) {\n        // this means that the following is only executed \n        // when no COS table exists\n        // or n changes \n        global.sin = new Float32Array(n / 2);\n        // precompute sin table\n        for (x = 0; x < n / 2; x++) {\n          global.sin[x] = Math.sin(-2 * global.PI * x / n);\n        }\n      }\n      /**\n\t\t\t * apply window function and pre-emphasis from idx 0 to length\n\t\t\t * in buffer given\n\t\t\t *\n\t\t\t * @param type is the chosen window Function as enum\n\t\t\t * @param alpha is the alpha value for Window Functions (default 0.16)\n\t\t\t * @param buffer is the zero padded magnitude spectrum\n\t\t\t * @param length is the length to in the buffer (starting at idx 0)\n\t\t\t * to which to apply the window to. If the buffer is [x0, x1, x2, x4] and\n\t\t\t * length is 2 the window will be applied to [x0, x1, x2] this is needed\n\t\t\t * to only apply function to non-zero-padded values of magnitude spectrum.\n\t\t\t * @return the windowed/pre-emphasised buffer\n\t\t\t */\n      this.applyWindowFuncAndPreemph = function (type, alpha, buffer, length) {\n        // var length = buffer.length;\n        this.alpha = alpha;\n        switch (type) {\n        case global.myWindow.BARTLETT:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlett(length, i);\n          }\n          break;\n        case global.myWindow.BARTLETTHANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBartlettHann(length, i);\n          }\n          break;\n        case global.myWindow.BLACKMAN:\n          this.alpha = this.alpha || 0.16;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionBlackman(length, i, alpha);\n          }\n          break;\n        case global.myWindow.COSINE:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionCosine(length, i);\n          }\n          break;\n        case global.myWindow.GAUSS:\n          this.alpha = this.alpha || 0.25;\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionGauss(length, i, alpha);\n          }\n          break;\n        case global.myWindow.HAMMING:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHamming(length, i);\n          }\n          break;\n        case global.myWindow.HANN:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionHann(length, i);\n          }\n          break;\n        case global.myWindow.LANCZOS:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionLanczos(length, i);\n          }\n          break;\n        case global.myWindow.RECTANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionRectangular(length, i);\n          }\n          break;\n        case global.myWindow.TRIANGULAR:\n          for (i = 0; i < length; i++) {\n            if (i > 0) {\n              buffer[i] = this.applyPreEmph(buffer[i], buffer[i - 1]);\n            }\n            buffer[i] *= this.wFunctionTriangular(length, i);\n          }\n          break;\n        }\n        return buffer;\n      };\n      ////////////////////////////////////\n      // start: the windowing functions\n      this.wFunctionBartlett = function (length, index) {\n        return 2 / (length - 1) * ((length - 1) / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      this.wFunctionBartlettHann = function (length, index) {\n        return 0.62 - 0.48 * Math.abs(index / (length - 1) - 0.5) - 0.38 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionBlackman = function (length, index, alpha) {\n        var a0 = (1 - alpha) / 2;\n        var a1 = 0.5;\n        var a2 = alpha / 2;\n        return a0 - a1 * Math.cos(global.TWO_PI * index / (length - 1)) + a2 * Math.cos(4 * global.PI * index / (length - 1));\n      };\n      this.wFunctionCosine = function (length, index) {\n        return Math.cos(global.PI * index / (length - 1) - global.PI / 2);\n      };\n      this.wFunctionGauss = function (length, index, alpha) {\n        return Math.pow(Math.E, -0.5 * Math.pow((index - (length - 1) / 2) / (alpha * (length - 1) / 2), 2));\n      };\n      this.wFunctionHamming = function (length, index) {\n        return 0.54 - 0.46 * Math.cos(global.TWO_PI * index / (length - 1));\n      };\n      this.wFunctionHann = function (length, index) {\n        return 0.5 * (1 - Math.cos(global.TWO_PI * index / (length - 1)));\n      };\n      this.wFunctionLanczos = function (length, index) {\n        var x = 2 * index / (length - 1) - 1;\n        return Math.sin(global.PI * x) / (global.PI * x);\n      };\n      this.wFunctionRectangular = function () {\n        return 1;\n      };\n      this.wFunctionTriangular = function (length, index) {\n        return 2 / length * (length / 2 - Math.abs(index - (length - 1) / 2));\n      };\n      // end: the windowing functions\n      ///////////////////////////////////\n      /**\n\t\t\t * calculate and apply according pre-emphasis on sample\n\t\t\t */\n      this.applyPreEmph = function (curSample, prevSample) {\n        return curSample - global.preEmphasisFilterFactor * prevSample;\n      };\n      // the FFT calculation\n      this.fft = function (x, y) {\n        // Bit-reverse\n        var i, j, k, n1, n2, a, c, s, t1, t2;\n        // Bit-reverse\n        j = 0;\n        n2 = n / 2;\n        for (i = 1; i < n - 1; i++) {\n          n1 = n2;\n          while (j >= n1) {\n            j = j - n1;\n            n1 = n1 / 2;\n          }\n          j = j + n1;\n          if (i < j) {\n            t1 = x[i];\n            x[i] = x[j];\n            x[j] = t1;\n            t1 = y[i];\n            y[i] = y[j];\n            y[j] = t1;\n          }\n        }\n        // FFT\n        n1 = 0;\n        n2 = 1;\n        for (i = 0; i < m; i++) {\n          n1 = n2;\n          n2 = n2 + n2;\n          a = 0;\n          for (j = 0; j < n1; j++) {\n            c = global.cos[a];\n            s = global.sin[a];\n            a += 1 << m - i - 1;\n            for (k = j; k < n; k = k + n2) {\n              t1 = c * x[k + n1] - s * y[k + n1];\n              t2 = s * x[k + n1] + c * y[k + n1];\n              x[k + n1] = x[k] - t1;\n              y[k + n1] = y[k] - t2;\n              x[k] = x[k] + t1;\n              y[k] = y[k] + t2;\n            }\n          }\n        }\n      };\n    };\n    // end: FFT class \n    ///////////////////\n    /////////////////////////////////\n    // start: rendering function \n    /**\n\t\t * interpolates a 3D color space and calculate accoring\n\t\t * value on that plane\n\t\t *\n\t\t * @param minval is the minimum value to map to (number)\n\t\t * @param maxval is the maximum value to map to (number)\n\t\t * @param val is the value itself (number)\n\t\t * @param colors is an array of arrays containing the colors\n\t\t * to interpol. against (of the form: [[255, 0, 0],[0, 255, 0],[0, 0, 255]])\n\t\t */\n    global.convertToHeatmap = function (minval, maxval, val, colors) {\n      var maxIndex = colors.length - 1;\n      var v = (val - minval) / (maxval - minval) * maxIndex;\n      var i1 = Math.floor(v);\n      var i2 = Math.min.apply(null, [\n          Math.floor(v) + 1,\n          maxIndex\n        ]);\n      var rgb1 = colors[i1];\n      var rgb2 = colors[i2];\n      var f = v - i1;\n      return {\n        'r': Math.floor(rgb1[0] + f * (rgb2[0] - rgb1[0])),\n        'g': Math.floor(rgb1[1] + f * (rgb2[1] - rgb1[1])),\n        'b': Math.floor(rgb1[2] + f * (rgb2[2] - rgb1[2]))\n      };\n    };\n    /**\n\t\t * draws a single line of the spectrogram into the imageResult array.\n\t\t * by calculating the RGB value of the current pixel with:\n\t\t * 255-(255*scaled)\n\t\t * @param xIdx in the global.paint array\n\t\t */\n    global.drawVerticalLineOfSpectogram = function (xIdx) {\n      // set upper boundary for linear interpolation\n      var x1 = global.pixelHeight;\n      var rgb, index, px, py;\n      // value for first interpolation at lower boundry (height=0)\n      // calculate the one sided power spectral density PSD (f, t) in Pa2/Hz\n      // PSD(f) proportional to 2|X(f)|2 / (t2 - t1)\n      var psd = 2 * Math.pow(global.paint[xIdx][1], 2) / global.N;\n      var psdLog = 10 * global.log10(psd / global.maxPsd);\n      var scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n      if (scaledVal > 1) {\n        scaledVal = 1;\n      } else if (scaledVal < 0) {\n        scaledVal = 0;\n      }\n      for (var i = 0; i < global.paint[xIdx].length; i++) {\n        var y0 = scaledVal;\n        // !!!! set y0 to previous scaled value\n        // for each value in paint[] calculate pixelHeight interpolation points\n        // x0=0\n        // x1=pixelHeight\n        // if(paint[i-1]<0) paint[i-1] = 1\n        // y0=paint[i-1]    \n        // y1=paint[i]\n        // !!!! calculate next scaledValue [0...1] \n        psd = 2 * Math.pow(global.paint[xIdx][i], 2) / global.N;\n        psdLog = 10 * global.log10(psd / global.maxPsd);\n        scaledVal = (psdLog + global.dynRangeInDB) / global.dynRangeInDB;\n        if (scaledVal > 1) {\n          scaledVal = 1;\n        }\n        if (scaledVal < 0) {\n          scaledVal = 0;\n        }\n        // !!!! set y1 to this scaled value\n        var y1 = scaledVal;\n        if (global.pixelHeight >= 1) {\n          // do interpolation between y0 (previous scaledValue) and y1 (scaledValue now)\n          for (var b = 0; b < global.pixelHeight; b++) {\n            var y2 = y0 + (y1 - y0) / x1 * b;\n            // calculate corresponding color value for interpolation point [0...255]\n            rgb = 255 - Math.round(255 * y2);\n            // set internal image buffer to calculated & interpolated value\n            px = Math.floor(xIdx);\n            py = Math.floor(global.imgHeight - (global.pixelHeight * (i - 2) + b));\n            index = (px + py * global.imgWidth) * 4;\n            if (global.drawHeatMapColors) {\n              if (!isNaN(rgb)) {\n                var hmVals = global.convertToHeatmap(0, 255, rgb, global.heatMapColorAnchors);\n                global.resultImgArr[index + 0] = hmVals.r;\n                global.resultImgArr[index + 1] = hmVals.g;\n                global.resultImgArr[index + 2] = hmVals.b;\n                global.resultImgArr[index + 3] = global.transparency;\n              } else {\n                global.resultImgArr[index + 0] = rgb;\n                global.resultImgArr[index + 1] = rgb;\n                global.resultImgArr[index + 2] = rgb;\n                global.resultImgArr[index + 3] = global.transparency;\n              }\n            } else {\n              global.resultImgArr[index + 0] = rgb;\n              global.resultImgArr[index + 1] = rgb;\n              global.resultImgArr[index + 2] = rgb;\n              global.resultImgArr[index + 3] = global.transparency;\n            }\n          }\n        } else {\n          rgb = 255 - Math.round(255 * y1);\n          // set internal image buffer to calculated & interpolated value\n          px = Math.floor(xIdx);\n          py = Math.floor(global.imgHeight - global.pixelHeight * (i - 2));\n          index = (px + py * global.imgWidth) * 4;\n          global.resultImgArr[index + 0] = rgb;\n          global.resultImgArr[index + 1] = rgb;\n          global.resultImgArr[index + 2] = rgb;\n          global.resultImgArr[index + 3] = global.transparency;\n        }\n      }\n    };\n    /**\n\t\t * calculates Magnitude by\n\t\t * - reading the current (defined with offset) data from localSoundBuffer\n\t\t * - applying the current Window Function to the selected data\n\t\t * - calculating the actual FFT\n\t\t * - (and saving the biggest value in totalMax)\n\t\t *\n\t\t * @param offset calculated offset in PCM Stream\n\t\t * @return magnitude spectrum as Float32Array\n\t\t */\n    global.calcMagnitudeSpectrum = function (offset, windowSizeInSamples) {\n      // imaginary array of length N\n      var imag = new Float32Array(global.N);\n      // real array of length N\n      var real = new Float32Array(global.N);\n      // result array of length c - d\n      var result = new Float32Array(global.ceilingFreqFftIdx - global.floorFreqFftIdx);\n      // set real values by reading local sound buffer (this auto zeropads everything > windowSizeInSamples)\n      for (var j = 0; j < windowSizeInSamples; j++) {\n        real[j] = global.audioBuffer[offset + j];\n      }\n      // apply window function and pre-emphasis to non zero padded real \n      global.myFFT.applyWindowFuncAndPreemph(global.wFunction, global.internalalpha, real, windowSizeInSamples);\n      // calculate FFT over real and save to result\n      global.myFFT.fft(real, imag);\n      // calculate magnitude for each spectral component \n      for (var low = 0; low <= global.ceilingFreqFftIdx - global.floorFreqFftIdx; low++) {\n        result[low] = global.magnitude(real[low + global.floorFreqFftIdx], imag[low + global.floorFreqFftIdx]);\n        if (global.totalMax < result[low]) {\n          global.totalMax = result[low];\n        }\n      }\n      return result;\n    };\n    /**\n\t\t * initial function call for calculating and drawing Spectrogram\n\t\t * input sample data comes from the buffer global.audioBuffer\n\t\t * - first loop calculates magnitude spectra to draw (calcMagnitudeSpectrum())\n\t\t * - second loop draws these values into the global.resultImgArr (drawVerticalLineOfSpectogram())\n\t\t */\n    global.renderSpectrogram = function () {\n      if (!global.executed) {\n        // start execution once\n        global.executed = true;\n        var windowSizeInSamples = global.sampleRate * global.windowSizeInSecs;\n        // instance of FFT with windowSize N\n        global.myFFT = new global.FFT();\n        // array holding FFT results paint[canvas width][canvas height]\n        global.paint = new Array(global.imgWidth);\n        // Hz per pixel height\n        global.HzStep = global.sampleRate / 2 / (global.N / 2);\n        // upper Hz boundary to display\n        global.ceilingFreqFftIdx = Math.ceil(global.upperFreq / global.HzStep);\n        // lower Hz boundary to display\n        global.floorFreqFftIdx = Math.floor(global.lowerFreq / global.HzStep);\n        // -1 for value below display when lower>0\n        // height between two interpolation points\n        global.pixelHeight = global.imgHeight / (global.ceilingFreqFftIdx - global.floorFreqFftIdx - 2);\n        // ugly hack in order to support PhantomJS < 2.0 testing\n        if (typeof Uint8ClampedArray === 'undefined') {\n          Uint8ClampedArray = Uint8Array;\n        }\n        // create new picture\n        global.resultImgArr = new Uint8ClampedArray(Math.ceil(global.imgWidth * global.imgHeight * 4));\n        // calculate i FFT runs, save result into paint and set maxPsd while doing so\n        for (var i = 0; i < global.imgWidth; i++) {\n          global.paint[i] = global.calcMagnitudeSpectrum(Math.round(i * global.samplesPerPxl), windowSizeInSamples);\n          global.maxPsd = 2 * Math.pow(global.totalMax, 2) / global.N;\n        }\n        // draw spectrogram on png image with canvas width\n        // one column is drawn per drawVerticalLineOfSpectogram\n        for (var j = 0; j < global.imgWidth; j++) {\n          global.drawVerticalLineOfSpectogram(j);\n        }\n        // post generated image block with settings back\n        global.postMessage({\n          'window': global.wFunction,\n          'samplesPerPxl': global.samplesPerPxl,\n          'pixelHeight': global.pixelHeight,\n          'pixelRatio': global.pixelRatio,\n          'width': global.imgWidth,\n          'height': global.imgHeight,\n          'img': global.resultImgArr.buffer\n        }, [global.resultImgArr.buffer]);\n        // free vars\n        global.myFFT = null;\n        // stop execution\n        global.executed = false;\n      }\n    };\n    // end: rendering function \n    //////////////////////////////\n    //////////////////////////\n    // communication functions\n    /**\n\t\t * function to handle messages events if used ad web worker\n\t\t * @param e message event\n\t\t */\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        var render = true;\n        var renderError = '';\n        var data = e.data;\n        if (data.windowSizeInSecs !== undefined) {\n          global.windowSizeInSecs = data.windowSizeInSecs;\n        } else {\n          renderError = 'windowSizeInSecs';\n          render = false;\n        }\n        if (data.fftN !== undefined) {\n          global.N = data.fftN;\n        } else {\n          renderError = 'fftN';\n          render = false;\n        }\n        if (data.alpha !== undefined) {\n          global.internalalpha = data.alpha;\n        } else {\n          renderError = 'alpha';\n          render = false;\n        }\n        if (data.upperFreq !== undefined) {\n          global.upperFreq = data.upperFreq;\n        } else {\n          renderError = 'upperFreq';\n          render = false;\n        }\n        if (data.lowerFreq !== undefined) {\n          global.lowerFreq = data.lowerFreq;\n        } else {\n          renderError = 'lowerFreq';\n          render = false;\n        }\n        if (data.samplesPerPxl !== undefined) {\n          global.samplesPerPxl = data.samplesPerPxl;\n        } else {\n          renderError = 'samplesPerPxl';\n          render = false;\n        }\n        if (data.window !== undefined) {\n          switch (data.window) {\n          case 1:\n            global.wFunction = global.myWindow.BARTLETT;\n            break;\n          case 2:\n            global.wFunction = global.myWindow.BARTLETTHANN;\n            break;\n          case 3:\n            global.wFunction = global.myWindow.BLACKMAN;\n            break;\n          case 4:\n            global.wFunction = global.myWindow.COSINE;\n            break;\n          case 5:\n            global.wFunction = global.myWindow.GAUSS;\n            break;\n          case 6:\n            global.wFunction = global.myWindow.HAMMING;\n            break;\n          case 7:\n            global.wFunction = global.myWindow.HANN;\n            break;\n          case 8:\n            global.wFunction = global.myWindow.LANCZOS;\n            break;\n          case 9:\n            global.wFunction = global.myWindow.RECTANGULAR;\n            break;\n          case 10:\n            global.wFunction = global.myWindow.TRIANGULAR;\n            break;\n          }\n        } else {\n          renderError = 'window';\n          render = false;\n        }\n        if (data.imgWidth !== undefined) {\n          global.imgWidth = data.imgWidth;\n        } else {\n          renderError = 'imgWidth';\n          render = false;\n        }\n        if (data.imgHeight !== undefined) {\n          global.imgHeight = data.imgHeight;\n        } else {\n          renderError = 'imgHeight';\n          render = false;\n        }\n        if (data.dynRangeInDB !== undefined) {\n          global.dynRangeInDB = data.dynRangeInDB;\n        } else {\n          renderError = 'dynRangeInDB';\n          render = false;\n        }\n        if (data.pixelRatio !== undefined) {\n          global.pixelRatio = data.pixelRatio;\n        } else {\n          renderError = 'pixelRatio';\n          render = false;\n        }\n        if (data.sampleRate !== undefined) {\n          global.sampleRate = data.sampleRate;\n        } else {\n          renderError = 'sampleRate';\n          render = false;\n        }\n        if (data.audioBufferChannels !== undefined) {\n          global.audioBufferChannels = data.audioBufferChannels;\n        } else {\n          renderError = 'audioBufferChannels';\n          render = false;\n        }\n        if (data.transparency !== undefined) {\n          global.transparency = data.transparency;\n        } else {\n          renderError = 'transparency';\n          render = false;\n        }\n        if (data.audioBuffer !== undefined) {\n          global.audioBuffer = new Float32Array(data.audioBuffer);\n        } else {\n          renderError = 'audioBuffer';\n          render = false;\n        }\n        if (data.drawHeatMapColors !== undefined) {\n          global.drawHeatMapColors = data.drawHeatMapColors;\n        } else {\n          renderError = 'drawHeatMapColors';\n          render = false;\n        }\n        if (data.preEmphasisFilterFactor !== undefined) {\n          global.preEmphasisFilterFactor = data.preEmphasisFilterFactor;\n        } else {\n          renderError = 'preEmphasisFilterFactor';\n          render = false;\n        }\n        if (data.heatMapColorAnchors !== undefined) {\n          global.heatMapColorAnchors = data.heatMapColorAnchors;\n        } else {\n          renderError = 'heatMapColorAnchors';\n          render = false;\n        }\n        if (render) {\n          global.renderSpectrogram();\n        } else {\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': renderError + ' is undefined'\n            }\n          });\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to spectroDrawingWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(spectroDrawingWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }  //\n     /////////////////////\n};\n/**\n * A simple class that creates another thread\n * which does the ssffParserWorker work\n * @class ssffParserWorker\n * @constructor\n * @param Worker {Worker} injection point for Worker\n */\nfunction ssffParserWorker(Worker) {\n  Worker = Worker || window.Worker;\n  this.url = this.getWorkerURL();\n  this.worker = new Worker(this.url);\n}\nssffParserWorker.prototype = {\n  getWorkerScript: function () {\n    var js = '';\n    js += '(' + this.workerInit + ')(this);';\n    return js;\n  },\n  workerInit: function (global) {\n    var ssffData = {};\n    var headID = 'SSFF -- (c) SHLRC\\n';\n    var machineID = 'Machine IBM-PC\\n';\n    var sepString = '-----------------\\n';\n    ssffData.fileExtension = '';\n    ssffData.sampleRate = -1;\n    ssffData.startTime = -1;\n    ssffData.origFreq = -1;\n    ssffData.Columns = [];\n    /**\n\t * Mock for atob btoa for web kit based browsers that don't support these in webworkers\n\t */\n    (function () {\n      var base64EncodeChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n      var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);\n      function base64encode(str) {\n        var out, i, len;\n        var c1, c2, c3;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          c1 = str.charCodeAt(i++) & 255;\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4);\n            out += '==';\n            break;\n          }\n          c2 = str.charCodeAt(i++);\n          if (i === len) {\n            out += base64EncodeChars.charAt(c1 >> 2);\n            out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n            out += base64EncodeChars.charAt((c2 & 15) << 2);\n            out += '=';\n            break;\n          }\n          c3 = str.charCodeAt(i++);\n          out += base64EncodeChars.charAt(c1 >> 2);\n          out += base64EncodeChars.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);\n          out += base64EncodeChars.charAt((c2 & 15) << 2 | (c3 & 192) >> 6);\n          out += base64EncodeChars.charAt(c3 & 63);\n        }\n        return out;\n      }\n      function base64decode(str) {\n        var c1, c2, c3, c4;\n        var i, len, out;\n        len = str.length;\n        i = 0;\n        out = '';\n        while (i < len) {\n          do {\n            c1 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c1 === -1);\n          if (c1 === -1) {\n            break;\n          }\n          do {\n            c2 = base64DecodeChars[str.charCodeAt(i++) & 255];\n          } while (i < len && c2 === -1);\n          if (c2 === -1) {\n            break;\n          }\n          out += String.fromCharCode(c1 << 2 | (c2 & 48) >> 4);\n          do {\n            c3 = str.charCodeAt(i++) & 255;\n            if (c3 === 61) {\n              return out;\n            }\n            c3 = base64DecodeChars[c3];\n          } while (i < len && c3 === -1);\n          if (c3 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c2 & 15) << 4 | (c3 & 60) >> 2);\n          do {\n            c4 = str.charCodeAt(i++) & 255;\n            if (c4 === 61) {\n              return out;\n            }\n            c4 = base64DecodeChars[c4];\n          } while (i < len && c4 === -1);\n          if (c4 === -1) {\n            break;\n          }\n          out += String.fromCharCode((c3 & 3) << 6 | c4);\n        }\n        return out;\n      }\n      //var scope = (typeof window !== 'undefined') ? window : global;\n      if (!global.btoa) {\n        global.btoa = base64encode;\n      }\n      if (!global.atob) {\n        global.atob = base64decode;\n      }\n    }());\n    /**\n\t *\n\t */\n    global.base64ToArrayBuffer = function (stringBase64) {\n      var binaryString = global.atob(stringBase64);\n      var len = binaryString.length;\n      var bytes = new Uint8Array(len);\n      for (var i = 0; i < len; i++) {\n        var ascii = binaryString.charCodeAt(i);\n        bytes[i] = ascii;\n      }\n      return bytes.buffer;\n    };\n    /**\n\t * round to n decimal digits after the comma\n\t * used to help display numbers with a given\n\t * precision\n\t */\n    global.round = function (x, n) {\n      if (n < 1 || n > 14) {\n        return false;\n      }\n      var e = Math.pow(10, n);\n      var k = (Math.round(x * e) / e).toString();\n      if (k.indexOf('.') === -1) {\n        k += '.';\n      }\n      k += e.toString().substring(1);\n      return k.substring(0, k.indexOf('.') + n + 1);\n    };\n    /**\n\t * helper function to convert string to Uint8Array\n\t * @param string\n\t */\n    global.stringToUint = function (string) {\n      var charList = string.split('');\n      var uintArray = [];\n      for (var i = 0; i < charList.length; i++) {\n        uintArray.push(charList[i].charCodeAt(0));\n      }\n      return new Uint8Array(uintArray);\n    };\n    /**\n\t *\n\t */\n    global.Uint8Concat = function (first, second) {\n      var firstLength = first.length;\n      var result = new Uint8Array(firstLength + second.length);\n      result.set(first);\n      result.set(second, firstLength);\n      return result;\n    };\n    /**\n\t * convert arraybuffer containing a ssff file\n\t * to a javascript object\n\t * @param buf arraybuffer containing ssff file\n\t * @param name is fileExtension\n\t * @returns ssff javascript object\n\t */\n    global.ssff2jso = function (buf, name) {\n      ssffData.fileExtension = name;\n      ssffData.Columns = [];\n      // console.log('SSFF loaded');\n      var uIntBuffView = new Uint8Array(buf);\n      // Causes \"RangeError: Maximum call stack size exceeded\"\n      // with some browsers (?)(Chrome/Chromium on Ubuntu)\n      //var buffStr = String.fromCharCode.apply(null, uIntBuffView);\n      var buffStr = '';\n      for (var j = 0; j < uIntBuffView.length; j++) {\n        buffStr = buffStr + String.fromCharCode(uIntBuffView[j]);\n      }\n      var newLsep = buffStr.split(/^/m);\n      //check if header has headID and machineID\n      if (newLsep[0] !== headID) {\n        // alert('SSFF parse error: first line != SSFF -- (c) SHLRC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: first line != SSFF -- (c) SHLRC in file with fileExtension ' + name\n          }\n        };\n      }\n      if (newLsep[1] !== machineID) {\n        // alert('SSFF parse error: machineID != Machine IBM-PC');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: machineID != Machine IBM-PC in file with fileExtension ' + name\n          }\n        };\n      }\n      // search header for Record_Freq and Start_Time\n      ssffData.sampleRate = undefined;\n      ssffData.startTime = undefined;\n      var counter = 0;\n      while (newLsep[counter] !== sepString) {\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Record_Freq') {\n          // console.log(\"FOUND Record_Freq\")\n          ssffData.sampleRate = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[counter].split(/[ ,]+/)[0] === 'Start_Time') {\n          // console.log(\"FOUND Start_Time\")\n          ssffData.startTime = parseFloat(newLsep[counter].split(/[ ,]+/)[1].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        counter += 1;\n      }\n      // check if found Record_Freq and Start_Time\n      if (ssffData.sampleRate === undefined || ssffData.startTime === undefined) {\n        // alert('SSFF parse error: Required fields Record_Freq or Start_Time not set!');\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'SSFF parse error: Required fields Record_Freq or Start_Time not set in file with fileExtension ' + name\n          }\n        };\n      }\n      for (var i = 4; i < newLsep.length; i++) {\n        if (newLsep[i].split(/[ ,]+/)[0] === 'Original_Freq') {\n          ssffData.origFreq = parseFloat(newLsep[i].split(/[ ,]+/)[2].replace(/(\\r\\n|\\n|\\r)/gm, ''));\n        }\n        if (newLsep[i] === sepString) {\n          break;\n        }\n        var lSpl = newLsep[i].split(/[ ]+/);\n        if (lSpl[0] === 'Column') {\n          ssffData.Columns.push({\n            'name': lSpl[1],\n            'ssffdatatype': lSpl[2],\n            'length': parseInt(lSpl[3].replace(/(\\r\\n|\\n|\\r)/gm, ''), 10),\n            'values': [],\n            '_minVal': Infinity,\n            '_maxVal': -Infinity\n          });\n        }\n      }\n      var curBinIdx = newLsep.slice(0, i + 1).join('').length;\n      var curBufferView, curBuffer, curLen, curMin, curMax;\n      while (curBinIdx <= uIntBuffView.length) {\n        for (i = 0; i < ssffData.Columns.length; i++) {\n          //console.log(ssffData.Columns[i].length);\n          if (ssffData.Columns[i].ssffdatatype === 'DOUBLE') {\n            curLen = 8 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            // ugly hack in order to support PhantomJS < 2.0 testing\n            if (typeof Float64Array == 'undefined') {\n              Float64Array = Float32Array;\n            }\n            curBufferView = new Float64Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'FLOAT') {\n            curLen = 4 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Float32Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'SHORT') {\n            curLen = 2 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint16Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n            // set _minVal and _maxVal\n            curMin = Math.min.apply(null, Array.prototype.slice.call(curBufferView));\n            curMax = Math.max.apply(null, Array.prototype.slice.call(curBufferView));\n            if (curMin < ssffData.Columns[i]._minVal) {\n              ssffData.Columns[i]._minVal = curMin;\n            }\n            if (curMax > ssffData.Columns[i]._maxVal) {\n              ssffData.Columns[i]._maxVal = curMax;\n            }\n          } else if (ssffData.Columns[i].ssffdatatype === 'BYTE') {\n            curLen = 1 * ssffData.Columns[i].length;\n            curBuffer = buf.subarray(curBinIdx, curLen);\n            curBufferView = new Uint8Array(curBuffer);\n            ssffData.Columns[i].values.push(Array.prototype.slice.call(curBufferView));\n            curBinIdx += curLen;\n          } else {\n            // alert('Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported');\n            return {\n              'status': {\n                'type': 'ERROR',\n                'message': 'Unsupported column type! Only DOUBLE, FLOAT, SHORT, BYTE column types are currently supported in file with fileExtension ' + name\n              }\n            };\n          }\n        }  //for\n      }\n      //while\n      return ssffData;\n    };\n    /**\n\t * convert javascript object of label file to\n\t * array buffer containing\n\t * @param ssff javascipt object\n\t * @returns ssff arraybuffer\n\t */\n    global.jso2ssff = function (jso) {\n      // create header\n      var headerStr = headID + machineID;\n      headerStr += 'Record_Freq ' + global.round(jso.sampleRate, 1) + '\\n';\n      headerStr += 'Start_Time ' + jso.startTime + '\\n';\n      jso.Columns.forEach(function (col) {\n        // console.log(col.name)\n        headerStr += 'Column ' + col.name + ' ' + col.ssffdatatype + ' ' + col.length + '\\n';\n      });\n      headerStr += 'Original_Freq DOUBLE ' + global.round(jso.origFreq, 1) + '\\n';\n      headerStr += sepString;\n      // preallocate data buffer\n      var bytePerTime = 0;\n      var failed = false;\n      jso.Columns.forEach(function (col) {\n        if (col.ssffdatatype === 'SHORT') {\n          bytePerTime += 2 * col.length;\n        } else {\n          failed = true;\n        }\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      var byteSizeOfDataBuffer = bytePerTime * jso.Columns[0].values.length;\n      var dataBuff = new ArrayBuffer(byteSizeOfDataBuffer);\n      var dataBuffView = new DataView(dataBuff);\n      // convert buffer to header\n      var ssffBufView = new Uint8Array(global.stringToUint(headerStr));\n      // loop through vals and append array of each column to ssffBufView\n      var byteOffSet = 0;\n      jso.Columns[0].values.forEach(function (curArray, curArrayIDX) {\n        jso.Columns.forEach(function (curCol) {\n          if (curCol.ssffdatatype === 'SHORT') {\n            curCol.values[curArrayIDX].forEach(function (val) {\n              dataBuffView.setInt16(byteOffSet, val, true);\n              byteOffSet += 2;\n            });\n          } else {\n            failed = true;\n          }\n        });\n      });\n      // check if failed\n      if (failed) {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Unsupported column type! Only SHORT columns supported for now!'\n          }\n        };\n      }\n      // concatenate header with data\n      var tmp = new Uint8Array(dataBuffView.buffer);\n      ssffBufView = new global.Uint8Concat(ssffBufView, tmp);\n      return {\n        'status': {\n          'type': 'SUCCESS',\n          'message': ''\n        },\n        'data': ssffBufView.buffer\n      };\n    };\n    /**\n\t * loop over ssff files in ssffArr and create a ssffJsoArr\n\t */\n    global.parseArr = function (ssffArr) {\n      var noError = true;\n      var resArr = [];\n      var ssffJso;\n      for (var i = 0; i < ssffArr.length; i++) {\n        ssffJso = {};\n        var arrBuff;\n        arrBuff = global.base64ToArrayBuffer(ssffArr[i].data);\n        ssffJso = global.ssff2jso(arrBuff, ssffArr[i].fileExtension);\n        if (ssffJso.status === undefined) {\n          resArr.push(JSON.parse(JSON.stringify(ssffJso)));  // YUCK... don't know if SIC but YUCK!!!\n        } else {\n          noError = false;\n          return ssffJso;\n        }\n      }\n      if (noError) {\n        return {\n          'status': {\n            'type': 'SUCCESS',\n            'message': ''\n          },\n          'data': resArr\n        };\n      } else {\n        return {\n          'status': {\n            'type': 'ERROR',\n            'message': 'Error in parseArr() with: ' + JSON.stringify(ssffArr)\n          }\n        };\n      }\n    };\n    //expand ArrayBuffer with subarray function\n    ArrayBuffer.prototype.subarray = function (offset, length) {\n      var sub = new ArrayBuffer(length);\n      var subView = new Int8Array(sub);\n      var thisView = new Int8Array(this);\n      for (var i = 0; i < length; i++) {\n        subView[i] = thisView[offset + i];\n      }\n      return sub;\n    };\n    global.onmessage = function (e) {\n      if (e.data !== undefined) {\n        switch (e.data.cmd) {\n        case 'parseArr':\n          global.postMessage(global.parseArr(e.data.ssffArr));\n          break;\n        case 'jso2ssff':\n          global.postMessage(global.jso2ssff(JSON.parse(e.data.jso)));\n          break;\n        default:\n          global.postMessage({\n            'status': {\n              'type': 'ERROR',\n              'message': 'Unknown command sent to ssffParserWorker'\n            }\n          });\n          break;\n        }\n      } else {\n        global.postMessage({\n          'status': {\n            'type': 'ERROR',\n            'message': 'Undefined message was sent to ssffParserWorker'\n          }\n        });\n      }\n    };\n  },\n  getWorkerURL: function () {\n    var blob, urlObj;\n    try {\n      blob = new Blob([this.getWorkerScript()], { type: 'application/javascript' });\n    } catch (e) {\n      // Backwards-compatibility\n      window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n      blob = new BlobBuilder();\n      blob.append(textGridParserWorker);\n      blob = blob.getBlob();\n    }\n    if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n      urlObj = webkitURL.createObjectURL(blob);\n    } else {\n      urlObj = URL.createObjectURL(blob);\n    }\n    return urlObj;\n  },\n  kill: function () {\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = undefined;\n    }\n    if (this.url) {\n      if (typeof URL !== 'object' && typeof webkitURL !== 'undefined') {\n        webkitURL.revokeObjectURL(this.url);\n      } else {\n        URL.revokeObjectURL(this.url);\n      }\n      this.url = undefined;\n    }\n  },\n  tell: function (msg) {\n    if (this.worker) {\n      this.worker.postMessage(msg);\n    }\n  },\n  says: function (handler) {\n    if (this.worker) {\n      this.worker.addEventListener('message', function (e) {\n        handler(e.data);\n      });\n    }\n  }\n};\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.mathHelperService\n * @description\n * # mathHelperService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('mathHelperService', function () {\n  //shared service object to be returned\n  var sServObj = {};\n  //////////////////////\n  //////////////////////\n  // public API\n  /**\n\t\t * calculate the closest power of two that is\n\t\t * greater than the passed in number\n\t\t * @param num\n\t\t * @returns power of two value\n\t\t */\n  sServObj.calcClosestPowerOf2Gt = function (num) {\n    var curExp = 0;\n    while (Math.pow(2, curExp) < num) {\n      curExp = curExp + 1;\n    }\n    return Math.pow(2, curExp);\n  };\n  return sServObj;\n});\n'use strict';\nangular.module('emuwebApp').directive('modal', [\n  '$animate',\n  'modalService',\n  function ($animate, modalService) {\n    return {\n      restrict: 'E',\n      templateUrl: 'views/modal.html',\n      replace: true,\n      scope: {},\n      link: function (scope, element, attr) {\n        scope.templateUrl = '';\n        scope.modal = modalService;\n        scope.isOpen = false;\n        scope.force = false;\n        scope.dataIn = '';\n        scope.$watch('modal.isOpen', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.templateUrl = modalService.getTemplateUrl();\n            scope.dataIn = modalService.dataIn;\n            scope.force = modalService.force;\n            if (newValue) {\n              element[0].classList.add('emuwebapp-modalDialog-isOpen');\n            } else {\n              element[0].classList.remove('emuwebapp-modalDialog-isOpen');\n            }\n          }\n        });\n        scope.$watch('modal.templateUrl', function (newValue, oldValue) {\n          if (newValue !== undefined) {\n            scope.templateUrl = newValue;\n            scope.dataIn = modalService.dataIn;\n            scope.force = modalService.force;\n          }\n        });\n      }\n    };\n  }\n]);\n'use strict';\n/**\n * @ngdoc service\n * @name emuwebApp.modalService\n * @description\n * # modalService\n * Service in the emuwebApp.\n */\nangular.module('emuwebApp').service('modalService', [\n  '$q',\n  'ArrayHelperService',\n  'viewState',\n  function modalService($q, ArrayHelperService, viewState) {\n    // shared service object\n    var sServObj = {};\n    sServObj.isOpen = false;\n    sServObj.templateUrl = '';\n    sServObj.defer = undefined;\n    sServObj.deferChange = undefined;\n    sServObj.force = false;\n    sServObj.dataOut = undefined;\n    sServObj.dataIn = undefined;\n    sServObj.dataExport = undefined;\n    /**\n\t\t * open modal normally\n\t\t */\n    sServObj.open = function (template, param1, param2, force) {\n      if (param1 !== undefined) {\n        sServObj.dataIn = param1;\n        if (param1.y !== undefined) {\n          sServObj.dataIn.chartData = ArrayHelperService.convertArrayToXYjsoArray(param1.y);\n        }\n      }\n      if (param2 !== undefined) {\n        sServObj.dataExport = param2;\n      }\n      if (force !== undefined) {\n        // force user to do sth\n        sServObj.force = force;\n      }\n      sServObj.defer = $q.defer();\n      sServObj.templateUrl = template;\n      viewState.setState('modalShowing');\n      sServObj.isOpen = true;\n      return sServObj.defer.promise;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.changeModal = function (template, param1, param2, force) {\n      if (param1 !== undefined) {\n        sServObj.dataIn = param1;\n      }\n      if (param2 !== undefined) {\n        sServObj.dataExport = param2;\n      }\n      if (force !== undefined) {\n        // force user to do sth\n        sServObj.force = force;\n      }\n      sServObj.deferChange = $q.defer();\n      sServObj.templateUrl = template;\n      return sServObj.deferChange.promise;\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.error = function (msg) {\n      sServObj.dataIn = msg;\n      sServObj.templateUrl = 'views/error.html';\n      viewState.setState('modalShowing');\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.close = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      if (viewState.hierarchyShown) {\n        viewState.toggleHierarchy();\n      }\n      sServObj.defer.resolve(false);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.closeAndResolve = function (status) {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(status);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.confirm = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(true);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.select = function (idx) {\n      sServObj.defer.resolve(idx);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.confirmContent = function () {\n      viewState.setEditing(false);\n      viewState.setState(viewState.prevState);\n      sServObj.isOpen = false;\n      sServObj.defer.resolve(sServObj.dataOut);\n    };\n    /**\n\t\t *\n\t\t */\n    sServObj.getTemplateUrl = function () {\n      return sServObj.templateUrl;\n    };\n    return sServObj;\n  }\n]);\n'use strict';\nangular.module('emuwebApp').controller('TabbedCtrl', [\n  '$scope',\n  'Websockethandler',\n  'viewState',\n  'ConfigProviderService',\n  'Validationservice',\n  'uuid',\n  'LevelService',\n  function ($scope, Websockethandler, viewState, ConfigProviderService, Validationservice, uuid, LevelService) {\n    // service shortcuts\n    $scope.cps = ConfigProviderService;\n    $scope.vs = viewState;\n    $scope.valid = Validationservice;\n    $scope.lvl = LevelService;\n    // definition shortcuts\n    $scope.levelDefinitionProperties = {};\n    $scope.linkDefinitionProperties = {};\n    $scope.spectroDefinitionProperties = {};\n    // selection properties for \"add signal canvases order\"\n    $scope.signalSelect = [];\n    // selection properties for \"add level canvases order\"\n    $scope.levelSelect = [];\n    // selection properties for \"add signal canvases order\"\n    $scope.twoDimSelect = [];\n    // default selection for \"add signal canvases order\"\n    $scope.addSignalSelect = '';\n    // default selection for \"add level canvases order\"\n    $scope.addLevelSelect = '';\n    // default selection for \"add two dim canvases order\"\n    $scope.addTwoDimSelect = '';\n    // user feedback after saving data\n    $scope.response = [];\n    // all available tabs\n    $scope.tabs = [\n      {\n        title: 'level definitions',\n        url: 'views/tabbed/levelDefinition.html'\n      },\n      {\n        title: 'link definitions',\n        url: 'views/tabbed/linkDefinition.html'\n      },\n      {\n        title: 'ssff track definitions',\n        url: 'views/tabbed/ssffDefinition.html'\n      },\n      {\n        title: '2D definitions',\n        url: 'views/tabbed/twoDimDefinition.html'\n      },\n      {\n        title: 'EMU-webApp',\n        url: 'views/tabbed/emuDefinition.html'\n      },\n      {\n        title: 'global DB',\n        url: 'views/tabbed/globalDefinition.html'\n      }\n    ];\n    // current open tab\n    $scope.currentTab = 'views/tabbed/levelDefinition.html';\n    $scope.setup = function () {\n      // read db config file for enum types\n      var dbconfigFileSchema = $scope.valid.getSchema('DBconfigFileSchema');\n      var webappFileSchema = $scope.valid.getSchema('emuwebappConfigSchema');\n      $scope.levelDefinitionProperties = dbconfigFileSchema.data.properties.levelDefinitions.items.properties;\n      $scope.linkDefinitionProperties = dbconfigFileSchema.data.properties.linkDefinitions.items.properties;\n      $scope.spectroDefinitionProperties = webappFileSchema.data.properties.spectrogramSettings.properties;\n      $scope.resetSelections();\n    };\n    $scope.onClickTab = function (tab) {\n      $scope.currentTab = tab.url;\n    };\n    $scope.resetSelections = function () {\n      $scope.signalSelect = [\n        'OSCI',\n        'SPEC'\n      ];\n      $scope.levelSelect = [];\n      $scope.twoDimSelect = [];\n      angular.forEach($scope.cps.curDbConfig.ssffTrackDefinitions, function (td) {\n        $scope.signalSelect.push(td.name);\n      });\n      angular.forEach($scope.cps.curDbConfig.levelDefinitions, function (td) {\n        $scope.levelSelect.push(td.name);\n      });\n      // the following will be rewritten : !\n      $scope.twoDimSelect.push('under development');\n      ////////////////////////////////\n      $scope.addSignalSelect = $scope.signalSelect[0];\n      $scope.addLevelSelect = $scope.levelSelect[0];\n      $scope.addTwoDimSelect = $scope.twoDimSelect[0];\n    };\n    $scope.isActiveTab = function (tabUrl) {\n      if (tabUrl == $scope.currentTab) {\n        return {\n          'background-color': '#FFF',\n          'color': '#000'\n        };\n      }\n      return {};\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorInTextField = function () {\n      viewState.setEditing(true);\n      viewState.setcursorInTextField(true);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.cursorOutOfTextField = function () {\n      viewState.setEditing(false);\n      viewState.setcursorInTextField(false);\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.classDefinition = function (typeOfDefinition, key) {\n      var style = 'emuwebapp-roundedBorderFrame';\n      switch (typeOfDefinition) {\n      case 'level':\n        if ($scope.cps.curDbConfig.levelDefinitions[key].added === true) {\n          style = 'emuwebapp-roundedBorderFrame-new';\n        }\n        break;\n      case 'ssff':\n        if ($scope.cps.curDbConfig.ssffTrackDefinitions[key].added === true) {\n          style = 'emuwebapp-roundedBorderFrame-new';\n        }\n        break;\n      case 'link':\n        if ($scope.cps.curDbConfig.linkDefinitions[key].added === true) {\n          style = 'emuwebapp-roundedBorderFrame-new';\n        }\n        break;\n      }\n      return style;\n    };\n    /**\n\t\t *\n\t\t */\n    $scope.saveDefinition = function (typeOfDefinition, key) {\n      switch (typeOfDefinition) {\n      case 'level':\n        if ($scope.cps.curDbConfig.levelDefinitions[key].added === true) {\n          // check if name of level is empty\n          if ($scope.cps.curDbConfig.levelDefinitions[key].name.length > 0) {\n            // check if name of level already exists\n            if ($scope.lvl.getLevelDetails($scope.cps.curDbConfig.levelDefinitions[key].name).level === null) {\n              if ($scope.cps.curDbConfig.levelDefinitions[key].type !== '') {\n                // check if saving is allowed\n                Websockethandler.getDoEditDBConfig().then(function (response) {\n                  if (response === 'YES') {\n                    $scope.cps.curDbConfig.levelDefinitions[key].added = undefined;\n                    delete $scope.cps.curDbConfig.levelDefinitions[key].added;\n                    Websockethandler.editDBConfig('ADDLEVELDEFINITION', angular.toJson($scope.cps.curDbConfig.levelDefinitions[key], false)).then(function (response) {\n                      if (response === 'YES') {\n                        $scope.response[key].show = false;\n                      } else {\n                        $scope.response[key] = {};\n                        $scope.response[key].show = true;\n                        $scope.response[key].text = 'Error while communicating with server.';\n                      }\n                    });\n                  } else {\n                    $scope.response[key] = {};\n                    $scope.response[key].show = true;\n                    $scope.response[key].text = 'Editing of Config is not allowed.';\n                  }\n                });\n              } else {\n                $scope.response[key] = {};\n                $scope.response[key].show = true;\n                $scope.response[key].text = 'The level type is not set.';\n              }\n            } else {\n              $scope.response[key] = {};\n              $scope.response[key].show = true;\n              $scope.response[key].text = 'The level name \"' + $scope.cps.curDbConfig.levelDefinitions[key].name + '\" already exists.';\n            }\n          } else {\n            $scope.response[key] = {};\n            $scope.response[key].show = true;\n            $scope.response[key].text = 'The level name \"' + $scope.cps.curDbConfig.levelDefinitions[key].name + '\" is not valid.';\n          }\n        }\n        break;\n      }\n    };\n    $scope.addDefinition = function (typeOfDefinition, key, keyAttribute) {\n      switch (typeOfDefinition) {\n      case 'level':\n        $scope.cps.curDbConfig.levelDefinitions.push({\n          name: '',\n          type: '',\n          attributeDefinitions: [{\n              name: '',\n              type: 'STRING'\n            }],\n          added: true\n        });\n        break;\n      case 'levelattribute':\n        $scope.cps.curDbConfig.levelDefinitions[key].attributeDefinitions.push({\n          name: '',\n          type: 'STRING',\n          legalLabels: []\n        });\n        break;\n      case 'link':\n        $scope.cps.curDbConfig.linkDefinitions.push({\n          type: '',\n          superlevelName: '',\n          sublevelName: '',\n          added: true\n        });\n        break;\n      case 'ssff':\n        $scope.cps.curDbConfig.ssffTrackDefinitions.push({\n          name: '',\n          columnName: '',\n          fileExtension: '',\n          added: true\n        });\n        break;\n      case 'perspective':\n        $scope.cps.vals.perspectives.push({\n          name: '',\n          signalCanvases: {\n            order: [],\n            assign: [],\n            contourLims: [],\n            contourColors: []\n          },\n          levelCanvases: { order: [] },\n          twoDimCanvases: { order: [] }\n        });\n        break;\n      case 'perspectiveAssign':\n        $scope.cps.vals.perspectives[key].signalCanvases.assign.push({\n          signalCanvasName: '',\n          ssffTrackName: ''\n        });\n        break;\n      case 'perspectiveContourColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors.push({\n          colors: ['rgba(0,0,0,1)'],\n          ssffTrackName: ''\n        });\n        break;\n      case 'perspectiveContourColorColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors[keyAttribute].colors.push('rgba(0,0,0,1)');\n        break;\n      case 'perspectiveContourLims':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourLims.push({\n          ssffTrackName: '',\n          minContourIdx: 0,\n          maxContourIdx: 1\n        });\n        break;\n      case 'perspectiveOrderSignal':\n        $scope.cps.vals.perspectives[key].signalCanvases.order.push(keyAttribute);\n        break;\n      case 'perspectiveOrderLevel':\n        $scope.cps.vals.perspectives[key].levelCanvases.order.push(keyAttribute);\n        break;\n      case 'perspectiveOrderTwoDim':\n        $scope.cps.vals.perspectives[key].twoDimCanvases.order.push(keyAttribute);\n        break;\n      }\n    };\n    $scope.deleteDefinition = function (typeOfDefinition, key, keyAttribute, subKeyAttribute) {\n      switch (typeOfDefinition) {\n      case 'level':\n        $scope.cps.curDbConfig.levelDefinitions.splice(key, 1);\n        break;\n      case 'levelattribute':\n        $scope.cps.curDbConfig.levelDefinitions[key].attributeDefinitions.splice(keyAttribute, 1);\n        break;\n      case 'link':\n        $scope.cps.curDbConfig.linkDefinitions.splice(key, 1);\n        break;\n      case 'ssff':\n        $scope.cps.curDbConfig.ssffTrackDefinitions.splice(key, 1);\n        break;\n      case 'perspective':\n        $scope.cps.vals.perspectives.splice(key, 1);\n        break;\n      case 'perspectiveAssign':\n        $scope.cps.vals.perspectives[key].signalCanvases.assign.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveContourColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveContourColorColor':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourColors[keyAttribute].colors.splice(subKeyAttribute, 1);\n        break;\n      case 'perspectiveContourLims':\n        $scope.cps.vals.perspectives[key].signalCanvases.contourLims.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveOrderSignal':\n        $scope.cps.vals.perspectives[key].signalCanvases.order.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveOrderLevel':\n        $scope.cps.vals.perspectives[key].levelCanvases.order.splice(keyAttribute, 1);\n        break;\n      case 'perspectiveOrderTwoDim':\n        $scope.cps.vals.perspectives[key].twoDimCanvases.order.splice(keyAttribute, 1);\n        break;\n      }\n    };\n    $scope.setup();\n  }\n]);\n'use strict';\n/**\n * @ngdoc filter\n * @name emuwebApp.filter:startFromFilter\n * @function\n * @description\n * # startFromFilter\n * Filter in the emuwebApp.\n */\nangular.module('emuwebApp').filter('startFrom', function () {\n  return function (input, start) {\n    start = +start;\n    //parse to int\n    return input.slice(start);\n  };\n});"]}